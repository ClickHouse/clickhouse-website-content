<!DOCTYPE html><html lang=zh data-version=master data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>如何编写 C++ 代码 | ClickHouse文档</title><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/images/logo-180x180.png><meta property=og:title content="如何编写 C++ 代码 | ClickHouse文档"><meta property=og:description content="如何编写 C++ 代码 一般建议 1. 以下是建议，而不是要求。 2. 如果你在修改代码，遵守已有的风格是有意义的。 3. 代码的风格需保持一致。一致的风格有利于阅读代码，并且方便检索代码。 4. 许多规则没有逻辑原因； 它们是由既定的做法"><meta property=og:type content=article><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta content=https://clickhouse.tech/docs/zh/development/style/ property=og:url><link href=https://clickhouse.tech/docs/zh/development/style/ rel=canonical><link href=https://clickhouse.tech/docs/zh/development/style/amp/ rel=amphtml><link rel=search href=/opensearch.xml title=ClickHouse type=application/opensearchdescription+xml><meta name=description content="如何编写 C++ 代码 一般建议 1. 以下是建议，而不是要求。 2. 如果你在修改代码，遵守已有的风格是有意义的。 3. 代码的风格需保持一致。一致的风格有利于阅读代码，并且方便检索代码。 4. 许多规则没有逻辑原因； 它们是由既定的做法"><meta name=keywords content="ClickHouse, DBMS, OLAP, SQL, open-source, relational, analytics, analytical, Big Data, web-analytics"><link rel=alternate href=https://clickhouse.tech/docs/en/development/style/ hreflang=en><link rel=alternate href=https://clickhouse.tech/docs/zh/development/style/ hreflang=zh><link rel=alternate href=https://clickhouse.tech/docs/es/development/style/ hreflang=es><link rel=alternate href=https://clickhouse.tech/docs/fr/development/style/ hreflang=fr><link rel=alternate href=https://clickhouse.tech/docs/ru/development/style/ hreflang=ru><link rel=alternate href=https://clickhouse.tech/docs/ja/development/style/ hreflang=ja><link rel=alternate href=https://clickhouse.tech/docs/en/development/style/ hreflang=x-default><link href=/css/base.css?e27f3458 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> 如何编写 C++ 代码 </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li id=edit-wrapper class=nav-item> <a id=edit-link href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/development/style.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/zh.svg alt=中文 title=中文 width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/en/development/style/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/zh/development/style/ class="dropdown-item disabled"> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/es/development/style/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/fr/development/style/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/ru/development/style/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/ja/development/style/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Multi-page or single-page"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Multi-page version" title="Multi-page version"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Single-page version" title="Single-page version"> </a> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=导言 class="nav-link text-light dropdown-toggle px-0">导言</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=什么是ClickHouse？ class="nav-link text-light text-wrap d-inline-block w-100 px-0">什么是ClickHouse？</a> <a href=../../getting-started/ title=入门 class="nav-link text-light text-wrap d-inline-block w-100 px-0">入门</a> <a href=../../getting-started/install/ title=安装部署 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安装部署</a> <a href=../../getting-started/tutorial/ title=使用教程 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用教程</a> <a href=#sidebar-sidebar-1-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1-5 title=示例数据集 class="nav-link text-light dropdown-toggle px-0">示例数据集</a> <div id=sidebar-sidebar-1-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting-started/example-datasets/ title=导言 class="nav-link text-light text-wrap d-inline-block w-100 px-0">导言</a> <a href=../../getting-started/example-datasets/metrica/ title="Yandex.Metrica Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica Data</a> <a href=../../getting-started/example-datasets/star-schema/ title="Star Schema Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema Benchmark</a> <a href=../../getting-started/example-datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting-started/example-datasets/criteo/ title="Terabyte Click Logs from Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Terabyte Click Logs from Criteo</a> <a href=../../getting-started/example-datasets/amplab-benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../getting-started/example-datasets/nyc-taxi/ title="New York Taxi Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">New York Taxi Data</a> <a href=../../getting-started/example-datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> </nav> </div> <a href=../../getting-started/playground/ title=体验平台 class="nav-link text-light text-wrap d-inline-block w-100 px-0">体验平台</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title=Interfaces class="nav-link text-light dropdown-toggle px-0">Interfaces</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=客户端 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端</a> <a href=../../interfaces/cli/ title=命令行客户端 class="nav-link text-light text-wrap d-inline-block w-100 px-0">命令行客户端</a> <a href=../../interfaces/tcp/ title=原生接口(TCP) class="nav-link text-light text-wrap d-inline-block w-100 px-0">原生接口(TCP)</a> <a href=../../interfaces/http/ title=HTTP客户端 class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP客户端</a> <a href=../../interfaces/mysql/ title=MySQL接口 class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL接口</a> <a href=../../interfaces/formats/ title=输入/输出格式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">输入/输出格式</a> <a href=../../interfaces/jdbc/ title=JDBC驱动 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC驱动</a> <a href=../../interfaces/odbc/ title=ODBC驱动 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC驱动</a> <a href=../../interfaces/cpp/ title=C++客户端库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">C++客户端库</a> <a href=#sidebar-sidebar-2-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-10 title=第三方工具 class="nav-link text-light dropdown-toggle px-0">第三方工具</a> <div id=sidebar-sidebar-2-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/ title=第三方工具 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方工具</a> <a href=../../interfaces/third-party/client-libraries/ title=客户端开发库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端开发库</a> <a href=../../interfaces/third-party/integrations/ title=第三方集成库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方集成库</a> <a href=../../interfaces/third-party/proxy/ title=第三方代理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方代理</a> <a href=../../interfaces/third-party/gui/ title=第三方开发的可视化界面 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方开发的可视化界面</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=引擎 class="nav-link text-light dropdown-toggle px-0">引擎</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-3-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-2 title=数据库引擎 class="nav-link text-light dropdown-toggle px-0">数据库引擎</a> <div id=sidebar-sidebar-3-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/database-engines/lazy/ title=延时引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">延时引擎</a> <a href=../../engines/database-engines/atomic/ title=Atomic class="nav-link text-light text-wrap d-inline-block w-100 px-0">Atomic</a> <a href=../../engines/database-engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../engines/database-engines/ title=数据库引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据库引擎</a> </nav> </div> <a href=#sidebar-sidebar-3-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-3 title=表引擎 class="nav-link text-light dropdown-toggle px-0">表引擎</a> <div id=sidebar-sidebar-3-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-3-3-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-3-1 title=合并树家族 class="nav-link text-light dropdown-toggle px-0">合并树家族</a> <div id=sidebar-sidebar-3-3-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/mergetree-family/versionedcollapsingmergetree/ title=版本折叠MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">版本折叠MergeTree</a> <a href=../../engines/table-engines/mergetree-family/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> <a href=../../engines/table-engines/mergetree-family/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../engines/table-engines/mergetree-family/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/collapsingmergetree/ title=折叠树 class="nav-link text-light text-wrap d-inline-block w-100 px-0">折叠树</a> <a href=../../engines/table-engines/mergetree-family/replication/ title=数据副本 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据副本</a> <a href=../../engines/table-engines/mergetree-family/custom-partitioning-key/ title=自定义分区键 class="nav-link text-light text-wrap d-inline-block w-100 px-0">自定义分区键</a> </nav> </div> <a href=#sidebar-sidebar-3-3-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-3-2 title=日志系列 class="nav-link text-light dropdown-toggle px-0">日志系列</a> <div id=sidebar-sidebar-3-3-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/log-family/ title=日志引擎系列 class="nav-link text-light text-wrap d-inline-block w-100 px-0">日志引擎系列</a> <a href=../../engines/table-engines/log-family/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../engines/table-engines/log-family/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../engines/table-engines/log-family/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-3-3-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-3-3 title=集成 class="nav-link text-light dropdown-toggle px-0">集成</a> <div id=sidebar-sidebar-3-3-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/integrations/jdbc/ title=JDBC表引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC表引擎</a> <a href=../../engines/table-engines/integrations/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> <a href=../../engines/table-engines/integrations/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> <a href=../../engines/table-engines/integrations/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../engines/table-engines/integrations/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-3-3-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-3-4 title=特别 class="nav-link text-light dropdown-toggle px-0">特别</a> <div id=sidebar-sidebar-3-3-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/special/join/ title=关联表引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">关联表引擎</a> <a href=../../engines/table-engines/special/generate/ title=随机数生成 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机数生成</a> <a href=../../engines/table-engines/special/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../engines/table-engines/special/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../engines/table-engines/special/url/ title=URL(URL,格式) class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL(URL,格式)</a> <a href=../../engines/table-engines/special/memory/ title=内存表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">内存表</a> <a href=../../engines/table-engines/special/distributed/ title=分布 class="nav-link text-light text-wrap d-inline-block w-100 px-0">分布</a> <a href=../../engines/table-engines/special/merge/ title=合并 class="nav-link text-light text-wrap d-inline-block w-100 px-0">合并</a> <a href=../../engines/table-engines/special/dictionary/ title=字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典</a> <a href=../../engines/table-engines/special/file/ title=文件(输入格式) class="nav-link text-light text-wrap d-inline-block w-100 px-0">文件(输入格式)</a> <a href=../../engines/table-engines/special/external-data/ title=用于查询处理的外部数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">用于查询处理的外部数据</a> <a href=../../engines/table-engines/special/buffer/ title=缓冲区 class="nav-link text-light text-wrap d-inline-block w-100 px-0">缓冲区</a> <a href=../../engines/table-engines/special/view/ title=视图 class="nav-link text-light text-wrap d-inline-block w-100 px-0">视图</a> <a href=../../engines/table-engines/special/set/ title=设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置</a> </nav> </div> <a href=../../engines/table-engines/ title=表引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">表引擎</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=SQL参考 class="nav-link text-light dropdown-toggle px-0">SQL参考</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/syntax/ title=SQL语法 class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQL语法</a> <a href=#sidebar-sidebar-4-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3 title=发言 class="nav-link text-light dropdown-toggle px-0">发言</a> <div id=sidebar-sidebar-4-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-4-3-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3-2 title=SELECT class="nav-link text-light dropdown-toggle px-0">SELECT</a> <div id=sidebar-sidebar-4-3-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/statements/select/ title=综述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">综述</a> <a href=../../sql-reference/statements/select/all/ title="ALL 子句" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALL 子句</a> <a href=../../sql-reference/statements/select/array-join/ title="ARRAY JOIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ARRAY JOIN</a> <a href=../../sql-reference/statements/select/distinct/ title=DISTINCT class="nav-link text-light text-wrap d-inline-block w-100 px-0">DISTINCT</a> <a href=../../sql-reference/statements/select/format/ title=FORMAT class="nav-link text-light text-wrap d-inline-block w-100 px-0">FORMAT</a> <a href=../../sql-reference/statements/select/from/ title=FROM class="nav-link text-light text-wrap d-inline-block w-100 px-0">FROM</a> <a href=../../sql-reference/statements/select/group-by/ title="GROUP BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GROUP BY</a> <a href=../../sql-reference/statements/select/having/ title=HAVING class="nav-link text-light text-wrap d-inline-block w-100 px-0">HAVING</a> <a href=../../sql-reference/statements/select/into-outfile/ title="INTO OUTFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INTO OUTFILE</a> <a href=../../sql-reference/statements/select/join/ title=JOIN class="nav-link text-light text-wrap d-inline-block w-100 px-0">JOIN</a> <a href=../../sql-reference/statements/select/limit/ title=LIMIT class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT</a> <a href=../../sql-reference/statements/select/limit-by/ title="LIMIT BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT BY</a> <a href=../../sql-reference/statements/select/order-by/ title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a> <a href=../../sql-reference/statements/select/prewhere/ title=PREWHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">PREWHERE</a> <a href=../../sql-reference/statements/select/sample/ title=SAMPLE class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE</a> <a href=../../sql-reference/statements/select/union/ title="UNION ALL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UNION ALL</a> <a href=../../sql-reference/statements/select/where/ title=WHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">WHERE</a> <a href=../../sql-reference/statements/select/with/ title=WITH class="nav-link text-light text-wrap d-inline-block w-100 px-0">WITH</a> </nav> </div> <a href=../../sql-reference/statements/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../sql-reference/statements/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../sql-reference/statements/show/ title=SHOW class="nav-link text-light text-wrap d-inline-block w-100 px-0">SHOW</a> <a href=../../sql-reference/statements/grant/ title=授权操作 class="nav-link text-light text-wrap d-inline-block w-100 px-0">授权操作</a> <a href=../../sql-reference/statements/revoke/ title=REVOKE class="nav-link text-light text-wrap d-inline-block w-100 px-0">REVOKE</a> <a href=../../sql-reference/statements/misc/ title=其他 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他</a> <a href=../../sql-reference/statements/create/ title="CREATE DATABASE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE DATABASE</a> <a href=../../sql-reference/statements/insert-into/ title="INSERT INTO 语句" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO 语句</a> </nav> </div> <a href=#sidebar-sidebar-4-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-4 title=函数 class="nav-link text-light dropdown-toggle px-0">函数</a> <div id=sidebar-sidebar-4-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/functions/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> <a href=../../sql-reference/functions/arithmetic-functions/ title=算术函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">算术函数</a> <a href=../../sql-reference/functions/comparison-functions/ title=比较函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">比较函数</a> <a href=../../sql-reference/functions/logical-functions/ title=逻辑函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">逻辑函数</a> <a href=../../sql-reference/functions/type-conversion-functions/ title=类型转换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">类型转换函数</a> <a href=../../sql-reference/functions/in-functions/ title="IN 运算符" class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN 运算符</a> <a href=../../sql-reference/functions/introspection/ title=自省 class="nav-link text-light text-wrap d-inline-block w-100 px-0">自省</a> <a href=../../sql-reference/functions/geo/ title=GEO函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">GEO函数</a> <a href=../../sql-reference/functions/hash-functions/ title=Hash函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash函数</a> <a href=../../sql-reference/functions/ip-address-functions/ title=IP函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IP函数</a> <a href=../../sql-reference/functions/json-functions/ title=JSON函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON函数</a> <a href=../../sql-reference/functions/functions-for-nulls/ title=Nullable处理函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable处理函数</a> <a href=../../sql-reference/functions/url-functions/ title=URL函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL函数</a> <a href=../../sql-reference/functions/uuid-functions/ title=UUID函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID函数</a> <a href=../../sql-reference/functions/array-join/ title=arrayJoin函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin函数</a> <a href=../../sql-reference/functions/bitmap-functions/ title=位图函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位图函数</a> <a href=../../sql-reference/functions/bit-functions/ title=位操作函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位操作函数</a> <a href=../../sql-reference/functions/other-functions/ title=其他函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他函数</a> <a href=../../sql-reference/functions/ym-dict-functions/ title=功能与Yandex的工作。梅特里卡词典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">功能与Yandex的工作。梅特里卡词典</a> <a href=../../sql-reference/functions/rounding-functions/ title=取整函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">取整函数</a> <a href=../../sql-reference/functions/ext-dict-functions/ title=字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典函数</a> <a href=../../sql-reference/functions/string-functions/ title=字符串函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串函数</a> <a href=../../sql-reference/functions/splitting-merging-functions/ title=字符串拆分合并函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串拆分合并函数</a> <a href=../../sql-reference/functions/string-search-functions/ title=字符串搜索函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串搜索函数</a> <a href=../../sql-reference/functions/string-replace-functions/ title=字符串替换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串替换函数</a> <a href=../../sql-reference/functions/math-functions/ title=数学函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数学函数</a> <a href=../../sql-reference/functions/array-functions/ title=数组函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数组函数</a> <a href=../../sql-reference/functions/date-time-functions/ title=时间日期函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">时间日期函数</a> <a href=../../sql-reference/functions/machine-learning-functions/ title=机器学习函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">机器学习函数</a> <a href=../../sql-reference/functions/conditional-functions/ title=条件函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">条件函数</a> <a href=../../sql-reference/functions/encoding-functions/ title=编码函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">编码函数</a> <a href=../../sql-reference/functions/random-functions/ title=随机函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机函数</a> <a href=../../sql-reference/functions/higher-order-functions/ title=高阶函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">高阶函数</a> </nav> </div> <a href=#sidebar-sidebar-4-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-5 title=聚合函数 class="nav-link text-light dropdown-toggle px-0">聚合函数</a> <div id=sidebar-sidebar-4-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/aggregate-functions/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> <a href=../../sql-reference/aggregate-functions/reference/ title=参考手册 class="nav-link text-light text-wrap d-inline-block w-100 px-0">参考手册</a> <a href=../../sql-reference/aggregate-functions/combinators/ title=聚合函数组合器 class="nav-link text-light text-wrap d-inline-block w-100 px-0">聚合函数组合器</a> <a href=../../sql-reference/aggregate-functions/parametric-functions/ title=参数聚合函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">参数聚合函数</a> </nav> </div> <a href=#sidebar-sidebar-4-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-6 title=表函数 class="nav-link text-light dropdown-toggle px-0">表函数</a> <div id=sidebar-sidebar-4-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/table-functions/ title=导言 class="nav-link text-light text-wrap d-inline-block w-100 px-0">导言</a> <a href=../../sql-reference/table-functions/file/ title=文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">文件</a> <a href=../../sql-reference/table-functions/merge/ title=合并 class="nav-link text-light text-wrap d-inline-block w-100 px-0">合并</a> <a href=../../sql-reference/table-functions/numbers/ title=数字 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数字</a> <a href=../../sql-reference/table-functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../sql-reference/table-functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../sql-reference/table-functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../sql-reference/table-functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../sql-reference/table-functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../sql-reference/table-functions/input/ title=输入 class="nav-link text-light text-wrap d-inline-block w-100 px-0">输入</a> <a href=../../sql-reference/table-functions/generate/ title=generateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">generateRandom</a> <a href=../../sql-reference/table-functions/remote/ title=远程，远程安全 class="nav-link text-light text-wrap d-inline-block w-100 px-0">远程，远程安全</a> </nav> </div> <a href=#sidebar-sidebar-4-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-7 title=字典 class="nav-link text-light dropdown-toggle px-0">字典</a> <div id=sidebar-sidebar-4-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/dictionaries/ title=导言 class="nav-link text-light text-wrap d-inline-block w-100 px-0">导言</a> <a href=#sidebar-sidebar-4-7-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-7-2 title=外部字典 class="nav-link text-light dropdown-toggle px-0">外部字典</a> <div id=sidebar-sidebar-4-7-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts/ title=概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概述</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict/ title=配置外部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置外部字典</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/ title=在内存中存储字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">在内存中存储字典</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-lifetime/ title=字典更新 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典更新</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources/ title=外部字典的来源 class="nav-link text-light text-wrap d-inline-block w-100 px-0">外部字典的来源</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-structure/ title=字典键和字段 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典键和字段</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-hierarchical/ title=分层字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">分层字典</a> </nav> </div> <a href=../../sql-reference/dictionaries/internal-dicts/ title=内部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">内部字典</a> </nav> </div> <a href=../../sql-reference/ansi/ title=ANSI兼容性 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ANSI兼容性</a> <a href=#sidebar-sidebar-4-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-9 title=操作符 class="nav-link text-light dropdown-toggle px-0">操作符</a> <div id=sidebar-sidebar-4-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/operators/in/ title="IN 操作符" class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN 操作符</a> <a href=../../sql-reference/operators/ title=操作符 class="nav-link text-light text-wrap d-inline-block w-100 px-0">操作符</a> </nav> </div> <a href=#sidebar-sidebar-4-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-10 title=数据类型 class="nav-link text-light dropdown-toggle px-0">数据类型</a> <div id=sidebar-sidebar-4-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../sql-reference/data-types/datetime64/ title=DateTime64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime64</a> <a href=../../sql-reference/data-types/lowcardinality/ title=低基数类型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">低基数类型</a> <a href=#sidebar-sidebar-4-10-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-10-4 title=域 class="nav-link text-light dropdown-toggle px-0">域</a> <div id=sidebar-sidebar-4-10-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/domains/ title=域 class="nav-link text-light text-wrap d-inline-block w-100 px-0">域</a> <a href=../../sql-reference/data-types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../sql-reference/data-types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> <a href=../../sql-reference/data-types/aggregatefunction/ title="AggregateFunction(name, types_of_arguments…)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments…)</a> <a href=../../sql-reference/data-types/decimal/ title=Decimal(P,S),Decimal32(S),Decimal64(S),Decimal128(S) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal(P,S),Decimal32(S),Decimal64(S),Decimal128(S)</a> <a href=../../sql-reference/data-types/enum/ title=Enum8,Enum16 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum8,Enum16</a> <a href=../../sql-reference/data-types/float/ title=Float32,Float64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32,Float64</a> <a href=../../sql-reference/data-types/simpleaggregatefunction/ title=SimpleAggregateFunction class="nav-link text-light text-wrap d-inline-block w-100 px-0">SimpleAggregateFunction</a> <a href=../../sql-reference/data-types/tuple/ title="Tuple(T1, T2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, …)</a> <a href=../../sql-reference/data-types/int-uint/ title=UInt8,UInt16,UInt32,UInt64,Int8,Int16,Int32,Int64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8,UInt16,UInt32,UInt64,Int8,Int16,Int32,Int64</a> <a href=../../sql-reference/data-types/nullable/ title=可为空（类型名称) class="nav-link text-light text-wrap d-inline-block w-100 px-0">可为空（类型名称)</a> <a href=../../sql-reference/data-types/fixedstring/ title=固定字符串 class="nav-link text-light text-wrap d-inline-block w-100 px-0">固定字符串</a> <a href=../../sql-reference/data-types/string/ title=字符串 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串</a> <a href=../../sql-reference/data-types/boolean/ title=布尔值 class="nav-link text-light text-wrap d-inline-block w-100 px-0">布尔值</a> <a href=../../sql-reference/data-types/ title=数据类型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据类型</a> <a href=../../sql-reference/data-types/date/ title=日期 class="nav-link text-light text-wrap d-inline-block w-100 px-0">日期</a> <a href=../../sql-reference/data-types/datetime/ title=日期时间 class="nav-link text-light text-wrap d-inline-block w-100 px-0">日期时间</a> <a href=../../sql-reference/data-types/array/ title=阵列(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">阵列(T)</a> <a href=#sidebar-sidebar-4-10-20 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-10-20 title=嵌套数据结构 class="nav-link text-light dropdown-toggle px-0">嵌套数据结构</a> <div id=sidebar-sidebar-4-10-20 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/nested-data-structures/nested/ title="Nested(Name1 Type1, Name2 Type2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, …)</a> <a href=../../sql-reference/data-types/nested-data-structures/ title=嵌套数据结构 class="nav-link text-light text-wrap d-inline-block w-100 px-0">嵌套数据结构</a> </nav> </div> <a href=#sidebar-sidebar-4-10-21 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-10-21 title=特殊数据类型 class="nav-link text-light dropdown-toggle px-0">特殊数据类型</a> <div id=sidebar-sidebar-4-10-21 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/special-data-types/interval/ title=间隔 class="nav-link text-light text-wrap d-inline-block w-100 px-0">间隔</a> <a href=../../sql-reference/data-types/special-data-types/nothing/ title=没什么 class="nav-link text-light text-wrap d-inline-block w-100 px-0">没什么</a> <a href=../../sql-reference/data-types/special-data-types/ title=特殊数据类型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">特殊数据类型</a> <a href=../../sql-reference/data-types/special-data-types/expression/ title=表达式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">表达式</a> <a href=../../sql-reference/data-types/special-data-types/set/ title=设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置</a> </nav> </div> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title=指南 class="nav-link text-light dropdown-toggle px-0">指南</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../guides/ title=概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概述</a> <a href=../../guides/apply-catboost-model/ title=应用CatBoost模型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">应用CatBoost模型</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=操作 class="nav-link text-light dropdown-toggle px-0">操作</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=操作 class="nav-link text-light text-wrap d-inline-block w-100 px-0">操作</a> <a href=../../operations/requirements/ title=要求 class="nav-link text-light text-wrap d-inline-block w-100 px-0">要求</a> <a href=../../operations/monitoring/ title=监控 class="nav-link text-light text-wrap d-inline-block w-100 px-0">监控</a> <a href=../../operations/troubleshooting/ title=常见问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">常见问题</a> <a href=../../operations/update/ title=更新 class="nav-link text-light text-wrap d-inline-block w-100 px-0">更新</a> <a href=../../operations/access-rights/ title=访问权限和账户管理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">访问权限和账户管理</a> <a href=../../operations/backup/ title=数据备份 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据备份</a> <a href=#sidebar-sidebar-6-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-8 title=优化性能 class="nav-link text-light dropdown-toggle px-0">优化性能</a> <div id=sidebar-sidebar-6-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/optimizing-performance/sampling-query-profiler/ title=查询分析 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询分析</a> </nav> </div> <a href=#sidebar-sidebar-6-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-9 title=系统表 class="nav-link text-light dropdown-toggle px-0">系统表</a> <div id=sidebar-sidebar-6-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/system-tables/ title=系统表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统表</a> <a href=../../operations/system-tables/query_log/ title=system.query_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_log</a> <a href=../../operations/system-tables/asynchronous_metric_log/ title=系统。asynchronous_metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。asynchronous_metric_log</a> <a href=../../operations/system-tables/asynchronous_metrics/ title=系统。asynchronous_metrics class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。asynchronous_metrics</a> <a href=../../operations/system-tables/data_type_families/ title=系统。data_type_families class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。data_type_families</a> <a href=../../operations/system-tables/detached_parts/ title=系统。detached_parts class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。detached_parts</a> <a href=../../operations/system-tables/graphite_retentions/ title=系统。graphite_retentions class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。graphite_retentions</a> <a href=../../operations/system-tables/merge_tree_settings/ title=系统。merge_tree_settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。merge_tree_settings</a> <a href=../../operations/system-tables/metric_log/ title=系统。metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。metric_log</a> <a href=../../operations/system-tables/numbers_mt/ title=系统。numbers_mt class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。numbers_mt</a> <a href=../../operations/system-tables/part_log/ title=系统。part_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。part_log</a> <a href=../../operations/system-tables/query_thread_log/ title=系统。query_thread_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。query_thread_log</a> <a href=../../operations/system-tables/storage_policies/ title=系统。storage_policies class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。storage_policies</a> <a href=../../operations/system-tables/text_log/ title=系统。text_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。text_log</a> <a href=../../operations/system-tables/trace_log/ title=系统。trace_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。trace_log</a> <a href=../../operations/system-tables/one/ title=系统。一 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。一</a> <a href=../../operations/system-tables/columns/ title=系统。列 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。列</a> <a href=../../operations/system-tables/replicas/ title=系统。副本 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。副本</a> <a href=../../operations/system-tables/functions/ title=系统。功能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。功能</a> <a href=../../operations/system-tables/zookeeper/ title=系统。动物园管理员 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。动物园管理员</a> <a href=../../operations/system-tables/merges/ title=系统。合并 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。合并</a> <a href=../../operations/system-tables/dictionaries/ title=系统。字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。字典</a> <a href=../../operations/system-tables/metrics/ title=系统。指标 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。指标</a> <a href=../../operations/system-tables/numbers/ title=系统。数字 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。数字</a> <a href=../../operations/system-tables/databases/ title=系统。数据库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。数据库</a> <a href=../../operations/system-tables/events/ title=系统。活动 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。活动</a> <a href=../../operations/system-tables/processes/ title=系统。流程 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。流程</a> <a href=../../operations/system-tables/disks/ title=系统。磁盘 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。磁盘</a> <a href=../../operations/system-tables/mutations/ title=系统。突变 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。突变</a> <a href=../../operations/system-tables/tables/ title=系统。表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。表</a> <a href=../../operations/system-tables/table_engines/ title=系统。表_engines class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。表_engines</a> <a href=../../operations/system-tables/settings/ title=系统。设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。设置</a> <a href=../../operations/system-tables/contributors/ title=系统。贡献者 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。贡献者</a> <a href=../../operations/system-tables/clusters/ title=系统。集群 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。集群</a> <a href=../../operations/system-tables/parts/ title=系统。零件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。零件</a> </nav> </div> <a href=../../operations/performance-test/ title=测试硬件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">测试硬件</a> <a href=../../operations/tips/ title=使用建议 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用建议</a> <a href=../../operations/configuration-files/ title=配置文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置文件</a> <a href=../../operations/quotas/ title=配额 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配额</a> <a href=#sidebar-sidebar-6-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-14 title=实用工具 class="nav-link text-light dropdown-toggle px-0">实用工具</a> <div id=sidebar-sidebar-6-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utilities/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> <a href=../../operations/utilities/clickhouse-benchmark/ title=性能测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">性能测试</a> <a href=../../operations/utilities/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utilities/ title=实用工具 class="nav-link text-light text-wrap d-inline-block w-100 px-0">实用工具</a> </nav> </div> <a href=#sidebar-sidebar-6-15 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-15 title=服务器配置参数 class="nav-link text-light dropdown-toggle px-0">服务器配置参数</a> <div id=sidebar-sidebar-6-15 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server-configuration-parameters/settings/ title=服务器设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">服务器设置</a> <a href=../../operations/server-configuration-parameters/ title=服务器配置参数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">服务器配置参数</a> </nav> </div> <a href=#sidebar-sidebar-6-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6-16 title=设置 class="nav-link text-light dropdown-toggle px-0">设置</a> <div id=sidebar-sidebar-6-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/permissions-for-queries/ title=查询权限 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询权限</a> <a href=../../operations/settings/settings-profiles/ title=设置配置文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置配置文件</a> <a href=../../operations/settings/constraints-on-settings/ title=对设置的限制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">对设置的限制</a> <a href=../../operations/settings/settings-users/ title=用户设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">用户设置</a> <a href=../../operations/settings/query-complexity/ title=查询复杂性的限制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询复杂性的限制</a> <a href=../../operations/settings/settings/ title=设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=商业支持 class="nav-link text-light dropdown-toggle px-0">商业支持</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../commercial/cloud/ title=云 class="nav-link text-light text-wrap d-inline-block w-100 px-0">云</a> <a href=../../commercial/support/ title=支持 class="nav-link text-light text-wrap d-inline-block w-100 px-0">支持</a> <a href=../../commercial/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=F.A.Q. class="nav-link text-light dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title=常见问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">常见问题</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=ClickHouse事迹 class="nav-link text-light dropdown-toggle px-0">ClickHouse事迹</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-9-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9-1 title=Changelog class="nav-link text-light dropdown-toggle px-0">Changelog</a> <div id=sidebar-sidebar-9-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../whats-new/changelog/ title=2021 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2021</a> <a href=../../whats-new/changelog/2019/ title=2019 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2019</a> <a href=../../whats-new/changelog/2018/ title=2018 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2018</a> <a href=../../whats-new/changelog/2017/ title=2017 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2017</a> </nav> </div> <a href=../../whats-new/roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> <a href=../../whats-new/security-changelog/ title=安全更新日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安全更新日志</a> <a href=../../whats-new/ title=ClickHouse变更及改动? class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse变更及改动?</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title="ClickHouse 开发" class="nav-link text-light dropdown-toggle px-0">ClickHouse 开发</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/browse-code/ title=浏览源代码 class="nav-link text-light text-wrap d-inline-block w-100 px-0">浏览源代码</a> <a href=../../development/build-cross-arm/ title="如何在Linux上构建ClickHouse for AARCH64（ARM64)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux上构建ClickHouse for AARCH64（ARM64)</a> <a href=../../development/ title="ClickHouse 开发" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse 开发</a> <a href=../../development/architecture/ title="ClickHouse 架构概述" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse 架构概述</a> <a href=../../development/developer-instruction/ title=Windows使用指引 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Windows使用指引</a> <a href=../../development/contrib/ title=使用的三方库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用的三方库</a> <a href=../../development/build-osx/ title="在 Mac OS X 中编译 ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">在 Mac OS X 中编译 ClickHouse</a> <a href=../../development/build-cross-osx/ title="如何在Linux中编译Mac OS X ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux中编译Mac OS X ClickHouse</a> <a href=../../development/build/ title="如何构建 ClickHouse 发布包" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何构建 ClickHouse 发布包</a> <a href=../../development/style/ title="如何编写 C++ 代码" class="nav-link text-white active text-wrap d-inline-block w-100 px-0">如何编写 C++ 代码</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title=变更日志 class="nav-link text-light dropdown-toggle px-0">变更日志</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../changelog/ title=变更日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">变更日志</a> </nav> </div> <a href=../../single/clickhouse_zh.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt="PDF version" title="PDF version" height=24 class="d-block mr-1 float-left"><div>PDF version</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-4"> <div id=content class=mt-md-n3> <nav class=text-muted aria-label=breadcrumb> <ol class="breadcrumb bg-transparent p-0"> <li class=breadcrumb-item><a href=../ class=text-reset>ClickHouse 开发</a> </li> </ol> </nav> <h1 id=ru-he-bian-xie-c-dai-ma>如何编写 C++ 代码<a class=headerlink href=#ru-he-bian-xie-c-dai-ma title="Permanent link"> </a></h1> <h2 id=yi-ban-jian-yi>一般建议<a class=headerlink href=#yi-ban-jian-yi title="Permanent link"> </a></h2> <p><strong>1.</strong> 以下是建议，而不是要求。</p> <p><strong>2.</strong> 如果你在修改代码，遵守已有的风格是有意义的。</p> <p><strong>3.</strong> 代码的风格需保持一致。一致的风格有利于阅读代码，并且方便检索代码。</p> <p><strong>4.</strong> 许多规则没有逻辑原因； 它们是由既定的做法决定的。</p> <h2 id=ge-shi-hua>格式化<a class=headerlink href=#ge-shi-hua title="Permanent link"> </a></h2> <p><strong>1.</strong> 大多数格式化可以用 <code class=syntax>clang-format</code> 自动完成。</p> <p><strong>2.</strong> 缩进是4个空格。 配置开发环境，使得 TAB 代表添加四个空格。</p> <p><strong>3.</strong> 左右花括号需在单独的行。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=kr>inline</span> <span class=kt>void</span> <span class=nf>readBoolText</span><span class=p>(</span><span class=kt>bool</span> <span class=o>&amp;</span> <span class=n>x</span><span class=p>,</span> <span class=n>ReadBuffer</span> <span class=o>&amp;</span> <span class=n>buf</span><span class=p>)</span>
<span class=p>{</span>
    <span class=kt>char</span> <span class=n>tmp</span> <span class=o>=</span> <span class=sc>'0'</span><span class=p>;</span>
    <span class=n>readChar</span><span class=p>(</span><span class=n>tmp</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span>
    <span class=n>x</span> <span class=o>=</span> <span class=n>tmp</span> <span class=o>!=</span> <span class=sc>'0'</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p><strong>4.</strong> 若整个方法体仅有一行 <code class=syntax>描述</code>， 则可以放到单独的行上。 在花括号周围放置空格（除了行尾的空格）。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=kr>inline</span> <span class=kt>size_t</span> <span class=nf>mask</span><span class=p>()</span> <span class=k>const</span>                <span class=p>{</span> <span class=k>return</span> <span class=n>buf_size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
<span class=kr>inline</span> <span class=kt>size_t</span> <span class=nf>place</span><span class=p>(</span><span class=n>HashValue</span> <span class=n>x</span><span class=p>)</span> <span class=k>const</span>    <span class=p>{</span> <span class=k>return</span> <span class=n>x</span> <span class=o>&amp;</span> <span class=n>mask</span><span class=p>();</span> <span class=p>}</span>
</code></pre></div> <p><strong>5.</strong> 对于函数。 不要在括号周围放置空格。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=kt>void</span> <span class=n>reinsert</span><span class=p>(</span><span class=k>const</span> <span class=n>Value</span> <span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>[</span><span class=n>place_value</span><span class=p>],</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>x</span><span class=p>));</span>
</code></pre></div> <p><strong>6.</strong> 在<code class=syntax>if</code>，<code class=syntax>for</code>，<code class=syntax>while</code>和其他表达式中，在开括号前面插入一个空格（与函数声明相反）。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>for</span> <span class=p>(</span><span class=kt>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>rows</span><span class=p>;</span> <span class=n>i</span> <span class=o>+=</span> <span class=n>storage</span><span class=p>.</span><span class=n>index_granularity</span><span class=p>)</span>
</code></pre></div> <p><strong>7.</strong> 在二元运算符（<code class=syntax>+</code>，<code class=syntax>-</code>，<code class=syntax>*</code>，<code class=syntax>/</code>，<code class=syntax>％</code>，…）和三元运算符 <code class=syntax>?:</code> 周围添加空格。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>UInt16</span> <span class=n>year</span> <span class=o>=</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>)</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>+</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span> <span class=o>+</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>);</span>
<span class=n>UInt8</span> <span class=n>month</span> <span class=o>=</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>);</span>
<span class=n>UInt8</span> <span class=n>day</span> <span class=o>=</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>-</span> <span class=sc>'0'</span><span class=p>);</span>
</code></pre></div> <p><strong>8.</strong> 若有换行，新行应该以运算符开头，并且增加对应的缩进。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>if</span> <span class=p>(</span><span class=n>elapsed_ns</span><span class=p>)</span>
    <span class=n>message</span> <span class=o>&lt;&lt;</span> <span class=s>" ("</span>
        <span class=o>&lt;&lt;</span> <span class=n>rows_read_on_server</span> <span class=o>*</span> <span class=mi>1000000000</span> <span class=o>/</span> <span class=n>elapsed_ns</span> <span class=o>&lt;&lt;</span> <span class=s>" rows/s., "</span>
        <span class=o>&lt;&lt;</span> <span class=n>bytes_read_on_server</span> <span class=o>*</span> <span class=mf>1000.0</span> <span class=o>/</span> <span class=n>elapsed_ns</span> <span class=o>&lt;&lt;</span> <span class=s>" MB/s.) "</span><span class=p>;</span>
</code></pre></div> <p><strong>9.</strong> 如果需要，可以在一行内使用空格来对齐。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>dst</span><span class=p>.</span><span class=n>ClickLogID</span>         <span class=o>=</span> <span class=n>click</span><span class=p>.</span><span class=n>LogID</span><span class=p>;</span>
<span class=n>dst</span><span class=p>.</span><span class=n>ClickEventID</span>       <span class=o>=</span> <span class=n>click</span><span class=p>.</span><span class=n>EventID</span><span class=p>;</span>
<span class=n>dst</span><span class=p>.</span><span class=n>ClickGoodEvent</span>     <span class=o>=</span> <span class=n>click</span><span class=p>.</span><span class=n>GoodEvent</span><span class=p>;</span>
</code></pre></div> <p><strong>10.</strong> 不要在 <code class=syntax>.</code>，<code class=syntax>-&gt;</code> 周围加入空格</p> <p>如有必要，运算符可以包裹到下一行。 在这种情况下，它前面的偏移量增加。</p> <p><strong>11.</strong> 不要使用空格来分开一元运算符 (<code class=syntax>--</code>, <code class=syntax>++</code>, <code class=syntax>*</code>, <code class=syntax>&amp;</code>, …) 和参数。</p> <p><strong>12.</strong> 在逗号后面加一个空格，而不是在之前。同样的规则也适合 <code class=syntax>for</code> 循环中的分号。</p> <p><strong>13.</strong> 不要用空格分开 <code class=syntax>[]</code> 运算符。</p> <p><strong>14.</strong> 在 <code class=syntax>template &lt;...&gt;</code> 表达式中，在 <code class=syntax>template</code> 和 <code class=syntax>&lt;</code> 中加入一个空格，在 <code class=syntax>&lt;</code> 后面或在 <code class=syntax>&gt;</code> 前面都不要有空格。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>TKey</span><span class=p>,</span> <span class=k>typename</span> <span class=n>TValue</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>AggregatedStatElement</span>
<span class=p>{}</span>
</code></pre></div> <p><strong>15.</strong> 在类和结构体中， <code class=syntax>public</code>， <code class=syntax>private</code> 以及 <code class=syntax>protected</code> 同 <code class=syntax>class/struct</code> 无需缩进，其他代码须缩进。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
<span class=k>class</span> <span class=nc>MultiVersion</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=c1>/// Version of object for usage. shared_ptr manage lifetime of version.</span>
    <span class=k>using</span> <span class=n>Version</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>
    <span class=p>...</span>
<span class=p>}</span>
</code></pre></div> <p><strong>16.</strong> 如果对整个文件使用相同的 <code class=syntax>namespace</code>，并且没有其他重要的东西，则 <code class=syntax>namespace</code> 中不需要偏移量。</p> <p><strong>17.</strong> 在 <code class=syntax>if</code>, <code class=syntax>for</code>, <code class=syntax>while</code> 中包裹的代码块中，若代码是一个单行的 <code class=syntax>statement</code>，那么大括号是可选的。 可以将 <code class=syntax>statement</code> 放到一行中。这个规则同样适用于嵌套的 <code class=syntax>if</code>， <code class=syntax>for</code>， <code class=syntax>while</code>， …</p> <p>但是如果内部 <code class=syntax>statement</code> 包含大括号或 <code class=syntax>else</code>，则外部块应该用大括号括起来。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>/// Finish write.</span>
<span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;</span> <span class=nl>stream</span> <span class=p>:</span> <span class=n>streams</span><span class=p>)</span>
    <span class=n>stream</span><span class=p>.</span><span class=n>second</span><span class=o>-&gt;</span><span class=n>finalize</span><span class=p>();</span>
</code></pre></div> <p><strong>18.</strong> 行的末尾不应该包含空格。</p> <p><strong>19.</strong> 源文件应该用 UTF-8 编码。</p> <p><strong>20.</strong> 非ASCII字符可用于字符串文字。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;&lt;</span> <span class=s>", "</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>timer</span><span class=p>.</span><span class=n>elapsed</span><span class=p>()</span> <span class=o>/</span> <span class=n>chunks_stats</span><span class=p>.</span><span class=n>hits</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=s>" μsec/hit."</span><span class=p>;</span>
</code></pre></div> <p><strong>21</strong> 不要在一行中写入多个表达式。</p> <p><strong>22.</strong> 将函数内部的代码段分组，并将它们与不超过一行的空行分开。</p> <p><strong>23.</strong> 将 函数，类用一个或两个空行分开。</p> <p><strong>24.</strong> <code class=syntax>const</code> 必须写在类型名称之前。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//correct</span>
<span class=k>const</span> <span class=kt>char</span> <span class=o>*</span> <span class=n>pos</span>
<span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=o>&amp;</span> <span class=n>s</span>
<span class=c1>//incorrect</span>
<span class=kt>char</span> <span class=k>const</span> <span class=o>*</span> <span class=n>pos</span>
</code></pre></div> <p><strong>25.</strong> 声明指针或引用时，<code class=syntax>*</code> 和 <code class=syntax>＆</code> 符号两边应该都用空格分隔。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//correct</span>
<span class=k>const</span> <span class=kt>char</span> <span class=o>*</span> <span class=n>pos</span>
<span class=c1>//incorrect</span>
<span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>pos</span>
<span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>pos</span>
</code></pre></div> <p><strong>26.</strong> 使用模板类型时，使用 <code class=syntax>using</code> 关键字对它们进行别名（最简单的情况除外）。</p> <p>换句话说，模板参数仅在 <code class=syntax>using</code> 中指定，并且不在代码中重复。</p> <p><code class=syntax>using</code>可以在本地声明，例如在函数内部。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//correct</span>
<span class=k>using</span> <span class=n>FileStreams</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>Stream</span><span class=o>&gt;&gt;</span><span class=p>;</span>
<span class=n>FileStreams</span> <span class=n>streams</span><span class=p>;</span>
<span class=c1>//incorrect</span>
<span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>Stream</span><span class=o>&gt;&gt;</span> <span class=n>streams</span><span class=p>;</span>
</code></pre></div> <p><strong>27.</strong> 不要在一个语句中声明不同类型的多个变量。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//incorrect</span>
<span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=o>*</span><span class=n>y</span><span class=p>;</span>
</code></pre></div> <p><strong>28.</strong> 不要使用C风格的类型转换。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//incorrect</span>
<span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>c</span> <span class=o>&lt;&lt;</span><span class=p>;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
<span class=c1>//correct</span>
<span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</code></pre></div> <p><strong>29.</strong> 在类和结构中，组成员和函数分别在每个可见范围内。</p> <p><strong>30.</strong> 对于小类和结构，没有必要将方法声明与实现分开。</p> <p>对于任何类或结构中的小方法也是如此。</p> <p>对于模板化类和结构，不要将方法声明与实现分开（因为否则它们必须在同一个转换单元中定义）</p> <p><strong>31.</strong> 您可以将换行规则定在140个字符，而不是80个字符。</p> <p><strong>32.</strong> 如果不需要 postfix，请始终使用前缀增量/减量运算符。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>for</span> <span class=p>(</span><span class=n>Names</span><span class=o>::</span><span class=n>const_iterator</span> <span class=n>it</span> <span class=o>=</span> <span class=n>column_names</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span> <span class=n>it</span> <span class=o>!=</span> <span class=n>column_names</span><span class=p>.</span><span class=n>end</span><span class=p>();</span> <span class=o>++</span><span class=n>it</span><span class=p>)</span>
</code></pre></div> <h2 id=comments>评论<a class=headerlink href=#comments title="Permanent link"> </a></h2> <p><strong>1.</strong> 请务必为所有非常重要的代码部分添加注释。</p> <p>这是非常重要的。 编写注释可能会帮助您意识到代码不是必需的，或者设计错误。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=cm>/** Part of piece of memory, that can be used.</span>
<span class=cm>  * For example, if internal_buffer is 1MB, and there was only 10 bytes loaded to buffer from file for reading,</span>
<span class=cm>  * then working_buffer will have size of only 10 bytes</span>
<span class=cm>  * (working_buffer.end() will point to position right after those 10 bytes available for read).</span>
<span class=cm>  */</span>
</code></pre></div> <p><strong>2.</strong> 注释可以尽可能详细。</p> <p><strong>3.</strong> 在他们描述的代码之前放置注释。 在极少数情况下，注释可以在代码之后，在同一行上。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=cm>/** Parses and executes the query.</span>
<span class=cm>*/</span>
<span class=kt>void</span> <span class=n>executeQuery</span><span class=p>(</span>
    <span class=n>ReadBuffer</span> <span class=o>&amp;</span> <span class=n>istr</span><span class=p>,</span> <span class=c1>/// Where to read the query from (and data for INSERT, if applicable)</span>
    <span class=n>WriteBuffer</span> <span class=o>&amp;</span> <span class=n>ostr</span><span class=p>,</span> <span class=c1>/// Where to write the result</span>
    <span class=n>Context</span> <span class=o>&amp;</span> <span class=n>context</span><span class=p>,</span> <span class=c1>/// DB, tables, data types, engines, functions, aggregate functions...</span>
    <span class=n>BlockInputStreamPtr</span> <span class=o>&amp;</span> <span class=n>query_plan</span><span class=p>,</span> <span class=c1>/// Here could be written the description on how query was executed</span>
    <span class=n>QueryProcessingStage</span><span class=o>::</span><span class=n>Enum</span> <span class=n>stage</span> <span class=o>=</span> <span class=n>QueryProcessingStage</span><span class=o>::</span><span class=n>Complete</span> <span class=c1>/// Up to which stage process the SELECT query</span>
    <span class=p>)</span>
</code></pre></div> <p><strong>4.</strong> 注释应该只用英文撰写。</p> <p><strong>5.</strong> 如果您正在编写库，请在主头文件中包含解释它的详细注释。</p> <p><strong>6.</strong> 请勿添加无效的注释。 特别是，不要留下像这样的空注释：</p> <div class=codehilite><pre><span></span><code class=syntax><span class=cm>/*</span>
<span class=cm>* Procedure Name:</span>
<span class=cm>* Original procedure name:</span>
<span class=cm>* Author:</span>
<span class=cm>* Date of creation:</span>
<span class=cm>* Dates of modification:</span>
<span class=cm>* Modification authors:</span>
<span class=cm>* Original file name:</span>
<span class=cm>* Purpose:</span>
<span class=cm>* Intent:</span>
<span class=cm>* Designation:</span>
<span class=cm>* Classes used:</span>
<span class=cm>* Constants:</span>
<span class=cm>* Local variables:</span>
<span class=cm>* Parameters:</span>
<span class=cm>* Date of creation:</span>
<span class=cm>* Purpose:</span>
<span class=cm>*/</span>
</code></pre></div> <p>这个示例来源于 <a href=http://home.tamk.fi/~jaalto/course/coding-style/doc/unmaintainable-code/ target=_blank>http://home.tamk.fi/~jaalto/course/coding-style/doc/unmaintainable-code/</a>。</p> <p><strong>7.</strong> 不要在每个文件的开头写入垃圾注释（作者，创建日期…）。</p> <p><strong>8.</strong> 单行注释用三个斜杆： <code class=syntax>///</code> ，多行注释以 <code class=syntax>/**</code>开始。 这些注释会当做文档。</p> <p>注意：您可以使用 Doxygen 从这些注释中生成文档。 但是通常不使用 Doxygen，因为在 IDE 中导航代码更方便。</p> <p><strong>9.</strong> 多行注释的开头和结尾不得有空行（关闭多行注释的行除外）。</p> <p><strong>10.</strong> 要注释掉代码，请使用基本注释，而不是“文档”注释。</p> <p><strong>11.</strong> 在提交之前删除代码的无效注释部分。</p> <p><strong>12.</strong> 不要在注释或代码中使用亵渎语言。</p> <p><strong>13.</strong> 不要使用大写字母。 不要使用过多的标点符号。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>/// WHAT THE FAIL???</span>
</code></pre></div> <p><strong>14.</strong> 不要使用注释来制作分隔符。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>///******************************************************</span>
</code></pre></div> <p><strong>15.</strong> 不要在注释中开始讨论。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>/// Why did you do this stuff?</span>
</code></pre></div> <p><strong>16.</strong> 没有必要在块的末尾写一条注释来描述它的含义。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>/// for</span>
</code></pre></div> <h2 id=names>姓名<a class=headerlink href=#names title="Permanent link"> </a></h2> <p><strong>1.</strong> 在变量和类成员的名称中使用带下划线的小写字母。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=kt>size_t</span> <span class=n>max_block_size</span><span class=p>;</span>
</code></pre></div> <p><strong>2.</strong> 对于函数（方法）的名称，请使用以小写字母开头的驼峰标识。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>getName</span><span class=p>()</span> <span class=k>const</span> <span class=k>override</span> <span class=p>{</span> <span class=k>return</span> <span class=s>"Memory"</span><span class=p>;</span> <span class=p>}</span>
</code></pre></div> <p><strong>3.</strong> 对于类（结构）的名称，使用以大写字母开头的驼峰标识。接口名称用I前缀。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>class</span> <span class=nc>StorageMemory</span> <span class=o>:</span> <span class=k>public</span> <span class=n>IStorage</span>
</code></pre></div> <p><strong>4.</strong> <code class=syntax>using</code> 的命名方式与类相同，或者以__t`命名。</p> <p><strong>5.</strong> 模板类型参数的名称：在简单的情况下，使用<code class=syntax>T</code>; <code class=syntax>T</code>，<code class=syntax>U</code>; <code class=syntax>T1</code>，<code class=syntax>T2</code>。</p> <p>对于更复杂的情况，要么遵循类名规则，要么添加前缀<code class=syntax>T</code>。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>TKey</span><span class=p>,</span> <span class=k>typename</span> <span class=n>TValue</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>AggregatedStatElement</span>
</code></pre></div> <p><strong>6.</strong> 模板常量参数的名称：遵循变量名称的规则，或者在简单的情况下使用 <code class=syntax>N</code>。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>without_www</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>ExtractDomain</span>
</code></pre></div> <p><strong>7.</strong> 对于抽象类（接口），用 <code class=syntax>I</code> 前缀。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>class</span> <span class=nc>IBlockInputStream</span>
</code></pre></div> <p><strong>8.</strong> 如果在本地使用变量，则可以使用短名称。</p> <p>在所有其他情况下，请使用能描述含义的名称。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=kt>bool</span> <span class=n>info_successfully_loaded</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</code></pre></div> <p><strong>9.</strong> <code class=syntax>define</code> 和全局常量的名称使用全大写带下划线的形式，如 <code class=syntax>ALL_CAPS</code>。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=cp>#define MAX_SRC_TABLE_NAMES_TO_STORE 1000</span>
</code></pre></div> <p><strong>10.</strong> 文件名应使用与其内容相同的样式。</p> <p>如果文件包含单个类，则以与该类名称相同的方式命名该文件（CamelCase）。</p> <p>如果文件包含单个函数，则以与函数名称相同的方式命名文件（camelCase）。</p> <p><strong>11.</strong> 如果名称包含缩写，则：</p> <ul> <li>对于变量名，缩写应使用小写字母 <code class=syntax>mysql_connection</code>（不是 <code class=syntax>mySQL_connection</code> ）。</li> <li>对于类和函数的名称，请将大写字母保留在缩写 <code class=syntax>MySQLConnection</code>（不是 <code class=syntax>MySqlConnection</code>）。</li> </ul> <p><strong>12.</strong> 仅用于初始化类成员的构造方法参数的命名方式应与类成员相同，但最后使用下划线。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>FileQueueProcessor</span><span class=p>(</span>
    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=o>&amp;</span> <span class=n>path_</span><span class=p>,</span>
    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=o>&amp;</span> <span class=n>prefix_</span><span class=p>,</span>
    <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>FileHandler</span><span class=o>&gt;</span> <span class=n>handler_</span><span class=p>)</span>
    <span class=o>:</span> <span class=n>path</span><span class=p>(</span><span class=n>path_</span><span class=p>),</span>
    <span class=n>prefix</span><span class=p>(</span><span class=n>prefix_</span><span class=p>),</span>
    <span class=n>handler</span><span class=p>(</span><span class=n>handler_</span><span class=p>),</span>
    <span class=n>log</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Logger</span><span class=o>::</span><span class=n>get</span><span class=p>(</span><span class=s>"FileQueueProcessor"</span><span class=p>))</span>
<span class=p>{</span>
<span class=p>}</span>
</code></pre></div> <p>如果构造函数体中未使用该参数，则可以省略下划线后缀。</p> <p><strong>13.</strong> 局部变量和类成员的名称没有区别（不需要前缀）。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>timer</span> <span class=p>(</span><span class=n>not</span> <span class=n>m_timer</span><span class=p>)</span>
</code></pre></div> <p><strong>14.</strong> 对于 <code class=syntax>enum</code> 中的常量，请使用带大写字母的驼峰标识。ALL_CAPS 也可以接受。如果 <code class=syntax>enum</code> 是非本地的，请使用 <code class=syntax>enum class</code>。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>enum</span> <span class=k>class</span> <span class=nc>CompressionMethod</span>
<span class=p>{</span>
    <span class=n>QuickLZ</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
    <span class=n>LZ4</span>     <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
<span class=p>};</span>
</code></pre></div> <p><strong>15.</strong> 所有名字必须是英文。不允许音译俄语单词。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>not Stroka</span>
</code></pre></div> <p><strong>16.</strong> 缩写须是众所周知的（当您可以在维基百科或搜索引擎中轻松找到缩写的含义时）。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=ss>`AST`</span><span class=p>,</span> <span class=ss>`SQL`</span><span class=p>.</span>

<span class=k>Not</span> <span class=ss>`NVDH`</span> <span class=p>(</span><span class=n>some</span> <span class=n>random</span> <span class=n>letters</span><span class=p>)</span>
</code></pre></div> <p>如果缩短版本是常用的，则可以接受不完整的单词。</p> <p>如果旁边有注释包含全名，您也可以使用缩写。</p> <p><strong>17.</strong> C++ 源码文件名称必须为 <code class=syntax>.cpp</code> 拓展名。 头文件必须为 <code class=syntax>.h</code> 拓展名。</p> <h2 id=ru-he-bian-xie-dai-ma>如何编写代码<a class=headerlink href=#ru-he-bian-xie-dai-ma title="Permanent link"> </a></h2> <p><strong>1.</strong> 内存管理。</p> <p>手动内存释放 (<code class=syntax>delete</code>) 只能在库代码中使用。</p> <p>在库代码中， <code class=syntax>delete</code> 运算符只能在析构函数中使用。</p> <p>在应用程序代码中，内存必须由拥有它的对象释放。</p> <p>示例：</p> <ul> <li>最简单的方法是将对象放在堆栈上，或使其成为另一个类的成员。</li> <li>对于大量小对象，请使用容器。</li> <li>对于自动释放少量在堆中的对象，可以用 <code class=syntax>shared_ptr/unique_ptr</code>。</li> </ul> <p><strong>2.</strong> 资源管理。</p> <p>使用 <code class=syntax>RAII</code> 以及查看以上说明。</p> <p><strong>3.</strong> 错误处理。</p> <p>在大多数情况下，您只需要抛出一个异常，而不需要捕获它（因为<code class=syntax>RAII</code>）。</p> <p>在离线数据处理应用程序中，通常可以接受不捕获异常。</p> <p>在处理用户请求的服务器中，捕获连接处理程序顶层的异常通常就足够了。</p> <p>在线程函数中，你应该在 <code class=syntax>join</code> 之后捕获并保留所有异常以在主线程中重新抛出它们。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>/// If there weren't any calculations yet, calculate the first block synchronously</span>
<span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>started</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>calculate</span><span class=p>();</span>
    <span class=n>started</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
<span class=p>}</span>
<span class=k>else</span> <span class=c1>/// If calculations are already in progress, wait for the result</span>
    <span class=n>pool</span><span class=p>.</span><span class=n>wait</span><span class=p>();</span>

<span class=k>if</span> <span class=p>(</span><span class=n>exception</span><span class=p>)</span>
    <span class=n>exception</span><span class=o>-&gt;</span><span class=n>rethrow</span><span class=p>();</span>
</code></pre></div> <p>不处理就不要隐藏异常。 永远不要盲目地把所有异常都记录到日志中。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//Not correct</span>
<span class=k>catch</span> <span class=p>(...)</span> <span class=p>{}</span>
</code></pre></div> <p>如果您需要忽略某些异常，请仅针对特定异常执行此操作并重新抛出其余异常。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>catch</span> <span class=p>(</span><span class=k>const</span> <span class=n>DB</span><span class=o>::</span><span class=n>Exception</span> <span class=o>&amp;</span> <span class=n>e</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>code</span><span class=p>()</span> <span class=o>==</span> <span class=n>ErrorCodes</span><span class=o>::</span><span class=n>UNKNOWN_AGGREGATE_FUNCTION</span><span class=p>)</span>
        <span class=k>return</span> <span class=k>nullptr</span><span class=p>;</span>
    <span class=k>else</span>
        <span class=k>throw</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>当使用具有返回码或 <code class=syntax>errno</code> 的函数时，请始终检查结果并在出现错误时抛出异常。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>if</span> <span class=p>(</span><span class=mi>0</span> <span class=o>!=</span> <span class=n>close</span><span class=p>(</span><span class=n>fd</span><span class=p>))</span>
    <span class=n>throwFromErrno</span><span class=p>(</span><span class=s>"Cannot close file "</span> <span class=o>+</span> <span class=n>file_name</span><span class=p>,</span> <span class=n>ErrorCodes</span><span class=o>::</span><span class=n>CANNOT_CLOSE_FILE</span><span class=p>);</span>
</code></pre></div> <p><code class=syntax>不要使用断言</code>。</p> <p><strong>4.</strong> 异常类型。</p> <p>不需要在应用程序代码中使用复杂的异常层次结构。 系统管理员应该可以理解异常文本。</p> <p><strong>5.</strong> 从析构函数中抛出异常。</p> <p>不建议这样做，但允许这样做。</p> <p>按照以下选项：</p> <ul> <li>创建一个函数（ <code class=syntax>done（）</code> 或 <code class=syntax>finalize（）</code> ），它将提前完成所有可能导致异常的工作。 如果调用了该函数，则稍后在析构函数中应该没有异常。</li> <li>过于复杂的任务（例如通过网络发送消息）可以放在单独的方法中，类用户必须在销毁之前调用它们。</li> <li>如果析构函数中存在异常，则最好记录它而不是隐藏它（如果 logger 可用）。</li> <li>在简单的应用程序中，依赖于<code class=syntax>std::terminate</code>（对于C++ 11中默认情况下为 <code class=syntax>noexcept</code> 的情况）来处理异常是可以接受的。</li> </ul> <p><strong>6.</strong> 匿名代码块。</p> <p>您可以在单个函数内创建单独的代码块，以使某些变量成为局部变量，以便在退出块时调用析构函数。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>Block</span> <span class=n>block</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=n>in</span><span class=o>-&gt;</span><span class=n>read</span><span class=p>();</span>

<span class=p>{</span>
    <span class=n>std</span><span class=o>::</span><span class=n>lock_guard</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>mutex</span><span class=o>&gt;</span> <span class=n>lock</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span>
    <span class=n>data</span><span class=p>.</span><span class=n>ready</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
    <span class=n>data</span><span class=p>.</span><span class=n>block</span> <span class=o>=</span> <span class=n>block</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>ready_any</span><span class=p>.</span><span class=n>set</span><span class=p>();</span>
</code></pre></div> <p><strong>7.</strong> 多线程。</p> <p>在离线数据处理程序中：</p> <ul> <li>尝试在单个CPU核心上获得最佳性能。 然后，您可以根据需要并行化代码。</li> </ul> <p>在服务端应用中：</p> <ul> <li>使用线程池来处理请求。 此时，我们还没有任何需要用户空间上下文切换的任务。</li> </ul> <p>Fork不用于并行化。</p> <p><strong>8.</strong> 同步线程。</p> <p>通常可以使不同的线程使用不同的存储单元（甚至更好：不同的缓存线），并且不使用任何线程同步（除了<code class=syntax>joinAll</code>）。</p> <p>如果需要同步，在大多数情况下，在 <code class=syntax>lock_guard</code> 下使用互斥量就足够了。</p> <p>在其他情况下，使用系统同步原语。不要使用忙等待。</p> <p>仅在最简单的情况下才应使用原子操作。</p> <p>除非是您的主要专业领域，否则不要尝试实施无锁数据结构。</p> <p><strong>9.</strong> 指针和引用。</p> <p>大部分情况下，请用引用。</p> <p><strong>10.</strong> 常量。</p> <p>使用 const 引用、指针，指向常量、<code class=syntax>const_iterator</code>和 const 方法。</p> <p>将 <code class=syntax>const</code> 视为默认值，仅在必要时使用非 <code class=syntax>const</code>。</p> <p>当按值传递变量时，使用 <code class=syntax>const</code> 通常没有意义。</p> <p><strong>11.</strong> 无符号。</p> <p>必要时使用<code class=syntax>unsigned</code>。</p> <p><strong>12.</strong> 数值类型。</p> <p>使用 <code class=syntax>UInt8</code>， <code class=syntax>UInt16</code>， <code class=syntax>UInt32</code>， <code class=syntax>UInt64</code>， <code class=syntax>Int8</code>， <code class=syntax>Int16</code>， <code class=syntax>Int32</code> 和 <code class=syntax>Int64</code>，同样还有 <code class=syntax>size_t</code>， <code class=syntax>ssize_t</code> 和 <code class=syntax>ptrdiff_t</code>。</p> <p>不要使用这些类型：<code class=syntax>signed / unsigned long</code>，<code class=syntax>long long</code>，<code class=syntax>short</code>，<code class=syntax>signed / unsigned char</code>，<code class=syntax>char</code>。</p> <p><strong>13.</strong> 参数传递。</p> <p>通过引用传递复杂类型 （包括 <code class=syntax>std::string</code>）。</p> <p>如果函数中传递堆中创建的对象，则使参数类型为 <code class=syntax>shared_ptr</code> 或者 <code class=syntax>unique_ptr</code>.</p> <p><strong>14.</strong> 返回值</p> <p>大部分情况下使用 <code class=syntax>return</code>。不要使用 <code class=syntax>return std::move(res)</code>。</p> <p>如果函数在堆上分配对象并返回它，请使用 <code class=syntax>shared_ptr</code> 或 <code class=syntax>unique_ptr</code>。</p> <p>在极少数情况下，您可能需要通过参数返回值。 在这种情况下，参数应该是引用传递的。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>using</span> <span class=n>AggregateFunctionPtr</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>IAggregateFunction</span><span class=o>&gt;</span><span class=p>;</span>

<span class=cm>/** Allows creating an aggregate function by its name.</span>
<span class=cm>  */</span>
<span class=k>class</span> <span class=nc>AggregateFunctionFactory</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>AggregateFunctionFactory</span><span class=p>();</span>
    <span class=n>AggregateFunctionPtr</span> <span class=nf>get</span><span class=p>(</span><span class=k>const</span> <span class=n>String</span> <span class=o>&amp;</span> <span class=n>name</span><span class=p>,</span> <span class=k>const</span> <span class=n>DataTypes</span> <span class=o>&amp;</span> <span class=n>argument_types</span><span class=p>)</span> <span class=k>const</span><span class=p>;</span>
</code></pre></div> <p><strong>15.</strong> 命名空间。</p> <p>没有必要为应用程序代码使用单独的 <code class=syntax>namespace</code> 。</p> <p>小型库也不需要这个。</p> <p>对于中大型库，须将所有代码放在 <code class=syntax>namespace</code> 中。</p> <p>在库的 <code class=syntax>.h</code> 文件中，您可以使用 <code class=syntax>namespace detail</code> 来隐藏应用程序代码不需要的实现细节。</p> <p>在 <code class=syntax>.cpp</code> 文件中，您可以使用 <code class=syntax>static</code> 或匿名命名空间来隐藏符号。</p> <p>同样 <code class=syntax>namespace</code> 可用于 <code class=syntax>enum</code> 以防止相应的名称落入外部 <code class=syntax>namespace</code>（但最好使用<code class=syntax>enum class</code>）。</p> <p><strong>16.</strong> 延迟初始化。</p> <p>如果初始化需要参数，那么通常不应该编写默认构造函数。</p> <p>如果稍后您需要延迟初始化，则可以添加将创建无效对象的默认构造函数。 或者，对于少量对象，您可以使用 <code class=syntax>shared_ptr / unique_ptr</code>。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>Loader</span><span class=p>(</span><span class=n>DB</span><span class=o>::</span><span class=n>Connection</span> <span class=o>*</span> <span class=n>connection_</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=o>&amp;</span> <span class=n>query</span><span class=p>,</span> <span class=kt>size_t</span> <span class=n>max_block_size_</span><span class=p>);</span>

<span class=c1>/// For deferred initialization</span>
<span class=n>Loader</span><span class=p>()</span> <span class=p>{}</span>
</code></pre></div> <p><strong>17.</strong> 虚函数。</p> <p>如果该类不是用于多态使用，则不需要将函数设置为虚拟。这也适用于析构函数。</p> <p><strong>18.</strong> 编码。</p> <p>在所有情况下使用 UTF-8 编码。使用 <code class=syntax>std::string</code> 和 <code class=syntax>char *</code>。不要使用 <code class=syntax>std::wstring</code> 和 <code class=syntax>wchar_t</code>。</p> <p><strong>19.</strong> 日志。</p> <p>请参阅代码中的示例。</p> <p>在提交之前，删除所有无意义和调试日志记录，以及任何其他类型的调试输出。</p> <p>应该避免循环记录日志，即使在 Trace 级别也是如此。</p> <p>日志必须在任何日志记录级别都可读。</p> <p>在大多数情况下，只应在应用程序代码中使用日志记录。</p> <p>日志消息必须用英文写成。</p> <p>对于系统管理员来说，日志最好是可以理解的。</p> <p>不要在日志中使用亵渎语言。</p> <p>在日志中使用UTF-8编码。 在极少数情况下，您可以在日志中使用非ASCII字符。</p> <p><strong>20.</strong> 输入-输出。</p> <p>不要使用 <code class=syntax>iostreams</code> 在对应用程序性能至关重要的内部循环中（并且永远不要使用 <code class=syntax>stringstream</code> ）。</p> <p>使用 <code class=syntax>DB/IO</code> 库替代。</p> <p><strong>21.</strong> 日期和时间。</p> <p>参考 <code class=syntax>DateLUT</code> 库。</p> <p><strong>22.</strong> 引入头文件。</p> <p>一直用 <code class=syntax>#pragma once</code> 而不是其他宏。</p> <p><strong>23.</strong> using 语法</p> <p><code class=syntax>using namespace</code> 不会被使用。 您可以使用特定的 <code class=syntax>using</code>。 但是在类或函数中使它成为局部的。</p> <p><strong>24.</strong> 不要使用 <code class=syntax>trailing return type</code> 为必要的功能。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>auto</span> <span class=n>f</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kt>void</span>
</code></pre></div> <p><strong>25.</strong> 声明和初始化变量。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1>//right way</span>
<span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span> <span class=o>=</span> <span class=s>"Hello"</span><span class=p>;</span>
<span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>{</span><span class=s>"Hello"</span><span class=p>};</span>

<span class=c1>//wrong way</span>
<span class=k>auto</span> <span class=n>s</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>"Hello"</span><span class=p>};</span>
</code></pre></div> <p><strong>26.</strong> 对于虚函数，在基类中编写 <code class=syntax>virtual</code>，但在后代类中写 <code class=syntax>override</code> 而不是<code class=syntax>virtual</code>。</p> <h2 id=mei-you-yong-dao-de-c-te-xing>没有用到的 C++ 特性。<a class=headerlink href=#mei-you-yong-dao-de-c-te-xing title="Permanent link"> </a></h2> <p><strong>1.</strong> 不使用虚拟继承。</p> <p><strong>2.</strong> 不使用 C++03 中的异常标准。</p> <h2 id=ping-tai>平台<a class=headerlink href=#ping-tai title="Permanent link"> </a></h2> <p><strong>1.</strong> 我们为特定平台编写代码。</p> <p>但在其他条件相同的情况下，首选跨平台或可移植代码。</p> <p><strong>2.</strong> 语言： C++20.</p> <p><strong>3.</strong> 编译器： <code class=syntax>gcc</code>。 此时（2020年08月），代码使用9.3版编译。（它也可以使用<code class=syntax>clang 8</code> 编译）</p> <p>使用标准库 (<code class=syntax>libc++</code>)。</p> <p><strong>4.</strong> 操作系统：Linux Ubuntu，不比 Precise 早。</p> <p><strong>5.</strong> 代码是为x86_64 CPU架构编写的。</p> <p>CPU指令集是我们服务器中支持的最小集合。 目前，它是SSE 4.2。</p> <p><strong>6.</strong> 使用 <code class=syntax>-Wall -Wextra -Werror</code> 编译参数。</p> <p><strong>7.</strong> 对所有库使用静态链接，除了那些难以静态连接的库（参见 <code class=syntax>ldd</code> 命令的输出）.</p> <p><strong>8.</strong> 使用发布的设置来开发和调试代码。</p> <h2 id=gong-ju>工具<a class=headerlink href=#gong-ju title="Permanent link"> </a></h2> <p><strong>1.</strong> KDevelop 是一个好的 IDE.</p> <p><strong>2.</strong> 调试可以使用 <code class=syntax>gdb</code>， <code class=syntax>valgrind</code> (<code class=syntax>memcheck</code>)， <code class=syntax>strace</code>， <code class=syntax>-fsanitize=...</code>， 或 <code class=syntax>tcmalloc_minimal_debug</code>.</p> <p><strong>3.</strong> 对于性能分析，使用 <code class=syntax>Linux Perf</code>， <code class=syntax>valgrind</code> (<code class=syntax>callgrind</code>)，或者 <code class=syntax>strace -cf</code>。</p> <p><strong>4.</strong> 源代码用 Git 作版本控制。</p> <p><strong>5.</strong> 使用 <code class=syntax>CMake</code> 构建。</p> <p><strong>6.</strong> 程序的发布使用 <code class=syntax>deb</code> 安装包。</p> <p><strong>7.</strong> 提交到 master 分支的代码不能破坏编译。</p> <p>虽然只有选定的修订被认为是可行的。</p> <p><strong>8.</strong> 尽可能经常地进行提交，即使代码只是部分准备好了。</p> <p>为了这种目的可以创建分支。</p> <p>如果您的代码在 <code class=syntax>master</code> 分支中尚不可构建，在 <code class=syntax>push</code> 之前需要将其从构建中排除。您需要在几天内完成或删除它。</p> <p><strong>9.</strong> 对于非一般的更改，请使用分支并在服务器上发布它们。</p> <p><strong>10.</strong> 未使用的代码将从 repo 中删除。</p> <h2 id=ku>库<a class=headerlink href=#ku title="Permanent link"> </a></h2> <p><strong>1.</strong> 使用C++20标准库（允许实验性功能），以及 <code class=syntax>boost</code> 和 <code class=syntax>Poco</code> 框架。</p> <p><strong>2.</strong> 如有必要，您可以使用 OS 包中提供的任何已知库。</p> <p>如果有一个好的解决方案已经可用，那就使用它，即使这意味着你必须安装另一个库。</p> <p>（但要准备从代码中删除不好的库）</p> <p><strong>3.</strong> 如果软件包没有您需要的软件包或者有过时的版本或错误的编译类型，则可以安装不在软件包中的库。</p> <p><strong>4.</strong> 如果库很小并且没有自己的复杂构建系统，请将源文件放在 <code class=syntax>contrib</code> 文件夹中。</p> <p><strong>5.</strong> 始终优先考虑已经使用的库。</p> <h2 id=yi-ban-jian-yi-1>一般建议<a class=headerlink href=#yi-ban-jian-yi-1 title="Permanent link"> </a></h2> <p><strong>1.</strong> 尽可能精简代码。</p> <p><strong>2.</strong> 尝试用最简单的方式实现。</p> <p><strong>3.</strong> 在你知道代码是如何工作以及内部循环如何运作之前，不要编写代码。</p> <p><strong>4.</strong> 在最简单的情况下，使用 <code class=syntax>using</code> 而不是类或结构。</p> <p><strong>5.</strong> 如果可能，不要编写复制构造函数，赋值运算符，析构函数（虚拟函数除外，如果类包含至少一个虚函数），移动构造函数或移动赋值运算符。 换句话说，编译器生成的函数必须正常工作。 您可以使用 <code class=syntax>default</code>。</p> <p><strong>6.</strong> 鼓励简化代码。 尽可能减小代码的大小。</p> <h2 id=qi-ta-jian-yi>其他建议<a class=headerlink href=#qi-ta-jian-yi title="Permanent link"> </a></h2> <p><strong>1.</strong> 从 <code class=syntax>stddef.h</code> 明确指定 <code class=syntax>std ::</code> 的类型。</p> <p>不推荐。 换句话说，我们建议写 <code class=syntax>size_t</code> 而不是 <code class=syntax>std::size_t</code>，因为它更短。</p> <p>也接受添加 <code class=syntax>std::</code>。</p> <p><strong>2.</strong> 为标准C库中的函数明确指定 <code class=syntax>std::</code></p> <p>不推荐。换句话说，写 <code class=syntax>memcpy</code> 而不是<code class=syntax>std::memcpy</code>。</p> <p>原因是有类似的非标准功能，例如 <code class=syntax>memmem</code>。我们偶尔会使用这些功能。<code class=syntax>namespace std</code>中不存在这些函数。</p> <p>如果你到处都写 <code class=syntax>std::memcpy</code> 而不是 <code class=syntax>memcpy</code>，那么没有 <code class=syntax>std::</code> 的 <code class=syntax>memmem</code> 会显得很奇怪。</p> <p>不过，如果您愿意，仍然可以使用 <code class=syntax>std::</code>。</p> <p><strong>3.</strong> 当标准C++库中提供相同的函数时，使用C中的函数。</p> <p>如果它更高效，这是可以接受的。</p> <p>例如，使用<code class=syntax>memcpy</code>而不是<code class=syntax>std::copy</code>来复制大块内存。</p> <p><strong>4.</strong> 函数的多行参数。</p> <p>允许以下任何包装样式：</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>function</span><span class=p>(</span>
  <span class=n>T1</span> <span class=n>x1</span><span class=p>,</span>
  <span class=n>T2</span> <span class=n>x2</span><span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>function</span><span class=p>(</span>
  <span class=kt>size_t</span> <span class=n>left</span><span class=p>,</span> <span class=kt>size_t</span> <span class=n>right</span><span class=p>,</span>
  <span class=k>const</span> <span class=o>&amp;</span> <span class=n>RangesInDataParts</span> <span class=n>ranges</span><span class=p>,</span>
  <span class=kt>size_t</span> <span class=n>limit</span><span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>function</span><span class=p>(</span><span class=kt>size_t</span> <span class=n>left</span><span class=p>,</span> <span class=kt>size_t</span> <span class=n>right</span><span class=p>,</span>
  <span class=k>const</span> <span class=o>&amp;</span> <span class=n>RangesInDataParts</span> <span class=n>ranges</span><span class=p>,</span>
  <span class=kt>size_t</span> <span class=n>limit</span><span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>function</span><span class=p>(</span><span class=kt>size_t</span> <span class=n>left</span><span class=p>,</span> <span class=kt>size_t</span> <span class=n>right</span><span class=p>,</span>
      <span class=k>const</span> <span class=o>&amp;</span> <span class=n>RangesInDataParts</span> <span class=n>ranges</span><span class=p>,</span>
      <span class=kt>size_t</span> <span class=n>limit</span><span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>function</span><span class=p>(</span>
      <span class=kt>size_t</span> <span class=n>left</span><span class=p>,</span>
      <span class=kt>size_t</span> <span class=n>right</span><span class=p>,</span>
      <span class=k>const</span> <span class=o>&amp;</span> <span class=n>RangesInDataParts</span> <span class=n>ranges</span><span class=p>,</span>
      <span class=kt>size_t</span> <span class=n>limit</span><span class=p>)</span>
</code></pre></div> <p><a href=https://clickhouse.tech/docs/en/development/style/ target=_blank>来源文章</a> <!--hide--></p> </div> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Was this content helpful?</span> <div id=rating-stars class="display-6 mb-0" data-titles="['Unusable', 'Poor', 'OK', 'Good', 'Excellent']" data-documentation=documentation>RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Table of Contents</label> <a href=#yi-ban-jian-yi title=一般建议 class="nav-link text-wrap d-inline-block w-100"> 一般建议 </a> <a href=#ge-shi-hua title=格式化 class="nav-link text-wrap d-inline-block w-100"> 格式化 </a> <a href=#comments title=评论 class="nav-link text-wrap d-inline-block w-100"> 评论 </a> <a href=#names title=姓名 class="nav-link text-wrap d-inline-block w-100"> 姓名 </a> <a href=#ru-he-bian-xie-dai-ma title=如何编写代码 class="nav-link text-wrap d-inline-block w-100"> 如何编写代码 </a> <a href=#mei-you-yong-dao-de-c-te-xing title="没有用到的 C++ 特性。" class="nav-link text-wrap d-inline-block w-100"> 没有用到的 C++ 特性。 </a> <a href=#ping-tai title=平台 class="nav-link text-wrap d-inline-block w-100"> 平台 </a> <a href=#gong-ju title=工具 class="nav-link text-wrap d-inline-block w-100"> 工具 </a> <a href=#ku title=库 class="nav-link text-wrap d-inline-block w-100"> 库 </a> <a href=#yi-ban-jian-yi-1 title=一般建议 class="nav-link text-wrap d-inline-block w-100"> 一般建议 </a> <a href=#qi-ta-jian-yi title=其他建议 class="nav-link text-wrap d-inline-block w-100"> 其他建议 </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?00223b07></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>