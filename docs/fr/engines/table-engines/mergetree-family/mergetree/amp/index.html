<!doctype html><html ⚡ lang=fr> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>MergeTree | Documentation ClickHouse</title><link href=https://clickhouse.tech/docs/fr/engines/table-engines/mergetree-family/mergetree/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "MergeTree | Documentation ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/fr/engines/table-engines/mergetree-family/mergetree/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "MergeTree | Documentation ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer,header,main,section{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b,strong{font-weight:bolder}sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}th{text-align:inherit}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item;cursor:pointer}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.lead{font-size:1.25rem;font-weight:300}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-last{-ms-flex-order:13;order:13}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-last{-ms-flex-order:13;order:13}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-last{-ms-flex-order:13;order:13}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}}.table{width:100%;margin-bottom:1rem;color:#212529}.table td,.table th{padding:.75rem;vertical-align:top;border-top:1px solid #dee2e6}.table thead th{vertical-align:bottom;border-bottom:2px solid #dee2e6}.table tbody+tbody{border-top:2px solid #dee2e6}.table-primary,.table-primary>td,.table-primary>th{background-color:#b8daff}.table-primary tbody+tbody,.table-primary td,.table-primary th,.table-primary thead th{border-color:#7abaff}.table-info,.table-info>td,.table-info>th{background-color:#bee5eb}.table-info tbody+tbody,.table-info td,.table-info th,.table-info thead th{border-color:#86cfda}.table-warning,.table-warning>td,.table-warning>th{background-color:#ffeeba}.table-warning tbody+tbody,.table-warning td,.table-warning th,.table-warning thead th{border-color:#ffdf7e}.table-light,.table-light>td,.table-light>th{background-color:#fdfdfe}.table-light tbody+tbody,.table-light td,.table-light th,.table-light thead th{border-color:#fbfcfc}.table-dark,.table-dark>td,.table-dark>th{background-color:#c6c8ca}.table-dark tbody+tbody,.table-dark td,.table-dark th,.table-dark thead th{border-color:#95999c}.table .thead-dark th{color:#fff;background-color:#343a40;border-color:#454d55}.table .thead-light th{color:#495057;background-color:#e9ecef;border-color:#dee2e6}.table-dark{color:#fff;background-color:#343a40}.table-dark td,.table-dark th,.table-dark thead th{border-color:#454d55}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-primary{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:hover{color:#fff;background-color:#0069d9;border-color:#0062cc}.btn-primary:focus{color:#fff;background-color:#0069d9;border-color:#0062cc;box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-primary:disabled{color:#fff;background-color:#007bff;border-color:#007bff}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info:focus{color:#fff;background-color:#138496;border-color:#117a8b;box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-primary{color:#007bff;border-color:#007bff}.btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-primary:disabled{color:#007bff;background-color:transparent}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:-ms-inline-flexbox;display:inline-flex;margin-right:1rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#004085;background-color:#cce5ff;border-color:#b8daff}.alert-primary .alert-link{color:#002752}.alert-info{color:#0c5460;background-color:#d1ecf1;border-color:#bee5eb}.alert-info .alert-link{color:#062c33}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#007bff}a.bg-primary:focus,a.bg-primary:hover{background-color:#0062cc}.bg-info{background-color:#17a2b8}a.bg-info:focus,a.bg-info:hover{background-color:#117a8b}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.shadow{box-shadow:0 .5rem 1rem rgba(0,0,0,.15)}.shadow-lg{box-shadow:0 1rem 3rem rgba(0,0,0,.175)}.shadow-none{box-shadow:none}.w-25{width:25%}.w-50{width:50%}.w-75{width:75%}.w-100{width:100%}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.m-0{margin:0}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.m-1{margin:.25rem}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.m-2{margin:.5rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.m-3{margin:1rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.m-4{margin:1.5rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.m-5{margin:3rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pr-0{padding-right:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pr-1{padding-right:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pr-2{padding-right:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pr-3{padding-right:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pr-4{padding-right:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pr-5{padding-right:3rem}.pb-5,.py-5{padding-bottom:3rem}.m-n1{margin:-.25rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.m-n2{margin:-.5rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.m-n3{margin:-1rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.m-n4{margin:-1.5rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.m-n5{margin:-3rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.m-md-0{margin:0}.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.m-md-1{margin:.25rem}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.m-md-2{margin:.5rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.m-md-3{margin:1rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.m-md-4{margin:1.5rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.m-md-5{margin:3rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pr-md-0{padding-right:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pr-md-1{padding-right:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pr-md-2{padding-right:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pr-md-3{padding-right:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pr-md-4{padding-right:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pr-md-5{padding-right:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.m-md-n1{margin:-.25rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.m-md-n2{margin:-.5rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.m-md-n3{margin:-1rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.m-md-n4{margin:-1.5rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.m-md-n5{margin:-3rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.m-lg-0{margin:0}.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.m-lg-1{margin:.25rem}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.m-lg-2{margin:.5rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.m-lg-3{margin:1rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.m-lg-4{margin:1.5rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.m-lg-5{margin:3rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pr-lg-0{padding-right:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pr-lg-1{padding-right:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pr-lg-2{padding-right:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pr-lg-3{padding-right:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pr-lg-4{padding-right:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pr-lg-5{padding-right:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.m-lg-n1{margin:-.25rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.m-lg-n2{margin:-.5rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.m-lg-n3{margin:-1rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.m-lg-n4{margin:-1.5rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.m-lg-n5{margin:-3rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#007bff}a.text-primary:focus,a.text-primary:hover{color:#0056b3}.text-info{color:#17a2b8}a.text-info:focus,a.text-info:hover{color:#0f6674}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table td,.table th{background-color:#fff}.table-dark{color:inherit}.table-dark tbody+tbody,.table-dark td,.table-dark th,.table-dark thead th{border-color:#dee2e6}.table .thead-dark th{color:inherit;border-color:#dee2e6}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.w-15{width:15%}details{background:#444451;color:#eee;padding:1rem;margin-bottom:1rem;margin-top:1rem}summary{font-weight:700;color:#eee}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content thead{background:#444451;color:#fff}#content td,#content th{padding:.75rem;vertical-align:top}#content td{border:1px solid #dee2e6}#content th{border:1px solid #444451}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre,td,th,thead,tr{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content thead{background:#333}#content td{border:1px solid #444451}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .k{color:#000;font-weight:700}.syntax .l{color:#08f}.syntax .n{color:#2f1e2e}.syntax .o{color:#800}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .ld{color:#48b685}.syntax .m{color:#08f}.syntax .s{color:#48b685}.syntax .nb{color:#2f1e2e}.syntax .nc{color:#fec418}.syntax .no{color:#ef6155}.syntax .ne{color:#ef6155}.syntax .nl{color:#2f1e2e}.syntax .py{color:#2f1e2e}.syntax .nt{color:#5bc4bf}.syntax .w{color:#2f1e2e}.syntax .mi{color:#08f}.syntax .s2{color:#48b685}.syntax .se{color:#08f}.syntax .si{color:#08f}.syntax .s1{color:#080}.syntax .il{color:#08f}@media(prefers-color-scheme:dark){.syntax .k{color:#c78cff}.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .nb{color:#f8f9fa}.syntax .nl{color:#f8f9fa}.syntax .py{color:#f8f9fa}.syntax .w{color:#f8f9fa}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <div class="alert alert-primary" role=alert> <p class="display-5 mb-2">Help wanted!</p> <p class=lead>The following content of this documentation page has been machine-translated. But unlike other websites, it is not done on the fly. This translated text lives on GitHub repository alongside main ClickHouse codebase and waits for fellow native speakers to make it more human-readable. <a href=/docs/en/engines/table-engines/mergetree-family/mergetree/ class=alert-link>You can also use the original English version as a reference.</a></p> <p class=lead> <a class="btn btn-lg btn-primary text-white" href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/fr/engines/table-engines/mergetree-family/mergetree.md target=_blank rel="external nofollow noreferrer"> Help ClickHouse documentation by editing this page </a> </p> </div> <h1 id=table_engines-mergetree>MergeTree<a class=headerlink href=../amp/#table_engines-mergetree title="Permanent link"> </a></h1> <p>Le <code class=syntax>MergeTree</code> moteur et autres moteurs de cette famille (<code class=syntax>*MergeTree</code>) sont les moteurs de table ClickHouse les plus robustes.</p> <p>Les moteurs de la <code class=syntax>MergeTree</code> famille sont conçus pour l'insertion d'une très grande quantité de données dans une table. Les données sont rapidement écrites dans la table partie par partie, puis des règles sont appliquées pour fusionner les parties en arrière-plan. Cette méthode est beaucoup plus efficace que de réécrire continuellement les données dans le stockage pendant l'insertion.</p> <p>Principales caractéristiques:</p> <ul> <li> <p>Stocke les données triées par clé primaire.</p> <p>Cela vous permet de créer un petit index clairsemé qui aide à trouver les données plus rapidement.</p> </li> <li> <p>Les Partitions peuvent être utilisées si <a href=../../custom-partitioning-key/amp/ >clé de partitionnement</a> est spécifié.</p> <p>ClickHouse prend en charge certaines opérations avec des partitions plus efficaces que les opérations générales sur les mêmes données avec le même résultat. ClickHouse Coupe également automatiquement les données de partition où la clé de partitionnement est spécifiée dans la requête. Cela améliore également les performances de la requête.</p> </li> <li> <p>Prise en charge de la réplication des données.</p> <p>La famille de <code class=syntax>ReplicatedMergeTree</code> tables fournit la réplication des données. Pour plus d'informations, voir <a href=../../replication/amp/ >Réplication des données</a>.</p> </li> <li> <p>Appui d'échantillonnage de données.</p> <p>Si nécessaire, vous pouvez définir la méthode d'échantillonnage des données dans le tableau.</p> </li> </ul> <div class="admonition info alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Info</p> <p>Le <a class=alert-link href=../../../special/merge/amp/#merge>Fusionner</a> le moteur n'appartient pas à la <code class=syntax>*MergeTree</code> famille.</p> </div> <h2 id=table_engine-mergetree-creating-a-table>Création d'une Table<a class=headerlink href=../amp/#table_engine-mergetree-creating-a-table title="Permanent link"> </a></h2> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>index_name1</span> <span class=n>expr1</span> <span class=k>TYPE</span> <span class=n>type1</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value1</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>index_name2</span> <span class=n>expr2</span> <span class=k>TYPE</span> <span class=n>type2</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value2</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>[</span><span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>ORDER</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>TTL</span> <span class=n>expr</span> <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'xxx'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'xxx'</span><span class=p>],</span> <span class=p>...]</span>
<span class=p>[</span><span class=n>SETTINGS</span> <span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=p>...]</span>
</code></pre></div> <p>Pour une description des paramètres, voir <a href=../../../../../sql-reference/statements/create/amp/ >Créer une description de requête</a>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p><code class=syntax>INDEX</code> est une fonctionnalité expérimentale, voir <a class=alert-link href=../amp/#table_engine-mergetree-data_skipping-indexes>Index De Saut De Données</a>.</p> </div> <h3 id=mergetree-query-clauses>Les Clauses De Requête<a class=headerlink href=../amp/#mergetree-query-clauses title="Permanent link"> </a></h3> <ul> <li> <p><code class=syntax>ENGINE</code> — Name and parameters of the engine. <code class=syntax>ENGINE = MergeTree()</code>. Le <code class=syntax>MergeTree</code> le moteur n'a pas de paramètres.</p> </li> <li> <p><code class=syntax>PARTITION BY</code> — The <a href=../../custom-partitioning-key/amp/ >clé de partitionnement</a>.</p> <p>Pour le partitionnement par mois, utilisez les <code class=syntax>toYYYYMM(date_column)</code> l'expression, où <code class=syntax>date_column</code> est une colonne avec une date du type <a href=../../../../../sql-reference/data-types/date/amp/ >Date</a>. Les noms de partition ici ont le <code class=syntax>"YYYYMM"</code> format.</p> </li> <li> <p><code class=syntax>ORDER BY</code> — The sorting key.</p> <p>Un tuple de colonnes ou d'expressions arbitraires. Exemple: <code class=syntax>ORDER BY (CounterID, EventDate)</code>.</p> </li> <li> <p><code class=syntax>PRIMARY KEY</code> — The primary key if it <a href=../amp/#choosing-a-primary-key-that-differs-from-the-sorting-key>diffère de la clé de tri</a>.</p> <p>Par défaut, la clé primaire est la même que la clé de tri (qui est spécifiée par <code class=syntax>ORDER BY</code> clause). Ainsi dans la plupart des cas il n'est pas nécessaire de spécifier un <code class=syntax>PRIMARY KEY</code> clause.</p> </li> <li> <p><code class=syntax>SAMPLE BY</code> — An expression for sampling.</p> <p>Si un échantillonnage expression est utilisée, la clé primaire doit contenir. Exemple: <code class=syntax>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p> </li> <li> <p><code class=syntax>TTL</code> — A list of rules specifying storage duration of rows and defining logic of automatic parts movement <a href=../amp/#table_engine-mergetree-multiple-volumes>entre disques et volumes</a>.</p> <p>L'Expression doit en avoir une <code class=syntax>Date</code> ou <code class=syntax>DateTime</code> colonne comme un résultat. Exemple:<br> <code class=syntax>TTL date + INTERVAL 1 DAY</code></p> <p>Le Type de la règle <code class=syntax>DELETE|TO DISK 'xxx'|TO VOLUME 'xxx'</code> spécifie une action à effectuer avec la partie si l'expression est satisfaite (atteint l'heure actuelle): suppression des Lignes expirées, déplacement d'une partie (si l'expression est satisfaite pour toutes les lignes d'une partie) sur le disque spécifié (<code class=syntax>TO DISK 'xxx'</code>) ou de volume (<code class=syntax>TO VOLUME 'xxx'</code>). Le type par défaut de la règle est suppression (<code class=syntax>DELETE</code>). Liste de règles multiples peut spécifié, mais il ne devrait pas y avoir plus d'un <code class=syntax>DELETE</code> règle.</p> <p>Pour plus de détails, voir <a href=../amp/#table_engine-mergetree-ttl>TTL pour les colonnes et les tableaux</a></p> </li> <li> <p><code class=syntax>SETTINGS</code> — Additional parameters that control the behavior of the <code class=syntax>MergeTree</code>:</p> <ul> <li><code class=syntax>index_granularity</code> — Maximum number of data rows between the marks of an index. Default value: 8192. See <a href=../amp/#mergetree-data-storage>Le Stockage De Données</a>.</li> <li><code class=syntax>index_granularity_bytes</code> — Maximum size of data granules in bytes. Default value: 10Mb. To restrict the granule size only by number of rows, set to 0 (not recommended). See <a href=../amp/#mergetree-data-storage>Le Stockage De Données</a>.</li> <li><code class=syntax>enable_mixed_granularity_parts</code> — Enables or disables transitioning to control the granule size with the <code class=syntax>index_granularity_bytes</code> paramètre. Avant la version 19.11, il n'y avait que le <code class=syntax>index_granularity</code> réglage pour restreindre la taille des granules. Le <code class=syntax>index_granularity_bytes</code> le paramètre améliore les performances de ClickHouse lors de la sélection de données à partir de tables avec de grandes lignes (des dizaines et des centaines de mégaoctets). Si vous avez des tables avec de grandes lignes, vous pouvez activer ce paramètre pour les tables d'améliorer l'efficacité de <code class=syntax>SELECT</code> requête.</li> <li><code class=syntax>use_minimalistic_part_header_in_zookeeper</code> — Storage method of the data parts headers in ZooKeeper. If <code class=syntax>use_minimalistic_part_header_in_zookeeper=1</code>, puis Zookeeper stocke moins de données. Pour plus d'informations, voir le <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server-settings-use_minimalistic_part_header_in_zookeeper>Description du réglage</a> dans “Server configuration parameters”.</li> <li><code class=syntax>min_merge_bytes_to_use_direct_io</code> — The minimum data volume for merge operation that is required for using direct I/O access to the storage disk. When merging data parts, ClickHouse calculates the total storage volume of all the data to be merged. If the volume exceeds <code class=syntax>min_merge_bytes_to_use_direct_io</code> octets, ClickHouse lit et écrit les données sur le disque de stockage en utilisant l'interface d'E/S directe (<code class=syntax>O_DIRECT</code> option). Si <code class=syntax>min_merge_bytes_to_use_direct_io = 0</code>, puis les e/s directes sont désactivées. Valeur par défaut: <code class=syntax>10 * 1024 * 1024 * 1024</code> octet.<br> <a name=mergetree_setting-merge_with_ttl_timeout></a></li> <li><code class=syntax>merge_with_ttl_timeout</code> — Minimum delay in seconds before repeating a merge with TTL. Default value: 86400 (1 day).</li> <li><code class=syntax>write_final_mark</code> — Enables or disables writing the final index mark at the end of data part (after the last byte). Default value: 1. Don't turn it off.</li> <li><code class=syntax>merge_max_block_size</code> — Maximum number of rows in block for merge operations. Default value: 8192.</li> <li><code class=syntax>storage_policy</code> — Storage policy. See <a href=../amp/#table_engine-mergetree-multiple-volumes>Utilisation de plusieurs périphériques de bloc pour le stockage de données</a>.</li> </ul> </li> </ul> <p><strong>Exemple de réglage des Sections</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span> <span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>))</span> <span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>index_granularity</span><span class=o>=</span><span class=mi>8192</span>
</code></pre></div> <p>Dans l'exemple, nous définissons le partitionnement par mois.</p> <p>Nous définissons également une expression pour l'échantillonnage en tant que hachage par l'ID utilisateur. Cela vous permet de pseudorandomiser les données dans la table pour chaque <code class=syntax>CounterID</code> et <code class=syntax>EventDate</code>. Si vous définissez un <a href=../../../../../sql-reference/statements/select/sample/amp/#select-sample-clause>SAMPLE</a> clause lors de la sélection des données, ClickHouse retournera un échantillon de données uniformément pseudo-aléatoire pour un sous-ensemble d'utilisateurs.</p> <p>Le <code class=syntax>index_granularity</code> paramètre peut être omis, car 8192 est la valeur par défaut.</p> <details><summary>Méthode obsolète pour créer une Table</summary> <p></p> <div class="admonition attention alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Attention</p> <p>N'utilisez pas cette méthode dans les nouveaux projets. Si possible, optez anciens projets à la méthode décrite ci-dessus.</p> </div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=p>[</span><span class=o>=</span><span class=p>]</span> <span class=n>MergeTree</span><span class=p>(</span><span class=nb>date</span><span class=o>-</span><span class=k>column</span> <span class=p>[,</span> <span class=n>sampling_expression</span><span class=p>],</span> <span class=p>(</span><span class=k>primary</span><span class=p>,</span> <span class=k>key</span><span class=p>),</span> <span class=n>index_granularity</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètres MergeTree ()</strong></p> <ul> <li><code class=syntax>date-column</code> — The name of a column of the <a href=../../../../../sql-reference/data-types/date/amp/ >Date</a> type. ClickHouse crée automatiquement des partitions par mois en fonction de cette colonne. Les noms de partition sont dans le <code class=syntax>"YYYYMM"</code> format.</li> <li><code class=syntax>sampling_expression</code> — An expression for sampling.</li> <li><code class=syntax>(primary, key)</code> — Primary key. Type: <a href=../../../../../sql-reference/data-types/tuple/amp/ >Tuple()</a></li> <li><code class=syntax>index_granularity</code> — The granularity of an index. The number of data rows between the “marks” d'un index. La valeur 8192 est appropriée pour la plupart des tâches.</li> </ul> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>MergeTree</span><span class=p>(</span><span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)),</span> <span class=mi>8192</span><span class=p>)</span>
</code></pre></div> <p>Le <code class=syntax>MergeTree</code> le moteur est configuré de la même manière que dans l'exemple ci-dessus pour la méthode de configuration du moteur principal.</p> </details> <h2 id=mergetree-data-storage>Le Stockage De Données<a class=headerlink href=../amp/#mergetree-data-storage title="Permanent link"> </a></h2> <p>Une table se compose de parties de données triées par clé primaire.</p> <p>Lorsque des données sont insérées dans une table, des parties de données distinctes sont créées et chacune d'elles est lexicographiquement triée par clé primaire. Par exemple, si la clé primaire est <code class=syntax>(CounterID, Date)</code>, les données de la pièce sont triées par <code class=syntax>CounterID</code> et au sein de chaque <code class=syntax>CounterID</code> il est commandé par <code class=syntax>Date</code>.</p> <p>Les données appartenant à différentes partitions sont séparés en différentes parties. En arrière-plan, ClickHouse fusionne des parties de données pour un stockage plus efficace. Les parties appartenant à des partitions différentes ne sont pas fusionnées. La fusion mécanisme ne garantit pas que toutes les lignes avec la même clé primaire sera dans la même partie des données.</p> <p>Chaque partie de données est logiquement divisée en granules. Un granule est le plus petit ensemble de données indivisible que ClickHouse lit lors de la sélection des données. ClickHouse ne divise pas les lignes ou les valeurs, de sorte que chaque granule contient toujours un nombre entier de lignes. La première rangée de granules est marqué avec la valeur de la clé primaire de la ligne. Pour chaque partie de données, ClickHouse crée un fichier d'index qui stocke les marques. Pour chaque colonne, que ce soit dans la clé primaire ou non, ClickHouse stocke également les mêmes marques. Ces marques vous permettent de trouver des données directement dans les fichiers de colonnes.</p> <p>La taille de granule est limitée par <code class=syntax>index_granularity</code> et <code class=syntax>index_granularity_bytes</code> paramètres du moteur de table. Le nombre de lignes dans un granule jette dans la <code class=syntax>[1, index_granularity]</code> gamme, en fonction de la taille des lignes. La taille des granulés peut dépasser <code class=syntax>index_granularity_bytes</code> si la taille d'une seule ligne est supérieure à la valeur du paramètre. Dans ce cas, la taille du granule est égale à la taille de la ligne.</p> <h2 id=primary-keys-and-indexes-in-queries>Clés primaires et Index dans les requêtes<a class=headerlink href=../amp/#primary-keys-and-indexes-in-queries title="Permanent link"> </a></h2> <p>Prendre la <code class=syntax>(CounterID, Date)</code> clé primaire comme un exemple. Dans ce cas, le tri et l'index peuvent être illustrés comme suit:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=w>  </span><span class=n>Whole</span><span class=w> </span><span class=k>data</span><span class=err>:</span><span class=w>     </span><span class=o>[</span><span class=n>---------------------------------------------</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nl>CounterID</span><span class=p>:</span><span class=w>      </span><span class=o>[</span><span class=n>aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nc>Date</span><span class=err>:</span><span class=w>           </span><span class=o>[</span><span class=n>1111111222222233331233211111222222333211111112122222223111112223311122333</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nl>Marks</span><span class=p>:</span><span class=w>           </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w></span>
<span class=w>                  </span><span class=n>a</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>b</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>g</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>h</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>l</span><span class=p>,</span><span class=mi>3</span><span class=w></span>
<span class=w>  </span><span class=n>Marks</span><span class=w> </span><span class=nl>numbers</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=w>      </span><span class=mi>1</span><span class=w>      </span><span class=mi>2</span><span class=w>      </span><span class=mi>3</span><span class=w>      </span><span class=mi>4</span><span class=w>      </span><span class=mi>5</span><span class=w>      </span><span class=mi>6</span><span class=w>      </span><span class=mi>7</span><span class=w>      </span><span class=mi>8</span><span class=w>      </span><span class=mi>9</span><span class=w>      </span><span class=mi>10</span><span class=w></span>
</code></pre></div> <p>Si la requête de données spécifie:</p> <ul> <li><code class=syntax>CounterID in ('a', 'h')</code> le serveur lit les données dans les gammes des marques <code class=syntax>[0, 3)</code> et <code class=syntax>[6, 8)</code>.</li> <li><code class=syntax>CounterID IN ('a', 'h') AND Date = 3</code> le serveur lit les données dans les gammes des marques <code class=syntax>[1, 3)</code> et <code class=syntax>[7, 8)</code>.</li> <li><code class=syntax>Date = 3</code>, le serveur lit les données de la plage de marque <code class=syntax>[1, 10]</code>.</li> </ul> <p>Les exemples ci-dessus montrent qu'il est toujours plus efficace d'utiliser un indice qu'une analyse complète.</p> <p>Un index clairsemé permet de lire des données supplémentaires. Lors de la lecture d'une plage unique de la clé primaire, jusqu'à <code class=syntax>index_granularity * 2</code> lignes supplémentaires dans chaque bloc de données peut être lu.</p> <p>Les index clairsemés vous permettent de travailler avec un très grand nombre de lignes de table, car dans la plupart des cas, ces index tiennent dans la RAM de l'ordinateur.</p> <p>ClickHouse ne nécessite pas de clé primaire unique. Vous pouvez insérer plusieurs lignes avec la même clé primaire.</p> <h3 id=selecting-the-primary-key>Sélection de la clé primaire<a class=headerlink href=../amp/#selecting-the-primary-key title="Permanent link"> </a></h3> <p>Le nombre de colonnes de la clé primaire n'est pas explicitement limitée. Selon la structure de données, vous pouvez inclure plus ou moins de colonnes dans la clé primaire. Cela peut:</p> <ul> <li> <p>Améliorer la performance d'un indice.</p> <p>Si la clé primaire est <code class=syntax>(a, b)</code>, puis ajouter une autre colonne <code class=syntax>c</code> pour améliorer les performances si les conditions suivantes sont réunies:</p> <ul> <li>Il y a des requêtes avec une condition sur la colonne <code class=syntax>c</code>.</li> <li>Longues plages de données (plusieurs fois plus longues que <code class=syntax>index_granularity</code>) avec des valeurs identiques pour <code class=syntax>(a, b)</code> sont communs. En d'autres termes, lors de l'ajout d'une autre colonne vous permet de passer très longues plages de données.</li> </ul> </li> <li> <p>Améliorer la compression des données.</p> <p>ClickHouse trie les données par clé primaire, donc plus la cohérence est élevée, meilleure est la compression.</p> </li> <li> <p>Fournir une logique supplémentaire lors de la fusion de parties de <a href=../../collapsingmergetree/amp/#table_engine-collapsingmergetree>CollapsingMergeTree</a> et <a href=../../summingmergetree/amp/ >SummingMergeTree</a> moteur.</p> <p>Dans ce cas, on peut spécifier l' <em>clé de tri</em> qui est différente de la clé primaire.</p> </li> </ul> <p>Une clé primaire longue affectera négativement les performances d'insertion et la consommation de mémoire, mais des colonnes supplémentaires dans la clé primaire n'affecteront pas les performances de ClickHouse pendant <code class=syntax>SELECT</code> requête.</p> <h3 id=choosing-a-primary-key-that-differs-from-the-sorting-key>Choisir une clé primaire qui diffère de la clé de tri<a class=headerlink href=../amp/#choosing-a-primary-key-that-differs-from-the-sorting-key title="Permanent link"> </a></h3> <p>Il est possible de spécifier une clé primaire (une expression avec des valeurs qui sont écrites dans le fichier d'index pour chaque marque) qui est différente de la clé de tri (une expression pour trier les lignes dans les parties de données). Dans ce cas, le tuple d'expression de clé primaire doit être un préfixe du tuple d'expression de clé de tri.</p> <p>Cette fonctionnalité est utile lorsque vous utilisez le <a href=../../summingmergetree/amp/ >SummingMergeTree</a> et<br> <a href=../../aggregatingmergetree/amp/ >AggregatingMergeTree</a> table des moteurs. Dans un cas courant lors de l'utilisation de ces moteurs, la table a deux types de colonnes: <em>dimension</em> et <em>mesure</em>. Les requêtes typiques agrégent les valeurs des colonnes de mesure avec arbitraire <code class=syntax>GROUP BY</code> et filtrage par dimensions. Comme SummingMergeTree et AggregatingMergeTree regroupent des lignes avec la même valeur de la clé de tri, il est naturel d'y ajouter toutes les dimensions. En conséquence, l'expression se compose d'une longue liste de colonnes, et cette liste doit être mise à jour fréquemment avec nouvellement ajoutée.</p> <p>Dans ce cas, il est logique de ne laisser que quelques colonnes dans la clé primaire qui fourniront des analyses de plage efficaces et ajouteront les colonnes de dimension restantes au tuple de clé de tri.</p> <p><a href=../../../../../sql-reference/statements/alter/amp/ >ALTER</a> la clé de tri est une opération légère car lorsqu'une nouvelle colonne est ajoutée simultanément à la table et à la clé de tri, les parties de données existantes n'ont pas besoin d'être modifiées. Comme l'ancienne clé de tri est un préfixe de la nouvelle clé de tri et qu'il n'y a pas de données dans la colonne nouvellement ajoutée, les données sont triées à la fois par l'ancienne et la nouvelle clé de tri au moment de la modification de la table.</p> <h3 id=use-of-indexes-and-partitions-in-queries>Utilisation D'Index et de Partitions dans les requêtes<a class=headerlink href=../amp/#use-of-indexes-and-partitions-in-queries title="Permanent link"> </a></h3> <p>Pour <code class=syntax>SELECT</code> requêtes, clickhouse analyse si un index peut être utilisé. Un index peut être utilisé si le <code class=syntax>WHERE/PREWHERE</code> clause a une expression (comme l'un des éléments de conjonction, ou entièrement) qui représente une opération de comparaison d'égalité ou d'inégalité, ou si elle a <code class=syntax>IN</code> ou <code class=syntax>LIKE</code> avec un préfixe fixe sur les colonnes ou les expressions qui sont dans la clé primaire ou la clé de partitionnement, ou sur certaines fonctions partiellement répétitives de ces colonnes, ou les relations logiques de ces expressions.</p> <p>Ainsi, il est possible d'exécuter des requêtes sur une ou plusieurs plages de la clé primaire. Dans cet exemple, les requêtes seront rapides lorsqu'elles sont exécutées pour une balise de suivi spécifique, pour une balise et une plage de dates spécifiques, pour une balise et une date spécifiques, pour plusieurs balises avec une plage de dates, etc.</p> <p>Regardons le moteur configuré comme suit:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>  ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate) SETTINGS index_granularity=8192</span>
</code></pre></div> <p>Dans ce cas, dans les requêtes:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=p>((</span><span class=n>EventDate</span> <span class=o>&gt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-01'</span><span class=p>)</span> <span class=k>AND</span> <span class=n>EventDate</span> <span class=o>&lt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-31'</span><span class=p>))</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=k>IN</span> <span class=p>(</span><span class=mi>101500</span><span class=p>,</span> <span class=mi>731962</span><span class=p>,</span> <span class=mi>160656</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>101500</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>!=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span>
</code></pre></div> <p>ClickHouse utilisera l'index de clé primaire pour supprimer les données incorrectes et la clé de partitionnement mensuel pour supprimer les partitions qui se trouvent dans des plages de dates incorrectes.</p> <p>Les requêtes ci-dessus montrent que l'index est utilisé même pour les expressions complexes. La lecture de la table est organisée de sorte que l'utilisation de l'index ne peut pas être plus lente qu'une analyse complète.</p> <p>Dans l'exemple ci-dessous, l'index ne peut pas être utilisé.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>URL</span> <span class=k>LIKE</span> <span class=s1>'%upyachka%'</span>
</code></pre></div> <p>Pour vérifier si ClickHouse pouvez utiliser l'index lors de l'exécution d'une requête, utilisez les paramètres <a href=../../../../../operations/settings/settings/amp/#settings-force_index_by_date>force_index_by_date</a> et <a href=../../../../../operations/settings/settings/amp/ >force_primary_key</a>.</p> <p>La clé de partitionnement par mois permet de lire uniquement les blocs de données qui contiennent des dates de la plage appropriée. Dans ce cas, le bloc de données peut contenir des données pour plusieurs dates (jusqu'à un mois entier). Dans un bloc, les données sont triées par clé primaire, qui peut ne pas contenir la date comme première colonne. Pour cette raison, l'utilisation d'une requête avec seulement une condition de date qui ne spécifie pas le préfixe de clé primaire entraînera la lecture de plus de données que pour une seule date.</p> <h3 id=use-of-index-for-partially-monotonic-primary-keys>Utilisation de L'Index pour les clés primaires partiellement monotones<a class=headerlink href=../amp/#use-of-index-for-partially-monotonic-primary-keys title="Permanent link"> </a></h3> <p>Considérons, par exemple, les jours du mois. Ils forment un <a href=https://en.wikipedia.org/wiki/Monotonic_function rel="external nofollow noreferrer" target=_blank>monotone de la séquence</a> pendant un mois, mais pas monotone pendant des périodes plus longues. C'est une séquence partiellement monotone. Si un utilisateur crée la table avec une clé primaire partiellement monotone, ClickHouse crée un index clairsemé comme d'habitude. Lorsqu'un utilisateur sélectionne des données à partir de ce type de table, ClickHouse analyse les conditions de requête. Si L'utilisateur veut obtenir des données entre deux marques de l'index et que ces deux marques tombent dans un mois, ClickHouse peut utiliser l'index dans ce cas particulier car il peut calculer la distance entre les paramètres d'une requête et les marques d'index.</p> <p>ClickHouse ne peut pas utiliser un index si les valeurs de la clé primaire dans la plage de paramètres de requête ne représentent pas une séquence monotone. Dans ce cas, ClickHouse utilise la méthode full scan.</p> <p>ClickHouse utilise cette logique non seulement pour les séquences de jours du mois, mais pour toute clé primaire qui représente une séquence partiellement monotone.</p> <h3 id=table_engine-mergetree-data_skipping-indexes>Index de saut de données (expérimental)<a class=headerlink href=../amp/#table_engine-mergetree-data_skipping-indexes title="Permanent link"> </a></h3> <p>La déclaration d'index se trouve dans la section colonnes du <code class=syntax>CREATE</code> requête.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>index_name</span> <span class=n>expr</span> <span class=k>TYPE</span> <span class=k>type</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>granularity_value</span>
</code></pre></div> <p>Pour les tables de la <code class=syntax>*MergeTree</code> famille, les indices de saut de données peuvent être spécifiés.</p> <p>Ces indices agrégent certaines informations sur l'expression spécifiée sur les blocs, qui consistent en <code class=syntax>granularity_value</code> granules (la taille du granule est spécifiée en utilisant <code class=syntax>index_granularity</code> réglage dans le moteur de table). Ensuite, ces agrégats sont utilisés dans <code class=syntax>SELECT</code> requêtes pour réduire la quantité de données à lire à partir du disque en ignorant de gros blocs de données <code class=syntax>where</code> la requête ne peut pas être satisfait.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>table_name</span>
<span class=p>(</span>
    <span class=n>u64</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>i32</span> <span class=n>Int32</span><span class=p>,</span>
    <span class=n>s</span> <span class=n>String</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>a</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>3</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>...</span>
</code></pre></div> <p>Les Indices de L'exemple peuvent être utilisés par ClickHouse pour réduire la quantité de données à lire à partir du disque dans les requêtes suivantes:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=s1>'z'</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span> <span class=o>==</span> <span class=mi>10</span> <span class=k>AND</span> <span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1234</span>
</code></pre></div> <h4 id=available-types-of-indices>Types d'Indices disponibles<a class=headerlink href=../amp/#available-types-of-indices title="Permanent link"> </a></h4> <ul> <li> <p><code class=syntax>minmax</code></p> <p>Magasins extrêmes de l'expression spécifiée (si l'expression est <code class=syntax>tuple</code> puis il stocke les extrêmes pour chaque élément de <code class=syntax>tuple</code>), utilise les informations stockées pour sauter des blocs de données comme la clé primaire.</p> </li> <li> <p><code class=syntax>set(max_rows)</code></p> <p>Stocke les valeurs uniques de l'expression spécifiée (pas plus de <code class=syntax>max_rows</code> rangée, <code class=syntax>max_rows=0</code> moyen “no limits”). Utilise les valeurs pour vérifier si le <code class=syntax>WHERE</code> l'expression n'est pas satisfiable sur un bloc de données.</p> </li> <li> <p><code class=syntax>ngrambf_v1(n, size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>Magasins un <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>Filtre de Bloom</a> qui contient tous les ngrams d'un bloc de données. Fonctionne uniquement avec des chaînes. Peut être utilisé pour l'optimisation de <code class=syntax>equals</code>, <code class=syntax>like</code> et <code class=syntax>in</code> expression.</p> <ul> <li><code class=syntax>n</code> — ngram size,</li> <li><code class=syntax>size_of_bloom_filter_in_bytes</code> — Bloom filter size in bytes (you can use large values here, for example, 256 or 512, because it can be compressed well).</li> <li><code class=syntax>number_of_hash_functions</code> — The number of hash functions used in the Bloom filter.</li> <li><code class=syntax>random_seed</code> — The seed for Bloom filter hash functions.</li> </ul> </li> <li> <p><code class=syntax>tokenbf_v1(size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>Le même que <code class=syntax>ngrambf_v1</code>, mais stocke des jetons au lieu de ngrams. Les jetons sont des séquences séparées par des caractères non alphanumériques.</p> </li> <li> <p><code class=syntax>bloom_filter([false_positive])</code> — Stores a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>Filtre de Bloom</a> pour les colonnes spécifiées.</p> <p>Facultatif <code class=syntax>false_positive</code> le paramètre est la probabilité de recevoir une réponse faussement positive du filtre. Valeurs possibles: (0, 1). Valeur par défaut: 0.025.</p> <p>Types de données pris en charge: <code class=syntax>Int*</code>, <code class=syntax>UInt*</code>, <code class=syntax>Float*</code>, <code class=syntax>Enum</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code>, <code class=syntax>FixedString</code>, <code class=syntax>Array</code>, <code class=syntax>LowCardinality</code>, <code class=syntax>Nullable</code>.</p> <p>Les fonctions suivantes peuvent l'utiliser: <a href=../../../../../sql-reference/functions/comparison-functions/amp/ >égal</a>, <a href=../../../../../sql-reference/functions/comparison-functions/amp/ >notEquals</a>, <a href=../../../../../sql-reference/functions/in-functions/amp/ >dans</a>, <a href=../../../../../sql-reference/functions/in-functions/amp/ >notIn</a>, <a href=../../../../../sql-reference/functions/array-functions/amp/ >avoir</a>.</p> </li> </ul> <!-- --> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>sample_index</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index2</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index3</span> <span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>ngrambf_v1</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
</code></pre></div> <h4 id=functions-support>Les Fonctions De Soutien<a class=headerlink href=../amp/#functions-support title="Permanent link"> </a></h4> <p>Les Conditions dans le <code class=syntax>WHERE</code> la clause contient des appels des fonctions qui fonctionnent avec des colonnes. Si la colonne fait partie d'un index, ClickHouse essaie d'utiliser cet index lors de l'exécution des fonctions. ClickHouse prend en charge différents sous-ensembles de fonctions pour l'utilisation d'index.</p> <p>Le <code class=syntax>set</code> l'indice peut être utilisé avec toutes les fonctions. Les sous-ensembles de fonctions pour les autres index sont présentés dans le tableau ci-dessous.</p> <table> <thead> <tr> <th>Fonction (opérateur) / Indice de</th> <th>clé primaire</th> <th>minmax</th> <th>ngrambf_v1</th> <th>tokenbf_v1</th> <th>bloom_filter</th> </tr> </thead> <tbody> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-equals>égal (=, ==)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-notequals>notEquals (!=, \&lt;&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-like>comme</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-notlike>notLike</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-functions/amp/#startswith>startsWith</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-functions/amp/#endswith>endsWith</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-multisearchany>multiSearchAny</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/in-functions/amp/#in-functions>dans</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/in-functions/amp/#in-functions>notIn</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-less>peu (\&lt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-greater>grand (&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-lessorequals>lessOrEquals (\&lt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-greaterorequals>greaterOrEquals ( &gt; =)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/array-functions/amp/#function-empty>vide</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/array-functions/amp/#function-notempty>notEmpty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td>hasToken</td> <td>✗</td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> </tr> </tbody> </table> <p>Les fonctions avec un argument constant inférieur à la taille ngram ne peuvent pas être utilisées par <code class=syntax>ngrambf_v1</code> pour l'optimisation de la requête.</p> <p>Les filtres Bloom peuvent avoir des correspondances faussement positives, de sorte que le <code class=syntax>ngrambf_v1</code>, <code class=syntax>tokenbf_v1</code>, et <code class=syntax>bloom_filter</code> les index ne peuvent pas être utilisés pour optimiser les requêtes où le résultat d'une fonction est censé être faux, par exemple:</p> <ul> <li>Peut être optimisé:<ul> <li><code class=syntax>s LIKE '%test%'</code></li> <li><code class=syntax>NOT s NOT LIKE '%test%'</code></li> <li><code class=syntax>s = 1</code></li> <li><code class=syntax>NOT s != 1</code></li> <li><code class=syntax>startsWith(s, 'test')</code></li> </ul> </li> <li>Ne peut pas être optimisé:<ul> <li><code class=syntax>NOT s LIKE '%test%'</code></li> <li><code class=syntax>s NOT LIKE '%test%'</code></li> <li><code class=syntax>NOT s = 1</code></li> <li><code class=syntax>s != 1</code></li> <li><code class=syntax>NOT startsWith(s, 'test')</code></li> </ul> </li> </ul> <h2 id=concurrent-data-access>Accès Simultané Aux Données<a class=headerlink href=../amp/#concurrent-data-access title="Permanent link"> </a></h2> <p>Pour l'accès aux tables simultanées, nous utilisons le multi-versioning. En d'autres termes, lorsqu'une table est lue et mise à jour simultanément, les données sont lues à partir d'un ensemble de parties en cours au moment de la requête. Il n'y a pas de longues mèches. Les Inserts ne gênent pas les opérations de lecture.</p> <p>Lecture à partir d'un tableau est automatiquement parallélisée.</p> <h2 id=table_engine-mergetree-ttl>TTL pour les colonnes et les tableaux<a class=headerlink href=../amp/#table_engine-mergetree-ttl title="Permanent link"> </a></h2> <p>Détermine la durée de vie de des valeurs.</p> <p>Le <code class=syntax>TTL</code> clause peut être définie pour la table entière et pour chaque colonne individuelle. Ttl de niveau Table peut également spécifier la logique de déplacement automatique des données entre les disques et les volumes.</p> <p>Les Expressions doivent évaluer pour <a href=../../../../../sql-reference/data-types/date/amp/ >Date</a> ou <a href=../../../../../sql-reference/data-types/datetime/amp/ >DateTime</a> type de données.</p> <p>Exemple:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>time_column</span>
<span class=n>TTL</span> <span class=n>time_column</span> <span class=o>+</span> <span class=nb>interval</span>
</code></pre></div> <p>Définir <code class=syntax>interval</code>, utiliser <a href=../../../../../sql-reference/operators/amp/#operators-datetime>intervalle</a> opérateur.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span>
<span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>15</span> <span class=n>HOUR</span>
</code></pre></div> <h3 id=mergetree-column-ttl>Colonne TTL<a class=headerlink href=../amp/#mergetree-column-ttl title="Permanent link"> </a></h3> <p>Lorsque les valeurs de la colonne expirent, ClickHouse les remplace par les valeurs par défaut du type de données de la colonne. Si toutes les valeurs de colonne de la partie données expirent, ClickHouse supprime cette colonne de la partie données d'un système de fichiers.</p> <p>Le <code class=syntax>TTL</code> la clause ne peut pas être utilisée pour les colonnes clés.</p> <p>Exemple:</p> <p>Création d'une table avec TTL</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=n>b</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=k>c</span> <span class=n>String</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span><span class=p>;</span>
</code></pre></div> <p>Ajout de TTL à une colonne d'une table existante</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Modification de TTL de la colonne</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>;</span>
</code></pre></div> <h3 id=mergetree-table-ttl>Tableau TTL<a class=headerlink href=../amp/#mergetree-table-ttl title="Permanent link"> </a></h3> <p>Table peut avoir une expression pour la suppression de Lignes expirées, et plusieurs expressions pour le déplacement automatique de pièces entre <a href=../amp/#table_engine-mergetree-multiple-volumes>disques ou volumes</a>. Lorsque les lignes de la table expirent, ClickHouse supprime toutes les lignes correspondantes. Pour les pièces en mouvement, toutes les lignes d'une pièce doivent satisfaire aux critères d'expression de mouvement.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>expr</span> <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'aaa'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'bbb'</span><span class=p>],</span> <span class=p>...</span>
</code></pre></div> <p>Type de règle TTL peut suivre chaque expression TTL. Il affecte une action qui doit être faite une fois que l'expression est satisfaite (atteint l'heure actuelle):</p> <ul> <li><code class=syntax>DELETE</code> - supprimer les Lignes expirées (action par défaut);</li> <li><code class=syntax>TO DISK 'aaa'</code> - déplacer la partie sur le disque <code class=syntax>aaa</code>;</li> <li><code class=syntax>TO VOLUME 'bbb'</code> - déplacer la partie sur le disque <code class=syntax>bbb</code>.</li> </ul> <p>Exemple:</p> <p>Création d'une table avec TTL</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=p>[</span><span class=k>DELETE</span><span class=p>],</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'aaa'</span><span class=p>,</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>2</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'bbb'</span><span class=p>;</span>
</code></pre></div> <p>Modification de TTL de la table</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p><strong>Suppression De Données</strong></p> <p>Les données avec un TTL expiré sont supprimées lorsque ClickHouse fusionne des parties de données.</p> <p>Lorsque ClickHouse voit que les données sont expirées, il effectue une fusion hors calendrier. Pour contrôler la fréquence de ces fusions, vous pouvez définir <code class=syntax>merge_with_ttl_timeout</code>. Si la valeur est trop faible, il effectuera de nombreuses fusions hors calendrier qui peuvent consommer beaucoup de ressources.</p> <p>Si vous effectuez la <code class=syntax>SELECT</code> requête entre les fusionne, vous pouvez obtenir des données expirées. Pour éviter cela, utilisez la <a href=../../../../../sql-reference/statements/misc/amp/#misc_operations-optimize>OPTIMIZE</a> requête avant de l' <code class=syntax>SELECT</code>.</p> <h2 id=table_engine-mergetree-multiple-volumes>Utilisation de plusieurs périphériques de bloc pour le stockage de données<a class=headerlink href=../amp/#table_engine-mergetree-multiple-volumes title="Permanent link"> </a></h2> <h3 id=introduction>Introduction<a class=headerlink href=../amp/#introduction title="Permanent link"> </a></h3> <p><code class=syntax>MergeTree</code> les moteurs de table de famille peuvent stocker des données sur plusieurs périphériques de bloc. Par exemple, il peut être utile lorsque les données d'un tableau sont implicitement divisé en “hot” et “cold”. Les données les plus récentes sont régulièrement demandées mais ne nécessitent qu'une petite quantité d'espace. Au contraire, les données historiques à queue grasse sont rarement demandées. Si plusieurs disques sont disponibles, la “hot” les données peuvent être situées sur des disques rapides (par exemple, SSD NVMe ou en mémoire), tandis que le “cold” des données relativement lente (par exemple, disque dur).</p> <p>La partie de données est l'unité mobile minimum pour <code class=syntax>MergeTree</code>-tables de moteur. Les données appartenant à une partie sont stockées sur un disque. Les parties de données peuvent être déplacées entre les disques en arrière-plan (selon les paramètres de l'utilisateur) ainsi qu'au moyen du <a href=../../../../../sql-reference/statements/alter/amp/#alter_move-partition>ALTER</a> requête.</p> <h3 id=terms>Terme<a class=headerlink href=../amp/#terms title="Permanent link"> </a></h3> <ul> <li>Disk — Block device mounted to the filesystem.</li> <li>Default disk — Disk that stores the path specified in the <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server_configuration_parameters-path>chemin</a> paramètre de serveur.</li> <li>Volume — Ordered set of equal disks (similar to <a href=https://en.wikipedia.org/wiki/Non-RAID_drive_architectures rel="external nofollow noreferrer" target=_blank>JBOD</a>).</li> <li>Storage policy — Set of volumes and the rules for moving data between them.</li> </ul> <p>Les noms donnés aux entités décrites peuvent être trouvés dans les tables système, <a href=../../../../../operations/system-tables/amp/#system_tables-storage_policies>système.storage_policies</a> et <a href=../../../../../operations/system-tables/amp/#system_tables-disks>système.disque</a>. Pour appliquer l'une des stratégies de stockage configurées pour une table, utilisez <code class=syntax>storage_policy</code> réglage de <code class=syntax>MergeTree</code>-moteur de table de famille.</p> <h3 id=table_engine-mergetree-multiple-volumes_configure>Configuration<a class=headerlink href=../amp/#table_engine-mergetree-multiple-volumes_configure title="Permanent link"> </a></h3> <p>Les disques, les volumes et les stratégies de stockage doivent être déclarés <code class=syntax>&lt;storage_configuration&gt;</code> étiquette, soit dans le fichier principal <code class=syntax>config.xml</code> ou dans un fichier distinct dans le <code class=syntax>config.d</code> répertoire.</p> <p>Structure de Configuration:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;disk_name_1&gt;</span> <span class=c>&lt;!-- disk name --&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/fast_ssd/clickhouse/<span class=nt>&lt;/path&gt;</span>
        <span class=nt>&lt;/disk_name_1&gt;</span>
        <span class=nt>&lt;disk_name_2&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd1/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_2&gt;</span>
        <span class=nt>&lt;disk_name_3&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd2/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_3&gt;</span>

        ...
    <span class=nt>&lt;/disks&gt;</span>

    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Balise:</p> <ul> <li><code class=syntax>&lt;disk_name_N&gt;</code> — Disk name. Names must be different for all disks.</li> <li><code class=syntax>path</code> — path under which a server will store data (<code class=syntax>data</code> et <code class=syntax>shadow</code> des dossiers), doit être terminé par ‘/’.</li> <li><code class=syntax>keep_free_space_bytes</code> — the amount of free disk space to be reserved.</li> </ul> <p>L'ordre du disque définition n'est pas important.</p> <p>Stratégies de stockage balisage de configuration:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;policy_name_1&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;volume_name_1&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk_name_from_disks_configuration<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/volume_name_1&gt;</span>
                <span class=nt>&lt;volume_name_2&gt;</span>
                    <span class=c>&lt;!-- configuration --&gt;</span>
                <span class=nt>&lt;/volume_name_2&gt;</span>
                <span class=c>&lt;!-- more volumes --&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/policy_name_1&gt;</span>
        <span class=nt>&lt;policy_name_2&gt;</span>
            <span class=c>&lt;!-- configuration --&gt;</span>
        <span class=nt>&lt;/policy_name_2&gt;</span>

        <span class=c>&lt;!-- more policies --&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Balise:</p> <ul> <li><code class=syntax>policy_name_N</code> — Policy name. Policy names must be unique.</li> <li><code class=syntax>volume_name_N</code> — Volume name. Volume names must be unique.</li> <li><code class=syntax>disk</code> — a disk within a volume.</li> <li><code class=syntax>max_data_part_size_bytes</code> — the maximum size of a part that can be stored on any of the volume's disks.</li> <li><code class=syntax>move_factor</code> — when the amount of available space gets lower than this factor, data automatically start to move on the next volume if any (by default, 0.1).</li> </ul> <p>Exemples de Cofiguration:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;hdd_in_order&gt;</span> <span class=c>&lt;!-- policy name --&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;single&gt;</span> <span class=c>&lt;!-- volume name --&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk2<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/single&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/hdd_in_order&gt;</span>

        <span class=nt>&lt;moving_from_ssd_to_hdd&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;hot&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>fast_ssd<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/hot&gt;</span>
                <span class=nt>&lt;cold&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/cold&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/moving_from_ssd_to_hdd&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Dans l'exemple donné, la <code class=syntax>hdd_in_order</code> politique met en œuvre les <a href=https://en.wikipedia.org/wiki/Round-robin_scheduling rel="external nofollow noreferrer" target=_blank>round-robin</a> approche. Ainsi cette politique ne définit qu'un seul volume (<code class=syntax>single</code>), les parties des données sont stockées sur tous ses disques dans l'ordre circulaire. Une telle politique peut être très utile s'il y a plusieurs disques similaires sont montés sur le système, mais RAID N'est pas configuré. Gardez à l'esprit que chaque lecteur de disque n'est pas fiable et vous pouvez compenser avec facteur de réplication de 3 ou plus.</p> <p>S'il existe différents types de disques disponibles dans le système, <code class=syntax>moving_from_ssd_to_hdd</code> la stratégie peut être utilisée à la place. Volume <code class=syntax>hot</code> se compose d'un disque SSD (<code class=syntax>fast_ssd</code>), et la taille maximale d'une pièce qui peut être stocké sur ce volume est de 1 go. Toutes les pièces avec la taille plus grande que 1 GB sera stocké directement sur le <code class=syntax>cold</code> le volume, qui contient un disque dur de disque <code class=syntax>disk1</code>.<br> Aussi, une fois le disque <code class=syntax>fast_ssd</code> est complété par plus de 80%, les données seront transférées à la <code class=syntax>disk1</code> par un processus d'arrière-plan.</p> <p>L'ordre d'énumération des volumes dans une stratégie de stockage est important. Une fois qu'un volume est surchargé, les données sont déplacées vers le suivant. L'ordre d'énumération des disques est important parce que les données sont stockées dans les virages.</p> <p>Lors de la création d'une table, on peut lui appliquer l'une des stratégies de stockage configurées:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_with_non_default_policy</span> <span class=p>(</span>
    <span class=n>EventDate</span> <span class=nb>Date</span><span class=p>,</span>
    <span class=n>OrderID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>BannerID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>SearchPhrase</span> <span class=n>String</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>OrderID</span><span class=p>,</span> <span class=n>BannerID</span><span class=p>)</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span>
<span class=n>SETTINGS</span> <span class=n>storage_policy</span> <span class=o>=</span> <span class=s1>'moving_from_ssd_to_hdd'</span>
</code></pre></div> <p>Le <code class=syntax>default</code> la Politique de stockage implique d'utiliser un seul volume, qui se compose d'un seul disque donné dans <code class=syntax>&lt;path&gt;</code>. Une fois qu'une table est créée, sa stratégie de stockage ne peut pas être modifiée.</p> <h3 id=details>Détail<a class=headerlink href=../amp/#details title="Permanent link"> </a></h3> <p>Dans le cas de <code class=syntax>MergeTree</code> les tableaux, les données sont sur le disque de différentes façons:</p> <ul> <li>En tant que résultat d'un insert (<code class=syntax>INSERT</code> requête).</li> <li>En arrière-plan fusionne et <a href=../../../../../sql-reference/statements/alter/amp/#alter-mutations>mutation</a>.</li> <li>Lors du téléchargement à partir d'une autre réplique.</li> <li>À la suite du gel de la partition <a href=../../../../../sql-reference/statements/alter/amp/#alter_freeze-partition>ALTER TABLE … FREEZE PARTITION</a>.</li> </ul> <p>Dans tous ces cas, à l'exception des mutations et du gel de partition, une pièce est stockée sur un volume et un disque selon la Politique de stockage donnée:</p> <ol> <li>Le premier volume (dans l'ordre de définition) qui a suffisamment d'espace disque pour stocker une pièce (<code class=syntax>unreserved_space &gt; current_part_size</code>) et permet de stocker des pièces d'une taille donnée (<code class=syntax>max_data_part_size_bytes &gt; current_part_size</code>) est choisi.</li> <li>Dans ce volume, ce disque est choisi qui suit celui, qui a été utilisé pour stocker le bloc de données précédent, et qui a de l'espace libre plus que la taille de la pièce (<code class=syntax>unreserved_space - keep_free_space_bytes &gt; current_part_size</code>).</li> </ol> <p>Sous le capot, les mutations et la congélation des cloisons utilisent <a href=https://en.wikipedia.org/wiki/Hard_link rel="external nofollow noreferrer" target=_blank>des liens en dur</a>. Les liens durs entre différents disques ne sont pas pris en charge, donc dans de tels cas, les pièces résultantes sont stockées sur les mêmes disques que les disques initiaux.</p> <p>En arrière - plan, les pièces sont déplacées entre les volumes en fonction de la quantité d'espace libre (<code class=syntax>move_factor</code> paramètre) selon l'ordre les volumes sont déclarées dans le fichier de configuration.<br> Les données ne sont jamais transférées du dernier et dans le premier. On peut utiliser des tables système <a href=../../../../../operations/system-tables/amp/#system_tables-part-log>système.part_log</a> (champ <code class=syntax>type = MOVE_PART</code>) et <a href=../../../../../operations/system-tables/amp/#system_tables-parts>système.partie</a> (Fields <code class=syntax>path</code> et <code class=syntax>disk</code>) pour surveiller l'arrière-plan se déplace. Aussi, les informations détaillées peuvent être trouvées dans les journaux du serveur.</p> <p>L'utilisateur peut forcer le déplacement d'une partie ou d'une partition d'un volume à l'autre à l'aide de la requête <a href=../../../../../sql-reference/statements/alter/amp/#alter_move-partition>ALTER TABLE … MOVE PART|PARTITION … TO VOLUME|DISK …</a>, toutes les restrictions pour les opérations de fond sont prises en compte. La requête initie un mouvement seul et n'attend pas que les opérations d'arrière-plan soient terminées. L'utilisateur recevra un message d'erreur si pas assez d'espace libre est disponible ou si l'une des conditions requises ne sont pas remplies.</p> <p>Le déplacement des données n'interfère pas avec la réplication des données. Par conséquent, différentes stratégies de stockage peuvent être spécifiées pour la même table sur différents réplicas.</p> <p>Après l'achèvement des fusions d'arrière-plan et des mutations, les anciennes parties ne sont supprimées qu'après un certain temps (<code class=syntax>old_parts_lifetime</code>).<br> Pendant ce temps, ils ne sont pas déplacés vers d'autres volumes ou des disques. Par conséquent, jusqu'à ce que les pièces soient finalement supprimées, elles sont toujours prises en compte pour l'évaluation de l'espace disque occupé.</p> <p><a href=https://clickhouse.tech/docs/ru/operations/table_engines/mergetree/ target=_blank>Article Original</a> <!--hide--></p> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/fr/engines/table-engines/mergetree-family/mergetree/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 