<!DOCTYPE html><html lang=ru data-version=master data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Обзор архитектуры ClickHouse | Документация ClickHouse</title><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/images/logo-180x180.png><meta property=og:title content="Обзор архитектуры ClickHouse | Документация ClickHouse"><meta property=og:description content="Обзор архитектуры ClickHouse ClickHouse - полноценная колоночная СУБД. Данные хранятся в колонках, а в процессе обработк"><meta property=og:type content=article><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta content=https://clickhouse.tech/docs/ru/development/architecture/ property=og:url><link href=https://clickhouse.tech/docs/ru/development/architecture/ rel=canonical><link href=https://clickhouse.tech/docs/ru/development/architecture/amp/ rel=amphtml><link rel=search href=/opensearch.xml title=ClickHouse type=application/opensearchdescription+xml><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Обзор архитектуры ClickHouse | Документация ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/ru/development/architecture/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Обзор архитектуры ClickHouse | Документация ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><meta name=description content="Обзор архитектуры ClickHouse ClickHouse - полноценная колоночная СУБД. Данные хранятся в колонках, а в процессе обработк"><meta name=keywords content="ClickHouse, DBMS, OLAP, SQL, open-source, relational, analytics, analytical, Big Data, web-analytics"><link rel=alternate href=https://clickhouse.tech/docs/en/development/architecture/ hreflang=en><link rel=alternate href=https://clickhouse.tech/docs/zh/development/architecture/ hreflang=zh><link rel=alternate href=https://clickhouse.tech/docs/es/development/architecture/ hreflang=es><link rel=alternate href=https://clickhouse.tech/docs/fr/development/architecture/ hreflang=fr><link rel=alternate href=https://clickhouse.tech/docs/ru/development/architecture/ hreflang=ru><link rel=alternate href=https://clickhouse.tech/docs/ja/development/architecture/ hreflang=ja><link rel=alternate href=https://clickhouse.tech/docs/en/development/architecture/ hreflang=x-default><link href=/css/base.css?e27f3458 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> Обзор архитектуры ClickHouse </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li id=edit-wrapper class=nav-item> <a id=edit-link href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/development/architecture.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/ru.svg alt=Русский title=Русский width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/en/development/architecture/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/zh/development/architecture/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/es/development/architecture/ class=dropdown-item> <img src=/images/flags/es.svg alt title width=32 class="d-inline-block mr-2">Español </a> <a href=/docs/fr/development/architecture/ class=dropdown-item> <img src=/images/flags/fr.svg alt title width=32 class="d-inline-block mr-2">Français </a> <a href=/docs/ru/development/architecture/ class="dropdown-item disabled"> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/ja/development/architecture/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Multi-page or single-page"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Multi-page version" title="Multi-page version"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Single-page version" title="Single-page version"> </a> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Введение class="nav-link text-light dropdown-toggle px-0">Введение</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../introduction/distinctive-features/ title="Отличительные возможности ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Отличительные возможности ClickHouse</a> <a href=../../introduction/performance/ title=Производительность class="nav-link text-light text-wrap d-inline-block w-100 px-0">Производительность</a> <a href=../../introduction/history/ title="История ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">История ClickHouse</a> <a href=../../introduction/adopters/ title=Adopters class="nav-link text-light text-wrap d-inline-block w-100 px-0">Adopters</a> <a href=../../introduction/info/ title="Информационная поддержка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Информационная поддержка</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title="Начало работы" class="nav-link text-light dropdown-toggle px-0">Начало работы</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting-started/install/ title=Установка class="nav-link text-light text-wrap d-inline-block w-100 px-0">Установка</a> <a href=../../getting-started/tutorial/ title=Tutorial class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tutorial</a> <a href=../../getting-started/playground/ title=Playground class="nav-link text-light text-wrap d-inline-block w-100 px-0">Playground</a> <a href=#sidebar-sidebar-2-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-5 title="Тестовые массивы данных" class="nav-link text-light dropdown-toggle px-0">Тестовые массивы данных</a> <div id=sidebar-sidebar-2-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting-started/example-datasets/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../getting-started/example-datasets/metrica/ title="Анонимизированные данные Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Анонимизированные данные Яндекс.Метрики</a> <a href=../../getting-started/example-datasets/star-schema/ title="Star Schema Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema Benchmark</a> <a href=../../getting-started/example-datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting-started/example-datasets/criteo/ title="Терабайт логов кликов от Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Терабайт логов кликов от Criteo</a> <a href=../../getting-started/example-datasets/amplab-benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../getting-started/example-datasets/brown-benchmark/ title="Brown University Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Brown University Benchmark</a> <a href=../../getting-started/example-datasets/nyc-taxi/ title="Данные о такси в Нью-Йорке" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные о такси в Нью-Йорке</a> <a href=../../getting-started/example-datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Интерфейсы class="nav-link text-light dropdown-toggle px-0">Интерфейсы</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../interfaces/cli/ title="Клиент командной строки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиент командной строки</a> <a href=../../interfaces/tcp/ title="Родной интерфейс (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Родной интерфейс (TCP)</a> <a href=../../interfaces/http/ title=HTTP-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP-интерфейс</a> <a href=../../interfaces/mysql/ title=MySQL-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL-интерфейс</a> <a href=../../interfaces/formats/ title="Форматы входных и выходных данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Форматы входных и выходных данных</a> <a href=../../interfaces/jdbc/ title=JDBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC-драйвер</a> <a href=../../interfaces/odbc/ title=ODBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC-драйвер</a> <a href=../../interfaces/cpp/ title="C++ клиентская библиотека" class="nav-link text-light text-wrap d-inline-block w-100 px-0">C++ клиентская библиотека</a> <a href=#sidebar-sidebar-3-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-10 title="Сторонние интерфейсы" class="nav-link text-light dropdown-toggle px-0">Сторонние интерфейсы</a> <div id=sidebar-sidebar-3-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/ title="Сторонние интерфейсы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Сторонние интерфейсы</a> <a href=../../interfaces/third-party/client-libraries/ title="Клиентские библиотеки от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиентские библиотеки от сторонних разработчиков</a> <a href=../../interfaces/third-party/integrations/ title="Библиотеки для интеграции от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Библиотеки для интеграции от сторонних разработчиков</a> <a href=../../interfaces/third-party/gui/ title="Визуальные интерфейсы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Визуальные интерфейсы от сторонних разработчиков</a> <a href=../../interfaces/third-party/proxy/ title="Прокси-серверы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прокси-серверы от сторонних разработчиков</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=Engines class="nav-link text-light dropdown-toggle px-0">Engines</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-4-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2 title="Движки таблиц" class="nav-link text-light dropdown-toggle px-0">Движки таблиц</a> <div id=sidebar-sidebar-4-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-4-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-2 title="MergeTree Family" class="nav-link text-light dropdown-toggle px-0">MergeTree Family</a> <div id=sidebar-sidebar-4-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/mergetree-family/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../engines/table-engines/mergetree-family/replication/ title="Репликация данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Репликация данных</a> <a href=../../engines/table-engines/mergetree-family/custom-partitioning-key/ title="Произвольный ключ партиционирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Произвольный ключ партиционирования</a> <a href=../../engines/table-engines/mergetree-family/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-4-2-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-3 title="Семейство Log" class="nav-link text-light dropdown-toggle px-0">Семейство Log</a> <div id=sidebar-sidebar-4-2-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/log-family/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../engines/table-engines/log-family/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../engines/table-engines/log-family/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../engines/table-engines/log-family/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-4-2-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-4 title="Движки таблиц для интеграции" class="nav-link text-light dropdown-toggle px-0">Движки таблиц для интеграции</a> <div id=sidebar-sidebar-4-2-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/integrations/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> <a href=../../engines/table-engines/integrations/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../engines/table-engines/integrations/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../engines/table-engines/integrations/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> <a href=../../engines/table-engines/integrations/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../engines/table-engines/integrations/embedded-rocksdb/ title=EmbeddedRocksDB class="nav-link text-light text-wrap d-inline-block w-100 px-0">EmbeddedRocksDB</a> <a href=../../engines/table-engines/integrations/mongodb/ title=MongoDB class="nav-link text-light text-wrap d-inline-block w-100 px-0">MongoDB</a> <a href=../../engines/table-engines/integrations/ title="Движки таблиц для интеграции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Движки таблиц для интеграции</a> <a href=../../engines/table-engines/integrations/rabbitmq/ title=RabbitMQ class="nav-link text-light text-wrap d-inline-block w-100 px-0">RabbitMQ</a> </nav> </div> <a href=#sidebar-sidebar-4-2-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-5 title="Специальные движки таблиц" class="nav-link text-light dropdown-toggle px-0">Специальные движки таблиц</a> <div id=sidebar-sidebar-4-2-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/special/ title="Специальные движки таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Специальные движки таблиц</a> <a href=../../engines/table-engines/special/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../engines/table-engines/special/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../engines/table-engines/special/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../engines/table-engines/special/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../engines/table-engines/special/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../engines/table-engines/special/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../engines/table-engines/special/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../engines/table-engines/special/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../engines/table-engines/special/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../engines/table-engines/special/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../engines/table-engines/special/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../engines/table-engines/special/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> <a href=../../engines/table-engines/special/external-data/ title="Внешние данные для обработки запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние данные для обработки запроса</a> <a href=../../engines/table-engines/special/generate/ title=GenerateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">GenerateRandom</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3 title="Движки баз данных" class="nav-link text-light dropdown-toggle px-0">Движки баз данных</a> <div id=sidebar-sidebar-4-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/database-engines/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../engines/database-engines/materialize-mysql/ title=MaterializeMySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializeMySQL</a> <a href=../../engines/database-engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../engines/database-engines/lazy/ title=Lazy class="nav-link text-light text-wrap d-inline-block w-100 px-0">Lazy</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Справка по SQL" class="nav-link text-light dropdown-toggle px-0">Справка по SQL</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-5-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2 title=Выражения class="nav-link text-light dropdown-toggle px-0">Выражения</a> <div id=sidebar-sidebar-5-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/statements/ title="SQL выражения в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQL выражения в ClickHouse</a> <a href=#sidebar-sidebar-5-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2-2 title=SELECT class="nav-link text-light dropdown-toggle px-0">SELECT</a> <div id=sidebar-sidebar-5-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/statements/select/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../sql-reference/statements/select/all/ title=ALL class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALL</a> <a href=../../sql-reference/statements/select/array-join/ title="ARRAY JOIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ARRAY JOIN</a> <a href=../../sql-reference/statements/select/distinct/ title=DISTINCT class="nav-link text-light text-wrap d-inline-block w-100 px-0">DISTINCT</a> <a href=../../sql-reference/statements/select/format/ title=FORMAT class="nav-link text-light text-wrap d-inline-block w-100 px-0">FORMAT</a> <a href=../../sql-reference/statements/select/from/ title=FROM class="nav-link text-light text-wrap d-inline-block w-100 px-0">FROM</a> <a href=../../sql-reference/statements/select/group-by/ title="GROUP BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GROUP BY</a> <a href=../../sql-reference/statements/select/having/ title=HAVING class="nav-link text-light text-wrap d-inline-block w-100 px-0">HAVING</a> <a href=../../sql-reference/statements/select/into-outfile/ title="INTO OUTFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INTO OUTFILE</a> <a href=../../sql-reference/statements/select/join/ title=JOIN class="nav-link text-light text-wrap d-inline-block w-100 px-0">JOIN</a> <a href=../../sql-reference/statements/select/limit/ title=LIMIT class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT</a> <a href=../../sql-reference/statements/select/limit-by/ title="LIMIT BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT BY</a> <a href=../../sql-reference/statements/select/order-by/ title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a> <a href=../../sql-reference/statements/select/prewhere/ title=PREWHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">PREWHERE</a> <a href=../../sql-reference/statements/select/sample/ title=SAMPLE class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE</a> <a href=../../sql-reference/statements/select/union/ title=UNION class="nav-link text-light text-wrap d-inline-block w-100 px-0">UNION</a> <a href=../../sql-reference/statements/select/where/ title=WHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">WHERE</a> <a href=../../sql-reference/statements/select/with/ title=WITH class="nav-link text-light text-wrap d-inline-block w-100 px-0">WITH</a> </nav> </div> <a href=../../sql-reference/statements/insert-into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=#sidebar-sidebar-5-2-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2-4 title=CREATE class="nav-link text-light dropdown-toggle px-0">CREATE</a> <div id=sidebar-sidebar-5-2-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/statements/create/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../sql-reference/statements/create/database/ title="База данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">База данных</a> <a href=../../sql-reference/statements/create/table/ title=Таблица class="nav-link text-light text-wrap d-inline-block w-100 px-0">Таблица</a> <a href=../../sql-reference/statements/create/view/ title=Представление class="nav-link text-light text-wrap d-inline-block w-100 px-0">Представление</a> <a href=../../sql-reference/statements/create/dictionary/ title=Словарь class="nav-link text-light text-wrap d-inline-block w-100 px-0">Словарь</a> <a href=../../sql-reference/statements/create/user/ title=Пользователь class="nav-link text-light text-wrap d-inline-block w-100 px-0">Пользователь</a> <a href=../../sql-reference/statements/create/role/ title=Роль class="nav-link text-light text-wrap d-inline-block w-100 px-0">Роль</a> <a href=../../sql-reference/statements/create/row-policy/ title="Политика доступа" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Политика доступа</a> <a href=../../sql-reference/statements/create/quota/ title=Квота class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квота</a> <a href=../../sql-reference/statements/create/settings-profile/ title="Профиль настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профиль настроек</a> </nav> </div> <a href=#sidebar-sidebar-5-2-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2-5 title=ALTER class="nav-link text-light dropdown-toggle px-0">ALTER</a> <div id=sidebar-sidebar-5-2-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/statements/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../sql-reference/statements/alter/column/ title="Манипуляции со столбцами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции со столбцами</a> <a href=../../sql-reference/statements/alter/partition/ title=PARTITION class="nav-link text-light text-wrap d-inline-block w-100 px-0">PARTITION</a> <a href=../../sql-reference/statements/alter/delete/ title=DELETE class="nav-link text-light text-wrap d-inline-block w-100 px-0">DELETE</a> <a href=../../sql-reference/statements/alter/update/ title=UPDATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">UPDATE</a> <a href=../../sql-reference/statements/alter/order-by/ title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a> <a href=../../sql-reference/statements/alter/sample-by/ title="SAMPLE BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE BY</a> <a href=../../sql-reference/statements/alter/index/ title="Манипуляции с индексами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции с индексами</a> <a href=../../sql-reference/statements/alter/constraint/ title="Манипуляции с ограничениями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции с ограничениями</a> <a href=../../sql-reference/statements/alter/ttl/ title=TTL class="nav-link text-light text-wrap d-inline-block w-100 px-0">TTL</a> <a href=../../sql-reference/statements/alter/user/ title=USER class="nav-link text-light text-wrap d-inline-block w-100 px-0">USER</a> <a href=../../sql-reference/statements/alter/quota/ title=QUOTA class="nav-link text-light text-wrap d-inline-block w-100 px-0">QUOTA</a> <a href=../../sql-reference/statements/alter/role/ title=ROLE class="nav-link text-light text-wrap d-inline-block w-100 px-0">ROLE</a> <a href=../../sql-reference/statements/alter/row-policy/ title="ROW POLICY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ROW POLICY</a> <a href=../../sql-reference/statements/alter/settings-profile/ title="SETTINGS PROFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SETTINGS PROFILE</a> </nav> </div> <a href=../../sql-reference/statements/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../sql-reference/statements/show/ title=SHOW class="nav-link text-light text-wrap d-inline-block w-100 px-0">SHOW</a> <a href=../../sql-reference/statements/grant/ title=GRANT class="nav-link text-light text-wrap d-inline-block w-100 px-0">GRANT</a> <a href=../../sql-reference/statements/revoke/ title=REVOKE class="nav-link text-light text-wrap d-inline-block w-100 px-0">REVOKE</a> <a href=../../sql-reference/statements/attach/ title=ATTACH class="nav-link text-light text-wrap d-inline-block w-100 px-0">ATTACH</a> <a href=../../sql-reference/statements/check-table/ title=CHECK class="nav-link text-light text-wrap d-inline-block w-100 px-0">CHECK</a> <a href=../../sql-reference/statements/describe-table/ title=DESCRIBE class="nav-link text-light text-wrap d-inline-block w-100 px-0">DESCRIBE</a> <a href=../../sql-reference/statements/detach/ title=DETACH class="nav-link text-light text-wrap d-inline-block w-100 px-0">DETACH</a> <a href=../../sql-reference/statements/drop/ title=DROP class="nav-link text-light text-wrap d-inline-block w-100 px-0">DROP</a> <a href=../../sql-reference/statements/exists/ title=EXISTS class="nav-link text-light text-wrap d-inline-block w-100 px-0">EXISTS</a> <a href=../../sql-reference/statements/kill/ title=KILL class="nav-link text-light text-wrap d-inline-block w-100 px-0">KILL</a> <a href=../../sql-reference/statements/optimize/ title=OPTIMIZE class="nav-link text-light text-wrap d-inline-block w-100 px-0">OPTIMIZE</a> <a href=../../sql-reference/statements/rename/ title=RENAME class="nav-link text-light text-wrap d-inline-block w-100 px-0">RENAME</a> <a href=../../sql-reference/statements/set/ title=SET class="nav-link text-light text-wrap d-inline-block w-100 px-0">SET</a> <a href=../../sql-reference/statements/set-role/ title="SET ROLE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SET ROLE</a> <a href=../../sql-reference/statements/truncate/ title=TRUNCATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">TRUNCATE</a> <a href=../../sql-reference/statements/use/ title=USE class="nav-link text-light text-wrap d-inline-block w-100 px-0">USE</a> </nav> </div> <a href=../../sql-reference/syntax/ title=Синтаксис class="nav-link text-light text-wrap d-inline-block w-100 px-0">Синтаксис</a> <a href=../../sql-reference/distributed-ddl/ title="Распределенные DDL запросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Распределенные DDL запросы</a> <a href=#sidebar-sidebar-5-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5 title=Функции class="nav-link text-light dropdown-toggle px-0">Функции</a> <div id=sidebar-sidebar-5-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../sql-reference/functions/arithmetic-functions/ title="Арифметические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Арифметические функции</a> <a href=../../sql-reference/functions/array-functions/ title=Массивы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Массивы</a> <a href=../../sql-reference/functions/comparison-functions/ title="Функции сравнения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции сравнения</a> <a href=../../sql-reference/functions/logical-functions/ title="Логические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Логические функции</a> <a href=../../sql-reference/functions/type-conversion-functions/ title="Функции преобразования типов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции преобразования типов</a> <a href=../../sql-reference/functions/date-time-functions/ title="Функции для работы с датами и временем" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с датами и временем</a> <a href=../../sql-reference/functions/string-functions/ title="Функции для работы со строками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со строками</a> <a href=../../sql-reference/functions/string-search-functions/ title="Функции поиска в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска в строках</a> <a href=../../sql-reference/functions/string-replace-functions/ title="Функции поиска и замены в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска и замены в строках</a> <a href=../../sql-reference/functions/conditional-functions/ title="Условные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Условные функции</a> <a href=../../sql-reference/functions/math-functions/ title="Математические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Математические функции</a> <a href=../../sql-reference/functions/rounding-functions/ title="Функции округления" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции округления</a> <a href=../../sql-reference/functions/tuple-map-functions/ title="Работа с контейнерами map" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Работа с контейнерами map</a> <a href=../../sql-reference/functions/splitting-merging-functions/ title="Функции разбиения и слияния строк и массивов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции разбиения и слияния строк и массивов</a> <a href=../../sql-reference/functions/bit-functions/ title="Битовые функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Битовые функции</a> <a href=../../sql-reference/functions/bitmap-functions/ title="Функции для битмапов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для битмапов</a> <a href=../../sql-reference/functions/hash-functions/ title="Функции хэширования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции хэширования</a> <a href=../../sql-reference/functions/random-functions/ title="Функции генерации псевдослучайных чисел" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции генерации псевдослучайных чисел</a> <a href=../../sql-reference/functions/encoding-functions/ title="Функции кодирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции кодирования</a> <a href=../../sql-reference/functions/uuid-functions/ title="Функции для работы с UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с UUID</a> <a href=../../sql-reference/functions/url-functions/ title="Функции для работы с URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с URL</a> <a href=../../sql-reference/functions/ip-address-functions/ title="Функции для работы с IP-адресами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с IP-адресами</a> <a href=../../sql-reference/functions/json-functions/ title=JSON class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON</a> <a href=../../sql-reference/functions/ext-dict-functions/ title="Функции для работы с внешними словарями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с внешними словарями</a> <a href=../../sql-reference/functions/ym-dict-functions/ title="Функции для работы со словарями Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со словарями Яндекс.Метрики</a> <a href=../../sql-reference/functions/in-functions/ title="Функции для реализации оператора IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для реализации оператора IN</a> <a href=../../sql-reference/functions/array-join/ title="Функция ArrayJoin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функция ArrayJoin</a> <a href=#sidebar-sidebar-5-5-29 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5-29 title=Гео-данные class="nav-link text-light dropdown-toggle px-0">Гео-данные</a> <div id=sidebar-sidebar-5-5-29 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/functions/geo/coordinates/ title="Функции для работы с географическими координатами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с географическими координатами</a> <a href=../../sql-reference/functions/geo/h3/ title="Функции для работы с индексами H3" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с индексами H3</a> <a href=../../sql-reference/functions/geo/geohash/ title="Функции для работы с системой Geohash" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с системой Geohash</a> </nav> </div> <a href=../../sql-reference/functions/functions-for-nulls/ title="Функции для работы с Nullable-аргументами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с Nullable-аргументами</a> <a href=../../sql-reference/functions/machine-learning-functions/ title="Функции машинного обучения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции машинного обучения</a> <a href=../../sql-reference/functions/introspection/ title="Функции интроспекции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции интроспекции</a> <a href=../../sql-reference/functions/other-functions/ title="Прочие функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие функции</a> <a href=../../sql-reference/functions/encryption-functions/ title="Функции для шифрования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для шифрования</a> <a href=../../sql-reference/functions/tuple-functions/ title="Функции для работы с кортежами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с кортежами</a> </nav> </div> <a href=#sidebar-sidebar-5-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-6 title="Агрегатные функции" class="nav-link text-light dropdown-toggle px-0">Агрегатные функции</a> <div id=sidebar-sidebar-5-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/aggregate-functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-5-6-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-6-2 title=Справочник class="nav-link text-light dropdown-toggle px-0">Справочник</a> <div id=sidebar-sidebar-5-6-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/aggregate-functions/reference/count/ title=count class="nav-link text-light text-wrap d-inline-block w-100 px-0">count</a> <a href=../../sql-reference/aggregate-functions/reference/min/ title=min class="nav-link text-light text-wrap d-inline-block w-100 px-0">min</a> <a href=../../sql-reference/aggregate-functions/reference/max/ title=max class="nav-link text-light text-wrap d-inline-block w-100 px-0">max</a> <a href=../../sql-reference/aggregate-functions/reference/sum/ title=sum class="nav-link text-light text-wrap d-inline-block w-100 px-0">sum</a> <a href=../../sql-reference/aggregate-functions/reference/avg/ title=avg class="nav-link text-light text-wrap d-inline-block w-100 px-0">avg</a> <a href=../../sql-reference/aggregate-functions/reference/any/ title=any class="nav-link text-light text-wrap d-inline-block w-100 px-0">any</a> <a href=../../sql-reference/aggregate-functions/reference/stddevpop/ title=stddevPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevPop</a> <a href=../../sql-reference/aggregate-functions/reference/stddevsamp/ title=stddevSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevSamp</a> <a href=../../sql-reference/aggregate-functions/reference/varpop/ title=varPop(x) class="nav-link text-light text-wrap d-inline-block w-100 px-0">varPop(x)</a> <a href=../../sql-reference/aggregate-functions/reference/varsamp/ title=varSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">varSamp</a> <a href=../../sql-reference/aggregate-functions/reference/covarpop/ title=covarPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarPop</a> <a href=../../sql-reference/aggregate-functions/reference/covarsamp/ title=covarSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarSamp</a> <a href=../../sql-reference/aggregate-functions/reference/anyheavy/ title=anyHeavy class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyHeavy</a> <a href=../../sql-reference/aggregate-functions/reference/anylast/ title=anyLast class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyLast</a> <a href=../../sql-reference/aggregate-functions/reference/argmin/ title=argMin class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMin</a> <a href=../../sql-reference/aggregate-functions/reference/argmax/ title=argMax class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMax</a> <a href=../../sql-reference/aggregate-functions/reference/avgweighted/ title=avgWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">avgWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/corr/ title=corr class="nav-link text-light text-wrap d-inline-block w-100 px-0">corr</a> <a href=../../sql-reference/aggregate-functions/reference/topk/ title=topK class="nav-link text-light text-wrap d-inline-block w-100 px-0">topK</a> <a href=../../sql-reference/aggregate-functions/reference/topkweighted/ title=topKWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">topKWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/grouparray/ title=groupArray class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArray</a> <a href=../../sql-reference/aggregate-functions/reference/groupuniqarray/ title=groupUniqArray class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupUniqArray</a> <a href=../../sql-reference/aggregate-functions/reference/grouparrayinsertat/ title=groupArrayInsertAt class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayInsertAt</a> <a href=../../sql-reference/aggregate-functions/reference/grouparraymovingsum/ title=groupArrayMovingSum class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingSum</a> <a href=../../sql-reference/aggregate-functions/reference/grouparraymovingavg/ title=groupArrayMovingAvg class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingAvg</a> <a href=../../sql-reference/aggregate-functions/reference/grouparraysample/ title=groupArraySample class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArraySample</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitand/ title=groupBitAnd class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitAnd</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitor/ title=groupBitOr class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitOr</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitxor/ title=groupBitXor class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitXor</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitmap/ title=groupBitmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmap</a> <a href=../../sql-reference/aggregate-functions/reference/sumwithoverflow/ title=sumWithOverflow class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumWithOverflow</a> <a href=../../sql-reference/aggregate-functions/reference/summap/ title="sumMap(key, value), sumMap(Tuple(key, value))" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumMap(key, value), sumMap(Tuple(key, value))</a> <a href=../../sql-reference/aggregate-functions/reference/minmap/ title=minMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">minMap</a> <a href=../../sql-reference/aggregate-functions/reference/maxmap/ title=maxMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">maxMap</a> <a href=../../sql-reference/aggregate-functions/reference/initializeAggregation/ title=initializeAggregation class="nav-link text-light text-wrap d-inline-block w-100 px-0">initializeAggregation</a> <a href=../../sql-reference/aggregate-functions/reference/skewpop/ title=skewPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewPop</a> <a href=../../sql-reference/aggregate-functions/reference/skewsamp/ title=skewSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewSamp</a> <a href=../../sql-reference/aggregate-functions/reference/kurtpop/ title=kurtPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtPop</a> <a href=../../sql-reference/aggregate-functions/reference/kurtsamp/ title=kurtSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtSamp</a> <a href=../../sql-reference/aggregate-functions/reference/uniq/ title=uniq class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniq</a> <a href=../../sql-reference/aggregate-functions/reference/uniqexact/ title=uniqExact class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqExact</a> <a href=../../sql-reference/aggregate-functions/reference/uniqcombined/ title=uniqCombined class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined</a> <a href=../../sql-reference/aggregate-functions/reference/uniqcombined64/ title=uniqCombined64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined64</a> <a href=../../sql-reference/aggregate-functions/reference/uniqhll12/ title=uniqHLL12 class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqHLL12</a> <a href=../../sql-reference/aggregate-functions/reference/quantile/ title=quantile class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantile</a> <a href=../../sql-reference/aggregate-functions/reference/quantiles/ title=quantiles class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantiles</a> <a href=../../sql-reference/aggregate-functions/reference/quantileexact/ title=quantileExact class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExact</a> <a href=../../sql-reference/aggregate-functions/reference/quantileexactweighted/ title=quantileExactWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExactWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletiming/ title=quantileTiming class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTiming</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletimingweighted/ title=quantileTimingWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTimingWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/quantiledeterministic/ title=quantileDeterministic class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileDeterministic</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletdigest/ title=quantileTDigest class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigest</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletdigestweighted/ title=quantileTDigestWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigestWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/simplelinearregression/ title=simpleLinearRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">simpleLinearRegression</a> <a href=../../sql-reference/aggregate-functions/reference/stochasticlinearregression/ title=stochasticLinearRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLinearRegression</a> <a href=../../sql-reference/aggregate-functions/reference/stochasticlogisticregression/ title=stochasticLogisticRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLogisticRegression</a> <a href=../../sql-reference/aggregate-functions/reference/studentttest/ title=studentTTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">studentTTest</a> <a href=../../sql-reference/aggregate-functions/reference/welchttest/ title=welchTTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">welchTTest</a> <a href=../../sql-reference/aggregate-functions/reference/mannwhitneyutest/ title=mannWhitneyUTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">mannWhitneyUTest</a> <a href=../../sql-reference/aggregate-functions/reference/median/ title=median class="nav-link text-light text-wrap d-inline-block w-100 px-0">median</a> <a href=../../sql-reference/aggregate-functions/reference/rankCorr/ title=rankCorr class="nav-link text-light text-wrap d-inline-block w-100 px-0">rankCorr</a> </nav> </div> <a href=../../sql-reference/aggregate-functions/combinators/ title="Комбинаторы агрегатных функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Комбинаторы агрегатных функций</a> <a href=../../sql-reference/aggregate-functions/parametric-functions/ title="Параметрические агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Параметрические агрегатные функции</a> </nav> </div> <a href=#sidebar-sidebar-5-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-7 title="Табличные функции" class="nav-link text-light dropdown-toggle px-0">Табличные функции</a> <div id=sidebar-sidebar-5-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/table-functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../sql-reference/table-functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../sql-reference/table-functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../sql-reference/table-functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../sql-reference/table-functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../sql-reference/table-functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../sql-reference/table-functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../sql-reference/table-functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../sql-reference/table-functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../sql-reference/table-functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../sql-reference/table-functions/input/ title=input class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a> <a href=../../sql-reference/table-functions/generate/ title=generateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">generateRandom</a> <a href=../../sql-reference/table-functions/cluster/ title=cluster class="nav-link text-light text-wrap d-inline-block w-100 px-0">cluster</a> <a href=../../sql-reference/table-functions/null/ title="null функция" class="nav-link text-light text-wrap d-inline-block w-100 px-0">null функция</a> <a href=../../sql-reference/table-functions/view/ title=view class="nav-link text-light text-wrap d-inline-block w-100 px-0">view</a> </nav> </div> <a href=#sidebar-sidebar-5-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8 title=Словари class="nav-link text-light dropdown-toggle px-0">Словари</a> <div id=sidebar-sidebar-5-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/dictionaries/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-5-8-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8-2 title="Внешние словари" class="nav-link text-light dropdown-toggle px-0">Внешние словари</a> <div id=sidebar-sidebar-5-8-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts/ title="Внешние словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние словари</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict/ title="Настройка внешнего словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройка внешнего словаря</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/ title="Хранение словарей в памяти" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение словарей в памяти</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-lifetime/ title="Обновление словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление словарей</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources/ title="Источники внешних словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Источники внешних словарей</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-structure/ title="Ключ и поля словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ключ и поля словаря</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-hierarchical/ title="Иерархические словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Иерархические словари</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-polygon/ title="Cловари полигонов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Cловари полигонов</a> </nav> </div> <a href=../../sql-reference/dictionaries/internal-dicts/ title="Встроенные словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Встроенные словари</a> </nav> </div> <a href=#sidebar-sidebar-5-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9 title="Типы данных" class="nav-link text-light dropdown-toggle px-0">Типы данных</a> <div id=sidebar-sidebar-5-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../sql-reference/data-types/int-uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../sql-reference/data-types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../sql-reference/data-types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../sql-reference/data-types/boolean/ title="Булевы значения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Булевы значения</a> <a href=../../sql-reference/data-types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../sql-reference/data-types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../sql-reference/data-types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../sql-reference/data-types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../sql-reference/data-types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../sql-reference/data-types/datetime64/ title=DateTime64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime64</a> <a href=../../sql-reference/data-types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../sql-reference/data-types/lowcardinality/ title=LowCardinality class="nav-link text-light text-wrap d-inline-block w-100 px-0">LowCardinality</a> <a href=../../sql-reference/data-types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../sql-reference/data-types/aggregatefunction/ title=AggregateFunction class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction</a> <a href=../../sql-reference/data-types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=#sidebar-sidebar-5-9-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9-17 title="Вложенные структуры данных" class="nav-link text-light dropdown-toggle px-0">Вложенные структуры данных</a> <div id=sidebar-sidebar-5-9-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/nested-data-structures/nested/ title="Nested(Name1 Type1, Name2 Type2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, …)</a> </nav> </div> <a href=../../sql-reference/data-types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-5-9-19 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9-19 title="Служебные типы данных" class="nav-link text-light dropdown-toggle px-0">Служебные типы данных</a> <div id=sidebar-sidebar-5-9-19 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/special-data-types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../sql-reference/data-types/special-data-types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../sql-reference/data-types/special-data-types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> <a href=../../sql-reference/data-types/special-data-types/interval/ title=Interval class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interval</a> </nav> </div> <a href=#sidebar-sidebar-5-9-20 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9-20 title=Домены class="nav-link text-light dropdown-toggle px-0">Домены</a> <div id=sidebar-sidebar-5-9-20 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/domains/ title=Домены class="nav-link text-light text-wrap d-inline-block w-100 px-0">Домены</a> <a href=../../sql-reference/data-types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../sql-reference/data-types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> <a href=../../sql-reference/data-types/multiword-types/ title="Составные типы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Составные типы</a> <a href=../../sql-reference/data-types/geo/ title="Географические структуры" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Географические структуры</a> <a href=../../sql-reference/data-types/map/ title="Map(key, value)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Map(key, value)</a> <a href=../../sql-reference/data-types/simpleaggregatefunction/ title="SimpleAggregateFunction(func, type)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SimpleAggregateFunction(func, type)</a> </nav> </div> <a href=#sidebar-sidebar-5-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-10 title=Операторы class="nav-link text-light dropdown-toggle px-0">Операторы</a> <div id=sidebar-sidebar-5-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/operators/ title=Операторы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы</a> <a href=../../sql-reference/operators/in/ title="Операторы IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы IN</a> </nav> </div> <a href=../../sql-reference/ansi/ title="ANSI Compatibility" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ANSI Compatibility</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=Руководства class="nav-link text-light dropdown-toggle px-0">Руководства</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../guides/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../guides/apply-catboost-model/ title="Применение модели CatBoost в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение модели CatBoost в ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=Эксплуатация class="nav-link text-light dropdown-toggle px-0">Эксплуатация</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=Эксплуатация class="nav-link text-light text-wrap d-inline-block w-100 px-0">Эксплуатация</a> <a href=../../operations/requirements/ title=Требования class="nav-link text-light text-wrap d-inline-block w-100 px-0">Требования</a> <a href=../../operations/monitoring/ title=Мониторинг class="nav-link text-light text-wrap d-inline-block w-100 px-0">Мониторинг</a> <a href=../../operations/troubleshooting/ title="Устранение неисправностей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Устранение неисправностей</a> <a href=../../operations/update/ title="Обновление ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление ClickHouse</a> <a href=../../operations/access-rights/ title="Управление доступом" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Управление доступом</a> <a href=../../operations/backup/ title="Резервное копирование данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Резервное копирование данных</a> <a href=../../operations/configuration-files/ title="Конфигурационные файлы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные файлы</a> <a href=../../operations/quotas/ title=Квоты class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квоты</a> <a href=#sidebar-sidebar-7-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-10 title="Optimizing Performance" class="nav-link text-light dropdown-toggle px-0">Optimizing Performance</a> <div id=sidebar-sidebar-7-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/optimizing-performance/sampling-query-profiler/ title="Query Profiling" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Query Profiling</a> </nav> </div> <a href=#sidebar-sidebar-7-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11 title="Системные таблицы" class="nav-link text-light dropdown-toggle px-0">Системные таблицы</a> <div id=sidebar-sidebar-7-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/system-tables/ title="Системные таблицы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Системные таблицы</a> <a href=../../operations/system-tables/asynchronous_metric_log/ title=system.asynchronous_metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.asynchronous_metric_log</a> <a href=../../operations/system-tables/asynchronous_metrics/ title=system.asynchronous_metrics class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.asynchronous_metrics</a> <a href=../../operations/system-tables/clusters/ title=system.clusters class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.clusters</a> <a href=../../operations/system-tables/columns/ title=system.columns class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.columns</a> <a href=../../operations/system-tables/contributors/ title=system.contributors class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.contributors</a> <a href=../../operations/system-tables/crash-log/ title=system.crash_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.crash_log</a> <a href=../../operations/system-tables/current-roles/ title=system.current_roles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.current_roles</a> <a href=../../operations/system-tables/data_type_families/ title=system.data_type_families class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.data_type_families</a> <a href=../../operations/system-tables/databases/ title=system.databases class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.databases</a> <a href=../../operations/system-tables/detached_parts/ title=system.detached_parts class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.detached_parts</a> <a href=../../operations/system-tables/dictionaries/ title=system.dictionaries class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.dictionaries</a> <a href=../../operations/system-tables/disks/ title=system.disks class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.disks</a> <a href=../../operations/system-tables/distributed_ddl_queue/ title=system.distributed_ddl_queue class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.distributed_ddl_queue</a> <a href=../../operations/system-tables/distribution_queue/ title=system.distribution_queue class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.distribution_queue</a> <a href=../../operations/system-tables/enabled-roles/ title=system.enabled_roles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.enabled_roles</a> <a href=../../operations/system-tables/errors/ title=system.errors class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.errors</a> <a href=../../operations/system-tables/events/ title=system.events class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.events</a> <a href=../../operations/system-tables/functions/ title=system.functions class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.functions</a> <a href=../../operations/system-tables/grants/ title=system.grants class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.grants</a> <a href=../../operations/system-tables/graphite_retentions/ title=system.graphite_retentions class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.graphite_retentions</a> <a href=../../operations/system-tables/licenses/ title=system.licenses class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.licenses</a> <a href=../../operations/system-tables/merges/ title=system.merges class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.merges</a> <a href=../../operations/system-tables/metric_log/ title=system.metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.metric_log</a> <a href=../../operations/system-tables/metrics/ title=system.metrics class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.metrics</a> <a href=../../operations/system-tables/mutations/ title=system.mutations class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.mutations</a> <a href=../../operations/system-tables/numbers/ title=system.numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.numbers</a> <a href=../../operations/system-tables/numbers_mt/ title=system.numbers_mt class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.numbers_mt</a> <a href=../../operations/system-tables/one/ title=system.one class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.one</a> <a href=../../operations/system-tables/opentelemetry_span_log/ title=system.opentelemetry_span_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.opentelemetry_span_log</a> <a href=../../operations/system-tables/part_log/ title=system.part_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.part_log</a> <a href=../../operations/system-tables/parts/ title=system.parts class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.parts</a> <a href=../../operations/system-tables/parts_columns/ title=system.parts_columns class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.parts_columns</a> <a href=../../operations/system-tables/processes/ title=system.processes class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.processes</a> <a href=../../operations/system-tables/query_log/ title=system.query_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_log</a> <a href=../../operations/system-tables/query_thread_log/ title=system.query_thread_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_thread_log</a> <a href=../../operations/system-tables/quota_limits/ title=system.quota_limits class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quota_limits</a> <a href=../../operations/system-tables/quota_usage/ title=system.quota_usage class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quota_usage</a> <a href=../../operations/system-tables/quotas/ title=system.quotas class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quotas</a> <a href=../../operations/system-tables/quotas_usage/ title=system.quotas_usage class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quotas_usage</a> <a href=../../operations/system-tables/replicas/ title=system.replicas class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replicas</a> <a href=../../operations/system-tables/replicated_fetches/ title=system.replicated_fetches class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replicated_fetches</a> <a href=../../operations/system-tables/replication_queue/ title=system.replication_queue class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replication_queue</a> <a href=../../operations/system-tables/role-grants/ title=system.role_grants class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.role_grants</a> <a href=../../operations/system-tables/roles/ title=system.roles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.roles</a> <a href=../../operations/system-tables/row_policies/ title=system.row_policies class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.row_policies</a> <a href=../../operations/system-tables/settings/ title=system.settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings</a> <a href=../../operations/system-tables/settings_profile_elements/ title=system.settings_profile_elements class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings_profile_elements</a> <a href=../../operations/system-tables/settings_profiles/ title=system.settings_profiles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings_profiles</a> <a href=../../operations/system-tables/stack_trace/ title=system.stack_trace class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.stack_trace</a> <a href=../../operations/system-tables/storage_policies/ title=system.storage_policies class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.storage_policies</a> <a href=../../operations/system-tables/table_engines/ title=system.table_engines class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.table_engines</a> <a href=../../operations/system-tables/tables/ title=system.tables class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.tables</a> <a href=../../operations/system-tables/text_log/ title=system.text_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.text_log</a> <a href=../../operations/system-tables/trace_log/ title=system.trace_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.trace_log</a> <a href=../../operations/system-tables/users/ title=system.users class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.users</a> <a href=../../operations/system-tables/zookeeper/ title=system.zookeeper class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.zookeeper</a> </nav> </div> <a href=../../operations/performance-test/ title="Testing Hardware" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Testing Hardware</a> <a href=#sidebar-sidebar-7-13 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-13 title="Конфигурационные параметры сервера" class="nav-link text-light dropdown-toggle px-0">Конфигурационные параметры сервера</a> <div id=sidebar-sidebar-7-13 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server-configuration-parameters/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../operations/server-configuration-parameters/settings/ title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные параметры сервера</a> </nav> </div> <a href=#sidebar-sidebar-7-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-14 title=Settings class="nav-link text-light dropdown-toggle px-0">Settings</a> <div id=sidebar-sidebar-7-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../operations/settings/permissions-for-queries/ title="Разрешения для запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разрешения для запросов</a> <a href=../../operations/settings/query-complexity/ title="Ограничения на сложность запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на сложность запроса</a> <a href=../../operations/settings/settings/ title=Настройки class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки</a> <a href=../../operations/settings/settings-profiles/ title="Профили настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профили настроек</a> <a href=../../operations/settings/constraints-on-settings/ title="Ограничения на изменение настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на изменение настроек</a> <a href=../../operations/settings/settings-users/ title="Настройки пользователей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки пользователей</a> <a href=../../operations/settings/merge-tree-settings/ title="Настройки MergeTree таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки MergeTree таблиц</a> </nav> </div> <a href=#sidebar-sidebar-7-15 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-15 title=Утилиты class="nav-link text-light dropdown-toggle px-0">Утилиты</a> <div id=sidebar-sidebar-7-15 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utilities/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../operations/utilities/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utilities/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> <a href=../../operations/utilities/clickhouse-benchmark/ title=clickhouse-benchmark class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-benchmark</a> <a href=../../operations/utilities/clickhouse-obfuscator/ title="Обфускатор ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обфускатор ClickHouse</a> </nav> </div> <a href=../../operations/tips/ title="Советы по эксплуатации" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Советы по эксплуатации</a> <a href=../../operations/opentelemetry/ title="Поддержка OpenTelemetry" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поддержка OpenTelemetry</a> <a href=../../operations/caches/ title=Кеши class="nav-link text-light text-wrap d-inline-block w-100 px-0">Кеши</a> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=Development class="nav-link text-light dropdown-toggle px-0">Development</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/developer-instruction/ title="Инструкция для разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Инструкция для разработчиков</a> <a href=../../development/architecture/ title="Обзор архитектуры ClickHouse" class="nav-link text-white active text-wrap d-inline-block w-100 px-0">Обзор архитектуры ClickHouse</a> <a href=../../development/build/ title="Build on Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux</a> <a href=../../development/build-osx/ title="Build on Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Mac OS X</a> <a href=../../development/build-cross-osx/ title="Build on Linux for Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux for Mac OS X</a> <a href=../../development/build-cross-arm/ title="Build on Linux for AARCH64 (ARM64)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux for AARCH64 (ARM64)</a> <a href=../../development/style/ title="Как писать код на C++" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как писать код на C++</a> <a href=../../development/tests/ title=Testing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Testing</a> <a href=../../development/contrib/ title="Используемые сторонние библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Используемые сторонние библиотеки</a> <a href=../../development/browse-code/ title="Навигация по коду ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Навигация по коду ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title="Коммерческие услуги" class="nav-link text-light dropdown-toggle px-0">Коммерческие услуги</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../commercial/cloud/ title="Поставщики облачных услуг ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поставщики облачных услуг ClickHouse</a> <a href=../../commercial/support/ title=Support class="nav-link text-light text-wrap d-inline-block w-100 px-0">Support</a> <a href=../../commercial/ title="Коммерческие услуги" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Коммерческие услуги</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=F.A.Q. class="nav-link text-light dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title="Общие вопросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общие вопросы</a> <a href=../../faq/use-cases/ title=Применение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение</a> <a href=../../faq/operations/ title=Операции class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операции</a> <a href=../../faq/integration/ title=Интеграция class="nav-link text-light text-wrap d-inline-block w-100 px-0">Интеграция</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title="Что нового?" class="nav-link text-light dropdown-toggle px-0">Что нового?</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-11-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11-1 title=Changelog class="nav-link text-light dropdown-toggle px-0">Changelog</a> <div id=sidebar-sidebar-11-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../whats-new/changelog/ title=2021 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2021</a> <a href=../../whats-new/changelog/2019/ title=2019 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2019</a> <a href=../../whats-new/changelog/2018/ title=2018 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2018</a> <a href=../../whats-new/changelog/2017/ title=2017 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2017</a> </nav> </div> <a href=../../whats-new/extended-roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> <a href=../../whats-new/security-changelog/ title="Security Changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security Changelog</a> <a href=../../whats-new/ title="Что нового в ClickHouse?" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Что нового в ClickHouse?</a> </nav> </div> <a href=../../single/clickhouse_ru.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt="PDF version" title="PDF version" height=24 class="d-block mr-1 float-left"><div>PDF version</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-4"> <div id=content class=mt-md-n3> <nav class=text-muted aria-label=breadcrumb> <ol class="breadcrumb bg-transparent p-0"> <li class=breadcrumb-item><a href=../ class=text-reset>Development</a> </li> </ol> </nav> <h1 id=overview-of-clickhouse-architecture>Обзор архитектуры ClickHouse<a class=headerlink href=#overview-of-clickhouse-architecture title="Permanent link"> </a></h1> <p>ClickHouse - полноценная колоночная СУБД. Данные хранятся в колонках, а в процессе обработки - в массивах (векторах или фрагментах (chunk’ах) колонок). По возможности операции выполняются на массивах, а не на индивидуальных значениях. Это называется “векторизованное выполнения запросов” (vectorized query execution), и помогает снизить стоимость фактической обработки данных.</p> <blockquote> <p>Эта идея не нова. Такой подход использовался в <code class=syntax>APL</code> (A programming language, 1957) и его потомках: <code class=syntax>A +</code> (диалект <code class=syntax>APL</code>), <code class=syntax>J</code> (1990), <code class=syntax>K</code> (1993) и <code class=syntax>Q</code> (язык программирования Kx Systems, 2003). Программирование на массивах (Array programming) используется в научных вычислительных системах. Эта идея не является чем-то новым и для реляционных баз данных: например, она используется в системе <code class=syntax>VectorWise</code> (так же известной как Actian Vector Analytic Database от Actian Corporation).</p> </blockquote> <p>Существует два различных подхода для увеличения скорости обработки запросов: выполнение векторизованного запроса и генерация кода во время выполнения (runtime code generation). В последнем случае код генерируется на лету для каждого типа запроса, удаляя все косвенные и динамические обращения. Ни один из этих подходов не имеет явного преимущества. Генерация кода во время выполнения выигрывает, если объединяет большое число операций, таким образом полностью используя вычислительные блоки и конвейер CPU. Выполнение векторизованного запроса может быть менее практично потому, что задействует временные векторы данных, которые должны быть записаны и прочитаны из кэша. Если временные данные не помещаются в L2 кэш, будут проблемы. С другой стороны выполнение векторизованного запроса упрощает использование SIMD инструкций CPU. <a href=http://15721.courses.cs.cmu.edu/spring2016/papers/p5-sompolski.pdf rel="external nofollow noreferrer" target=_blank>Научная работа</a> наших друзей показывает преимущества сочетания обоих подходов. ClickHouse использует выполнение векторизованного запроса и имеет ограниченную начальную поддержку генерации кода во время выполнения.</p> <h2 id=columns>Колонки<a class=headerlink href=#columns title="Permanent link"> </a></h2> <p>Для представления столбцов в памяти (фактически, фрагментов столбцов) используется интерфейс <code class=syntax>IColumn</code>. Интерфейс предоставляет вспомогательные методы для реализации различных реляционных операторов. Почти все операции иммутабельные: они не изменяют оригинальных колонок, а создают новую с измененными значениями. Например, метод <code class=syntax>IColumn :: filter</code> принимает фильтр - набор байт. Он используется для реляционных операторов <code class=syntax>WHERE</code> и <code class=syntax>HAVING</code>. Другой пример: метод <code class=syntax>IColumn :: permute</code> используется для поддержки <code class=syntax>ORDER BY</code>, метод <code class=syntax>IColumn :: cut</code> - <code class=syntax>LIMIT</code> и т. д.</p> <p>Различные реализации <code class=syntax>IColumn</code> (<code class=syntax>ColumnUInt8</code>, <code class=syntax>ColumnString</code> и т. д.) отвечают за распределение данных колонки в памяти. Для колонок целочисленного типа это один смежный массив, такой как <code class=syntax>std :: vector</code>. Для колонок типа <code class=syntax>String</code> и <code class=syntax>Array</code> это два вектора: один для всех элементов массивов, располагающихся смежно, второй для хранения смещения до начала каждого массива. Также существует реализация <code class=syntax>ColumnConst</code>, в которой хранится только одно значение в памяти, но выглядит как колонка.</p> <h2 id=field>Поля<a class=headerlink href=#field title="Permanent link"> </a></h2> <p>Тем не менее, можно работать и с индивидуальными значениями. Для представления индивидуальных значений используется <code class=syntax>Поле</code> (<code class=syntax>Field</code>). <code class=syntax>Field</code> - размеченное объединение <code class=syntax>UInt64</code>, <code class=syntax>Int64</code>, <code class=syntax>Float64</code>, <code class=syntax>String</code> и <code class=syntax>Array</code>. <code class=syntax>IColumn</code> имеет метод <code class=syntax>оператор []</code> для получения значения по индексу n как <code class=syntax>Field</code>, а также метод insert для добавления <code class=syntax>Field</code> в конец колонки. Эти методы не очень эффективны, так как требуют временных объектов <code class=syntax>Field</code>, представляющих индивидуальное значение. Есть более эффективные методы, такие как <code class=syntax>insertFrom</code>, <code class=syntax>insertRangeFrom</code> и т.д.</p> <p><code class=syntax>Field</code> не несет в себе достаточно информации о конкретном типе данных в таблице. Например, <code class=syntax>UInt8</code>, <code class=syntax>UInt16</code>, <code class=syntax>UInt32</code> и <code class=syntax>UInt64</code> в <code class=syntax>Field</code> представлены как <code class=syntax>UInt64</code>.</p> <h2 id=leaky-abstractions>Дырявые абстракции (Leaky Abstractions)<a class=headerlink href=#leaky-abstractions title="Permanent link"> </a></h2> <p><code class=syntax>IColumn</code> предоставляет методы для общих реляционных преобразований данных, но они не отвечают всем потребностям. Например, <code class=syntax>ColumnUInt64</code> не имеет метода для вычисления суммы двух столбцов, а <code class=syntax>ColumnString</code> не имеет метода для запуска поиска по подстроке. Эти бесчисленные процедуры реализованы вне <code class=syntax>IColumn</code>.</p> <p>Различные функции на колонках могут быть реализованы обобщенным, неэффективным путем, используя <code class=syntax>IColumn</code> методы для извлечения значений <code class=syntax>Field</code>, или специальным путем, используя знания о внутреннем распределение данных в памяти в конкретной реализации <code class=syntax>IColumn</code>. Для этого функции приводятся к конкретному типу <code class=syntax>IColumn</code> и работают напрямую с его внутренним представлением. Например, в <code class=syntax>ColumnUInt64</code> есть метод getData, который возвращает ссылку на внутренний массив, чтение и заполнение которого, выполняется отдельной процедурой напрямую. Фактически, мы имеем "дырявую абстракции", обеспечивающие эффективные специализации различных процедур.</p> <h2 id=data_types>Типы данных (Data Types)<a class=headerlink href=#data_types title="Permanent link"> </a></h2> <p><code class=syntax>IDataType</code> отвечает за сериализацию и десериализацию - чтение и запись фрагментов колонок или индивидуальных значений в бинарном или текстовом формате.<br> <code class=syntax>IDataType</code> точно соответствует типам данных в таблицах - <code class=syntax>DataTypeUInt32</code>, <code class=syntax>DataTypeDateTime</code>, <code class=syntax>DataTypeString</code> и т. д.</p> <p><code class=syntax>IDataType</code> и <code class=syntax>IColumn</code> слабо связаны друг с другом. Различные типы данных могут быть представлены в памяти с помощью одной реализации <code class=syntax>IColumn</code>. Например, и <code class=syntax>DataTypeUInt32</code>, и <code class=syntax>DataTypeDateTime</code> в памяти представлены как <code class=syntax>ColumnUInt32</code> или <code class=syntax>ColumnConstUInt32</code>. В добавок к этому, один тип данных может быть представлен различными реализациями <code class=syntax>IColumn</code>. Например, <code class=syntax>DataTypeUInt8</code> может быть представлен как <code class=syntax>ColumnUInt8</code> и <code class=syntax>ColumnConstUInt8</code>.</p> <p><code class=syntax>IDataType</code> хранит только метаданные. Например, <code class=syntax>DataTypeUInt8</code> не хранить ничего (кроме скрытого указателя <code class=syntax>vptr</code>), а <code class=syntax>DataTypeFixedString</code> хранит только <code class=syntax>N</code> (фиксированный размер строки).</p> <p>В <code class=syntax>IDataType</code> есть вспомогательные методы для данных различного формата. Среди них методы сериализации значений, допускающих использование кавычек, сериализации значения в JSON или XML. Среди них нет прямого соответствия форматам данных. Например, различные форматы <code class=syntax>Pretty</code> и <code class=syntax>TabSeparated</code> могут использовать один вспомогательный метод <code class=syntax>serializeTextEscaped</code> интерфейса <code class=syntax>IDataType</code>.</p> <h2 id=block>Блоки (Block)<a class=headerlink href=#block title="Permanent link"> </a></h2> <p><code class=syntax>Block</code> это контейнер, который представляет фрагмент (chunk) таблицы в памяти. Это набор троек - <code class=syntax>(IColumn, IDataType, имя колонки)</code>. В процессе выполнения запроса, данные обрабатываются <code class=syntax>Block</code>ами. Если у нас есть <code class=syntax>Block</code>, значит у нас есть данные (в объекте <code class=syntax>IColumn</code>), информация о типе (в <code class=syntax>IDataType</code>), которая говорит нам, как работать с колонкой, и имя колонки (оригинальное имя колонки таблицы или служебное имя, присвоенное для получения промежуточных результатов вычислений).</p> <p>При вычислении некоторой функции на колонках в блоке мы добавляем еще одну колонку с результатами в блок, не трогая колонки аргументов функции, потому что операции иммутабельные. Позже ненужные колонки могут быть удалены из блока, но не модифицированы. Это удобно для устранения общих подвыражений.</p> <p>Блоки создаются для всех обработанных фрагментов данных. Напоминаем, что одни и те же типы вычислений, имена колонок и типы переиспользуются в разных блоках и только данные колонок изменяются. Лучше разделить данные и заголовок блока потому, что в блоках маленького размера мы имеем большой оверхэд по временным строкам при копировании умных указателей (<code class=syntax>shared_ptrs</code>) и имен колонок.</p> <h2 id=block-streams>Потоки блоков (Block Streams)<a class=headerlink href=#block-streams title="Permanent link"> </a></h2> <p>Потоки блоков обрабатывают данные. Мы используем потоки блоков для чтения данных, трансформации или записи данных куда-либо. <code class=syntax>IBlockInputStream</code> предоставляет метод <code class=syntax>read</code> для получения следующего блока, пока это возможно, и метод <code class=syntax>write</code>, чтобы продвигать (push) блок куда-либо.</p> <p>Потоки отвечают за:</p> <ol> <li>Чтение и запись в таблицу. Таблица лишь возвращает поток для чтения или записи блоков.</li> <li>Реализацию форматов данных. Например, при выводе данных в терминал в формате <code class=syntax>Pretty</code>, вы создаете выходной поток блоков, который форматирует поступающие в него блоки.</li> <li>Трансформацию данных. Допустим, у вас есть <code class=syntax>IBlockInputStream</code> и вы хотите создать отфильтрованный поток. Вы создаете <code class=syntax>FilterBlockInputStream</code> и инициализируете его вашим потоком. Затем вы тянете (pull) блоки из <code class=syntax>FilterBlockInputStream</code>, а он тянет блоки исходного потока, фильтрует их и возвращает отфильтрованные блоки вам. Таким образом построены конвейеры выполнения запросов.</li> </ol> <p>Имеются и более сложные трансформации. Например, когда вы тянете блоки из <code class=syntax>AggregatingBlockInputStream</code>, он считывает все данные из своего источника, агрегирует их, и возвращает поток агрегированных данных вам. Другой пример: конструктор <code class=syntax>UnionBlockInputStream</code> принимает множество источников входных данных и число потоков. Такой <code class=syntax>Stream</code> работает в несколько потоков и читает данные источников параллельно. </p> <blockquote> <p>Потоки блоков используют «втягивающий» (pull) подход к управлению потоком выполнения: когда вы вытягиваете блок из первого потока, он, следовательно, вытягивает необходимые блоки из вложенных потоков, так и работает весь конвейер выполнения. Ни «pull» ни «push» не имеют явного преимущества, потому что поток управления неявный, и это ограничивает в реализации различных функций, таких как одновременное выполнение нескольких запросов (слияние нескольких конвейеров вместе). Это ограничение можно преодолеть с помощью сопрограмм (coroutines) или просто запуском дополнительных потоков, которые ждут друг друга. У нас может быть больше возможностей, если мы сделаем поток управления явным: если мы локализуем логику для передачи данных из одной расчетной единицы в другую вне этих расчетных единиц. Читайте эту <a href=http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/ rel="external nofollow noreferrer" target=_blank>статью</a> для углубленного изучения.</p> </blockquote> <p>Следует отметить, что конвейер выполнения запроса создает временные данные на каждом шаге. Мы стараемся сохранить размер блока достаточно маленьким, чтобы временные данные помещались в кэш процессора. При таком допущении запись и чтение временных данных практически бесплатны по сравнению с другими расчетами. Мы могли бы рассмотреть альтернативу, которая заключается в том, чтобы объединить многие операции в конвеере вместе. Это может сделать конвейер как можно короче и удалить большую часть временных данных, что может быть преимуществом, но у такого подхода также есть недостатки. Например, разделенный конвейер позволяет легко реализовать кэширование промежуточных данных, использование промежуточных данных из аналогичных запросов, выполняемых одновременно, и объединение конвейеров для аналогичных запросов.</p> <h2 id=formats>Форматы<a class=headerlink href=#formats title="Permanent link"> </a></h2> <p>Форматы данных реализуются с помощью потоков блоков. Есть форматы представления (presentational), пригодные только для вывода данных клиенту, такие как <code class=syntax>Pretty</code> формат, который предоставляет только <code class=syntax>IBlockOutputStream</code>. И есть форматы ввода/вывода, такие как <code class=syntax>TabSeparated</code> или <code class=syntax>JSONEachRow</code>.</p> <p>Существуют также потоки строк: <code class=syntax>IRowInputStream</code> и <code class=syntax>IRowOutputStream</code>. Они позволяют вытягивать/выталкивать данные отдельными строками, а не блоками. Они нужны только для упрощения реализации ориентированных на строки форматов. Обертка <code class=syntax>BlockInputStreamFromRowInputStream</code> и <code class=syntax>BlockOutputStreamFromRowOutputStream</code> позволяет конвертировать потоки, ориентированные на строки, в обычные потоки, ориентированные на блоки.</p> <h2 id=io>I/O<a class=headerlink href=#io title="Permanent link"> </a></h2> <p>Для байт-ориентированных ввода/вывода существуют абстрактные классы <code class=syntax>ReadBuffer</code> и <code class=syntax>WriteBuffer</code>. Они используются вместо C++ <code class=syntax>iostream</code>. Не волнуйтесь: каждый зрелый проект C++ использует что-то другое вместо <code class=syntax>iostream</code> по уважительным причинам.</p> <p><code class=syntax>ReadBuffer</code> и <code class=syntax>WriteBuffer</code> это просто непрерывный буфер и курсор, указывающий на позицию в этом буфере. Реализации могут как владеть так и не владеть памятью буфера. Существует виртуальный метод заполнения буфера следующими данными (для <code class=syntax>ReadBuffer</code>) или сброса буфера куда-нибудь (например <code class=syntax>WriteBuffer</code>). Виртуальные методы редко вызываются.</p> <p>Реализации <code class=syntax>ReadBuffer</code>/<code class=syntax>WriteBuffer</code> используются для работы с файлами и файловыми дескрипторами, а также сетевыми сокетами, для реализации сжатия (<code class=syntax>CompressedWriteBuffer</code> инициализируется вместе с другим <code class=syntax>WriteBuffer</code> и осуществляет сжатие данных перед записью в него), и для других целей – названия <code class=syntax>ConcatReadBuffer</code>, <code class=syntax>LimitReadBuffer</code>, и <code class=syntax>HashingWriteBuffer</code> говорят сами за себя.</p> <p>Буферы чтения/записи имеют дело только с байтами. В заголовочных файлах <code class=syntax>ReadHelpers</code> и <code class=syntax>WriteHelpers</code> объявлены некоторые функции, чтобы помочь с форматированием ввода/вывода. Например, есть помощники для записи числа в десятичном формате.</p> <p>Давайте посмотрим, что происходит, когда вы хотите вывести результат в <code class=syntax>JSON</code> формате в стандартный вывод (stdout). У вас есть результирующий набор данных, готовый к извлечению из <code class=syntax>IBlockInputStream</code>. Вы создаете <code class=syntax>WriteBufferFromFileDescriptor(STDOUT_FILENO)</code> чтобы записать байты в stdout. Вы создаете <code class=syntax>JSONRowOutputStream</code>, инициализируете с этим <code class=syntax>WriteBuffer</code>'ом, чтобы записать строки <code class=syntax>JSON</code> в stdout. Кроме того вы создаете <code class=syntax>BlockOutputStreamFromRowOutputStream</code>, реализуя <code class=syntax>IBlockOutputStream</code>. Затем вызывается <code class=syntax>copyData</code> для передачи данных из <code class=syntax>IBlockInputStream</code> в <code class=syntax>IBlockOutputStream</code> и все работает. Внутренний <code class=syntax>JSONRowOutputStream</code> будет писать в формате <code class=syntax>JSON</code> различные разделители и вызвать <code class=syntax>IDataType::serializeTextJSON</code> метод со ссылкой на <code class=syntax>IColumn</code> и номер строки в качестве аргументов. Следовательно, <code class=syntax>IDataType::serializeTextJSON</code> вызовет метод из <code class=syntax>WriteHelpers.h</code>: например, <code class=syntax>writeText</code> для числовых типов и <code class=syntax>writeJSONString</code> для <code class=syntax>DataTypeString</code>.</p> <h2 id=tables>Таблицы<a class=headerlink href=#tables title="Permanent link"> </a></h2> <p>Интерфейс <code class=syntax>IStorage</code> служит для отображения таблицы. Различные движки таблиц являются реализациями этого интерфейса. Примеры <code class=syntax>StorageMergeTree</code>, <code class=syntax>StorageMemory</code> и так далее. Экземпляры этих классов являются просто таблицами.</p> <p>Ключевые методы <code class=syntax>IStorage</code> это <code class=syntax>read</code> и <code class=syntax>write</code>. Есть и другие варианты - <code class=syntax>alter</code>, <code class=syntax>rename</code>, <code class=syntax>drop</code> и так далее. Метод <code class=syntax>read</code> принимает следующие аргументы: набор столбцов для чтения из таблицы, <code class=syntax>AST</code> запрос и желаемое количество потоков для вывода. Он возвращает один или несколько объектов <code class=syntax>IBlockInputStream</code> и информацию о стадии обработки данных, которая была завершена внутри табличного движка во время выполнения запроса.</p> <p>В большинстве случаев метод read отвечает только за чтение указанных столбцов из таблицы, а не за дальнейшую обработку данных. Вся дальнейшая обработка данных осуществляется интерпретатором запросов и не входит в сферу ответственности <code class=syntax>IStorage</code>.</p> <p>Но есть и заметные исключения:</p> <ul> <li>AST запрос, передающийся в метод <code class=syntax>read</code>, может использоваться движком таблицы для получения информации о возможности использования индекса и считывания меньшего количества данных из таблицы.</li> <li>Иногда движок таблиц может сам обрабатывать данные до определенного этапа. Например, <code class=syntax>StorageDistributed</code> можно отправить запрос на удаленные серверы, попросить их обработать данные до этапа, когда данные с разных удаленных серверов могут быть объединены, и вернуть эти предварительно обработанные данные. Затем интерпретатор запросов завершает обработку данных.</li> </ul> <p>Метод <code class=syntax>read</code> может возвращать несколько объектов <code class=syntax>IBlockInputStream</code>, позволяя осуществлять параллельную обработку данных. Эти несколько блочных входных потоков могут считываться из таблицы параллельно. Затем вы можете обернуть эти потоки различными преобразованиями (такими как вычисление выражений или фильтрация), которые могут быть вычислены независимо, и создать <code class=syntax>UnionBlockInputStream</code> поверх них, чтобы читать из нескольких потоков параллельно.</p> <p>Есть и другие варианты. Например, <code class=syntax>TableFunction</code> возвращает временный объект <code class=syntax>IStorage</code>, который можно подставить во <code class=syntax>FROM</code>.</p> <p>Чтобы получить быстрое представление о том, как реализовать свой движок таблиц, посмотрите на что-то простое, например <code class=syntax>StorageMemory</code> или <code class=syntax>StorageTinyLog</code>.</p> <blockquote> <p>В качестве результата выполнения метода <code class=syntax>read</code>, <code class=syntax>IStorage</code> возвращает <code class=syntax>QueryProcessingStage</code> – информацию о том, какие части запроса были обработаны внутри хранилища.</p> </blockquote> <h2 id=parsers>Парсеры (Parsers)<a class=headerlink href=#parsers title="Permanent link"> </a></h2> <p>Написанный от руки парсер, анализирующий запрос, работает по методу рекурсивного спуска. Например, <code class=syntax>ParserSelectQuery</code> просто рекурсивно вызывает нижестоящие парсеры для различных частей запроса. Парсеры создают абстрактное синтаксическое дерево (<code class=syntax>AST</code>). <code class=syntax>AST</code> представлен узлами, которые являются экземплярами <code class=syntax>IAST</code>.</p> <blockquote> <p>Генераторы парсеров не используются по историческим причинам.</p> </blockquote> <h2 id=interpreters>Интерпретаторы<a class=headerlink href=#interpreters title="Permanent link"> </a></h2> <p>Интерпретаторы отвечают за создание конвейера выполнения запроса из <code class=syntax>AST</code>. Есть простые интерпретаторы, такие как <code class=syntax>InterpreterExistsQuery</code> и <code class=syntax>InterpreterDropQuery</code> или более сложный <code class=syntax>InterpreterSelectQuery</code>. Конвейер выполнения запроса представляет собой комбинацию входных и выходных потоков блоков. Например, результатом интерпретации <code class=syntax>SELECT</code> запроса является <code class=syntax>IBlockInputStream</code> для чтения результирующего набора данных; результат интерпретации <code class=syntax>INSERT</code> запроса - это <code class=syntax>IBlockOutputStream</code>, для записи данных, предназначенных для вставки; результат интерпретации <code class=syntax>INSERT SELECT</code> запроса - это <code class=syntax>IBlockInputStream</code>, который возвращает пустой результирующий набор при первом чтении, но копирует данные из <code class=syntax>SELECT</code> к <code class=syntax>INSERT</code>.</p> <p><code class=syntax>InterpreterSelectQuery</code> использует <code class=syntax>ExpressionAnalyzer</code> и <code class=syntax>ExpressionActions</code> механизмы для анализа запросов и преобразований. Именно здесь выполняется большинство оптимизаций запросов на основе правил. <code class=syntax>ExpressionAnalyzer</code> написан довольно грязно и должен быть переписан: различные преобразования запросов и оптимизации должны быть извлечены в отдельные классы, чтобы позволить модульные преобразования или запросы.</p> <h2 id=functions>Функции<a class=headerlink href=#functions title="Permanent link"> </a></h2> <p>Существуют обычные функции и агрегатные функции. Агрегатные функции смотрите в следующем разделе.</p> <p>Обычный функции не изменяют число строк и работают так, как если бы обрабатывали каждую строку независимо. В действительности же, функции вызываются не к отдельным строкам, а блокам данных для реализации векторизованного выполнения запросов.</p> <p>Некоторые функции, такие как <a href=../../sql-reference/functions/other-functions/#function-blocksize>blockSize</a>, <a href=../../sql-reference/functions/other-functions/#function-rownumberinblock>rowNumberInBlock</a>, и <a href=../../sql-reference/functions/other-functions/#runningaccumulate>runningAccumulate</a>, эксплуатируют блочную обработку и нарушают независимость строк.</p> <p>ClickHouse имеет сильную типизацию, поэтому нет никакого неявного преобразования типов. Если функция не поддерживает определенную комбинацию типов, она создает исключение. Но функции могут работать (перегружаться) для многих различных комбинаций типов. Например, функция <code class=syntax>plus</code> (для реализации <code class=syntax>+</code> оператор) работает для любой комбинации числовых типов: <code class=syntax>UInt8</code> + <code class=syntax>Float32</code>, <code class=syntax>UInt16</code> + <code class=syntax>Int8</code> и так далее. Кроме того, некоторые вариадические функции, такие как <code class=syntax>concat</code>, могут принимать любое количество аргументов.</p> <p>Реализация функции может быть немного неудобной, поскольку функция явно определяет поддерживаемые типы данных и поддерживается <code class=syntax>IColumns</code>. Например, в <code class=syntax>plus</code> функция имеет код, генерируемый экземпляром шаблона C++ для каждой комбинации числовых типов, а также постоянные или непостоянные левые и правые аргументы.</p> <p>Это отличное место для реализации генерации кода во время выполнения, чтобы избежать раздувания кода шаблона. Кроме того, он позволяет добавлять слитые функции, такие как fused multiply-add или выполнять несколько сравнений в одной итерации цикла.</p> <p>Из-за векторизованного выполнения запроса функции не закорачиваются. Например, если вы пишете <code class=syntax>WHERE f(x) AND g(y)</code>, обе части вычисляются, даже для строк, когда <code class=syntax>f(x)</code> равно нулю (за исключением тех случаев, когда <code class=syntax>f(x)</code> является нулевым постоянным выражением). Но если избирательность условия <code class=syntax>f(x)</code> высока, и расчет <code class=syntax>f(x)</code> обходится гораздо дешевле, чем <code class=syntax>g(y)</code>, лучше всего разделить вычисление на этапы. На первом этапе вычислить <code class=syntax>f(x)</code>, отфильтровать результирующие столбцы, а затем вычислять <code class=syntax>g(y)</code> только для меньших, отфильтрованных фрагментов данных.</p> <h2 id=aggregate-functions>Агрегатные функции<a class=headerlink href=#aggregate-functions title="Permanent link"> </a></h2> <p>Агрегатные функции - это функции с состоянием (stateful). Они накапливают переданные значения в некотором состоянии и позволяют получать результаты из этого состояния. Работа с ними осуществляется с помощью интерфейса <code class=syntax>IAggregateFunction</code>. Состояния могут быть как простыми (состояние для <code class=syntax>AggregateFunctionCount</code> это всего лишь одна переменная типа <code class=syntax>UInt64</code>) так и довольно сложными (состояние <code class=syntax>AggregateFunctionUniqCombined</code> представляет собой комбинацию линейного массива, хэш-таблицы и вероятностной структуры данных <code class=syntax>HyperLogLog</code>).</p> <p>Состояния распределяются в <code class=syntax>Arena</code> (пул памяти) для работы с несколькими состояниями при выполнении запроса <code class=syntax>GROUP BY</code> высокой кардинальности (большим числом уникальных данных). Состояния могут иметь нетривиальный конструктор и деструктор: например, сложные агрегатные состояния могут сами аллоцировать дополнительную память. Потому к созданию и уничтожению состояний, правильной передаче владения и порядку уничтожения следует уделять больше внимание.</p> <p>Агрегатные состояния могут быть сериализованы и десериализованы для передачи их по сети во время выполнения распределенного запроса или для записи их на диск при дефиците оперативной памяти. Они даже могут храниться в таблице с <code class=syntax>DataTypeAggregateFunction</code>, чтобы позволяет выполнять инкрементное агрегирование данных.</p> <blockquote> <p>Формат сериализации данных для состояний агрегатных функций в настоящее время не версионируется. Это нормально, если агрегатные состояния хранятся только временно. Но у нас есть такая возможность <code class=syntax>AggregatingMergeTree</code> механизм таблиц для инкрементной агрегации, и люди уже используют его в эксплуатации. Именно по этой причине требуется помнить об обратная совместимости при изменении формата сериализации для любой агрегатной функции.</p> </blockquote> <h2 id=server>Сервер<a class=headerlink href=#server title="Permanent link"> </a></h2> <p>Сервер предоставляет несколько различных интерфейсов.</p> <ul> <li>HTTP интерфейс для любых сторонних клиентов.</li> <li>TCP интерфейс для родного ClickHouse клиента и межсерверной взаимодействия при выполнении распределенных запросов.</li> <li>Интерфейс для передачи данных при репликации.</li> </ul> <p>Внутри простой многопоточный сервер без корутин (coroutines), файберов (fibers) и т.д. Поскольку сервер не предназначен для обработки большого количества простых запросов, а ориентирован на обработку сложных запросов относительно низкой интенсивности, каждый из потоков может обрабатывать огромное количество аналитических запросов.</p> <p>Сервер инициализирует класс <code class=syntax>Context</code>, где хранит необходимое для выполнения запроса окружение: список доступных баз данных, пользователей и прав доступа, настройки, кластеры, список процессов, журнал запросов и т.д. Это окружение используется интерпретаторами.</p> <p>Мы поддерживаем полную обратную и прямую совместимость для TCP интерфейса: старые клиенты могут общаться с новыми серверами, а новые клиенты могут общаться со старыми серверами. Но мы не хотим поддерживать его вечно и прекращаем поддержку старых версий примерно через год.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Для всех сторонних приложений мы рекомендуем использовать HTTP интерфейс, потому что он прост и удобен в использовании. TCP интерфейс тесно связан с внутренними структурами данных: он использует внутренний формат для передачи блоков данных и использует специальное кадрирование для сжатых данных. Мы не выпустили библиотеку C для этого протокола, потому что потребовала бы линковки большей части кодовой базы ClickHouse, что непрактично.</p> </div> <h2 id=distributed-query-execution>Выполнение распределенных запросов (Distributed Query Execution)<a class=headerlink href=#distributed-query-execution title="Permanent link"> </a></h2> <p>Сервера в кластере в основном независимы. Вы можете создать <code class=syntax>Распределенную</code> (<code class=syntax>Distributed</code>) таблицу на одном или всех серверах в кластере. Такая таблица сама по себе не хранит данные - она только предоставляет возможность "просмотра" всех локальных таблиц на нескольких узлах кластера. При выполнении <code class=syntax>SELECT</code> распределенная таблица переписывает запрос, выбирает удаленные узлы в соответствии с настройками балансировки нагрузки и отправляет им запрос. Распределенная таблица просит удаленные сервера обработать запрос до той стадии, когда промежуточные результаты с разных серверов могут быть объединены. Затем он получает промежуточные результаты и объединяет их. Распределенная таблица пытается возложить как можно больше работы на удаленные серверы и сократить объем промежуточных данных, передаваемых по сети.</p> <p>Ситуация усложняется, при использовании подзапросы в случае IN или JOIN, когда каждый из них использует таблицу <code class=syntax>Distributed</code>. Есть разные стратегии для выполнения таких запросов.</p> <p>Глобального плана выполнения распределенных запросов не существует. Каждый узел имеет собственный локальный план для своей части работы. У нас есть простое однонаправленное выполнение распределенных запросов: мы отправляем запросы на удаленные узлы и затем объединяем результаты. Но это невозможно для сложных запросов GROUP BY высокой кардинальности или запросов с большим числом временных данных в JOIN: в таких случаях нам необходимо перераспределить («reshuffle») данные между серверами, что требует дополнительной координации. ClickHouse не поддерживает выполнение запросов такого рода, и нам нужно работать над этим.</p> <h2 id=merge-tree>Merge Tree<a class=headerlink href=#merge-tree title="Permanent link"> </a></h2> <p><code class=syntax>MergeTree</code> - это семейство движков хранения, поддерживающих индексацию по первичному ключу. Первичный ключ может быть произвольным набором (кортежем) столбцов или выражений. Данные в таблице <code class=syntax>MergeTree</code> хранятся "частями" (“parts”). Каждая часть хранит данные отсортированные по первичному ключу (данные упорядочены лексикографически). Все столбцы таблицы хранятся в отдельных файлах <code class=syntax>column.bin</code> в этих частях. Файлы состоят из сжатых блоков. Каждый блок обычно содержит от 64 КБ до 1 МБ несжатых данных, в зависимости от среднего значения размера данных. Блоки состоят из значений столбцов, расположенных последовательно один за другим. Значения столбцов находятся в одинаковом порядке для каждого столбца (порядок определяется первичным ключом), поэтому, когда вы выполняете итерацию по многим столбцам, вы получаете значения для соответствующих строк.</p> <p>Сам первичный ключ является "разреженным" ("sparse"). Он не относится к каждой отдельной строке, а только к некоторым диапазонам данных. Отдельный файл «primary.idx» имеет значение первичного ключа для каждой N-й строки, где N называется гранулярностью индекса ("index_granularity", обычно N = 8192). Также для каждого столбца у нас есть файлы <code class=syntax>column.mrk</code> с "метками" ("marks"), которые обозначают смещение для каждой N-й строки в файле данных. Каждая метка представляет собой пару: смещение начала сжатого блока от начала файла и смещение к началу данных в распакованном блоке. Обычно сжатые блоки выравниваются по меткам, а смещение в распакованном блоке равно нулю. Данные для <code class=syntax>primary.idx</code> всегда находятся в памяти, а данные для файлов <code class=syntax>column.mrk</code> кэшируются.</p> <p>Когда мы собираемся читать что-то из части данных <code class=syntax>MergeTree</code>, мы смотрим содержимое <code class=syntax>primary.idx</code> и определяем диапазоны, которые могут содержать запрошенные данные, затем просматриваем содержимое <code class=syntax>column.mrk</code> и вычисляем смещение, чтобы начать чтение этих диапазонов. Из-за разреженности могут быть прочитаны лишние данные. ClickHouse не подходит для простых точечных запросов высокой интенсивности, потому что весь диапазон строк размером <code class=syntax>index_granularity</code> должен быть прочитан для каждого ключа, а сжатый блок должен быть полностью распакован для каждого столбца. Мы сделали индекс разреженным, потому что мы должны иметь возможность поддерживать триллионы строк на один сервер без существенных расходов памяти на индексацию. Кроме того, поскольку первичный ключ является разреженным, он не уникален: он не может проверить наличие ключа в таблице во время INSERT. Вы можете иметь множество строк с одним и тем же ключом в таблице.</p> <p>При выполнении <code class=syntax>INSERT</code> для группы данных в <code class=syntax>MergeTree</code>, элементы группы сортируются по первичному ключу и образует новую “часть”. Фоновые потоки периодически выбирают некоторые части и объединяют их в одну отсортированную часть, чтобы сохранить относительно небольшое количество частей. Вот почему он называется <code class=syntax>MergeTree</code>. Конечно, объединение приводит к повышению интенсивности записи. Все части иммутабельные: они только создаются и удаляются, но не изменяются. Когда выполняется <code class=syntax>SELECT</code>, он содержит снимок таблицы (набор частей). После объединения старые части также сохраняются в течение некоторого времени, чтобы упростить восстановление после сбоя, поэтому, если мы видим, что какая-то объединенная часть, вероятно, повреждена, мы можем заменить ее исходными частями.</p> <p><code class=syntax>MergeTree</code> не является деревом LSM (Log-structured merge-tree — журнально-структурированное дерево со слиянием), потому что оно не содержит «memtable» и «log»: вставленные данные записываются непосредственно в файловую систему. Это делает его пригодным только для вставки данных в пакетах, а не по отдельным строкам и не очень часто - примерно раз в секунду это нормально, а тысячу раз в секунду - нет. Мы сделали это для простоты и потому, что мы уже вставляем данные в пакеты в наших приложениях.</p> <blockquote> <p>Таблицы <code class=syntax>MergeTree</code> могут иметь только один (первичный) индекс: вторичных индексов нет. Было бы неплохо разрешить несколько физических представлениям в одной логической таблице, например, хранить данные в более чем одном физическом порядке или даже разрешить представления с предварительно агрегированными данными вместе с исходными данными.</p> </blockquote> <p>Существуют движки <code class=syntax>MergeTree</code>, которые выполняют дополнительную работу во время фоновых слияний. Примерами являются <code class=syntax>CollapsingMergeTree</code> и <code class=syntax>AggregatingMergeTree</code>. Это можно рассматривать как специальную поддержку обновления. Помните, что это не настоящие обновления, поскольку пользователи обычно не контролируют время выполнения фоновых слияний, а данные в таблице <code class=syntax>MergeTree</code> почти всегда хранятся в нескольких частях, а не в полностью объединенной форме.</p> <h2 id=replication>Репликация<a class=headerlink href=#replication title="Permanent link"> </a></h2> <p>Репликация в ClickHouse может быть настроена для каждой таблицы отдельно. Вы можете иметь несколько реплицированных и несколько не реплицированных таблиц на одном сервере. Вы также можете реплицировать таблицы по-разному, например, одну с двухфакторной репликацией и другую с трехфакторной.</p> <p>Репликация реализована в движке таблицы <code class=syntax>ReplicatedMergeTree</code>. Путь в <code class=syntax>ZooKeeper</code> указывается в качестве параметра движка. Все таблицы с одинаковым путем в <code class=syntax>ZooKeeper</code> становятся репликами друг друга: они синхронизируют свои данные и поддерживают согласованность. Реплики можно добавлять и удалять динамически, просто создавая или удаляя таблицу.</p> <p>Репликация использует асинхронную multi-master схему. Вы можете вставить данные в любую реплику, которая имеет открытую сессию в <code class=syntax>ZooKeeper</code>, и данные реплицируются на все другие реплики асинхронно. Поскольку ClickHouse не поддерживает UPDATE, репликация исключает конфликты (conflict-free replication). Поскольку подтверждение вставок кворумом не реализовано, только что вставленные данные могут быть потеряны в случае сбоя одного узла.</p> <p>Метаданные для репликации хранятся в <code class=syntax>ZooKeeper</code>. Существует журнал репликации, в котором перечислены действия, которые необходимо выполнить. Среди этих действий: получить часть (get the part); объединить части (merge parts); удалить партицию (drop a partition) и так далее. Каждая реплика копирует журнал репликации в свою очередь, а затем выполняет действия из очереди. Например, при вставке в журнале создается действие «получить часть» (get the part), и каждая реплика загружает эту часть. Слияния координируются между репликами, чтобы получить идентичные до байта результаты. Все части объединяются одинаково на всех репликах. Одна из реплик-лидеров инициирует новое слияние кусков первой и записывает действия «слияния частей» в журнал. Несколько реплик (или все) могут быть лидерами одновременно. Реплике можно запретить быть лидером с помощью <code class=syntax>merge_tree</code> настройки <code class=syntax>replicated_can_become_leader</code>. </p> <p>Репликация является физической: между узлами передаются только сжатые части, а не запросы. Слияния обрабатываются на каждой реплике независимо, в большинстве случаев, чтобы снизить затраты на сеть, во избежание усиления роли сети. Крупные объединенные части отправляются по сети только в случае значительной задержки репликации.</p> <p>Кроме того, каждая реплика сохраняет свое состояние в <code class=syntax>ZooKeeper</code> в виде набора частей и его контрольных сумм. Когда состояние в локальной файловой системе расходится с эталонным состоянием в <code class=syntax>ZooKeeper</code>, реплика восстанавливает свою согласованность путем загрузки отсутствующих и поврежденных частей из других реплик. Когда в локальной файловой системе есть неожиданные или испорченные данные, ClickHouse не удаляет их, а перемещает в отдельный каталог и забывает об этом.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Кластер ClickHouse состоит из независимых шардов, а каждый шард состоит из реплик. Кластер <strong>не является эластичным</strong> (not elastic), поэтому после добавления нового шарда данные не будут автоматически распределены между ними. Вместо этого нужно изменить настройки, чтобы выровнять нагрузку на кластер. Эта реализация дает вам больший контроль, и вполне приемлема для относительно небольших кластеров, таких как десятки узлов. Но для кластеров с сотнями узлов, которые мы используем в эксплуатации, такой подход становится существенным недостатком. Движки таблиц, которые охватывают весь кластер с динамически реплицируемыми областями, которые могут быть автоматически разделены и сбалансированы между кластерами, еще предстоит реализовать.</p> </div> </div> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Was this content helpful?</span> <div id=rating-stars class="display-6 mb-0" data-titles="['Unusable', 'Poor', 'OK', 'Good', 'Excellent']" data-documentation=documentation>RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Table of Contents</label> <a href=#columns title=Колонки class="nav-link text-wrap d-inline-block w-100"> Колонки </a> <a href=#field title=Поля class="nav-link text-wrap d-inline-block w-100"> Поля </a> <a href=#leaky-abstractions title="Дырявые абстракции (Leaky Abstractions)" class="nav-link text-wrap d-inline-block w-100"> Дырявые абстракции (Leaky Abstractions) </a> <a href=#data_types title="Типы данных (Data Types)" class="nav-link text-wrap d-inline-block w-100"> Типы данных (Data Types) </a> <a href=#block title="Блоки (Block)" class="nav-link text-wrap d-inline-block w-100"> Блоки (Block) </a> <a href=#block-streams title="Потоки блоков (Block Streams)" class="nav-link text-wrap d-inline-block w-100"> Потоки блоков (Block Streams) </a> <a href=#formats title=Форматы class="nav-link text-wrap d-inline-block w-100"> Форматы </a> <a href=#io title=I/O class="nav-link text-wrap d-inline-block w-100"> I/O </a> <a href=#tables title=Таблицы class="nav-link text-wrap d-inline-block w-100"> Таблицы </a> <a href=#parsers title="Парсеры (Parsers)" class="nav-link text-wrap d-inline-block w-100"> Парсеры (Parsers) </a> <a href=#interpreters title=Интерпретаторы class="nav-link text-wrap d-inline-block w-100"> Интерпретаторы </a> <a href=#functions title=Функции class="nav-link text-wrap d-inline-block w-100"> Функции </a> <a href=#aggregate-functions title="Агрегатные функции" class="nav-link text-wrap d-inline-block w-100"> Агрегатные функции </a> <a href=#server title=Сервер class="nav-link text-wrap d-inline-block w-100"> Сервер </a> <a href=#distributed-query-execution title="Выполнение распределенных запросов (Distributed Query Execution)" class="nav-link text-wrap d-inline-block w-100"> Выполнение распределенных запросов (Distributed Query Execution) </a> <a href=#merge-tree title="Merge Tree" class="nav-link text-wrap d-inline-block w-100"> Merge Tree </a> <a href=#replication title=Репликация class="nav-link text-wrap d-inline-block w-100"> Репликация </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?00223b07></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>