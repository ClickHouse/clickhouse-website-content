<!doctype html><html ⚡ lang=fr> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>Référence | Documentation ClickHouse</title><link href=https://clickhouse.tech/docs/fr/sql-reference/aggregate-functions/reference/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Référence | Documentation ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/fr/sql-reference/aggregate-functions/reference/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Référence | Documentation ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer,main,section{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b,strong{font-weight:bolder}small{font-size:80%}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}label{display:inline-block;margin-bottom:.5rem}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.lead{font-size:1.25rem;font-weight:300}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.small,small{font-size:80%;font-weight:400}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-first{-ms-flex-order:-1;order:-1}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-first{-ms-flex-order:-1;order:-1}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-first{-ms-flex-order:-1;order:-1}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-primary{background-color:#b8daff}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-primary{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:hover{color:#fff;background-color:#0069d9;border-color:#0062cc}.btn-primary:focus{color:#fff;background-color:#0069d9;border-color:#0062cc;box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-primary:disabled{color:#fff;background-color:#007bff;border-color:#007bff}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-primary{color:#007bff;border-color:#007bff}.btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-primary:disabled{color:#007bff;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#004085;background-color:#cce5ff;border-color:#b8daff}.alert-primary .alert-link{color:#002752}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#007bff}a.bg-primary:focus,a.bg-primary:hover{background-color:#0062cc}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.position-fixed{position:fixed}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.w-25{width:25%}.w-50{width:50%}.w-75{width:75%}.w-100{width:100%}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.m-0{margin:0}.mt-0,.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.m-1{margin:.25rem}.mt-1,.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.m-2{margin:.5rem}.mt-2,.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.m-3{margin:1rem}.mt-3,.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.m-4{margin:1.5rem}.mt-4,.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.m-5{margin:3rem}.mt-5,.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pr-0{padding-right:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pr-1{padding-right:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pr-2{padding-right:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pr-3{padding-right:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pr-4{padding-right:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pr-5{padding-right:3rem}.pb-5,.py-5{padding-bottom:3rem}.m-n1{margin:-.25rem}.mt-n1,.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.m-n2{margin:-.5rem}.mt-n2,.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.m-n3{margin:-1rem}.mt-n3,.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.m-n4{margin:-1.5rem}.mt-n4,.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.m-n5{margin:-3rem}.mt-n5,.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.m-md-0{margin:0}.mt-md-0,.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.m-md-1{margin:.25rem}.mt-md-1,.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.m-md-2{margin:.5rem}.mt-md-2,.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.m-md-3{margin:1rem}.mt-md-3,.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.m-md-4{margin:1.5rem}.mt-md-4,.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.m-md-5{margin:3rem}.mt-md-5,.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pr-md-0{padding-right:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pr-md-1{padding-right:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pr-md-2{padding-right:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pr-md-3{padding-right:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pr-md-4{padding-right:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pr-md-5{padding-right:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.m-md-n1{margin:-.25rem}.mt-md-n1,.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.m-md-n2{margin:-.5rem}.mt-md-n2,.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.m-md-n3{margin:-1rem}.mt-md-n3,.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.m-md-n4{margin:-1.5rem}.mt-md-n4,.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.m-md-n5{margin:-3rem}.mt-md-n5,.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.m-lg-0{margin:0}.mt-lg-0,.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.m-lg-1{margin:.25rem}.mt-lg-1,.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.m-lg-2{margin:.5rem}.mt-lg-2,.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.m-lg-3{margin:1rem}.mt-lg-3,.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.m-lg-4{margin:1.5rem}.mt-lg-4,.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.m-lg-5{margin:3rem}.mt-lg-5,.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pr-lg-0{padding-right:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pr-lg-1{padding-right:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pr-lg-2{padding-right:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pr-lg-3{padding-right:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pr-lg-4{padding-right:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pr-lg-5{padding-right:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.m-lg-n1{margin:-.25rem}.mt-lg-n1,.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.m-lg-n2{margin:-.5rem}.mt-lg-n2,.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.m-lg-n3{margin:-1rem}.mt-lg-n3,.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.m-lg-n4{margin:-1.5rem}.mt-lg-n4,.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.m-lg-n5{margin:-3rem}.mt-lg-n5,.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#007bff}a.text-primary:focus,a.text-primary:hover{color:#0056b3}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.w-15{width:15%}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre,tr{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}.syntax .hll{background-color:#b9b6b0}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .k{color:#000;font-weight:700}.syntax .l{color:#08f}.syntax .n{color:#2f1e2e}.syntax .o{color:#800}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .cs{color:#8d8687}.syntax .kt{color:#fec418}.syntax .ld{color:#48b685}.syntax .m{color:#08f}.syntax .s{color:#48b685}.syntax .nb{color:#2f1e2e}.syntax .ne{color:#ef6155}.syntax .py{color:#2f1e2e}.syntax .w{color:#2f1e2e}.syntax .mi{color:#08f}.syntax .sc{color:#2f1e2e}.syntax .s2{color:#48b685}.syntax .se{color:#08f}.syntax .si{color:#08f}.syntax .s1{color:#080}.syntax .ss{color:#48b685}.syntax .il{color:#08f}@media(prefers-color-scheme:dark){.syntax .k{color:#c78cff}.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .ss{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .nb{color:#f8f9fa}.syntax .py{color:#f8f9fa}.syntax .w{color:#f8f9fa}.syntax .sc{color:#f8f9fa}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <div class="alert alert-primary" role=alert> <p class="display-5 mb-2">Help wanted!</p> <p class=lead>The following content of this documentation page has been machine-translated. But unlike other websites, it is not done on the fly. This translated text lives on GitHub repository alongside main ClickHouse codebase and waits for fellow native speakers to make it more human-readable. <a href=/docs/en/sql-reference/aggregate-functions/reference/ class=alert-link>You can also use the original English version as a reference.</a></p> <p class=lead> <a class="btn btn-lg btn-primary text-white" href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/fr/sql-reference/aggregate-functions/reference.md target=_blank rel="external nofollow noreferrer"> Help ClickHouse documentation by editing this page </a> </p> </div> <h1 id=aggregate-functions-reference>Référence De La Fonction Agrégée<a class=headerlink href=../amp/#aggregate-functions-reference title="Permanent link"> </a></h1> <h2 id=agg_function-count>compter<a class=headerlink href=../amp/#agg_function-count title="Permanent link"> </a></h2> <p>Compte le nombre de lignes ou de valeurs non NULL.</p> <p>ClickHouse prend en charge les syntaxes suivantes pour <code class=syntax>count</code>:<br> - <code class=syntax>count(expr)</code> ou <code class=syntax>COUNT(DISTINCT expr)</code>.<br> - <code class=syntax>count()</code> ou <code class=syntax>COUNT(*)</code>. Le <code class=syntax>count()</code> la syntaxe est spécifique à ClickHouse.</p> <p><strong>Paramètre</strong></p> <p>La fonction peut prendre:</p> <ul> <li>Zéro des paramètres.</li> <li>Un <a href=../../../syntax/amp/#syntax-expressions>expression</a>.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Si la fonction est appelée sans paramètres, il compte le nombre de lignes.</li> <li>Si l' <a href=../../../syntax/amp/#syntax-expressions>expression</a> est passé, alors la fonction compte combien de fois cette expression retournée not null. Si l'expression renvoie un <a href=../../../data-types/nullable/amp/ >Nullable</a>- tapez la valeur, puis le résultat de <code class=syntax>count</code> séjours pas <code class=syntax>Nullable</code>. La fonction renvoie 0 si l'expression est retournée <code class=syntax>NULL</code> pour toutes les lignes.</li> </ul> <p>Dans les deux cas le type de la valeur renvoyée est <a href=../../../data-types/int-uint/amp/ >UInt64</a>.</p> <p><strong>Détail</strong></p> <p>Clickhouse soutient le <code class=syntax>COUNT(DISTINCT ...)</code> syntaxe. Le comportement de cette construction dépend de la <a href=../../../../operations/settings/settings/amp/#settings-count_distinct_implementation>count_distinct_implementation</a> paramètre. Il définit lequel des <a href=../amp/#agg_function-uniq>uniq*</a> fonctions est utilisée pour effectuer l'opération. La valeur par défaut est la <a href=../amp/#agg_function-uniqexact>uniqExact</a> fonction.</p> <p>Le <code class=syntax>SELECT count() FROM table</code> la requête n'est pas optimisé, car le nombre d'entrées dans la table n'est pas stockée séparément. Il choisit une petite colonne de la table et compte le nombre de valeurs qu'il contient.</p> <p><strong>Exemple</strong></p> <p>Exemple 1:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─count()─┐
│       5 │
└─────────┘
</code></pre></div> <p>Exemple 2:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=k>FROM</span> <span class=k>system</span><span class=p>.</span><span class=n>settings</span> <span class=k>WHERE</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>'count_distinct_implementation'</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─name──────────────────────────┬─value─────┐
│ count_distinct_implementation │ uniqExact │
└───────────────────────────────┴───────────┘
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>(</span><span class=k>DISTINCT</span> <span class=n>num</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─uniqExact(num)─┐
│              3 │
└────────────────┘
</code></pre></div> <p>Cet exemple montre que <code class=syntax>count(DISTINCT num)</code> est effectuée par le <code class=syntax>uniqExact</code> en fonction de l' <code class=syntax>count_distinct_implementation</code> valeur de réglage.</p> <h2 id=agg_function-any>tout(x)<a class=headerlink href=../amp/#agg_function-any title="Permanent link"> </a></h2> <p>Sélectionne la première valeur rencontrée.<br> La requête peut être exécutée dans n'importe quel ordre, et même dans un ordre différent à chaque fois, de sorte que le résultat de cette fonction est indéterminée.<br> Pour obtenir un résultat déterminé, vous pouvez utiliser le ‘min’ ou ‘max’ fonction au lieu de ‘any’.</p> <p>Dans certains cas, vous pouvez compter sur l'ordre de l'exécution. Cela s'applique aux cas où SELECT provient d'une sous-requête qui utilise ORDER BY.</p> <p>Lorsqu'un <code class=syntax>SELECT</code> la requête a l' <code class=syntax>GROUP BY</code> ou au moins une fonction d'agrégat, ClickHouse (contrairement à MySQL) exige que toutes les expressions du <code class=syntax>SELECT</code>, <code class=syntax>HAVING</code>, et <code class=syntax>ORDER BY</code> clauses être calculée à partir de clés ou de fonctions d'agrégation. En d'autres termes, chaque colonne sélectionnée dans la table doit être utilisée soit dans les clés, soit dans les fonctions d'agrégation. Pour obtenir un comportement comme dans MySQL, vous pouvez mettre les autres colonnes dans le <code class=syntax>any</code> fonction d'agrégation.</p> <h2 id=anyheavyx>anyHeavy (x)<a class=headerlink href=../amp/#anyheavyx title="Permanent link"> </a></h2> <p>Sélectionne une valeur fréquente à l'aide <a href=http://www.cs.umd.edu/~samir/498/karp.pdf rel="external nofollow noreferrer" target=_blank>poids lourds</a> algorithme. S'il y a une valeur qui se produit plus de la moitié des cas dans chacun des threads d'exécution de la requête, cette valeur est renvoyée. Normalement, le résultat est non déterministe.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>anyHeavy</span><span class=p>(</span><span class=k>column</span><span class=p>)</span>
</code></pre></div> <p><strong>Argument</strong></p> <ul> <li><code class=syntax>column</code> – The column name.</li> </ul> <p><strong>Exemple</strong></p> <p>Prendre la <a href=../../../../getting-started/example-datasets/ontime/amp/ >OnTime</a> ensemble de données et sélectionnez n'importe quelle valeur <code class=syntax>AirlineID</code> colonne.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>anyHeavy</span><span class=p>(</span><span class=n>AirlineID</span><span class=p>)</span> <span class=k>AS</span> <span class=n>res</span>
<span class=k>FROM</span> <span class=n>ontime</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌───res─┐
│ 19690 │
└───────┘
</code></pre></div> <h2 id=anylastx>anyLast (x)<a class=headerlink href=../amp/#anylastx title="Permanent link"> </a></h2> <p>Sélectionne la dernière valeur rencontrés.<br> Le résultat est tout aussi indéterminé que pour le <code class=syntax>any</code> fonction.</p> <h2 id=groupbitand>groupBitAnd<a class=headerlink href=../amp/#groupbitand title="Permanent link"> </a></h2> <p>S'applique au niveau du BIT <code class=syntax>AND</code> pour les séries de nombres.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitAnd</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>UInt*</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt*</code> type.</p> <p><strong>Exemple</strong></p> <p>Des données de Test:</p> <div class=codehilite><pre><span></span><code class=syntax>binary     decimal
00101100 = 44
00011100 = 28
00001101 = 13
01010101 = 85
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupBitAnd</span><span class=p>(</span><span class=n>num</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Où <code class=syntax>num</code> est la colonne avec les données de test.</p> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>binary     decimal
00000100 = 4
</code></pre></div> <h2 id=groupbitor>groupBitOr<a class=headerlink href=../amp/#groupbitor title="Permanent link"> </a></h2> <p>S'applique au niveau du BIT <code class=syntax>OR</code> pour les séries de nombres.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitOr</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>UInt*</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt*</code> type.</p> <p><strong>Exemple</strong></p> <p>Des données de Test:</p> <div class=codehilite><pre><span></span><code class=syntax>binary     decimal
00101100 = 44
00011100 = 28
00001101 = 13
01010101 = 85
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupBitOr</span><span class=p>(</span><span class=n>num</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Où <code class=syntax>num</code> est la colonne avec les données de test.</p> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>binary     decimal
01111101 = 125
</code></pre></div> <h2 id=groupbitxor>groupBitXor<a class=headerlink href=../amp/#groupbitxor title="Permanent link"> </a></h2> <p>S'applique au niveau du BIT <code class=syntax>XOR</code> pour les séries de nombres.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitXor</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>UInt*</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt*</code> type.</p> <p><strong>Exemple</strong></p> <p>Des données de Test:</p> <div class=codehilite><pre><span></span><code class=syntax>binary     decimal
00101100 = 44
00011100 = 28
00001101 = 13
01010101 = 85
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupBitXor</span><span class=p>(</span><span class=n>num</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Où <code class=syntax>num</code> est la colonne avec les données de test.</p> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>binary     decimal
01101000 = 104
</code></pre></div> <h2 id=groupbitmap>groupBitmap<a class=headerlink href=../amp/#groupbitmap title="Permanent link"> </a></h2> <p>Calculs Bitmap ou agrégés à partir d'une colonne entière non signée, retour cardinalité de type UInt64, si Ajouter suffixe-State, puis retour <a href=../../../functions/bitmap-functions/amp/ >objet bitmap</a>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitmap</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>UInt*</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt64</code> type.</p> <p><strong>Exemple</strong></p> <p>Des données de Test:</p> <div class=codehilite><pre><span></span><code class=syntax>UserID
1
1
2
3
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupBitmap</span><span class=p>(</span><span class=n>UserID</span><span class=p>)</span> <span class=k>as</span> <span class=n>num</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>num
3
</code></pre></div> <h2 id=agg_function-min>min (x)<a class=headerlink href=../amp/#agg_function-min title="Permanent link"> </a></h2> <p>Calcule le minimum.</p> <h2 id=agg_function-max>max (x)<a class=headerlink href=../amp/#agg_function-max title="Permanent link"> </a></h2> <p>Calcule le maximum.</p> <h2 id=agg-function-argmin>argMin (arg, val)<a class=headerlink href=../amp/#agg-function-argmin title="Permanent link"> </a></h2> <p>Calcule la ‘arg’ valeur pour un minimum ‘val’ valeur. S'il y a plusieurs valeurs différentes de ‘arg’ pour des valeurs minimales de ‘val’ la première de ces valeurs rencontrées est de sortie.</p> <p><strong>Exemple:</strong></p> <div class=codehilite><pre><span></span><code class=syntax>┌─user─────┬─salary─┐
│ director │   5000 │
│ manager  │   3000 │
│ worker   │   1000 │
└──────────┴────────┘
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>argMin</span><span class=p>(</span><span class=k>user</span><span class=p>,</span> <span class=n>salary</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>salary</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─argMin(user, salary)─┐
│ worker               │
└──────────────────────┘
</code></pre></div> <h2 id=agg-function-argmax>argMax(arg, val)<a class=headerlink href=../amp/#agg-function-argmax title="Permanent link"> </a></h2> <p>Calcule la ‘arg’ valeur pour un maximum ‘val’ valeur. S'il y a plusieurs valeurs différentes de ‘arg’ pour les valeurs maximales de ‘val’ la première de ces valeurs rencontrées est de sortie.</p> <h2 id=agg_function-sum>sum(x)<a class=headerlink href=../amp/#agg_function-sum title="Permanent link"> </a></h2> <p>Calcule la somme.<br> Ne fonctionne que pour les numéros.</p> <h2 id=sumwithoverflowx>sumWithOverflow (x)<a class=headerlink href=../amp/#sumwithoverflowx title="Permanent link"> </a></h2> <p>Calcule la somme des nombres, en utilisant le même type de données pour le résultat que pour les paramètres d'entrée. Si la somme dépasse la valeur maximale pour ce type de données, la fonction renvoie une erreur.</p> <p>Ne fonctionne que pour les numéros.</p> <h2 id=agg_functions-summap>sumMap(clé, valeur), sumMap(Tuple(clé, valeur))<a class=headerlink href=../amp/#agg_functions-summap title="Permanent link"> </a></h2> <p>Les totaux de la ‘value’ tableau selon les clés spécifiés dans le ‘key’ tableau.<br> Le passage du tuple des tableaux de clés et de valeurs est synonyme du passage de deux tableaux de clés et de valeurs.<br> Le nombre d'éléments dans ‘key’ et ‘value’ doit être identique pour chaque ligne totalisée.<br> Returns a tuple of two arrays: keys in sorted order, and values ​​summed for the corresponding keys.</p> <p>Exemple:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>sum_map</span><span class=p>(</span>
    <span class=nb>date</span> <span class=nb>Date</span><span class=p>,</span>
    <span class=n>timeslot</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>statusMap</span> <span class=n>Nested</span><span class=p>(</span>
        <span class=n>status</span> <span class=n>UInt16</span><span class=p>,</span>
        <span class=n>requests</span> <span class=n>UInt64</span>
    <span class=p>),</span>
    <span class=n>statusMapTuple</span> <span class=n>Tuple</span><span class=p>(</span><span class=nb>Array</span><span class=p>(</span><span class=n>Int32</span><span class=p>),</span> <span class=nb>Array</span><span class=p>(</span><span class=n>Int32</span><span class=p>))</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>Log</span><span class=p>;</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>sum_map</span> <span class=k>VALUES</span>
    <span class=p>(</span><span class=s1>'2000-01-01'</span><span class=p>,</span> <span class=s1>'2000-01-01 00:00:00'</span><span class=p>,</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>],</span> <span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>])),</span>
    <span class=p>(</span><span class=s1>'2000-01-01'</span><span class=p>,</span> <span class=s1>'2000-01-01 00:00:00'</span><span class=p>,</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>],</span> <span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>])),</span>
    <span class=p>(</span><span class=s1>'2000-01-01'</span><span class=p>,</span> <span class=s1>'2000-01-01 00:01:00'</span><span class=p>,</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>],</span> <span class=p>([</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>])),</span>
    <span class=p>(</span><span class=s1>'2000-01-01'</span><span class=p>,</span> <span class=s1>'2000-01-01 00:01:00'</span><span class=p>,</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>],</span> <span class=p>([</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>]));</span>

<span class=k>SELECT</span>
    <span class=n>timeslot</span><span class=p>,</span>
    <span class=n>sumMap</span><span class=p>(</span><span class=n>statusMap</span><span class=p>.</span><span class=n>status</span><span class=p>,</span> <span class=n>statusMap</span><span class=p>.</span><span class=n>requests</span><span class=p>),</span>
    <span class=n>sumMap</span><span class=p>(</span><span class=n>statusMapTuple</span><span class=p>)</span>
<span class=k>FROM</span> <span class=n>sum_map</span>
<span class=k>GROUP</span> <span class=k>BY</span> <span class=n>timeslot</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌────────────timeslot─┬─sumMap(statusMap.status, statusMap.requests)─┬─sumMap(statusMapTuple)─────────┐
│ 2000-01-01 00:00:00 │ ([1,2,3,4,5],[10,10,20,10,10])               │ ([1,2,3,4,5],[10,10,20,10,10]) │
│ 2000-01-01 00:01:00 │ ([4,5,6,7,8],[10,10,20,10,10])               │ ([4,5,6,7,8],[10,10,20,10,10]) │
└─────────────────────┴──────────────────────────────────────────────┴────────────────────────────────┘
</code></pre></div> <h2 id=skewpop>skewPop<a class=headerlink href=../amp/#skewpop title="Permanent link"> </a></h2> <p>Calcule la <a href=https://en.wikipedia.org/wiki/Skewness rel="external nofollow noreferrer" target=_blank>asymétrie</a> d'une séquence.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>skewPop</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> retour d'un nombre.</p> <p><strong>Valeur renvoyée</strong></p> <p>The skewness of the given distribution. Type — <a href=../../../data-types/float/amp/ >Float64</a></p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>skewPop</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>series_with_value_column</span>
</code></pre></div> <h2 id=skewsamp>skewSamp<a class=headerlink href=../amp/#skewsamp title="Permanent link"> </a></h2> <p>Calcule la <a href=https://en.wikipedia.org/wiki/Skewness rel="external nofollow noreferrer" target=_blank>asymétrie de l'échantillon</a> d'une séquence.</p> <p>Il représente une estimation non biaisée de l'asymétrie d'une variable aléatoire si les valeurs passées forme de son échantillon.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>skewSamp</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> retour d'un nombre.</p> <p><strong>Valeur renvoyée</strong></p> <p>The skewness of the given distribution. Type — <a href=../../../data-types/float/amp/ >Float64</a>. Si <code class=syntax>n &lt;= 1</code> (<code class=syntax>n</code> est la taille de l'échantillon), alors la fonction renvoie <code class=syntax>nan</code>.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>skewSamp</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>series_with_value_column</span>
</code></pre></div> <h2 id=kurtpop>kurtPop<a class=headerlink href=../amp/#kurtpop title="Permanent link"> </a></h2> <p>Calcule la <a href=https://en.wikipedia.org/wiki/Kurtosis rel="external nofollow noreferrer" target=_blank>kurtosis</a> d'une séquence.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>kurtPop</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> retour d'un nombre.</p> <p><strong>Valeur renvoyée</strong></p> <p>The kurtosis of the given distribution. Type — <a href=../../../data-types/float/amp/ >Float64</a></p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>kurtPop</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>series_with_value_column</span>
</code></pre></div> <h2 id=kurtsamp>kurtSamp<a class=headerlink href=../amp/#kurtsamp title="Permanent link"> </a></h2> <p>Calcule la <a href=https://en.wikipedia.org/wiki/Kurtosis rel="external nofollow noreferrer" target=_blank>l'échantillon le coefficient d'aplatissement</a> d'une séquence.</p> <p>Il représente une estimation non biaisée de la kurtose d'une variable aléatoire si les valeurs passées forment son échantillon.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>kurtSamp</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> retour d'un nombre.</p> <p><strong>Valeur renvoyée</strong></p> <p>The kurtosis of the given distribution. Type — <a href=../../../data-types/float/amp/ >Float64</a>. Si <code class=syntax>n &lt;= 1</code> (<code class=syntax>n</code> la taille de l'échantillon), alors la fonction renvoie <code class=syntax>nan</code>.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>kurtSamp</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>series_with_value_column</span>
</code></pre></div> <h2 id=agg_function-avg>avg (x)<a class=headerlink href=../amp/#agg_function-avg title="Permanent link"> </a></h2> <p>Calcule la moyenne.<br> Ne fonctionne que pour les numéros.<br> Le résultat est toujours Float64.</p> <h2 id=avgweighted>avgWeighted<a class=headerlink href=../amp/#avgweighted title="Permanent link"> </a></h2> <p>Calcule la <a href=https://en.wikipedia.org/wiki/Weighted_arithmetic_mean rel="external nofollow noreferrer" target=_blank>moyenne arithmétique pondérée</a>.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>avgWeighted</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>weight</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>x</code> — Values. <a href=../../../data-types/int-uint/amp/ >Entier</a> ou <a href=../../../data-types/float/amp/ >virgule flottante</a>.</li> <li><code class=syntax>weight</code> — Weights of the values. <a href=../../../data-types/int-uint/amp/ >Entier</a> ou <a href=../../../data-types/float/amp/ >virgule flottante</a>.</li> </ul> <p>Type de <code class=syntax>x</code> et <code class=syntax>weight</code> doit être le même.</p> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Moyenne pondérée.</li> <li><code class=syntax>NaN</code>. Si tous les poids sont égaux à 0.</li> </ul> <p>Type: <a href=../../../data-types/float/amp/ >Float64</a>.</p> <p><strong>Exemple</strong></p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>avgWeighted</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span>
<span class=k>FROM</span> <span class=k>values</span><span class=p>(</span><span class=s1>'x Int8, w Int8'</span><span class=p>,</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avgWeighted(x, weight)─┐
│                      8 │
└────────────────────────┘
</code></pre></div> <h2 id=agg_function-uniq>uniq<a class=headerlink href=../amp/#agg_function-uniq title="Permanent link"> </a></h2> <p>Calcule le nombre approximatif des différentes valeurs de l'argument.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>uniq</span><span class=p>(</span><span class=n>x</span><span class=p>[,</span> <span class=p>...])</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p>La fonction prend un nombre variable de paramètres. Les paramètres peuvent être <code class=syntax>Tuple</code>, <code class=syntax>Array</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code> ou des types numériques.</p> <p><strong>Valeur renvoyée</strong></p> <ul> <li>A <a href=../../../data-types/int-uint/amp/ >UInt64</a>numéro de type.</li> </ul> <p><strong>Détails de mise en œuvre</strong></p> <p>Fonction:</p> <ul> <li> <p>Calcule un hachage pour tous les paramètres de l'agrégat, puis l'utilise dans les calculs.</p> </li> <li> <p>Utilise un algorithme d'échantillonnage adaptatif. Pour l'état de calcul, La fonction utilise un échantillon de valeurs de hachage d'éléments jusqu'à 65536.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>This</span> <span class=n>algorithm</span> <span class=k>is</span> <span class=n>very</span> <span class=n>accurate</span> <span class=k>and</span> <span class=n>very</span> <span class=n>efficient</span> <span class=k>on</span> <span class=n>the</span> <span class=n>CPU</span><span class=p>.</span> <span class=k>When</span> <span class=n>the</span> <span class=n>query</span> <span class=n>contains</span> <span class=n>several</span> <span class=n>of</span> <span class=n>these</span> <span class=n>functions</span><span class=p>,</span> <span class=k>using</span> <span class=ss>`uniq`</span> <span class=k>is</span> <span class=n>almost</span> <span class=k>as</span> <span class=n>fast</span> <span class=k>as</span> <span class=k>using</span> <span class=n>other</span> <span class=n>aggregate</span> <span class=n>functions</span><span class=p>.</span>
</code></pre></div> </li> <li> <p>Fournit le résultat de manière déterministe (cela ne dépend pas de l'ordre de traitement de la requête).</p> </li> </ul> <p>Nous vous recommandons d'utiliser cette fonction dans presque tous les scénarios.</p> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#agg_function-uniqcombined>uniqcombiné</a></li> <li><a href=../amp/#agg_function-uniqcombined64>uniqCombined64</a></li> <li><a href=../amp/#agg_function-uniqhll12>uniqHLL12</a></li> <li><a href=../amp/#agg_function-uniqexact>uniqExact</a></li> </ul> <h2 id=agg_function-uniqcombined>uniqcombiné<a class=headerlink href=../amp/#agg_function-uniqcombined title="Permanent link"> </a></h2> <p>Calcule le nombre approximatif de différentes valeurs d'argument.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>uniqCombined</span><span class=p>(</span><span class=n>HLL_precision</span><span class=p>)(</span><span class=n>x</span><span class=p>[,</span> <span class=p>...])</span>
</code></pre></div> <p>Le <code class=syntax>uniqCombined</code> la fonction est un bon choix pour calculer le nombre de valeurs différentes.</p> <p><strong>Paramètre</strong></p> <p>La fonction prend un nombre variable de paramètres. Les paramètres peuvent être <code class=syntax>Tuple</code>, <code class=syntax>Array</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code> ou des types numériques.</p> <p><code class=syntax>HLL_precision</code> est le logarithme en base 2 du nombre de cellules dans <a href=https://en.wikipedia.org/wiki/HyperLogLog rel="external nofollow noreferrer" target=_blank>HyperLogLog</a>. Facultatif, vous pouvez utiliser la fonction comme <code class=syntax>uniqCombined(x[, ...])</code>. La valeur par défaut pour <code class=syntax>HLL_precision</code> est 17, qui est effectivement 96 Ko d'espace(2 ^ 17 cellules, 6 bits chacune).</p> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Nombre <a href=../../../data-types/int-uint/amp/ >UInt64</a>numéro de type.</li> </ul> <p><strong>Détails de mise en œuvre</strong></p> <p>Fonction:</p> <ul> <li> <p>Calcule un hachage (hachage 64 bits pour <code class=syntax>String</code> et 32 bits sinon) pour tous les paramètres dans l'agrégat, puis l'utilise dans les calculs.</p> </li> <li> <p>Utilise une combinaison de trois algorithmes: tableau, table de hachage et HyperLogLog avec une table de correction d'erreur.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>For a small number of distinct elements, an array is used. When the set size is larger, a hash table is used. For a larger number of elements, HyperLogLog is used, which will occupy a fixed amount of memory.</span>
</code></pre></div> </li> <li> <p>Fournit le résultat de manière déterministe (cela ne dépend pas de l'ordre de traitement de la requête).</p> </li> </ul> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Comme il utilise le hachage 32 bits pour non-<code class=syntax>String</code> type, le résultat aura une erreur très élevée pour les cardinalités significativement plus grandes que <code class=syntax>UINT_MAX</code> (erreur va augmenter rapidement après quelques dizaines de milliards de valeurs distinctes), donc dans ce cas, vous devez utiliser <a class=alert-link href=../amp/#agg_function-uniqcombined64>uniqCombined64</a></p> </div> <p>Par rapport à la <a href=../amp/#agg_function-uniq>uniq</a> la fonction, la <code class=syntax>uniqCombined</code>:</p> <ul> <li>Consomme plusieurs fois moins de mémoire.</li> <li>Calcule avec plusieurs fois plus de précision.</li> <li>A généralement des performances légèrement inférieures. Dans certains scénarios, <code class=syntax>uniqCombined</code> peut faire mieux que <code class=syntax>uniq</code> par exemple, avec des requêtes distribuées qui transmettent un grand nombre d'agrégation des états sur le réseau.</li> </ul> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#agg_function-uniq>uniq</a></li> <li><a href=../amp/#agg_function-uniqcombined64>uniqCombined64</a></li> <li><a href=../amp/#agg_function-uniqhll12>uniqHLL12</a></li> <li><a href=../amp/#agg_function-uniqexact>uniqExact</a></li> </ul> <h2 id=agg_function-uniqcombined64>uniqCombined64<a class=headerlink href=../amp/#agg_function-uniqcombined64 title="Permanent link"> </a></h2> <p>Même que <a href=../amp/#agg_function-uniqcombined>uniqcombiné</a>, mais utilise le hachage 64 bits pour tous les types de données.</p> <h2 id=agg_function-uniqhll12>uniqHLL12<a class=headerlink href=../amp/#agg_function-uniqhll12 title="Permanent link"> </a></h2> <p>Calcule le nombre approximatif de différentes valeurs d'argument, en utilisant <a href=https://en.wikipedia.org/wiki/HyperLogLog rel="external nofollow noreferrer" target=_blank>HyperLogLog</a> algorithme.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>uniqHLL12</span><span class=p>(</span><span class=n>x</span><span class=p>[,</span> <span class=p>...])</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p>La fonction prend un nombre variable de paramètres. Les paramètres peuvent être <code class=syntax>Tuple</code>, <code class=syntax>Array</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code> ou des types numériques.</p> <p><strong>Valeur renvoyée</strong></p> <ul> <li>A <a href=../../../data-types/int-uint/amp/ >UInt64</a>numéro de type.</li> </ul> <p><strong>Détails de mise en œuvre</strong></p> <p>Fonction:</p> <ul> <li> <p>Calcule un hachage pour tous les paramètres de l'agrégat, puis l'utilise dans les calculs.</p> </li> <li> <p>Utilise L'algorithme HyperLogLog pour approximer le nombre de valeurs d'argument différentes.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>212 5-bit cells are used. The size of the state is slightly more than 2.5 KB. The result is not very accurate (up to ~10% error) for small data sets (&lt;10K elements). However, the result is fairly accurate for high-cardinality data sets (10K-100M), with a maximum error of ~1.6%. Starting from 100M, the estimation error increases, and the function will return very inaccurate results for data sets with extremely high cardinality (1B+ elements).</span>
</code></pre></div> </li> <li> <p>Fournit le résultat déterminé (il ne dépend pas de l'ordre de traitement de la requête).</p> </li> </ul> <p>Nous ne recommandons pas d'utiliser cette fonction. Dans la plupart des cas, l'utilisation de la <a href=../amp/#agg_function-uniq>uniq</a> ou <a href=../amp/#agg_function-uniqcombined>uniqcombiné</a> fonction.</p> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#agg_function-uniq>uniq</a></li> <li><a href=../amp/#agg_function-uniqcombined>uniqcombiné</a></li> <li><a href=../amp/#agg_function-uniqexact>uniqExact</a></li> </ul> <h2 id=agg_function-uniqexact>uniqExact<a class=headerlink href=../amp/#agg_function-uniqexact title="Permanent link"> </a></h2> <p>Calcule le nombre exact de différentes valeurs d'argument.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>uniqExact</span><span class=p>(</span><span class=n>x</span><span class=p>[,</span> <span class=p>...])</span>
</code></pre></div> <p>L'utilisation de la <code class=syntax>uniqExact</code> fonction si vous avez absolument besoin d'un résultat exact. Sinon l'utilisation de la <a href=../amp/#agg_function-uniq>uniq</a> fonction.</p> <p>Le <code class=syntax>uniqExact</code> la fonction utilise plus de mémoire que <code class=syntax>uniq</code> parce que la taille de l'état a surabondance de croissance que le nombre de valeurs différentes augmente.</p> <p><strong>Paramètre</strong></p> <p>La fonction prend un nombre variable de paramètres. Les paramètres peuvent être <code class=syntax>Tuple</code>, <code class=syntax>Array</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code> ou des types numériques.</p> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#agg_function-uniq>uniq</a></li> <li><a href=../amp/#agg_function-uniqcombined>uniqcombiné</a></li> <li><a href=../amp/#agg_function-uniqhll12>uniqHLL12</a></li> </ul> <h2 id=agg_function-grouparray>groupArray(x), groupArray (max_size) (x)<a class=headerlink href=../amp/#agg_function-grouparray title="Permanent link"> </a></h2> <p>Crée un tableau de valeurs de l'argument.<br> Les valeurs peuvent être ajoutées au tableau dans une (indéterminée) de commande.</p> <p>La deuxième version (avec le <code class=syntax>max_size</code> paramètre) limite la taille du tableau résultant à <code class=syntax>max_size</code> élément.<br> Exemple, <code class=syntax>groupArray (1) (x)</code> est équivalent à <code class=syntax>[any (x)]</code>.</p> <p>Dans certains cas, vous pouvez toujours compter sur l'ordre de l'exécution. Cela s'applique aux cas où <code class=syntax>SELECT</code> provient d'une sous-requête qui utilise <code class=syntax>ORDER BY</code>.</p> <h2 id=grouparrayinsertat>groupeparrayinsertat<a class=headerlink href=../amp/#grouparrayinsertat title="Permanent link"> </a></h2> <p>Insère une valeur dans le tableau à la position spécifiée.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupArrayInsertAt</span><span class=p>(</span><span class=n>default_x</span><span class=p>,</span> <span class=k>size</span><span class=p>)(</span><span class=n>x</span><span class=p>,</span> <span class=n>pos</span><span class=p>);</span>
</code></pre></div> <p>Si dans une requête plusieurs valeurs sont insérées dans la même position, la fonction se comporte de la manière suivante:</p> <ul> <li>Si une requête est exécutée dans un seul thread, la première des valeurs insérées est utilisée.</li> <li>Si une requête est exécutée dans plusieurs threads, le résultat est indéterminé l'une des valeurs insérées.</li> </ul> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>x</code> — Value to be inserted. <a href=../../../syntax/amp/#syntax-expressions>Expression</a> résultant dans l'un des <a href=../../../data-types/amp/ >types de données pris en charge</a>.</li> <li><code class=syntax>pos</code> — Position at which the specified element <code class=syntax>x</code> doit être inséré. L'indice de numérotation dans le tableau commence à partir de zéro. <a href=../../../data-types/int-uint/amp/#uint-ranges>UInt32</a>.</li> <li><code class=syntax>default_x</code>— Default value for substituting in empty positions. Optional parameter. <a href=../../../syntax/amp/#syntax-expressions>Expression</a> résultant dans le type de données configuré pour le <code class=syntax>x</code> paramètre. Si <code class=syntax>default_x</code> n'est pas définie, la <a href=../../../statements/create/amp/#create-default-values>les valeurs par défaut</a> sont utilisés.</li> <li><code class=syntax>size</code>— Length of the resulting array. Optional parameter. When using this parameter, the default value <code class=syntax>default_x</code> doit être spécifié. <a href=../../../data-types/int-uint/amp/#uint-ranges>UInt32</a>.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Tableau avec des valeurs insérées.</li> </ul> <p>Type: <a href=../../../data-types/array/amp/#data-type-array>Tableau</a>.</p> <p><strong>Exemple</strong></p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupArrayInsertAt</span><span class=p>(</span><span class=n>toString</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span> <span class=nb>number</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─groupArrayInsertAt(toString(number), multiply(number, 2))─┐
│ ['0','','1','','2','','3','','4']                         │
└───────────────────────────────────────────────────────────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupArrayInsertAt</span><span class=p>(</span><span class=s1>'-'</span><span class=p>)(</span><span class=n>toString</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span> <span class=nb>number</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─groupArrayInsertAt('-')(toString(number), multiply(number, 2))─┐
│ ['0','-','1','-','2','-','3','-','4']                          │
└────────────────────────────────────────────────────────────────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupArrayInsertAt</span><span class=p>(</span><span class=s1>'-'</span><span class=p>,</span> <span class=mi>5</span><span class=p>)(</span><span class=n>toString</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span> <span class=nb>number</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─groupArrayInsertAt('-', 5)(toString(number), multiply(number, 2))─┐
│ ['0','-','1','-','2']                                             │
└───────────────────────────────────────────────────────────────────┘
</code></pre></div> <p>Insertion multi-thread d'éléments dans une position.</p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupArrayInsertAt</span><span class=p>(</span><span class=nb>number</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers_mt</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>max_block_size</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</code></pre></div> <p>Comme un résultat de cette requête, vous obtenez entier aléatoire dans le <code class=syntax>[0,9]</code> gamme. Exemple:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─groupArrayInsertAt(number, 0)─┐
│ [7]                           │
└───────────────────────────────┘
</code></pre></div> <h2 id=agg_function-grouparraymovingsum>groupeparraymovingsum<a class=headerlink href=../amp/#agg_function-grouparraymovingsum title="Permanent link"> </a></h2> <p>Calcule la somme mobile des valeurs d'entrée.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=n>numbers_for_summing</span><span class=p>)</span>
<span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=n>window_size</span><span class=p>)(</span><span class=n>numbers_for_summing</span><span class=p>)</span>
</code></pre></div> <p>La fonction peut prendre la taille de la fenêtre comme paramètre. Si spécifié, la fonction prend la taille de la fenêtre égal au nombre de lignes dans la colonne.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>numbers_for_summing</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> résultant en une valeur de type de données Numérique.</li> <li><code class=syntax>window_size</code> — Size of the calculation window.</li> </ul> <p><strong>Valeurs renvoyées</strong></p> <ul> <li>Tableau de la même taille et de même type que les données d'entrée.</li> </ul> <p><strong>Exemple</strong></p> <p>La table d'échantillon:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>t</span>
<span class=p>(</span>
    <span class=o>`</span><span class=nb>int</span><span class=o>`</span> <span class=n>UInt8</span><span class=p>,</span>
    <span class=o>`</span><span class=nb>float</span><span class=o>`</span> <span class=n>Float32</span><span class=p>,</span>
    <span class=o>`</span><span class=nb>dec</span><span class=o>`</span> <span class=n>Decimal32</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>TinyLog</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─int─┬─float─┬──dec─┐
│   1 │   1.1 │ 1.10 │
│   2 │   2.2 │ 2.20 │
│   4 │   4.4 │ 4.40 │
│   7 │  7.77 │ 7.77 │
└─────┴───────┴──────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span> <span class=k>AS</span> <span class=n>I</span><span class=p>,</span>
    <span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span> <span class=k>AS</span> <span class=n>F</span><span class=p>,</span>
    <span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=nb>dec</span><span class=p>)</span> <span class=k>AS</span> <span class=n>D</span>
<span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─I──────────┬─F───────────────────────────────┬─D──────────────────────┐
│ [1,3,7,14] │ [1.1,3.3000002,7.7000003,15.47] │ [1.10,3.30,7.70,15.47] │
└────────────┴─────────────────────────────────┴────────────────────────┘
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=mi>2</span><span class=p>)(</span><span class=nb>int</span><span class=p>)</span> <span class=k>AS</span> <span class=n>I</span><span class=p>,</span>
    <span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=mi>2</span><span class=p>)(</span><span class=nb>float</span><span class=p>)</span> <span class=k>AS</span> <span class=n>F</span><span class=p>,</span>
    <span class=n>groupArrayMovingSum</span><span class=p>(</span><span class=mi>2</span><span class=p>)(</span><span class=nb>dec</span><span class=p>)</span> <span class=k>AS</span> <span class=n>D</span>
<span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─I──────────┬─F───────────────────────────────┬─D──────────────────────┐
│ [1,3,6,11] │ [1.1,3.3000002,6.6000004,12.17] │ [1.10,3.30,6.60,12.17] │
└────────────┴─────────────────────────────────┴────────────────────────┘
</code></pre></div> <h2 id=agg_function-grouparraymovingavg>groupArrayMovingAvg<a class=headerlink href=../amp/#agg_function-grouparraymovingavg title="Permanent link"> </a></h2> <p>Calcule la moyenne mobile des valeurs d'entrée.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=n>numbers_for_summing</span><span class=p>)</span>
<span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=n>window_size</span><span class=p>)(</span><span class=n>numbers_for_summing</span><span class=p>)</span>
</code></pre></div> <p>La fonction peut prendre la taille de la fenêtre comme paramètre. Si spécifié, la fonction prend la taille de la fenêtre égal au nombre de lignes dans la colonne.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>numbers_for_summing</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> résultant en une valeur de type de données Numérique.</li> <li><code class=syntax>window_size</code> — Size of the calculation window.</li> </ul> <p><strong>Valeurs renvoyées</strong></p> <ul> <li>Tableau de la même taille et de même type que les données d'entrée.</li> </ul> <p>La fonction utilise <a href=https://en.wikipedia.org/wiki/Rounding#Rounding_towards_zero rel="external nofollow noreferrer" target=_blank>l'arrondi vers zéro</a>. Il tronque les décimales insignifiantes pour le type de données résultant.</p> <p><strong>Exemple</strong></p> <p>La table d'échantillon <code class=syntax>b</code>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>t</span>
<span class=p>(</span>
    <span class=o>`</span><span class=nb>int</span><span class=o>`</span> <span class=n>UInt8</span><span class=p>,</span>
    <span class=o>`</span><span class=nb>float</span><span class=o>`</span> <span class=n>Float32</span><span class=p>,</span>
    <span class=o>`</span><span class=nb>dec</span><span class=o>`</span> <span class=n>Decimal32</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>TinyLog</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─int─┬─float─┬──dec─┐
│   1 │   1.1 │ 1.10 │
│   2 │   2.2 │ 2.20 │
│   4 │   4.4 │ 4.40 │
│   7 │  7.77 │ 7.77 │
└─────┴───────┴──────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span> <span class=k>AS</span> <span class=n>I</span><span class=p>,</span>
    <span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span> <span class=k>AS</span> <span class=n>F</span><span class=p>,</span>
    <span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=nb>dec</span><span class=p>)</span> <span class=k>AS</span> <span class=n>D</span>
<span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─I─────────┬─F───────────────────────────────────┬─D─────────────────────┐
│ [0,0,1,3] │ [0.275,0.82500005,1.9250001,3.8675] │ [0.27,0.82,1.92,3.86] │
└───────────┴─────────────────────────────────────┴───────────────────────┘
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=mi>2</span><span class=p>)(</span><span class=nb>int</span><span class=p>)</span> <span class=k>AS</span> <span class=n>I</span><span class=p>,</span>
    <span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=mi>2</span><span class=p>)(</span><span class=nb>float</span><span class=p>)</span> <span class=k>AS</span> <span class=n>F</span><span class=p>,</span>
    <span class=n>groupArrayMovingAvg</span><span class=p>(</span><span class=mi>2</span><span class=p>)(</span><span class=nb>dec</span><span class=p>)</span> <span class=k>AS</span> <span class=n>D</span>
<span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─I─────────┬─F────────────────────────────────┬─D─────────────────────┐
│ [0,1,3,5] │ [0.55,1.6500001,3.3000002,6.085] │ [0.55,1.65,3.30,6.08] │
└───────────┴──────────────────────────────────┴───────────────────────┘
</code></pre></div> <h2 id=groupuniqarrayx-groupuniqarraymax-sizex>groupUniqArray(x), groupUniqArray (max_size) (x)<a class=headerlink href=../amp/#groupuniqarrayx-groupuniqarraymax-sizex title="Permanent link"> </a></h2> <p>Crée un tableau à partir de différentes valeurs d'argument. La consommation de mémoire est la même que pour la <code class=syntax>uniqExact</code> fonction.</p> <p>La deuxième version (avec le <code class=syntax>max_size</code> paramètre) limite la taille du tableau résultant à <code class=syntax>max_size</code> élément.<br> Exemple, <code class=syntax>groupUniqArray(1)(x)</code> est équivalent à <code class=syntax>[any(x)]</code>.</p> <h2 id=quantile>quantile<a class=headerlink href=../amp/#quantile title="Permanent link"> </a></h2> <p>Calcule une approximation <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> des données numériques de la séquence.</p> <p>Cette fonction s'applique <a href=https://en.wikipedia.org/wiki/Reservoir_sampling rel="external nofollow noreferrer" target=_blank>réservoir d'échantillonnage</a> avec une taille de réservoir jusqu'à 8192 et un générateur de nombres aléatoires pour l'échantillonnage. Le résultat est non-déterministe. Pour obtenir un quantile exact, Utilisez le <a href=../amp/#quantileexact>quantileExact</a> fonction.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantile</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>median</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</li> <li><code class=syntax>expr</code> — Expression over the column values resulting in numeric <a href=../../../data-types/amp/#data_types>types de données</a>, <a href=../../../data-types/date/amp/ >Date</a> ou <a href=../../../data-types/datetime/amp/ >DateTime</a>.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Approximative de quantiles de niveau spécifié.</li> </ul> <p>Type:</p> <ul> <li><a href=../../../data-types/float/amp/ >Float64</a> pour l'entrée de type de données numériques.</li> <li><a href=../../../data-types/date/amp/ >Date</a> si les valeurs d'entrée ont le <code class=syntax>Date</code> type.</li> <li><a href=../../../data-types/datetime/amp/ >DateTime</a> si les valeurs d'entrée ont le <code class=syntax>DateTime</code> type.</li> </ul> <p><strong>Exemple</strong></p> <p>Table d'entrée:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─val─┐
│   1 │
│   1 │
│   2 │
│   3 │
└─────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantile</span><span class=p>(</span><span class=n>val</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantile(val)─┐
│           1.5 │
└───────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantiledeterministic>quantileDeterministic<a class=headerlink href=../amp/#quantiledeterministic title="Permanent link"> </a></h2> <p>Calcule une approximation <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> des données numériques de la séquence.</p> <p>Cette fonction s'applique <a href=https://en.wikipedia.org/wiki/Reservoir_sampling rel="external nofollow noreferrer" target=_blank>réservoir d'échantillonnage</a> avec une taille de réservoir jusqu'à 8192 et un algorithme déterministe d'échantillonnage. Le résultat est déterministe. Pour obtenir un quantile exact, Utilisez le <a href=../amp/#quantileexact>quantileExact</a> fonction.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileDeterministic</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>,</span> <span class=n>determinator</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianDeterministic</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</li> <li><code class=syntax>expr</code> — Expression over the column values resulting in numeric <a href=../../../data-types/amp/#data_types>types de données</a>, <a href=../../../data-types/date/amp/ >Date</a> ou <a href=../../../data-types/datetime/amp/ >DateTime</a>.</li> <li><code class=syntax>determinator</code> — Number whose hash is used instead of a random number generator in the reservoir sampling algorithm to make the result of sampling deterministic. As a determinator you can use any deterministic positive number, for example, a user id or an event id. If the same determinator value occures too often, the function works incorrectly.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Approximative de quantiles de niveau spécifié.</li> </ul> <p>Type:</p> <ul> <li><a href=../../../data-types/float/amp/ >Float64</a> pour l'entrée de type de données numériques.</li> <li><a href=../../../data-types/date/amp/ >Date</a> si les valeurs d'entrée ont le <code class=syntax>Date</code> type.</li> <li><a href=../../../data-types/datetime/amp/ >DateTime</a> si les valeurs d'entrée ont le <code class=syntax>DateTime</code> type.</li> </ul> <p><strong>Exemple</strong></p> <p>Table d'entrée:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─val─┐
│   1 │
│   1 │
│   2 │
│   3 │
└─────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileDeterministic</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileDeterministic(val, 1)─┐
│                           1.5 │
└───────────────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantileexact>quantileExact<a class=headerlink href=../amp/#quantileexact title="Permanent link"> </a></h2> <p>Exactement calcule l' <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> des données numériques de la séquence.</p> <p>To get exact value, all the passed values ​​are combined into an array, which is then partially sorted. Therefore, the function consumes <code class=syntax>O(n)</code> de mémoire, où <code class=syntax>n</code> est un nombre de valeurs qui ont été passées. Cependant, pour un petit nombre de valeurs, la fonction est très efficace.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileExact</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianExact</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</li> <li><code class=syntax>expr</code> — Expression over the column values resulting in numeric <a href=../../../data-types/amp/#data_types>types de données</a>, <a href=../../../data-types/date/amp/ >Date</a> ou <a href=../../../data-types/datetime/amp/ >DateTime</a>.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Quantiles de niveau spécifié.</li> </ul> <p>Type:</p> <ul> <li><a href=../../../data-types/float/amp/ >Float64</a> pour l'entrée de type de données numériques.</li> <li><a href=../../../data-types/date/amp/ >Date</a> si les valeurs d'entrée ont le <code class=syntax>Date</code> type.</li> <li><a href=../../../data-types/datetime/amp/ >DateTime</a> si les valeurs d'entrée ont le <code class=syntax>DateTime</code> type.</li> </ul> <p><strong>Exemple</strong></p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileExact</span><span class=p>(</span><span class=nb>number</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileExact(number)─┐
│                     5 │
└───────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantileexactweighted>quantileExactWeighted<a class=headerlink href=../amp/#quantileexactweighted title="Permanent link"> </a></h2> <p>Exactement calcule l' <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> d'une séquence de données numériques, en tenant compte du poids de chaque élément.</p> <p>To get exact value, all the passed values ​​are combined into an array, which is then partially sorted. Each value is counted with its weight, as if it is present <code class=syntax>weight</code> times. A hash table is used in the algorithm. Because of this, if the passed values ​​are frequently repeated, the function consumes less RAM than <a href=../amp/#quantileexact>quantileExact</a>. Vous pouvez utiliser cette fonction au lieu de <code class=syntax>quantileExact</code> et spécifiez le poids 1.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileExactWeighted</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>,</span> <span class=n>weight</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianExactWeighted</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</li> <li><code class=syntax>expr</code> — Expression over the column values resulting in numeric <a href=../../../data-types/amp/#data_types>types de données</a>, <a href=../../../data-types/date/amp/ >Date</a> ou <a href=../../../data-types/datetime/amp/ >DateTime</a>.</li> <li><code class=syntax>weight</code> — Column with weights of sequence members. Weight is a number of value occurrences.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Quantiles de niveau spécifié.</li> </ul> <p>Type:</p> <ul> <li><a href=../../../data-types/float/amp/ >Float64</a> pour l'entrée de type de données numériques.</li> <li><a href=../../../data-types/date/amp/ >Date</a> si les valeurs d'entrée ont le <code class=syntax>Date</code> type.</li> <li><a href=../../../data-types/datetime/amp/ >DateTime</a> si les valeurs d'entrée ont le <code class=syntax>DateTime</code> type.</li> </ul> <p><strong>Exemple</strong></p> <p>Table d'entrée:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─n─┬─val─┐
│ 0 │   3 │
│ 1 │   2 │
│ 2 │   1 │
│ 5 │   4 │
└───┴─────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileExactWeighted</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileExactWeighted(n, val)─┐
│                             1 │
└───────────────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantiletiming>quantileTiming<a class=headerlink href=../amp/#quantiletiming title="Permanent link"> </a></h2> <p>Avec la précision déterminée calcule le <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> des données numériques de la séquence.</p> <p>Le résultat est déterministe (il ne dépend pas de l'ordre de traitement de la requête). La fonction est optimisée pour travailler avec des séquences qui décrivent des distributions comme les temps de chargement des pages web ou les temps de réponse du backend.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileTiming</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianTiming</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li> <p><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</p> </li> <li> <p><code class=syntax>expr</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> sur une colonne Valeurs renvoyant un <a href=../../../data-types/float/amp/ >Flottant*</a>numéro de type.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>- If negative values are passed to the function, the behavior is undefined.</span>
<span class=err>- If the value is greater than 30,000 (a page loading time of more than 30 seconds), it is assumed to be 30,000.</span>
</code></pre></div> </li> </ul> <p><strong>Exactitude</strong></p> <p>Le calcul est précis si:</p> <ul> <li>Le nombre Total de valeurs ne dépasse pas 5670.</li> <li>Le nombre Total de valeurs dépasse 5670, mais le temps de chargement de la page est inférieur à 1024ms.</li> </ul> <p>Sinon, le résultat du calcul est arrondi au plus proche multiple de 16 ms.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Pour calculer les quantiles de temps de chargement de page, cette fonction est plus efficace et précise que <a class=alert-link href=../amp/#quantile>quantile</a>.</p> </div> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Quantiles de niveau spécifié.</li> </ul> <p>Type: <code class=syntax>Float32</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Si aucune valeur n'est transmise à la fonction (lors de l'utilisation de <code class=syntax>quantileTimingIf</code>), <a class=alert-link href=../../../data-types/float/amp/#data_type-float-nan-inf>Nan</a> est retourné. Le but est de différencier ces cas de cas qui aboutissent à zéro. Voir <a class=alert-link href=../../../statements/select/order-by/amp/#select-order-by>Clause ORDER BY</a> pour des notes sur le tri <code class=syntax>NaN</code> valeur.</p> </div> <p><strong>Exemple</strong></p> <p>Table d'entrée:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─response_time─┐
│            72 │
│           112 │
│           126 │
│           145 │
│           104 │
│           242 │
│           313 │
│           168 │
│           108 │
└───────────────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileTiming</span><span class=p>(</span><span class=n>response_time</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileTiming(response_time)─┐
│                           126 │
└───────────────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantiletimingweighted>quantileTimingWeighted<a class=headerlink href=../amp/#quantiletimingweighted title="Permanent link"> </a></h2> <p>Avec la précision déterminée calcule le <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> d'une séquence de données numériques en fonction du poids de chaque élément de séquence.</p> <p>Le résultat est déterministe (il ne dépend pas de l'ordre de traitement de la requête). La fonction est optimisée pour travailler avec des séquences qui décrivent des distributions comme les temps de chargement des pages web ou les temps de réponse du backend.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileTimingWeighted</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>,</span> <span class=n>weight</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianTimingWeighted</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li> <p><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</p> </li> <li> <p><code class=syntax>expr</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> sur une colonne Valeurs renvoyant un <a href=../../../data-types/float/amp/ >Flottant*</a>numéro de type.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>- If negative values are passed to the function, the behavior is undefined.</span>
<span class=err>- If the value is greater than 30,000 (a page loading time of more than 30 seconds), it is assumed to be 30,000.</span>
</code></pre></div> </li> <li> <p><code class=syntax>weight</code> — Column with weights of sequence elements. Weight is a number of value occurrences.</p> </li> </ul> <p><strong>Exactitude</strong></p> <p>Le calcul est précis si:</p> <ul> <li>Le nombre Total de valeurs ne dépasse pas 5670.</li> <li>Le nombre Total de valeurs dépasse 5670, mais le temps de chargement de la page est inférieur à 1024ms.</li> </ul> <p>Sinon, le résultat du calcul est arrondi au plus proche multiple de 16 ms.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Pour calculer les quantiles de temps de chargement de page, cette fonction est plus efficace et précise que <a class=alert-link href=../amp/#quantile>quantile</a>.</p> </div> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Quantiles de niveau spécifié.</li> </ul> <p>Type: <code class=syntax>Float32</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Si aucune valeur n'est transmise à la fonction (lors de l'utilisation de <code class=syntax>quantileTimingIf</code>), <a class=alert-link href=../../../data-types/float/amp/#data_type-float-nan-inf>Nan</a> est retourné. Le but est de différencier ces cas de cas qui aboutissent à zéro. Voir <a class=alert-link href=../../../statements/select/order-by/amp/#select-order-by>Clause ORDER BY</a> pour des notes sur le tri <code class=syntax>NaN</code> valeur.</p> </div> <p><strong>Exemple</strong></p> <p>Table d'entrée:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─response_time─┬─weight─┐
│            68 │      1 │
│           104 │      2 │
│           112 │      3 │
│           126 │      2 │
│           138 │      1 │
│           162 │      1 │
└───────────────┴────────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileTimingWeighted</span><span class=p>(</span><span class=n>response_time</span><span class=p>,</span> <span class=n>weight</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileTimingWeighted(response_time, weight)─┐
│                                           112 │
└───────────────────────────────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantiletdigest>quantileTDigest<a class=headerlink href=../amp/#quantiletdigest title="Permanent link"> </a></h2> <p>Calcule une approximation <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> d'une séquence de données numériques utilisant <a href=https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf rel="external nofollow noreferrer" target=_blank>t-digest</a> algorithme.</p> <p>L'erreur maximale est de 1%. La consommation de mémoire est <code class=syntax>log(n)</code>, où <code class=syntax>n</code> est un certain nombre de valeurs. Le résultat dépend de l'ordre d'exécution de la requête et n'est pas déterministe.</p> <p>La performance de la fonction est inférieure à la performance de <a href=../amp/#quantile>quantile</a> ou <a href=../amp/#quantiletiming>quantileTiming</a>. En termes de rapport entre la taille de L'état et la précision, cette fonction est bien meilleure que <code class=syntax>quantile</code>.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileTDigest</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianTDigest</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</li> <li><code class=syntax>expr</code> — Expression over the column values resulting in numeric <a href=../../../data-types/amp/#data_types>types de données</a>, <a href=../../../data-types/date/amp/ >Date</a> ou <a href=../../../data-types/datetime/amp/ >DateTime</a>.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Approximative de quantiles de niveau spécifié.</li> </ul> <p>Type:</p> <ul> <li><a href=../../../data-types/float/amp/ >Float64</a> pour l'entrée de type de données numériques.</li> <li><a href=../../../data-types/date/amp/ >Date</a> si les valeurs d'entrée ont le <code class=syntax>Date</code> type.</li> <li><a href=../../../data-types/datetime/amp/ >DateTime</a> si les valeurs d'entrée ont le <code class=syntax>DateTime</code> type.</li> </ul> <p><strong>Exemple</strong></p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileTDigest</span><span class=p>(</span><span class=nb>number</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileTDigest(number)─┐
│                     4.5 │
└─────────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=quantiletdigestweighted>quantileTDigestWeighted<a class=headerlink href=../amp/#quantiletdigestweighted title="Permanent link"> </a></h2> <p>Calcule une approximation <a href=https://en.wikipedia.org/wiki/Quantile rel="external nofollow noreferrer" target=_blank>quantile</a> d'une séquence de données numériques utilisant <a href=https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf rel="external nofollow noreferrer" target=_blank>t-digest</a> algorithme. La fonction prend en compte le poids de chaque séquence de membre. L'erreur maximale est de 1%. La consommation de mémoire est <code class=syntax>log(n)</code>, où <code class=syntax>n</code> est un certain nombre de valeurs.</p> <p>La performance de la fonction est inférieure à la performance de <a href=../amp/#quantile>quantile</a> ou <a href=../amp/#quantiletiming>quantileTiming</a>. En termes de rapport entre la taille de L'état et la précision, cette fonction est bien meilleure que <code class=syntax>quantile</code>.</p> <p>Le résultat dépend de l'ordre d'exécution de la requête et n'est pas déterministe.</p> <p>Lorsque vous utilisez plusieurs <code class=syntax>quantile*</code> fonctionne avec différents niveaux dans une requête, les états internes ne sont pas combinées (qui est, la requête fonctionne moins efficacement qu'il le pouvait). Dans ce cas, utilisez la <a href=../amp/#quantiles>les quantiles</a> fonction.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>quantileTDigest</span><span class=p>(</span><span class=k>level</span><span class=p>)(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p>Alias: <code class=syntax>medianTDigest</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code class=syntax>level</code> la valeur dans la plage de <code class=syntax>[0.01, 0.99]</code>. Valeur par défaut: 0.5. À <code class=syntax>level=0.5</code> la fonction calcule <a href=https://en.wikipedia.org/wiki/Median rel="external nofollow noreferrer" target=_blank>médian</a>.</li> <li><code class=syntax>expr</code> — Expression over the column values resulting in numeric <a href=../../../data-types/amp/#data_types>types de données</a>, <a href=../../../data-types/date/amp/ >Date</a> ou <a href=../../../data-types/datetime/amp/ >DateTime</a>.</li> <li><code class=syntax>weight</code> — Column with weights of sequence elements. Weight is a number of value occurrences.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <ul> <li>Approximative de quantiles de niveau spécifié.</li> </ul> <p>Type:</p> <ul> <li><a href=../../../data-types/float/amp/ >Float64</a> pour l'entrée de type de données numériques.</li> <li><a href=../../../data-types/date/amp/ >Date</a> si les valeurs d'entrée ont le <code class=syntax>Date</code> type.</li> <li><a href=../../../data-types/datetime/amp/ >DateTime</a> si les valeurs d'entrée ont le <code class=syntax>DateTime</code> type.</li> </ul> <p><strong>Exemple</strong></p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>quantileTDigestWeighted</span><span class=p>(</span><span class=nb>number</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─quantileTDigestWeighted(number, 1)─┐
│                                4.5 │
└────────────────────────────────────┘
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#median>médian</a></li> <li><a href=../amp/#quantiles>les quantiles</a></li> </ul> <h2 id=median>médian<a class=headerlink href=../amp/#median title="Permanent link"> </a></h2> <p>Le <code class=syntax>median*</code> les fonctions sont les Alias pour le correspondant <code class=syntax>quantile*</code> fonction. Ils calculent la médiane d'un échantillon de données numériques.</p> <p>Fonction:</p> <ul> <li><code class=syntax>median</code> — Alias for <a href=../amp/#quantile>quantile</a>.</li> <li><code class=syntax>medianDeterministic</code> — Alias for <a href=../amp/#quantiledeterministic>quantileDeterministic</a>.</li> <li><code class=syntax>medianExact</code> — Alias for <a href=../amp/#quantileexact>quantileExact</a>.</li> <li><code class=syntax>medianExactWeighted</code> — Alias for <a href=../amp/#quantileexactweighted>quantileExactWeighted</a>.</li> <li><code class=syntax>medianTiming</code> — Alias for <a href=../amp/#quantiletiming>quantileTiming</a>.</li> <li><code class=syntax>medianTimingWeighted</code> — Alias for <a href=../amp/#quantiletimingweighted>quantileTimingWeighted</a>.</li> <li><code class=syntax>medianTDigest</code> — Alias for <a href=../amp/#quantiletdigest>quantileTDigest</a>.</li> <li><code class=syntax>medianTDigestWeighted</code> — Alias for <a href=../amp/#quantiletdigestweighted>quantileTDigestWeighted</a>.</li> </ul> <p><strong>Exemple</strong></p> <p>Table d'entrée:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─val─┐
│   1 │
│   1 │
│   2 │
│   3 │
└─────┘
</code></pre></div> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>medianDeterministic</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─medianDeterministic(val, 1)─┐
│                         1.5 │
└─────────────────────────────┘
</code></pre></div> <h2 id=quantiles>quantiles(level1, level2, …)(x)<a class=headerlink href=../amp/#quantiles title="Permanent link"> </a></h2> <p>Toutes les fonctions quantiles ont également des fonctions quantiles correspondantes: <code class=syntax>quantiles</code>, <code class=syntax>quantilesDeterministic</code>, <code class=syntax>quantilesTiming</code>, <code class=syntax>quantilesTimingWeighted</code>, <code class=syntax>quantilesExact</code>, <code class=syntax>quantilesExactWeighted</code>, <code class=syntax>quantilesTDigest</code>. Ces fonctions calculent tous les quantiles des niveaux listés en une seule passe et renvoient un tableau des valeurs résultantes.</p> <h2 id=varsampx>varSamp (x)<a class=headerlink href=../amp/#varsampx title="Permanent link"> </a></h2> <p>Calcule le montant <code class=syntax>Σ((x - x̅)^2) / (n - 1)</code>, où <code class=syntax>n</code> est la taille de l'échantillon et <code class=syntax>x̅</code>est la valeur moyenne de <code class=syntax>x</code>.</p> <p>Il représente une estimation non biaisée de la variance d'une variable aléatoire si les valeurs passées forment son échantillon.</p> <p>Retourner <code class=syntax>Float64</code>. Lorsque <code class=syntax>n &lt;= 1</code>, retourner <code class=syntax>+∞</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>varSampStable</code> fonction. Il fonctionne plus lentement, mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=varpopx>varPop (x)<a class=headerlink href=../amp/#varpopx title="Permanent link"> </a></h2> <p>Calcule le montant <code class=syntax>Σ((x - x̅)^2) / n</code>, où <code class=syntax>n</code> est la taille de l'échantillon et <code class=syntax>x̅</code>est la valeur moyenne de <code class=syntax>x</code>.</p> <p>En d'autres termes, dispersion pour un ensemble de valeurs. Retourner <code class=syntax>Float64</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>varPopStable</code> fonction. Il fonctionne plus lentement, mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=stddevsampx>stddevSamp (x)<a class=headerlink href=../amp/#stddevsampx title="Permanent link"> </a></h2> <p>Le résultat est égal à la racine carrée de <code class=syntax>varSamp(x)</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>stddevSampStable</code> fonction. Il fonctionne plus lentement, mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=stddevpopx>stddevPop (x)<a class=headerlink href=../amp/#stddevpopx title="Permanent link"> </a></h2> <p>Le résultat est égal à la racine carrée de <code class=syntax>varPop(x)</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>stddevPopStable</code> fonction. Il fonctionne plus lentement, mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=topknx>topK (N) (x)<a class=headerlink href=../amp/#topknx title="Permanent link"> </a></h2> <p>Renvoie un tableau des valeurs approximativement les plus fréquentes dans la colonne spécifiée. Le tableau est trié par ordre décroissant de fréquence approximative des valeurs (et non par les valeurs elles-mêmes).</p> <p>Met en œuvre la <a href=http://www.l2f.inesc-id.pt/~fmmb/wiki/uploads/Work/misnis.ref0a.pdf rel="external nofollow noreferrer" target=_blank>Gain De Place Filtré</a> algorithme d'analyse de TopK, basé sur l'algorithme de réduction et de combinaison de <a href=https://arxiv.org/pdf/1401.0702.pdf rel="external nofollow noreferrer" target=_blank>Économie D'Espace Parallèle</a>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>topK</span><span class=p>(</span><span class=n>N</span><span class=p>)(</span><span class=k>column</span><span class=p>)</span>
</code></pre></div> <p>Cette fonction ne fournit pas un résultat garanti. Dans certaines situations, des erreurs peuvent se produire et renvoyer des valeurs fréquentes qui ne sont pas les valeurs les plus fréquentes.</p> <p>Nous vous recommandons d'utiliser l' <code class=syntax>N &lt; 10</code> valeur; performance est réduite avec grand <code class=syntax>N</code> valeur. Valeur maximale de <code class=syntax>N = 65536</code>.</p> <p><strong>Paramètre</strong></p> <ul> <li>‘N’ est le nombre d'éléments de retour.</li> </ul> <p>Si le paramètre est omis, la valeur par défaut 10 est utilisé.</p> <p><strong>Argument</strong></p> <ul> <li>' x ' – The value to calculate frequency.</li> </ul> <p><strong>Exemple</strong></p> <p>Prendre la <a href=../../../../getting-started/example-datasets/ontime/amp/ >OnTime</a> ensemble de données et sélectionnez les trois valeurs les plus fréquentes <code class=syntax>AirlineID</code> colonne.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>topK</span><span class=p>(</span><span class=mi>3</span><span class=p>)(</span><span class=n>AirlineID</span><span class=p>)</span> <span class=k>AS</span> <span class=n>res</span>
<span class=k>FROM</span> <span class=n>ontime</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─res─────────────────┐
│ [19393,19790,19805] │
└─────────────────────┘
</code></pre></div> <h2 id=topkweighted>topKWeighted<a class=headerlink href=../amp/#topkweighted title="Permanent link"> </a></h2> <p>Semblable à <code class=syntax>topK</code> mais prend un argument de type entier - <code class=syntax>weight</code>. Chaque valeur est comptabilisée <code class=syntax>weight</code> les temps de calcul de fréquence.</p> <p><strong>Syntaxe</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>topKWeighted</span><span class=p>(</span><span class=n>N</span><span class=p>)(</span><span class=n>x</span><span class=p>,</span> <span class=n>weight</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <ul> <li><code class=syntax>N</code> — The number of elements to return.</li> </ul> <p><strong>Argument</strong></p> <ul> <li><code class=syntax>x</code> – The value.</li> <li><code class=syntax>weight</code> — The weight. <a href=../../../data-types/int-uint/amp/ >UInt8</a>.</li> </ul> <p><strong>Valeur renvoyée</strong></p> <p>Renvoie un tableau des valeurs avec la somme approximative maximale des poids.</p> <p><strong>Exemple</strong></p> <p>Requête:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>topKWeighted</span><span class=p>(</span><span class=mi>10</span><span class=p>)(</span><span class=nb>number</span><span class=p>,</span> <span class=nb>number</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>
</code></pre></div> <p>Résultat:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─topKWeighted(10)(number, number)──────────┐
│ [999,998,997,996,995,994,993,992,991,990] │
└───────────────────────────────────────────┘
</code></pre></div> <h2 id=covarsampx-y>covarSamp(x, y)<a class=headerlink href=../amp/#covarsampx-y title="Permanent link"> </a></h2> <p>Calcule la valeur de <code class=syntax>Σ((x - x̅)(y - y̅)) / (n - 1)</code>.</p> <p>Renvoie Float64. Lorsque <code class=syntax>n &lt;= 1</code>, returns +∞.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>covarSampStable</code> fonction. Il fonctionne plus lentement, mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=covarpopx-y>covarPop (x, y)<a class=headerlink href=../amp/#covarpopx-y title="Permanent link"> </a></h2> <p>Calcule la valeur de <code class=syntax>Σ((x - x̅)(y - y̅)) / n</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>covarPopStable</code> fonction. Cela fonctionne plus lentement mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=corrx-y>corr (x, y)<a class=headerlink href=../amp/#corrx-y title="Permanent link"> </a></h2> <p>Calcule le coefficient de corrélation de Pearson: <code class=syntax>Σ((x - x̅)(y - y̅)) / sqrt(Σ((x - x̅)^2) * Σ((y - y̅)^2))</code>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Note</p> <p>Cette fonction utilise un algorithme numériquement instable. Si vous avez besoin d' <a class=alert-link href=https://en.wikipedia.org/wiki/Numerical_stability rel="external nofollow noreferrer" target=_blank>stabilité numérique</a> dans les calculs, utiliser le <code class=syntax>corrStable</code> fonction. Il fonctionne plus lentement, mais fournit une erreur de calcul inférieure.</p> </div> <h2 id=categoricalinformationvalue>categoricalInformationValue<a class=headerlink href=../amp/#categoricalinformationvalue title="Permanent link"> </a></h2> <p>Calcule la valeur de <code class=syntax>(P(tag = 1) - P(tag = 0))(log(P(tag = 1)) - log(P(tag = 0)))</code> pour chaque catégorie.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>categoricalInformationValue</span><span class=p>(</span><span class=n>category1</span><span class=p>,</span> <span class=n>category2</span><span class=p>,</span> <span class=p>...,</span> <span class=n>tag</span><span class=p>)</span>
</code></pre></div> <p>Le résultat indique comment une caractéristique discrète (catégorique) <code class=syntax>[category1, category2, ...]</code> contribuer à un modèle d'apprentissage qui prédit la valeur de <code class=syntax>tag</code>.</p> <h2 id=simplelinearregression>simplelineearregression<a class=headerlink href=../amp/#simplelinearregression title="Permanent link"> </a></h2> <p>Effectue une régression linéaire simple (unidimensionnelle).</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>simpleLinearRegression</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</code></pre></div> <p>Paramètre:</p> <ul> <li><code class=syntax>x</code> — Column with dependent variable values.</li> <li><code class=syntax>y</code> — Column with explanatory variable values.</li> </ul> <p>Valeurs renvoyées:</p> <p>Constant <code class=syntax>(a, b)</code> de la ligne <code class=syntax>y = a*x + b</code>.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>arrayReduce</span><span class=p>(</span><span class=s1>'simpleLinearRegression'</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─arrayReduce('simpleLinearRegression', [0, 1, 2, 3], [0, 1, 2, 3])─┐
│ (1,0)                                                             │
└───────────────────────────────────────────────────────────────────┘
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>arrayReduce</span><span class=p>(</span><span class=s1>'simpleLinearRegression'</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>])</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─arrayReduce('simpleLinearRegression', [0, 1, 2, 3], [3, 4, 5, 6])─┐
│ (1,3)                                                             │
└───────────────────────────────────────────────────────────────────┘
</code></pre></div> <h2 id=agg_functions-stochasticlinearregression>stochasticLinearRegression<a class=headerlink href=../amp/#agg_functions-stochasticlinearregression title="Permanent link"> </a></h2> <p>Cette fonction implémente la régression linéaire stochastique. Il prend en charge les paramètres personnalisés pour le taux d'apprentissage, le coefficient de régularisation L2, la taille de mini-lot et a peu de méthodes pour mettre à jour les poids (<a href=https://en.wikipedia.org/wiki/Stochastic_gradient_descent#Adam rel="external nofollow noreferrer" target=_blank>Adam</a> (utilisé par défaut), <a href=https://en.wikipedia.org/wiki/Stochastic_gradient_descent rel="external nofollow noreferrer" target=_blank>simple SGD</a>, <a href=https://en.wikipedia.org/wiki/Stochastic_gradient_descent#Momentum rel="external nofollow noreferrer" target=_blank>Élan</a>, <a href=https://mipt.ru/upload/medialibrary/d7e/41-91.pdf rel="external nofollow noreferrer" target=_blank>Nesterov</a>).</p> <h3 id=agg_functions-stochasticlinearregression-parameters>Paramètre<a class=headerlink href=../amp/#agg_functions-stochasticlinearregression-parameters title="Permanent link"> </a></h3> <p>Il y a 4 paramètres personnalisables. Ils sont passés à la fonction séquentiellement, mais il n'est pas nécessaire de passer tous les quatre-les valeurs par défaut seront utilisées, mais un bon modèle nécessite un réglage des paramètres.</p> <div class=codehilite><pre><span></span><code class=syntax>stochasticLinearRegression(1.0, 1.0, 10, 'SGD')
</code></pre></div> <ol> <li><code class=syntax>learning rate</code> est le coefficient sur la longueur de l'étape, lorsque l'étape de descente de gradient est effectuée. Un taux d'apprentissage trop élevé peut entraîner des poids infinis du modèle. Par défaut est <code class=syntax>0.00001</code>.</li> <li><code class=syntax>l2 regularization coefficient</code> ce qui peut aider à éviter le surajustement. Par défaut est <code class=syntax>0.1</code>.</li> <li><code class=syntax>mini-batch size</code> définit le nombre d'éléments, dont les gradients seront calculés et additionnés pour effectuer une étape de descente de gradient. La descente stochastique Pure utilise un élément, mais avoir de petits lots (environ 10 éléments) rend les étapes de gradient plus stables. Par défaut est <code class=syntax>15</code>.</li> <li><code class=syntax>method for updating weights</code> ils sont: <code class=syntax>Adam</code> (par défaut), <code class=syntax>SGD</code>, <code class=syntax>Momentum</code>, <code class=syntax>Nesterov</code>. <code class=syntax>Momentum</code> et <code class=syntax>Nesterov</code> nécessitent un peu plus de calculs et de mémoire, mais ils sont utiles en termes de vitesse de convergence et de stabilité des méthodes de gradient stochastique.</li> </ol> <h3 id=agg_functions-stochasticlinearregression-usage>Utilisation<a class=headerlink href=../amp/#agg_functions-stochasticlinearregression-usage title="Permanent link"> </a></h3> <p><code class=syntax>stochasticLinearRegression</code> est utilisé en deux étapes: ajustement du modèle et prédiction sur de nouvelles données. Afin de correspondre le modèle et l'enregistrer son état pour utilisation ultérieure nous utilisons <code class=syntax>-State</code> combinator, qui enregistre essentiellement l'état (poids du modèle, etc.).<br> Pour prédire nous utilisons la fonction <a href=../../../functions/machine-learning-functions/amp/#machine_learning_methods-evalmlmethod>evalMLMethod</a> qui prend un état comme un argument ainsi que des fonctionnalités à prévoir sur.</p> <p><a name=stochasticlinearregression-usage-fitting></a></p> <p><strong>1.</strong> Raccord</p> <p>Une telle requête peut être utilisé.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span> <span class=n>train_data</span>
<span class=p>(</span>
    <span class=n>param1</span> <span class=n>Float64</span><span class=p>,</span>
    <span class=n>param2</span> <span class=n>Float64</span><span class=p>,</span>
    <span class=n>target</span> <span class=n>Float64</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>Memory</span><span class=p>;</span>

<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>your_model</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>Memory</span> <span class=k>AS</span> <span class=k>SELECT</span>
<span class=n>stochasticLinearRegressionState</span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=s1>'SGD'</span><span class=p>)(</span><span class=n>target</span><span class=p>,</span> <span class=n>param1</span><span class=p>,</span> <span class=n>param2</span><span class=p>)</span>
<span class=k>AS</span> <span class=k>state</span> <span class=k>FROM</span> <span class=n>train_data</span><span class=p>;</span>
</code></pre></div> <p>Ici, nous devons également insérer des données dans <code class=syntax>train_data</code> table. Le nombre de paramètres n'est pas fixe, il dépend uniquement du nombre d'arguments, passés dans <code class=syntax>linearRegressionState</code>. Ils doivent tous être des valeurs numériques.<br> Notez que la colonne avec la valeur cible (que nous aimerions apprendre à prédire) est insérée comme premier argument.</p> <p><strong>2.</strong> Prédire</p> <p>Après avoir enregistré un État dans la table, nous pouvons l'utiliser plusieurs fois pour la prédiction, ou même fusionner avec d'autres États et créer de nouveaux modèles encore meilleurs.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>WITH</span> <span class=p>(</span><span class=k>SELECT</span> <span class=k>state</span> <span class=k>FROM</span> <span class=n>your_model</span><span class=p>)</span> <span class=k>AS</span> <span class=n>model</span> <span class=k>SELECT</span>
<span class=n>evalMLMethod</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>param1</span><span class=p>,</span> <span class=n>param2</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_data</span>
</code></pre></div> <p>La requête renvoie une colonne de valeurs prédites. Notez que le premier argument de <code class=syntax>evalMLMethod</code> être <code class=syntax>AggregateFunctionState</code> objet, sont ensuite des colonnes de fonctionnalités.</p> <p><code class=syntax>test_data</code> est un tableau comme <code class=syntax>train_data</code> mais peut ne pas contenir de valeur cible.</p> <h3 id=agg_functions-stochasticlinearregression-notes>Note<a class=headerlink href=../amp/#agg_functions-stochasticlinearregression-notes title="Permanent link"> </a></h3> <ol> <li> <p>Pour fusionner deux modèles l'utilisateur peut créer une telle requête:<br> <code class=syntax>sql SELECT state1 + state2 FROM your_models</code><br> où <code class=syntax>your_models</code> le tableau contient les deux modèles. Cette requête renvoie la nouvelle <code class=syntax>AggregateFunctionState</code> objet.</p> </li> <li> <p>L'utilisateur peut récupérer les poids du modèle pour ses propres fins, sans enregistrer le modèle, si aucune <code class=syntax>-State</code> combinator est utilisé.<br> <code class=syntax>sql SELECT stochasticLinearRegression(0.01)(target, param1, param2) FROM train_data</code><br> Une telle requête s'adaptera au Modèle et retournera ses poids-d'abord sont des poids, qui correspondent aux paramètres du modèle, le dernier est un biais. Ainsi, dans l'exemple ci-dessus, la requête renvoie une colonne avec 3 valeurs.</p> </li> </ol> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#agg_functions-stochasticlogisticregression>stochasticLogisticRegression</a></li> <li><a href=https://stackoverflow.com/questions/12146914/what-is-the-difference-between-linear-regression-and-logistic-regression rel="external nofollow noreferrer" target=_blank>Différence entre les régressions linéaires et logistiques</a></li> </ul> <h2 id=agg_functions-stochasticlogisticregression>stochasticLogisticRegression<a class=headerlink href=../amp/#agg_functions-stochasticlogisticregression title="Permanent link"> </a></h2> <p>Cette fonction implémente la régression logistique stochastique. Il peut être utilisé pour le problème de classification binaire, prend en charge les mêmes paramètres personnalisés que stochasticLinearRegression et fonctionne de la même manière.</p> <h3 id=agg_functions-stochasticlogisticregression-parameters>Paramètre<a class=headerlink href=../amp/#agg_functions-stochasticlogisticregression-parameters title="Permanent link"> </a></h3> <p>Les paramètres sont exactement les mêmes que dans stochasticLinearRegression:<br> <code class=syntax>learning rate</code>, <code class=syntax>l2 regularization coefficient</code>, <code class=syntax>mini-batch size</code>, <code class=syntax>method for updating weights</code>.<br> Pour plus d'informations, voir <a href=../amp/#agg_functions-stochasticlinearregression-parameters>paramètre</a>.</p> <div class=codehilite><pre><span></span><code class=syntax>stochasticLogisticRegression(1.0, 1.0, 10, 'SGD')
</code></pre></div> <ol> <li>Raccord</li> </ol> <!-- --> <div class=codehilite><pre><span></span><code class=syntax><span class=n>See</span> <span class=n>the</span> <span class=ss>`Fitting`</span> <span class=n>section</span> <span class=k>in</span> <span class=n>the</span> <span class=p>[</span><span class=n>stochasticLinearRegression</span><span class=p>](</span><span class=c1>#stochasticlinearregression-usage-fitting) description.</span>

<span class=n>Predicted</span> <span class=n>labels</span> <span class=n>have</span> <span class=k>to</span> <span class=n>be</span> <span class=k>in</span> <span class=err>\</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=err>\</span><span class=p>].</span>
</code></pre></div> <ol> <li>Prédire</li> </ol> <!-- --> <div class=codehilite><pre><span></span><code class=syntax><span class=k>Using</span> <span class=n>saved</span> <span class=n>state</span> <span class=n>we</span> <span class=n>can</span> <span class=n>predict</span> <span class=n>probability</span> <span class=n>of</span> <span class=n>object</span> <span class=k>having</span> <span class=n>label</span> <span class=ss>`1`</span><span class=p>.</span>

<span class=ss>``` sql</span>
<span class=ss>WITH (SELECT state FROM your_model) AS model SELECT</span>
<span class=ss>evalMLMethod(model, param1, param2) FROM test_data</span>
<span class=ss>```</span>

<span class=n>The</span> <span class=n>query</span> <span class=n>will</span> <span class=k>return</span> <span class=n>a</span> <span class=k>column</span> <span class=n>of</span> <span class=n>probabilities</span><span class=p>.</span> <span class=n>Note</span> <span class=n>that</span> <span class=n>first</span> <span class=n>argument</span> <span class=n>of</span> <span class=ss>`evalMLMethod`</span> <span class=k>is</span> <span class=ss>`AggregateFunctionState`</span> <span class=n>object</span><span class=p>,</span> <span class=n>next</span> <span class=n>are</span> <span class=n>columns</span> <span class=n>of</span> <span class=n>features</span><span class=p>.</span>

<span class=n>We</span> <span class=n>can</span> <span class=n>also</span> <span class=kt>set</span> <span class=n>a</span> <span class=n>bound</span> <span class=n>of</span> <span class=n>probability</span><span class=p>,</span> <span class=n>which</span> <span class=n>assigns</span> <span class=n>elements</span> <span class=k>to</span> <span class=n>different</span> <span class=n>labels</span><span class=p>.</span>

<span class=ss>``` sql</span>
<span class=ss>SELECT ans &lt; 1.1 AND ans &gt; 0.5 FROM</span>
<span class=ss>(WITH (SELECT state FROM your_model) AS model SELECT</span>
<span class=ss>evalMLMethod(model, param1, param2) AS ans FROM test_data)</span>
<span class=ss>```</span>

<span class=k>Then</span> <span class=n>the</span> <span class=n>result</span> <span class=n>will</span> <span class=n>be</span> <span class=n>labels</span><span class=p>.</span>

<span class=ss>`test_data`</span> <span class=k>is</span> <span class=n>a</span> <span class=k>table</span> <span class=k>like</span> <span class=ss>`train_data`</span> <span class=n>but</span> <span class=n>may</span> <span class=k>not</span> <span class=n>contain</span> <span class=n>target</span> <span class=n>value</span><span class=p>.</span>
</code></pre></div> <p><strong>Voir Aussi</strong></p> <ul> <li><a href=../amp/#agg_functions-stochasticlinearregression>stochasticLinearRegression</a></li> <li><a href=https://stackoverflow.com/questions/12146914/what-is-the-difference-between-linear-regression-and-logistic-regression rel="external nofollow noreferrer" target=_blank>Différence entre les régressions linéaires et logistiques.</a></li> </ul> <h2 id=groupbitmapand>groupBitmapAnd<a class=headerlink href=../amp/#groupbitmapand title="Permanent link"> </a></h2> <p>Calculs le et d'une colonne bitmap, retour cardinalité de type UInt64, si Ajouter suffixe-État, puis retour <a href=../../../functions/bitmap-functions/amp/ >objet bitmap</a>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitmapAnd</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>AggregateFunction(groupBitmap, UInt*)</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt64</code> type.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>DROP</span> <span class=k>TABLE</span> <span class=k>IF</span> <span class=k>EXISTS</span> <span class=n>bitmap_column_expr_test2</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>bitmap_column_expr_test2</span>
<span class=p>(</span>
    <span class=n>tag_id</span> <span class=n>String</span><span class=p>,</span>
    <span class=n>z</span> <span class=n>AggregateFunction</span><span class=p>(</span><span class=n>groupBitmap</span><span class=p>,</span> <span class=n>UInt32</span><span class=p>)</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>tag_id</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag1'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag2'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag3'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>12</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>

<span class=k>SELECT</span> <span class=n>groupBitmapAnd</span><span class=p>(</span><span class=n>z</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>WHERE</span> <span class=k>like</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=s1>'tag%'</span><span class=p>);</span>
<span class=err>┌─</span><span class=n>groupBitmapAnd</span><span class=p>(</span><span class=n>z</span><span class=p>)</span><span class=err>─┐</span>
<span class=err>│</span>               <span class=mi>3</span>   <span class=err>│</span>
<span class=err>└───────────────────┘</span>

<span class=k>SELECT</span> <span class=n>arraySort</span><span class=p>(</span><span class=n>bitmapToArray</span><span class=p>(</span><span class=n>groupBitmapAndState</span><span class=p>(</span><span class=n>z</span><span class=p>)))</span> <span class=k>FROM</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>WHERE</span> <span class=k>like</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=s1>'tag%'</span><span class=p>);</span>
<span class=err>┌─</span><span class=n>arraySort</span><span class=p>(</span><span class=n>bitmapToArray</span><span class=p>(</span><span class=n>groupBitmapAndState</span><span class=p>(</span><span class=n>z</span><span class=p>)))</span><span class=err>─┐</span>
<span class=err>│</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>10</span><span class=p>]</span>                                         <span class=err>│</span>
<span class=err>└──────────────────────────────────────────────────┘</span>
</code></pre></div> <h2 id=groupbitmapor>groupBitmapOr<a class=headerlink href=../amp/#groupbitmapor title="Permanent link"> </a></h2> <p>Calculs le ou d'une colonne bitmap, retour cardinalité de type UInt64, si Ajouter suffixe-État, puis retour <a href=../../../functions/bitmap-functions/amp/ >objet bitmap</a>. C'est l'équivalent de <code class=syntax>groupBitmapMerge</code>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitmapOr</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>AggregateFunction(groupBitmap, UInt*)</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt64</code> type.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>DROP</span> <span class=k>TABLE</span> <span class=k>IF</span> <span class=k>EXISTS</span> <span class=n>bitmap_column_expr_test2</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>bitmap_column_expr_test2</span>
<span class=p>(</span>
    <span class=n>tag_id</span> <span class=n>String</span><span class=p>,</span>
    <span class=n>z</span> <span class=n>AggregateFunction</span><span class=p>(</span><span class=n>groupBitmap</span><span class=p>,</span> <span class=n>UInt32</span><span class=p>)</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>tag_id</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag1'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag2'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag3'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>12</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>

<span class=k>SELECT</span> <span class=n>groupBitmapOr</span><span class=p>(</span><span class=n>z</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>WHERE</span> <span class=k>like</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=s1>'tag%'</span><span class=p>);</span>
<span class=err>┌─</span><span class=n>groupBitmapOr</span><span class=p>(</span><span class=n>z</span><span class=p>)</span><span class=err>─┐</span>
<span class=err>│</span>             <span class=mi>15</span>   <span class=err>│</span>
<span class=err>└──────────────────┘</span>

<span class=k>SELECT</span> <span class=n>arraySort</span><span class=p>(</span><span class=n>bitmapToArray</span><span class=p>(</span><span class=n>groupBitmapOrState</span><span class=p>(</span><span class=n>z</span><span class=p>)))</span> <span class=k>FROM</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>WHERE</span> <span class=k>like</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=s1>'tag%'</span><span class=p>);</span>
<span class=err>┌─</span><span class=n>arraySort</span><span class=p>(</span><span class=n>bitmapToArray</span><span class=p>(</span><span class=n>groupBitmapOrState</span><span class=p>(</span><span class=n>z</span><span class=p>)))</span><span class=err>─┐</span>
<span class=err>│</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>]</span>           <span class=err>│</span>
<span class=err>└─────────────────────────────────────────────────┘</span>
</code></pre></div> <h2 id=groupbitmapxor>groupBitmapXor<a class=headerlink href=../amp/#groupbitmapxor title="Permanent link"> </a></h2> <p>Calculs le XOR d'une colonne bitmap, retour cardinalité de type UInt64, si Ajouter suffixe-État, puis retour <a href=../../../functions/bitmap-functions/amp/ >objet bitmap</a>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>groupBitmapOr</span><span class=p>(</span><span class=n>expr</span><span class=p>)</span>
</code></pre></div> <p><strong>Paramètre</strong></p> <p><code class=syntax>expr</code> – An expression that results in <code class=syntax>AggregateFunction(groupBitmap, UInt*)</code> type.</p> <p><strong>Valeur de retour</strong></p> <p>La valeur de la <code class=syntax>UInt64</code> type.</p> <p><strong>Exemple</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>DROP</span> <span class=k>TABLE</span> <span class=k>IF</span> <span class=k>EXISTS</span> <span class=n>bitmap_column_expr_test2</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>bitmap_column_expr_test2</span>
<span class=p>(</span>
    <span class=n>tag_id</span> <span class=n>String</span><span class=p>,</span>
    <span class=n>z</span> <span class=n>AggregateFunction</span><span class=p>(</span><span class=n>groupBitmap</span><span class=p>,</span> <span class=n>UInt32</span><span class=p>)</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>tag_id</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag1'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag2'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>'tag3'</span><span class=p>,</span> <span class=n>bitmapBuild</span><span class=p>(</span><span class=k>cast</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>12</span><span class=p>]</span> <span class=k>as</span> <span class=nb>Array</span><span class=p>(</span><span class=n>UInt32</span><span class=p>))));</span>

<span class=k>SELECT</span> <span class=n>groupBitmapXor</span><span class=p>(</span><span class=n>z</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>WHERE</span> <span class=k>like</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=s1>'tag%'</span><span class=p>);</span>
<span class=err>┌─</span><span class=n>groupBitmapXor</span><span class=p>(</span><span class=n>z</span><span class=p>)</span><span class=err>─┐</span>
<span class=err>│</span>              <span class=mi>10</span>   <span class=err>│</span>
<span class=err>└───────────────────┘</span>

<span class=k>SELECT</span> <span class=n>arraySort</span><span class=p>(</span><span class=n>bitmapToArray</span><span class=p>(</span><span class=n>groupBitmapXorState</span><span class=p>(</span><span class=n>z</span><span class=p>)))</span> <span class=k>FROM</span> <span class=n>bitmap_column_expr_test2</span> <span class=k>WHERE</span> <span class=k>like</span><span class=p>(</span><span class=n>tag_id</span><span class=p>,</span> <span class=s1>'tag%'</span><span class=p>);</span>
<span class=err>┌─</span><span class=n>arraySort</span><span class=p>(</span><span class=n>bitmapToArray</span><span class=p>(</span><span class=n>groupBitmapXorState</span><span class=p>(</span><span class=n>z</span><span class=p>)))</span><span class=err>─┐</span>
<span class=err>│</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>]</span>                       <span class=err>│</span>
<span class=err>└──────────────────────────────────────────────────┘</span>
</code></pre></div> <p><a href=https://clickhouse.tech/docs/en/query_language/agg_functions/reference/ target=_blank>Article Original</a> <!--hide--></p> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/fr/sql-reference/aggregate-functions/reference/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 