<!doctype html><html ⚡ lang=ja> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>ORDER BY | ClickHouseドキュメント</title><link href=https://clickhouse.tech/docs/en/sql-reference/statements/select/order-by/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "ORDER BY | ClickHouseドキュメント",
"mainEntityOfPage": "https://clickhouse.tech/docs/ja/sql-reference/statements/select/order-by/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "ORDER BY | ClickHouseドキュメント",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer,section{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ul{margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}small{font-size:80%}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.small,small{font-size:80%;font-weight:400}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-first{-ms-flex-order:-1;order:-1}.order-last{-ms-flex-order:13;order:13}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-first{-ms-flex-order:-1;order:-1}.order-md-last{-ms-flex-order:13;order:13}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-first{-ms-flex-order:-1;order:-1}.order-lg-last{-ms-flex-order:13;order:13}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn.disabled,.btn:disabled{opacity:.65}a.btn.disabled{pointer-events:none}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light.disabled,.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:not(:disabled):not(.disabled):active{color:#212529;background-color:#dae0e5;border-color:#d3d9df}.btn-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark.disabled,.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#1d2124;border-color:#171a1d}.btn-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light.disabled,.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-light:not(:disabled):not(.disabled):active{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-outline-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link.disabled,.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group{position:relative;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:stretch;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select{position:relative;-ms-flex:1 1 0;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select{margin-left:-1px}.input-group>.custom-select:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.input-group-text{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:.25rem}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select{height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-file-input{position:relative;z-index:2;width:100%;height:calc(1.5em+.75rem+2px);margin:0;opacity:0}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pb-5,.py-5{padding-bottom:3rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn.disabled,.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}details{background:#444451;color:#eee;padding:1rem;margin-bottom:1rem;margin-top:1rem}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre,tr{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}@media(prefers-color-scheme:dark){.syntax{background:#2d2d2d;color:#f2f0ec}.syntax .k{color:#c9c}.syntax .n{color:#f2f0ec}.syntax .o{color:#6cc}.syntax .p{color:#f2f0ec}.syntax .ld{color:#9c9}.syntax .s{color:#9c9}.syntax .nb{color:#f2f0ec}.syntax .py{color:#f2f0ec}.syntax .mi{color:#f99157}.syntax .s2{color:#9c9}.syntax .s1{color:#9c9}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <h1 id=select-order-by>ORDER BY Clause<a class=headerlink href=../amp/#select-order-by title="Permanent link"> </a></h1> <p>The <code class=syntax>ORDER BY</code> clause contains a list of expressions, which can each be attributed with <code class=syntax>DESC</code> (descending) or <code class=syntax>ASC</code> (ascending) modifier which determine the sorting direction. If the direction is not specified, <code class=syntax>ASC</code> is assumed, so it’s usually omitted. The sorting direction applies to a single expression, not to the entire list. Example: <code class=syntax>ORDER BY Visits DESC, SearchPhrase</code></p> <p>Rows that have identical values for the list of sorting expressions are output in an arbitrary order, which can also be non-deterministic (different each time).<br> If the ORDER BY clause is omitted, the order of the rows is also undefined, and may be non-deterministic as well.</p> <h2 id=sorting-of-special-values>Sorting of Special Values<a class=headerlink href=../amp/#sorting-of-special-values title="Permanent link"> </a></h2> <p>There are two approaches to <code class=syntax>NaN</code> and <code class=syntax>NULL</code> sorting order:</p> <ul> <li>By default or with the <code class=syntax>NULLS LAST</code> modifier: first the values, then <code class=syntax>NaN</code>, then <code class=syntax>NULL</code>.</li> <li>With the <code class=syntax>NULLS FIRST</code> modifier: first <code class=syntax>NULL</code>, then <code class=syntax>NaN</code>, then other values.</li> </ul> <h3 id=example>Example<a class=headerlink href=../amp/#example title="Permanent link"> </a></h3> <p>For the table</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬────y─┐
│ 1 │ ᴺᵁᴸᴸ │
│ 2 │    2 │
│ 1 │  nan │
│ 2 │    2 │
│ 3 │    4 │
│ 5 │    6 │
│ 6 │  nan │
│ 7 │ ᴺᵁᴸᴸ │
│ 6 │    7 │
│ 8 │    9 │
└───┴──────┘
</code></pre></div> <p>Run the query <code class=syntax>SELECT * FROM t_null_nan ORDER BY y NULLS FIRST</code> to get:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬────y─┐
│ 1 │ ᴺᵁᴸᴸ │
│ 7 │ ᴺᵁᴸᴸ │
│ 1 │  nan │
│ 6 │  nan │
│ 2 │    2 │
│ 2 │    2 │
│ 3 │    4 │
│ 5 │    6 │
│ 6 │    7 │
│ 8 │    9 │
└───┴──────┘
</code></pre></div> <p>When floating point numbers are sorted, NaNs are separate from the other values. Regardless of the sorting order, NaNs come at the end. In other words, for ascending sorting they are placed as if they are larger than all the other numbers, while for descending sorting they are placed as if they are smaller than the rest.</p> <h2 id=collation-support>Collation Support<a class=headerlink href=../amp/#collation-support title="Permanent link"> </a></h2> <p>For sorting by <a href=../../../../data-types/string/amp/ >String</a> values, you can specify collation (comparison). Example: <code class=syntax>ORDER BY SearchPhrase COLLATE 'tr'</code> - for sorting by keyword in ascending order, using the Turkish alphabet, case insensitive, assuming that strings are UTF-8 encoded. <code class=syntax>COLLATE</code> can be specified or not for each expression in ORDER BY independently. If <code class=syntax>ASC</code> or <code class=syntax>DESC</code> is specified, <code class=syntax>COLLATE</code> is specified after it. When using <code class=syntax>COLLATE</code>, sorting is always case-insensitive.</p> <p>Collate is supported in <a href=../../../../data-types/lowcardinality/amp/ >LowCardinality</a>, <a href=../../../../data-types/nullable/amp/ >Nullable</a>, <a href=../../../../data-types/array/amp/ >Array</a> and <a href=../../../../data-types/tuple/amp/ >Tuple</a>.</p> <p>We only recommend using <code class=syntax>COLLATE</code> for final sorting of a small number of rows, since sorting with <code class=syntax>COLLATE</code> is less efficient than normal sorting by bytes.</p> <h2 id=collation-examples>Collation Examples<a class=headerlink href=../amp/#collation-examples title="Permanent link"> </a></h2> <p>Example only with <a href=../../../../data-types/string/amp/ >String</a> values:</p> <p>Input table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s────┐
│ 1 │ bca  │
│ 2 │ ABC  │
│ 3 │ 123a │
│ 4 │ abc  │
│ 5 │ BCA  │
└───┴──────┘
</code></pre></div> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>collate_test</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>s</span> <span class=k>ASC</span> <span class=k>COLLATE</span> <span class=s1>'en'</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s────┐
│ 3 │ 123a │
│ 4 │ abc  │
│ 2 │ ABC  │
│ 1 │ bca  │
│ 5 │ BCA  │
└───┴──────┘
</code></pre></div> <p>Example with <a href=../../../../data-types/nullable/amp/ >Nullable</a>:</p> <p>Input table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s────┐
│ 1 │ bca  │
│ 2 │ ᴺᵁᴸᴸ │
│ 3 │ ABC  │
│ 4 │ 123a │
│ 5 │ abc  │
│ 6 │ ᴺᵁᴸᴸ │
│ 7 │ BCA  │
└───┴──────┘
</code></pre></div> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>collate_test</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>s</span> <span class=k>ASC</span> <span class=k>COLLATE</span> <span class=s1>'en'</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s────┐
│ 4 │ 123a │
│ 5 │ abc  │
│ 3 │ ABC  │
│ 1 │ bca  │
│ 7 │ BCA  │
│ 6 │ ᴺᵁᴸᴸ │
│ 2 │ ᴺᵁᴸᴸ │
└───┴──────┘
</code></pre></div> <p>Example with <a href=../../../../data-types/array/amp/ >Array</a>:</p> <p>Input table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s─────────────┐
│ 1 │ ['Z']         │
│ 2 │ ['z']         │
│ 3 │ ['a']         │
│ 4 │ ['A']         │
│ 5 │ ['z','a']     │
│ 6 │ ['z','a','a'] │
│ 7 │ ['']          │
└───┴───────────────┘
</code></pre></div> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>collate_test</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>s</span> <span class=k>ASC</span> <span class=k>COLLATE</span> <span class=s1>'en'</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s─────────────┐
│ 7 │ ['']          │
│ 3 │ ['a']         │
│ 4 │ ['A']         │
│ 2 │ ['z']         │
│ 5 │ ['z','a']     │
│ 6 │ ['z','a','a'] │
│ 1 │ ['Z']         │
└───┴───────────────┘
</code></pre></div> <p>Example with <a href=../../../../data-types/lowcardinality/amp/ >LowCardinality</a> string:</p> <p>Input table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s───┐
│ 1 │ Z   │
│ 2 │ z   │
│ 3 │ a   │
│ 4 │ A   │
│ 5 │ za  │
│ 6 │ zaa │
│ 7 │     │
└───┴─────┘
</code></pre></div> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>collate_test</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>s</span> <span class=k>ASC</span> <span class=k>COLLATE</span> <span class=s1>'en'</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s───┐
│ 7 │     │
│ 3 │ a   │
│ 4 │ A   │
│ 2 │ z   │
│ 1 │ Z   │
│ 5 │ za  │
│ 6 │ zaa │
└───┴─────┘
</code></pre></div> <p>Example with <a href=../../../../data-types/tuple/amp/ >Tuple</a>:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s───────┐
│ 1 │ (1,'Z') │
│ 2 │ (1,'z') │
│ 3 │ (1,'a') │
│ 4 │ (2,'z') │
│ 5 │ (1,'A') │
│ 6 │ (2,'Z') │
│ 7 │ (2,'A') │
└───┴─────────┘
</code></pre></div> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>collate_test</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>s</span> <span class=k>ASC</span> <span class=k>COLLATE</span> <span class=s1>'en'</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─x─┬─s───────┐
│ 3 │ (1,'a') │
│ 5 │ (1,'A') │
│ 2 │ (1,'z') │
│ 1 │ (1,'Z') │
│ 7 │ (2,'A') │
│ 4 │ (2,'z') │
│ 6 │ (2,'Z') │
└───┴─────────┘
</code></pre></div> <h2 id=implementation-details>Implementation Details<a class=headerlink href=../amp/#implementation-details title="Permanent link"> </a></h2> <p>Less RAM is used if a small enough <a href=../../limit/amp/ >LIMIT</a> is specified in addition to <code class=syntax>ORDER BY</code>. Otherwise, the amount of memory spent is proportional to the volume of data for sorting. For distributed query processing, if <a href=../../group-by/amp/ >GROUP BY</a> is omitted, sorting is partially done on remote servers, and the results are merged on the requestor server. This means that for distributed sorting, the volume of data to sort can be greater than the amount of memory on a single server.</p> <p>If there is not enough RAM, it is possible to perform sorting in external memory (creating temporary files on a disk). Use the setting <code class=syntax>max_bytes_before_external_sort</code> for this purpose. If it is set to 0 (the default), external sorting is disabled. If it is enabled, when the volume of data to sort reaches the specified number of bytes, the collected data is sorted and dumped into a temporary file. After all data is read, all the sorted files are merged and the results are output. Files are written to the <code class=syntax>/var/lib/clickhouse/tmp/</code> directory in the config (by default, but you can use the <code class=syntax>tmp_path</code> parameter to change this setting).</p> <p>Running a query may use more memory than <code class=syntax>max_bytes_before_external_sort</code>. For this reason, this setting must have a value significantly smaller than <code class=syntax>max_memory_usage</code>. As an example, if your server has 128 GB of RAM and you need to run a single query, set <code class=syntax>max_memory_usage</code> to 100 GB, and <code class=syntax>max_bytes_before_external_sort</code> to 80 GB.</p> <p>External sorting works much less effectively than sorting in RAM.</p> <h2 id=optimize_read_in_order>Optimization of Data Reading<a class=headerlink href=../amp/#optimize_read_in_order title="Permanent link"> </a></h2> <p>If <code class=syntax>ORDER BY</code> expression has a prefix that coincides with the table sorting key, you can optimize the query by using the <a href=../../../../../operations/settings/settings/amp/#optimize_read_in_order>optimize_read_in_order</a> setting. </p> <p>When the <code class=syntax>optimize_read_in_order</code> setting is enabled, the ClickHouse server uses the table index and reads the data in order of the <code class=syntax>ORDER BY</code> key. This allows to avoid reading all data in case of specified <a href=../../limit/amp/ >LIMIT</a>. So queries on big data with small limit are processed faster.</p> <p>Optimization works with both <code class=syntax>ASC</code> and <code class=syntax>DESC</code> and does not work together with <a href=../../group-by/amp/ >GROUP BY</a> clause and <a href=../../from/amp/#select-from-final>FINAL</a> modifier.</p> <p>When the <code class=syntax>optimize_read_in_order</code> setting is disabled, the ClickHouse server does not use the table index while processing <code class=syntax>SELECT</code> queries.</p> <p>Consider disabling <code class=syntax>optimize_read_in_order</code> manually, when running queries that have <code class=syntax>ORDER BY</code> clause, large <code class=syntax>LIMIT</code> and <a href=../../where/amp/ >WHERE</a> condition that requires to read huge amount of records before queried data is found.</p> <p>Optimization is supported in the following table engines:</p> <ul> <li><a href=../../../../../engines/table-engines/mergetree-family/mergetree/amp/ >MergeTree</a></li> <li><a href=../../../../../engines/table-engines/special/merge/amp/ >Merge</a>, <a href=../../../../../engines/table-engines/special/buffer/amp/ >Buffer</a>, and <a href=../../../../../engines/table-engines/special/materializedview/amp/ >MaterializedView</a> table engines over <code class=syntax>MergeTree</code>-engine tables</li> </ul> <p>In <code class=syntax>MaterializedView</code>-engine tables the optimization works with views like <code class=syntax>SELECT ... FROM merge_tree_table ORDER BY pk</code>. But it is not supported in the queries like <code class=syntax>SELECT ... FROM view ORDER BY pk</code> if the view query does not have the <code class=syntax>ORDER BY</code> clause.</p> <h2 id=orderby-with-fill>ORDER BY Expr WITH FILL Modifier<a class=headerlink href=../amp/#orderby-with-fill title="Permanent link"> </a></h2> <p>This modifier also can be combined with <a href=../../limit/amp/#limit-with-ties>LIMIT … WITH TIES modifier</a>.</p> <p><code class=syntax>WITH FILL</code> modifier can be set after <code class=syntax>ORDER BY expr</code> with optional <code class=syntax>FROM expr</code>, <code class=syntax>TO expr</code> and <code class=syntax>STEP expr</code> parameters.<br> All missed values of <code class=syntax>expr</code> column will be filled sequentially and other columns will be filled as defaults.</p> <p>Use following syntax for filling multiple columns add <code class=syntax>WITH FILL</code> modifier with optional parameters after each field name in <code class=syntax>ORDER BY</code> section.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ORDER</span> <span class=k>BY</span> <span class=n>expr</span> <span class=p>[</span><span class=k>WITH</span> <span class=n>FILL</span><span class=p>]</span> <span class=p>[</span><span class=k>FROM</span> <span class=n>const_expr</span><span class=p>]</span> <span class=p>[</span><span class=k>TO</span> <span class=n>const_expr</span><span class=p>]</span> <span class=p>[</span><span class=n>STEP</span> <span class=n>const_numeric_expr</span><span class=p>],</span> <span class=p>...</span> <span class=n>exprN</span> <span class=p>[</span><span class=k>WITH</span> <span class=n>FILL</span><span class=p>]</span> <span class=p>[</span><span class=k>FROM</span> <span class=n>expr</span><span class=p>]</span> <span class=p>[</span><span class=k>TO</span> <span class=n>expr</span><span class=p>]</span> <span class=p>[</span><span class=n>STEP</span> <span class=n>numeric_expr</span><span class=p>]</span>
</code></pre></div> <p><code class=syntax>WITH FILL</code> can be applied only for fields with Numeric (all kind of float, decimal, int) or Date/DateTime types.<br> When <code class=syntax>FROM const_expr</code> not defined sequence of filling use minimal <code class=syntax>expr</code> field value from <code class=syntax>ORDER BY</code>.<br> When <code class=syntax>TO const_expr</code> not defined sequence of filling use maximum <code class=syntax>expr</code> field value from <code class=syntax>ORDER BY</code>.<br> When <code class=syntax>STEP const_numeric_expr</code> defined then <code class=syntax>const_numeric_expr</code> interprets <code class=syntax>as is</code> for numeric types as <code class=syntax>days</code> for Date type and as <code class=syntax>seconds</code> for DateTime type.<br> When <code class=syntax>STEP const_numeric_expr</code> omitted then sequence of filling use <code class=syntax>1.0</code> for numeric type, <code class=syntax>1 day</code> for Date type and <code class=syntax>1 second</code> for DateTime type.</p> <p>For example, the following query</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>n</span><span class=p>,</span> <span class=k>source</span> <span class=k>FROM</span> <span class=p>(</span>
   <span class=k>SELECT</span> <span class=n>toFloat32</span><span class=p>(</span><span class=nb>number</span> <span class=o>%</span> <span class=mi>10</span><span class=p>)</span> <span class=k>AS</span> <span class=n>n</span><span class=p>,</span> <span class=s1>'original'</span> <span class=k>AS</span> <span class=k>source</span>
   <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=k>WHERE</span> <span class=nb>number</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>=</span> <span class=mi>1</span>
<span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>n</span>
</code></pre></div> <p>returns</p> <div class=codehilite><pre><span></span><code class=syntax>┌─n─┬─source───┐
│ 1 │ original │
│ 4 │ original │
│ 7 │ original │
└───┴──────────┘
</code></pre></div> <p>but after apply <code class=syntax>WITH FILL</code> modifier</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>n</span><span class=p>,</span> <span class=k>source</span> <span class=k>FROM</span> <span class=p>(</span>
   <span class=k>SELECT</span> <span class=n>toFloat32</span><span class=p>(</span><span class=nb>number</span> <span class=o>%</span> <span class=mi>10</span><span class=p>)</span> <span class=k>AS</span> <span class=n>n</span><span class=p>,</span> <span class=s1>'original'</span> <span class=k>AS</span> <span class=k>source</span>
   <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=k>WHERE</span> <span class=nb>number</span> <span class=o>%</span> <span class=mi>3</span> <span class=o>=</span> <span class=mi>1</span>
<span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>n</span> <span class=k>WITH</span> <span class=n>FILL</span> <span class=k>FROM</span> <span class=mi>0</span> <span class=k>TO</span> <span class=mi>5</span><span class=p>.</span><span class=mi>51</span> <span class=n>STEP</span> <span class=mi>0</span><span class=p>.</span><span class=mi>5</span>
</code></pre></div> <p>returns</p> <div class=codehilite><pre><span></span><code class=syntax>┌───n─┬─source───┐
│   0 │          │
│ 0.5 │          │
│   1 │ original │
│ 1.5 │          │
│   2 │          │
│ 2.5 │          │
│   3 │          │
│ 3.5 │          │
│   4 │ original │
│ 4.5 │          │
│   5 │          │
│ 5.5 │          │
│   7 │ original │
└─────┴──────────┘
</code></pre></div> <p>For the case when we have multiple fields <code class=syntax>ORDER BY field2 WITH FILL, field1 WITH FILL</code> order of filling will follow the order of fields in <code class=syntax>ORDER BY</code> clause.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>toDate</span><span class=p>((</span><span class=nb>number</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>86400</span><span class=p>)</span> <span class=k>AS</span> <span class=n>d1</span><span class=p>,</span>
    <span class=n>toDate</span><span class=p>(</span><span class=nb>number</span> <span class=o>*</span> <span class=mi>86400</span><span class=p>)</span> <span class=k>AS</span> <span class=n>d2</span><span class=p>,</span>
    <span class=s1>'original'</span> <span class=k>AS</span> <span class=k>source</span>
<span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
<span class=k>WHERE</span> <span class=p>(</span><span class=nb>number</span> <span class=o>%</span> <span class=mi>3</span><span class=p>)</span> <span class=o>=</span> <span class=mi>1</span>
<span class=k>ORDER</span> <span class=k>BY</span>
    <span class=n>d2</span> <span class=k>WITH</span> <span class=n>FILL</span><span class=p>,</span>
    <span class=n>d1</span> <span class=k>WITH</span> <span class=n>FILL</span> <span class=n>STEP</span> <span class=mi>5</span><span class=p>;</span>
</code></pre></div> <p>returns</p> <div class=codehilite><pre><span></span><code class=syntax>┌───d1───────┬───d2───────┬─source───┐
│ 1970-01-11 │ 1970-01-02 │ original │
│ 1970-01-01 │ 1970-01-03 │          │
│ 1970-01-01 │ 1970-01-04 │          │
│ 1970-02-10 │ 1970-01-05 │ original │
│ 1970-01-01 │ 1970-01-06 │          │
│ 1970-01-01 │ 1970-01-07 │          │
│ 1970-03-12 │ 1970-01-08 │ original │
└────────────┴────────────┴──────────┘
</code></pre></div> <p>Field <code class=syntax>d1</code> does not fill and use default value cause we do not have repeated values for <code class=syntax>d2</code> value, and sequence for <code class=syntax>d1</code> can’t be properly calculated.</p> <p>The following query with a changed field in <code class=syntax>ORDER BY</code></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>toDate</span><span class=p>((</span><span class=nb>number</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>86400</span><span class=p>)</span> <span class=k>AS</span> <span class=n>d1</span><span class=p>,</span>
    <span class=n>toDate</span><span class=p>(</span><span class=nb>number</span> <span class=o>*</span> <span class=mi>86400</span><span class=p>)</span> <span class=k>AS</span> <span class=n>d2</span><span class=p>,</span>
    <span class=s1>'original'</span> <span class=k>AS</span> <span class=k>source</span>
<span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
<span class=k>WHERE</span> <span class=p>(</span><span class=nb>number</span> <span class=o>%</span> <span class=mi>3</span><span class=p>)</span> <span class=o>=</span> <span class=mi>1</span>
<span class=k>ORDER</span> <span class=k>BY</span>
    <span class=n>d1</span> <span class=k>WITH</span> <span class=n>FILL</span> <span class=n>STEP</span> <span class=mi>5</span><span class=p>,</span>
    <span class=n>d2</span> <span class=k>WITH</span> <span class=n>FILL</span><span class=p>;</span>
</code></pre></div> <p>returns</p> <div class=codehilite><pre><span></span><code class=syntax>┌───d1───────┬───d2───────┬─source───┐
│ 1970-01-11 │ 1970-01-02 │ original │
│ 1970-01-16 │ 1970-01-01 │          │
│ 1970-01-21 │ 1970-01-01 │          │
│ 1970-01-26 │ 1970-01-01 │          │
│ 1970-01-31 │ 1970-01-01 │          │
│ 1970-02-05 │ 1970-01-01 │          │
│ 1970-02-10 │ 1970-01-05 │ original │
│ 1970-02-15 │ 1970-01-01 │          │
│ 1970-02-20 │ 1970-01-01 │          │
│ 1970-02-25 │ 1970-01-01 │          │
│ 1970-03-02 │ 1970-01-01 │          │
│ 1970-03-07 │ 1970-01-01 │          │
│ 1970-03-12 │ 1970-01-08 │ original │
└────────────┴────────────┴──────────┘
</code></pre></div> <p><a href=https://clickhouse.tech/docs/en/sql-reference/statements/select/order-by/ target=_blank>Original article</a> <!--hide--></p> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2021 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/878a159538935028f2d2dce3eb3074d44eb191df rel="external nofollow noreferrer" target=_blank class=text-reset>878a159538</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/ja/sql-reference/statements/select/order-by/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 