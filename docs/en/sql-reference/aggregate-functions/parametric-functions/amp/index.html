<!doctype html><html ⚡ lang=en> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>Parametric | ClickHouse Documentation</title><link href=https://clickhouse.tech/docs/en/sql-reference/aggregate-functions/parametric-functions/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Parametric | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.tech/docs/en/sql-reference/aggregate-functions/parametric-functions/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Parametric | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}b,strong{font-weight:bolder}small{font-size:80%}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.small,small{font-size:80%;font-weight:400}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-first{-ms-flex-order:-1;order:-1}.order-last{-ms-flex-order:13;order:13}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-first{-ms-flex-order:-1;order:-1}.order-md-last{-ms-flex-order:13;order:13}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-first{-ms-flex-order:-1;order:-1}.order-lg-last{-ms-flex-order:13;order:13}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-warning{background-color:#ffeeba}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group{position:relative;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:stretch;align-items:stretch;width:100%}.input-group>.custom-select{position:relative;-ms-flex:1 1 0;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-select+.custom-select{margin-left:-1px}.input-group>.custom-select:focus{z-index:3}.input-group>.custom-select:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group-text{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:.25rem}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select{height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#007bff;border:0;border-radius:1rem;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#b3d7ff}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#007bff;border:0;border-radius:1rem;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#b3d7ff}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#007bff;border:0;border-radius:1rem;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#b3d7ff}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px;background-color:#dee2e6;border-radius:1rem}.custom-range:disabled::-webkit-slider-thumb{background-color:#adb5bd}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#adb5bd}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#adb5bd}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.position-fixed{position:fixed}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pb-5,.py-5{padding-bottom:3rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}@media(prefers-color-scheme:dark){.syntax{background:#2d2d2d;color:#f2f0ec}.syntax .c{color:#747369}.syntax .k{color:#c9c}.syntax .n{color:#f2f0ec}.syntax .o{color:#6cc}.syntax .p{color:#f2f0ec}.syntax .c1{color:#747369}.syntax .ld{color:#9c9}.syntax .s{color:#9c9}.syntax .nb{color:#f2f0ec}.syntax .py{color:#f2f0ec}.syntax .mi{color:#f99157}.syntax .s2{color:#9c9}.syntax .s1{color:#9c9}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <h1 id=aggregate_functions_parametric>Parametric Aggregate Functions<a class=headerlink href=../amp/#aggregate_functions_parametric title="Permanent link"> </a></h1> <p>Some aggregate functions can accept not only argument columns (used for compression), but a set of parameters – constants for initialization. The syntax is two pairs of brackets instead of one. The first is for parameters, and the second is for arguments.</p> <h2 id=histogram>histogram<a class=headerlink href=../amp/#histogram title="Permanent link"> </a></h2> <p>Calculates an adaptive histogram. It does not guarantee precise results.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>histogram</span><span class=p>(</span><span class=n>number_of_bins</span><span class=p>)(</span><span class=k>values</span><span class=p>)</span>
</code></pre></div> <p>The functions uses <a href=http://jmlr.org/papers/volume11/ben-haim10a/ben-haim10a.pdf rel="external nofollow noreferrer" target=_blank>A Streaming Parallel Decision Tree Algorithm</a>. The borders of histogram bins are adjusted as new data enters a function. In common case, the widths of bins are not equal.</p> <p><strong>Arguments</strong></p> <p><code class=syntax>values</code> — <a href=../../../syntax/amp/#syntax-expressions>Expression</a> resulting in input values.</p> <p><strong>Parameters</strong></p> <p><code class=syntax>number_of_bins</code> — Upper limit for the number of bins in the histogram. The function automatically calculates the number of bins. It tries to reach the specified number of bins, but if it fails, it uses fewer bins.</p> <p><strong>Returned values</strong></p> <ul> <li><a href=../../../data-types/array/amp/ >Array</a> of <a href=../../../data-types/tuple/amp/ >Tuples</a> of the following format:<div class=codehilite><pre><span></span><code class=syntax><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted"></span>
<span class="n n-Quoted">[(lower_1, upper_1, height_1), ... (lower_N, upper_N, height_N)]</span>
<span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span>

<span class=o>-</span> <span class="n n-Quoted">`lower`</span> <span class=n>—</span> <span class=n>Lower</span> <span class=n>bound</span> <span class=k>of</span> <span class=n>the</span> <span class=n>bin</span><span class=p>.</span>
<span class=o>-</span> <span class="n n-Quoted">`upper`</span> <span class=n>—</span> <span class=n>Upper</span> <span class=n>bound</span> <span class=k>of</span> <span class=n>the</span> <span class=n>bin</span><span class=p>.</span>
<span class=o>-</span> <span class="n n-Quoted">`height`</span> <span class=n>—</span> <span class=n>Calculated</span> <span class=n>height</span> <span class=k>of</span> <span class=n>the</span> <span class=n>bin</span><span class=p>.</span>
</code></pre></div> </li> </ul> <p><strong>Example</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>histogram</span><span class=p>(</span><span class=mi>5</span><span class=p>)(</span><span class=nb>number</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
<span class=k>FROM</span> <span class=p>(</span>
    <span class=k>SELECT</span> <span class=o>*</span>
    <span class=k>FROM</span> <span class=k>system</span><span class=p>.</span><span class=n>numbers</span>
    <span class=k>LIMIT</span> <span class=mi>20</span>
<span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─histogram(5)(plus(number, 1))───────────────────────────────────────────┐
│ [(1,4.5,4),(4.5,8.5,4),(8.5,12.75,4.125),(12.75,17,4.625),(17,20,3.25)] │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div> <p>You can visualize a histogram with the <a href=../../../functions/other-functions/amp/#function-bar>bar</a> function, for example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>WITH</span> <span class=n>histogram</span><span class=p>(</span><span class=mi>5</span><span class=p>)(</span><span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span><span class=p>)</span> <span class=k>AS</span> <span class=n>hist</span>
<span class=k>SELECT</span>
    <span class=n>arrayJoin</span><span class=p>(</span><span class=n>hist</span><span class=p>).</span><span class=mi>3</span> <span class=k>AS</span> <span class=n>height</span><span class=p>,</span>
    <span class=n>bar</span><span class=p>(</span><span class=n>height</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=k>AS</span> <span class=n>bar</span>
<span class=k>FROM</span>
<span class=p>(</span>
    <span class=k>SELECT</span> <span class=o>*</span>
    <span class=k>FROM</span> <span class=k>system</span><span class=p>.</span><span class=n>numbers</span>
    <span class=k>LIMIT</span> <span class=mi>20</span>
<span class=p>)</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─height─┬─bar───┐
│  2.125 │ █▋    │
│   3.25 │ ██▌   │
│  5.625 │ ████▏ │
│  5.625 │ ████▏ │
│  3.375 │ ██▌   │
└────────┴───────┘
</code></pre></div> <p>In this case, you should remember that you do not know the histogram bin borders.</p> <h2 id=function-sequencematch>sequenceMatch(pattern)(timestamp, cond1, cond2, …)<a class=headerlink href=../amp/#function-sequencematch title="Permanent link"> </a></h2> <p>Checks whether the sequence contains an event chain that matches the pattern.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>sequenceMatch</span><span class=p>(</span><span class=n>pattern</span><span class=p>)(</span><span class=k>timestamp</span><span class=p>,</span> <span class=n>cond1</span><span class=p>,</span> <span class=n>cond2</span><span class=p>,</span> <span class=p>...)</span>
</code></pre></div> <div class="admonition warning alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Warning</p> <p>Events that occur at the same second may lay in the sequence in an undefined order affecting the result.</p> </div> <p><strong>Arguments</strong></p> <ul> <li> <p><code class=syntax>timestamp</code> — Column considered to contain time data. Typical data types are <code class=syntax>Date</code> and <code class=syntax>DateTime</code>. You can also use any of the supported <a href=../../../data-types/int-uint/amp/ >UInt</a> data types.</p> </li> <li> <p><code class=syntax>cond1</code>, <code class=syntax>cond2</code> — Conditions that describe the chain of events. Data type: <code class=syntax>UInt8</code>. You can pass up to 32 condition arguments. The function takes only the events described in these conditions into account. If the sequence contains data that isn’t described in a condition, the function skips them.</p> </li> </ul> <p><strong>Parameters</strong></p> <ul> <li><code class=syntax>pattern</code> — Pattern string. See <a href=../amp/#sequence-function-pattern-syntax>Pattern syntax</a>.</li> </ul> <p><strong>Returned values</strong></p> <ul> <li>1, if the pattern is matched.</li> <li>0, if the pattern isn’t matched.</li> </ul> <p>Type: <code class=syntax>UInt8</code>.</p> <p><a name=sequence-function-pattern-syntax></a><br> <strong>Pattern syntax</strong></p> <ul> <li> <p><code class=syntax>(?N)</code> — Matches the condition argument at position <code class=syntax>N</code>. Conditions are numbered in the <code class=syntax>[1, 32]</code> range. For example, <code class=syntax>(?1)</code> matches the argument passed to the <code class=syntax>cond1</code> parameter.</p> </li> <li> <p><code class=syntax>.*</code> — Matches any number of events. You do not need conditional arguments to match this element of the pattern.</p> </li> <li> <p><code class=syntax>(?t operator value)</code> — Sets the time in seconds that should separate two events. For example, pattern <code class=syntax>(?1)(?t&gt;1800)(?2)</code> matches events that occur more than 1800 seconds from each other. An arbitrary number of any events can lay between these events. You can use the <code class=syntax>&gt;=</code>, <code class=syntax>&gt;</code>, <code class=syntax>&lt;</code>, <code class=syntax>&lt;=</code>, <code class=syntax>==</code> operators.</p> </li> </ul> <p><strong>Examples</strong></p> <p>Consider data in the <code class=syntax>t</code> table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─time─┬─number─┐
│    1 │      1 │
│    2 │      3 │
│    3 │      2 │
└──────┴────────┘
</code></pre></div> <p>Perform the query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>sequenceMatch</span><span class=p>(</span><span class=s1>'(?1)(?2)'</span><span class=p>)(</span><span class=k>time</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─sequenceMatch('(?1)(?2)')(time, equals(number, 1), equals(number, 2))─┐
│                                                                     1 │
└───────────────────────────────────────────────────────────────────────┘
</code></pre></div> <p>The function found the event chain where number 2 follows number 1. It skipped number 3 between them, because the number is not described as an event. If we want to take this number into account when searching for the event chain given in the example, we should make a condition for it.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>sequenceMatch</span><span class=p>(</span><span class=s1>'(?1)(?2)'</span><span class=p>)(</span><span class=k>time</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>3</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─sequenceMatch('(?1)(?2)')(time, equals(number, 1), equals(number, 2), equals(number, 3))─┐
│                                                                                        0 │
└──────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre></div> <p>In this case, the function couldn’t find the event chain matching the pattern, because the event for number 3 occured between 1 and 2. If in the same case we checked the condition for number 4, the sequence would match the pattern.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>sequenceMatch</span><span class=p>(</span><span class=s1>'(?1)(?2)'</span><span class=p>)(</span><span class=k>time</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>4</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─sequenceMatch('(?1)(?2)')(time, equals(number, 1), equals(number, 2), equals(number, 4))─┐
│                                                                                        1 │
└──────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre></div> <p><strong>See Also</strong></p> <ul> <li><a href=../amp/#function-sequencecount>sequenceCount</a></li> </ul> <h2 id=function-sequencecount>sequenceCount(pattern)(time, cond1, cond2, …)<a class=headerlink href=../amp/#function-sequencecount title="Permanent link"> </a></h2> <p>Counts the number of event chains that matched the pattern. The function searches event chains that do not overlap. It starts to search for the next chain after the current chain is matched.</p> <div class="admonition warning alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Warning</p> <p>Events that occur at the same second may lay in the sequence in an undefined order affecting the result.</p> </div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>sequenceCount</span><span class=p>(</span><span class=n>pattern</span><span class=p>)(</span><span class=k>timestamp</span><span class=p>,</span> <span class=n>cond1</span><span class=p>,</span> <span class=n>cond2</span><span class=p>,</span> <span class=p>...)</span>
</code></pre></div> <p><strong>Arguments</strong></p> <ul> <li> <p><code class=syntax>timestamp</code> — Column considered to contain time data. Typical data types are <code class=syntax>Date</code> and <code class=syntax>DateTime</code>. You can also use any of the supported <a href=../../../data-types/int-uint/amp/ >UInt</a> data types.</p> </li> <li> <p><code class=syntax>cond1</code>, <code class=syntax>cond2</code> — Conditions that describe the chain of events. Data type: <code class=syntax>UInt8</code>. You can pass up to 32 condition arguments. The function takes only the events described in these conditions into account. If the sequence contains data that isn’t described in a condition, the function skips them.</p> </li> </ul> <p><strong>Parameters</strong></p> <ul> <li><code class=syntax>pattern</code> — Pattern string. See <a href=../amp/#sequence-function-pattern-syntax>Pattern syntax</a>.</li> </ul> <p><strong>Returned values</strong></p> <ul> <li>Number of non-overlapping event chains that are matched.</li> </ul> <p>Type: <code class=syntax>UInt64</code>.</p> <p><strong>Example</strong></p> <p>Consider data in the <code class=syntax>t</code> table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─time─┬─number─┐
│    1 │      1 │
│    2 │      3 │
│    3 │      2 │
│    4 │      1 │
│    5 │      3 │
│    6 │      2 │
└──────┴────────┘
</code></pre></div> <p>Count how many times the number 2 occurs after the number 1 with any amount of other numbers between them:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>sequenceCount</span><span class=p>(</span><span class=s1>'(?1).*(?2)'</span><span class=p>)(</span><span class=k>time</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>number</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>t</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─sequenceCount('(?1).*(?2)')(time, equals(number, 1), equals(number, 2))─┐
│                                                                       2 │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre></div> <p><strong>See Also</strong></p> <ul> <li><a href=../amp/#function-sequencematch>sequenceMatch</a></li> </ul> <h2 id=windowfunnel>windowFunnel<a class=headerlink href=../amp/#windowfunnel title="Permanent link"> </a></h2> <p>Searches for event chains in a sliding time window and calculates the maximum number of events that occurred from the chain.</p> <p>The function works according to the algorithm:</p> <ul> <li> <p>The function searches for data that triggers the first condition in the chain and sets the event counter to 1. This is the moment when the sliding window starts.</p> </li> <li> <p>If events from the chain occur sequentially within the window, the counter is incremented. If the sequence of events is disrupted, the counter isn’t incremented.</p> </li> <li> <p>If the data has multiple event chains at varying points of completion, the function will only output the size of the longest chain.</p> </li> </ul> <p><strong>Syntax</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>windowFunnel</span><span class=p>(</span><span class=n>window</span><span class=p>,</span> <span class=p>[</span><span class=k>mode</span><span class=p>,</span> <span class=p>[</span><span class=k>mode</span><span class=p>,</span> <span class=p>...</span> <span class=p>]])(</span><span class=k>timestamp</span><span class=p>,</span> <span class=n>cond1</span><span class=p>,</span> <span class=n>cond2</span><span class=p>,</span> <span class=p>...,</span> <span class=n>condN</span><span class=p>)</span>
</code></pre></div> <p><strong>Arguments</strong></p> <ul> <li><code class=syntax>timestamp</code> — Name of the column containing the timestamp. Data types supported: <a href=../../../data-types/date/amp/ >Date</a>, <a href=../../../data-types/datetime/amp/#data_type-datetime>DateTime</a> and other unsigned integer types (note that even though timestamp supports the <code class=syntax>UInt64</code> type, it’s value can’t exceed the Int64 maximum, which is 2^63 - 1).</li> <li><code class=syntax>cond</code> — Conditions or data describing the chain of events. <a href=../../../data-types/int-uint/amp/ >UInt8</a>.</li> </ul> <p><strong>Parameters</strong></p> <ul> <li><code class=syntax>window</code> — Length of the sliding window, it is the time interval between the first and the last condition. The unit of <code class=syntax>window</code> depends on the <code class=syntax>timestamp</code> itself and varies. Determined using the expression <code class=syntax>timestamp of cond1 &lt;= timestamp of cond2 &lt;= ... &lt;= timestamp of condN &lt;= timestamp of cond1 + window</code>.</li> <li><code class=syntax>mode</code> — It is an optional argument. One or more modes can be set.<ul> <li><code class=syntax>'strict'</code> — If same condition holds for sequence of events then such non-unique events would be skipped. </li> <li><code class=syntax>'strict_order'</code> — Don't allow interventions of other events. E.g. in the case of <code class=syntax>A-&gt;B-&gt;D-&gt;C</code>, it stops finding <code class=syntax>A-&gt;B-&gt;C</code> at the <code class=syntax>D</code> and the max event level is 2.</li> <li><code class=syntax>'strict_increase'</code> — Apply conditions only to events with strictly increasing timestamps.</li> </ul> </li> </ul> <p><strong>Returned value</strong></p> <p>The maximum number of consecutive triggered conditions from the chain within the sliding time window.<br> All the chains in the selection are analyzed.</p> <p>Type: <code class=syntax>Integer</code>.</p> <p><strong>Example</strong></p> <p>Determine if a set period of time is enough for the user to select a phone and purchase it twice in the online store.</p> <p>Set the following chain of events:</p> <ol> <li>The user logged in to their account on the store (<code class=syntax>eventID = 1003</code>).</li> <li>The user searches for a phone (<code class=syntax>eventID = 1007, product = 'phone'</code>).</li> <li>The user placed an order (<code class=syntax>eventID = 1009</code>).</li> <li>The user made the order again (<code class=syntax>eventID = 1010</code>).</li> </ol> <p>Input table:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─event_date─┬─user_id─┬───────────timestamp─┬─eventID─┬─product─┐
│ 2019-01-28 │       1 │ 2019-01-29 10:00:00 │    1003 │ phone   │
└────────────┴─────────┴─────────────────────┴─────────┴─────────┘
┌─event_date─┬─user_id─┬───────────timestamp─┬─eventID─┬─product─┐
│ 2019-01-31 │       1 │ 2019-01-31 09:00:00 │    1007 │ phone   │
└────────────┴─────────┴─────────────────────┴─────────┴─────────┘
┌─event_date─┬─user_id─┬───────────timestamp─┬─eventID─┬─product─┐
│ 2019-01-30 │       1 │ 2019-01-30 08:00:00 │    1009 │ phone   │
└────────────┴─────────┴─────────────────────┴─────────┴─────────┘
┌─event_date─┬─user_id─┬───────────timestamp─┬─eventID─┬─product─┐
│ 2019-02-01 │       1 │ 2019-02-01 08:00:00 │    1010 │ phone   │
└────────────┴─────────┴─────────────────────┴─────────┴─────────┘
</code></pre></div> <p>Find out how far the user <code class=syntax>user_id</code> could get through the chain in a period in January-February of 2019.</p> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=k>level</span><span class=p>,</span>
    <span class=k>count</span><span class=p>()</span> <span class=k>AS</span> <span class=k>c</span>
<span class=k>FROM</span>
<span class=p>(</span>
    <span class=k>SELECT</span>
        <span class=n>user_id</span><span class=p>,</span>
        <span class=n>windowFunnel</span><span class=p>(</span><span class=mi>6048000000000000</span><span class=p>)(</span><span class=k>timestamp</span><span class=p>,</span> <span class=n>eventID</span> <span class=o>=</span> <span class=mi>1003</span><span class=p>,</span> <span class=n>eventID</span> <span class=o>=</span> <span class=mi>1009</span><span class=p>,</span> <span class=n>eventID</span> <span class=o>=</span> <span class=mi>1007</span><span class=p>,</span> <span class=n>eventID</span> <span class=o>=</span> <span class=mi>1010</span><span class=p>)</span> <span class=k>AS</span> <span class=k>level</span>
    <span class=k>FROM</span> <span class=n>trend</span>
    <span class=k>WHERE</span> <span class=p>(</span><span class=n>event_date</span> <span class=o>&gt;=</span> <span class=s1>'2019-01-01'</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>event_date</span> <span class=o>&lt;=</span> <span class=s1>'2019-02-02'</span><span class=p>)</span>
    <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>user_id</span>
<span class=p>)</span>
<span class=k>GROUP</span> <span class=k>BY</span> <span class=k>level</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=k>level</span> <span class=k>ASC</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─level─┬─c─┐
│     4 │ 1 │
└───────┴───┘
</code></pre></div> <h2 id=retention>retention<a class=headerlink href=../amp/#retention title="Permanent link"> </a></h2> <p>The function takes as arguments a set of conditions from 1 to 32 arguments of type <code class=syntax>UInt8</code> that indicate whether a certain condition was met for the event.<br> Any condition can be specified as an argument (as in <a href=../../../statements/select/where/amp/#select-where>WHERE</a>).</p> <p>The conditions, except the first, apply in pairs: the result of the second will be true if the first and second are true, of the third if the first and third are true, etc.</p> <p><strong>Syntax</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>retention</span><span class=p>(</span><span class=n>cond1</span><span class=p>,</span> <span class=n>cond2</span><span class=p>,</span> <span class=p>...,</span> <span class=n>cond32</span><span class=p>);</span>
</code></pre></div> <p><strong>Arguments</strong></p> <ul> <li><code class=syntax>cond</code> — An expression that returns a <code class=syntax>UInt8</code> result (1 or 0).</li> </ul> <p><strong>Returned value</strong></p> <p>The array of 1 or 0.</p> <ul> <li>1 — Condition was met for the event.</li> <li>0 — Condition wasn’t met for the event.</li> </ul> <p>Type: <code class=syntax>UInt8</code>.</p> <p><strong>Example</strong></p> <p>Let’s consider an example of calculating the <code class=syntax>retention</code> function to determine site traffic.</p> <p><strong>1.</strong> Сreate a table to illustrate an example.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>retention_test</span><span class=p>(</span><span class=nb>date</span> <span class=nb>Date</span><span class=p>,</span> <span class=n>uid</span> <span class=n>Int32</span><span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>Memory</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>retention_test</span> <span class=k>SELECT</span> <span class=s1>'2020-01-01'</span><span class=p>,</span> <span class=nb>number</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>retention_test</span> <span class=k>SELECT</span> <span class=s1>'2020-01-02'</span><span class=p>,</span> <span class=nb>number</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>retention_test</span> <span class=k>SELECT</span> <span class=s1>'2020-01-03'</span><span class=p>,</span> <span class=nb>number</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>15</span><span class=p>);</span>
</code></pre></div> <p>Input table:</p> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>retention_test</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌───────date─┬─uid─┐
│ 2020-01-01 │   0 │
│ 2020-01-01 │   1 │
│ 2020-01-01 │   2 │
│ 2020-01-01 │   3 │
│ 2020-01-01 │   4 │
└────────────┴─────┘
┌───────date─┬─uid─┐
│ 2020-01-02 │   0 │
│ 2020-01-02 │   1 │
│ 2020-01-02 │   2 │
│ 2020-01-02 │   3 │
│ 2020-01-02 │   4 │
│ 2020-01-02 │   5 │
│ 2020-01-02 │   6 │
│ 2020-01-02 │   7 │
│ 2020-01-02 │   8 │
│ 2020-01-02 │   9 │
└────────────┴─────┘
┌───────date─┬─uid─┐
│ 2020-01-03 │   0 │
│ 2020-01-03 │   1 │
│ 2020-01-03 │   2 │
│ 2020-01-03 │   3 │
│ 2020-01-03 │   4 │
│ 2020-01-03 │   5 │
│ 2020-01-03 │   6 │
│ 2020-01-03 │   7 │
│ 2020-01-03 │   8 │
│ 2020-01-03 │   9 │
│ 2020-01-03 │  10 │
│ 2020-01-03 │  11 │
│ 2020-01-03 │  12 │
│ 2020-01-03 │  13 │
│ 2020-01-03 │  14 │
└────────────┴─────┘
</code></pre></div> <p><strong>2.</strong> Group users by unique ID <code class=syntax>uid</code> using the <code class=syntax>retention</code> function.</p> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>uid</span><span class=p>,</span>
    <span class=n>retention</span><span class=p>(</span><span class=nb>date</span> <span class=o>=</span> <span class=s1>'2020-01-01'</span><span class=p>,</span> <span class=nb>date</span> <span class=o>=</span> <span class=s1>'2020-01-02'</span><span class=p>,</span> <span class=nb>date</span> <span class=o>=</span> <span class=s1>'2020-01-03'</span><span class=p>)</span> <span class=k>AS</span> <span class=n>r</span>
<span class=k>FROM</span> <span class=n>retention_test</span>
<span class=k>WHERE</span> <span class=nb>date</span> <span class=k>IN</span> <span class=p>(</span><span class=s1>'2020-01-01'</span><span class=p>,</span> <span class=s1>'2020-01-02'</span><span class=p>,</span> <span class=s1>'2020-01-03'</span><span class=p>)</span>
<span class=k>GROUP</span> <span class=k>BY</span> <span class=n>uid</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>uid</span> <span class=k>ASC</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─uid─┬─r───────┐
│   0 │ [1,1,1] │
│   1 │ [1,1,1] │
│   2 │ [1,1,1] │
│   3 │ [1,1,1] │
│   4 │ [1,1,1] │
│   5 │ [0,0,0] │
│   6 │ [0,0,0] │
│   7 │ [0,0,0] │
│   8 │ [0,0,0] │
│   9 │ [0,0,0] │
│  10 │ [0,0,0] │
│  11 │ [0,0,0] │
│  12 │ [0,0,0] │
│  13 │ [0,0,0] │
│  14 │ [0,0,0] │
└─────┴─────────┘
</code></pre></div> <p><strong>3.</strong> Calculate the total number of site visits per day.</p> <p>Query:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=k>sum</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=k>AS</span> <span class=n>r1</span><span class=p>,</span>
    <span class=k>sum</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=k>AS</span> <span class=n>r2</span><span class=p>,</span>
    <span class=k>sum</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=k>AS</span> <span class=n>r3</span>
<span class=k>FROM</span>
<span class=p>(</span>
    <span class=k>SELECT</span>
        <span class=n>uid</span><span class=p>,</span>
        <span class=n>retention</span><span class=p>(</span><span class=nb>date</span> <span class=o>=</span> <span class=s1>'2020-01-01'</span><span class=p>,</span> <span class=nb>date</span> <span class=o>=</span> <span class=s1>'2020-01-02'</span><span class=p>,</span> <span class=nb>date</span> <span class=o>=</span> <span class=s1>'2020-01-03'</span><span class=p>)</span> <span class=k>AS</span> <span class=n>r</span>
    <span class=k>FROM</span> <span class=n>retention_test</span>
    <span class=k>WHERE</span> <span class=nb>date</span> <span class=k>IN</span> <span class=p>(</span><span class=s1>'2020-01-01'</span><span class=p>,</span> <span class=s1>'2020-01-02'</span><span class=p>,</span> <span class=s1>'2020-01-03'</span><span class=p>)</span>
    <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>uid</span>
<span class=p>)</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─r1─┬─r2─┬─r3─┐
│  5 │  5 │  5 │
└────┴────┴────┘
</code></pre></div> <p>Where:</p> <ul> <li><code class=syntax>r1</code>- the number of unique visitors who visited the site during 2020-01-01 (the <code class=syntax>cond1</code> condition).</li> <li><code class=syntax>r2</code>- the number of unique visitors who visited the site during a specific time period between 2020-01-01 and 2020-01-02 (<code class=syntax>cond1</code> and <code class=syntax>cond2</code> conditions).</li> <li><code class=syntax>r3</code>- the number of unique visitors who visited the site during a specific time period between 2020-01-01 and 2020-01-03 (<code class=syntax>cond1</code> and <code class=syntax>cond3</code> conditions).</li> </ul> <h2 id=uniquptonx>uniqUpTo(N)(x)<a class=headerlink href=../amp/#uniquptonx title="Permanent link"> </a></h2> <p>Calculates the number of different argument values ​​if it is less than or equal to N. If the number of different argument values is greater than N, it returns N + 1.</p> <p>Recommended for use with small Ns, up to 10. The maximum value of N is 100.</p> <p>For the state of an aggregate function, it uses the amount of memory equal to 1 + N * the size of one value of bytes.<br> For strings, it stores a non-cryptographic hash of 8 bytes. That is, the calculation is approximated for strings.</p> <p>The function also works for several arguments.</p> <p>It works as fast as possible, except for cases when a large N value is used and the number of unique values is slightly less than N.</p> <p>Usage example:</p> <div class=codehilite><pre><span></span><code class=syntax>Problem: Generate a report that shows only keywords that produced at least 5 unique users.
Solution: Write in the GROUP BY query SearchPhrase HAVING uniqUpTo(4)(UserID) &gt;= 5
</code></pre></div> <h2 id=summapfilteredkeys-to-keepkeys-values>sumMapFiltered(keys_to_keep)(keys, values)<a class=headerlink href=../amp/#summapfilteredkeys-to-keepkeys-values title="Permanent link"> </a></h2> <p>Same behavior as <a href=../../reference/summap/amp/#agg_functions-summap>sumMap</a> except that an array of keys is passed as a parameter. This can be especially useful when working with a high cardinality of keys.</p> <h2 id=sequenceNextNode>sequenceNextNode<a class=headerlink href=../amp/#sequenceNextNode title="Permanent link"> </a></h2> <p>Returns a value of the next event that matched an event chain.</p> <p><em>Experimental function, <code class=syntax>SET allow_experimental_funnel_functions = 1</code> to enable it.</em></p> <p><strong>Syntax</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>sequenceNextNode</span><span class=p>(</span><span class=n>direction</span><span class=p>,</span> <span class=n>base</span><span class=p>)(</span><span class=k>timestamp</span><span class=p>,</span> <span class=n>event_column</span><span class=p>,</span> <span class=n>base_condition</span><span class=p>,</span> <span class=n>event1</span><span class=p>,</span> <span class=n>event2</span><span class=p>,</span> <span class=n>event3</span><span class=p>,</span> <span class=p>...)</span>
</code></pre></div> <p><strong>Parameters</strong></p> <ul> <li> <p><code class=syntax>direction</code> — Used to navigate to directions.</p> <ul> <li>forward — Moving forward.</li> <li>backward — Moving backward.</li> </ul> </li> <li> <p><code class=syntax>base</code> — Used to set the base point.</p> <ul> <li>head — Set the base point to the first event.</li> <li>tail — Set the base point to the last event.</li> <li>first_match — Set the base point to the first matched <code class=syntax>event1</code>.</li> <li>last_match — Set the base point to the last matched <code class=syntax>event1</code>.</li> </ul> </li> </ul> <p><strong>Arguments</strong></p> <ul> <li><code class=syntax>timestamp</code> — Name of the column containing the timestamp. Data types supported: <a href=../../../data-types/date/amp/ >Date</a>, <a href=../../../data-types/datetime/amp/#data_type-datetime>DateTime</a> and other unsigned integer types.</li> <li><code class=syntax>event_column</code> — Name of the column containing the value of the next event to be returned. Data types supported: <a href=../../../data-types/string/amp/ >String</a> and <a href=../../../data-types/nullable/amp/ >Nullable(String)</a>.</li> <li><code class=syntax>base_condition</code> — Condition that the base point must fulfill.</li> <li><code class=syntax>event1</code>, <code class=syntax>event2</code>, ... — Conditions describing the chain of events. <a href=../../../data-types/int-uint/amp/ >UInt8</a>.</li> </ul> <p><strong>Returned values</strong></p> <ul> <li><code class=syntax>event_column[next_index]</code> — If the pattern is matched and next value exists.</li> <li><code class=syntax>NULL</code> - If the pattern isn’t matched or next value doesn't exist.</li> </ul> <p>Type: <a href=../../../data-types/nullable/amp/ >Nullable(String)</a>.</p> <p><strong>Example</strong></p> <p>It can be used when events are A-&gt;B-&gt;C-&gt;D-&gt;E and you want to know the event following B-&gt;C, which is D.</p> <p>The query statement searching the event following A-&gt;B:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>test_flow</span> <span class=p>(</span>
    <span class=n>dt</span> <span class=n>DateTime</span><span class=p>,</span> 
    <span class=n>id</span> <span class=nb>int</span><span class=p>,</span> 
    <span class=n>page</span> <span class=n>String</span><span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span> 
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMMDD</span><span class=p>(</span><span class=n>dt</span><span class=p>)</span> 
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>test_flow</span> <span class=k>VALUES</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'A'</span><span class=p>)</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'B'</span><span class=p>)</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'C'</span><span class=p>)</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'D'</span><span class=p>)</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'E'</span><span class=p>);</span>

<span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'forward'</span><span class=p>,</span> <span class=s1>'head'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'A'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'A'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'B'</span><span class=p>)</span> <span class=k>as</span> <span class=n>next_flow</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>
</code></pre></div> <p>Result:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─id─┬─next_flow─┐
│  1 │ C         │
└────┴───────────┘
</code></pre></div> <p><strong>Behavior for <code class=syntax>forward</code> and <code class=syntax>head</code></strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>test_flow</span> <span class=k>DELETE</span> <span class=k>WHERE</span> <span class=mi>1</span> <span class=o>=</span> <span class=mi>1</span> <span class=n>settings</span> <span class=n>mutations_sync</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>test_flow</span> <span class=k>VALUES</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'Home'</span><span class=p>)</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'Exit'</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>test_flow</span> <span class=k>VALUES</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>'Home'</span><span class=p>)</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>'Home'</span><span class=p>)</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>'Basket'</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>test_flow</span> <span class=k>VALUES</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>'Home'</span><span class=p>)</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=s1>'Basket'</span><span class=p>);</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'forward'</span><span class=p>,</span> <span class=s1>'head'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Home'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Home'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                  <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Home</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Gift</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>Exit</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span> 

 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>2</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Home</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>2</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Unmatched</span> <span class=k>with</span> <span class=n>Gift</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>2</span>   <span class=n>Gift</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>2</span>   <span class=n>Basket</span>    

 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Unmatched</span> <span class=k>with</span> <span class=n>Home</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>3</span>   <span class=n>Home</span>      
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>3</span>   <span class=n>Gift</span>      
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>3</span>   <span class=n>Basket</span>    
</code></pre></div> <p><strong>Behavior for <code class=syntax>backward</code> and <code class=syntax>tail</code></strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'backward'</span><span class=p>,</span> <span class=s1>'tail'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Basket'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Basket'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                 <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>Home</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>Gift</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>Exit</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Unmatched</span> <span class=k>with</span> <span class=n>Basket</span>

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>2</span>   <span class=n>Home</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>2</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>2</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Gift</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>2</span>   <span class=n>Basket</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Basket</span>

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>3</span>   <span class=n>Gift</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>3</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Gift</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>3</span>   <span class=n>Basket</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span><span class=p>,</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Basket</span>
</code></pre></div> <p><strong>Behavior for <code class=syntax>forward</code> and <code class=syntax>first_match</code></strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'forward'</span><span class=p>,</span> <span class=s1>'first_match'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                 <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>Home</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>Exit</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>2</span>   <span class=n>Home</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>2</span>   <span class=n>Home</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>2</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>2</span>   <span class=n>Basket</span>  <span class=n>The</span> <span class=k>result</span>

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>3</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>3</span>   <span class=n>Gift</span>   
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>3</span>   <span class=n>Basket</span>    
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'forward'</span><span class=p>,</span> <span class=s1>'first_match'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Home'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                 <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>Home</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>Exit</span> <span class=o>//</span> <span class=n>Unmatched</span> <span class=k>with</span> <span class=n>Home</span>

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>2</span>   <span class=n>Home</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>2</span>   <span class=n>Home</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>2</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>2</span>   <span class=n>Basket</span> <span class=o>//</span> <span class=n>Unmatched</span> <span class=k>with</span> <span class=n>Home</span>

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>3</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Home</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>3</span>   <span class=n>Basket</span>    
</code></pre></div> <p><strong>Behavior for <code class=syntax>backward</code> and <code class=syntax>last_match</code></strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'backward'</span><span class=p>,</span> <span class=s1>'last_match'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                 <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>Exit</span> 

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>2</span>   <span class=n>Home</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>2</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>2</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>2</span>   <span class=n>Basket</span>    

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>3</span>   <span class=n>Gift</span> 
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>3</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>  
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>3</span>   <span class=n>Basket</span>    
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'backward'</span><span class=p>,</span> <span class=s1>'last_match'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Gift'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'Home'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                 <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Home</span><span class=p>,</span> <span class=n>the</span> <span class=k>result</span> <span class=k>is</span> <span class=k>null</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>Exit</span> 

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>2</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>2</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Home</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>2</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>2</span>   <span class=n>Basket</span>    

<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>3</span>   <span class=n>Home</span> <span class=o>//</span> <span class=n>Matched</span> <span class=k>with</span> <span class=n>Home</span>
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>3</span>   <span class=n>Gift</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>  
<span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>3</span>   <span class=n>Basket</span>    
</code></pre></div> <p><strong>Behavior for <code class=syntax>base_condition</code></strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>test_flow_basecond</span>
<span class=p>(</span>
    <span class=o>`</span><span class=n>dt</span><span class=o>`</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=o>`</span><span class=n>id</span><span class=o>`</span> <span class=nb>int</span><span class=p>,</span>
    <span class=o>`</span><span class=n>page</span><span class=o>`</span> <span class=n>String</span><span class=p>,</span>
    <span class=o>`</span><span class=k>ref</span><span class=o>`</span> <span class=n>String</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMMDD</span><span class=p>(</span><span class=n>dt</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>test_flow_basecond</span> <span class=k>VALUES</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'A'</span><span class=p>,</span> <span class=s1>'ref4'</span><span class=p>)</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'A'</span><span class=p>,</span> <span class=s1>'ref3'</span><span class=p>)</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'B'</span><span class=p>,</span> <span class=s1>'ref2'</span><span class=p>)</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>'B'</span><span class=p>,</span> <span class=s1>'ref1'</span><span class=p>);</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'forward'</span><span class=p>,</span> <span class=s1>'head'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=k>ref</span> <span class=o>=</span> <span class=s1>'ref1'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'A'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow_basecond</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                  <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>   <span class=k>ref</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref4</span> <span class=o>//</span> <span class=n>The</span> <span class=n>head</span> <span class=n>can</span> <span class=k>not</span> <span class=n>be</span> <span class=n>base</span> <span class=n>point</span> <span class=n>because</span> <span class=n>the</span> <span class=k>ref</span> <span class=k>column</span> <span class=k>of</span> <span class=n>the</span> <span class=n>head</span> <span class=n>unmatched</span> <span class=k>with</span> <span class=s1>'ref1'</span><span class=p>.</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref3</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref2</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref1</span> 
 <span class=o>```</span>

<span class=o>```</span> <span class=k>sql</span>
<span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'backward'</span><span class=p>,</span> <span class=s1>'tail'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=k>ref</span> <span class=o>=</span> <span class=s1>'ref4'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'B'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow_basecond</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                  <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>   <span class=k>ref</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref4</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref3</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref2</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref1</span> <span class=o>//</span> <span class=n>The</span> <span class=n>tail</span> <span class=n>can</span> <span class=k>not</span> <span class=n>be</span> <span class=n>base</span> <span class=n>point</span> <span class=n>because</span> <span class=n>the</span> <span class=k>ref</span> <span class=k>column</span> <span class=k>of</span> <span class=n>the</span> <span class=n>tail</span> <span class=n>unmatched</span> <span class=k>with</span> <span class=s1>'ref4'</span><span class=p>.</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'forward'</span><span class=p>,</span> <span class=s1>'first_match'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=k>ref</span> <span class=o>=</span> <span class=s1>'ref3'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'A'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow_basecond</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                  <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>   <span class=k>ref</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref4</span> <span class=o>//</span> <span class=n>This</span> <span class=k>row</span> <span class=n>can</span> <span class=k>not</span> <span class=n>be</span> <span class=n>base</span> <span class=n>point</span> <span class=n>because</span> <span class=n>the</span> <span class=k>ref</span> <span class=k>column</span> <span class=n>unmatched</span> <span class=k>with</span> <span class=s1>'ref3'</span><span class=p>.</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref3</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref2</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref1</span> 
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>id</span><span class=p>,</span> <span class=n>sequenceNextNode</span><span class=p>(</span><span class=s1>'backward'</span><span class=p>,</span> <span class=s1>'last_match'</span><span class=p>)(</span><span class=n>dt</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=k>ref</span> <span class=o>=</span> <span class=s1>'ref2'</span><span class=p>,</span> <span class=n>page</span> <span class=o>=</span> <span class=s1>'B'</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>test_flow_basecond</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>id</span><span class=p>;</span>

                  <span class=n>dt</span>   <span class=n>id</span>   <span class=n>page</span>   <span class=k>ref</span> 
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref4</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span>    <span class=mi>1</span>   <span class=n>A</span>      <span class=n>ref3</span> <span class=o>//</span> <span class=n>The</span> <span class=k>result</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>03</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref2</span> <span class=o>//</span> <span class=n>Base</span> <span class=n>point</span>
 <span class=mi>1970</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>04</span>    <span class=mi>1</span>   <span class=n>B</span>      <span class=n>ref1</span> <span class=o>//</span> <span class=n>This</span> <span class=k>row</span> <span class=n>can</span> <span class=k>not</span> <span class=n>be</span> <span class=n>base</span> <span class=n>point</span> <span class=n>because</span> <span class=n>the</span> <span class=k>ref</span> <span class=k>column</span> <span class=n>unmatched</span> <span class=k>with</span> <span class=s1>'ref2'</span><span class=p>.</span> 
</code></pre></div> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2021 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/878a159538935028f2d2dce3eb3074d44eb191df rel="external nofollow noreferrer" target=_blank class=text-reset>878a159538</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/en/sql-reference/aggregate-functions/parametric-functions/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 