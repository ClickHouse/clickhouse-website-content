










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="en">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>MergeTree | ClickHouse Documentation</title>
    <link rel="canonical" href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "MergeTree | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "MergeTree | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>@charset "UTF-8";:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,header,main,section{display:block}body{margin:0;font-family:"Noto Sans",sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b,strong{font-weight:bolder}small{font-size:80%}a{color:#ff8c00;text-decoration:none;background-color:transparent}a:hover{color:#ff8c00;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}th{text-align:inherit}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item;cursor:pointer}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:"Hind Siliguri",sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.small,small{font-size:80%;font-weight:400}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-last{order:13}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-first{order:-1}.order-md-last{order:13}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-first{order:-1}.order-lg-last{order:13}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}}.table{width:100%;margin-bottom:8px;color:#212529}.table td,.table th{padding:.75rem;vertical-align:top;border-top:1px solid #d6dbdf}.table thead th{vertical-align:bottom;border-bottom:2px solid #d6dbdf}.table tbody+tbody{border-top:2px solid #d6dbdf}.table-primary,.table-primary>td,.table-primary>th{background-color:#fff1b8}.table-primary tbody+tbody,.table-primary td,.table-primary th,.table-primary thead th{border-color:#ffe47a}.table-info,.table-info>td,.table-info>th{background-color:#bee5eb}.table-info tbody+tbody,.table-info td,.table-info th,.table-info thead th{border-color:#86cfda}.table-warning,.table-warning>td,.table-warning>th{background-color:#ffeeba}.table-warning tbody+tbody,.table-warning td,.table-warning th,.table-warning thead th{border-color:#ffdf7e}.table-light,.table-light>td,.table-light>th{background-color:#fbfcfd}.table-light tbody+tbody,.table-light td,.table-light th,.table-light thead th{border-color:#f8fafc}.table-dark,.table-dark>td,.table-dark>th{background-color:#ccced0}.table-dark tbody+tbody,.table-dark td,.table-dark th,.table-dark thead th{border-color:#a0a4a8}.table-primary-light,.table-primary-light>td,.table-primary-light>th{background-color:#fffefb}.table-primary-light tbody+tbody,.table-primary-light td,.table-primary-light th,.table-primary-light thead th{border-color:#fffcf7}.table-white,.table-white>td,.table-white>th{background-color:#fff}.table-white tbody+tbody,.table-white td,.table-white th,.table-white thead th{border-color:#fff}.table-black,.table-black>td,.table-black>th{background-color:#c1c2c3}.table-black tbody+tbody,.table-black td,.table-black th,.table-black thead th{border-color:#8c8e90}.table-orange,.table-orange>td,.table-orange>th{background-color:#ffdfb8}.table-orange tbody+tbody,.table-orange td,.table-orange th,.table-orange thead th{border-color:#ffc37a}.table-light-orange,.table-light-orange>td,.table-light-orange>th{background-color:#fff7ea}.table-light-orange tbody+tbody,.table-light-orange td,.table-light-orange th,.table-light-orange thead th{border-color:#fff1d9}.table .thead-dark th{color:#fff;background-color:#343a40;border-color:#454d55}.table .thead-light th{color:#6c757d;background-color:#e9ecef;border-color:#d6dbdf}.table-dark{color:#fff;background-color:#343a40}.table-dark td,.table-dark th,.table-dark thead th{border-color:#454d55}.form-control{display:block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:8px;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.form-control{transition:none}}.form-control::-ms-expand{background-color:transparent;border:0}.form-control:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.form-control:focus{color:#6c757d;background-color:#fff;border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.form-control::-moz-placeholder{color:#6c757d;opacity:1}.form-control:-ms-input-placeholder{color:#6c757d;opacity:1}.form-control::placeholder{color:#6c757d;opacity:1}.form-control:disabled,.form-control[readonly]{background-color:#e9ecef;opacity:1}select.form-control:focus::-ms-value{color:#6c757d;background-color:#fff}.form-control-file,.form-control-range{display:block;width:100%}.form-control-lg{height:calc(1.5em+1rem+2px);padding:.5rem 1rem;font-size:1.125rem;line-height:1.5;border-radius:8px}select.form-control[multiple],select.form-control[size]{height:auto}.form-group{margin-bottom:1rem}.form-text{display:block;margin-top:.25rem}.form-row{display:flex;flex-wrap:wrap;margin-right:-5px;margin-left:-5px}.form-row>.col,.form-row>[class*=col-]{padding-right:5px;padding-left:5px}.form-check{position:relative;display:block;padding-left:1.25rem}.form-check-inline{display:inline-flex;align-items:center;padding-left:0;margin-right:.75rem}.form-inline{display:flex;flex-flow:row wrap;align-items:center}.form-inline .form-check{width:100%}@media(min-width:616px){.form-inline .form-group{display:flex;flex:0 0 auto;flex-flow:row wrap;align-items:center;margin-bottom:0}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .custom-select{width:auto}.form-inline .form-check{display:flex;align-items:center;justify-content:center;width:auto;padding-left:0}.form-inline .custom-control{align-items:center;justify-content:center}}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn.disabled,.btn:disabled{opacity:.65}a.btn.disabled{pointer-events:none}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{color:#495057;background-color:#d9ad00;border-color:#cca300;box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary.disabled,.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:not(:disabled):not(.disabled):active{color:#495057;background-color:#cca300;border-color:#bf9900}.btn-primary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info:focus{color:#fff;background-color:#138496;border-color:#117a8b;box-shadow:0 0 0 0 rgba(58,176,195,.5)}.btn-info.disabled,.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:not(:disabled):not(.disabled):active{color:#fff;background-color:#117a8b;border-color:#10707f}.btn-info:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(58,176,195,.5)}.btn-warning{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#495057;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#495057;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 0 rgba(228,176,19,.5)}.btn-warning.disabled,.btn-warning:disabled{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-warning:not(:disabled):not(.disabled):active{color:#495057;background-color:#d39e00;border-color:#c69500}.btn-warning:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(228,176,19,.5)}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{color:#495057;background-color:#d6e5ee;border-color:#cddfea;box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light.disabled,.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:not(:disabled):not(.disabled):active{color:#495057;background-color:#cddfea;border-color:#c4d9e6}.btn-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{color:#fff;background-color:#383d42;border-color:#32373b;box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark.disabled,.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#32373b;border-color:#2c3034}.btn-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{color:#495057;background-color:#ffedca;border-color:#ffe9bd;box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light.disabled,.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:not(:disabled):not(.disabled):active{color:#495057;background-color:#ffe9bd;border-color:#ffe5b0}.btn-primary-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{color:#495057;background-color:#ececec;border-color:#e6e6e6;box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white.disabled,.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-white:not(:disabled):not(.disabled):active{color:#495057;background-color:#e6e6e6;border-color:#dfdfdf}.btn-white:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{color:#fff;background-color:#101214;border-color:#0a0c0d;box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black.disabled,.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-black:not(:disabled):not(.disabled):active{color:#fff;background-color:#0a0c0d;border-color:#050506}.btn-black:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{color:#fff;background-color:#d97700;border-color:#cc7000;box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange.disabled,.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:not(:disabled):not(.disabled):active{color:#fff;background-color:#cc7000;border-color:#bf6900}.btn-orange:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{color:#495057;background-color:#ffd68f;border-color:#ffd182;box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange.disabled,.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:not(:disabled):not(.disabled):active{color:#495057;background-color:#ffd182;border-color:#ffcd75}.btn-light-orange:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary.disabled,.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-primary:not(:disabled):not(.disabled):active{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:focus{box-shadow:0 0 0 0 rgba(23,162,184,.5)}.btn-outline-info.disabled,.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-info:not(:disabled):not(.disabled):active{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(23,162,184,.5)}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 0 rgba(255,193,7,.5)}.btn-outline-warning.disabled,.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-warning:not(:disabled):not(.disabled):active{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(255,193,7,.5)}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light.disabled,.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-light:not(:disabled):not(.disabled):active{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light.disabled,.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-primary-light:not(:disabled):not(.disabled):active{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 rgba(255,255,255,.5)}.btn-outline-white.disabled,.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-white:not(:disabled):not(.disabled):active{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(255,255,255,.5)}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black.disabled,.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-black:not(:disabled):not(.disabled):active{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange.disabled,.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-orange:not(:disabled):not(.disabled):active{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange.disabled,.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-outline-light-orange:not(:disabled):not(.disabled):active{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link.disabled,.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:inline-flex;margin-right:1rem}.custom-switch{padding-left:2.25rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#fc0;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#fff0b3}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#fc0;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#fff0b3}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#fc0;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#fff0b3}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px;background-color:#dee2e6;border-radius:1rem}.custom-range:disabled::-webkit-slider-thumb{background-color:#d6dbdf}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#d6dbdf}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#d6dbdf}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:8px}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#947c14;background-color:#fff5cc;border-color:#fff1b8}.alert-primary .alert-link{color:#67560e}.alert-info{color:#1c6673;background-color:#d1ecf1;border-color:#bee5eb}.alert-info .alert-link{color:#12424a}.alert-warning{color:#947617;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#685310}.alert-light{color:#8d9295;background-color:#fcfdfe;border-color:#fbfcfd}.alert-light .alert-link{color:#73797c}.alert-dark{color:#363b41;background-color:#dbdcdd;border-color:#ccced0}.alert-dark .alert-link{color:#1f2225}.alert-primary-light{color:#949490;background-color:#fffefc;border-color:#fffefb}.alert-primary-light .alert-link{color:#7b7b76}.alert-white{color:#949698;background-color:#fff;border-color:#fff}.alert-white .alert-link{color:#7a7d7f}.alert-black{color:#212529;background-color:#d3d3d4;border-color:#c1c2c3}.alert-black .alert-link{color:#0a0c0d}.alert-orange{color:#945b14;background-color:#ffe8cc;border-color:#ffdfb8}.alert-orange .alert-link{color:#673f0e}.alert-light-orange{color:#948872;background-color:#fffaf0;border-color:#fff7ea}.alert-light-orange .alert-link{color:#786e5b}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:flex;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{transform:rotate(360deg)}}@keyframes spinner-border{to{transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#fc0}a.bg-primary:focus,a.bg-primary:hover{background-color:#cca300}.bg-info{background-color:#17a2b8}a.bg-info:focus,a.bg-info:hover{background-color:#117a8b}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f1f6f9}a.bg-light:focus,a.bg-light:hover{background-color:#cddfea}.bg-dark{background-color:#495057}a.bg-dark:focus,a.bg-dark:hover{background-color:#32373b}.bg-primary-light{background-color:#fffaf0}a.bg-primary-light:focus,a.bg-primary-light:hover{background-color:#ffe9bd}.bg-white{background-color:#fff}a.bg-white:focus,a.bg-white:hover{background-color:#e6e6e6}.bg-black{background-color:#212529}a.bg-black:focus,a.bg-black:hover{background-color:#0a0c0d}.bg-orange{background-color:#ff8c00}a.bg-orange:focus,a.bg-orange:hover{background-color:#cc7000}.bg-light-orange{background-color:#ffe4b5}a.bg-light-orange:focus,a.bg-light-orange:hover{background-color:#ffd182}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:980px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:980px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}@supports(position:sticky){.sticky-top{position:sticky;top:0;z-index:1020}}.shadow{box-shadow:0 8px 20px rgba(108,117,125,.2)}.shadow-lg{box-shadow:0 12px 32px rgba(108,117,125,.2)}.shadow-none{box-shadow:none}.w-25{width:25%}.w-50{width:50%}.w-75{width:75%}.w-100{width:100%}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:8px}.mr-1{margin-right:8px}.mb-1,.my-1{margin-bottom:8px}.my-2{margin-top:16px}.mr-2{margin-right:16px}.mb-2,.my-2{margin-bottom:16px}.my-3{margin-top:24px}.mr-3{margin-right:24px}.mb-3,.my-3{margin-bottom:24px}.my-4{margin-top:32px}.mr-4{margin-right:32px}.mb-4,.my-4{margin-bottom:32px}.my-5{margin-top:40px}.mr-5{margin-right:40px}.mb-5,.my-5{margin-bottom:40px}.my-6{margin-top:48px}.mr-6{margin-right:48px}.mb-6,.my-6{margin-bottom:48px}.my-7{margin-top:56px}.mr-7{margin-right:56px}.mb-7,.my-7{margin-bottom:56px}.my-8{margin-top:64px}.mr-8{margin-right:64px}.mb-8,.my-8{margin-bottom:64px}.my-9{margin-top:72px}.mr-9{margin-right:72px}.mb-9,.my-9{margin-bottom:72px}.my-10{margin-top:80px}.mr-10{margin-right:80px}.mb-10,.my-10{margin-bottom:80px}.my-12{margin-top:96px}.mr-12{margin-right:96px}.mb-12,.my-12{margin-bottom:96px}.my-15{margin-top:120px}.mr-15{margin-right:120px}.mb-15,.my-15{margin-bottom:120px}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:8px}.pt-1,.py-1{padding-top:8px}.pb-1,.py-1{padding-bottom:8px}.p-2{padding:16px}.pt-2,.py-2{padding-top:16px}.pb-2,.py-2{padding-bottom:16px}.p-3{padding:24px}.pt-3,.py-3{padding-top:24px}.pb-3,.py-3{padding-bottom:24px}.p-4{padding:32px}.pt-4,.py-4{padding-top:32px}.pb-4,.py-4{padding-bottom:32px}.p-5{padding:40px}.pt-5,.py-5{padding-top:40px}.pb-5,.py-5{padding-bottom:40px}.p-6{padding:48px}.pt-6,.py-6{padding-top:48px}.pb-6,.py-6{padding-bottom:48px}.p-7{padding:56px}.pt-7,.py-7{padding-top:56px}.pb-7,.py-7{padding-bottom:56px}.p-8{padding:64px}.pt-8,.py-8{padding-top:64px}.pb-8,.py-8{padding-bottom:64px}.p-9{padding:72px}.pt-9,.py-9{padding-top:72px}.pb-9,.py-9{padding-bottom:72px}.p-10{padding:80px}.pt-10,.py-10{padding-top:80px}.pb-10,.py-10{padding-bottom:80px}.p-12{padding:96px}.pt-12,.py-12{padding-top:96px}.pb-12,.py-12{padding-bottom:96px}.p-15{padding:120px}.pt-15,.py-15{padding-top:120px}.pb-15,.py-15{padding-bottom:120px}.my-n1{margin-top:-8px}.mr-n1{margin-right:-8px}.mb-n1,.my-n1{margin-bottom:-8px}.my-n2{margin-top:-16px}.mr-n2{margin-right:-16px}.mb-n2,.my-n2{margin-bottom:-16px}.my-n3{margin-top:-24px}.mr-n3{margin-right:-24px}.mb-n3,.my-n3{margin-bottom:-24px}.my-n4{margin-top:-32px}.mr-n4{margin-right:-32px}.mb-n4,.my-n4{margin-bottom:-32px}.my-n5{margin-top:-40px}.mr-n5{margin-right:-40px}.mb-n5,.my-n5{margin-bottom:-40px}.my-n6{margin-top:-48px}.mr-n6{margin-right:-48px}.mb-n6,.my-n6{margin-bottom:-48px}.my-n7{margin-top:-56px}.mr-n7{margin-right:-56px}.mb-n7,.my-n7{margin-bottom:-56px}.my-n8{margin-top:-64px}.mr-n8{margin-right:-64px}.mb-n8,.my-n8{margin-bottom:-64px}.my-n9{margin-top:-72px}.mr-n9{margin-right:-72px}.mb-n9,.my-n9{margin-bottom:-72px}.my-n10{margin-top:-80px}.mr-n10{margin-right:-80px}.mb-n10,.my-n10{margin-bottom:-80px}.my-n12{margin-top:-96px}.mr-n12{margin-right:-96px}.mb-n12,.my-n12{margin-bottom:-96px}.my-n15{margin-top:-120px}.mr-n15{margin-right:-120px}.mb-n15,.my-n15{margin-bottom:-120px}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:8px}.mr-md-1{margin-right:8px}.mb-md-1,.my-md-1{margin-bottom:8px}.my-md-2{margin-top:16px}.mr-md-2{margin-right:16px}.mb-md-2,.my-md-2{margin-bottom:16px}.my-md-3{margin-top:24px}.mr-md-3{margin-right:24px}.mb-md-3,.my-md-3{margin-bottom:24px}.my-md-4{margin-top:32px}.mr-md-4{margin-right:32px}.mb-md-4,.my-md-4{margin-bottom:32px}.my-md-5{margin-top:40px}.mr-md-5{margin-right:40px}.mb-md-5,.my-md-5{margin-bottom:40px}.my-md-6{margin-top:48px}.mr-md-6{margin-right:48px}.mb-md-6,.my-md-6{margin-bottom:48px}.my-md-7{margin-top:56px}.mr-md-7{margin-right:56px}.mb-md-7,.my-md-7{margin-bottom:56px}.my-md-8{margin-top:64px}.mr-md-8{margin-right:64px}.mb-md-8,.my-md-8{margin-bottom:64px}.my-md-9{margin-top:72px}.mr-md-9{margin-right:72px}.mb-md-9,.my-md-9{margin-bottom:72px}.my-md-10{margin-top:80px}.mr-md-10{margin-right:80px}.mb-md-10,.my-md-10{margin-bottom:80px}.my-md-12{margin-top:96px}.mr-md-12{margin-right:96px}.mb-md-12,.my-md-12{margin-bottom:96px}.my-md-15{margin-top:120px}.mr-md-15{margin-right:120px}.mb-md-15,.my-md-15{margin-bottom:120px}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:8px}.pt-md-1,.py-md-1{padding-top:8px}.pb-md-1,.py-md-1{padding-bottom:8px}.p-md-2{padding:16px}.pt-md-2,.py-md-2{padding-top:16px}.pb-md-2,.py-md-2{padding-bottom:16px}.p-md-3{padding:24px}.pt-md-3,.py-md-3{padding-top:24px}.pb-md-3,.py-md-3{padding-bottom:24px}.p-md-4{padding:32px}.pt-md-4,.py-md-4{padding-top:32px}.pb-md-4,.py-md-4{padding-bottom:32px}.p-md-5{padding:40px}.pt-md-5,.py-md-5{padding-top:40px}.pb-md-5,.py-md-5{padding-bottom:40px}.p-md-6{padding:48px}.pt-md-6,.py-md-6{padding-top:48px}.pb-md-6,.py-md-6{padding-bottom:48px}.p-md-7{padding:56px}.pt-md-7,.py-md-7{padding-top:56px}.pb-md-7,.py-md-7{padding-bottom:56px}.p-md-8{padding:64px}.pt-md-8,.py-md-8{padding-top:64px}.pb-md-8,.py-md-8{padding-bottom:64px}.p-md-9{padding:72px}.pt-md-9,.py-md-9{padding-top:72px}.pb-md-9,.py-md-9{padding-bottom:72px}.p-md-10{padding:80px}.pt-md-10,.py-md-10{padding-top:80px}.pb-md-10,.py-md-10{padding-bottom:80px}.p-md-12{padding:96px}.pt-md-12,.py-md-12{padding-top:96px}.pb-md-12,.py-md-12{padding-bottom:96px}.p-md-15{padding:120px}.pt-md-15,.py-md-15{padding-top:120px}.pb-md-15,.py-md-15{padding-bottom:120px}.my-md-n1{margin-top:-8px}.mr-md-n1{margin-right:-8px}.mb-md-n1,.my-md-n1{margin-bottom:-8px}.my-md-n2{margin-top:-16px}.mr-md-n2{margin-right:-16px}.mb-md-n2,.my-md-n2{margin-bottom:-16px}.my-md-n3{margin-top:-24px}.mr-md-n3{margin-right:-24px}.mb-md-n3,.my-md-n3{margin-bottom:-24px}.my-md-n4{margin-top:-32px}.mr-md-n4{margin-right:-32px}.mb-md-n4,.my-md-n4{margin-bottom:-32px}.my-md-n5{margin-top:-40px}.mr-md-n5{margin-right:-40px}.mb-md-n5,.my-md-n5{margin-bottom:-40px}.my-md-n6{margin-top:-48px}.mr-md-n6{margin-right:-48px}.mb-md-n6,.my-md-n6{margin-bottom:-48px}.my-md-n7{margin-top:-56px}.mr-md-n7{margin-right:-56px}.mb-md-n7,.my-md-n7{margin-bottom:-56px}.my-md-n8{margin-top:-64px}.mr-md-n8{margin-right:-64px}.mb-md-n8,.my-md-n8{margin-bottom:-64px}.my-md-n9{margin-top:-72px}.mr-md-n9{margin-right:-72px}.mb-md-n9,.my-md-n9{margin-bottom:-72px}.my-md-n10{margin-top:-80px}.mr-md-n10{margin-right:-80px}.mb-md-n10,.my-md-n10{margin-bottom:-80px}.my-md-n12{margin-top:-96px}.mr-md-n12{margin-right:-96px}.mb-md-n12,.my-md-n12{margin-bottom:-96px}.my-md-n15{margin-top:-120px}.mr-md-n15{margin-right:-120px}.mb-md-n15,.my-md-n15{margin-bottom:-120px}}@media(min-width:980px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:8px}.mr-lg-1{margin-right:8px}.mb-lg-1,.my-lg-1{margin-bottom:8px}.my-lg-2{margin-top:16px}.mr-lg-2{margin-right:16px}.mb-lg-2,.my-lg-2{margin-bottom:16px}.my-lg-3{margin-top:24px}.mr-lg-3{margin-right:24px}.mb-lg-3,.my-lg-3{margin-bottom:24px}.my-lg-4{margin-top:32px}.mr-lg-4{margin-right:32px}.mb-lg-4,.my-lg-4{margin-bottom:32px}.my-lg-5{margin-top:40px}.mr-lg-5{margin-right:40px}.mb-lg-5,.my-lg-5{margin-bottom:40px}.my-lg-6{margin-top:48px}.mr-lg-6{margin-right:48px}.mb-lg-6,.my-lg-6{margin-bottom:48px}.my-lg-7{margin-top:56px}.mr-lg-7{margin-right:56px}.mb-lg-7,.my-lg-7{margin-bottom:56px}.my-lg-8{margin-top:64px}.mr-lg-8{margin-right:64px}.mb-lg-8,.my-lg-8{margin-bottom:64px}.my-lg-9{margin-top:72px}.mr-lg-9{margin-right:72px}.mb-lg-9,.my-lg-9{margin-bottom:72px}.my-lg-10{margin-top:80px}.mr-lg-10{margin-right:80px}.mb-lg-10,.my-lg-10{margin-bottom:80px}.my-lg-12{margin-top:96px}.mr-lg-12{margin-right:96px}.mb-lg-12,.my-lg-12{margin-bottom:96px}.my-lg-15{margin-top:120px}.mr-lg-15{margin-right:120px}.mb-lg-15,.my-lg-15{margin-bottom:120px}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:8px}.pt-lg-1,.py-lg-1{padding-top:8px}.pb-lg-1,.py-lg-1{padding-bottom:8px}.p-lg-2{padding:16px}.pt-lg-2,.py-lg-2{padding-top:16px}.pb-lg-2,.py-lg-2{padding-bottom:16px}.p-lg-3{padding:24px}.pt-lg-3,.py-lg-3{padding-top:24px}.pb-lg-3,.py-lg-3{padding-bottom:24px}.p-lg-4{padding:32px}.pt-lg-4,.py-lg-4{padding-top:32px}.pb-lg-4,.py-lg-4{padding-bottom:32px}.p-lg-5{padding:40px}.pt-lg-5,.py-lg-5{padding-top:40px}.pb-lg-5,.py-lg-5{padding-bottom:40px}.p-lg-6{padding:48px}.pt-lg-6,.py-lg-6{padding-top:48px}.pb-lg-6,.py-lg-6{padding-bottom:48px}.p-lg-7{padding:56px}.pt-lg-7,.py-lg-7{padding-top:56px}.pb-lg-7,.py-lg-7{padding-bottom:56px}.p-lg-8{padding:64px}.pt-lg-8,.py-lg-8{padding-top:64px}.pb-lg-8,.py-lg-8{padding-bottom:64px}.p-lg-9{padding:72px}.pt-lg-9,.py-lg-9{padding-top:72px}.pb-lg-9,.py-lg-9{padding-bottom:72px}.p-lg-10{padding:80px}.pt-lg-10,.py-lg-10{padding-top:80px}.pb-lg-10,.py-lg-10{padding-bottom:80px}.p-lg-12{padding:96px}.pt-lg-12,.py-lg-12{padding-top:96px}.pb-lg-12,.py-lg-12{padding-bottom:96px}.p-lg-15{padding:120px}.pt-lg-15,.py-lg-15{padding-top:120px}.pb-lg-15,.py-lg-15{padding-bottom:120px}.my-lg-n1{margin-top:-8px}.mr-lg-n1{margin-right:-8px}.mb-lg-n1,.my-lg-n1{margin-bottom:-8px}.my-lg-n2{margin-top:-16px}.mr-lg-n2{margin-right:-16px}.mb-lg-n2,.my-lg-n2{margin-bottom:-16px}.my-lg-n3{margin-top:-24px}.mr-lg-n3{margin-right:-24px}.mb-lg-n3,.my-lg-n3{margin-bottom:-24px}.my-lg-n4{margin-top:-32px}.mr-lg-n4{margin-right:-32px}.mb-lg-n4,.my-lg-n4{margin-bottom:-32px}.my-lg-n5{margin-top:-40px}.mr-lg-n5{margin-right:-40px}.mb-lg-n5,.my-lg-n5{margin-bottom:-40px}.my-lg-n6{margin-top:-48px}.mr-lg-n6{margin-right:-48px}.mb-lg-n6,.my-lg-n6{margin-bottom:-48px}.my-lg-n7{margin-top:-56px}.mr-lg-n7{margin-right:-56px}.mb-lg-n7,.my-lg-n7{margin-bottom:-56px}.my-lg-n8{margin-top:-64px}.mr-lg-n8{margin-right:-64px}.mb-lg-n8,.my-lg-n8{margin-bottom:-64px}.my-lg-n9{margin-top:-72px}.mr-lg-n9{margin-right:-72px}.mb-lg-n9,.my-lg-n9{margin-bottom:-72px}.my-lg-n10{margin-top:-80px}.mr-lg-n10{margin-right:-80px}.mb-lg-n10,.my-lg-n10{margin-bottom:-80px}.my-lg-n12{margin-top:-96px}.mr-lg-n12{margin-right:-96px}.mb-lg-n12,.my-lg-n12{margin-bottom:-96px}.my-lg-n15{margin-top:-120px}.mr-lg-n15{margin-right:-120px}.mb-lg-n15,.my-lg-n15{margin-bottom:-120px}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:980px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#fc0}a.text-primary:focus,a.text-primary:hover{color:#b38f00}.text-info{color:#17a2b8}a.text-info:focus,a.text-info:hover{color:#0f6674}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f1f6f9}a.text-light:focus,a.text-light:hover{color:#bbd4e2}.text-dark{color:#495057}a.text-dark:focus,a.text-dark:hover{color:#262a2d}.text-primary-light{color:#fffaf0}a.text-primary-light:focus,a.text-primary-light:hover{color:#ffe1a4}.text-white{color:#fff}a.text-white:focus,a.text-white:hover{color:#d9d9d9}.text-black{color:#212529}a.text-black:focus,a.text-black:hover{color:#000}.text-orange{color:#ff8c00}a.text-orange:focus,a.text-orange:hover{color:#b36200}.text-light-orange{color:#ffe4b5}a.text-light-orange:focus,a.text-light-orange:hover{color:#ffc869}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(33,37,41,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #d6dbdf;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:980px}.container{min-width:980px}.table{border-collapse:collapse}.table td,.table th{background-color:#fff}.table-dark{color:inherit}.table-dark tbody+tbody,.table-dark td,.table-dark th,.table-dark thead th{border-color:#d6dbdf}.table .thead-dark th{color:inherit;border-color:#d6dbdf}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}.docs a:link,.docs a:visited{color:#f14600;text-decoration:none}.docs a:active,.docs a:hover{text-decoration:underline}.btn.disabled,.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.w-15{width:15%}.height-20{height:20px}details{background:#444451;color:#eee;padding:1rem;margin-bottom:1rem;margin-top:1rem}summary{font-weight:700;color:#eee}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content thead{background:#444451;color:#fff}#content td,#content th{padding:.75rem;vertical-align:top}#content td{border:1px solid #dee2e6}#content th{border:1px solid #444451}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media(max-width:768px){#search-form{width:50%}}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre,td,th,thead,tr{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content thead{background:#333}#content td{border:1px solid #444451}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}@media(prefers-color-scheme:dark){.syntax{background:#2d2d2d;color:#f2f0ec}.syntax .c{color:#747369}.syntax .err{color:#f2777a}.syntax .k{color:#c9c}.syntax .l{color:#f99157}.syntax .n{color:#f2f0ec}.syntax .o{color:#6cc}.syntax .p{color:#f2f0ec}.syntax .c1{color:#747369}.syntax .ld{color:#9c9}.syntax .s{color:#9c9}.syntax .nb{color:#f2f0ec}.syntax .nc{color:#fc6}.syntax .no{color:#f2777a}.syntax .nl{color:#f2f0ec}.syntax .py{color:#f2f0ec}.syntax .nt{color:#6cc}.syntax .ow{color:#6cc}.syntax .w{color:#f2f0ec}.syntax .mi{color:#f99157}.syntax .s2{color:#9c9}.syntax .s1{color:#9c9}}@media screen and (max-width:978.98px){.btn{padding:8px 16px}}@media screen and (max-width:978.98px){.btn-lg{padding:12px 24px}}.btn-primary{color:#212529}.btn-primary:active,.btn-primary:hover{color:#212529}.btn-outline-primary{background:#fffaf0;border-color:#fc0;color:#212529}.btn-outline-primary:active,.btn-outline-primary:hover{background:#fc0;border-color:#fc0;color:#212529}form .form-control{border:1px solid #6c757d;border-radius:6px;box-shadow:0 8px 20px rgba(108,117,125,.2);color:#212529;height:auto;line-height:20px;min-height:44px;padding:12px 16px;width:100%}form .form-control:focus{border-color:#212529;box-shadow:0 8px 20px rgba(108,117,125,.2);color:#212529}form .form-control::-moz-placeholder{color:#6c757d}form .form-control:-ms-input-placeholder{color:#6c757d}form .form-control::placeholder{color:#6c757d}form select.form-control{-webkit-appearance:none;-moz-appearance:none;appearance:none}form select.form-control:not([data-chosen]){color:#6c757d}img{max-width:100%}.section{background-repeat:no-repeat;background-position:center;background-size:cover;overflow:visible;position:relative}.section-bg{background-repeat:no-repeat;background-position:center;background-size:cover;display:block;height:100%;left:50%;position:absolute;top:0;transform:translateX(-50%);z-index:1}.section>.container{position:relative;z-index:2}ul{list-style-type:square;padding-left:1.25em}ul li:not(:last-child){margin-bottom:16px}ul li::marker{color:#ff3939}.display-5{color:#212529;font-size:20px;font-weight:500}.display-6{color:#212529;font-size:14px;font-weight:700}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=table_engines-mergetree>MergeTree<a class=headerlink href=../amp/#table_engines-mergetree title="Permanent link"> </a></h1> <p>The <code class=syntax>MergeTree</code> engine and other engines of this family (<code class=syntax>*MergeTree</code>) are the most robust ClickHouse table engines.</p> <p>Engines in the <code class=syntax>MergeTree</code> family are designed for inserting a very large amount of data into a table. The data is quickly written to the table part by part, then rules are applied for merging the parts in the background. This method is much more efficient than continually rewriting the data in storage during insert.</p> <p>Main features:</p> <ul> <li> <p>Stores data sorted by primary key.</p> <p>This allows you to create a small sparse index that helps find data faster.</p> </li> <li> <p>Partitions can be used if the <a href=../../custom-partitioning-key/amp/ >partitioning key</a> is specified.</p> <p>ClickHouse supports certain operations with partitions that are more efficient than general operations on the same data with the same result. ClickHouse also automatically cuts off the partition data where the partitioning key is specified in the query.</p> </li> <li> <p>Data replication support.</p> <p>The family of <code class=syntax>ReplicatedMergeTree</code> tables provides data replication. For more information, see <a href=../../replication/amp/ >Data replication</a>.</p> </li> <li> <p>Data sampling support.</p> <p>If necessary, you can set the data sampling method in the table.</p> </li> </ul> <div class="admonition info alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Info</p> <p>The <a class=alert-link href=../../../special/merge/amp/#merge>Merge</a> engine does not belong to the <code class=syntax>*MergeTree</code> family.</p> </div> <h2 id=table_engine-mergetree-creating-a-table>Creating a Table<a class=headerlink href=../amp/#table_engine-mergetree-creating-a-table title="Permanent link"> </a></h2> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>index_name1</span> <span class=n>expr1</span> <span class=k>TYPE</span> <span class=n>type1</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value1</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>index_name2</span> <span class=n>expr2</span> <span class=k>TYPE</span> <span class=n>type2</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value2</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=n>PROJECTION</span> <span class=n>projection_name_1</span> <span class=p>(</span><span class=k>SELECT</span> <span class=o>&lt;</span><span class=k>COLUMN</span> <span class=n>LIST</span> <span class=n>EXPR</span><span class=o>&gt;</span> <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span><span class=p>]</span> <span class=p>[</span><span class=k>ORDER</span> <span class=k>BY</span><span class=p>]),</span>
    <span class=n>PROJECTION</span> <span class=n>projection_name_2</span> <span class=p>(</span><span class=k>SELECT</span> <span class=o>&lt;</span><span class=k>COLUMN</span> <span class=n>LIST</span> <span class=n>EXPR</span><span class=o>&gt;</span> <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span><span class=p>]</span> <span class=p>[</span><span class=k>ORDER</span> <span class=k>BY</span><span class=p>])</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>expr</span>
<span class=p>[</span><span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>TTL</span> <span class=n>expr</span>
    <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'xxx'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'xxx'</span> <span class=p>[,</span> <span class=p>...]</span> <span class=p>]</span>
    <span class=p>[</span><span class=k>WHERE</span> <span class=n>conditions</span><span class=p>]</span>
    <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span> <span class=n>key_expr</span> <span class=p>[</span><span class=k>SET</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v1</span><span class=p>)</span> <span class=p>[,</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span> <span class=p>...]]</span> <span class=p>]</span> <span class=p>]</span>
<span class=p>[</span><span class=n>SETTINGS</span> <span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=p>...]</span>
</code></pre></div> <p>For a description of parameters, see the <a href=../../../../../sql-reference/statements/create/table/amp/ >CREATE query description</a>.</p> <h3 id=mergetree-query-clauses>Query Clauses<a class=headerlink href=../amp/#mergetree-query-clauses title="Permanent link"> </a></h3> <ul> <li> <p><code class=syntax>ENGINE</code> — Name and parameters of the engine. <code class=syntax>ENGINE = MergeTree()</code>. The <code class=syntax>MergeTree</code> engine does not have parameters.</p> </li> <li> <p><code class=syntax>ORDER BY</code> — The sorting key.</p> <p>A tuple of column names or arbitrary expressions. Example: <code class=syntax>ORDER BY (CounterID, EventDate)</code>.</p> <p>ClickHouse uses the sorting key as a primary key if the primary key is not defined obviously by the <code class=syntax>PRIMARY KEY</code> clause.</p> <p>Use the <code class=syntax>ORDER BY tuple()</code> syntax, if you do not need sorting. See <a href=../amp/#selecting-the-primary-key>Selecting the Primary Key</a>.</p> </li> <li> <p><code class=syntax>PARTITION BY</code> — The <a href=../../custom-partitioning-key/amp/ >partitioning key</a>. Optional. In most cases you don't need partition key, and in most other cases you don't need partition key more granular than by months. Partitioning does not speed up queries (in contrast to the ORDER BY expression). You should never use too granular partitioning. Don't partition your data by client identifiers or names (instead make client identifier or name the first column in the ORDER BY expression).</p> <p>For partitioning by month, use the <code class=syntax>toYYYYMM(date_column)</code> expression, where <code class=syntax>date_column</code> is a column with a date of the type <a href=../../../../../sql-reference/data-types/date/amp/ >Date</a>. The partition names here have the <code class=syntax>"YYYYMM"</code> format.</p> </li> <li> <p><code class=syntax>PRIMARY KEY</code> — The primary key if it <a href=../amp/#choosing-a-primary-key-that-differs-from-the-sorting-key>differs from the sorting key</a>. Optional.</p> <p>By default the primary key is the same as the sorting key (which is specified by the <code class=syntax>ORDER BY</code> clause). Thus in most cases it is unnecessary to specify a separate <code class=syntax>PRIMARY KEY</code> clause.</p> </li> <li> <p><code class=syntax>SAMPLE BY</code> — An expression for sampling. Optional.</p> <p>If a sampling expression is used, the primary key must contain it. The result of a sampling expression must be an unsigned integer. Example: <code class=syntax>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p> </li> <li> <p><code class=syntax>TTL</code> — A list of rules specifying storage duration of rows and defining logic of automatic parts movement <a href=../amp/#table_engine-mergetree-multiple-volumes>between disks and volumes</a>. Optional.</p> <p>Expression must have one <code class=syntax>Date</code> or <code class=syntax>DateTime</code> column as a result. Example:<br> <code class=syntax>TTL date + INTERVAL 1 DAY</code></p> <p>Type of the rule <code class=syntax>DELETE|TO DISK 'xxx'|TO VOLUME 'xxx'|GROUP BY</code> specifies an action to be done with the part if the expression is satisfied (reaches current time): removal of expired rows, moving a part (if expression is satisfied for all rows in a part) to specified disk (<code class=syntax>TO DISK 'xxx'</code>) or to volume (<code class=syntax>TO VOLUME 'xxx'</code>), or aggregating values in expired rows. Default type of the rule is removal (<code class=syntax>DELETE</code>). List of multiple rules can be specified, but there should be no more than one <code class=syntax>DELETE</code> rule.</p> <p>For more details, see <a href=../amp/#table_engine-mergetree-ttl>TTL for columns and tables</a></p> </li> <li> <p><code class=syntax>SETTINGS</code> — Additional parameters that control the behavior of the <code class=syntax>MergeTree</code> (optional):</p> <ul> <li><code class=syntax>index_granularity</code> — Maximum number of data rows between the marks of an index. Default value: 8192. See <a href=../amp/#mergetree-data-storage>Data Storage</a>.</li> <li><code class=syntax>index_granularity_bytes</code> — Maximum size of data granules in bytes. Default value: 10Mb. To restrict the granule size only by number of rows, set to 0 (not recommended). See <a href=../amp/#mergetree-data-storage>Data Storage</a>.</li> <li><code class=syntax>min_index_granularity_bytes</code> — Min allowed size of data granules in bytes. Default value: 1024b. To provide a safeguard against accidentally creating tables with very low index_granularity_bytes. See <a href=../amp/#mergetree-data-storage>Data Storage</a>.</li> <li><code class=syntax>enable_mixed_granularity_parts</code> — Enables or disables transitioning to control the granule size with the <code class=syntax>index_granularity_bytes</code> setting. Before version 19.11, there was only the <code class=syntax>index_granularity</code> setting for restricting granule size. The <code class=syntax>index_granularity_bytes</code> setting improves ClickHouse performance when selecting data from tables with big rows (tens and hundreds of megabytes). If you have tables with big rows, you can enable this setting for the tables to improve the efficiency of <code class=syntax>SELECT</code> queries.</li> <li><code class=syntax>use_minimalistic_part_header_in_zookeeper</code> — Storage method of the data parts headers in ZooKeeper. If <code class=syntax>use_minimalistic_part_header_in_zookeeper=1</code>, then ZooKeeper stores less data. For more information, see the <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server-settings-use_minimalistic_part_header_in_zookeeper>setting description</a> in “Server configuration parameters”.</li> <li><code class=syntax>min_merge_bytes_to_use_direct_io</code> — The minimum data volume for merge operation that is required for using direct I/O access to the storage disk. When merging data parts, ClickHouse calculates the total storage volume of all the data to be merged. If the volume exceeds <code class=syntax>min_merge_bytes_to_use_direct_io</code> bytes, ClickHouse reads and writes the data to the storage disk using the direct I/O interface (<code class=syntax>O_DIRECT</code> option). If <code class=syntax>min_merge_bytes_to_use_direct_io = 0</code>, then direct I/O is disabled. Default value: <code class=syntax>10 * 1024 * 1024 * 1024</code> bytes.<br> <a name=mergetree_setting-merge_with_ttl_timeout></a></li> <li><code class=syntax>merge_with_ttl_timeout</code> — Minimum delay in seconds before repeating a merge with delete TTL. Default value: <code class=syntax>14400</code> seconds (4 hours).</li> <li><code class=syntax>merge_with_recompression_ttl_timeout</code> — Minimum delay in seconds before repeating a merge with recompression TTL. Default value: <code class=syntax>14400</code> seconds (4 hours).</li> <li><code class=syntax>try_fetch_recompressed_part_timeout</code> — Timeout (in seconds) before starting merge with recompression. During this time ClickHouse tries to fetch recompressed part from replica which assigned this merge with recompression. Default value: <code class=syntax>7200</code> seconds (2 hours).</li> <li><code class=syntax>write_final_mark</code> — Enables or disables writing the final index mark at the end of data part (after the last byte). Default value: 1. Don’t turn it off.</li> <li><code class=syntax>merge_max_block_size</code> — Maximum number of rows in block for merge operations. Default value: 8192.</li> <li><code class=syntax>storage_policy</code> — Storage policy. See <a href=../amp/#table_engine-mergetree-multiple-volumes>Using Multiple Block Devices for Data Storage</a>.</li> <li><code class=syntax>min_bytes_for_wide_part</code>, <code class=syntax>min_rows_for_wide_part</code> — Minimum number of bytes/rows in a data part that can be stored in <code class=syntax>Wide</code> format. You can set one, both or none of these settings. See <a href=../amp/#mergetree-data-storage>Data Storage</a>.</li> <li><code class=syntax>max_parts_in_total</code> — Maximum number of parts in all partitions.</li> <li><code class=syntax>max_compress_block_size</code> — Maximum size of blocks of uncompressed data before compressing for writing to a table. You can also specify this setting in the global settings (see <a href=../../../../../operations/settings/settings/amp/#max-compress-block-size>max_compress_block_size</a> setting). The value specified when table is created overrides the global value for this setting.</li> <li><code class=syntax>min_compress_block_size</code> — Minimum size of blocks of uncompressed data required for compression when writing the next mark. You can also specify this setting in the global settings (see <a href=../../../../../operations/settings/settings/amp/#min-compress-block-size>min_compress_block_size</a> setting). The value specified when table is created overrides the global value for this setting.</li> <li><code class=syntax>max_partitions_to_read</code> — Limits the maximum number of partitions that can be accessed in one query. You can also specify setting <a href=../../../../../operations/settings/merge-tree-settings/amp/#max-partitions-to-read>max_partitions_to_read</a> in the global setting.</li> </ul> </li> </ul> <p><strong>Example of Sections Setting</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span> <span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>))</span> <span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>index_granularity</span><span class=o>=</span><span class=mi>8192</span>
</code></pre></div> <p>In the example, we set partitioning by month.</p> <p>We also set an expression for sampling as a hash by the user ID. This allows you to pseudorandomize the data in the table for each <code class=syntax>CounterID</code> and <code class=syntax>EventDate</code>. If you define a <a href=../../../../../sql-reference/statements/select/sample/amp/#select-sample-clause>SAMPLE</a> clause when selecting the data, ClickHouse will return an evenly pseudorandom data sample for a subset of users.</p> <p>The <code class=syntax>index_granularity</code> setting can be omitted because 8192 is the default value.</p> <details><summary>Deprecated Method for Creating a Table</summary> <p></p> <div class="admonition attention alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Attention</p> <p>Do not use this method in new projects. If possible, switch old projects to the method described above.</p> </div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=p>[</span><span class=o>=</span><span class=p>]</span> <span class=n>MergeTree</span><span class=p>(</span><span class=nb>date</span><span class=o>-</span><span class=k>column</span> <span class=p>[,</span> <span class=n>sampling_expression</span><span class=p>],</span> <span class=p>(</span><span class=k>primary</span><span class=p>,</span> <span class=k>key</span><span class=p>),</span> <span class=n>index_granularity</span><span class=p>)</span>
</code></pre></div> <p><strong>MergeTree() Parameters</strong></p> <ul> <li><code class=syntax>date-column</code> — The name of a column of the <a href=../../../../../sql-reference/data-types/date/amp/ >Date</a> type. ClickHouse automatically creates partitions by month based on this column. The partition names are in the <code class=syntax>"YYYYMM"</code> format.</li> <li><code class=syntax>sampling_expression</code> — An expression for sampling.</li> <li><code class=syntax>(primary, key)</code> — Primary key. Type: <a href=../../../../../sql-reference/data-types/tuple/amp/ >Tuple()</a></li> <li><code class=syntax>index_granularity</code> — The granularity of an index. The number of data rows between the “marks” of an index. The value 8192 is appropriate for most tasks.</li> </ul> <p><strong>Example</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>MergeTree</span><span class=p>(</span><span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)),</span> <span class=mi>8192</span><span class=p>)</span>
</code></pre></div> <p>The <code class=syntax>MergeTree</code> engine is configured in the same way as in the example above for the main engine configuration method.</p> </details> <h2 id=mergetree-data-storage>Data Storage<a class=headerlink href=../amp/#mergetree-data-storage title="Permanent link"> </a></h2> <p>A table consists of data parts sorted by primary key.</p> <p>When data is inserted in a table, separate data parts are created and each of them is lexicographically sorted by primary key. For example, if the primary key is <code class=syntax>(CounterID, Date)</code>, the data in the part is sorted by <code class=syntax>CounterID</code>, and within each <code class=syntax>CounterID</code>, it is ordered by <code class=syntax>Date</code>.</p> <p>Data belonging to different partitions are separated into different parts. In the background, ClickHouse merges data parts for more efficient storage. Parts belonging to different partitions are not merged. The merge mechanism does not guarantee that all rows with the same primary key will be in the same data part.</p> <p>Data parts can be stored in <code class=syntax>Wide</code> or <code class=syntax>Compact</code> format. In <code class=syntax>Wide</code> format each column is stored in a separate file in a filesystem, in <code class=syntax>Compact</code> format all columns are stored in one file. <code class=syntax>Compact</code> format can be used to increase performance of small and frequent inserts.</p> <p>Data storing format is controlled by the <code class=syntax>min_bytes_for_wide_part</code> and <code class=syntax>min_rows_for_wide_part</code> settings of the table engine. If the number of bytes or rows in a data part is less then the corresponding setting's value, the part is stored in <code class=syntax>Compact</code> format. Otherwise it is stored in <code class=syntax>Wide</code> format. If none of these settings is set, data parts are stored in <code class=syntax>Wide</code> format.</p> <p>Each data part is logically divided into granules. A granule is the smallest indivisible data set that ClickHouse reads when selecting data. ClickHouse does not split rows or values, so each granule always contains an integer number of rows. The first row of a granule is marked with the value of the primary key for the row. For each data part, ClickHouse creates an index file that stores the marks. For each column, whether it’s in the primary key or not, ClickHouse also stores the same marks. These marks let you find data directly in column files.</p> <p>The granule size is restricted by the <code class=syntax>index_granularity</code> and <code class=syntax>index_granularity_bytes</code> settings of the table engine. The number of rows in a granule lays in the <code class=syntax>[1, index_granularity]</code> range, depending on the size of the rows. The size of a granule can exceed <code class=syntax>index_granularity_bytes</code> if the size of a single row is greater than the value of the setting. In this case, the size of the granule equals the size of the row.</p> <h2 id=primary-keys-and-indexes-in-queries>Primary Keys and Indexes in Queries<a class=headerlink href=../amp/#primary-keys-and-indexes-in-queries title="Permanent link"> </a></h2> <p>Take the <code class=syntax>(CounterID, Date)</code> primary key as an example. In this case, the sorting and index can be illustrated as follows:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=w>  </span><span class=n>Whole</span><span class=w> </span><span class=k>data</span><span class=err>:</span><span class=w>     </span><span class=o>[</span><span class=n>---------------------------------------------</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nl>CounterID</span><span class=p>:</span><span class=w>      </span><span class=o>[</span><span class=n>aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nc>Date</span><span class=err>:</span><span class=w>           </span><span class=o>[</span><span class=n>1111111222222233331233211111222222333211111112122222223111112223311122333</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nl>Marks</span><span class=p>:</span><span class=w>           </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w></span>
<span class=w>                  </span><span class=n>a</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>b</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>g</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>h</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>l</span><span class=p>,</span><span class=mi>3</span><span class=w></span>
<span class=w>  </span><span class=n>Marks</span><span class=w> </span><span class=nl>numbers</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=w>      </span><span class=mi>1</span><span class=w>      </span><span class=mi>2</span><span class=w>      </span><span class=mi>3</span><span class=w>      </span><span class=mi>4</span><span class=w>      </span><span class=mi>5</span><span class=w>      </span><span class=mi>6</span><span class=w>      </span><span class=mi>7</span><span class=w>      </span><span class=mi>8</span><span class=w>      </span><span class=mi>9</span><span class=w>      </span><span class=mi>10</span><span class=w></span>
</code></pre></div> <p>If the data query specifies:</p> <ul> <li><code class=syntax>CounterID in ('a', 'h')</code>, the server reads the data in the ranges of marks <code class=syntax>[0, 3)</code> and <code class=syntax>[6, 8)</code>.</li> <li><code class=syntax>CounterID IN ('a', 'h') AND Date = 3</code>, the server reads the data in the ranges of marks <code class=syntax>[1, 3)</code> and <code class=syntax>[7, 8)</code>.</li> <li><code class=syntax>Date = 3</code>, the server reads the data in the range of marks <code class=syntax>[1, 10]</code>.</li> </ul> <p>The examples above show that it is always more effective to use an index than a full scan.</p> <p>A sparse index allows extra data to be read. When reading a single range of the primary key, up to <code class=syntax>index_granularity * 2</code> extra rows in each data block can be read.</p> <p>Sparse indexes allow you to work with a very large number of table rows, because in most cases, such indexes fit in the computer’s RAM.</p> <p>ClickHouse does not require a unique primary key. You can insert multiple rows with the same primary key.</p> <p>You can use <code class=syntax>Nullable</code>-typed expressions in the <code class=syntax>PRIMARY KEY</code> and <code class=syntax>ORDER BY</code> clauses but it is strongly discouraged. To allow this feature, turn on the <a href=../../../../../operations/settings/settings/amp/#allow-nullable-key>allow_nullable_key</a> setting. The <a href=../../../../../sql-reference/statements/select/order-by/amp/#sorting-of-special-values>NULLS_LAST</a> principle applies for <code class=syntax>NULL</code> values in the <code class=syntax>ORDER BY</code> clause.</p> <h3 id=selecting-the-primary-key>Selecting the Primary Key<a class=headerlink href=../amp/#selecting-the-primary-key title="Permanent link"> </a></h3> <p>The number of columns in the primary key is not explicitly limited. Depending on the data structure, you can include more or fewer columns in the primary key. This may:</p> <ul> <li> <p>Improve the performance of an index.</p> <p>If the primary key is <code class=syntax>(a, b)</code>, then adding another column <code class=syntax>c</code> will improve the performance if the following conditions are met:</p> <ul> <li>There are queries with a condition on column <code class=syntax>c</code>.</li> <li>Long data ranges (several times longer than the <code class=syntax>index_granularity</code>) with identical values for <code class=syntax>(a, b)</code> are common. In other words, when adding another column allows you to skip quite long data ranges.</li> </ul> </li> <li> <p>Improve data compression.</p> <p>ClickHouse sorts data by primary key, so the higher the consistency, the better the compression.</p> </li> <li> <p>Provide additional logic when merging data parts in the <a href=../../collapsingmergetree/amp/#table_engine-collapsingmergetree>CollapsingMergeTree</a> and <a href=../../summingmergetree/amp/ >SummingMergeTree</a> engines.</p> <p>In this case it makes sense to specify the <em>sorting key</em> that is different from the primary key.</p> </li> </ul> <p>A long primary key will negatively affect the insert performance and memory consumption, but extra columns in the primary key do not affect ClickHouse performance during <code class=syntax>SELECT</code> queries.</p> <p>You can create a table without a primary key using the <code class=syntax>ORDER BY tuple()</code> syntax. In this case, ClickHouse stores data in the order of inserting. If you want to save data order when inserting data by <code class=syntax>INSERT ... SELECT</code> queries, set <a href=../../../../../operations/settings/settings/amp/#settings-max-insert-threads>max_insert_threads = 1</a>.</p> <p>To select data in the initial order, use <a href=../../../../../operations/settings/settings/amp/#settings-max_threads>single-threaded</a> <code class=syntax>SELECT</code> queries.</p> <h3 id=choosing-a-primary-key-that-differs-from-the-sorting-key>Choosing a Primary Key that Differs from the Sorting Key<a class=headerlink href=../amp/#choosing-a-primary-key-that-differs-from-the-sorting-key title="Permanent link"> </a></h3> <p>It is possible to specify a primary key (an expression with values that are written in the index file for each mark) that is different from the sorting key (an expression for sorting the rows in data parts). In this case the primary key expression tuple must be a prefix of the sorting key expression tuple.</p> <p>This feature is helpful when using the <a href=../../summingmergetree/amp/ >SummingMergeTree</a> and<br> <a href=../../aggregatingmergetree/amp/ >AggregatingMergeTree</a> table engines. In a common case when using these engines, the table has two types of columns: <em>dimensions</em> and <em>measures</em>. Typical queries aggregate values of measure columns with arbitrary <code class=syntax>GROUP BY</code> and filtering by dimensions. Because SummingMergeTree and AggregatingMergeTree aggregate rows with the same value of the sorting key, it is natural to add all dimensions to it. As a result, the key expression consists of a long list of columns and this list must be frequently updated with newly added dimensions.</p> <p>In this case it makes sense to leave only a few columns in the primary key that will provide efficient range scans and add the remaining dimension columns to the sorting key tuple.</p> <p><a href=../../../../../sql-reference/statements/alter/amp/ >ALTER</a> of the sorting key is a lightweight operation because when a new column is simultaneously added to the table and to the sorting key, existing data parts do not need to be changed. Since the old sorting key is a prefix of the new sorting key and there is no data in the newly added column, the data is sorted by both the old and new sorting keys at the moment of table modification.</p> <h3 id=use-of-indexes-and-partitions-in-queries>Use of Indexes and Partitions in Queries<a class=headerlink href=../amp/#use-of-indexes-and-partitions-in-queries title="Permanent link"> </a></h3> <p>For <code class=syntax>SELECT</code> queries, ClickHouse analyzes whether an index can be used. An index can be used if the <code class=syntax>WHERE/PREWHERE</code> clause has an expression (as one of the conjunction elements, or entirely) that represents an equality or inequality comparison operation, or if it has <code class=syntax>IN</code> or <code class=syntax>LIKE</code> with a fixed prefix on columns or expressions that are in the primary key or partitioning key, or on certain partially repetitive functions of these columns, or logical relationships of these expressions.</p> <p>Thus, it is possible to quickly run queries on one or many ranges of the primary key. In this example, queries will be fast when run for a specific tracking tag, for a specific tag and date range, for a specific tag and date, for multiple tags with a date range, and so on.</p> <p>Let’s look at the engine configured as follows:</p> <div class=codehilite><pre><span></span><code class=syntax>  ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate) SETTINGS index_granularity=8192
</code></pre></div> <p>In this case, in queries:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=p>((</span><span class=n>EventDate</span> <span class=o>&gt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-01'</span><span class=p>)</span> <span class=k>AND</span> <span class=n>EventDate</span> <span class=o>&lt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-31'</span><span class=p>))</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=k>IN</span> <span class=p>(</span><span class=mi>101500</span><span class=p>,</span> <span class=mi>731962</span><span class=p>,</span> <span class=mi>160656</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>101500</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>!=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span>
</code></pre></div> <p>ClickHouse will use the primary key index to trim improper data and the monthly partitioning key to trim partitions that are in improper date ranges.</p> <p>The queries above show that the index is used even for complex expressions. Reading from the table is organized so that using the index can’t be slower than a full scan.</p> <p>In the example below, the index can’t be used.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>URL</span> <span class=k>LIKE</span> <span class=s1>'%upyachka%'</span>
</code></pre></div> <p>To check whether ClickHouse can use the index when running a query, use the settings <a href=../../../../../operations/settings/settings/amp/#settings-force_index_by_date>force_index_by_date</a> and <a href=../../../../../operations/settings/settings/amp/ >force_primary_key</a>.</p> <p>The key for partitioning by month allows reading only those data blocks which contain dates from the proper range. In this case, the data block may contain data for many dates (up to an entire month). Within a block, data is sorted by primary key, which might not contain the date as the first column. Because of this, using a query with only a date condition that does not specify the primary key prefix will cause more data to be read than for a single date.</p> <h3 id=use-of-index-for-partially-monotonic-primary-keys>Use of Index for Partially-monotonic Primary Keys<a class=headerlink href=../amp/#use-of-index-for-partially-monotonic-primary-keys title="Permanent link"> </a></h3> <p>Consider, for example, the days of the month. They form a <a href=https://en.wikipedia.org/wiki/Monotonic_function rel="external nofollow noreferrer" target=_blank>monotonic sequence</a> for one month, but not monotonic for more extended periods. This is a partially-monotonic sequence. If a user creates the table with partially-monotonic primary key, ClickHouse creates a sparse index as usual. When a user selects data from this kind of table, ClickHouse analyzes the query conditions. If the user wants to get data between two marks of the index and both these marks fall within one month, ClickHouse can use the index in this particular case because it can calculate the distance between the parameters of a query and index marks.</p> <p>ClickHouse cannot use an index if the values of the primary key in the query parameter range do not represent a monotonic sequence. In this case, ClickHouse uses the full scan method.</p> <p>ClickHouse uses this logic not only for days of the month sequences, but for any primary key that represents a partially-monotonic sequence.</p> <h3 id=table_engine-mergetree-data_skipping-indexes>Data Skipping Indexes<a class=headerlink href=../amp/#table_engine-mergetree-data_skipping-indexes title="Permanent link"> </a></h3> <p>The index declaration is in the columns section of the <code class=syntax>CREATE</code> query.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>index_name</span> <span class=n>expr</span> <span class=k>TYPE</span> <span class=k>type</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>granularity_value</span>
</code></pre></div> <p>For tables from the <code class=syntax>*MergeTree</code> family, data skipping indices can be specified.</p> <p>These indices aggregate some information about the specified expression on blocks, which consist of <code class=syntax>granularity_value</code> granules (the size of the granule is specified using the <code class=syntax>index_granularity</code> setting in the table engine). Then these aggregates are used in <code class=syntax>SELECT</code> queries for reducing the amount of data to read from the disk by skipping big blocks of data where the <code class=syntax>where</code> query cannot be satisfied.</p> <p><strong>Example</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>table_name</span>
<span class=p>(</span>
    <span class=n>u64</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>i32</span> <span class=n>Int32</span><span class=p>,</span>
    <span class=n>s</span> <span class=n>String</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>a</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>3</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>...</span>
</code></pre></div> <p>Indices from the example can be used by ClickHouse to reduce the amount of data to read from disk in the following queries:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=s1>'z'</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span> <span class=o>==</span> <span class=mi>10</span> <span class=k>AND</span> <span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1234</span>
</code></pre></div> <h4 id=available-types-of-indices>Available Types of Indices<a class=headerlink href=../amp/#available-types-of-indices title="Permanent link"> </a></h4> <ul> <li> <p><code class=syntax>minmax</code></p> <p>Stores extremes of the specified expression (if the expression is <code class=syntax>tuple</code>, then it stores extremes for each element of <code class=syntax>tuple</code>), uses stored info for skipping blocks of data like the primary key.</p> </li> <li> <p><code class=syntax>set(max_rows)</code></p> <p>Stores unique values of the specified expression (no more than <code class=syntax>max_rows</code> rows, <code class=syntax>max_rows=0</code> means “no limits”). Uses the values to check if the <code class=syntax>WHERE</code> expression is not satisfiable on a block of data.</p> </li> <li> <p><code class=syntax>ngrambf_v1(n, size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>Stores a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>Bloom filter</a> that contains all ngrams from a block of data. Works only with strings. Can be used for optimization of <code class=syntax>equals</code>, <code class=syntax>like</code> and <code class=syntax>in</code> expressions.</p> <ul> <li><code class=syntax>n</code> — ngram size,</li> <li><code class=syntax>size_of_bloom_filter_in_bytes</code> — Bloom filter size in bytes (you can use large values here, for example, 256 or 512, because it can be compressed well).</li> <li><code class=syntax>number_of_hash_functions</code> — The number of hash functions used in the Bloom filter.</li> <li><code class=syntax>random_seed</code> — The seed for Bloom filter hash functions.</li> </ul> </li> <li> <p><code class=syntax>tokenbf_v1(size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>The same as <code class=syntax>ngrambf_v1</code>, but stores tokens instead of ngrams. Tokens are sequences separated by non-alphanumeric characters.</p> </li> <li> <p><code class=syntax>bloom_filter([false_positive])</code> — Stores a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>Bloom filter</a> for the specified columns.</p> <p>The optional <code class=syntax>false_positive</code> parameter is the probability of receiving a false positive response from the filter. Possible values: (0, 1). Default value: 0.025.</p> <p>Supported data types: <code class=syntax>Int*</code>, <code class=syntax>UInt*</code>, <code class=syntax>Float*</code>, <code class=syntax>Enum</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code>, <code class=syntax>FixedString</code>, <code class=syntax>Array</code>, <code class=syntax>LowCardinality</code>, <code class=syntax>Nullable</code>, <code class=syntax>UUID</code>, <code class=syntax>Map</code>.</p> <p>For <code class=syntax>Map</code> data type client can specify if index should be created for keys or values using <a href=../../../../../sql-reference/functions/tuple-map-functions/amp/#mapkeys>mapKeys</a> or <a href=../../../../../sql-reference/functions/tuple-map-functions/amp/#mapvalues>mapValues</a> function.</p> <p>Example of index creation for <code class=syntax>Map</code> data type</p> </li> </ul> <div class=codehilite><pre><span></span><code class=syntax>INDEX map_key_index mapKeys(map_column) TYPE bloom_filter GRANULARITY 1
INDEX map_key_index mapValues(map_column) TYPE bloom_filter GRANULARITY 1
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>The</span><span class=w> </span><span class=n>following</span><span class=w> </span><span class=n>functions</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=k>use</span><span class=w> </span><span class=nl>it</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>equals</span><span class=o>]</span><span class=p>(..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=k>sql</span><span class=o>-</span><span class=n>reference</span><span class=o>/</span><span class=n>functions</span><span class=o>/</span><span class=n>comparison</span><span class=o>-</span><span class=n>functions</span><span class=p>.</span><span class=n>md</span><span class=p>),</span><span class=w> </span><span class=o>[</span><span class=n>notEquals</span><span class=o>]</span><span class=p>(..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=k>sql</span><span class=o>-</span><span class=n>reference</span><span class=o>/</span><span class=n>functions</span><span class=o>/</span><span class=n>comparison</span><span class=o>-</span><span class=n>functions</span><span class=p>.</span><span class=n>md</span><span class=p>),</span><span class=w> </span><span class=o>[</span><span class=n>in</span><span class=o>]</span><span class=p>(..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=k>sql</span><span class=o>-</span><span class=n>reference</span><span class=o>/</span><span class=n>functions</span><span class=o>/</span><span class=ow>in</span><span class=o>-</span><span class=n>functions</span><span class=p>.</span><span class=n>md</span><span class=p>),</span><span class=w> </span><span class=o>[</span><span class=n>notIn</span><span class=o>]</span><span class=p>(..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=k>sql</span><span class=o>-</span><span class=n>reference</span><span class=o>/</span><span class=n>functions</span><span class=o>/</span><span class=ow>in</span><span class=o>-</span><span class=n>functions</span><span class=p>.</span><span class=n>md</span><span class=p>),</span><span class=w> </span><span class=o>[</span><span class=n>has</span><span class=o>]</span><span class=p>(..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=p>..</span><span class=o>/</span><span class=k>sql</span><span class=o>-</span><span class=n>reference</span><span class=o>/</span><span class=n>functions</span><span class=o>/</span><span class=k>array</span><span class=o>-</span><span class=n>functions</span><span class=p>.</span><span class=n>md</span><span class=p>).</span><span class=w></span>
</code></pre></div> <!-- --> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>sample_index</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index2</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index3</span> <span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>ngrambf_v1</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
</code></pre></div> <h4 id=functions-support>Functions Support<a class=headerlink href=../amp/#functions-support title="Permanent link"> </a></h4> <p>Conditions in the <code class=syntax>WHERE</code> clause contains calls of the functions that operate with columns. If the column is a part of an index, ClickHouse tries to use this index when performing the functions. ClickHouse supports different subsets of functions for using indexes.</p> <p>The <code class=syntax>set</code> index can be used with all functions. Function subsets for other indexes are shown in the table below.</p> <table> <thead> <tr> <th>Function (operator) / Index</th> <th>primary key</th> <th>minmax</th> <th>ngrambf_v1</th> <th>tokenbf_v1</th> <th>bloom_filter</th> </tr> </thead> <tbody> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-equals>equals (=, ==)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-notequals>notEquals(!=, &lt;&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-like>like</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-notlike>notLike</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-functions/amp/#startswith>startsWith</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-functions/amp/#endswith>endsWith</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-multisearchany>multiSearchAny</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/in-functions/amp/#in-functions>in</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/in-functions/amp/#in-functions>notIn</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-less>less (&lt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-greater>greater (&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-lessorequals>lessOrEquals (&lt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-greaterorequals>greaterOrEquals (&gt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/array-functions/amp/#function-empty>empty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/array-functions/amp/#function-notempty>notEmpty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td>hasToken</td> <td>✗</td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> </tr> </tbody> </table> <p>Functions with a constant argument that is less than ngram size can’t be used by <code class=syntax>ngrambf_v1</code> for query optimization.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Note</p> <p>Bloom filters can have false positive matches, so the <code class=syntax>ngrambf_v1</code>, <code class=syntax>tokenbf_v1</code>, and <code class=syntax>bloom_filter</code> indexes can’t be used for optimizing queries where the result of a function is expected to be false, for example:</p> </div> <ul> <li>Can be optimized:<ul> <li><code class=syntax>s LIKE '%test%'</code></li> <li><code class=syntax>NOT s NOT LIKE '%test%'</code></li> <li><code class=syntax>s = 1</code></li> <li><code class=syntax>NOT s != 1</code></li> <li><code class=syntax>startsWith(s, 'test')</code></li> </ul> </li> <li>Can’t be optimized:<ul> <li><code class=syntax>NOT s LIKE '%test%'</code></li> <li><code class=syntax>s NOT LIKE '%test%'</code></li> <li><code class=syntax>NOT s = 1</code></li> <li><code class=syntax>s != 1</code></li> <li><code class=syntax>NOT startsWith(s, 'test')</code></li> </ul> </li> </ul> <h2 id=projections>Projections<a class=headerlink href=../amp/#projections title="Permanent link"> </a></h2> <p>Projections are like <a href=../../../../../sql-reference/statements/create/view/amp/#materialized>materialized views</a> but defined in part-level. It provides consistency guarantees along with automatic usage in queries.</p> <p>Projections are an experimental feature. To enable them you must set the <a href=../../../../../operations/settings/settings/amp/#allow-experimental-projection-optimization>allow_experimental_projection_optimization</a> to <code class=syntax>1</code>. See also the <a href=../../../../../operations/settings/settings/amp/#force-optimize-projection>force_optimize_projection</a> setting.</p> <p>Projections are not supported in the <code class=syntax>SELECT</code> statements with the <a href=../../../../../sql-reference/statements/select/from/amp/#select-from-final>FINAL</a> modifier.</p> <h3 id=projection-query>Projection Query<a class=headerlink href=../amp/#projection-query title="Permanent link"> </a></h3> <p>A projection query is what defines a projection. It implicitly selects data from the parent table.<br> <strong>Syntax</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=o>&lt;</span><span class=k>column</span> <span class=n>list</span> <span class=n>expr</span><span class=o>&gt;</span> <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span><span class=p>]</span> <span class=o>&lt;</span><span class=k>group</span> <span class=n>keys</span> <span class=n>expr</span><span class=o>&gt;</span> <span class=p>[</span><span class=k>ORDER</span> <span class=k>BY</span><span class=p>]</span> <span class=o>&lt;</span><span class=n>expr</span><span class=o>&gt;</span>
</code></pre></div> <p>Projections can be modified or dropped with the <a href=../../../../../sql-reference/statements/alter/projection/amp/ >ALTER</a> statement.</p> <h3 id=projection-storage>Projection Storage<a class=headerlink href=../amp/#projection-storage title="Permanent link"> </a></h3> <p>Projections are stored inside the part directory. It's similar to an index but contains a subdirectory that stores an anonymous <code class=syntax>MergeTree</code> table's part. The table is induced by the definition query of the projection. If there is a <code class=syntax>GROUP BY</code> clause, the underlying storage engine becomes <a href=../../aggregatingmergetree/amp/ >AggregatingMergeTree</a>, and all aggregate functions are converted to <code class=syntax>AggregateFunction</code>. If there is an <code class=syntax>ORDER BY</code> clause, the <code class=syntax>MergeTree</code> table uses it as its primary key expression. During the merge process the projection part is merged via its storage's merge routine. The checksum of the parent table's part is combined with the projection's part. Other maintenance jobs are similar to skip indices.</p> <h3 id=projection-query-analysis>Query Analysis<a class=headerlink href=../amp/#projection-query-analysis title="Permanent link"> </a></h3> <ol> <li>Check if the projection can be used to answer the given query, that is, it generates the same answer as querying the base table.</li> <li>Select the best feasible match, which contains the least granules to read.</li> <li>The query pipeline which uses projections will be different from the one that uses the original parts. If the projection is absent in some parts, we can add the pipeline to "project" it on the fly.</li> </ol> <h2 id=concurrent-data-access>Concurrent Data Access<a class=headerlink href=../amp/#concurrent-data-access title="Permanent link"> </a></h2> <p>For concurrent table access, we use multi-versioning. In other words, when a table is simultaneously read and updated, data is read from a set of parts that is current at the time of the query. There are no lengthy locks. Inserts do not get in the way of read operations.</p> <p>Reading from a table is automatically parallelized.</p> <h2 id=table_engine-mergetree-ttl>TTL for Columns and Tables<a class=headerlink href=../amp/#table_engine-mergetree-ttl title="Permanent link"> </a></h2> <p>Determines the lifetime of values.</p> <p>The <code class=syntax>TTL</code> clause can be set for the whole table and for each individual column. Table-level <code class=syntax>TTL</code> can also specify the logic of automatic moving data between disks and volumes, or recompressing parts where all the data has been expired.</p> <p>Expressions must evaluate to <a href=../../../../../sql-reference/data-types/date/amp/ >Date</a> or <a href=../../../../../sql-reference/data-types/datetime/amp/ >DateTime</a> data type.</p> <p><strong>Syntax</strong></p> <p>Setting time-to-live for a column:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>time_column</span>
<span class=n>TTL</span> <span class=n>time_column</span> <span class=o>+</span> <span class=nb>interval</span>
</code></pre></div> <p>To define <code class=syntax>interval</code>, use <a href=../../../../../sql-reference/operators/amp/#operators-datetime>time interval</a> operators, for example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span>
<span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>15</span> <span class=n>HOUR</span>
</code></pre></div> <h3 id=mergetree-column-ttl>Column TTL<a class=headerlink href=../amp/#mergetree-column-ttl title="Permanent link"> </a></h3> <p>When the values in the column expire, ClickHouse replaces them with the default values for the column data type. If all the column values in the data part expire, ClickHouse deletes this column from the data part in a filesystem.</p> <p>The <code class=syntax>TTL</code> clause can’t be used for key columns.</p> <p><strong>Examples</strong></p> <p>Creating a table with <code class=syntax>TTL</code>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=n>b</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=k>c</span> <span class=n>String</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span><span class=p>;</span>
</code></pre></div> <p>Adding TTL to a column of an existing table</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Altering TTL of the column</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>;</span>
</code></pre></div> <h3 id=mergetree-table-ttl>Table TTL<a class=headerlink href=../amp/#mergetree-table-ttl title="Permanent link"> </a></h3> <p>Table can have an expression for removal of expired rows, and multiple expressions for automatic move of parts between <a href=../amp/#table_engine-mergetree-multiple-volumes>disks or volumes</a>. When rows in the table expire, ClickHouse deletes all corresponding rows. For parts moving or recompressing, all rows of a part must satisfy the <code class=syntax>TTL</code> expression criteria.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>expr</span>
    <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=n>RECOMPRESS</span> <span class=n>codec_name1</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'xxx'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'xxx'</span><span class=p>][,</span> <span class=k>DELETE</span><span class=o>|</span><span class=n>RECOMPRESS</span> <span class=n>codec_name2</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'aaa'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'bbb'</span><span class=p>]</span> <span class=p>...</span>
    <span class=p>[</span><span class=k>WHERE</span> <span class=n>conditions</span><span class=p>]</span>
    <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span> <span class=n>key_expr</span> <span class=p>[</span><span class=k>SET</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v1</span><span class=p>)</span> <span class=p>[,</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span> <span class=p>...]]</span> <span class=p>]</span>
</code></pre></div> <p>Type of TTL rule may follow each TTL expression. It affects an action which is to be done once the expression is satisfied (reaches current time):</p> <ul> <li><code class=syntax>DELETE</code> - delete expired rows (default action);</li> <li><code class=syntax>RECOMPRESS codec_name</code> - recompress data part with the <code class=syntax>codec_name</code>;</li> <li><code class=syntax>TO DISK 'aaa'</code> - move part to the disk <code class=syntax>aaa</code>;</li> <li><code class=syntax>TO VOLUME 'bbb'</code> - move part to the disk <code class=syntax>bbb</code>;</li> <li><code class=syntax>GROUP BY</code> - aggregate expired rows.</li> </ul> <p>With <code class=syntax>WHERE</code> clause you may specify which of the expired rows to delete or aggregate (it cannot be applied to moves or recompression).</p> <p><code class=syntax>GROUP BY</code> expression must be a prefix of the table primary key.</p> <p>If a column is not part of the <code class=syntax>GROUP BY</code> expression and is not set explicitly in the <code class=syntax>SET</code> clause, in result row it contains an occasional value from the grouped rows (as if aggregate function <code class=syntax>any</code> is applied to it).</p> <p><strong>Examples</strong></p> <p>Creating a table with <code class=syntax>TTL</code>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=p>[</span><span class=k>DELETE</span><span class=p>],</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'aaa'</span><span class=p>,</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>2</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'bbb'</span><span class=p>;</span>
</code></pre></div> <p>Altering <code class=syntax>TTL</code> of the table:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Creating a table, where the rows are expired after one month. The expired rows where dates are Mondays are deleted:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_with_where</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=k>DELETE</span> <span class=k>WHERE</span> <span class=n>toDayOfWeek</span><span class=p>(</span><span class=n>d</span><span class=p>)</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</code></pre></div> <p>Creating a table, where expired rows are recompressed:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_for_recompression</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=k>key</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>value</span> <span class=n>String</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>tuple</span><span class=p>()</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=k>key</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=n>RECOMPRESS</span> <span class=n>CODEC</span><span class=p>(</span><span class=n>ZSTD</span><span class=p>(</span><span class=mi>17</span><span class=p>)),</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>YEAR</span> <span class=n>RECOMPRESS</span> <span class=n>CODEC</span><span class=p>(</span><span class=n>LZ4HC</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
<span class=n>SETTINGS</span> <span class=n>min_rows_for_wide_part</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>min_bytes_for_wide_part</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</code></pre></div> <p>Creating a table, where expired rows are aggregated. In result rows <code class=syntax>x</code> contains the maximum value accross the grouped rows, <code class=syntax>y</code> — the minimum value, and <code class=syntax>d</code> — any occasional value from grouped rows.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_for_aggregation</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>k1</span> <span class=nb>Int</span><span class=p>,</span>
    <span class=n>k2</span> <span class=nb>Int</span><span class=p>,</span>
    <span class=n>x</span> <span class=nb>Int</span><span class=p>,</span>
    <span class=n>y</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>k1</span><span class=p>,</span> <span class=n>k2</span><span class=p>)</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>k1</span><span class=p>,</span> <span class=n>k2</span> <span class=k>SET</span> <span class=n>x</span> <span class=o>=</span> <span class=k>max</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>y</span> <span class=o>=</span> <span class=k>min</span><span class=p>(</span><span class=n>y</span><span class=p>);</span>
</code></pre></div> <h3 id=mergetree-removing-expired-data>Removing Expired Data<a class=headerlink href=../amp/#mergetree-removing-expired-data title="Permanent link"> </a></h3> <p>Data with an expired <code class=syntax>TTL</code> is removed when ClickHouse merges data parts.</p> <p>When ClickHouse detects that data is expired, it performs an off-schedule merge. To control the frequency of such merges, you can set <code class=syntax>merge_with_ttl_timeout</code>. If the value is too low, it will perform many off-schedule merges that may consume a lot of resources.</p> <p>If you perform the <code class=syntax>SELECT</code> query between merges, you may get expired data. To avoid it, use the <a href=../../../../../sql-reference/statements/optimize/amp/ >OPTIMIZE</a> query before <code class=syntax>SELECT</code>.</p> <p><strong>See Also</strong></p> <ul> <li><a href=../../../../../operations/settings/settings/amp/#ttl_only_drop_parts>ttl_only_drop_parts</a> setting</li> </ul> <h2 id=table_engine-mergetree-multiple-volumes>Using Multiple Block Devices for Data Storage<a class=headerlink href=../amp/#table_engine-mergetree-multiple-volumes title="Permanent link"> </a></h2> <h3 id=introduction>Introduction<a class=headerlink href=../amp/#introduction title="Permanent link"> </a></h3> <p><code class=syntax>MergeTree</code> family table engines can store data on multiple block devices. For example, it can be useful when the data of a certain table are implicitly split into “hot” and “cold”. The most recent data is regularly requested but requires only a small amount of space. On the contrary, the fat-tailed historical data is requested rarely. If several disks are available, the “hot” data may be located on fast disks (for example, NVMe SSDs or in memory), while the “cold” data - on relatively slow ones (for example, HDD).</p> <p>Data part is the minimum movable unit for <code class=syntax>MergeTree</code>-engine tables. The data belonging to one part are stored on one disk. Data parts can be moved between disks in the background (according to user settings) as well as by means of the <a href=../../../../../sql-reference/statements/alter/partition/amp/#alter_move-partition>ALTER</a> queries.</p> <h3 id=terms>Terms<a class=headerlink href=../amp/#terms title="Permanent link"> </a></h3> <ul> <li>Disk — Block device mounted to the filesystem.</li> <li>Default disk — Disk that stores the path specified in the <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server_configuration_parameters-path>path</a> server setting.</li> <li>Volume — Ordered set of equal disks (similar to <a href=https://en.wikipedia.org/wiki/Non-RAID_drive_architectures rel="external nofollow noreferrer" target=_blank>JBOD</a>).</li> <li>Storage policy — Set of volumes and the rules for moving data between them.</li> </ul> <p>The names given to the described entities can be found in the system tables, <a href=../../../../../operations/system-tables/storage_policies/amp/#system_tables-storage_policies>system.storage_policies</a> and <a href=../../../../../operations/system-tables/disks/amp/#system_tables-disks>system.disks</a>. To apply one of the configured storage policies for a table, use the <code class=syntax>storage_policy</code> setting of <code class=syntax>MergeTree</code>-engine family tables.</p> <h3 id=table_engine-mergetree-multiple-volumes_configure>Configuration<a class=headerlink href=../amp/#table_engine-mergetree-multiple-volumes_configure title="Permanent link"> </a></h3> <p>Disks, volumes and storage policies should be declared inside the <code class=syntax>&lt;storage_configuration&gt;</code> tag either in the main file <code class=syntax>config.xml</code> or in a distinct file in the <code class=syntax>config.d</code> directory.</p> <p>Configuration structure:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;disk_name_1&gt;</span> <span class=c>&lt;!-- disk name --&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/fast_ssd/clickhouse/<span class=nt>&lt;/path&gt;</span>
        <span class=nt>&lt;/disk_name_1&gt;</span>
        <span class=nt>&lt;disk_name_2&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd1/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_2&gt;</span>
        <span class=nt>&lt;disk_name_3&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd2/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_3&gt;</span>

        ...
    <span class=nt>&lt;/disks&gt;</span>

    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Tags:</p> <ul> <li><code class=syntax>&lt;disk_name_N&gt;</code> — Disk name. Names must be different for all disks.</li> <li><code class=syntax>path</code> — path under which a server will store data (<code class=syntax>data</code> and <code class=syntax>shadow</code> folders), should be terminated with ‘/’.</li> <li><code class=syntax>keep_free_space_bytes</code> — the amount of free disk space to be reserved.</li> </ul> <p>The order of the disk definition is not important.</p> <p>Storage policies configuration markup:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;policy_name_1&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;volume_name_1&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk_name_from_disks_configuration<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/volume_name_1&gt;</span>
                <span class=nt>&lt;volume_name_2&gt;</span>
                    <span class=c>&lt;!-- configuration --&gt;</span>
                <span class=nt>&lt;/volume_name_2&gt;</span>
                <span class=c>&lt;!-- more volumes --&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/policy_name_1&gt;</span>
        <span class=nt>&lt;policy_name_2&gt;</span>
            <span class=c>&lt;!-- configuration --&gt;</span>
        <span class=nt>&lt;/policy_name_2&gt;</span>

        <span class=c>&lt;!-- more policies --&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Tags:</p> <ul> <li><code class=syntax>policy_name_N</code> — Policy name. Policy names must be unique.</li> <li><code class=syntax>volume_name_N</code> — Volume name. Volume names must be unique.</li> <li><code class=syntax>disk</code> — a disk within a volume.</li> <li><code class=syntax>max_data_part_size_bytes</code> — the maximum size of a part that can be stored on any of the volume’s disks.</li> <li><code class=syntax>move_factor</code> — when the amount of available space gets lower than this factor, data automatically start to move on the next volume if any (by default, 0.1).</li> <li><code class=syntax>prefer_not_to_merge</code> — Disables merging of data parts on this volume. When this setting is enabled, merging data on this volume is not allowed. This allows controlling how ClickHouse works with slow disks.</li> </ul> <p>Cofiguration examples:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;hdd_in_order&gt;</span> <span class=c>&lt;!-- policy name --&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;single&gt;</span> <span class=c>&lt;!-- volume name --&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk2<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/single&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/hdd_in_order&gt;</span>

        <span class=nt>&lt;moving_from_ssd_to_hdd&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;hot&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>fast_ssd<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/hot&gt;</span>
                <span class=nt>&lt;cold&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/cold&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/moving_from_ssd_to_hdd&gt;</span>

        <span class=nt>&lt;small_jbod_with_external_no_merges&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;main&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>jbod1<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/main&gt;</span>
                <span class=nt>&lt;external&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>external<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;prefer_not_to_merge&gt;</span>true<span class=nt>&lt;/prefer_not_to_merge&gt;</span>
                <span class=nt>&lt;/external&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/small_jbod_with_external_no_merges&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>In given example, the <code class=syntax>hdd_in_order</code> policy implements the <a href=https://en.wikipedia.org/wiki/Round-robin_scheduling rel="external nofollow noreferrer" target=_blank>round-robin</a> approach. Thus this policy defines only one volume (<code class=syntax>single</code>), the data parts are stored on all its disks in circular order. Such policy can be quite useful if there are several similar disks are mounted to the system, but RAID is not configured. Keep in mind that each individual disk drive is not reliable and you might want to compensate it with replication factor of 3 or more.</p> <p>If there are different kinds of disks available in the system, <code class=syntax>moving_from_ssd_to_hdd</code> policy can be used instead. The volume <code class=syntax>hot</code> consists of an SSD disk (<code class=syntax>fast_ssd</code>), and the maximum size of a part that can be stored on this volume is 1GB. All the parts with the size larger than 1GB will be stored directly on the <code class=syntax>cold</code> volume, which contains an HDD disk <code class=syntax>disk1</code>.<br> Also, once the disk <code class=syntax>fast_ssd</code> gets filled by more than 80%, data will be transferred to the <code class=syntax>disk1</code> by a background process.</p> <p>The order of volume enumeration within a storage policy is important. Once a volume is overfilled, data are moved to the next one. The order of disk enumeration is important as well because data are stored on them in turns.</p> <p>When creating a table, one can apply one of the configured storage policies to it:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_with_non_default_policy</span> <span class=p>(</span>
    <span class=n>EventDate</span> <span class=nb>Date</span><span class=p>,</span>
    <span class=n>OrderID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>BannerID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>SearchPhrase</span> <span class=n>String</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>OrderID</span><span class=p>,</span> <span class=n>BannerID</span><span class=p>)</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span>
<span class=n>SETTINGS</span> <span class=n>storage_policy</span> <span class=o>=</span> <span class=s1>'moving_from_ssd_to_hdd'</span>
</code></pre></div> <p>The <code class=syntax>default</code> storage policy implies using only one volume, which consists of only one disk given in <code class=syntax>&lt;path&gt;</code>.<br> You could change storage policy after table creation with [ALTER TABLE ... MODIFY SETTING] query, new policy should include all old disks and volumes with same names.</p> <p>The number of threads performing background moves of data parts can be changed by <a href=../../../../../operations/settings/settings/amp/#background_move_pool_size>background_move_pool_size</a> setting.</p> <h3 id=details>Details<a class=headerlink href=../amp/#details title="Permanent link"> </a></h3> <p>In the case of <code class=syntax>MergeTree</code> tables, data is getting to disk in different ways:</p> <ul> <li>As a result of an insert (<code class=syntax>INSERT</code> query).</li> <li>During background merges and <a href=../../../../../sql-reference/statements/alter/amp/#alter-mutations>mutations</a>.</li> <li>When downloading from another replica.</li> <li>As a result of partition freezing <a href=../../../../../sql-reference/statements/alter/partition/amp/#alter_freeze-partition>ALTER TABLE … FREEZE PARTITION</a>.</li> </ul> <p>In all these cases except for mutations and partition freezing, a part is stored on a volume and a disk according to the given storage policy:</p> <ol> <li>The first volume (in the order of definition) that has enough disk space for storing a part (<code class=syntax>unreserved_space &gt; current_part_size</code>) and allows for storing parts of a given size (<code class=syntax>max_data_part_size_bytes &gt; current_part_size</code>) is chosen.</li> <li>Within this volume, that disk is chosen that follows the one, which was used for storing the previous chunk of data, and that has free space more than the part size (<code class=syntax>unreserved_space - keep_free_space_bytes &gt; current_part_size</code>).</li> </ol> <p>Under the hood, mutations and partition freezing make use of <a href=https://en.wikipedia.org/wiki/Hard_link rel="external nofollow noreferrer" target=_blank>hard links</a>. Hard links between different disks are not supported, therefore in such cases the resulting parts are stored on the same disks as the initial ones.</p> <p>In the background, parts are moved between volumes on the basis of the amount of free space (<code class=syntax>move_factor</code> parameter) according to the order the volumes are declared in the configuration file.<br> Data is never transferred from the last one and into the first one. One may use system tables <a href=../../../../../operations/system-tables/part_log/amp/#system_tables-part-log>system.part_log</a> (field <code class=syntax>type = MOVE_PART</code>) and <a href=../../../../../operations/system-tables/parts/amp/#system_tables-parts>system.parts</a> (fields <code class=syntax>path</code> and <code class=syntax>disk</code>) to monitor background moves. Also, the detailed information can be found in server logs.</p> <p>User can force moving a part or a partition from one volume to another using the query <a href=../../../../../sql-reference/statements/alter/partition/amp/#alter_move-partition>ALTER TABLE … MOVE PART|PARTITION … TO VOLUME|DISK …</a>, all the restrictions for background operations are taken into account. The query initiates a move on its own and does not wait for background operations to be completed. User will get an error message if not enough free space is available or if any of the required conditions are not met.</p> <p>Moving data does not interfere with data replication. Therefore, different storage policies can be specified for the same table on different replicas.</p> <p>After the completion of background merges and mutations, old parts are removed only after a certain amount of time (<code class=syntax>old_parts_lifetime</code>).<br> During this time, they are not moved to other volumes or disks. Therefore, until the parts are finally removed, they are still taken into account for evaluation of the occupied disk space.</p> <h2 id=table_engine-mergetree-s3>Using S3 for Data Storage<a class=headerlink href=../amp/#table_engine-mergetree-s3 title="Permanent link"> </a></h2> <p><code class=syntax>MergeTree</code> family table engines can store data to <a href=https://aws.amazon.com/s3/ rel="external nofollow noreferrer" target=_blank>S3</a> using a disk with type <code class=syntax>s3</code>.</p> <p>This feature is under development and not ready for production. There are known drawbacks such as very low performance.</p> <p>Configuration markup:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;s3&gt;</span>
            <span class=nt>&lt;type&gt;</span>s3<span class=nt>&lt;/type&gt;</span>
            <span class=nt>&lt;endpoint&gt;</span>https://storage.yandexcloud.net/my-bucket/root-path/<span class=nt>&lt;/endpoint&gt;</span>
            <span class=nt>&lt;access_key_id&gt;</span>your_access_key_id<span class=nt>&lt;/access_key_id&gt;</span>
            <span class=nt>&lt;secret_access_key&gt;</span>your_secret_access_key<span class=nt>&lt;/secret_access_key&gt;</span>
            <span class=nt>&lt;region&gt;&lt;/region&gt;</span>
            <span class=nt>&lt;server_side_encryption_customer_key_base64&gt;</span>your_base64_encoded_customer_key<span class=nt>&lt;/server_side_encryption_customer_key_base64&gt;</span>
            <span class=nt>&lt;proxy&gt;</span>
                <span class=nt>&lt;uri&gt;</span>http://proxy1<span class=nt>&lt;/uri&gt;</span>
                <span class=nt>&lt;uri&gt;</span>http://proxy2<span class=nt>&lt;/uri&gt;</span>
            <span class=nt>&lt;/proxy&gt;</span>
            <span class=nt>&lt;connect_timeout_ms&gt;</span>10000<span class=nt>&lt;/connect_timeout_ms&gt;</span>
            <span class=nt>&lt;request_timeout_ms&gt;</span>5000<span class=nt>&lt;/request_timeout_ms&gt;</span>
            <span class=nt>&lt;retry_attempts&gt;</span>10<span class=nt>&lt;/retry_attempts&gt;</span>
            <span class=nt>&lt;single_read_retries&gt;</span>4<span class=nt>&lt;/single_read_retries&gt;</span>
            <span class=nt>&lt;min_bytes_for_seek&gt;</span>1000<span class=nt>&lt;/min_bytes_for_seek&gt;</span>
            <span class=nt>&lt;metadata_path&gt;</span>/var/lib/clickhouse/disks/s3/<span class=nt>&lt;/metadata_path&gt;</span>
            <span class=nt>&lt;cache_enabled&gt;</span>true<span class=nt>&lt;/cache_enabled&gt;</span>
            <span class=nt>&lt;cache_path&gt;</span>/var/lib/clickhouse/disks/s3/cache/<span class=nt>&lt;/cache_path&gt;</span>
            <span class=nt>&lt;skip_access_check&gt;</span>false<span class=nt>&lt;/skip_access_check&gt;</span>
        <span class=nt>&lt;/s3&gt;</span>
    <span class=nt>&lt;/disks&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Required parameters:</p> <ul> <li><code class=syntax>endpoint</code> — S3 endpoint URL in <code class=syntax>path</code> or <code class=syntax>virtual hosted</code> <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html rel="external nofollow noreferrer" target=_blank>styles</a>. Endpoint URL should contain a bucket and root path to store data.</li> <li><code class=syntax>access_key_id</code> — S3 access key id.</li> <li><code class=syntax>secret_access_key</code> — S3 secret access key.</li> </ul> <p>Optional parameters:</p> <ul> <li><code class=syntax>region</code> — S3 region name.</li> <li><code class=syntax>use_environment_credentials</code> — Reads AWS credentials from the Environment variables AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY and AWS_SESSION_TOKEN if they exist. Default value is <code class=syntax>false</code>.</li> <li><code class=syntax>use_insecure_imds_request</code> — If set to <code class=syntax>true</code>, S3 client will use insecure IMDS request while obtaining credentials from Amazon EC2 metadata. Default value is <code class=syntax>false</code>.</li> <li><code class=syntax>proxy</code> — Proxy configuration for S3 endpoint. Each <code class=syntax>uri</code> element inside <code class=syntax>proxy</code> block should contain a proxy URL.</li> <li><code class=syntax>connect_timeout_ms</code> — Socket connect timeout in milliseconds. Default value is <code class=syntax>10 seconds</code>.</li> <li><code class=syntax>request_timeout_ms</code> — Request timeout in milliseconds. Default value is <code class=syntax>5 seconds</code>.</li> <li><code class=syntax>retry_attempts</code> — Number of retry attempts in case of failed request. Default value is <code class=syntax>10</code>.</li> <li><code class=syntax>single_read_retries</code> — Number of retry attempts in case of connection drop during read. Default value is <code class=syntax>4</code>.</li> <li><code class=syntax>min_bytes_for_seek</code> — Minimal number of bytes to use seek operation instead of sequential read. Default value is <code class=syntax>1 Mb</code>.</li> <li><code class=syntax>metadata_path</code> — Path on local FS to store metadata files for S3. Default value is <code class=syntax>/var/lib/clickhouse/disks/&lt;disk_name&gt;/</code>.</li> <li><code class=syntax>cache_enabled</code> — Allows to cache mark and index files on local FS. Default value is <code class=syntax>true</code>.</li> <li><code class=syntax>cache_path</code> — Path on local FS where to store cached mark and index files. Default value is <code class=syntax>/var/lib/clickhouse/disks/&lt;disk_name&gt;/cache/</code>.</li> <li><code class=syntax>skip_access_check</code> — If true, disk access checks will not be performed on disk start-up. Default value is <code class=syntax>false</code>.</li> <li><code class=syntax>server_side_encryption_customer_key_base64</code> — If specified, required headers for accessing S3 objects with SSE-C encryption will be set.</li> </ul> <p>S3 disk can be configured as <code class=syntax>main</code> or <code class=syntax>cold</code> storage:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;s3&gt;</span>
            <span class=nt>&lt;type&gt;</span>s3<span class=nt>&lt;/type&gt;</span>
            <span class=nt>&lt;endpoint&gt;</span>https://storage.yandexcloud.net/my-bucket/root-path/<span class=nt>&lt;/endpoint&gt;</span>
            <span class=nt>&lt;access_key_id&gt;</span>your_access_key_id<span class=nt>&lt;/access_key_id&gt;</span>
            <span class=nt>&lt;secret_access_key&gt;</span>your_secret_access_key<span class=nt>&lt;/secret_access_key&gt;</span>
        <span class=nt>&lt;/s3&gt;</span>
    <span class=nt>&lt;/disks&gt;</span>
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;s3_main&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;main&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>s3<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/main&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/s3_main&gt;</span>
        <span class=nt>&lt;s3_cold&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;main&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>default<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/main&gt;</span>
                <span class=nt>&lt;external&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>s3<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/external&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/s3_cold&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>In case of <code class=syntax>cold</code> option a data can be moved to S3 if local disk free size will be smaller than <code class=syntax>move_factor * disk_size</code> or by TTL move rule.</p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2021 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/0456f20bf4dfe43e56279f2734c4dda7e89f437b" rel="external nofollow noreferrer" target="_blank" class="text-reset">0456f20bf4</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
