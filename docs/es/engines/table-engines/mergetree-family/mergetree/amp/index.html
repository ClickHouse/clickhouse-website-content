<!doctype html><html ⚡ lang=es> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>Método de codificación de datos: | Documentación de ClickHouse</title><link href=https://clickhouse.tech/docs/es/engines/table-engines/mergetree-family/mergetree/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Método de codificación de datos: | Documentación de ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/es/engines/table-engines/mergetree-family/mergetree/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Método de codificación de datos: | Documentación de ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer,header,main{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b,strong{font-weight:bolder}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}th{text-align:inherit}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item;cursor:pointer}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.lead{font-size:1.25rem;font-weight:300}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-last{-ms-flex-order:13;order:13}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-last{-ms-flex-order:13;order:13}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-last{-ms-flex-order:13;order:13}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}}.table{width:100%;margin-bottom:1rem;color:#212529}.table td,.table th{padding:.75rem;vertical-align:top;border-top:1px solid #dee2e6}.table thead th{vertical-align:bottom;border-bottom:2px solid #dee2e6}.table tbody+tbody{border-top:2px solid #dee2e6}.table-primary,.table-primary>td,.table-primary>th{background-color:#b8daff}.table-primary tbody+tbody,.table-primary td,.table-primary th,.table-primary thead th{border-color:#7abaff}.table-info,.table-info>td,.table-info>th{background-color:#bee5eb}.table-info tbody+tbody,.table-info td,.table-info th,.table-info thead th{border-color:#86cfda}.table-warning,.table-warning>td,.table-warning>th{background-color:#ffeeba}.table-warning tbody+tbody,.table-warning td,.table-warning th,.table-warning thead th{border-color:#ffdf7e}.table-light,.table-light>td,.table-light>th{background-color:#fdfdfe}.table-light tbody+tbody,.table-light td,.table-light th,.table-light thead th{border-color:#fbfcfc}.table-dark,.table-dark>td,.table-dark>th{background-color:#c6c8ca}.table-dark tbody+tbody,.table-dark td,.table-dark th,.table-dark thead th{border-color:#95999c}.table .thead-dark th{color:#fff;background-color:#343a40;border-color:#454d55}.table .thead-light th{color:#495057;background-color:#e9ecef;border-color:#dee2e6}.table-dark{color:#fff;background-color:#343a40}.table-dark td,.table-dark th,.table-dark thead th{border-color:#454d55}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-primary{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:hover{color:#fff;background-color:#0069d9;border-color:#0062cc}.btn-primary:focus{color:#fff;background-color:#0069d9;border-color:#0062cc;box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-primary:disabled{color:#fff;background-color:#007bff;border-color:#007bff}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info:focus{color:#fff;background-color:#138496;border-color:#117a8b;box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-primary{color:#007bff;border-color:#007bff}.btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-primary:disabled{color:#007bff;background-color:transparent}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:-ms-inline-flexbox;display:inline-flex;margin-right:1rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#004085;background-color:#cce5ff;border-color:#b8daff}.alert-primary .alert-link{color:#002752}.alert-info{color:#0c5460;background-color:#d1ecf1;border-color:#bee5eb}.alert-info .alert-link{color:#062c33}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#007bff}a.bg-primary:focus,a.bg-primary:hover{background-color:#0062cc}.bg-info{background-color:#17a2b8}a.bg-info:focus,a.bg-info:hover{background-color:#117a8b}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.shadow{box-shadow:0 .5rem 1rem rgba(0,0,0,.15)}.shadow-lg{box-shadow:0 1rem 3rem rgba(0,0,0,.175)}.shadow-none{box-shadow:none}.w-25{width:25%}.w-50{width:50%}.w-75{width:75%}.w-100{width:100%}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.m-0{margin:0}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.m-1{margin:.25rem}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.m-2{margin:.5rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.m-3{margin:1rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.m-4{margin:1.5rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.m-5{margin:3rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pb-5,.py-5{padding-bottom:3rem}.m-n1{margin:-.25rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.m-n2{margin:-.5rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.m-n3{margin:-1rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.m-n4{margin:-1.5rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.m-n5{margin:-3rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.m-md-0{margin:0}.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.m-md-1{margin:.25rem}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.m-md-2{margin:.5rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.m-md-3{margin:1rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.m-md-4{margin:1.5rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.m-md-5{margin:3rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.m-md-n1{margin:-.25rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.m-md-n2{margin:-.5rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.m-md-n3{margin:-1rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.m-md-n4{margin:-1.5rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.m-md-n5{margin:-3rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.m-lg-0{margin:0}.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.m-lg-1{margin:.25rem}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.m-lg-2{margin:.5rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.m-lg-3{margin:1rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.m-lg-4{margin:1.5rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.m-lg-5{margin:3rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.m-lg-n1{margin:-.25rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.m-lg-n2{margin:-.5rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.m-lg-n3{margin:-1rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.m-lg-n4{margin:-1.5rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.m-lg-n5{margin:-3rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#007bff}a.text-primary:focus,a.text-primary:hover{color:#0056b3}.text-info{color:#17a2b8}a.text-info:focus,a.text-info:hover{color:#0f6674}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table td,.table th{background-color:#fff}.table-dark{color:inherit}.table-dark tbody+tbody,.table-dark td,.table-dark th,.table-dark thead th{border-color:#dee2e6}.table .thead-dark th{color:inherit;border-color:#dee2e6}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.w-15{width:15%}details{background:#444451;color:#eee;padding:1rem;margin-bottom:1rem;margin-top:1rem}summary{font-weight:700;color:#eee}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content thead{background:#444451;color:#fff}#content td,#content th{padding:.75rem;vertical-align:top}#content td{border:1px solid #dee2e6}#content th{border:1px solid #444451}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre,td,th,thead,tr{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content thead{background:#333}#content td{border:1px solid #444451}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .k{color:#000;font-weight:700}.syntax .l{color:#08f}.syntax .n{color:#2f1e2e}.syntax .o{color:#800}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .ld{color:#48b685}.syntax .m{color:#08f}.syntax .s{color:#48b685}.syntax .nb{color:#2f1e2e}.syntax .nc{color:#fec418}.syntax .no{color:#ef6155}.syntax .nl{color:#2f1e2e}.syntax .py{color:#2f1e2e}.syntax .nt{color:#5bc4bf}.syntax .w{color:#2f1e2e}.syntax .mi{color:#08f}.syntax .s2{color:#48b685}.syntax .se{color:#08f}.syntax .si{color:#08f}.syntax .s1{color:#080}@media(prefers-color-scheme:dark){.syntax .k{color:#c78cff}.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .nb{color:#f8f9fa}.syntax .nl{color:#f8f9fa}.syntax .py{color:#f8f9fa}.syntax .w{color:#f8f9fa}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <div class="alert alert-primary" role=alert> <p class="display-5 mb-2">Help wanted!</p> <p class=lead>The following content of this documentation page has been machine-translated. But unlike other websites, it is not done on the fly. This translated text lives on GitHub repository alongside main ClickHouse codebase and waits for fellow native speakers to make it more human-readable. <a href=/docs/en/engines/table-engines/mergetree-family/mergetree/ class=alert-link>You can also use the original English version as a reference.</a></p> <p class=lead> <a class="btn btn-lg btn-primary text-white" href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/es/engines/table-engines/mergetree-family/mergetree.md target=_blank rel="external nofollow noreferrer"> Help ClickHouse documentation by editing this page </a> </p> </div> <h1 id=table_engines-mergetree>Método de codificación de datos:<a class=headerlink href=../amp/#table_engines-mergetree title="Permanent link"> </a></h1> <p>El <code class=syntax>MergeTree</code> motor y otros motores de esta familia (<code class=syntax>*MergeTree</code>) son los motores de mesa ClickHouse más robustos.</p> <p>Motores en el <code class=syntax>MergeTree</code> familia están diseñados para insertar una gran cantidad de datos en una tabla. Los datos se escriben rápidamente en la tabla parte por parte, luego se aplican reglas para fusionar las partes en segundo plano. Este método es mucho más eficiente que reescribir continuamente los datos en almacenamiento durante la inserción.</p> <p>Principales características:</p> <ul> <li> <p>Almacena datos ordenados por clave principal.</p> <p>Esto le permite crear un pequeño índice disperso que ayuda a encontrar datos más rápido.</p> </li> <li> <p>Las particiones se pueden utilizar si <a href=../../custom-partitioning-key/amp/ >clave de partición</a> se especifica.</p> <p>ClickHouse admite ciertas operaciones con particiones que son más efectivas que las operaciones generales en los mismos datos con el mismo resultado. ClickHouse también corta automáticamente los datos de partición donde se especifica la clave de partición en la consulta. Esto también mejora el rendimiento de las consultas.</p> </li> <li> <p>Soporte de replicación de datos.</p> <p>La familia de <code class=syntax>ReplicatedMergeTree</code> proporciona la replicación de datos. Para obtener más información, consulte <a href=../../replication/amp/ >Replicación de datos</a>.</p> </li> <li> <p>Soporte de muestreo de datos.</p> <p>Si es necesario, puede establecer el método de muestreo de datos en la tabla.</p> </li> </ul> <div class="admonition info alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">INFO</p> <p>El <a class=alert-link href=../../../special/merge/amp/#merge>Fusionar</a> el motor no pertenece al <code class=syntax>*MergeTree</code> familia.</p> </div> <h2 id=table_engine-mergetree-creating-a-table>Creación de una tabla<a class=headerlink href=../amp/#table_engine-mergetree-creating-a-table title="Permanent link"> </a></h2> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>index_name1</span> <span class=n>expr1</span> <span class=k>TYPE</span> <span class=n>type1</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value1</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>index_name2</span> <span class=n>expr2</span> <span class=k>TYPE</span> <span class=n>type2</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value2</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>[</span><span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>ORDER</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>TTL</span> <span class=n>expr</span> <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'xxx'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'xxx'</span><span class=p>],</span> <span class=p>...]</span>
<span class=p>[</span><span class=n>SETTINGS</span> <span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=p>...]</span>
</code></pre></div> <p>Para obtener una descripción de los parámetros, consulte <a href=../../../../../sql-reference/statements/create/amp/ >Descripción de la consulta CREATE</a>.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Nota</p> <p><code class=syntax>INDEX</code> es una característica experimental, ver <a class=alert-link href=../amp/#table_engine-mergetree-data_skipping-indexes>Índices de saltos de datos</a>.</p> </div> <h3 id=mergetree-query-clauses>Cláusulas de consulta<a class=headerlink href=../amp/#mergetree-query-clauses title="Permanent link"> </a></h3> <ul> <li> <p><code class=syntax>ENGINE</code> — Name and parameters of the engine. <code class=syntax>ENGINE = MergeTree()</code>. El <code class=syntax>MergeTree</code> el motor no tiene parámetros.</p> </li> <li> <p><code class=syntax>PARTITION BY</code> — The <a href=../../custom-partitioning-key/amp/ >clave de partición</a>.</p> <p>Para particionar por mes, utilice el <code class=syntax>toYYYYMM(date_column)</code> expresión, donde <code class=syntax>date_column</code> es una columna con una fecha del tipo <a href=../../../../../sql-reference/data-types/date/amp/ >Fecha</a>. Los nombres de partición aquí tienen el <code class=syntax>"YYYYMM"</code> formato.</p> </li> <li> <p><code class=syntax>ORDER BY</code> — The sorting key.</p> <p>Una tupla de columnas o expresiones arbitrarias. Ejemplo: <code class=syntax>ORDER BY (CounterID, EventDate)</code>.</p> </li> <li> <p><code class=syntax>PRIMARY KEY</code> — The primary key if it <a href=../amp/#choosing-a-primary-key-that-differs-from-the-sorting-key>difiere de la clave de clasificación</a>.</p> <p>De forma predeterminada, la clave principal es la misma que la clave de ordenación (que se especifica <code class=syntax>ORDER BY</code> clausula). Por lo tanto, en la mayoría de los casos no es necesario especificar un <code class=syntax>PRIMARY KEY</code> clausula.</p> </li> <li> <p><code class=syntax>SAMPLE BY</code> — An expression for sampling.</p> <p>Si se utiliza una expresión de muestreo, la clave principal debe contenerla. Ejemplo: <code class=syntax>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p> </li> <li> <p><code class=syntax>TTL</code> — A list of rules specifying storage duration of rows and defining logic of automatic parts movement <a href=../amp/#table_engine-mergetree-multiple-volumes>entre discos y volúmenes</a>.</p> <p>La expresión debe tener una <code class=syntax>Date</code> o <code class=syntax>DateTime</code> columna como resultado. Ejemplo:<br> <code class=syntax>TTL date + INTERVAL 1 DAY</code></p> <p>Tipo de regla <code class=syntax>DELETE|TO DISK 'xxx'|TO VOLUME 'xxx'</code> especifica una acción que debe realizarse con la pieza si la expresión está satisfecha (alcanza la hora actual): eliminación de filas caducadas, mover una pieza (si la expresión está satisfecha para todas las filas de una pieza) al disco especificado (<code class=syntax>TO DISK 'xxx'</code>) o al volumen (<code class=syntax>TO VOLUME 'xxx'</code>). El tipo predeterminado de la regla es la eliminación (<code class=syntax>DELETE</code>). Se puede especificar una lista de varias reglas, pero no debe haber más de una <code class=syntax>DELETE</code> regla.</p> <p>Para obtener más información, consulte <a href=../amp/#table_engine-mergetree-ttl>TTL para columnas y tablas</a></p> </li> <li> <p><code class=syntax>SETTINGS</code> — Additional parameters that control the behavior of the <code class=syntax>MergeTree</code>:</p> <ul> <li><code class=syntax>index_granularity</code> — Maximum number of data rows between the marks of an index. Default value: 8192. See <a href=../amp/#mergetree-data-storage>Almacenamiento de datos</a>.</li> <li><code class=syntax>index_granularity_bytes</code> — Maximum size of data granules in bytes. Default value: 10Mb. To restrict the granule size only by number of rows, set to 0 (not recommended). See <a href=../amp/#mergetree-data-storage>Almacenamiento de datos</a>.</li> <li><code class=syntax>enable_mixed_granularity_parts</code> — Enables or disables transitioning to control the granule size with the <code class=syntax>index_granularity_bytes</code> configuración. Antes de la versión 19.11, sólo existía el <code class=syntax>index_granularity</code> ajuste para restringir el tamaño del gránulo. El <code class=syntax>index_granularity_bytes</code> mejora el rendimiento de ClickHouse al seleccionar datos de tablas con filas grandes (decenas y cientos de megabytes). Si tiene tablas con filas grandes, puede habilitar esta configuración para que las tablas mejoren la eficiencia de <code class=syntax>SELECT</code> consulta.</li> <li><code class=syntax>use_minimalistic_part_header_in_zookeeper</code> — Storage method of the data parts headers in ZooKeeper. If <code class=syntax>use_minimalistic_part_header_in_zookeeper=1</code>, entonces ZooKeeper almacena menos datos. Para obtener más información, consulte <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server-settings-use_minimalistic_part_header_in_zookeeper>descripción del ajuste</a> en “Server configuration parameters”.</li> <li><code class=syntax>min_merge_bytes_to_use_direct_io</code> — The minimum data volume for merge operation that is required for using direct I/O access to the storage disk. When merging data parts, ClickHouse calculates the total storage volume of all the data to be merged. If the volume exceeds <code class=syntax>min_merge_bytes_to_use_direct_io</code> bytes, ClickHouse lee y escribe los datos en el disco de almacenamiento utilizando la interfaz de E / S directa (<code class=syntax>O_DIRECT</code> opcion). Si <code class=syntax>min_merge_bytes_to_use_direct_io = 0</code>, entonces la E/S directa está deshabilitada. Valor predeterminado: <code class=syntax>10 * 1024 * 1024 * 1024</code> byte.<br> <a name=mergetree_setting-merge_with_ttl_timeout></a></li> <li><code class=syntax>merge_with_ttl_timeout</code> — Minimum delay in seconds before repeating a merge with TTL. Default value: 86400 (1 day).</li> <li><code class=syntax>write_final_mark</code> — Enables or disables writing the final index mark at the end of data part (after the last byte). Default value: 1. Don't turn it off.</li> <li><code class=syntax>merge_max_block_size</code> — Maximum number of rows in block for merge operations. Default value: 8192.</li> <li><code class=syntax>storage_policy</code> — Storage policy. See <a href=../amp/#table_engine-mergetree-multiple-volumes>Uso de varios dispositivos de bloque para el almacenamiento de datos</a>.</li> </ul> </li> </ul> <p><strong>Ejemplo de configuración de secciones</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span> <span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>))</span> <span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>index_granularity</span><span class=o>=</span><span class=mi>8192</span>
</code></pre></div> <p>En el ejemplo, configuramos la partición por mes.</p> <p>También establecemos una expresión para el muestreo como un hash por el ID de usuario. Esto le permite pseudoaleatorizar los datos en la tabla para cada <code class=syntax>CounterID</code> y <code class=syntax>EventDate</code>. Si define un <a href=../../../../../sql-reference/statements/select/sample/amp/#select-sample-clause>SAMPLE</a> cláusula al seleccionar los datos, ClickHouse devolverá una muestra de datos pseudoaleatoria uniforme para un subconjunto de usuarios.</p> <p>El <code class=syntax>index_granularity</code> se puede omitir porque 8192 es el valor predeterminado.</p> <details><summary>Método obsoleto para crear una tabla</summary> <p></p> <div class="admonition attention alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Atención</p> <p>No utilice este método en nuevos proyectos. Si es posible, cambie los proyectos antiguos al método descrito anteriormente.</p> </div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=p>[</span><span class=o>=</span><span class=p>]</span> <span class=n>MergeTree</span><span class=p>(</span><span class=nb>date</span><span class=o>-</span><span class=k>column</span> <span class=p>[,</span> <span class=n>sampling_expression</span><span class=p>],</span> <span class=p>(</span><span class=k>primary</span><span class=p>,</span> <span class=k>key</span><span class=p>),</span> <span class=n>index_granularity</span><span class=p>)</span>
</code></pre></div> <p><strong>Parámetros MergeTree()</strong></p> <ul> <li><code class=syntax>date-column</code> — The name of a column of the <a href=../../../../../sql-reference/data-types/date/amp/ >Fecha</a> tipo. ClickHouse crea automáticamente particiones por mes en función de esta columna. Los nombres de partición están en el <code class=syntax>"YYYYMM"</code> formato.</li> <li><code class=syntax>sampling_expression</code> — An expression for sampling.</li> <li><code class=syntax>(primary, key)</code> — Primary key. Type: <a href=../../../../../sql-reference/data-types/tuple/amp/ >Tupla()</a></li> <li><code class=syntax>index_granularity</code> — The granularity of an index. The number of data rows between the “marks” de un índice. El valor 8192 es apropiado para la mayoría de las tareas.</li> </ul> <p><strong>Ejemplo</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>MergeTree</span><span class=p>(</span><span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)),</span> <span class=mi>8192</span><span class=p>)</span>
</code></pre></div> <p>El <code class=syntax>MergeTree</code> engine se configura de la misma manera que en el ejemplo anterior para el método de configuración del motor principal.</p> </details> <h2 id=mergetree-data-storage>Almacenamiento de datos<a class=headerlink href=../amp/#mergetree-data-storage title="Permanent link"> </a></h2> <p>Una tabla consta de partes de datos ordenadas por clave principal.</p> <p>Cuando se insertan datos en una tabla, se crean partes de datos separadas y cada una de ellas se ordena lexicográficamente por clave principal. Por ejemplo, si la clave principal es <code class=syntax>(CounterID, Date)</code>, los datos en la parte se ordenan por <code class=syntax>CounterID</code>, y dentro de cada <code class=syntax>CounterID</code> es ordenado por <code class=syntax>Date</code>.</p> <p>Los datos que pertenecen a diferentes particiones se separan en diferentes partes. En el fondo, ClickHouse combina partes de datos para un almacenamiento más eficiente. Las piezas que pertenecen a particiones diferentes no se fusionan. El mecanismo de combinación no garantiza que todas las filas con la misma clave principal estén en la misma parte de datos.</p> <p>Cada parte de datos se divide lógicamente en gránulos. Un gránulo es el conjunto de datos indivisibles más pequeño que ClickHouse lee al seleccionar datos. ClickHouse no divide filas o valores, por lo que cada gránulo siempre contiene un número entero de filas. La primera fila de un gránulo está marcada con el valor de la clave principal de la fila. Para cada parte de datos, ClickHouse crea un archivo de índice que almacena las marcas. Para cada columna, ya sea en la clave principal o no, ClickHouse también almacena las mismas marcas. Estas marcas le permiten encontrar datos directamente en archivos de columnas.</p> <p>El tamaño del gránulo es restringido por <code class=syntax>index_granularity</code> y <code class=syntax>index_granularity_bytes</code> configuración del motor de tabla. El número de filas en un gránulo se encuentra en el <code class=syntax>[1, index_granularity]</code> rango, dependiendo del tamaño de las filas. El tamaño de un gránulo puede exceder <code class=syntax>index_granularity_bytes</code> si el tamaño de una sola fila es mayor que el valor de la configuración. En este caso, el tamaño del gránulo es igual al tamaño de la fila.</p> <h2 id=primary-keys-and-indexes-in-queries>Claves e índices principales en consultas<a class=headerlink href=../amp/#primary-keys-and-indexes-in-queries title="Permanent link"> </a></h2> <p>Tome el <code class=syntax>(CounterID, Date)</code> clave primaria como ejemplo. En este caso, la clasificación y el índice se pueden ilustrar de la siguiente manera:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=w>  </span><span class=n>Whole</span><span class=w> </span><span class=k>data</span><span class=err>:</span><span class=w>     </span><span class=o>[</span><span class=n>---------------------------------------------</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nl>CounterID</span><span class=p>:</span><span class=w>      </span><span class=o>[</span><span class=n>aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nc>Date</span><span class=err>:</span><span class=w>           </span><span class=o>[</span><span class=n>1111111222222233331233211111222222333211111112122222223111112223311122333</span><span class=o>]</span><span class=w></span>
<span class=w>  </span><span class=nl>Marks</span><span class=p>:</span><span class=w>           </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w>      </span><span class=o>|</span><span class=w></span>
<span class=w>                  </span><span class=n>a</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>a</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>b</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>e</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>g</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>h</span><span class=p>,</span><span class=mi>2</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=w>    </span><span class=n>i</span><span class=p>,</span><span class=mi>3</span><span class=w>    </span><span class=n>l</span><span class=p>,</span><span class=mi>3</span><span class=w></span>
<span class=w>  </span><span class=n>Marks</span><span class=w> </span><span class=nl>numbers</span><span class=p>:</span><span class=w>   </span><span class=mi>0</span><span class=w>      </span><span class=mi>1</span><span class=w>      </span><span class=mi>2</span><span class=w>      </span><span class=mi>3</span><span class=w>      </span><span class=mi>4</span><span class=w>      </span><span class=mi>5</span><span class=w>      </span><span class=mi>6</span><span class=w>      </span><span class=mi>7</span><span class=w>      </span><span class=mi>8</span><span class=w>      </span><span class=mi>9</span><span class=w>      </span><span class=mi>10</span><span class=w></span>
</code></pre></div> <p>Si la consulta de datos especifica:</p> <ul> <li><code class=syntax>CounterID in ('a', 'h')</code>, el servidor lee los datos en los rangos de marcas <code class=syntax>[0, 3)</code> y <code class=syntax>[6, 8)</code>.</li> <li><code class=syntax>CounterID IN ('a', 'h') AND Date = 3</code>, el servidor lee los datos en los rangos de marcas <code class=syntax>[1, 3)</code> y <code class=syntax>[7, 8)</code>.</li> <li><code class=syntax>Date = 3</code>, el servidor lee los datos en el rango de marcas <code class=syntax>[1, 10]</code>.</li> </ul> <p>Los ejemplos anteriores muestran que siempre es más efectivo usar un índice que un análisis completo.</p> <p>Un índice disperso permite leer datos adicionales. Al leer un único rango de la clave primaria, hasta <code class=syntax>index_granularity * 2</code> se pueden leer filas adicionales en cada bloque de datos.</p> <p>Los índices dispersos le permiten trabajar con una gran cantidad de filas de tabla, porque en la mayoría de los casos, dichos índices caben en la RAM de la computadora.</p> <p>ClickHouse no requiere una clave principal única. Puede insertar varias filas con la misma clave principal.</p> <h3 id=selecting-the-primary-key>Selección de la clave principal<a class=headerlink href=../amp/#selecting-the-primary-key title="Permanent link"> </a></h3> <p>El número de columnas en la clave principal no está explícitamente limitado. Dependiendo de la estructura de datos, puede incluir más o menos columnas en la clave principal. Esto puede:</p> <ul> <li> <p>Mejorar el rendimiento de un índice.</p> <p>Si la clave principal es <code class=syntax>(a, b)</code>, a continuación, añadir otra columna <code class=syntax>c</code> mejorará el rendimiento si se cumplen las siguientes condiciones:</p> <ul> <li>Hay consultas con una condición en la columna <code class=syntax>c</code>.</li> <li>Rangos de datos largos (varias veces más <code class=syntax>index_granularity</code>) con valores idénticos para <code class=syntax>(a, b)</code> son comunes. En otras palabras, al agregar otra columna le permite omitir rangos de datos bastante largos.</li> </ul> </li> <li> <p>Mejorar la compresión de datos.</p> <p>ClickHouse ordena los datos por clave principal, por lo que cuanto mayor sea la consistencia, mejor será la compresión.</p> </li> <li> <p>Proporcione una lógica adicional al fusionar partes de datos en el <a href=../../collapsingmergetree/amp/#table_engine-collapsingmergetree>ColapsarMergeTree</a> y <a href=../../summingmergetree/amp/ >SummingMergeTree</a> motor.</p> <p>En este caso tiene sentido especificar el <em>clave de clasificación</em> que es diferente de la clave principal.</p> </li> </ul> <p>Una clave principal larga afectará negativamente al rendimiento de la inserción y al consumo de memoria, pero las columnas adicionales de la clave principal no afectarán al rendimiento de ClickHouse durante <code class=syntax>SELECT</code> consulta.</p> <h3 id=choosing-a-primary-key-that-differs-from-the-sorting-key>Elegir una clave principal que difiere de la clave de ordenación<a class=headerlink href=../amp/#choosing-a-primary-key-that-differs-from-the-sorting-key title="Permanent link"> </a></h3> <p>Es posible especificar una clave principal (una expresión con valores que se escriben en el archivo de índice para cada marca) que es diferente de la clave de ordenación (una expresión para ordenar las filas en partes de datos). En este caso, la tupla de expresión de clave primaria debe ser un prefijo de la tupla de expresión de clave de ordenación.</p> <p>Esta característica es útil cuando se <a href=../../summingmergetree/amp/ >SummingMergeTree</a> y<br> <a href=../../aggregatingmergetree/amp/ >AgregaciónMergeTree</a> motores de mesa. En un caso común cuando se utilizan estos motores, la tabla tiene dos tipos de columnas: <em>cota</em> y <em>medida</em>. Las consultas típicas agregan valores de columnas de medida con <code class=syntax>GROUP BY</code> y filtrado por dimensiones. Debido a que SummingMergeTree y AggregatingMergeTree agregan filas con el mismo valor de la clave de ordenación, es natural agregarle todas las dimensiones. Como resultado, la expresión de clave consta de una larga lista de columnas y esta lista debe actualizarse con frecuencia con las dimensiones recién agregadas.</p> <p>En este caso, tiene sentido dejar solo unas pocas columnas en la clave principal que proporcionarán análisis de rango eficientes y agregarán las columnas de dimensión restantes a la tupla de clave de clasificación.</p> <p><a href=../../../../../sql-reference/statements/alter/amp/ >ALTER</a> de la clave de ordenación es una operación ligera porque cuando se agrega una nueva columna simultáneamente a la tabla y a la clave de ordenación, las partes de datos existentes no necesitan ser cambiadas. Dado que la clave de ordenación anterior es un prefijo de la nueva clave de ordenación y no hay datos en la columna recién agregada, los datos se ordenan tanto por las claves de ordenación antiguas como por las nuevas en el momento de la modificación de la tabla.</p> <h3 id=use-of-indexes-and-partitions-in-queries>Uso de índices y particiones en consultas<a class=headerlink href=../amp/#use-of-indexes-and-partitions-in-queries title="Permanent link"> </a></h3> <p>Para <code class=syntax>SELECT</code> consultas, ClickHouse analiza si se puede usar un índice. Se puede usar un índice si el <code class=syntax>WHERE/PREWHERE</code> clause tiene una expresión (como uno de los elementos de conjunción, o enteramente) que representa una operación de comparación de igualdad o desigualdad, o si tiene <code class=syntax>IN</code> o <code class=syntax>LIKE</code> con un prefijo fijo en columnas o expresiones que están en la clave principal o clave de partición, o en ciertas funciones parcialmente repetitivas de estas columnas, o relaciones lógicas de estas expresiones.</p> <p>Por lo tanto, es posible ejecutar rápidamente consultas en uno o varios rangos de la clave principal. En este ejemplo, las consultas serán rápidas cuando se ejecuten para una etiqueta de seguimiento específica, para una etiqueta y un intervalo de fechas específicos, para una etiqueta y una fecha específicas, para varias etiquetas con un intervalo de fechas, etc.</p> <p>Veamos el motor configurado de la siguiente manera:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=err>  ENGINE MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate) SETTINGS index_granularity=8192</span>
</code></pre></div> <p>En este caso, en consultas:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=p>((</span><span class=n>EventDate</span> <span class=o>&gt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-01'</span><span class=p>)</span> <span class=k>AND</span> <span class=n>EventDate</span> <span class=o>&lt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-31'</span><span class=p>))</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=k>IN</span> <span class=p>(</span><span class=mi>101500</span><span class=p>,</span> <span class=mi>731962</span><span class=p>,</span> <span class=mi>160656</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>101500</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>!=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span>
</code></pre></div> <p>ClickHouse utilizará el índice de clave principal para recortar datos incorrectos y la clave de partición mensual para recortar particiones que están en intervalos de fechas incorrectos.</p> <p>Las consultas anteriores muestran que el índice se usa incluso para expresiones complejas. La lectura de la tabla está organizada de modo que el uso del índice no puede ser más lento que un escaneo completo.</p> <p>En el siguiente ejemplo, el índice no se puede usar.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>URL</span> <span class=k>LIKE</span> <span class=s1>'%upyachka%'</span>
</code></pre></div> <p>Para comprobar si ClickHouse puede usar el índice al ejecutar una consulta, use la configuración <a href=../../../../../operations/settings/settings/amp/#settings-force_index_by_date>Fecha de nacimiento</a> y <a href=../../../../../operations/settings/settings/amp/ >force_primary_key</a>.</p> <p>La clave para particionar por mes permite leer solo aquellos bloques de datos que contienen fechas del rango adecuado. En este caso, el bloque de datos puede contener datos para muchas fechas (hasta un mes). Dentro de un bloque, los datos se ordenan por clave principal, que puede no contener la fecha como la primera columna. Debido a esto, el uso de una consulta con solo una condición de fecha que no especifica el prefijo de clave principal hará que se lean más datos que para una sola fecha.</p> <h3 id=use-of-index-for-partially-monotonic-primary-keys>Uso del índice para claves primarias parcialmente monótonas<a class=headerlink href=../amp/#use-of-index-for-partially-monotonic-primary-keys title="Permanent link"> </a></h3> <p>Considere, por ejemplo, los días del mes. Ellos forman un <a href=https://en.wikipedia.org/wiki/Monotonic_function rel="external nofollow noreferrer" target=_blank>monótona secuencia</a> durante un mes, pero no monótono durante períodos más prolongados. Esta es una secuencia parcialmente monotónica. Si un usuario crea la tabla con clave primaria parcialmente monótona, ClickHouse crea un índice disperso como de costumbre. Cuando un usuario selecciona datos de este tipo de tabla, ClickHouse analiza las condiciones de consulta. Si el usuario desea obtener datos entre dos marcas del índice y ambas marcas caen dentro de un mes, ClickHouse puede usar el índice en este caso particular porque puede calcular la distancia entre los parámetros de una consulta y las marcas de índice.</p> <p>ClickHouse no puede usar un índice si los valores de la clave principal en el rango de parámetros de consulta no representan una secuencia monotónica. En este caso, ClickHouse utiliza el método de análisis completo.</p> <p>ClickHouse usa esta lógica no solo para secuencias de días del mes, sino para cualquier clave principal que represente una secuencia parcialmente monotónica.</p> <h3 id=table_engine-mergetree-data_skipping-indexes>Índices de saltos de datos (experimental)<a class=headerlink href=../amp/#table_engine-mergetree-data_skipping-indexes title="Permanent link"> </a></h3> <p>La declaración de índice se encuentra en la sección de columnas del <code class=syntax>CREATE</code> consulta.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>index_name</span> <span class=n>expr</span> <span class=k>TYPE</span> <span class=k>type</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>granularity_value</span>
</code></pre></div> <p>Para tablas de la <code class=syntax>*MergeTree</code> familia, se pueden especificar índices de omisión de datos.</p> <p>Estos índices agregan cierta información sobre la expresión especificada en bloques, que consisten en <code class=syntax>granularity_value</code> gránulos (el tamaño del gránulo se especifica utilizando el <code class=syntax>index_granularity</code> ajuste en el motor de la tabla). Entonces estos agregados se usan en <code class=syntax>SELECT</code> consultas para reducir la cantidad de datos a leer desde el disco omitiendo grandes bloques de datos donde el <code class=syntax>where</code> consulta no puede ser satisfecha.</p> <p><strong>Ejemplo</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>table_name</span>
<span class=p>(</span>
    <span class=n>u64</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>i32</span> <span class=n>Int32</span><span class=p>,</span>
    <span class=n>s</span> <span class=n>String</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>a</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>3</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>...</span>
</code></pre></div> <p>ClickHouse puede utilizar los índices del ejemplo para reducir la cantidad de datos que se leen desde el disco en las siguientes consultas:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=s1>'z'</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span> <span class=o>==</span> <span class=mi>10</span> <span class=k>AND</span> <span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1234</span>
</code></pre></div> <h4 id=available-types-of-indices>Tipos de índices disponibles<a class=headerlink href=../amp/#available-types-of-indices title="Permanent link"> </a></h4> <ul> <li> <p><code class=syntax>minmax</code></p> <p>Almacena los extremos de la expresión especificada (si la expresión <code class=syntax>tuple</code>, entonces almacena extremos para cada elemento de <code class=syntax>tuple</code>), utiliza información almacenada para omitir bloques de datos como la clave principal.</p> </li> <li> <p><code class=syntax>set(max_rows)</code></p> <p>Almacena valores únicos de la expresión especificada (no más de <code class=syntax>max_rows</code> filas, <code class=syntax>max_rows=0</code> medio “no limits”). Utiliza los valores para comprobar si <code class=syntax>WHERE</code> expresión no es satisfactorio en un bloque de datos.</p> </li> <li> <p><code class=syntax>ngrambf_v1(n, size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>Tiendas a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>Filtro de floración</a> que contiene todos los ngrams de un bloque de datos. Funciona solo con cadenas. Puede ser utilizado para la optimización de <code class=syntax>equals</code>, <code class=syntax>like</code> y <code class=syntax>in</code> expresiones.</p> <ul> <li><code class=syntax>n</code> — ngram size,</li> <li><code class=syntax>size_of_bloom_filter_in_bytes</code> — Bloom filter size in bytes (you can use large values here, for example, 256 or 512, because it can be compressed well).</li> <li><code class=syntax>number_of_hash_functions</code> — The number of hash functions used in the Bloom filter.</li> <li><code class=syntax>random_seed</code> — The seed for Bloom filter hash functions.</li> </ul> </li> <li> <p><code class=syntax>tokenbf_v1(size_of_bloom_filter_in_bytes, number_of_hash_functions, random_seed)</code></p> <p>Lo mismo que <code class=syntax>ngrambf_v1</code>, pero almacena tokens en lugar de ngrams. Los tokens son secuencias separadas por caracteres no alfanuméricos.</p> </li> <li> <p><code class=syntax>bloom_filter([false_positive])</code> — Stores a <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>Filtro de floración</a> para las columnas especificadas.</p> <p>Opcional <code class=syntax>false_positive</code> parámetro es la probabilidad de recibir una respuesta falsa positiva del filtro. Valores posibles: (0, 1). Valor predeterminado: 0.025.</p> <p>Tipos de datos admitidos: <code class=syntax>Int*</code>, <code class=syntax>UInt*</code>, <code class=syntax>Float*</code>, <code class=syntax>Enum</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code>, <code class=syntax>FixedString</code>, <code class=syntax>Array</code>, <code class=syntax>LowCardinality</code>, <code class=syntax>Nullable</code>.</p> <p>Las siguientes funciones pueden usarlo: <a href=../../../../../sql-reference/functions/comparison-functions/amp/ >igual</a>, <a href=../../../../../sql-reference/functions/comparison-functions/amp/ >notEquals</a>, <a href=../../../../../sql-reference/functions/in-functions/amp/ >en</a>, <a href=../../../../../sql-reference/functions/in-functions/amp/ >noEn</a>, <a href=../../../../../sql-reference/functions/array-functions/amp/ >tener</a>.</p> </li> </ul> <!-- --> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>sample_index</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index2</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>sample_index3</span> <span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>ngrambf_v1</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
</code></pre></div> <h4 id=functions-support>Funciones de apoyo<a class=headerlink href=../amp/#functions-support title="Permanent link"> </a></h4> <p>Condiciones en el <code class=syntax>WHERE</code> cláusula contiene llamadas de las funciones que operan con columnas. Si la columna forma parte de un índice, ClickHouse intenta usar este índice al realizar las funciones. ClickHouse admite diferentes subconjuntos de funciones para usar índices.</p> <p>El <code class=syntax>set</code> index se puede utilizar con todas las funciones. Subconjuntos de funciones para otros índices se muestran en la siguiente tabla.</p> <table> <thead> <tr> <th>Función (operador) / Índice</th> <th>clave primaria</th> <th>minmax</th> <th>Descripción</th> <th>Sistema abierto.</th> <th>bloom_filter</th> </tr> </thead> <tbody> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-equals>igual (=, ==)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-notequals>notEquals(!=, \&lt;&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-like>como</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-notlike>No como</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-functions/amp/#startswith>Comienza con</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-functions/amp/#endswith>Finaliza con</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/string-search-functions/amp/#function-multisearchany>multiSearchAny</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/in-functions/amp/#in-functions>en</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/in-functions/amp/#in-functions>noEn</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-less>menos (\&lt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-greater>mayor (&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-lessorequals>menosOrEquals (\&lt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/comparison-functions/amp/#function-greaterorequals>mayorOrEquals (&gt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/array-functions/amp/#function-empty>vaciar</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../../sql-reference/functions/array-functions/amp/#function-notempty>notEmpty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td>hasToken</td> <td>✗</td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> </tr> </tbody> </table> <p>Las funciones con un argumento constante que es menor que el tamaño de ngram no pueden ser utilizadas por <code class=syntax>ngrambf_v1</code> para la optimización de consultas.</p> <p>Los filtros Bloom pueden tener coincidencias falsas positivas, por lo que <code class=syntax>ngrambf_v1</code>, <code class=syntax>tokenbf_v1</code>, y <code class=syntax>bloom_filter</code> los índices no se pueden usar para optimizar consultas donde se espera que el resultado de una función sea falso, por ejemplo:</p> <ul> <li>Puede ser optimizado:<ul> <li><code class=syntax>s LIKE '%test%'</code></li> <li><code class=syntax>NOT s NOT LIKE '%test%'</code></li> <li><code class=syntax>s = 1</code></li> <li><code class=syntax>NOT s != 1</code></li> <li><code class=syntax>startsWith(s, 'test')</code></li> </ul> </li> <li>No se puede optimizar:<ul> <li><code class=syntax>NOT s LIKE '%test%'</code></li> <li><code class=syntax>s NOT LIKE '%test%'</code></li> <li><code class=syntax>NOT s = 1</code></li> <li><code class=syntax>s != 1</code></li> <li><code class=syntax>NOT startsWith(s, 'test')</code></li> </ul> </li> </ul> <h2 id=concurrent-data-access>Acceso a datos simultáneos<a class=headerlink href=../amp/#concurrent-data-access title="Permanent link"> </a></h2> <p>Para el acceso simultáneo a tablas, usamos versiones múltiples. En otras palabras, cuando una tabla se lee y actualiza simultáneamente, los datos se leen de un conjunto de partes que está actualizado en el momento de la consulta. No hay cerraduras largas. Las inserciones no se interponen en el camino de las operaciones de lectura.</p> <p>La lectura de una tabla se paralela automáticamente.</p> <h2 id=table_engine-mergetree-ttl>TTL para columnas y tablas<a class=headerlink href=../amp/#table_engine-mergetree-ttl title="Permanent link"> </a></h2> <p>Determina la duración de los valores.</p> <p>El <code class=syntax>TTL</code> se puede establecer para toda la tabla y para cada columna individual. TTL de nivel de tabla también puede especificar la lógica de movimiento automático de datos entre discos y volúmenes.</p> <p>Las expresiones deben evaluar <a href=../../../../../sql-reference/data-types/date/amp/ >Fecha</a> o <a href=../../../../../sql-reference/data-types/datetime/amp/ >FechaHora</a> tipo de datos.</p> <p>Ejemplo:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>time_column</span>
<span class=n>TTL</span> <span class=n>time_column</span> <span class=o>+</span> <span class=nb>interval</span>
</code></pre></div> <p>Definir <code class=syntax>interval</code>, utilizar <a href=../../../../../sql-reference/operators/amp/#operators-datetime>intervalo de tiempo</a> operador.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span>
<span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>15</span> <span class=n>HOUR</span>
</code></pre></div> <h3 id=mergetree-column-ttl>Columna TTL<a class=headerlink href=../amp/#mergetree-column-ttl title="Permanent link"> </a></h3> <p>Cuando los valores de la columna caducan, ClickHouse los reemplaza con los valores predeterminados para el tipo de datos de columna. Si todos los valores de columna en la parte de datos caducan, ClickHouse elimina esta columna de la parte de datos en un sistema de archivos.</p> <p>El <code class=syntax>TTL</code> cláusula no se puede utilizar para columnas clave.</p> <p>Ejemplos:</p> <p>Creación de una tabla con TTL</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=n>b</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=k>c</span> <span class=n>String</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span><span class=p>;</span>
</code></pre></div> <p>Adición de TTL a una columna de una tabla existente</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Modificación de TTL de la columna</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>;</span>
</code></pre></div> <h3 id=mergetree-table-ttl>Tabla TTL<a class=headerlink href=../amp/#mergetree-table-ttl title="Permanent link"> </a></h3> <p>La tabla puede tener una expresión para la eliminación de filas caducadas y varias expresiones para el movimiento automático de partes entre <a href=../amp/#table_engine-mergetree-multiple-volumes>discos o volúmenes</a>. Cuando las filas de la tabla caducan, ClickHouse elimina todas las filas correspondientes. Para la entidad de movimiento de piezas, todas las filas de una pieza deben cumplir los criterios de expresión de movimiento.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>expr</span> <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'aaa'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'bbb'</span><span class=p>],</span> <span class=p>...</span>
</code></pre></div> <p>El tipo de regla TTL puede seguir cada expresión TTL. Afecta a una acción que debe realizarse una vez que se satisface la expresión (alcanza la hora actual):</p> <ul> <li><code class=syntax>DELETE</code> - Eliminar filas caducadas (acción predeterminada);</li> <li><code class=syntax>TO DISK 'aaa'</code> - mover parte al disco <code class=syntax>aaa</code>;</li> <li><code class=syntax>TO VOLUME 'bbb'</code> - mover parte al disco <code class=syntax>bbb</code>.</li> </ul> <p>Ejemplos:</p> <p>Creación de una tabla con TTL</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=p>[</span><span class=k>DELETE</span><span class=p>],</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'aaa'</span><span class=p>,</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>2</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'bbb'</span><span class=p>;</span>
</code></pre></div> <p>Modificación de TTL de la tabla</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p><strong>Eliminación de datos</strong></p> <p>Los datos con un TTL caducado se eliminan cuando ClickHouse fusiona partes de datos.</p> <p>Cuando ClickHouse ve que los datos han caducado, realiza una combinación fuera de programación. Para controlar la frecuencia de tales fusiones, puede establecer <code class=syntax>merge_with_ttl_timeout</code>. Si el valor es demasiado bajo, realizará muchas fusiones fuera de horario que pueden consumir muchos recursos.</p> <p>Si realiza el <code class=syntax>SELECT</code> consulta entre fusiones, puede obtener datos caducados. Para evitarlo, use el <a href=../../../../../sql-reference/statements/misc/amp/#misc_operations-optimize>OPTIMIZE</a> consulta antes <code class=syntax>SELECT</code>.</p> <h2 id=table_engine-mergetree-multiple-volumes>Uso de varios dispositivos de bloque para el almacenamiento de datos<a class=headerlink href=../amp/#table_engine-mergetree-multiple-volumes title="Permanent link"> </a></h2> <h3 id=introduction>Implantación<a class=headerlink href=../amp/#introduction title="Permanent link"> </a></h3> <p><code class=syntax>MergeTree</code> Los motores de tablas familiares pueden almacenar datos en múltiples dispositivos de bloque. Por ejemplo, puede ser útil cuando los datos de una determinada tabla se dividen implícitamente en “hot” y “cold”. Los datos más recientes se solicitan regularmente, pero solo requieren una pequeña cantidad de espacio. Por el contrario, los datos históricos de cola gorda se solicitan raramente. Si hay varios discos disponibles, el “hot” los datos pueden estar ubicados en discos rápidos (por ejemplo, SSD NVMe o en memoria), mientras que “cold” datos - en los relativamente lentos (por ejemplo, HDD).</p> <p>La parte de datos es la unidad móvil mínima para <code class=syntax>MergeTree</code>-mesas de motor. Los datos que pertenecen a una parte se almacenan en un disco. Las partes de datos se pueden mover entre discos en segundo plano (según la configuración del usuario) así como por medio de la <a href=../../../../../sql-reference/statements/alter/amp/#alter_move-partition>ALTER</a> consulta.</p> <h3 id=terms>Plazo<a class=headerlink href=../amp/#terms title="Permanent link"> </a></h3> <ul> <li>Disk — Block device mounted to the filesystem.</li> <li>Default disk — Disk that stores the path specified in the <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server_configuration_parameters-path>camino</a> configuración del servidor.</li> <li>Volume — Ordered set of equal disks (similar to <a href=https://en.wikipedia.org/wiki/Non-RAID_drive_architectures rel="external nofollow noreferrer" target=_blank>JBOD</a>).</li> <li>Storage policy — Set of volumes and the rules for moving data between them.</li> </ul> <p>Los nombres dados a las entidades descritas se pueden encontrar en las tablas del sistema, <a href=../../../../../operations/system-tables/amp/#system_tables-storage_policies>sistema.almacenamiento_policies</a> y <a href=../../../../../operations/system-tables/amp/#system_tables-disks>sistema.disco</a>. Para aplicar una de las directivas de almacenamiento configuradas para una tabla, <code class=syntax>storage_policy</code> establecimiento de <code class=syntax>MergeTree</code>-mesas de la familia del motor.</p> <h3 id=table_engine-mergetree-multiple-volumes_configure>Configuración<a class=headerlink href=../amp/#table_engine-mergetree-multiple-volumes_configure title="Permanent link"> </a></h3> <p>Los discos, los volúmenes y las políticas de almacenamiento deben declararse <code class=syntax>&lt;storage_configuration&gt;</code> etiqueta ya sea en el archivo principal <code class=syntax>config.xml</code> o en un archivo distinto en el <code class=syntax>config.d</code> directorio.</p> <p>Estructura de configuración:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;disk_name_1&gt;</span> <span class=c>&lt;!-- disk name --&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/fast_ssd/clickhouse/<span class=nt>&lt;/path&gt;</span>
        <span class=nt>&lt;/disk_name_1&gt;</span>
        <span class=nt>&lt;disk_name_2&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd1/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_2&gt;</span>
        <span class=nt>&lt;disk_name_3&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd2/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_3&gt;</span>

        ...
    <span class=nt>&lt;/disks&gt;</span>

    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Tags:</p> <ul> <li><code class=syntax>&lt;disk_name_N&gt;</code> — Disk name. Names must be different for all disks.</li> <li><code class=syntax>path</code> — path under which a server will store data (<code class=syntax>data</code> y <code class=syntax>shadow</code> carpetas), debe terminarse con ‘/’.</li> <li><code class=syntax>keep_free_space_bytes</code> — the amount of free disk space to be reserved.</li> </ul> <p>El orden de la definición del disco no es importante.</p> <p>Marcado de configuración de directivas de almacenamiento:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;policy_name_1&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;volume_name_1&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk_name_from_disks_configuration<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/volume_name_1&gt;</span>
                <span class=nt>&lt;volume_name_2&gt;</span>
                    <span class=c>&lt;!-- configuration --&gt;</span>
                <span class=nt>&lt;/volume_name_2&gt;</span>
                <span class=c>&lt;!-- more volumes --&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/policy_name_1&gt;</span>
        <span class=nt>&lt;policy_name_2&gt;</span>
            <span class=c>&lt;!-- configuration --&gt;</span>
        <span class=nt>&lt;/policy_name_2&gt;</span>

        <span class=c>&lt;!-- more policies --&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Tags:</p> <ul> <li><code class=syntax>policy_name_N</code> — Policy name. Policy names must be unique.</li> <li><code class=syntax>volume_name_N</code> — Volume name. Volume names must be unique.</li> <li><code class=syntax>disk</code> — a disk within a volume.</li> <li><code class=syntax>max_data_part_size_bytes</code> — the maximum size of a part that can be stored on any of the volume's disks.</li> <li><code class=syntax>move_factor</code> — when the amount of available space gets lower than this factor, data automatically start to move on the next volume if any (by default, 0.1).</li> </ul> <p>Cofiguration ejemplos:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;hdd_in_order&gt;</span> <span class=c>&lt;!-- policy name --&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;single&gt;</span> <span class=c>&lt;!-- volume name --&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk2<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/single&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/hdd_in_order&gt;</span>

        <span class=nt>&lt;moving_from_ssd_to_hdd&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;hot&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>fast_ssd<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/hot&gt;</span>
                <span class=nt>&lt;cold&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/cold&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/moving_from_ssd_to_hdd&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>En un ejemplo dado, el <code class=syntax>hdd_in_order</code> la política implementa el <a href=https://en.wikipedia.org/wiki/Round-robin_scheduling rel="external nofollow noreferrer" target=_blank>Ronda-robin</a> enfoque. Por lo tanto, esta política define solo un volumen (<code class=syntax>single</code>), las partes de datos se almacenan en todos sus discos en orden circular. Dicha política puede ser bastante útil si hay varios discos similares montados en el sistema, pero RAID no está configurado. Tenga en cuenta que cada unidad de disco individual no es confiable y es posible que desee compensarlo con un factor de replicación de 3 o más.</p> <p>Si hay diferentes tipos de discos disponibles en el sistema, <code class=syntax>moving_from_ssd_to_hdd</code> política se puede utilizar en su lugar. Volumen <code class=syntax>hot</code> consta de un disco SSD (<code class=syntax>fast_ssd</code>), y el tamaño máximo de una pieza que se puede almacenar en este volumen es de 1 GB. Todas las piezas con el tamaño más grande que 1GB serán almacenadas directamente en <code class=syntax>cold</code> volumen, que contiene un disco duro <code class=syntax>disk1</code>.<br> Además, una vez que el disco <code class=syntax>fast_ssd</code> se llena en más del 80%, los datos se transferirán al <code class=syntax>disk1</code> por un proceso en segundo plano.</p> <p>El orden de enumeración de volúmenes dentro de una directiva de almacenamiento es importante. Una vez que un volumen está sobrellenado, los datos se mueven al siguiente. El orden de la enumeración del disco también es importante porque los datos se almacenan en ellos por turnos.</p> <p>Al crear una tabla, se puede aplicarle una de las directivas de almacenamiento configuradas:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_with_non_default_policy</span> <span class=p>(</span>
    <span class=n>EventDate</span> <span class=nb>Date</span><span class=p>,</span>
    <span class=n>OrderID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>BannerID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>SearchPhrase</span> <span class=n>String</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>OrderID</span><span class=p>,</span> <span class=n>BannerID</span><span class=p>)</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span>
<span class=n>SETTINGS</span> <span class=n>storage_policy</span> <span class=o>=</span> <span class=s1>'moving_from_ssd_to_hdd'</span>
</code></pre></div> <p>El <code class=syntax>default</code> política de almacenamiento implica el uso de un solo volumen, que consiste en un solo disco dado en <code class=syntax>&lt;path&gt;</code>. Una vez que se crea una tabla, no se puede cambiar su política de almacenamiento.</p> <h3 id=details>Detalles<a class=headerlink href=../amp/#details title="Permanent link"> </a></h3> <p>En el caso de <code class=syntax>MergeTree</code> tablas, los datos están llegando al disco de diferentes maneras:</p> <ul> <li>Como resultado de un inserto (<code class=syntax>INSERT</code> consulta).</li> <li>Durante las fusiones de fondo y <a href=../../../../../sql-reference/statements/alter/amp/#alter-mutations>mutación</a>.</li> <li>Al descargar desde otra réplica.</li> <li>Como resultado de la congelación de particiones <a href=../../../../../sql-reference/statements/alter/amp/#alter_freeze-partition>ALTER TABLE … FREEZE PARTITION</a>.</li> </ul> <p>En todos estos casos, excepto las mutaciones y la congelación de particiones, una pieza se almacena en un volumen y un disco de acuerdo con la política de almacenamiento dada:</p> <ol> <li>El primer volumen (en el orden de definición) que tiene suficiente espacio en disco para almacenar una pieza (<code class=syntax>unreserved_space &gt; current_part_size</code>) y permite almacenar partes de un tamaño determinado (<code class=syntax>max_data_part_size_bytes &gt; current_part_size</code>) se elige.</li> <li>Dentro de este volumen, se elige ese disco que sigue al que se utilizó para almacenar el fragmento de datos anterior y que tiene espacio libre más que el tamaño de la pieza (<code class=syntax>unreserved_space - keep_free_space_bytes &gt; current_part_size</code>).</li> </ol> <p>Bajo el capó, las mutaciones y la congelación de particiones hacen uso de <a href=https://en.wikipedia.org/wiki/Hard_link rel="external nofollow noreferrer" target=_blank>enlaces duros</a>. Los enlaces duros entre diferentes discos no son compatibles, por lo tanto, en tales casos las partes resultantes se almacenan en los mismos discos que los iniciales.</p> <p>En el fondo, las partes se mueven entre volúmenes en función de la cantidad de espacio libre (<code class=syntax>move_factor</code> parámetro) según el orden en que se declaran los volúmenes en el archivo de configuración.<br> Los datos nunca se transfieren desde el último y al primero. Uno puede usar tablas del sistema <a href=../../../../../operations/system-tables/amp/#system_tables-part-log>sistema.part_log</a> (campo <code class=syntax>type = MOVE_PART</code>) y <a href=../../../../../operations/system-tables/amp/#system_tables-parts>sistema.parte</a> (campo <code class=syntax>path</code> y <code class=syntax>disk</code>) para monitorear movimientos de fondo. Además, la información detallada se puede encontrar en los registros del servidor.</p> <p>El usuario puede forzar el movimiento de una pieza o una partición de un volumen a otro mediante la consulta <a href=../../../../../sql-reference/statements/alter/amp/#alter_move-partition>ALTER TABLE … MOVE PART|PARTITION … TO VOLUME|DISK …</a>, todas las restricciones para las operaciones en segundo plano se tienen en cuenta. La consulta inicia un movimiento por sí misma y no espera a que se completen las operaciones en segundo plano. El usuario recibirá un mensaje de error si no hay suficiente espacio libre disponible o si no se cumple alguna de las condiciones requeridas.</p> <p>Mover datos no interfiere con la replicación de datos. Por lo tanto, se pueden especificar diferentes directivas de almacenamiento para la misma tabla en diferentes réplicas.</p> <p>Después de la finalización de las fusiones y mutaciones de fondo, las partes viejas se eliminan solo después de un cierto período de tiempo (<code class=syntax>old_parts_lifetime</code>).<br> Durante este tiempo, no se mueven a otros volúmenes o discos. Por lo tanto, hasta que las partes finalmente se eliminen, aún se tienen en cuenta para la evaluación del espacio en disco ocupado.</p> <p><a href=https://clickhouse.tech/docs/ru/operations/table_engines/mergetree/ target=_blank>Artículo Original</a> <!--hide--></p> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/es/engines/table-engines/mergetree-family/mergetree/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 