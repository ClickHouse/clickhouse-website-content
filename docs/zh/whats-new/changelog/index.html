<!DOCTYPE html><html lang=zh data-version=master data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>2021 | ClickHouse文档</title><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/images/logo-180x180.png><meta property=og:title content="2021 | ClickHouse文档"><meta property=og:description content="ClickHouse release 21.6, 2021-06-05 Upgrade Notes zstd compression library is updated to v1.5.0. You may get messages ab"><meta property=og:type content=article><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta content=https://clickhouse.tech/docs/zh/whats-new/changelog/ property=og:url><link href=https://clickhouse.tech/docs/en/whats-new/changelog/ rel=canonical><link href=https://clickhouse.tech/docs/zh/whats-new/changelog/amp/ rel=amphtml><link rel=search href=/opensearch.xml title=ClickHouse type=application/opensearchdescription+xml><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "2021 | ClickHouse文档",
"mainEntityOfPage": "https://clickhouse.tech/docs/zh/whats-new/changelog/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "2021 | ClickHouse文档",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><meta name=description content="ClickHouse release 21.6, 2021-06-05 Upgrade Notes zstd compression library is updated to v1.5.0. You may get messages ab"><meta name=keywords content="ClickHouse, DBMS, OLAP, SQL, open-source, relational, analytics, analytical, Big Data, web-analytics"><link rel=alternate href=https://clickhouse.tech/docs/en/whats-new/changelog/ hreflang=en><link rel=alternate href=https://clickhouse.tech/docs/zh/whats-new/changelog/ hreflang=zh><link rel=alternate href=https://clickhouse.tech/docs/ru/whats-new/changelog/ hreflang=ru><link rel=alternate href=https://clickhouse.tech/docs/ja/whats-new/changelog/ hreflang=ja><link rel=alternate href=https://clickhouse.tech/docs/en/whats-new/changelog/ hreflang=x-default><link href=/css/base.css?48d3d791 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> 2021 </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li id=edit-wrapper class=nav-item> <a id=edit-link href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/whats-new/changelog/index.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/zh.svg alt=中文 title=中文 width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/en/whats-new/changelog/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/zh/whats-new/changelog/ class="dropdown-item disabled"> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/ru/whats-new/changelog/ class=dropdown-item> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/ja/whats-new/changelog/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Multi-page or single-page"> <a href=../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Multi-page version" title="Multi-page version"> </a> <a href=../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Single-page version" title="Single-page version"> </a> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=简介 class="nav-link text-light dropdown-toggle px-0">简介</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../ title=什么是ClickHouse？ class="nav-link text-light text-wrap d-inline-block w-100 px-0">什么是ClickHouse？</a> <a href=../../introduction/distinctive-features/ title=ClickHouse的特性 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse的特性</a> <a href=../../introduction/performance/ title=ClickHouse性能 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse性能</a> <a href=../../introduction/history/ title=ClickHouse历史 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse历史</a> <a href=../../introduction/adopters/ title=ClickHouse用户 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse用户</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title=快速上手 class="nav-link text-light dropdown-toggle px-0">快速上手</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting-started/ title=入门 class="nav-link text-light text-wrap d-inline-block w-100 px-0">入门</a> <a href=../../getting-started/install/ title=安装部署 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安装部署</a> <a href=../../getting-started/tutorial/ title=使用教程 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用教程</a> <a href=#sidebar-sidebar-2-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-4 title=示例数据集 class="nav-link text-light dropdown-toggle px-0">示例数据集</a> <div id=sidebar-sidebar-2-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../getting-started/example-datasets/ title=导言 class="nav-link text-light text-wrap d-inline-block w-100 px-0">导言</a> <a href=../../getting-started/example-datasets/metrica/ title="Yandex.Metrica Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Yandex.Metrica Data</a> <a href=../../getting-started/example-datasets/star-schema/ title="Star Schema Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema Benchmark</a> <a href=../../getting-started/example-datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../getting-started/example-datasets/criteo/ title="Terabyte Click Logs from Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Terabyte Click Logs from Criteo</a> <a href=../../getting-started/example-datasets/amplab-benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../getting-started/example-datasets/nyc-taxi/ title="New York Taxi Data" class="nav-link text-light text-wrap d-inline-block w-100 px-0">New York Taxi Data</a> <a href=../../getting-started/example-datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> </nav> </div> <a href=../../getting-started/playground/ title=体验平台 class="nav-link text-light text-wrap d-inline-block w-100 px-0">体验平台</a> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=接口 class="nav-link text-light dropdown-toggle px-0">接口</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/ title=客户端 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端</a> <a href=../../interfaces/cli/ title=命令行客户端 class="nav-link text-light text-wrap d-inline-block w-100 px-0">命令行客户端</a> <a href=../../interfaces/tcp/ title=原生接口(TCP) class="nav-link text-light text-wrap d-inline-block w-100 px-0">原生接口(TCP)</a> <a href=../../interfaces/http/ title=HTTP客户端 class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP客户端</a> <a href=../../interfaces/mysql/ title=MySQL接口 class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL接口</a> <a href=../../interfaces/formats/ title=输入/输出格式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">输入/输出格式</a> <a href=../../interfaces/jdbc/ title=JDBC驱动 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC驱动</a> <a href=../../interfaces/odbc/ title=ODBC驱动 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC驱动</a> <a href=../../interfaces/cpp/ title=C++客户端库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">C++客户端库</a> <a href=#sidebar-sidebar-3-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-10 title=第三方工具 class="nav-link text-light dropdown-toggle px-0">第三方工具</a> <div id=sidebar-sidebar-3-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../interfaces/third-party/ title=第三方工具 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方工具</a> <a href=../../interfaces/third-party/client-libraries/ title=客户端开发库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">客户端开发库</a> <a href=../../interfaces/third-party/integrations/ title=第三方集成库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方集成库</a> <a href=../../interfaces/third-party/proxy/ title=第三方代理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方代理</a> <a href=../../interfaces/third-party/gui/ title=第三方开发的可视化界面 class="nav-link text-light text-wrap d-inline-block w-100 px-0">第三方开发的可视化界面</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=引擎 class="nav-link text-light dropdown-toggle px-0">引擎</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-4-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2 title=数据库引擎 class="nav-link text-light dropdown-toggle px-0">数据库引擎</a> <div id=sidebar-sidebar-4-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/database-engines/lazy/ title=延时引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">延时引擎</a> <a href=../../engines/database-engines/atomic/ title=Atomic class="nav-link text-light text-wrap d-inline-block w-100 px-0">Atomic</a> <a href=../../engines/database-engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../engines/database-engines/ title=数据库引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据库引擎</a> </nav> </div> <a href=#sidebar-sidebar-4-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3 title=表引擎 class="nav-link text-light dropdown-toggle px-0">表引擎</a> <div id=sidebar-sidebar-4-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-4-3-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3-1 title=合并树家族 class="nav-link text-light dropdown-toggle px-0">合并树家族</a> <div id=sidebar-sidebar-4-3-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/mergetree-family/versionedcollapsingmergetree/ title=版本折叠MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">版本折叠MergeTree</a> <a href=../../engines/table-engines/mergetree-family/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> <a href=../../engines/table-engines/mergetree-family/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/mergetree/ title=MergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../engines/table-engines/mergetree-family/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../engines/table-engines/mergetree-family/collapsingmergetree/ title=折叠树 class="nav-link text-light text-wrap d-inline-block w-100 px-0">折叠树</a> <a href=../../engines/table-engines/mergetree-family/replication/ title=数据副本 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据副本</a> <a href=../../engines/table-engines/mergetree-family/custom-partitioning-key/ title=自定义分区键 class="nav-link text-light text-wrap d-inline-block w-100 px-0">自定义分区键</a> </nav> </div> <a href=#sidebar-sidebar-4-3-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3-2 title=日志系列 class="nav-link text-light dropdown-toggle px-0">日志系列</a> <div id=sidebar-sidebar-4-3-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/log-family/ title=日志引擎系列 class="nav-link text-light text-wrap d-inline-block w-100 px-0">日志引擎系列</a> <a href=../../engines/table-engines/log-family/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../engines/table-engines/log-family/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../engines/table-engines/log-family/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-4-3-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3-3 title=集成 class="nav-link text-light dropdown-toggle px-0">集成</a> <div id=sidebar-sidebar-4-3-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/integrations/mongodb/ title=MongoDB class="nav-link text-light text-wrap d-inline-block w-100 px-0">MongoDB</a> <a href=../../engines/table-engines/integrations/postgresql/ title=PostgreSQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">PostgreSQL</a> <a href=../../engines/table-engines/integrations/jdbc/ title=JDBC表引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC表引擎</a> <a href=../../engines/table-engines/integrations/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> <a href=../../engines/table-engines/integrations/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> <a href=../../engines/table-engines/integrations/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../engines/table-engines/integrations/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> </nav> </div> <a href=#sidebar-sidebar-4-3-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3-4 title=特别 class="nav-link text-light dropdown-toggle px-0">特别</a> <div id=sidebar-sidebar-4-3-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../engines/table-engines/special/join/ title=关联表引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">关联表引擎</a> <a href=../../engines/table-engines/special/generate/ title=随机数生成 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机数生成</a> <a href=../../engines/table-engines/special/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../engines/table-engines/special/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../engines/table-engines/special/url/ title=URL(URL,格式) class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL(URL,格式)</a> <a href=../../engines/table-engines/special/memory/ title=内存表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">内存表</a> <a href=../../engines/table-engines/special/distributed/ title=分布 class="nav-link text-light text-wrap d-inline-block w-100 px-0">分布</a> <a href=../../engines/table-engines/special/merge/ title=合并 class="nav-link text-light text-wrap d-inline-block w-100 px-0">合并</a> <a href=../../engines/table-engines/special/dictionary/ title=字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典</a> <a href=../../engines/table-engines/special/file/ title=文件(输入格式) class="nav-link text-light text-wrap d-inline-block w-100 px-0">文件(输入格式)</a> <a href=../../engines/table-engines/special/external-data/ title=用于查询处理的外部数据 class="nav-link text-light text-wrap d-inline-block w-100 px-0">用于查询处理的外部数据</a> <a href=../../engines/table-engines/special/buffer/ title=缓冲区 class="nav-link text-light text-wrap d-inline-block w-100 px-0">缓冲区</a> <a href=../../engines/table-engines/special/view/ title=视图 class="nav-link text-light text-wrap d-inline-block w-100 px-0">视图</a> <a href=../../engines/table-engines/special/set/ title=集合 class="nav-link text-light text-wrap d-inline-block w-100 px-0">集合</a> </nav> </div> <a href=../../engines/table-engines/ title=表引擎 class="nav-link text-light text-wrap d-inline-block w-100 px-0">表引擎</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title=SQL参考 class="nav-link text-light dropdown-toggle px-0">SQL参考</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/syntax/ title=SQL语法 class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQL语法</a> <a href=#sidebar-sidebar-5-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-3 title=语句 class="nav-link text-light dropdown-toggle px-0">语句</a> <div id=sidebar-sidebar-5-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-5-3-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-3-2 title=SELECT class="nav-link text-light dropdown-toggle px-0">SELECT</a> <div id=sidebar-sidebar-5-3-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/statements/select/ title=综述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">综述</a> <a href=../../sql-reference/statements/select/all/ title="ALL 子句" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALL 子句</a> <a href=../../sql-reference/statements/select/array-join/ title="ARRAY JOIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ARRAY JOIN</a> <a href=../../sql-reference/statements/select/distinct/ title=DISTINCT class="nav-link text-light text-wrap d-inline-block w-100 px-0">DISTINCT</a> <a href=../../sql-reference/statements/select/format/ title=FORMAT class="nav-link text-light text-wrap d-inline-block w-100 px-0">FORMAT</a> <a href=../../sql-reference/statements/select/from/ title=FROM class="nav-link text-light text-wrap d-inline-block w-100 px-0">FROM</a> <a href=../../sql-reference/statements/select/group-by/ title="GROUP BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GROUP BY</a> <a href=../../sql-reference/statements/select/having/ title=HAVING class="nav-link text-light text-wrap d-inline-block w-100 px-0">HAVING</a> <a href=../../sql-reference/statements/select/into-outfile/ title="INTO OUTFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INTO OUTFILE</a> <a href=../../sql-reference/statements/select/join/ title=JOIN class="nav-link text-light text-wrap d-inline-block w-100 px-0">JOIN</a> <a href=../../sql-reference/statements/select/limit/ title=LIMIT class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT</a> <a href=../../sql-reference/statements/select/limit-by/ title="LIMIT BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT BY</a> <a href=../../sql-reference/statements/select/order-by/ title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a> <a href=../../sql-reference/statements/select/prewhere/ title=PREWHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">PREWHERE</a> <a href=../../sql-reference/statements/select/sample/ title=SAMPLE class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE</a> <a href=../../sql-reference/statements/select/union/ title="UNION ALL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UNION ALL</a> <a href=../../sql-reference/statements/select/where/ title=WHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">WHERE</a> <a href=../../sql-reference/statements/select/with/ title=WITH class="nav-link text-light text-wrap d-inline-block w-100 px-0">WITH</a> </nav> </div> <a href=../../sql-reference/statements/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../sql-reference/statements/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../sql-reference/statements/show/ title=SHOW class="nav-link text-light text-wrap d-inline-block w-100 px-0">SHOW</a> <a href=../../sql-reference/statements/grant/ title=授权操作 class="nav-link text-light text-wrap d-inline-block w-100 px-0">授权操作</a> <a href=../../sql-reference/statements/revoke/ title=REVOKE class="nav-link text-light text-wrap d-inline-block w-100 px-0">REVOKE</a> <a href=../../sql-reference/statements/misc/ title=其他 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他</a> <a href=../../sql-reference/statements/create/ title="CREATE DATABASE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">CREATE DATABASE</a> <a href=../../sql-reference/statements/insert-into/ title="INSERT INTO 语句" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO 语句</a> </nav> </div> <a href=#sidebar-sidebar-5-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-4 title=函数 class="nav-link text-light dropdown-toggle px-0">函数</a> <div id=sidebar-sidebar-5-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/functions/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> <a href=../../sql-reference/functions/arithmetic-functions/ title=算术函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">算术函数</a> <a href=../../sql-reference/functions/comparison-functions/ title=比较函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">比较函数</a> <a href=../../sql-reference/functions/logical-functions/ title=逻辑函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">逻辑函数</a> <a href=../../sql-reference/functions/type-conversion-functions/ title=类型转换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">类型转换函数</a> <a href=../../sql-reference/functions/in-functions/ title="IN 运算符" class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN 运算符</a> <a href=../../sql-reference/functions/introspection/ title=自省 class="nav-link text-light text-wrap d-inline-block w-100 px-0">自省</a> <a href=../../sql-reference/functions/geo/ title=GEO函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">GEO函数</a> <a href=../../sql-reference/functions/hash-functions/ title=Hash函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Hash函数</a> <a href=../../sql-reference/functions/ip-address-functions/ title=IP函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IP函数</a> <a href=../../sql-reference/functions/json-functions/ title=JSON函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON函数</a> <a href=../../sql-reference/functions/functions-for-nulls/ title=Nullable处理函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable处理函数</a> <a href=../../sql-reference/functions/url-functions/ title=URL函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL函数</a> <a href=../../sql-reference/functions/uuid-functions/ title=UUID函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID函数</a> <a href=../../sql-reference/functions/array-join/ title=arrayJoin函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">arrayJoin函数</a> <a href=../../sql-reference/functions/bitmap-functions/ title=位图函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位图函数</a> <a href=../../sql-reference/functions/bit-functions/ title=位操作函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">位操作函数</a> <a href=../../sql-reference/functions/other-functions/ title=其他函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">其他函数</a> <a href=../../sql-reference/functions/ym-dict-functions/ title=功能与Yandex的工作。梅特里卡词典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">功能与Yandex的工作。梅特里卡词典</a> <a href=../../sql-reference/functions/rounding-functions/ title=取整函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">取整函数</a> <a href=../../sql-reference/functions/ext-dict-functions/ title=字典函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典函数</a> <a href=../../sql-reference/functions/string-functions/ title=字符串函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串函数</a> <a href=../../sql-reference/functions/splitting-merging-functions/ title=字符串拆分合并函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串拆分合并函数</a> <a href=../../sql-reference/functions/string-search-functions/ title=字符串搜索函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串搜索函数</a> <a href=../../sql-reference/functions/string-replace-functions/ title=字符串替换函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串替换函数</a> <a href=../../sql-reference/functions/math-functions/ title=数学函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数学函数</a> <a href=../../sql-reference/functions/array-functions/ title=数组函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数组函数</a> <a href=../../sql-reference/functions/date-time-functions/ title=时间日期函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">时间日期函数</a> <a href=../../sql-reference/functions/machine-learning-functions/ title=机器学习函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">机器学习函数</a> <a href=../../sql-reference/functions/conditional-functions/ title=条件函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">条件函数</a> <a href=../../sql-reference/functions/encoding-functions/ title=编码函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">编码函数</a> <a href=../../sql-reference/functions/random-functions/ title=随机函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">随机函数</a> <a href=../../sql-reference/functions/higher-order-functions/ title=高阶函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">高阶函数</a> </nav> </div> <a href=#sidebar-sidebar-5-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5 title=聚合函数 class="nav-link text-light dropdown-toggle px-0">聚合函数</a> <div id=sidebar-sidebar-5-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/aggregate-functions/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> <a href=#sidebar-sidebar-5-5-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5-2 title=Reference class="nav-link text-light dropdown-toggle px-0">Reference</a> <div id=sidebar-sidebar-5-5-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/aggregate-functions/reference/count/ title=count class="nav-link text-light text-wrap d-inline-block w-100 px-0">count</a> <a href=../../sql-reference/aggregate-functions/reference/min/ title=min class="nav-link text-light text-wrap d-inline-block w-100 px-0">min</a> <a href=../../sql-reference/aggregate-functions/reference/max/ title=max class="nav-link text-light text-wrap d-inline-block w-100 px-0">max</a> <a href=../../sql-reference/aggregate-functions/reference/sum/ title=sum class="nav-link text-light text-wrap d-inline-block w-100 px-0">sum</a> <a href=../../sql-reference/aggregate-functions/reference/avg/ title=avg class="nav-link text-light text-wrap d-inline-block w-100 px-0">avg</a> <a href=../../sql-reference/aggregate-functions/reference/any/ title=any class="nav-link text-light text-wrap d-inline-block w-100 px-0">any</a> <a href=../../sql-reference/aggregate-functions/reference/stddevpop/ title=stddevPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevPop</a> <a href=../../sql-reference/aggregate-functions/reference/stddevsamp/ title=stddevSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevSamp</a> <a href=../../sql-reference/aggregate-functions/reference/varpop/ title=varPop(x) class="nav-link text-light text-wrap d-inline-block w-100 px-0">varPop(x)</a> <a href=../../sql-reference/aggregate-functions/reference/varsamp/ title=varSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">varSamp</a> <a href=../../sql-reference/aggregate-functions/reference/covarpop/ title=covarPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarPop</a> <a href=../../sql-reference/aggregate-functions/reference/covarsamp/ title=covarSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarSamp</a> <a href=../../sql-reference/aggregate-functions/reference/anyheavy/ title=anyHeavy class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyHeavy</a> <a href=../../sql-reference/aggregate-functions/reference/anylast/ title=anyLast class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyLast</a> <a href=../../sql-reference/aggregate-functions/reference/argmin/ title=argMin class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMin</a> <a href=../../sql-reference/aggregate-functions/reference/argmax/ title=argMax class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMax</a> <a href=../../sql-reference/aggregate-functions/reference/avgweighted/ title=avgWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">avgWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/corr/ title=corr class="nav-link text-light text-wrap d-inline-block w-100 px-0">corr</a> <a href=../../sql-reference/aggregate-functions/reference/topk/ title=topK class="nav-link text-light text-wrap d-inline-block w-100 px-0">topK</a> <a href=../../sql-reference/aggregate-functions/reference/topkweighted/ title=topKWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">topKWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/grouparray/ title=groupArray class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArray</a> <a href=../../sql-reference/aggregate-functions/reference/groupuniqarray/ title=groupUniqArray class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupUniqArray</a> <a href=../../sql-reference/aggregate-functions/reference/grouparrayinsertat/ title=groupArrayInsertAt class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayInsertAt</a> <a href=../../sql-reference/aggregate-functions/reference/grouparraymovingsum/ title=groupArrayMovingSum class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingSum</a> <a href=../../sql-reference/aggregate-functions/reference/grouparraymovingavg/ title=groupArrayMovingAvg class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingAvg</a> <a href=../../sql-reference/aggregate-functions/reference/grouparraysample/ title=groupArraySample class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArraySample</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitand/ title=groupBitAnd class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitAnd</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitor/ title=groupBitOr class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitOr</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitxor/ title=groupBitXor class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitXor</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitmap/ title=groupBitmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmap</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitmapand/ title=groupBitmapAnd class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmapAnd</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitmapor/ title=groupBitmapOr class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmapOr</a> <a href=../../sql-reference/aggregate-functions/reference/groupbitmapxor/ title=groupBitmapXor class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmapXor</a> <a href=../../sql-reference/aggregate-functions/reference/sumwithoverflow/ title=sumWithOverflow class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumWithOverflow</a> <a href=../../sql-reference/aggregate-functions/reference/deltasum/ title=deltaSum class="nav-link text-light text-wrap d-inline-block w-100 px-0">deltaSum</a> <a href=../../sql-reference/aggregate-functions/reference/summap/ title=sumMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumMap</a> <a href=../../sql-reference/aggregate-functions/reference/minmap/ title=minMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">minMap</a> <a href=../../sql-reference/aggregate-functions/reference/maxmap/ title=maxMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">maxMap</a> <a href=../../sql-reference/aggregate-functions/reference/initializeAggregation/ title=initializeAggregation class="nav-link text-light text-wrap d-inline-block w-100 px-0">initializeAggregation</a> <a href=../../sql-reference/aggregate-functions/reference/skewpop/ title=skewPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewPop</a> <a href=../../sql-reference/aggregate-functions/reference/skewsamp/ title=skewSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewSamp</a> <a href=../../sql-reference/aggregate-functions/reference/kurtpop/ title=kurtPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtPop</a> <a href=../../sql-reference/aggregate-functions/reference/kurtsamp/ title=kurtSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtSamp</a> <a href=../../sql-reference/aggregate-functions/reference/uniq/ title=uniq class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniq</a> <a href=../../sql-reference/aggregate-functions/reference/uniqexact/ title=uniqExact class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqExact</a> <a href=../../sql-reference/aggregate-functions/reference/uniqcombined/ title=uniqCombined class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined</a> <a href=../../sql-reference/aggregate-functions/reference/uniqcombined64/ title=uniqCombined64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined64</a> <a href=../../sql-reference/aggregate-functions/reference/uniqhll12/ title=uniqHLL12 class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqHLL12</a> <a href=../../sql-reference/aggregate-functions/reference/quantile/ title=quantile class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantile</a> <a href=../../sql-reference/aggregate-functions/reference/quantiles/ title=quantiles class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantiles</a> <a href=../../sql-reference/aggregate-functions/reference/quantileexact/ title=quantileExact class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExact</a> <a href=../../sql-reference/aggregate-functions/reference/quantileexactweighted/ title=quantileExactWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExactWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletiming/ title=quantileTiming class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTiming</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletimingweighted/ title=quantileTimingWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTimingWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/quantiledeterministic/ title=quantileDeterministic class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileDeterministic</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletdigest/ title=quantileTDigest class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigest</a> <a href=../../sql-reference/aggregate-functions/reference/quantiletdigestweighted/ title=quantileTDigestWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigestWeighted</a> <a href=../../sql-reference/aggregate-functions/reference/simplelinearregression/ title=simpleLinearRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">simpleLinearRegression</a> <a href=../../sql-reference/aggregate-functions/reference/stochasticlinearregression/ title=stochasticLinearRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLinearRegression</a> <a href=../../sql-reference/aggregate-functions/reference/stochasticlogisticregression/ title=stochasticLogisticRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLogisticRegression</a> <a href=../../sql-reference/aggregate-functions/reference/categoricalinformationvalue/ title=categoricalInformationValue class="nav-link text-light text-wrap d-inline-block w-100 px-0">categoricalInformationValue</a> <a href=../../sql-reference/aggregate-functions/reference/studentttest/ title=studentTTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">studentTTest</a> <a href=../../sql-reference/aggregate-functions/reference/welchttest/ title=welchTTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">welchTTest</a> <a href=../../sql-reference/aggregate-functions/reference/mannwhitneyutest/ title=mannWhitneyUTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">mannWhitneyUTest</a> <a href=../../sql-reference/aggregate-functions/reference/median/ title=median class="nav-link text-light text-wrap d-inline-block w-100 px-0">median</a> <a href=../../sql-reference/aggregate-functions/reference/rankCorr/ title=rankCorr class="nav-link text-light text-wrap d-inline-block w-100 px-0">rankCorr</a> </nav> </div> <a href=../../sql-reference/aggregate-functions/combinators/ title=聚合函数组合器 class="nav-link text-light text-wrap d-inline-block w-100 px-0">聚合函数组合器</a> <a href=../../sql-reference/aggregate-functions/parametric-functions/ title=参数聚合函数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">参数聚合函数</a> </nav> </div> <a href=#sidebar-sidebar-5-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-6 title=表函数 class="nav-link text-light dropdown-toggle px-0">表函数</a> <div id=sidebar-sidebar-5-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/table-functions/ title=导言 class="nav-link text-light text-wrap d-inline-block w-100 px-0">导言</a> <a href=../../sql-reference/table-functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../sql-reference/table-functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../sql-reference/table-functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../sql-reference/table-functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../sql-reference/table-functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../sql-reference/table-functions/postgresql/ title=postgresql class="nav-link text-light text-wrap d-inline-block w-100 px-0">postgresql</a> <a href=../../sql-reference/table-functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../sql-reference/table-functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../sql-reference/table-functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../sql-reference/table-functions/input/ title=input class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a> <a href=../../sql-reference/table-functions/generate/ title=generateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">generateRandom</a> <a href=../../sql-reference/table-functions/remote/ title="remote, remoteSecure" class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote, remoteSecure</a> </nav> </div> <a href=#sidebar-sidebar-5-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-7 title=字典 class="nav-link text-light dropdown-toggle px-0">字典</a> <div id=sidebar-sidebar-5-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/dictionaries/ title=导言 class="nav-link text-light text-wrap d-inline-block w-100 px-0">导言</a> <a href=#sidebar-sidebar-5-7-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-7-2 title=外部字典 class="nav-link text-light dropdown-toggle px-0">外部字典</a> <div id=sidebar-sidebar-5-7-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts/ title=概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概述</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict/ title=配置外部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置外部字典</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/ title=在内存中存储字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">在内存中存储字典</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-lifetime/ title=字典更新 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典更新</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources/ title=外部字典的来源 class="nav-link text-light text-wrap d-inline-block w-100 px-0">外部字典的来源</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-structure/ title=字典键和字段 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字典键和字段</a> <a href=../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-hierarchical/ title=分层字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">分层字典</a> </nav> </div> <a href=../../sql-reference/dictionaries/internal-dicts/ title=内部字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">内部字典</a> </nav> </div> <a href=#sidebar-sidebar-5-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8 title=数据类型 class="nav-link text-light dropdown-toggle px-0">数据类型</a> <div id=sidebar-sidebar-5-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> <a href=../../sql-reference/data-types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../sql-reference/data-types/datetime64/ title=DateTime64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime64</a> <a href=../../sql-reference/data-types/lowcardinality/ title=低基数类型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">低基数类型</a> <a href=#sidebar-sidebar-5-8-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8-5 title=域 class="nav-link text-light dropdown-toggle px-0">域</a> <div id=sidebar-sidebar-5-8-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/domains/ title=域 class="nav-link text-light text-wrap d-inline-block w-100 px-0">域</a> <a href=../../sql-reference/data-types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../sql-reference/data-types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> <a href=../../sql-reference/data-types/aggregatefunction/ title="AggregateFunction(name, types_of_arguments…)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction(name, types_of_arguments…)</a> <a href=../../sql-reference/data-types/decimal/ title=Decimal(P,S),Decimal32(S),Decimal64(S),Decimal128(S) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal(P,S),Decimal32(S),Decimal64(S),Decimal128(S)</a> <a href=../../sql-reference/data-types/enum/ title=Enum8,Enum16 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum8,Enum16</a> <a href=../../sql-reference/data-types/float/ title=Float32,Float64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32,Float64</a> <a href=../../sql-reference/data-types/simpleaggregatefunction/ title=SimpleAggregateFunction class="nav-link text-light text-wrap d-inline-block w-100 px-0">SimpleAggregateFunction</a> <a href=../../sql-reference/data-types/tuple/ title="Tuple(T1, T2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, …)</a> <a href=../../sql-reference/data-types/int-uint/ title=UInt8,UInt16,UInt32,UInt64,Int8,Int16,Int32,Int64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8,UInt16,UInt32,UInt64,Int8,Int16,Int32,Int64</a> <a href=../../sql-reference/data-types/nullable/ title=可为空（类型名称) class="nav-link text-light text-wrap d-inline-block w-100 px-0">可为空（类型名称)</a> <a href=../../sql-reference/data-types/fixedstring/ title=固定字符串 class="nav-link text-light text-wrap d-inline-block w-100 px-0">固定字符串</a> <a href=../../sql-reference/data-types/string/ title=字符串 class="nav-link text-light text-wrap d-inline-block w-100 px-0">字符串</a> <a href=../../sql-reference/data-types/boolean/ title=布尔值 class="nav-link text-light text-wrap d-inline-block w-100 px-0">布尔值</a> <a href=../../sql-reference/data-types/date/ title=日期 class="nav-link text-light text-wrap d-inline-block w-100 px-0">日期</a> <a href=../../sql-reference/data-types/datetime/ title=日期时间 class="nav-link text-light text-wrap d-inline-block w-100 px-0">日期时间</a> <a href=../../sql-reference/data-types/array/ title=阵列(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">阵列(T)</a> <a href=#sidebar-sidebar-5-8-20 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8-20 title=嵌套数据结构 class="nav-link text-light dropdown-toggle px-0">嵌套数据结构</a> <div id=sidebar-sidebar-5-8-20 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/nested-data-structures/nested/ title="Nested(Name1 Type1, Name2 Type2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, …)</a> <a href=../../sql-reference/data-types/nested-data-structures/ title=嵌套数据结构 class="nav-link text-light text-wrap d-inline-block w-100 px-0">嵌套数据结构</a> </nav> </div> <a href=#sidebar-sidebar-5-8-21 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8-21 title=特殊数据类型 class="nav-link text-light dropdown-toggle px-0">特殊数据类型</a> <div id=sidebar-sidebar-5-8-21 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/data-types/special-data-types/interval/ title=间隔 class="nav-link text-light text-wrap d-inline-block w-100 px-0">间隔</a> <a href=../../sql-reference/data-types/special-data-types/nothing/ title=没什么 class="nav-link text-light text-wrap d-inline-block w-100 px-0">没什么</a> <a href=../../sql-reference/data-types/special-data-types/ title=特殊数据类型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">特殊数据类型</a> <a href=../../sql-reference/data-types/special-data-types/expression/ title=表达式 class="nav-link text-light text-wrap d-inline-block w-100 px-0">表达式</a> <a href=../../sql-reference/data-types/special-data-types/set/ title=设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置</a> </nav> </div> </nav> </div> <a href=../../sql-reference/ansi/ title=ANSI兼容性 class="nav-link text-light text-wrap d-inline-block w-100 px-0">ANSI兼容性</a> <a href=#sidebar-sidebar-5-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-10 title=操作符 class="nav-link text-light dropdown-toggle px-0">操作符</a> <div id=sidebar-sidebar-5-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../sql-reference/operators/in/ title="IN 操作符" class="nav-link text-light text-wrap d-inline-block w-100 px-0">IN 操作符</a> <a href=../../sql-reference/operators/ title=操作符 class="nav-link text-light text-wrap d-inline-block w-100 px-0">操作符</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=指南 class="nav-link text-light dropdown-toggle px-0">指南</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../guides/ title=概述 class="nav-link text-light text-wrap d-inline-block w-100 px-0">概述</a> <a href=../../guides/apply-catboost-model/ title=应用CatBoost模型 class="nav-link text-light text-wrap d-inline-block w-100 px-0">应用CatBoost模型</a> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=操作 class="nav-link text-light dropdown-toggle px-0">操作</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/ title=操作 class="nav-link text-light text-wrap d-inline-block w-100 px-0">操作</a> <a href=../../operations/requirements/ title=要求 class="nav-link text-light text-wrap d-inline-block w-100 px-0">要求</a> <a href=../../operations/monitoring/ title=监控 class="nav-link text-light text-wrap d-inline-block w-100 px-0">监控</a> <a href=../../operations/troubleshooting/ title=常见问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">常见问题</a> <a href=../../operations/update/ title=更新 class="nav-link text-light text-wrap d-inline-block w-100 px-0">更新</a> <a href=../../operations/access-rights/ title=访问权限和账户管理 class="nav-link text-light text-wrap d-inline-block w-100 px-0">访问权限和账户管理</a> <a href=../../operations/backup/ title=数据备份 class="nav-link text-light text-wrap d-inline-block w-100 px-0">数据备份</a> <a href=#sidebar-sidebar-7-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-8 title=优化性能 class="nav-link text-light dropdown-toggle px-0">优化性能</a> <div id=sidebar-sidebar-7-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/optimizing-performance/sampling-query-profiler/ title=查询分析 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询分析</a> </nav> </div> <a href=#sidebar-sidebar-7-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-9 title=系统表 class="nav-link text-light dropdown-toggle px-0">系统表</a> <div id=sidebar-sidebar-7-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/system-tables/ title=系统表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统表</a> <a href=../../operations/system-tables/functions/ title=system.functions class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.functions</a> <a href=../../operations/system-tables/query_log/ title=system.query_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_log</a> <a href=../../operations/system-tables/asynchronous_metric_log/ title=系统。asynchronous_metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。asynchronous_metric_log</a> <a href=../../operations/system-tables/asynchronous_metrics/ title=系统。asynchronous_metrics class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。asynchronous_metrics</a> <a href=../../operations/system-tables/data_type_families/ title=系统。data_type_families class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。data_type_families</a> <a href=../../operations/system-tables/detached_parts/ title=系统。detached_parts class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。detached_parts</a> <a href=../../operations/system-tables/graphite_retentions/ title=系统。graphite_retentions class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。graphite_retentions</a> <a href=../../operations/system-tables/merge_tree_settings/ title=系统。merge_tree_settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。merge_tree_settings</a> <a href=../../operations/system-tables/metric_log/ title=系统。metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。metric_log</a> <a href=../../operations/system-tables/numbers_mt/ title=系统。numbers_mt class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。numbers_mt</a> <a href=../../operations/system-tables/part_log/ title=系统。part_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。part_log</a> <a href=../../operations/system-tables/query_thread_log/ title=系统。query_thread_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。query_thread_log</a> <a href=../../operations/system-tables/storage_policies/ title=系统。storage_policies class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。storage_policies</a> <a href=../../operations/system-tables/text_log/ title=系统。text_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。text_log</a> <a href=../../operations/system-tables/trace_log/ title=系统。trace_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。trace_log</a> <a href=../../operations/system-tables/one/ title=系统。一 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。一</a> <a href=../../operations/system-tables/columns/ title=系统。列 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。列</a> <a href=../../operations/system-tables/replicas/ title=系统。副本 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。副本</a> <a href=../../operations/system-tables/zookeeper/ title=系统。动物园管理员 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。动物园管理员</a> <a href=../../operations/system-tables/merges/ title=系统。合并 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。合并</a> <a href=../../operations/system-tables/dictionaries/ title=系统。字典 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。字典</a> <a href=../../operations/system-tables/metrics/ title=系统。指标 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。指标</a> <a href=../../operations/system-tables/numbers/ title=系统。数字 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。数字</a> <a href=../../operations/system-tables/databases/ title=系统。数据库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。数据库</a> <a href=../../operations/system-tables/events/ title=系统。活动 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。活动</a> <a href=../../operations/system-tables/processes/ title=系统。流程 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。流程</a> <a href=../../operations/system-tables/disks/ title=系统。磁盘 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。磁盘</a> <a href=../../operations/system-tables/mutations/ title=系统。突变 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。突变</a> <a href=../../operations/system-tables/tables/ title=系统。表 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。表</a> <a href=../../operations/system-tables/table_engines/ title=系统。表_engines class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。表_engines</a> <a href=../../operations/system-tables/settings/ title=系统。设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。设置</a> <a href=../../operations/system-tables/contributors/ title=系统。贡献者 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。贡献者</a> <a href=../../operations/system-tables/clusters/ title=系统。集群 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。集群</a> <a href=../../operations/system-tables/parts/ title=系统。零件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">系统。零件</a> </nav> </div> <a href=../../operations/performance-test/ title=测试硬件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">测试硬件</a> <a href=../../operations/tips/ title=使用建议 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用建议</a> <a href=../../operations/configuration-files/ title=配置文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配置文件</a> <a href=../../operations/quotas/ title=配额 class="nav-link text-light text-wrap d-inline-block w-100 px-0">配额</a> <a href=#sidebar-sidebar-7-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-14 title=实用工具 class="nav-link text-light dropdown-toggle px-0">实用工具</a> <div id=sidebar-sidebar-7-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/utilities/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> <a href=../../operations/utilities/clickhouse-benchmark/ title=性能测试 class="nav-link text-light text-wrap d-inline-block w-100 px-0">性能测试</a> <a href=../../operations/utilities/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../operations/utilities/ title=实用工具 class="nav-link text-light text-wrap d-inline-block w-100 px-0">实用工具</a> </nav> </div> <a href=#sidebar-sidebar-7-15 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-15 title=服务器配置参数 class="nav-link text-light dropdown-toggle px-0">服务器配置参数</a> <div id=sidebar-sidebar-7-15 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/server-configuration-parameters/settings/ title=服务器设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">服务器设置</a> <a href=../../operations/server-configuration-parameters/ title=服务器配置参数 class="nav-link text-light text-wrap d-inline-block w-100 px-0">服务器配置参数</a> </nav> </div> <a href=#sidebar-sidebar-7-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-16 title=设置 class="nav-link text-light dropdown-toggle px-0">设置</a> <div id=sidebar-sidebar-7-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../operations/settings/permissions-for-queries/ title=查询权限 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询权限</a> <a href=../../operations/settings/settings-profiles/ title=设置配置文件 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置配置文件</a> <a href=../../operations/settings/constraints-on-settings/ title=对设置的限制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">对设置的限制</a> <a href=../../operations/settings/settings-users/ title=用户设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">用户设置</a> <a href=../../operations/settings/query-complexity/ title=查询复杂性的限制 class="nav-link text-light text-wrap d-inline-block w-100 px-0">查询复杂性的限制</a> <a href=../../operations/settings/settings/ title=设置 class="nav-link text-light text-wrap d-inline-block w-100 px-0">设置</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=商业支持 class="nav-link text-light dropdown-toggle px-0">商业支持</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../commercial/cloud/ title=云 class="nav-link text-light text-wrap d-inline-block w-100 px-0">云</a> <a href=../../commercial/support/ title=支持 class="nav-link text-light text-wrap d-inline-block w-100 px-0">支持</a> <a href=../../commercial/ title=简介 class="nav-link text-light text-wrap d-inline-block w-100 px-0">简介</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title=F.A.Q. class="nav-link text-light dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../faq/general/ title=常见问题 class="nav-link text-light text-wrap d-inline-block w-100 px-0">常见问题</a> <a href=../../faq/terms_translation_zh/ title=术语翻译约定 class="nav-link text-light text-wrap d-inline-block w-100 px-0">术语翻译约定</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=ClickHouse事迹 class="nav-link text-light dropdown-toggle px-0">ClickHouse事迹</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-10-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10-1 title=Changelog class="nav-link text-light dropdown-toggle px-0">Changelog</a> <div id=sidebar-sidebar-10-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../whats-new/changelog/ title=2021 class="nav-link text-white active text-wrap d-inline-block w-100 px-0">2021</a> <a href=../../whats-new/changelog/2019/ title=2019 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2019</a> <a href=../../whats-new/changelog/2018/ title=2018 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2018</a> <a href=../../whats-new/changelog/2017/ title=2017 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2017</a> </nav> </div> <a href=../../whats-new/roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> <a href=../../whats-new/security-changelog/ title=安全更新日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">安全更新日志</a> <a href=../../whats-new/ title=ClickHouse变更及改动? class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse变更及改动?</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title="ClickHouse 开发" class="nav-link text-light dropdown-toggle px-0">ClickHouse 开发</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../development/browse-code/ title=浏览源代码 class="nav-link text-light text-wrap d-inline-block w-100 px-0">浏览源代码</a> <a href=../../development/build-cross-arm/ title="如何在Linux上构建ClickHouse for AARCH64（ARM64)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux上构建ClickHouse for AARCH64（ARM64)</a> <a href=../../development/ title="ClickHouse 开发" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse 开发</a> <a href=../../development/architecture/ title="ClickHouse 架构概述" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse 架构概述</a> <a href=../../development/developer-instruction/ title=Windows使用指引 class="nav-link text-light text-wrap d-inline-block w-100 px-0">Windows使用指引</a> <a href=../../development/contrib/ title=使用的三方库 class="nav-link text-light text-wrap d-inline-block w-100 px-0">使用的三方库</a> <a href=../../development/build-osx/ title="在 Mac OS X 中编译 ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">在 Mac OS X 中编译 ClickHouse</a> <a href=../../development/build-cross-osx/ title="如何在Linux中编译Mac OS X ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何在Linux中编译Mac OS X ClickHouse</a> <a href=../../development/build/ title="如何构建 ClickHouse 发布包" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何构建 ClickHouse 发布包</a> <a href=../../development/style/ title="如何编写 C++ 代码" class="nav-link text-light text-wrap d-inline-block w-100 px-0">如何编写 C++ 代码</a> </nav> </div> <a href=#sidebar-sidebar-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-12 title=变更日志 class="nav-link text-light dropdown-toggle px-0">变更日志</a> <div id=sidebar-sidebar-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../changelog/ title=变更日志 class="nav-link text-light text-wrap d-inline-block w-100 px-0">变更日志</a> </nav> </div> <a href=../../single/clickhouse_zh.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt="PDF version" title="PDF version" height=24 class="d-block mr-1 float-left"><div>PDF version</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-4"> <div id=content class=mt-md-n3> <nav class=text-muted aria-label=breadcrumb> <ol class="breadcrumb bg-transparent p-0"> <li class=breadcrumb-item><a href=../ class=text-reset>ClickHouse事迹</a> </li> </ol> </nav> <h3 id=clickhouse-release-21-6-2021-06-05>ClickHouse release 21.6, 2021-06-05<a class=headerlink href=#clickhouse-release-21-6-2021-06-05 title="Permanent link"> </a></h3> <h4 id=upgrade-notes>Upgrade Notes<a class=headerlink href=#upgrade-notes title="Permanent link"> </a></h4> <ul> <li><code class=syntax>zstd</code> compression library is updated to v1.5.0. You may get messages about "checksum does not match" in replication. These messages are expected due to update of compression algorithm and you can ignore them. These messages are informational and do not indicate any kinds of undesired behaviour.</li> <li>The setting <code class=syntax>compile_expressions</code> is enabled by default. Although it has been heavily tested on variety of scenarios, if you find some undesired behaviour on your servers, you can try turning this setting off.</li> <li>Values of <code class=syntax>UUID</code> type cannot be compared with integer. For example, instead of writing <code class=syntax>uuid != 0</code> type <code class=syntax>uuid != '00000000-0000-0000-0000-000000000000'</code>.</li> </ul> <h4 id=new-feature>New Feature<a class=headerlink href=#new-feature title="Permanent link"> </a></h4> <ul> <li>Add Postgres-like cast operator (<code class=syntax>::</code>). E.g.: <code class=syntax>[1, 2]::Array(UInt8)</code>, <code class=syntax>0.1::Decimal(4, 4)</code>, <code class=syntax>number::UInt16</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23871 rel="external nofollow noreferrer" target=_blank>#23871</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Make big integers production ready. Add support for <code class=syntax>UInt128</code> data type. Fix known issues with the <code class=syntax>Decimal256</code> data type. Support big integers in dictionaries. Support <code class=syntax>gcd</code>/<code class=syntax>lcm</code> functions for big integers. Support big integers in array search and conditional functions. Support <code class=syntax>LowCardinality(UUID)</code>. Support big integers in <code class=syntax>generateRandom</code> table function and <code class=syntax>clickhouse-obfuscator</code>. Fix error with returning <code class=syntax>UUID</code> from scalar subqueries. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7834 rel="external nofollow noreferrer" target=_blank>#7834</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23936 rel="external nofollow noreferrer" target=_blank>#23936</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4176 rel="external nofollow noreferrer" target=_blank>#4176</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/24018 rel="external nofollow noreferrer" target=_blank>#24018</a>. Backward incompatible change: values of <code class=syntax>UUID</code> type cannot be compared with integer. For example, instead of writing <code class=syntax>uuid != 0</code> type <code class=syntax>uuid != '00000000-0000-0000-0000-000000000000'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23631 rel="external nofollow noreferrer" target=_blank>#23631</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support <code class=syntax>Array</code> data type for inserting and selecting data in <code class=syntax>Arrow</code>, <code class=syntax>Parquet</code> and <code class=syntax>ORC</code> formats. <a href=https://github.com/ClickHouse/ClickHouse/pull/21770 rel="external nofollow noreferrer" target=_blank>#21770</a> (<a href=https://github.com/taylor12805 rel="external nofollow noreferrer" target=_blank>taylor12805</a>).</li> <li>Implement table comments. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23225 rel="external nofollow noreferrer" target=_blank>#23225</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23548 rel="external nofollow noreferrer" target=_blank>#23548</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Support creating dictionaries with DDL queries in <code class=syntax>clickhouse-local</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22354 rel="external nofollow noreferrer" target=_blank>#22354</a>. Added support for <code class=syntax>DETACH DICTIONARY PERMANENTLY</code>. Added support for <code class=syntax>EXCHANGE DICTIONARIES</code> for <code class=syntax>Atomic</code> database engine. Added support for moving dictionaries between databases using <code class=syntax>RENAME DICTIONARY</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23436 rel="external nofollow noreferrer" target=_blank>#23436</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add aggregate function <code class=syntax>uniqTheta</code> to support <a href=https://datasketches.apache.org/docs/Theta/ThetaSketchFramework.html rel="external nofollow noreferrer" target=_blank>Theta Sketch</a> in ClickHouse. <a href=https://github.com/ClickHouse/ClickHouse/pull/23894 rel="external nofollow noreferrer" target=_blank>#23894</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22609 rel="external nofollow noreferrer" target=_blank>#22609</a> (<a href=https://github.com/pingyu rel="external nofollow noreferrer" target=_blank>Ping Yu</a>).</li> <li>Add function <code class=syntax>splitByRegexp</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24077 rel="external nofollow noreferrer" target=_blank>#24077</a> (<a href=https://github.com/abel-cheng rel="external nofollow noreferrer" target=_blank>abel-cheng</a>).</li> <li>Add function <code class=syntax>arrayProduct</code> which accept an array as the parameter, and return the product of all the elements in array. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21613 rel="external nofollow noreferrer" target=_blank>#21613</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23782 rel="external nofollow noreferrer" target=_blank>#23782</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add <code class=syntax>thread_name</code> column in <code class=syntax>system.stack_trace</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23256 rel="external nofollow noreferrer" target=_blank>#23256</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24124 rel="external nofollow noreferrer" target=_blank>#24124</a> (<a href=https://github.com/abel-cheng rel="external nofollow noreferrer" target=_blank>abel-cheng</a>).</li> <li>If <code class=syntax>insert_null_as_default</code> = 1, insert default values instead of NULL in <code class=syntax>INSERT ... SELECT</code> and <code class=syntax>INSERT ... SELECT ... UNION ALL ...</code> queries. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22832 rel="external nofollow noreferrer" target=_blank>#22832</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23524 rel="external nofollow noreferrer" target=_blank>#23524</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Add support for progress indication in <code class=syntax>clickhouse-local</code> with <code class=syntax>--progress</code> option. <a href=https://github.com/ClickHouse/ClickHouse/pull/23196 rel="external nofollow noreferrer" target=_blank>#23196</a> (<a href=https://github.com/Amesaru rel="external nofollow noreferrer" target=_blank>Egor Savin</a>).</li> <li>Add support for HTTP compression (determined by <code class=syntax>Content-Encoding</code> HTTP header) in <code class=syntax>http</code> dictionary source. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8912 rel="external nofollow noreferrer" target=_blank>#8912</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23946 rel="external nofollow noreferrer" target=_blank>#23946</a> (<a href=https://github.com/FArthur-cmd rel="external nofollow noreferrer" target=_blank>FArthur-cmd</a>).</li> <li>Added <code class=syntax>SYSTEM QUERY RELOAD MODEL</code>, <code class=syntax>SYSTEM QUERY RELOAD MODELS</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18722 rel="external nofollow noreferrer" target=_blank>#18722</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23182 rel="external nofollow noreferrer" target=_blank>#23182</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add setting <code class=syntax>json</code> (boolean, 0 by default) for <code class=syntax>EXPLAIN PLAN</code> query. When enabled, query output will be a single <code class=syntax>JSON</code> row. It is recommended to use <code class=syntax>TSVRaw</code> format to avoid unnecessary escaping. <a href=https://github.com/ClickHouse/ClickHouse/pull/23082 rel="external nofollow noreferrer" target=_blank>#23082</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Add setting <code class=syntax>indexes</code> (boolean, disabled by default) to <code class=syntax>EXPLAIN PIPELINE</code> query. When enabled, shows used indexes, number of filtered parts and granules for every index applied. Supported for <code class=syntax>MergeTree*</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/22352 rel="external nofollow noreferrer" target=_blank>#22352</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>LDAP: implemented user DN detection functionality to use when mapping Active Directory groups to ClickHouse roles. <a href=https://github.com/ClickHouse/ClickHouse/pull/22228 rel="external nofollow noreferrer" target=_blank>#22228</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>New aggregate function <code class=syntax>deltaSumTimestamp</code> for summing the difference between consecutive rows while maintaining ordering during merge by storing timestamps. <a href=https://github.com/ClickHouse/ClickHouse/pull/21888 rel="external nofollow noreferrer" target=_blank>#21888</a> (<a href=https://github.com/rf rel="external nofollow noreferrer" target=_blank>Russ Frank</a>).</li> <li>Added less secure IMDS credentials provider for S3 which works under docker correctly. <a href=https://github.com/ClickHouse/ClickHouse/pull/21852 rel="external nofollow noreferrer" target=_blank>#21852</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add back <code class=syntax>indexHint</code> function. This is for <a href=https://github.com/ClickHouse/ClickHouse/issues/21238 rel="external nofollow noreferrer" target=_blank>#21238</a>. This reverts <a href=https://github.com/ClickHouse/ClickHouse/pull/9542 rel="external nofollow noreferrer" target=_blank>#9542</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9540 rel="external nofollow noreferrer" target=_blank>#9540</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21304 rel="external nofollow noreferrer" target=_blank>#21304</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=experimental-feature>Experimental Feature<a class=headerlink href=#experimental-feature title="Permanent link"> </a></h4> <ul> <li>Add <code class=syntax>PROJECTION</code> support for <code class=syntax>MergeTree*</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/20202 rel="external nofollow noreferrer" target=_blank>#20202</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=performance-improvement>Performance Improvement<a class=headerlink href=#performance-improvement title="Permanent link"> </a></h4> <ul> <li>Enable <code class=syntax>compile_expressions</code> setting by default. When this setting enabled, compositions of simple functions and operators will be compiled to native code with LLVM at runtime. <a href=https://github.com/ClickHouse/ClickHouse/pull/8482 rel="external nofollow noreferrer" target=_blank>#8482</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>, <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>). Note: if you feel in trouble, turn this option off.</li> <li>Update <code class=syntax>re2</code> library. Performance of regular expressions matching is improved. Also this PR adds compatibility with gcc-11. <a href=https://github.com/ClickHouse/ClickHouse/pull/24196 rel="external nofollow noreferrer" target=_blank>#24196</a> (<a href=https://github.com/Algunenano rel="external nofollow noreferrer" target=_blank>Raúl Marín</a>).</li> <li>ORC input format reading by stripe instead of reading entire table into memory by once which is cost memory when file size is huge. <a href=https://github.com/ClickHouse/ClickHouse/pull/23102 rel="external nofollow noreferrer" target=_blank>#23102</a> (<a href=https://github.com/godliness rel="external nofollow noreferrer" target=_blank>Chao Ma</a>).</li> <li>Fusion of aggregate functions <code class=syntax>sum</code>, <code class=syntax>count</code> and <code class=syntax>avg</code> in a query into single aggregate function. The optimization is controlled with the <code class=syntax>optimize_fuse_sum_count_avg</code> setting. This is implemented with a new aggregate function <code class=syntax>sumCount</code>. This function returns a tuple of two fields: <code class=syntax>sum</code> and <code class=syntax>count</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21337 rel="external nofollow noreferrer" target=_blank>#21337</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Update <code class=syntax>zstd</code> to v1.5.0. The performance of compression is improved for single digits percentage. <a href=https://github.com/ClickHouse/ClickHouse/pull/24135 rel="external nofollow noreferrer" target=_blank>#24135</a> (<a href=https://github.com/Algunenano rel="external nofollow noreferrer" target=_blank>Raúl Marín</a>). Note: you may get messages about "checksum does not match" in replication. These messages are expected due to update of compression algorithm and you can ignore them.</li> <li>Improved performance of <code class=syntax>Buffer</code> tables: do not acquire lock for total_bytes/total_rows for <code class=syntax>Buffer</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/24066 rel="external nofollow noreferrer" target=_blank>#24066</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Preallocate support for hashed/sparse_hashed dictionaries is returned. <a href=https://github.com/ClickHouse/ClickHouse/pull/23979 rel="external nofollow noreferrer" target=_blank>#23979</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Enable <code class=syntax>async_socket_for_remote</code> by default (lower amount of threads in querying Distributed tables with large fanout). <a href=https://github.com/ClickHouse/ClickHouse/pull/23683 rel="external nofollow noreferrer" target=_blank>#23683</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> </ul> <h4 id=improvement>Improvement<a class=headerlink href=#improvement title="Permanent link"> </a></h4> <ul> <li>Add <code class=syntax>_partition_value</code> virtual column to MergeTree table family. It can be used to prune partition in a deterministic way. It's needed to implement partition matcher for mutations. <a href=https://github.com/ClickHouse/ClickHouse/pull/23673 rel="external nofollow noreferrer" target=_blank>#23673</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added <code class=syntax>region</code> parameter for S3 storage and disk. <a href=https://github.com/ClickHouse/ClickHouse/pull/23846 rel="external nofollow noreferrer" target=_blank>#23846</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Allow configuring different log levels for different logging channels. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19569 rel="external nofollow noreferrer" target=_blank>#19569</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23857 rel="external nofollow noreferrer" target=_blank>#23857</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Keep default timezone on <code class=syntax>DateTime</code> operations if it was not provided explicitly. For example, if you add one second to a value of <code class=syntax>DateTime</code> type without timezone it will remain <code class=syntax>DateTime</code> without timezone. In previous versions the value of default timezone was placed to the returned data type explicitly so it becomes DateTime('something'). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/4854 rel="external nofollow noreferrer" target=_blank>#4854</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23392 rel="external nofollow noreferrer" target=_blank>#23392</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow user to specify empty string instead of database name for <code class=syntax>MySQL</code> storage. Default database will be used for queries. In previous versions it was working for SELECT queries and not support for INSERT was also added. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19281 rel="external nofollow noreferrer" target=_blank>#19281</a>. This can be useful working with <code class=syntax>Sphinx</code> or other MySQL-compatible foreign databases. <a href=https://github.com/ClickHouse/ClickHouse/pull/23319 rel="external nofollow noreferrer" target=_blank>#23319</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed <code class=syntax>quantile(s)TDigest</code>. Added special handling of singleton centroids according to tdunning/t-digest 3.2+. Also a bug with over-compression of centroids in implementation of earlier version of the algorithm was fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/23314 rel="external nofollow noreferrer" target=_blank>#23314</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Function <code class=syntax>now64</code> now supports optional timezone argument. <a href=https://github.com/ClickHouse/ClickHouse/pull/24091 rel="external nofollow noreferrer" target=_blank>#24091</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Fix the case when a progress bar in interactive mode in clickhouse-client that appear in the middle of the data may rewrite some parts of visible data in terminal. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19283 rel="external nofollow noreferrer" target=_blank>#19283</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23050 rel="external nofollow noreferrer" target=_blank>#23050</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix crash when memory allocation fails in simdjson. <a href=https://github.com/simdjson/simdjson/pull/1567 target=_blank>https://github.com/simdjson/simdjson/pull/1567</a> . Mark as improvement because it's a very rare bug. <a href=https://github.com/ClickHouse/ClickHouse/pull/24147 rel="external nofollow noreferrer" target=_blank>#24147</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Preserve dictionaries until storage shutdown (this will avoid possible <code class=syntax>external dictionary 'DICT' not found</code> errors at server shutdown during final flush of the <code class=syntax>Buffer</code> engine). <a href=https://github.com/ClickHouse/ClickHouse/pull/24068 rel="external nofollow noreferrer" target=_blank>#24068</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Flush <code class=syntax>Buffer</code> tables before shutting down tables (within one database), to avoid discarding blocks due to underlying table had been already detached (and <code class=syntax>Destination table default.a_data_01870 doesn't exist. Block of data is discarded</code> error in the log). <a href=https://github.com/ClickHouse/ClickHouse/pull/24067 rel="external nofollow noreferrer" target=_blank>#24067</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Now <code class=syntax>prefer_column_name_to_alias = 1</code> will also favor column names for <code class=syntax>group by</code>, <code class=syntax>having</code> and <code class=syntax>order by</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23882 rel="external nofollow noreferrer" target=_blank>#23882</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24022 rel="external nofollow noreferrer" target=_blank>#24022</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add support for <code class=syntax>ORDER BY WITH FILL</code> with <code class=syntax>DateTime64</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24016 rel="external nofollow noreferrer" target=_blank>#24016</a> (<a href=https://github.com/MaxWk rel="external nofollow noreferrer" target=_blank>kevin wan</a>).</li> <li>Enable <code class=syntax>DateTime64</code> to be a version column in <code class=syntax>ReplacingMergeTree</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23992 rel="external nofollow noreferrer" target=_blank>#23992</a> (<a href=https://github.com/MaxWk rel="external nofollow noreferrer" target=_blank>kevin wan</a>).</li> <li>Log information about OS name, kernel version and CPU architecture on server startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/23988 rel="external nofollow noreferrer" target=_blank>#23988</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Support specifying table schema for <code class=syntax>postgresql</code> dictionary source. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23958 rel="external nofollow noreferrer" target=_blank>#23958</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23980 rel="external nofollow noreferrer" target=_blank>#23980</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Add hints for names of <code class=syntax>Enum</code> elements (suggest names in case of typos). Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17112 rel="external nofollow noreferrer" target=_blank>#17112</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23919 rel="external nofollow noreferrer" target=_blank>#23919</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Measure found rate (the percentage for which the value was found) for dictionaries (see <code class=syntax>found_rate</code> in <code class=syntax>system.dictionaries</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/23916 rel="external nofollow noreferrer" target=_blank>#23916</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow to add specific queue settings via table settng <code class=syntax>rabbitmq_queue_settings_list</code>. (Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23737 rel="external nofollow noreferrer" target=_blank>#23737</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/23918 rel="external nofollow noreferrer" target=_blank>#23918</a>). Allow user to control all RabbitMQ setup: if table setting <code class=syntax>rabbitmq_queue_consume</code> is set to <code class=syntax>1</code> - RabbitMQ table engine will only connect to specified queue and will not perform any RabbitMQ consumer-side setup like declaring exchange, queues, bindings. (Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21757 rel="external nofollow noreferrer" target=_blank>#21757</a>). Add proper cleanup when RabbitMQ table is dropped - delete queues, which the table has declared and all bound exchanges - if they were created by the table. <a href=https://github.com/ClickHouse/ClickHouse/pull/23887 rel="external nofollow noreferrer" target=_blank>#23887</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Add <code class=syntax>broken_data_files</code>/<code class=syntax>broken_data_compressed_bytes</code> into <code class=syntax>system.distribution_queue</code>. Add metric for number of files for asynchronous insertion into Distributed tables that has been marked as broken (<code class=syntax>BrokenDistributedFilesToInsert</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/23885 rel="external nofollow noreferrer" target=_blank>#23885</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Querying <code class=syntax>system.tables</code> does not go to ZooKeeper anymore. <a href=https://github.com/ClickHouse/ClickHouse/pull/23793 rel="external nofollow noreferrer" target=_blank>#23793</a> (<a href=https://github.com/fuwhu rel="external nofollow noreferrer" target=_blank>Fuwang Hu</a>).</li> <li>Respect <code class=syntax>lock_acquire_timeout_for_background_operations</code> for <code class=syntax>OPTIMIZE</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/23623 rel="external nofollow noreferrer" target=_blank>#23623</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Possibility to change <code class=syntax>S3</code> disk settings in runtime via new <code class=syntax>SYSTEM RESTART DISK</code> SQL command. <a href=https://github.com/ClickHouse/ClickHouse/pull/23429 rel="external nofollow noreferrer" target=_blank>#23429</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>If user applied a misconfiguration by mistakenly setting <code class=syntax>max_distributed_connections</code> to value zero, every query to a <code class=syntax>Distributed</code> table will throw exception with a message containing "logical error". But it's really an expected behaviour, not a logical error, so the exception message was slightly incorrect. It also triggered checks in our CI enviroment that ensures that no logical errors ever happen. Instead we will treat <code class=syntax>max_distributed_connections</code> misconfigured to zero as the minimum possible value (one). <a href=https://github.com/ClickHouse/ClickHouse/pull/23348 rel="external nofollow noreferrer" target=_blank>#23348</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Disable <code class=syntax>min_bytes_to_use_mmap_io</code> by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/23322 rel="external nofollow noreferrer" target=_blank>#23322</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Support <code class=syntax>LowCardinality</code> nullability with <code class=syntax>join_use_nulls</code>, close <a href=https://github.com/ClickHouse/ClickHouse/issues/15101 rel="external nofollow noreferrer" target=_blank>#15101</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23237 rel="external nofollow noreferrer" target=_blank>#23237</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Added possibility to restore <code class=syntax>MergeTree</code> parts to <code class=syntax>detached</code> directory for <code class=syntax>S3</code> disk. <a href=https://github.com/ClickHouse/ClickHouse/pull/23112 rel="external nofollow noreferrer" target=_blank>#23112</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Retries on HTTP connection drops in S3. <a href=https://github.com/ClickHouse/ClickHouse/pull/22988 rel="external nofollow noreferrer" target=_blank>#22988</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add settings <code class=syntax>external_storage_max_read_rows</code> and <code class=syntax>external_storage_max_read_rows</code> for MySQL table engine, dictionary source and MaterializeMySQL minor data fetches. <a href=https://github.com/ClickHouse/ClickHouse/pull/22697 rel="external nofollow noreferrer" target=_blank>#22697</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (experimental feature): Previously, MySQL 5.7.9 was not supported due to SQL incompatibility. Now leave MySQL parameter verification to the MaterializeMySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/23413 rel="external nofollow noreferrer" target=_blank>#23413</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li>Enable reading of subcolumns for distributed tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/24472 rel="external nofollow noreferrer" target=_blank>#24472</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix usage of tuples in <code class=syntax>CREATE .. AS SELECT</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/24464 rel="external nofollow noreferrer" target=_blank>#24464</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Support for <code class=syntax>Parquet</code> format in <code class=syntax>Kafka</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/23412 rel="external nofollow noreferrer" target=_blank>#23412</a> (<a href=https://github.com/godliness rel="external nofollow noreferrer" target=_blank>Chao Ma</a>).</li> </ul> <h4 id=bug-fix>Bug Fix<a class=headerlink href=#bug-fix title="Permanent link"> </a></h4> <ul> <li>Use old modulo function version when used in partition key and primary key. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23508 rel="external nofollow noreferrer" target=_blank>#23508</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24157 rel="external nofollow noreferrer" target=_blank>#24157</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>). It was a source of backward incompatibility in previous releases.</li> <li>Fixed the behavior when query <code class=syntax>SYSTEM RESTART REPLICA</code> or <code class=syntax>SYSTEM SYNC REPLICA</code> is being processed infinitely. This was detected on server with extremely little amount of RAM. <a href=https://github.com/ClickHouse/ClickHouse/pull/24457 rel="external nofollow noreferrer" target=_blank>#24457</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix incorrect monotonicity of <code class=syntax>toWeek</code> function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/24422 rel="external nofollow noreferrer" target=_blank>#24422</a> . This bug was introduced in <a href=https://github.com/ClickHouse/ClickHouse/pull/5212 rel="external nofollow noreferrer" target=_blank>#5212</a>, and was exposed later by smarter partition pruner. <a href=https://github.com/ClickHouse/ClickHouse/pull/24446 rel="external nofollow noreferrer" target=_blank>#24446</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix drop partition with intersect fake parts. In rare cases there might be parts with mutation version greater than current block number. <a href=https://github.com/ClickHouse/ClickHouse/pull/24321 rel="external nofollow noreferrer" target=_blank>#24321</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixed a bug in moving Materialized View from Ordinary to Atomic database (<code class=syntax>RENAME TABLE</code> query). Now inner table is moved to new database together with Materialized View. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23926 rel="external nofollow noreferrer" target=_blank>#23926</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24309 rel="external nofollow noreferrer" target=_blank>#24309</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Allow empty HTTP headers in client requests. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23901 rel="external nofollow noreferrer" target=_blank>#23901</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24285 rel="external nofollow noreferrer" target=_blank>#24285</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Set <code class=syntax>max_threads = 1</code> to fix mutation fail of <code class=syntax>Memory</code> tables. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/24274 rel="external nofollow noreferrer" target=_blank>#24274</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24275 rel="external nofollow noreferrer" target=_blank>#24275</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fix typo in implementation of <code class=syntax>Memory</code> tables, this bug was introduced at <a href=https://github.com/ClickHouse/ClickHouse/issues/15127 rel="external nofollow noreferrer" target=_blank>#15127</a>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/24192 rel="external nofollow noreferrer" target=_blank>#24192</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24193 rel="external nofollow noreferrer" target=_blank>#24193</a> (<a href=https://github.com/plugine rel="external nofollow noreferrer" target=_blank>张中南</a>).</li> <li>Fix abnormal server termination due to <code class=syntax>HDFS</code> becoming not accessible during query execution. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/24117 rel="external nofollow noreferrer" target=_blank>#24117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24191 rel="external nofollow noreferrer" target=_blank>#24191</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Fix crash on updating of <code class=syntax>Nested</code> column with const condition. <a href=https://github.com/ClickHouse/ClickHouse/pull/24183 rel="external nofollow noreferrer" target=_blank>#24183</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix race condition which could happen in RBAC under a heavy load. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/24090 rel="external nofollow noreferrer" target=_blank>#24090</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/24134 rel="external nofollow noreferrer" target=_blank>#24134</a>,. <a href=https://github.com/ClickHouse/ClickHouse/pull/24176 rel="external nofollow noreferrer" target=_blank>#24176</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix a rare bug that could lead to a partially initialized table that can serve write requests (insert/alter/so on). Now such tables will be in readonly mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/24122 rel="external nofollow noreferrer" target=_blank>#24122</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix an issue: <code class=syntax>EXPLAIN PIPELINE</code> with <code class=syntax>SELECT xxx FINAL</code> showed a wrong pipeline. (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fixed using const <code class=syntax>DateTime</code> value vs <code class=syntax>DateTime64</code> column in <code class=syntax>WHERE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24100 rel="external nofollow noreferrer" target=_blank>#24100</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Fix crash in merge JOIN, closes <a href=https://github.com/ClickHouse/ClickHouse/issues/24010 rel="external nofollow noreferrer" target=_blank>#24010</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/24013 rel="external nofollow noreferrer" target=_blank>#24013</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Some <code class=syntax>ALTER PARTITION</code> queries might cause <code class=syntax>Part A intersects previous part B</code> and <code class=syntax>Unexpected merged part C intersecting drop range D</code> errors in replication queue. It's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23296 rel="external nofollow noreferrer" target=_blank>#23296</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23997 rel="external nofollow noreferrer" target=_blank>#23997</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix SIGSEGV for external GROUP BY and overflow row (i.e. queries like <code class=syntax>SELECT FROM GROUP BY WITH TOTALS SETTINGS max_bytes_before_external_group_by&gt;0, max_rows_to_group_by&gt;0, group_by_overflow_mode='any', totals_mode='before_having'</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/23962 rel="external nofollow noreferrer" target=_blank>#23962</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix keys metrics accounting for <code class=syntax>CACHE</code> dictionary with duplicates in the source (leads to <code class=syntax>DictCacheKeysRequestedMiss</code> overflows). <a href=https://github.com/ClickHouse/ClickHouse/pull/23929 rel="external nofollow noreferrer" target=_blank>#23929</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix implementation of connection pool of <code class=syntax>PostgreSQL</code> engine. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23897 rel="external nofollow noreferrer" target=_blank>#23897</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23909 rel="external nofollow noreferrer" target=_blank>#23909</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Fix <code class=syntax>distributed_group_by_no_merge = 2</code> with <code class=syntax>GROUP BY</code> and aggregate function wrapped into regular function (had been broken in <a href=https://github.com/ClickHouse/ClickHouse/issues/23546 rel="external nofollow noreferrer" target=_blank>#23546</a>). Throw exception in case of someone trying to use <code class=syntax>distributed_group_by_no_merge = 2</code> with window functions. Disable <code class=syntax>optimize_distributed_group_by_sharding_key</code> for queries with window functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/23906 rel="external nofollow noreferrer" target=_blank>#23906</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>A fix for <code class=syntax>s3</code> table function: better handling of HTTP errors. Response bodies of HTTP errors were being ignored earlier. <a href=https://github.com/ClickHouse/ClickHouse/pull/23844 rel="external nofollow noreferrer" target=_blank>#23844</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>A fix for <code class=syntax>s3</code> table function: better handling of URI's. Fixed an incompatibility with URLs containing <code class=syntax>+</code> symbol, data with such keys could not be read previously. <a href=https://github.com/ClickHouse/ClickHouse/pull/23822 rel="external nofollow noreferrer" target=_blank>#23822</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Fix error <code class=syntax>Can't initialize pipeline with empty pipe</code> for queries with <code class=syntax>GLOBAL IN/JOIN</code> and <code class=syntax>use_hedged_requests</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23431 rel="external nofollow noreferrer" target=_blank>#23431</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23805 rel="external nofollow noreferrer" target=_blank>#23805</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix <code class=syntax>CLEAR COLUMN</code> does not work when it is referenced by materialized view. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/23764 rel="external nofollow noreferrer" target=_blank>#23764</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23781 rel="external nofollow noreferrer" target=_blank>#23781</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fix heap use after free when reading from HDFS if <code class=syntax>Values</code> format is used. <a href=https://github.com/ClickHouse/ClickHouse/pull/23761 rel="external nofollow noreferrer" target=_blank>#23761</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Avoid possible "Cannot schedule a task" error (in case some exception had been occurred) on INSERT into Distributed. <a href=https://github.com/ClickHouse/ClickHouse/pull/23744 rel="external nofollow noreferrer" target=_blank>#23744</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed a bug in recovery of staled <code class=syntax>ReplicatedMergeTree</code> replica. Some metadata updates could be ignored by staled replica if <code class=syntax>ALTER</code> query was executed during downtime of the replica. <a href=https://github.com/ClickHouse/ClickHouse/pull/23742 rel="external nofollow noreferrer" target=_blank>#23742</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix a bug with <code class=syntax>Join</code> and <code class=syntax>WITH TOTALS</code>, close <a href=https://github.com/ClickHouse/ClickHouse/issues/17718 rel="external nofollow noreferrer" target=_blank>#17718</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23549 rel="external nofollow noreferrer" target=_blank>#23549</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fix possible <code class=syntax>Block structure mismatch</code> error for queries with <code class=syntax>UNION</code> which could possibly happen after filter-pushdown optimization. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23029 rel="external nofollow noreferrer" target=_blank>#23029</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23359 rel="external nofollow noreferrer" target=_blank>#23359</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Add type conversion when the setting <code class=syntax>optimize_skip_unused_shards_rewrite_in</code> is enabled. This fixes MSan report. <a href=https://github.com/ClickHouse/ClickHouse/pull/23219 rel="external nofollow noreferrer" target=_blank>#23219</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add a missing check when updating nested subcolumns, close issue: <a href=https://github.com/ClickHouse/ClickHouse/issues/22353 rel="external nofollow noreferrer" target=_blank>#22353</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22503 rel="external nofollow noreferrer" target=_blank>#22503</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> </ul> <h4 id=build-testing-packaging-improvement>Build/Testing/Packaging Improvement<a class=headerlink href=#build-testing-packaging-improvement title="Permanent link"> </a></h4> <ul> <li>Support building on Illumos. <a href=https://github.com/ClickHouse/ClickHouse/pull/24144 rel="external nofollow noreferrer" target=_blank>#24144</a>. Adds support for building on Solaris-derived operating systems. <a href=https://github.com/ClickHouse/ClickHouse/pull/23746 rel="external nofollow noreferrer" target=_blank>#23746</a> (<a href=https://github.com/bnaecker rel="external nofollow noreferrer" target=_blank>bnaecker</a>).</li> <li>Add more benchmarks for hash tables, including the Swiss Table from Google (that appeared to be slower than ClickHouse hash map in our specific usage scenario). <a href=https://github.com/ClickHouse/ClickHouse/pull/24111 rel="external nofollow noreferrer" target=_blank>#24111</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Update librdkafka 1.6.0-RC3 to 1.6.1. <a href=https://github.com/ClickHouse/ClickHouse/pull/23874 rel="external nofollow noreferrer" target=_blank>#23874</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Always enable <code class=syntax>asynchronous-unwind-tables</code> explicitly. It may fix query profiler on AArch64. <a href=https://github.com/ClickHouse/ClickHouse/pull/23602 rel="external nofollow noreferrer" target=_blank>#23602</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Avoid possible build dependency on locale and filesystem order. This allows reproducible builds. <a href=https://github.com/ClickHouse/ClickHouse/pull/23600 rel="external nofollow noreferrer" target=_blank>#23600</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove a source of nondeterminism from build. Now builds at different point of time will produce byte-identical binaries. Partially addressed <a href=https://github.com/ClickHouse/ClickHouse/issues/22113 rel="external nofollow noreferrer" target=_blank>#22113</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23559 rel="external nofollow noreferrer" target=_blank>#23559</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add simple tool for benchmarking (Zoo)Keeper. <a href=https://github.com/ClickHouse/ClickHouse/pull/23038 rel="external nofollow noreferrer" target=_blank>#23038</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h2 id=clickhouse-release-21-5-2021-05-20>ClickHouse release 21.5, 2021-05-20<a class=headerlink href=#clickhouse-release-21-5-2021-05-20 title="Permanent link"> </a></h2> <h4 id=backward-incompatible-change>Backward Incompatible Change<a class=headerlink href=#backward-incompatible-change title="Permanent link"> </a></h4> <ul> <li>Change comparison of integers and floating point numbers when integer is not exactly representable in the floating point data type. In new version comparison will return false as the rounding error will occur. Example: <code class=syntax>9223372036854775808.0 != 9223372036854775808</code>, because the number <code class=syntax>9223372036854775808</code> is not representable as floating point number exactly (and <code class=syntax>9223372036854775808.0</code> is rounded to <code class=syntax>9223372036854776000.0</code>). But in previous version the comparison will return as the numbers are equal, because if the floating point number <code class=syntax>9223372036854776000.0</code> get converted back to UInt64, it will yield <code class=syntax>9223372036854775808</code>. For the reference, the Python programming language also treats these numbers as equal. But this behaviour was dependend on CPU model (different results on AMD64 and AArch64 for some out-of-range numbers), so we make the comparison more precise. It will treat int and float numbers equal only if int is represented in floating point type exactly. <a href=https://github.com/ClickHouse/ClickHouse/pull/22595 rel="external nofollow noreferrer" target=_blank>#22595</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove support for <code class=syntax>argMin</code> and <code class=syntax>argMax</code> for single <code class=syntax>Tuple</code> argument. The code was not memory-safe. The feature was added by mistake and it is confusing for people. These functions can be reintroduced under different names later. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22384 rel="external nofollow noreferrer" target=_blank>#22384</a> and reverts <a href=https://github.com/ClickHouse/ClickHouse/issues/17359 rel="external nofollow noreferrer" target=_blank>#17359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23393 rel="external nofollow noreferrer" target=_blank>#23393</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=new-feature_1>New Feature<a class=headerlink href=#new-feature_1 title="Permanent link"> </a></h4> <ul> <li>Added functions <code class=syntax>dictGetChildren(dictionary, key)</code>, <code class=syntax>dictGetDescendants(dictionary, key, level)</code>. Function <code class=syntax>dictGetChildren</code> return all children as an array if indexes. It is a inverse transformation for <code class=syntax>dictGetHierarchy</code>. Function <code class=syntax>dictGetDescendants</code> return all descendants as if <code class=syntax>dictGetChildren</code> was applied <code class=syntax>level</code> times recursively. Zero <code class=syntax>level</code> value is equivalent to infinity. Improved performance of <code class=syntax>dictGetHierarchy</code>, <code class=syntax>dictIsIn</code> functions. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14656 rel="external nofollow noreferrer" target=_blank>#14656</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22096 rel="external nofollow noreferrer" target=_blank>#22096</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added function <code class=syntax>dictGetOrNull</code>. It works like <code class=syntax>dictGet</code>, but return <code class=syntax>Null</code> in case key was not found in dictionary. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22375 rel="external nofollow noreferrer" target=_blank>#22375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22413 rel="external nofollow noreferrer" target=_blank>#22413</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added a table function <code class=syntax>s3Cluster</code>, which allows to process files from <code class=syntax>s3</code> in parallel on every node of a specified cluster. <a href=https://github.com/ClickHouse/ClickHouse/pull/22012 rel="external nofollow noreferrer" target=_blank>#22012</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Added support for replicas and shards in MySQL/PostgreSQL table engine / table function. You can write <code class=syntax>SELECT * FROM mysql('host{1,2}-{1|2}', ...)</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20969 rel="external nofollow noreferrer" target=_blank>#20969</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22217 rel="external nofollow noreferrer" target=_blank>#22217</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Added <code class=syntax>ALTER TABLE ... FETCH PART ...</code> query. It's similar to <code class=syntax>FETCH PARTITION</code>, but fetches only one part. <a href=https://github.com/ClickHouse/ClickHouse/pull/22706 rel="external nofollow noreferrer" target=_blank>#22706</a> (<a href=https://github.com/songenjie rel="external nofollow noreferrer" target=_blank>turbo jason</a>).</li> <li>Added a setting <code class=syntax>max_distributed_depth</code> that limits the depth of recursive queries to <code class=syntax>Distributed</code> tables. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20229 rel="external nofollow noreferrer" target=_blank>#20229</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21942 rel="external nofollow noreferrer" target=_blank>#21942</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> </ul> <h4 id=performance-improvement_1>Performance Improvement<a class=headerlink href=#performance-improvement_1 title="Permanent link"> </a></h4> <ul> <li>Improved performance of <code class=syntax>intDiv</code> by dynamic dispatch for AVX2. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22314 rel="external nofollow noreferrer" target=_blank>#22314</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23000 rel="external nofollow noreferrer" target=_blank>#23000</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improved performance of reading from <code class=syntax>ArrowStream</code> input format for sources other then local file (e.g. URL). <a href=https://github.com/ClickHouse/ClickHouse/pull/22673 rel="external nofollow noreferrer" target=_blank>#22673</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>Disabled compression by default when interacting with localhost (with clickhouse-client or server to server with distributed queries) via native protocol. It may improve performance of some import/export operations. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22234 rel="external nofollow noreferrer" target=_blank>#22234</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22237 rel="external nofollow noreferrer" target=_blank>#22237</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Exclude values that does not belong to the shard from right part of IN section for distributed queries (under <code class=syntax>optimize_skip_unused_shards_rewrite_in</code>, enabled by default, since it still requires <code class=syntax>optimize_skip_unused_shards</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/21511 rel="external nofollow noreferrer" target=_blank>#21511</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Improved performance of reading a subset of columns with File-like table engine and column-oriented format like Parquet, Arrow or ORC. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20129 rel="external nofollow noreferrer" target=_blank>#issue:20129</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21302 rel="external nofollow noreferrer" target=_blank>#21302</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> <li>Allow to move more conditions to <code class=syntax>PREWHERE</code> as it was before version 21.1 (adjustment of internal heuristics). Insufficient number of moved condtions could lead to worse performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/23397 rel="external nofollow noreferrer" target=_blank>#23397</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Improved performance of ODBC connections and fixed all the outstanding issues from the backlog. Using <code class=syntax>nanodbc</code> library instead of <code class=syntax>Poco::ODBC</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9678 rel="external nofollow noreferrer" target=_blank>#9678</a>. Add support for DateTime64 and Decimal* for ODBC table engine. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21961 rel="external nofollow noreferrer" target=_blank>#21961</a>. Fixed issue with cyrillic text being truncated. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/16246 rel="external nofollow noreferrer" target=_blank>#16246</a>. Added connection pools for odbc bridge. <a href=https://github.com/ClickHouse/ClickHouse/pull/21972 rel="external nofollow noreferrer" target=_blank>#21972</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> </ul> <h4 id=improvement_1>Improvement<a class=headerlink href=#improvement_1 title="Permanent link"> </a></h4> <ul> <li>Increase <code class=syntax>max_uri_size</code> (the maximum size of URL in HTTP interface) to 1 MiB by default. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21197 rel="external nofollow noreferrer" target=_blank>#21197</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22997 rel="external nofollow noreferrer" target=_blank>#22997</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Set <code class=syntax>background_fetches_pool_size</code> to <code class=syntax>8</code> that is better for production usage with frequent small insertions or slow ZooKeeper cluster. <a href=https://github.com/ClickHouse/ClickHouse/pull/22945 rel="external nofollow noreferrer" target=_blank>#22945</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>FlatDictionary added <code class=syntax>initial_array_size</code>, <code class=syntax>max_array_size</code> options. <a href=https://github.com/ClickHouse/ClickHouse/pull/22521 rel="external nofollow noreferrer" target=_blank>#22521</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add new setting <code class=syntax>non_replicated_deduplication_window</code> for non-replicated MergeTree inserts deduplication. <a href=https://github.com/ClickHouse/ClickHouse/pull/22514 rel="external nofollow noreferrer" target=_blank>#22514</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Update paths to the <code class=syntax>CatBoost</code> model configs in config reloading. <a href=https://github.com/ClickHouse/ClickHouse/pull/22434 rel="external nofollow noreferrer" target=_blank>#22434</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Added <code class=syntax>Decimal256</code> type support in dictionaries. <code class=syntax>Decimal256</code> is experimental feature. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20979 rel="external nofollow noreferrer" target=_blank>#20979</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22960 rel="external nofollow noreferrer" target=_blank>#22960</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Enabled <code class=syntax>async_socket_for_remote</code> by default (using less amount of OS threads for distributed queries). <a href=https://github.com/ClickHouse/ClickHouse/pull/23683 rel="external nofollow noreferrer" target=_blank>#23683</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed <code class=syntax>quantile(s)TDigest</code>. Added special handling of singleton centroids according to tdunning/t-digest 3.2+. Also a bug with over-compression of centroids in implementation of earlier version of the algorithm was fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/23314 rel="external nofollow noreferrer" target=_blank>#23314</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Make function name <code class=syntax>unhex</code> case insensitive for compatibility with MySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/23229 rel="external nofollow noreferrer" target=_blank>#23229</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Implement functions <code class=syntax>arrayHasAny</code>, <code class=syntax>arrayHasAll</code>, <code class=syntax>has</code>, <code class=syntax>indexOf</code>, <code class=syntax>countEqual</code> for generic case when types of array elements are different. In previous versions the functions <code class=syntax>arrayHasAny</code>, <code class=syntax>arrayHasAll</code> returned false and <code class=syntax>has</code>, <code class=syntax>indexOf</code>, <code class=syntax>countEqual</code> thrown exception. Also add support for <code class=syntax>Decimal</code> and big integer types in functions <code class=syntax>has</code> and similar. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20272 rel="external nofollow noreferrer" target=_blank>#20272</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23044 rel="external nofollow noreferrer" target=_blank>#23044</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Raised the threshold on max number of matches in result of the function <code class=syntax>extractAllGroupsHorizontal</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23036 rel="external nofollow noreferrer" target=_blank>#23036</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Do not perform <code class=syntax>optimize_skip_unused_shards</code> for cluster with one node. <a href=https://github.com/ClickHouse/ClickHouse/pull/22999 rel="external nofollow noreferrer" target=_blank>#22999</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Added ability to run clickhouse-keeper (experimental drop-in replacement to ZooKeeper) with SSL. Config settings <code class=syntax>keeper_server.tcp_port_secure</code> can be used for secure interaction between client and keeper-server. <code class=syntax>keeper_server.raft_configuration.secure</code> can be used to enable internal secure communication between nodes. <a href=https://github.com/ClickHouse/ClickHouse/pull/22992 rel="external nofollow noreferrer" target=_blank>#22992</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Added ability to flush buffer only in background for <code class=syntax>Buffer</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/22986 rel="external nofollow noreferrer" target=_blank>#22986</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>When selecting from MergeTree table with NULL in WHERE condition, in rare cases, exception was thrown. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20019 rel="external nofollow noreferrer" target=_blank>#20019</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22978 rel="external nofollow noreferrer" target=_blank>#22978</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix error handling in Poco HTTP Client for AWS. <a href=https://github.com/ClickHouse/ClickHouse/pull/22973 rel="external nofollow noreferrer" target=_blank>#22973</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>).</li> <li>Respect <code class=syntax>max_part_removal_threads</code> for <code class=syntax>ReplicatedMergeTree</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22971 rel="external nofollow noreferrer" target=_blank>#22971</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix obscure corner case of MergeTree settings inactive_parts_to_throw_insert = 0 with inactive_parts_to_delay_insert &gt; 0. <a href=https://github.com/ClickHouse/ClickHouse/pull/22947 rel="external nofollow noreferrer" target=_blank>#22947</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>dateDiff</code> now works with <code class=syntax>DateTime64</code> arguments (even for values outside of <code class=syntax>DateTime</code> range) <a href=https://github.com/ClickHouse/ClickHouse/pull/22931 rel="external nofollow noreferrer" target=_blank>#22931</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>MaterializeMySQL (experimental feature): added an ability to replicate MySQL databases containing views without failing. This is accomplished by ignoring the views. <a href=https://github.com/ClickHouse/ClickHouse/pull/22760 rel="external nofollow noreferrer" target=_blank>#22760</a> (<a href=https://github.com/cfroystad rel="external nofollow noreferrer" target=_blank>Christian</a>).</li> <li>Allow RBAC row policy via postgresql protocol. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22658 rel="external nofollow noreferrer" target=_blank>#22658</a>. PostgreSQL protocol is enabled in configuration by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/22755 rel="external nofollow noreferrer" target=_blank>#22755</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Add metric to track how much time is spend during waiting for Buffer layer lock. <a href=https://github.com/ClickHouse/ClickHouse/pull/22725 rel="external nofollow noreferrer" target=_blank>#22725</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow to use CTE in VIEW definition. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22491 rel="external nofollow noreferrer" target=_blank>#22491</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22657 rel="external nofollow noreferrer" target=_blank>#22657</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Clear the rest of the screen and show cursor in <code class=syntax>clickhouse-client</code> if previous program has left garbage in terminal. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/16518 rel="external nofollow noreferrer" target=_blank>#16518</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22634 rel="external nofollow noreferrer" target=_blank>#22634</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Make <code class=syntax>round</code> function to behave consistently on non-x86_64 platforms. Rounding half to nearest even (Banker's rounding) is used. <a href=https://github.com/ClickHouse/ClickHouse/pull/22582 rel="external nofollow noreferrer" target=_blank>#22582</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Correctly check structure of blocks of data that are sending by Distributed tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/22325 rel="external nofollow noreferrer" target=_blank>#22325</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow publishing Kafka errors to a virtual column of Kafka engine, controlled by the <code class=syntax>kafka_handle_error_mode</code> setting. <a href=https://github.com/ClickHouse/ClickHouse/pull/21850 rel="external nofollow noreferrer" target=_blank>#21850</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Add aliases <code class=syntax>simpleJSONExtract/simpleJSONHas</code> to <code class=syntax>visitParam/visitParamExtract{UInt, Int, Bool, Float, Raw, String}</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21383 rel="external nofollow noreferrer" target=_blank>#21383</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21519 rel="external nofollow noreferrer" target=_blank>#21519</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Add <code class=syntax>clickhouse-library-bridge</code> for library dictionary source. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9502 rel="external nofollow noreferrer" target=_blank>#9502</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21509 rel="external nofollow noreferrer" target=_blank>#21509</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Forbid to drop a column if it's referenced by materialized view. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21164 rel="external nofollow noreferrer" target=_blank>#21164</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21303 rel="external nofollow noreferrer" target=_blank>#21303</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Support dynamic interserver credentials (rotating credentials without downtime). <a href=https://github.com/ClickHouse/ClickHouse/pull/14113 rel="external nofollow noreferrer" target=_blank>#14113</a> (<a href=https://github.com/johnskopis rel="external nofollow noreferrer" target=_blank>johnskopis</a>).</li> <li>Add support for Kafka storage with <code class=syntax>Arrow</code> and <code class=syntax>ArrowStream</code> format messages. <a href=https://github.com/ClickHouse/ClickHouse/pull/23415 rel="external nofollow noreferrer" target=_blank>#23415</a> (<a href=https://github.com/godliness rel="external nofollow noreferrer" target=_blank>Chao Ma</a>).</li> <li>Fixed missing semicolon in exception message. The user may find this exception message unpleasant to read. <a href=https://github.com/ClickHouse/ClickHouse/pull/23208 rel="external nofollow noreferrer" target=_blank>#23208</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed missing whitespace in some exception messages about <code class=syntax>LowCardinality</code> type. <a href=https://github.com/ClickHouse/ClickHouse/pull/23207 rel="external nofollow noreferrer" target=_blank>#23207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Some values were formatted with alignment in center in table cells in <code class=syntax>Markdown</code> format. Not anymore. <a href=https://github.com/ClickHouse/ClickHouse/pull/23096 rel="external nofollow noreferrer" target=_blank>#23096</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove non-essential details from suggestions in clickhouse-client. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22158 rel="external nofollow noreferrer" target=_blank>#22158</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23040 rel="external nofollow noreferrer" target=_blank>#23040</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Correct calculation of <code class=syntax>bytes_allocated</code> field in system.dictionaries for sparse_hashed dictionaries. <a href=https://github.com/ClickHouse/ClickHouse/pull/22867 rel="external nofollow noreferrer" target=_blank>#22867</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed approximate total rows accounting for reverse reading from MergeTree. <a href=https://github.com/ClickHouse/ClickHouse/pull/22726 rel="external nofollow noreferrer" target=_blank>#22726</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix the case when it was possible to configure dictionary with clickhouse source that was looking to itself that leads to infinite loop. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14314 rel="external nofollow noreferrer" target=_blank>#14314</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22479 rel="external nofollow noreferrer" target=_blank>#22479</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> </ul> <h4 id=bug-fix_1>Bug Fix<a class=headerlink href=#bug-fix_1 title="Permanent link"> </a></h4> <ul> <li>Multiple fixes for hedged requests. Fixed an error <code class=syntax>Can't initialize pipeline with empty pipe</code> for queries with <code class=syntax>GLOBAL IN/JOIN</code> when the setting <code class=syntax>use_hedged_requests</code> is enabled. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23431 rel="external nofollow noreferrer" target=_blank>#23431</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23805 rel="external nofollow noreferrer" target=_blank>#23805</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>). Fixed a race condition in hedged connections which leads to crash. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22161 rel="external nofollow noreferrer" target=_blank>#22161</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22443 rel="external nofollow noreferrer" target=_blank>#22443</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>). Fix possible crash in case if <code class=syntax>unknown packet</code> was received from remote query (with <code class=syntax>async_socket_for_remote</code> enabled). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21167 rel="external nofollow noreferrer" target=_blank>#21167</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23309 rel="external nofollow noreferrer" target=_blank>#23309</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed the behavior when disabling <code class=syntax>input_format_with_names_use_header</code> setting discards all the input with CSVWithNames format. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22406 rel="external nofollow noreferrer" target=_blank>#22406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23202 rel="external nofollow noreferrer" target=_blank>#23202</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fixed remote JDBC bridge timeout connection issue. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9609 rel="external nofollow noreferrer" target=_blank>#9609</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23771 rel="external nofollow noreferrer" target=_blank>#23771</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>, <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix the logic of initial load of <code class=syntax>complex_key_hashed</code> if <code class=syntax>update_field</code> is specified. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/23800 rel="external nofollow noreferrer" target=_blank>#23800</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23824 rel="external nofollow noreferrer" target=_blank>#23824</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fixed crash when <code class=syntax>PREWHERE</code> and row policy filter are both in effect with empty result. <a href=https://github.com/ClickHouse/ClickHouse/pull/23763 rel="external nofollow noreferrer" target=_blank>#23763</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Avoid possible "Cannot schedule a task" error (in case some exception had been occurred) on INSERT into Distributed. <a href=https://github.com/ClickHouse/ClickHouse/pull/23744 rel="external nofollow noreferrer" target=_blank>#23744</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Added an exception in case of completely the same values in both samples in aggregate function <code class=syntax>mannWhitneyUTest</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23646 rel="external nofollow noreferrer" target=_blank>#23646</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23654 rel="external nofollow noreferrer" target=_blank>#23654</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fixed server fault when inserting data through HTTP caused an exception. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23512 rel="external nofollow noreferrer" target=_blank>#23512</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23643 rel="external nofollow noreferrer" target=_blank>#23643</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fixed misinterpretation of some <code class=syntax>LIKE</code> expressions with escape sequences. <a href=https://github.com/ClickHouse/ClickHouse/pull/23610 rel="external nofollow noreferrer" target=_blank>#23610</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed restart / stop command hanging. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20214 rel="external nofollow noreferrer" target=_blank>#20214</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23552 rel="external nofollow noreferrer" target=_blank>#23552</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fixed <code class=syntax>COLUMNS</code> matcher in case of multiple JOINs in select query. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22736 rel="external nofollow noreferrer" target=_blank>#22736</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23501 rel="external nofollow noreferrer" target=_blank>#23501</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fixed a crash when modifying column's default value when a column itself is used as <code class=syntax>ReplacingMergeTree</code>'s parameter. <a href=https://github.com/ClickHouse/ClickHouse/pull/23483 rel="external nofollow noreferrer" target=_blank>#23483</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fixed corner cases in vertical merges with <code class=syntax>ReplacingMergeTree</code>. In rare cases they could lead to fails of merges with exceptions like <code class=syntax>Incomplete granules are not allowed while blocks are granules size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23459 rel="external nofollow noreferrer" target=_blank>#23459</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fixed bug that does not allow cast from empty array literal, to array with dimensions greater than 1, e.g. <code class=syntax>CAST([] AS Array(Array(String)))</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14476 rel="external nofollow noreferrer" target=_blank>#14476</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23456 rel="external nofollow noreferrer" target=_blank>#23456</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fixed a bug when <code class=syntax>deltaSum</code> aggregate function produced incorrect result after resetting the counter. <a href=https://github.com/ClickHouse/ClickHouse/pull/23437 rel="external nofollow noreferrer" target=_blank>#23437</a> (<a href=https://github.com/rf rel="external nofollow noreferrer" target=_blank>Russ Frank</a>).</li> <li>Fixed <code class=syntax>Cannot unlink file</code> error on unsuccessful creation of ReplicatedMergeTree table with multidisk configuration. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21755 rel="external nofollow noreferrer" target=_blank>#21755</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23433 rel="external nofollow noreferrer" target=_blank>#23433</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed incompatible constant expression generation during partition pruning based on virtual columns. This fixes <a href=https://github.com/ClickHouse/ClickHouse/pull/21401#discussion_r611888913 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/21401#discussion_r611888913</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23366 rel="external nofollow noreferrer" target=_blank>#23366</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixed a crash when setting join_algorithm is set to 'auto' and Join is performed with a Dictionary. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/23002 rel="external nofollow noreferrer" target=_blank>#23002</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23312 rel="external nofollow noreferrer" target=_blank>#23312</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Don't relax NOT conditions during partition pruning. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23305 rel="external nofollow noreferrer" target=_blank>#23305</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/21539 rel="external nofollow noreferrer" target=_blank>#21539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23310 rel="external nofollow noreferrer" target=_blank>#23310</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixed very rare race condition on background cleanup of old blocks. It might cause a block not to be deduplicated if it's too close to the end of deduplication window. <a href=https://github.com/ClickHouse/ClickHouse/pull/23301 rel="external nofollow noreferrer" target=_blank>#23301</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed very rare (distributed) race condition between creation and removal of ReplicatedMergeTree tables. It might cause exceptions like <code class=syntax>node doesn't exist</code> on attempt to create replicated table. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21419 rel="external nofollow noreferrer" target=_blank>#21419</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23294 rel="external nofollow noreferrer" target=_blank>#23294</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed simple key dictionary from DDL creation if primary key is not first attribute. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/23236 rel="external nofollow noreferrer" target=_blank>#23236</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23262 rel="external nofollow noreferrer" target=_blank>#23262</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fixed reading from ODBC when there are many long column names in a table. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/8853 rel="external nofollow noreferrer" target=_blank>#8853</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23215 rel="external nofollow noreferrer" target=_blank>#23215</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>MaterializeMySQL (experimental feature): fixed <code class=syntax>Not found column</code> error when selecting from <code class=syntax>MaterializeMySQL</code> with condition on key column. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22432 rel="external nofollow noreferrer" target=_blank>#22432</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23200 rel="external nofollow noreferrer" target=_blank>#23200</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Correct aliases handling if subquery was optimized to constant. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22924 rel="external nofollow noreferrer" target=_blank>#22924</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10401 rel="external nofollow noreferrer" target=_blank>#10401</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23191 rel="external nofollow noreferrer" target=_blank>#23191</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Server might fail to start if <code class=syntax>data_type_default_nullable</code> setting is enabled in default profile, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22573 rel="external nofollow noreferrer" target=_blank>#22573</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/23185 rel="external nofollow noreferrer" target=_blank>#23185</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed a crash on shutdown which happened because of wrong accounting of current connections. <a href=https://github.com/ClickHouse/ClickHouse/pull/23154 rel="external nofollow noreferrer" target=_blank>#23154</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fixed <code class=syntax>Table .inner_id... doesn't exist</code> error when selecting from Materialized View after detaching it from Atomic database and attaching back. <a href=https://github.com/ClickHouse/ClickHouse/pull/23047 rel="external nofollow noreferrer" target=_blank>#23047</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix error <code class=syntax>Cannot find column in ActionsDAG result</code> which may happen if subquery uses <code class=syntax>untuple</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22290 rel="external nofollow noreferrer" target=_blank>#22290</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22991 rel="external nofollow noreferrer" target=_blank>#22991</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix usage of constant columns of type <code class=syntax>Map</code> with nullable values. <a href=https://github.com/ClickHouse/ClickHouse/pull/22939 rel="external nofollow noreferrer" target=_blank>#22939</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>fixed <code class=syntax>formatDateTime()</code> on <code class=syntax>DateTime64</code> and "%C" format specifier fixed <code class=syntax>toDateTime64()</code> for large values and non-zero scale. <a href=https://github.com/ClickHouse/ClickHouse/pull/22937 rel="external nofollow noreferrer" target=_blank>#22937</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Fixed a crash when using <code class=syntax>mannWhitneyUTest</code> and <code class=syntax>rankCorr</code> with window functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22728 rel="external nofollow noreferrer" target=_blank>#22728</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22876 rel="external nofollow noreferrer" target=_blank>#22876</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>LIVE VIEW (experimental feature): fixed possible hanging in concurrent DROP/CREATE of TEMPORARY LIVE VIEW in <code class=syntax>TemporaryLiveViewCleaner</code>, <a href=https://gist.github.com/vzakaznikov/0c03195960fc86b56bfe2bc73a90019e rel="external nofollow noreferrer" target=_blank>see</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22858 rel="external nofollow noreferrer" target=_blank>#22858</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fixed pushdown of <code class=syntax>HAVING</code> in case, when filter column is used in aggregation. <a href=https://github.com/ClickHouse/ClickHouse/pull/22763 rel="external nofollow noreferrer" target=_blank>#22763</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fixed possible hangs in Zookeeper requests in case of OOM exception. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22438 rel="external nofollow noreferrer" target=_blank>#22438</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22684 rel="external nofollow noreferrer" target=_blank>#22684</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed wait for mutations on several replicas for ReplicatedMergeTree table engines. Previously, mutation/alter query may finish before mutation actually executed on other replicas. <a href=https://github.com/ClickHouse/ClickHouse/pull/22669 rel="external nofollow noreferrer" target=_blank>#22669</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed exception for Log with nested types without columns in the SELECT clause. <a href=https://github.com/ClickHouse/ClickHouse/pull/22654 rel="external nofollow noreferrer" target=_blank>#22654</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix unlimited wait for auxiliary AWS requests. <a href=https://github.com/ClickHouse/ClickHouse/pull/22594 rel="external nofollow noreferrer" target=_blank>#22594</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Fixed a crash when client closes connection very early <a href=https://github.com/ClickHouse/ClickHouse/issues/22579 rel="external nofollow noreferrer" target=_blank>#22579</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22591 rel="external nofollow noreferrer" target=_blank>#22591</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li><code class=syntax>Map</code> data type (experimental feature): fixed an incorrect formatting of function <code class=syntax>map</code> in distributed queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/22588 rel="external nofollow noreferrer" target=_blank>#22588</a> (<a href=https://github.com/foolchi rel="external nofollow noreferrer" target=_blank>foolchi</a>).</li> <li>Fixed deserialization of empty string without newline at end of TSV format. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20244 rel="external nofollow noreferrer" target=_blank>#20244</a>. Possible workaround without version update: set <code class=syntax>input_format_null_as_default</code> to zero. It was zero in old versions. <a href=https://github.com/ClickHouse/ClickHouse/pull/22527 rel="external nofollow noreferrer" target=_blank>#22527</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed wrong cast of a column of <code class=syntax>LowCardinality</code> type in Merge Join algorithm. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/22386 rel="external nofollow noreferrer" target=_blank>#22386</a>, close <a href=https://github.com/ClickHouse/ClickHouse/issues/22388 rel="external nofollow noreferrer" target=_blank>#22388</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22510 rel="external nofollow noreferrer" target=_blank>#22510</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Buffer overflow (on read) was possible in <code class=syntax>tokenbf_v1</code> full text index. The excessive bytes are not used but the read operation may lead to crash in rare cases. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19233 rel="external nofollow noreferrer" target=_blank>#19233</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22421 rel="external nofollow noreferrer" target=_blank>#22421</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Do not limit HTTP chunk size. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21907 rel="external nofollow noreferrer" target=_blank>#21907</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22322 rel="external nofollow noreferrer" target=_blank>#22322</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Fixed a bug, which leads to underaggregation of data in case of enabled <code class=syntax>optimize_aggregation_in_order</code> and many parts in table. Slightly improve performance of aggregation with enabled <code class=syntax>optimize_aggregation_in_order</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21889 rel="external nofollow noreferrer" target=_blank>#21889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Check if table function view is used as a column. This complements #20350. <a href=https://github.com/ClickHouse/ClickHouse/pull/21465 rel="external nofollow noreferrer" target=_blank>#21465</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix "unknown column" error for tables with <code class=syntax>Merge</code> engine in queris with <code class=syntax>JOIN</code> and aggregation. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18368 rel="external nofollow noreferrer" target=_blank>#18368</a>, close <a href=https://github.com/ClickHouse/ClickHouse/issues/22226 rel="external nofollow noreferrer" target=_blank>#22226</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21370 rel="external nofollow noreferrer" target=_blank>#21370</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Fixed name clashes in pushdown optimization. It caused incorrect <code class=syntax>WHERE</code> filtration after FULL JOIN. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/20497 rel="external nofollow noreferrer" target=_blank>#20497</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20622 rel="external nofollow noreferrer" target=_blank>#20622</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Fixed very rare bug when quorum insert with <code class=syntax>quorum_parallel=1</code> is not really "quorum" because of deduplication. <a href=https://github.com/ClickHouse/ClickHouse/pull/18215 rel="external nofollow noreferrer" target=_blank>#18215</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a> - reported, <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a> - fixed).</li> </ul> <h4 id=build-testing-packaging-improvement_1>Build/Testing/Packaging Improvement<a class=headerlink href=#build-testing-packaging-improvement_1 title="Permanent link"> </a></h4> <ul> <li>Run stateless tests in parallel in CI. <a href=https://github.com/ClickHouse/ClickHouse/pull/22300 rel="external nofollow noreferrer" target=_blank>#22300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Simplify debian packages. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21698 rel="external nofollow noreferrer" target=_blank>#21698</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22976 rel="external nofollow noreferrer" target=_blank>#22976</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Added support for ClickHouse build on Apple M1. <a href=https://github.com/ClickHouse/ClickHouse/pull/21639 rel="external nofollow noreferrer" target=_blank>#21639</a> (<a href=https://github.com/changvvb rel="external nofollow noreferrer" target=_blank>changvvb</a>).</li> <li>Fixed ClickHouse Keeper build for MacOS. <a href=https://github.com/ClickHouse/ClickHouse/pull/22860 rel="external nofollow noreferrer" target=_blank>#22860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed some tests on AArch64 platform. <a href=https://github.com/ClickHouse/ClickHouse/pull/22596 rel="external nofollow noreferrer" target=_blank>#22596</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Added function alignment for possibly better performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/21431 rel="external nofollow noreferrer" target=_blank>#21431</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>).</li> <li>Adjust some tests to output identical results on amd64 and aarch64 (qemu). The result was depending on implementation specific CPU behaviour. <a href=https://github.com/ClickHouse/ClickHouse/pull/22590 rel="external nofollow noreferrer" target=_blank>#22590</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow query profiling only on x86_64. See <a href=https://github.com/ClickHouse/ClickHouse/issues/15174#issuecomment-812954965 rel="external nofollow noreferrer" target=_blank>#15174</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/15638#issuecomment-703805337 rel="external nofollow noreferrer" target=_blank>#15638</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/15638 rel="external nofollow noreferrer" target=_blank>#15638</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22580 rel="external nofollow noreferrer" target=_blank>#22580</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow building with unbundled xz (lzma) using <code class=syntax>USE_INTERNAL_XZ_LIBRARY=OFF</code> CMake option. <a href=https://github.com/ClickHouse/ClickHouse/pull/22571 rel="external nofollow noreferrer" target=_blank>#22571</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>).</li> <li>Enable bundled <code class=syntax>openldap</code> on <code class=syntax>ppc64le</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/22487 rel="external nofollow noreferrer" target=_blank>#22487</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>).</li> <li>Disable incompatible libraries (platform specific typically) on <code class=syntax>ppc64le</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/22475 rel="external nofollow noreferrer" target=_blank>#22475</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>).</li> <li>Add Jepsen test in CI for clickhouse Keeper. <a href=https://github.com/ClickHouse/ClickHouse/pull/22373 rel="external nofollow noreferrer" target=_blank>#22373</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Build <code class=syntax>jemalloc</code> with support for <a href=https://github.com/jemalloc/jemalloc/wiki/Use-Case%3A-Heap-Profiling rel="external nofollow noreferrer" target=_blank>heap profiling</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22834 rel="external nofollow noreferrer" target=_blank>#22834</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>Avoid UB in <code class=syntax>*Log</code> engines for rwlock unlock due to unlock from another thread. <a href=https://github.com/ClickHouse/ClickHouse/pull/22583 rel="external nofollow noreferrer" target=_blank>#22583</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed UB by unlocking the rwlock of the TinyLog from the same thread. <a href=https://github.com/ClickHouse/ClickHouse/pull/22560 rel="external nofollow noreferrer" target=_blank>#22560</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h2 id=clickhouse-release-21-4>ClickHouse release 21.4<a class=headerlink href=#clickhouse-release-21-4 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-21-4-1-2021-04-12>ClickHouse release 21.4.1 2021-04-12<a class=headerlink href=#clickhouse-release-21-4-1-2021-04-12 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change_1>Backward Incompatible Change<a class=headerlink href=#backward-incompatible-change_1 title="Permanent link"> </a></h4> <ul> <li>The <code class=syntax>toStartOfIntervalFunction</code> will align hour intervals to the midnight (in previous versions they were aligned to the start of unix epoch). For example, <code class=syntax>toStartOfInterval(x, INTERVAL 11 HOUR)</code> will split every day into three intervals: <code class=syntax>00:00:00..10:59:59</code>, <code class=syntax>11:00:00..21:59:59</code> and <code class=syntax>22:00:00..23:59:59</code>. This behaviour is more suited for practical needs. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9510 rel="external nofollow noreferrer" target=_blank>#9510</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22060 rel="external nofollow noreferrer" target=_blank>#22060</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>Age</code> and <code class=syntax>Precision</code> in graphite rollup configs should increase from retention to retention. Now it's checked and the wrong config raises an exception. <a href=https://github.com/ClickHouse/ClickHouse/pull/21496 rel="external nofollow noreferrer" target=_blank>#21496</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>).</li> <li>Fix <code class=syntax>cutToFirstSignificantSubdomainCustom()</code>/<code class=syntax>firstSignificantSubdomainCustom()</code> returning wrong result for 3+ level domains present in custom top-level domain list. For input domains matching these custom top-level domains, the third-level domain was considered to be the first significant one. This is now fixed. This change may introduce incompatibility if the function is used in e.g. the sharding key. <a href=https://github.com/ClickHouse/ClickHouse/pull/21946 rel="external nofollow noreferrer" target=_blank>#21946</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Column <code class=syntax>keys</code> in table <code class=syntax>system.dictionaries</code> was replaced to columns <code class=syntax>key.names</code> and <code class=syntax>key.types</code>. Columns <code class=syntax>key.names</code>, <code class=syntax>key.types</code>, <code class=syntax>attribute.names</code>, <code class=syntax>attribute.types</code> from <code class=syntax>system.dictionaries</code> table does not require dictionary to be loaded. <a href=https://github.com/ClickHouse/ClickHouse/pull/21884 rel="external nofollow noreferrer" target=_blank>#21884</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Now replicas that are processing the <code class=syntax>ALTER TABLE ATTACH PART[ITION]</code> command search in their <code class=syntax>detached/</code> folders before fetching the data from other replicas. As an implementation detail, a new command <code class=syntax>ATTACH_PART</code> is introduced in the replicated log. Parts are searched and compared by their checksums. <a href=https://github.com/ClickHouse/ClickHouse/pull/18978 rel="external nofollow noreferrer" target=_blank>#18978</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike Kot</a>). <strong>Note</strong>:</li> <li><code class=syntax>ATTACH PART[ITION]</code> queries may not work during cluster upgrade.</li> <li>It's not possible to rollback to older ClickHouse version after executing <code class=syntax>ALTER ... ATTACH</code> query in new version as the old servers would fail to pass the <code class=syntax>ATTACH_PART</code> entry in the replicated log.</li> <li>In this version, empty <code class=syntax>&lt;remote_url_allow_hosts&gt;&lt;/remote_url_allow_hosts&gt;</code> will block all access to remote hosts while in previous versions it did nothing. If you want to keep old behaviour and you have empty <code class=syntax>remote_url_allow_hosts</code> element in configuration file, remove it. <a href=https://github.com/ClickHouse/ClickHouse/pull/20058 rel="external nofollow noreferrer" target=_blank>#20058</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> </ul> <h4 id=new-feature_2>New Feature<a class=headerlink href=#new-feature_2 title="Permanent link"> </a></h4> <ul> <li>Extended range of <code class=syntax>DateTime64</code> to support dates from year 1925 to 2283. Improved support of <code class=syntax>DateTime</code> around zero date (<code class=syntax>1970-01-01</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9404 rel="external nofollow noreferrer" target=_blank>#9404</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>, <a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>). Not every time and date functions are working for extended range of dates.</li> <li>Added support of Kerberos authentication for preconfigured users and HTTP requests (GSS-SPNEGO). <a href=https://github.com/ClickHouse/ClickHouse/pull/14995 rel="external nofollow noreferrer" target=_blank>#14995</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Add <code class=syntax>prefer_column_name_to_alias</code> setting to use original column names instead of aliases. it is needed to be more compatible with common databases' aliasing rules. This is for <a href=https://github.com/ClickHouse/ClickHouse/issues/9715 rel="external nofollow noreferrer" target=_blank>#9715</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/9887 rel="external nofollow noreferrer" target=_blank>#9887</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22044 rel="external nofollow noreferrer" target=_blank>#22044</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added functions <code class=syntax>dictGetChildren(dictionary, key)</code>, <code class=syntax>dictGetDescendants(dictionary, key, level)</code>. Function <code class=syntax>dictGetChildren</code> return all children as an array if indexes. It is a inverse transformation for <code class=syntax>dictGetHierarchy</code>. Function <code class=syntax>dictGetDescendants</code> return all descendants as if <code class=syntax>dictGetChildren</code> was applied <code class=syntax>level</code> times recursively. Zero <code class=syntax>level</code> value is equivalent to infinity. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14656 rel="external nofollow noreferrer" target=_blank>#14656</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22096 rel="external nofollow noreferrer" target=_blank>#22096</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added <code class=syntax>executable_pool</code> dictionary source. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/14528 rel="external nofollow noreferrer" target=_blank>#14528</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21321 rel="external nofollow noreferrer" target=_blank>#21321</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added table function <code class=syntax>dictionary</code>. It works the same way as <code class=syntax>Dictionary</code> engine. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21560 rel="external nofollow noreferrer" target=_blank>#21560</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21910 rel="external nofollow noreferrer" target=_blank>#21910</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Support <code class=syntax>Nullable</code> type for <code class=syntax>PolygonDictionary</code> attribute. <a href=https://github.com/ClickHouse/ClickHouse/pull/21890 rel="external nofollow noreferrer" target=_blank>#21890</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Functions <code class=syntax>dictGet</code>, <code class=syntax>dictHas</code> use current database name if it is not specified for dictionaries created with DDL. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21632 rel="external nofollow noreferrer" target=_blank>#21632</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21859 rel="external nofollow noreferrer" target=_blank>#21859</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added function <code class=syntax>dictGetOrNull</code>. It works like <code class=syntax>dictGet</code>, but return <code class=syntax>Null</code> in case key was not found in dictionary. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22375 rel="external nofollow noreferrer" target=_blank>#22375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22413 rel="external nofollow noreferrer" target=_blank>#22413</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added async update in <code class=syntax>ComplexKeyCache</code>, <code class=syntax>SSDCache</code>, <code class=syntax>SSDComplexKeyCache</code> dictionaries. Added support for <code class=syntax>Nullable</code> type in <code class=syntax>Cache</code>, <code class=syntax>ComplexKeyCache</code>, <code class=syntax>SSDCache</code>, <code class=syntax>SSDComplexKeyCache</code> dictionaries. Added support for multiple attributes fetch with <code class=syntax>dictGet</code>, <code class=syntax>dictGetOrDefault</code> functions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21517 rel="external nofollow noreferrer" target=_blank>#21517</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20595 rel="external nofollow noreferrer" target=_blank>#20595</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Support <code class=syntax>dictHas</code> function for <code class=syntax>RangeHashedDictionary</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6680 rel="external nofollow noreferrer" target=_blank>#6680</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19816 rel="external nofollow noreferrer" target=_blank>#19816</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add function <code class=syntax>timezoneOf</code> that returns the timezone name of <code class=syntax>DateTime</code> or <code class=syntax>DateTime64</code> data types. This does not close <a href=https://github.com/ClickHouse/ClickHouse/issues/9959 rel="external nofollow noreferrer" target=_blank>#9959</a>. Fix inconsistencies in function names: add aliases <code class=syntax>timezone</code> and <code class=syntax>timeZone</code> as well as <code class=syntax>toTimezone</code> and <code class=syntax>toTimeZone</code> and <code class=syntax>timezoneOf</code> and <code class=syntax>timeZoneOf</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22001 rel="external nofollow noreferrer" target=_blank>#22001</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add new optional clause <code class=syntax>GRANTEES</code> for <code class=syntax>CREATE/ALTER USER</code> commands. It specifies users or roles which are allowed to receive grants from this user on condition this user has also all required access granted with grant option. By default <code class=syntax>GRANTEES ANY</code> is used which means a user with grant option can grant to anyone. Syntax: <code class=syntax>CREATE USER ... GRANTEES {user | role | ANY | NONE} [,...] [EXCEPT {user | role} [,...]]</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21641 rel="external nofollow noreferrer" target=_blank>#21641</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Add new column <code class=syntax>slowdowns_count</code> to <code class=syntax>system.clusters</code>. When using hedged requests, it shows how many times we switched to another replica because this replica was responding slowly. Also show actual value of <code class=syntax>errors_count</code> in <code class=syntax>system.clusters</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21480 rel="external nofollow noreferrer" target=_blank>#21480</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Add <code class=syntax>_partition_id</code> virtual column for <code class=syntax>MergeTree*</code> engines. Allow to prune partitions by <code class=syntax>_partition_id</code>. Add <code class=syntax>partitionID()</code> function to calculate partition id string. <a href=https://github.com/ClickHouse/ClickHouse/pull/21401 rel="external nofollow noreferrer" target=_blank>#21401</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add function <code class=syntax>isIPAddressInRange</code> to test if an IPv4 or IPv6 address is contained in a given CIDR network prefix. <a href=https://github.com/ClickHouse/ClickHouse/pull/21329 rel="external nofollow noreferrer" target=_blank>#21329</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>Added new SQL command <code class=syntax>ALTER TABLE 'table_name' UNFREEZE [PARTITION 'part_expr'] WITH NAME 'backup_name'</code>. This command is needed to properly remove 'freezed' partitions from all disks. <a href=https://github.com/ClickHouse/ClickHouse/pull/21142 rel="external nofollow noreferrer" target=_blank>#21142</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Supports implicit key type conversion for JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/19885 rel="external nofollow noreferrer" target=_blank>#19885</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> </ul> <h4 id=experimental-feature_1>Experimental Feature<a class=headerlink href=#experimental-feature_1 title="Permanent link"> </a></h4> <ul> <li>Support <code class=syntax>RANGE OFFSET</code> frame (for window functions) for floating point types. Implement <code class=syntax>lagInFrame</code>/<code class=syntax>leadInFrame</code> window functions, which are analogous to <code class=syntax>lag</code>/<code class=syntax>lead</code>, but respect the window frame. They are identical when the frame is <code class=syntax>between unbounded preceding and unbounded following</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/5485 rel="external nofollow noreferrer" target=_blank>#5485</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21895 rel="external nofollow noreferrer" target=_blank>#21895</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Zero-copy replication for <code class=syntax>ReplicatedMergeTree</code> over S3 storage. <a href=https://github.com/ClickHouse/ClickHouse/pull/16240 rel="external nofollow noreferrer" target=_blank>#16240</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>Added possibility to migrate existing S3 disk to the schema with backup-restore capabilities. <a href=https://github.com/ClickHouse/ClickHouse/pull/22070 rel="external nofollow noreferrer" target=_blank>#22070</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> </ul> <h4 id=performance-improvement_2>Performance Improvement<a class=headerlink href=#performance-improvement_2 title="Permanent link"> </a></h4> <ul> <li>Supported parallel formatting in <code class=syntax>clickhouse-local</code> and everywhere else. <a href=https://github.com/ClickHouse/ClickHouse/pull/21630 rel="external nofollow noreferrer" target=_blank>#21630</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Support parallel parsing for <code class=syntax>CSVWithNames</code> and <code class=syntax>TSVWithNames</code> formats. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21085 rel="external nofollow noreferrer" target=_blank>#21085</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21149 rel="external nofollow noreferrer" target=_blank>#21149</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Enable read with mmap IO for file ranges from 64 MiB (the settings <code class=syntax>min_bytes_to_use_mmap_io</code>). It may lead to moderate performance improvement. <a href=https://github.com/ClickHouse/ClickHouse/pull/22326 rel="external nofollow noreferrer" target=_blank>#22326</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add cache for files read with <code class=syntax>min_bytes_to_use_mmap_io</code> setting. It makes significant (2x and more) performance improvement when the value of the setting is small by avoiding frequent mmap/munmap calls and the consequent page faults. Note that mmap IO has major drawbacks that makes it less reliable in production (e.g. hung or SIGBUS on faulty disks; less controllable memory usage). Nevertheless it is good in benchmarks. <a href=https://github.com/ClickHouse/ClickHouse/pull/22206 rel="external nofollow noreferrer" target=_blank>#22206</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Avoid unnecessary data copy when using codec <code class=syntax>NONE</code>. Please note that codec <code class=syntax>NONE</code> is mostly useless - it's recommended to always use compression (<code class=syntax>LZ4</code> is by default). Despite the common belief, disabling compression may not improve performance (the opposite effect is possible). The <code class=syntax>NONE</code> codec is useful in some cases: - when data is uncompressable; - for synthetic benchmarks. <a href=https://github.com/ClickHouse/ClickHouse/pull/22145 rel="external nofollow noreferrer" target=_blank>#22145</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Faster <code class=syntax>GROUP BY</code> with small <code class=syntax>max_rows_to_group_by</code> and <code class=syntax>group_by_overflow_mode='any'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21856 rel="external nofollow noreferrer" target=_blank>#21856</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Optimize performance of queries like <code class=syntax>SELECT ... FINAL ... WHERE</code>. Now in queries with <code class=syntax>FINAL</code> it's allowed to move to <code class=syntax>PREWHERE</code> columns, which are in sorting key. <a href=https://github.com/ClickHouse/ClickHouse/pull/21830 rel="external nofollow noreferrer" target=_blank>#21830</a> (<a href=https://github.com/foolchi rel="external nofollow noreferrer" target=_blank>foolchi</a>).</li> <li>Improved performance by replacing <code class=syntax>memcpy</code> to another implementation. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18583 rel="external nofollow noreferrer" target=_blank>#18583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21520 rel="external nofollow noreferrer" target=_blank>#21520</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve performance of aggregation in order of sorting key (with enabled setting <code class=syntax>optimize_aggregation_in_order</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/19401 rel="external nofollow noreferrer" target=_blank>#19401</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=improvement_2>Improvement<a class=headerlink href=#improvement_2 title="Permanent link"> </a></h4> <ul> <li>Add connection pool for PostgreSQL table/database engine and dictionary source. Should fix <a href=https://github.com/ClickHouse/ClickHouse/issues/21444 rel="external nofollow noreferrer" target=_blank>#21444</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21839 rel="external nofollow noreferrer" target=_blank>#21839</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Support non-default table schema for postgres storage/table-function. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21701 rel="external nofollow noreferrer" target=_blank>#21701</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21711 rel="external nofollow noreferrer" target=_blank>#21711</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Support replicas priority for postgres dictionary source. <a href=https://github.com/ClickHouse/ClickHouse/pull/21710 rel="external nofollow noreferrer" target=_blank>#21710</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Introduce a new merge tree setting <code class=syntax>min_bytes_to_rebalance_partition_over_jbod</code> which allows assigning new parts to different disks of a JBOD volume in a balanced way. <a href=https://github.com/ClickHouse/ClickHouse/pull/16481 rel="external nofollow noreferrer" target=_blank>#16481</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added <code class=syntax>Grant</code>, <code class=syntax>Revoke</code> and <code class=syntax>System</code> values of <code class=syntax>query_kind</code> column for corresponding queries in <code class=syntax>system.query_log</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21102 rel="external nofollow noreferrer" target=_blank>#21102</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Allow customizing timeouts for HTTP connections used for replication independently from other HTTP timeouts. <a href=https://github.com/ClickHouse/ClickHouse/pull/20088 rel="external nofollow noreferrer" target=_blank>#20088</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>Better exception message in client in case of exception while server is writing blocks. In previous versions client may get misleading message like <code class=syntax>Data compressed with different methods</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22427 rel="external nofollow noreferrer" target=_blank>#22427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix error <code class=syntax>Directory tmp_fetch_XXX already exists</code> which could happen after failed fetch part. Delete temporary fetch directory if it already exists. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14197 rel="external nofollow noreferrer" target=_blank>#14197</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22411 rel="external nofollow noreferrer" target=_blank>#22411</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>Fix MSan report for function <code class=syntax>range</code> with <code class=syntax>UInt256</code> argument (support for large integers is experimental). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22157 rel="external nofollow noreferrer" target=_blank>#22157</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22387 rel="external nofollow noreferrer" target=_blank>#22387</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add <code class=syntax>current_database</code> column to <code class=syntax>system.processes</code> table. It contains the current database of the query. <a href=https://github.com/ClickHouse/ClickHouse/pull/22365 rel="external nofollow noreferrer" target=_blank>#22365</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Add case-insensitive history search/navigation and subword movement features to <code class=syntax>clickhouse-client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22105 rel="external nofollow noreferrer" target=_blank>#22105</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>If tuple of NULLs, e.g. <code class=syntax>(NULL, NULL)</code> is on the left hand side of <code class=syntax>IN</code> operator with tuples of non-NULLs on the right hand side, e.g. <code class=syntax>SELECT (NULL, NULL) IN ((0, 0), (3, 1))</code> return 0 instead of throwing an exception about incompatible types. The expression may also appear due to optimization of something like <code class=syntax>SELECT (NULL, NULL) = (8, 0) OR (NULL, NULL) = (3, 2) OR (NULL, NULL) = (0, 0) OR (NULL, NULL) = (3, 1)</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22017 rel="external nofollow noreferrer" target=_blank>#22017</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22063 rel="external nofollow noreferrer" target=_blank>#22063</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Update used version of simdjson to 0.9.1. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21984 rel="external nofollow noreferrer" target=_blank>#21984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22057 rel="external nofollow noreferrer" target=_blank>#22057</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Added case insensitive aliases for <code class=syntax>CONNECTION_ID()</code> and <code class=syntax>VERSION()</code> functions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22028 rel="external nofollow noreferrer" target=_blank>#22028</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22042 rel="external nofollow noreferrer" target=_blank>#22042</a> (<a href=https://github.com/Slach rel="external nofollow noreferrer" target=_blank>Eugene Klimov</a>).</li> <li>Add option <code class=syntax>strict_increase</code> to <code class=syntax>windowFunnel</code> function to calculate each event once (resolve <a href=https://github.com/ClickHouse/ClickHouse/issues/21835 rel="external nofollow noreferrer" target=_blank>#21835</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/22025 rel="external nofollow noreferrer" target=_blank>#22025</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>If partition key of a <code class=syntax>MergeTree</code> table does not include <code class=syntax>Date</code> or <code class=syntax>DateTime</code> columns but includes exactly one <code class=syntax>DateTime64</code> column, expose its values in the <code class=syntax>min_time</code> and <code class=syntax>max_time</code> columns in <code class=syntax>system.parts</code> and <code class=syntax>system.parts_columns</code> tables. Add <code class=syntax>min_time</code> and <code class=syntax>max_time</code> columns to <code class=syntax>system.parts_columns</code> table (these was inconsistency to the <code class=syntax>system.parts</code> table). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18244 rel="external nofollow noreferrer" target=_blank>#18244</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22011 rel="external nofollow noreferrer" target=_blank>#22011</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Supported <code class=syntax>replication_alter_partitions_sync=1</code> setting in <code class=syntax>clickhouse-copier</code> for moving partitions from helping table to destination. Decreased default timeouts. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21911 rel="external nofollow noreferrer" target=_blank>#21911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21912 rel="external nofollow noreferrer" target=_blank>#21912</a> (<a href=https://github.com/songenjie rel="external nofollow noreferrer" target=_blank>turbo jason</a>).</li> <li>Show path to data directory of <code class=syntax>EmbeddedRocksDB</code> tables in system tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/21903 rel="external nofollow noreferrer" target=_blank>#21903</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Add profile event <code class=syntax>HedgedRequestsChangeReplica</code>, change read data timeout from sec to ms. <a href=https://github.com/ClickHouse/ClickHouse/pull/21886 rel="external nofollow noreferrer" target=_blank>#21886</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>DiskS3 (experimental feature under development). Fixed bug with the impossibility to move directory if the destination is not empty and cache disk is used. <a href=https://github.com/ClickHouse/ClickHouse/pull/21837 rel="external nofollow noreferrer" target=_blank>#21837</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Better formatting for <code class=syntax>Array</code> and <code class=syntax>Map</code> data types in Web UI. <a href=https://github.com/ClickHouse/ClickHouse/pull/21798 rel="external nofollow noreferrer" target=_blank>#21798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Update clusters only if their configurations were updated. <a href=https://github.com/ClickHouse/ClickHouse/pull/21685 rel="external nofollow noreferrer" target=_blank>#21685</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Propagate query and session settings for distributed DDL queries. Set <code class=syntax>distributed_ddl_entry_format_version</code> to 2 to enable this. Added <code class=syntax>distributed_ddl_output_mode</code> setting. Supported modes: <code class=syntax>none</code>, <code class=syntax>throw</code> (default), <code class=syntax>null_status_on_timeout</code> and <code class=syntax>never_throw</code>. Miscellaneous fixes and improvements for <code class=syntax>Replicated</code> database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/21535 rel="external nofollow noreferrer" target=_blank>#21535</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>If <code class=syntax>PODArray</code> was instantiated with element size that is neither a fraction or a multiple of 16, buffer overflow was possible. No bugs in current releases exist. <a href=https://github.com/ClickHouse/ClickHouse/pull/21533 rel="external nofollow noreferrer" target=_blank>#21533</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add <code class=syntax>last_error_time</code>/<code class=syntax>last_error_message</code>/<code class=syntax>last_error_stacktrace</code>/<code class=syntax>remote</code> columns for <code class=syntax>system.errors</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21529 rel="external nofollow noreferrer" target=_blank>#21529</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add aliases <code class=syntax>simpleJSONExtract/simpleJSONHas</code> to <code class=syntax>visitParam/visitParamExtract{UInt, Int, Bool, Float, Raw, String}</code>. Fixes #21383. <a href=https://github.com/ClickHouse/ClickHouse/pull/21519 rel="external nofollow noreferrer" target=_blank>#21519</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Add setting <code class=syntax>optimize_skip_unused_shards_limit</code> to limit the number of sharding key values for <code class=syntax>optimize_skip_unused_shards</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21512 rel="external nofollow noreferrer" target=_blank>#21512</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Improve <code class=syntax>clickhouse-format</code> to not throw exception when there are extra spaces or comment after the last query, and throw exception early with readable message when format <code class=syntax>ASTInsertQuery</code> with data . <a href=https://github.com/ClickHouse/ClickHouse/pull/21311 rel="external nofollow noreferrer" target=_blank>#21311</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Improve support of integer keys in data type <code class=syntax>Map</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21157 rel="external nofollow noreferrer" target=_blank>#21157</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>MaterializeMySQL: attempt to reconnect to MySQL if the connection is lost. <a href=https://github.com/ClickHouse/ClickHouse/pull/20961 rel="external nofollow noreferrer" target=_blank>#20961</a> (<a href=https://github.com/havardk rel="external nofollow noreferrer" target=_blank>Håvard Kvålen</a>).</li> <li>Support more cases to rewrite <code class=syntax>CROSS JOIN</code> to <code class=syntax>INNER JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20392 rel="external nofollow noreferrer" target=_blank>#20392</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Do not create empty parts on INSERT when <code class=syntax>optimize_on_insert</code> setting enabled. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20304 rel="external nofollow noreferrer" target=_blank>#20304</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20387 rel="external nofollow noreferrer" target=_blank>#20387</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li><code class=syntax>MaterializeMySQL</code>: add minmax skipping index for <code class=syntax>_version</code> column. <a href=https://github.com/ClickHouse/ClickHouse/pull/20382 rel="external nofollow noreferrer" target=_blank>#20382</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Add option <code class=syntax>--backslash</code> for <code class=syntax>clickhouse-format</code>, which can add a backslash at the end of each line of the formatted query. <a href=https://github.com/ClickHouse/ClickHouse/pull/21494 rel="external nofollow noreferrer" target=_blank>#21494</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Now clickhouse will not throw <code class=syntax>LOGICAL_ERROR</code> exception when we try to mutate the already covered part. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22013 rel="external nofollow noreferrer" target=_blank>#22013</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22291 rel="external nofollow noreferrer" target=_blank>#22291</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h4 id=bug-fix_2>Bug Fix<a class=headerlink href=#bug-fix_2 title="Permanent link"> </a></h4> <ul> <li>Remove socket from epoll before cancelling packet receiver in <code class=syntax>HedgedConnections</code> to prevent possible race. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/22161 rel="external nofollow noreferrer" target=_blank>#22161</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22443 rel="external nofollow noreferrer" target=_blank>#22443</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Add (missing) memory accounting in parallel parsing routines. In previous versions OOM was possible when the resultset contains very large blocks of data. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22008 rel="external nofollow noreferrer" target=_blank>#22008</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22425 rel="external nofollow noreferrer" target=_blank>#22425</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix exception which may happen when <code class=syntax>SELECT</code> has constant <code class=syntax>WHERE</code> condition and source table has columns which names are digits. <a href=https://github.com/ClickHouse/ClickHouse/pull/22270 rel="external nofollow noreferrer" target=_blank>#22270</a> (<a href=https://github.com/liuneng1994 rel="external nofollow noreferrer" target=_blank>LiuNeng</a>).</li> <li>Fix query cancellation with <code class=syntax>use_hedged_requests=0</code> and <code class=syntax>async_socket_for_remote=1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22183 rel="external nofollow noreferrer" target=_blank>#22183</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix uncaught exception in <code class=syntax>InterserverIOHTTPHandler</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22146 rel="external nofollow noreferrer" target=_blank>#22146</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix docker entrypoint in case <code class=syntax>http_port</code> is not in the config. <a href=https://github.com/ClickHouse/ClickHouse/pull/22132 rel="external nofollow noreferrer" target=_blank>#22132</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li> <li>Fix error <code class=syntax>Invalid number of rows in Chunk</code> in <code class=syntax>JOIN</code> with <code class=syntax>TOTALS</code> and <code class=syntax>arrayJoin</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19303 rel="external nofollow noreferrer" target=_blank>#19303</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22129 rel="external nofollow noreferrer" target=_blank>#22129</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Fix the background thread pool name which used to poll message from Kafka. The Kafka engine with the broken thread pool will not consume the message from message queue. <a href=https://github.com/ClickHouse/ClickHouse/pull/22122 rel="external nofollow noreferrer" target=_blank>#22122</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix waiting for <code class=syntax>OPTIMIZE</code> and <code class=syntax>ALTER</code> queries for <code class=syntax>ReplicatedMergeTree</code> table engines. Now the query will not hang when the table was detached or restarted. <a href=https://github.com/ClickHouse/ClickHouse/pull/22118 rel="external nofollow noreferrer" target=_blank>#22118</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Disable <code class=syntax>async_socket_for_remote</code>/<code class=syntax>use_hedged_requests</code> for buggy Linux kernels. <a href=https://github.com/ClickHouse/ClickHouse/pull/22109 rel="external nofollow noreferrer" target=_blank>#22109</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Docker entrypoint: avoid chown of <code class=syntax>.</code> in case when <code class=syntax>LOG_PATH</code> is empty. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/22100 rel="external nofollow noreferrer" target=_blank>#22100</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22102 rel="external nofollow noreferrer" target=_blank>#22102</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>The function <code class=syntax>decrypt</code> was lacking a check for the minimal size of data encrypted in <code class=syntax>AEAD</code> mode. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21897 rel="external nofollow noreferrer" target=_blank>#21897</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22064 rel="external nofollow noreferrer" target=_blank>#22064</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>In rare case, merge for <code class=syntax>CollapsingMergeTree</code> may create granule with <code class=syntax>index_granularity + 1</code> rows. Because of this, internal check, added in <a href=https://github.com/ClickHouse/ClickHouse/issues/18928 rel="external nofollow noreferrer" target=_blank>#18928</a> (affects 21.2 and 21.3), may fail with error <code class=syntax>Incomplete granules are not allowed while blocks are granules size</code>. This error did not allow parts to merge. <a href=https://github.com/ClickHouse/ClickHouse/pull/21976 rel="external nofollow noreferrer" target=_blank>#21976</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Reverted <a href=https://github.com/ClickHouse/ClickHouse/issues/15454 rel="external nofollow noreferrer" target=_blank>#15454</a> that may cause significant increase in memory usage while loading external dictionaries of hashed type. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21935 rel="external nofollow noreferrer" target=_blank>#21935</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21948 rel="external nofollow noreferrer" target=_blank>#21948</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Prevent hedged connections overlaps (<code class=syntax>Unknown packet 9 from server</code> error). <a href=https://github.com/ClickHouse/ClickHouse/pull/21941 rel="external nofollow noreferrer" target=_blank>#21941</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix reading the HTTP POST request with "multipart/form-data" content type in some cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/21936 rel="external nofollow noreferrer" target=_blank>#21936</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Fix wrong <code class=syntax>ORDER BY</code> results when a query contains window functions, and optimization for reading in primary key order is applied. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21828 rel="external nofollow noreferrer" target=_blank>#21828</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21915 rel="external nofollow noreferrer" target=_blank>#21915</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Fix deadlock in first catboost model execution. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13832 rel="external nofollow noreferrer" target=_blank>#13832</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21844 rel="external nofollow noreferrer" target=_blank>#21844</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Fix incorrect query result (and possible crash) which could happen when <code class=syntax>WHERE</code> or <code class=syntax>HAVING</code> condition is pushed before <code class=syntax>GROUP BY</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21773 rel="external nofollow noreferrer" target=_blank>#21773</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21841 rel="external nofollow noreferrer" target=_blank>#21841</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Better error handling and logging in <code class=syntax>WriteBufferFromS3</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21836 rel="external nofollow noreferrer" target=_blank>#21836</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Fix possible crashes in aggregate functions with combinator <code class=syntax>Distinct</code>, while using two-level aggregation. This is a follow-up fix of <a href=https://github.com/ClickHouse/ClickHouse/pull/18365 rel="external nofollow noreferrer" target=_blank>#18365</a> . Can only reproduced in production env. <a href=https://github.com/ClickHouse/ClickHouse/pull/21818 rel="external nofollow noreferrer" target=_blank>#21818</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix scalar subquery index analysis. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21717 rel="external nofollow noreferrer" target=_blank>#21717</a> , which was introduced in <a href=https://github.com/ClickHouse/ClickHouse/pull/18896 rel="external nofollow noreferrer" target=_blank>#18896</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21766 rel="external nofollow noreferrer" target=_blank>#21766</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix bug for <code class=syntax>ReplicatedMerge</code> table engines when <code class=syntax>ALTER MODIFY COLUMN</code> query doesn't change the type of <code class=syntax>Decimal</code> column if its size (32 bit or 64 bit) doesn't change. <a href=https://github.com/ClickHouse/ClickHouse/pull/21728 rel="external nofollow noreferrer" target=_blank>#21728</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix possible infinite waiting when concurrent <code class=syntax>OPTIMIZE</code> and <code class=syntax>DROP</code> are run for <code class=syntax>ReplicatedMergeTree</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21716 rel="external nofollow noreferrer" target=_blank>#21716</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix function <code class=syntax>arrayElement</code> with type <code class=syntax>Map</code> for constant integer arguments. <a href=https://github.com/ClickHouse/ClickHouse/pull/21699 rel="external nofollow noreferrer" target=_blank>#21699</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix SIGSEGV on not existing attributes from <code class=syntax>ip_trie</code> with <code class=syntax>access_to_key_from_attributes</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21692 rel="external nofollow noreferrer" target=_blank>#21692</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Server now start accepting connections only after <code class=syntax>DDLWorker</code> and dictionaries initialization. <a href=https://github.com/ClickHouse/ClickHouse/pull/21676 rel="external nofollow noreferrer" target=_blank>#21676</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add type conversion for keys of tables of type <code class=syntax>Join</code> (previously led to SIGSEGV). <a href=https://github.com/ClickHouse/ClickHouse/pull/21646 rel="external nofollow noreferrer" target=_blank>#21646</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix distributed requests cancellation (for example simple select from multiple shards with limit, i.e. <code class=syntax>select * from remote('127.{2,3}', system.numbers) limit 100</code>) with <code class=syntax>async_socket_for_remote=1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21643 rel="external nofollow noreferrer" target=_blank>#21643</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix <code class=syntax>fsync_part_directory</code> for horizontal merge. <a href=https://github.com/ClickHouse/ClickHouse/pull/21642 rel="external nofollow noreferrer" target=_blank>#21642</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Remove unknown columns from joined table in <code class=syntax>WHERE</code> for queries to external database engines (MySQL, PostgreSQL). close <a href=https://github.com/ClickHouse/ClickHouse/issues/14614 rel="external nofollow noreferrer" target=_blank>#14614</a>, close <a href=https://github.com/ClickHouse/ClickHouse/issues/19288 rel="external nofollow noreferrer" target=_blank>#19288</a> (dup), close <a href=https://github.com/ClickHouse/ClickHouse/issues/19645 rel="external nofollow noreferrer" target=_blank>#19645</a> (dup). <a href=https://github.com/ClickHouse/ClickHouse/pull/21640 rel="external nofollow noreferrer" target=_blank>#21640</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li><code class=syntax>std::terminate</code> was called if there is an error writing data into s3. <a href=https://github.com/ClickHouse/ClickHouse/pull/21624 rel="external nofollow noreferrer" target=_blank>#21624</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> <li>Fix possible error <code class=syntax>Cannot find column</code> when <code class=syntax>optimize_skip_unused_shards</code> is enabled and zero shards are used. <a href=https://github.com/ClickHouse/ClickHouse/pull/21579 rel="external nofollow noreferrer" target=_blank>#21579</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>In case if query has constant <code class=syntax>WHERE</code> condition, and setting <code class=syntax>optimize_skip_unused_shards</code> enabled, all shards may be skipped and query could return incorrect empty result. <a href=https://github.com/ClickHouse/ClickHouse/pull/21550 rel="external nofollow noreferrer" target=_blank>#21550</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix table function <code class=syntax>clusterAllReplicas</code> returns wrong <code class=syntax>_shard_num</code>. close <a href=https://github.com/ClickHouse/ClickHouse/issues/21481 rel="external nofollow noreferrer" target=_blank>#21481</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21498 rel="external nofollow noreferrer" target=_blank>#21498</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fix that S3 table holds old credentials after config update. <a href=https://github.com/ClickHouse/ClickHouse/pull/21457 rel="external nofollow noreferrer" target=_blank>#21457</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>).</li> <li>Fixed race on SSL object inside <code class=syntax>SecureSocket</code> in Poco. <a href=https://github.com/ClickHouse/ClickHouse/pull/21456 rel="external nofollow noreferrer" target=_blank>#21456</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix <code class=syntax>Avro</code> format parsing for <code class=syntax>Kafka</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21437 rel="external nofollow noreferrer" target=_blank>#21437</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21438 rel="external nofollow noreferrer" target=_blank>#21438</a> (<a href=https://github.com/ilejn rel="external nofollow noreferrer" target=_blank>Ilya Golshtein</a>).</li> <li>Fix receive and send timeouts and non-blocking read in secure socket. <a href=https://github.com/ClickHouse/ClickHouse/pull/21429 rel="external nofollow noreferrer" target=_blank>#21429</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li><code class=syntax>force_drop_table</code> flag didn't work for <code class=syntax>MATERIALIZED VIEW</code>, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18943 rel="external nofollow noreferrer" target=_blank>#18943</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20626 rel="external nofollow noreferrer" target=_blank>#20626</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix name clashes in <code class=syntax>PredicateRewriteVisitor</code>. It caused incorrect <code class=syntax>WHERE</code> filtration after full join. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/20497 rel="external nofollow noreferrer" target=_blank>#20497</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20622 rel="external nofollow noreferrer" target=_blank>#20622</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>Vladimir</a>).</li> </ul> <h4 id=build-testing-packaging-improvement_2>Build/Testing/Packaging Improvement<a class=headerlink href=#build-testing-packaging-improvement_2 title="Permanent link"> </a></h4> <ul> <li>Add <a href=https://github.com/jepsen-io/jepsen rel="external nofollow noreferrer" target=_blank>Jepsen</a> tests for ClickHouse Keeper. <a href=https://github.com/ClickHouse/ClickHouse/pull/21677 rel="external nofollow noreferrer" target=_blank>#21677</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Run stateless tests in parallel in CI. Depends on <a href=https://github.com/ClickHouse/ClickHouse/issues/22181 rel="external nofollow noreferrer" target=_blank>#22181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22300 rel="external nofollow noreferrer" target=_blank>#22300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Enable status check for <a href=https://github.com/sqlancer/sqlancer rel="external nofollow noreferrer" target=_blank>SQLancer</a> CI run. <a href=https://github.com/ClickHouse/ClickHouse/pull/22015 rel="external nofollow noreferrer" target=_blank>#22015</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Multiple preparations for PowerPC builds: Enable the bundled openldap on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22487 rel="external nofollow noreferrer" target=_blank>#22487</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Enable compiling on <code class=syntax>ppc64le</code> with Clang. <a href=https://github.com/ClickHouse/ClickHouse/pull/22476 rel="external nofollow noreferrer" target=_blank>#22476</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Fix compiling boost on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22474 rel="external nofollow noreferrer" target=_blank>#22474</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Fix CMake error about internal CMake variable <code class=syntax>CMAKE_ASM_COMPILE_OBJECT</code> not set on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22469 rel="external nofollow noreferrer" target=_blank>#22469</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Fix Fedora/RHEL/CentOS not finding <code class=syntax>libclang_rt.builtins</code> on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22458 rel="external nofollow noreferrer" target=_blank>#22458</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Enable building with <code class=syntax>jemalloc</code> on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22447 rel="external nofollow noreferrer" target=_blank>#22447</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Fix ClickHouse's config embedding and cctz's timezone embedding on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22445 rel="external nofollow noreferrer" target=_blank>#22445</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>). Fixed compiling on <code class=syntax>ppc64le</code> and use the correct instruction pointer register on <code class=syntax>ppc64le</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22430 rel="external nofollow noreferrer" target=_blank>#22430</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>).</li> <li>Re-enable the S3 (AWS) library on <code class=syntax>aarch64</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22484 rel="external nofollow noreferrer" target=_blank>#22484</a> (<a href=https://github.com/mastertheknife rel="external nofollow noreferrer" target=_blank>Kfir Itzhak</a>).</li> <li>Add <code class=syntax>tzdata</code> to Docker containers because reading <code class=syntax>ORC</code> formats requires it. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14156 rel="external nofollow noreferrer" target=_blank>#14156</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/22000 rel="external nofollow noreferrer" target=_blank>#22000</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Introduce 2 arguments for <code class=syntax>clickhouse-server</code> image Dockerfile: <code class=syntax>deb_location</code> &amp; <code class=syntax>single_binary_location</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21977 rel="external nofollow noreferrer" target=_blank>#21977</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Allow to use clang-tidy with release builds by enabling assertions if it is used. <a href=https://github.com/ClickHouse/ClickHouse/pull/21914 rel="external nofollow noreferrer" target=_blank>#21914</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add llvm-12 binaries name to search in cmake scripts. Implicit constants conversions to mute clang warnings. Updated submodules to build with CMake 3.19. Mute recursion in macro expansion in <code class=syntax>readpassphrase</code> library. Deprecated <code class=syntax>-fuse-ld</code> changed to <code class=syntax>--ld-path</code> for clang. <a href=https://github.com/ClickHouse/ClickHouse/pull/21597 rel="external nofollow noreferrer" target=_blank>#21597</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Updating <code class=syntax>docker/test/testflows/runner/dockerd-entrypoint.sh</code> to use Yandex dockerhub-proxy, because Docker Hub has enabled very restrictive rate limits <a href=https://github.com/ClickHouse/ClickHouse/pull/21551 rel="external nofollow noreferrer" target=_blank>#21551</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>Fix macOS shared lib build. <a href=https://github.com/ClickHouse/ClickHouse/pull/20184 rel="external nofollow noreferrer" target=_blank>#20184</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>Add <code class=syntax>ctime</code> option to <code class=syntax>zookeeper-dump-tree</code>. It allows to dump node creation time. <a href=https://github.com/ClickHouse/ClickHouse/pull/21842 rel="external nofollow noreferrer" target=_blank>#21842</a> (<a href=https://github.com/HumanUser rel="external nofollow noreferrer" target=_blank>Ilya</a>).</li> </ul> <h2 id=clickhouse-release-21-3-lts>ClickHouse release 21.3 (LTS)<a class=headerlink href=#clickhouse-release-21-3-lts title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v21-3-2021-03-12>ClickHouse release v21.3, 2021-03-12<a class=headerlink href=#clickhouse-release-v21-3-2021-03-12 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change_2>Backward Incompatible Change<a class=headerlink href=#backward-incompatible-change_2 title="Permanent link"> </a></h4> <ul> <li>Now it's not allowed to create MergeTree tables in old syntax with table TTL because it's just ignored. Attach of old tables is still possible. <a href=https://github.com/ClickHouse/ClickHouse/pull/20282 rel="external nofollow noreferrer" target=_blank>#20282</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Now all case-insensitive function names will be rewritten to their canonical representations. This is needed for projection query routing (the upcoming feature). <a href=https://github.com/ClickHouse/ClickHouse/pull/20174 rel="external nofollow noreferrer" target=_blank>#20174</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix creation of <code class=syntax>TTL</code> in cases, when its expression is a function and it is the same as <code class=syntax>ORDER BY</code> key. Now it's allowed to set custom aggregation to primary key columns in <code class=syntax>TTL</code> with <code class=syntax>GROUP BY</code>. Backward incompatible: For primary key columns, which are not in <code class=syntax>GROUP BY</code> and aren't set explicitly now is applied function <code class=syntax>any</code> instead of <code class=syntax>max</code>, when TTL is expired. Also if you use TTL with <code class=syntax>WHERE</code> or <code class=syntax>GROUP BY</code> you can see exceptions at merges, while making rolling update. <a href=https://github.com/ClickHouse/ClickHouse/pull/15450 rel="external nofollow noreferrer" target=_blank>#15450</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=new-feature_3>New Feature<a class=headerlink href=#new-feature_3 title="Permanent link"> </a></h4> <ul> <li>Add file engine settings: <code class=syntax>engine_file_empty_if_not_exists</code> and <code class=syntax>engine_file_truncate_on_insert</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20620 rel="external nofollow noreferrer" target=_blank>#20620</a> (<a href=https://github.com/M0r64n rel="external nofollow noreferrer" target=_blank>M0r64n</a>).</li> <li>Add aggregate function <code class=syntax>deltaSum</code> for summing the differences between consecutive rows. <a href=https://github.com/ClickHouse/ClickHouse/pull/20057 rel="external nofollow noreferrer" target=_blank>#20057</a> (<a href=https://github.com/rf rel="external nofollow noreferrer" target=_blank>Russ Frank</a>).</li> <li>New <code class=syntax>event_time_microseconds</code> column in <code class=syntax>system.part_log</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/20027 rel="external nofollow noreferrer" target=_blank>#20027</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Added <code class=syntax>timezoneOffset(datetime)</code> function which will give the offset from UTC in seconds. This close <a href=https://github.com/ClickHouse/ClickHouse/issues/19850 rel="external nofollow noreferrer" target=_blank>#issue:19850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19962 rel="external nofollow noreferrer" target=_blank>#19962</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> <li>Add setting <code class=syntax>insert_shard_id</code> to support insert data into specific shard from distributed table. <a href=https://github.com/ClickHouse/ClickHouse/pull/19961 rel="external nofollow noreferrer" target=_blank>#19961</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Function <code class=syntax>reinterpretAs</code> updated to support big integers. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19691 rel="external nofollow noreferrer" target=_blank>#19691</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19858 rel="external nofollow noreferrer" target=_blank>#19858</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added Server Side Encryption Customer Keys (the <code class=syntax>x-amz-server-side-encryption-customer-(key/md5)</code> header) support in S3 client. See <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html rel="external nofollow noreferrer" target=_blank>the link</a>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19428 rel="external nofollow noreferrer" target=_blank>#19428</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19748 rel="external nofollow noreferrer" target=_blank>#19748</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Added <code class=syntax>implicit_key</code> option for <code class=syntax>executable</code> dictionary source. It allows to avoid printing key for every record if records comes in the same order as the input keys. Implements <a href=https://github.com/ClickHouse/ClickHouse/issues/14527 rel="external nofollow noreferrer" target=_blank>#14527</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19677 rel="external nofollow noreferrer" target=_blank>#19677</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add quota type <code class=syntax>query_selects</code> and <code class=syntax>query_inserts</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19603 rel="external nofollow noreferrer" target=_blank>#19603</a> (<a href=https://github.com/JackyWoo rel="external nofollow noreferrer" target=_blank>JackyWoo</a>).</li> <li>Add function <code class=syntax>extractTextFromHTML</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/19600 rel="external nofollow noreferrer" target=_blank>#19600</a> (<a href=https://github.com/zlx19950903 rel="external nofollow noreferrer" target=_blank>zlx19950903</a>), (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Tables with <code class=syntax>MergeTree*</code> engine now have two new table-level settings for query concurrency control. Setting <code class=syntax>max_concurrent_queries</code> limits the number of concurrently executed queries which are related to this table. Setting <code class=syntax>min_marks_to_honor_max_concurrent_queries</code> tells to apply previous setting only if query reads at least this number of marks. <a href=https://github.com/ClickHouse/ClickHouse/pull/19544 rel="external nofollow noreferrer" target=_blank>#19544</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added <code class=syntax>file</code> function to read file from user_files directory as a String. This is different from the <code class=syntax>file</code> table function. This implements <a href=https://github.com/ClickHouse/ClickHouse/issues/18851 rel="external nofollow noreferrer" target=_blank>#issue:18851</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19204 rel="external nofollow noreferrer" target=_blank>#19204</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> </ul> <h4 id=experimental-feature_2>Experimental feature<a class=headerlink href=#experimental-feature_2 title="Permanent link"> </a></h4> <ul> <li>Add experimental <code class=syntax>Replicated</code> database engine. It replicates DDL queries across multiple hosts. <a href=https://github.com/ClickHouse/ClickHouse/pull/16193 rel="external nofollow noreferrer" target=_blank>#16193</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Introduce experimental support for window functions, enabled with <code class=syntax>allow_experimental_window_functions = 1</code>. This is a preliminary, alpha-quality implementation that is not suitable for production use and will change in backward-incompatible ways in future releases. Please see <a href=https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/sql-reference/window-functions/index.md#experimental-window-functions rel="external nofollow noreferrer" target=_blank>the documentation</a> for the list of supported features. <a href=https://github.com/ClickHouse/ClickHouse/pull/20337 rel="external nofollow noreferrer" target=_blank>#20337</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Add the ability to backup/restore metadata files for DiskS3. <a href=https://github.com/ClickHouse/ClickHouse/pull/18377 rel="external nofollow noreferrer" target=_blank>#18377</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> </ul> <h4 id=performance-improvement_3>Performance Improvement<a class=headerlink href=#performance-improvement_3 title="Permanent link"> </a></h4> <ul> <li>Hedged requests for remote queries. When setting <code class=syntax>use_hedged_requests</code> enabled (off by default), allow to establish many connections with different replicas for query. New connection is enabled in case existent connection(s) with replica(s) were not established within <code class=syntax>hedged_connection_timeout</code> or no data was received within <code class=syntax>receive_data_timeout</code>. Query uses the first connection which send non empty progress packet (or data packet, if <code class=syntax>allow_changing_replica_until_first_data_packet</code>); other connections are cancelled. Queries with <code class=syntax>max_parallel_replicas &gt; 1</code> are supported. <a href=https://github.com/ClickHouse/ClickHouse/pull/19291 rel="external nofollow noreferrer" target=_blank>#19291</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>). This allows to significantly reduce tail latencies on very large clusters.</li> <li>Added support for <code class=syntax>PREWHERE</code> (and enable the corresponding optimization) when tables have row-level security expressions specified. <a href=https://github.com/ClickHouse/ClickHouse/pull/19576 rel="external nofollow noreferrer" target=_blank>#19576</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>The setting <code class=syntax>distributed_aggregation_memory_efficient</code> is enabled by default. It will lower memory usage and improve performance of distributed queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/20599 rel="external nofollow noreferrer" target=_blank>#20599</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve performance of GROUP BY multiple fixed size keys. <a href=https://github.com/ClickHouse/ClickHouse/pull/20472 rel="external nofollow noreferrer" target=_blank>#20472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve performance of aggregate functions by more strict aliasing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19946 rel="external nofollow noreferrer" target=_blank>#19946</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Speed up reading from <code class=syntax>Memory</code> tables in extreme cases (when reading speed is in order of 50 GB/sec) by simplification of pipeline and (consequently) less lock contention in pipeline scheduling. <a href=https://github.com/ClickHouse/ClickHouse/pull/20468 rel="external nofollow noreferrer" target=_blank>#20468</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Partially reimplement HTTP server to make it making less copies of incoming and outgoing data. It gives up to 1.5 performance improvement on inserting long records over HTTP. <a href=https://github.com/ClickHouse/ClickHouse/pull/19516 rel="external nofollow noreferrer" target=_blank>#19516</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Add <code class=syntax>compress</code> setting for <code class=syntax>Memory</code> tables. If it's enabled the table will use less RAM. On some machines and datasets it can also work faster on SELECT, but it is not always the case. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20093 rel="external nofollow noreferrer" target=_blank>#20093</a>. Note: there are reasons why Memory tables can work slower than MergeTree: (1) lack of compression (2) static size of blocks (3) lack of indices and prewhere... <a href=https://github.com/ClickHouse/ClickHouse/pull/20168 rel="external nofollow noreferrer" target=_blank>#20168</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Slightly better code in aggregation. <a href=https://github.com/ClickHouse/ClickHouse/pull/20978 rel="external nofollow noreferrer" target=_blank>#20978</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add back <code class=syntax>intDiv</code>/<code class=syntax>modulo</code> specializations for better performance. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21293 rel="external nofollow noreferrer" target=_blank>#21293</a> . The regression was introduced in <a href=https://github.com/ClickHouse/ClickHouse/pull/18145 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/18145</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/21307 rel="external nofollow noreferrer" target=_blank>#21307</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Do not squash blocks too much on INSERT SELECT if inserting into Memory table. In previous versions inefficient data representation was created in Memory table after INSERT SELECT. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13052 rel="external nofollow noreferrer" target=_blank>#13052</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20169 rel="external nofollow noreferrer" target=_blank>#20169</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix at least one case when DataType parser may have exponential complexity (found by fuzzer). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20096 rel="external nofollow noreferrer" target=_blank>#20096</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20132 rel="external nofollow noreferrer" target=_blank>#20132</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Parallelize SELECT with FINAL for single part with level &gt; 0 when <code class=syntax>do_not_merge_across_partitions_select_final</code> setting is 1. <a href=https://github.com/ClickHouse/ClickHouse/pull/19375 rel="external nofollow noreferrer" target=_blank>#19375</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Fill only requested columns when querying <code class=syntax>system.parts</code> and <code class=syntax>system.parts_columns</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19570 rel="external nofollow noreferrer" target=_blank>#19570</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21035 rel="external nofollow noreferrer" target=_blank>#21035</a> (<a href=https://github.com/anmolarora rel="external nofollow noreferrer" target=_blank>Anmol Arora</a>).</li> <li>Perform algebraic optimizations of arithmetic expressions inside <code class=syntax>avg</code> aggregate function. close <a href=https://github.com/ClickHouse/ClickHouse/issues/20092 rel="external nofollow noreferrer" target=_blank>#20092</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20183 rel="external nofollow noreferrer" target=_blank>#20183</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> </ul> <h4 id=improvement_3>Improvement<a class=headerlink href=#improvement_3 title="Permanent link"> </a></h4> <ul> <li>Case-insensitive compression methods for table functions. Also fixed LZMA compression method which was checked in upper case. <a href=https://github.com/ClickHouse/ClickHouse/pull/21416 rel="external nofollow noreferrer" target=_blank>#21416</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add two settings to delay or throw error during insertion when there are too many inactive parts. This is useful when server fails to clean up parts quickly enough. <a href=https://github.com/ClickHouse/ClickHouse/pull/20178 rel="external nofollow noreferrer" target=_blank>#20178</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Provide better compatibility for mysql clients. 1. mysql jdbc 2. mycli. <a href=https://github.com/ClickHouse/ClickHouse/pull/21367 rel="external nofollow noreferrer" target=_blank>#21367</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Forbid to drop a column if it's referenced by materialized view. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21164 rel="external nofollow noreferrer" target=_blank>#21164</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21303 rel="external nofollow noreferrer" target=_blank>#21303</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>MySQL dictionary source will now retry unexpected connection failures (Lost connection to MySQL server during query) which sometimes happen on SSL/TLS connections. <a href=https://github.com/ClickHouse/ClickHouse/pull/21237 rel="external nofollow noreferrer" target=_blank>#21237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>Usability improvement: more consistent <code class=syntax>DateTime64</code> parsing: recognize the case when unix timestamp with subsecond resolution is specified as scaled integer (like <code class=syntax>1111111111222</code> instead of <code class=syntax>1111111111.222</code>). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13194 rel="external nofollow noreferrer" target=_blank>#13194</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21053 rel="external nofollow noreferrer" target=_blank>#21053</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Do only merging of sorted blocks on initiator with distributed_group_by_no_merge. <a href=https://github.com/ClickHouse/ClickHouse/pull/20882 rel="external nofollow noreferrer" target=_blank>#20882</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>When loading config for mysql source ClickHouse will now randomize the list of replicas with the same priority to ensure the round-robin logics of picking mysql endpoint. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20629 rel="external nofollow noreferrer" target=_blank>#20629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20632 rel="external nofollow noreferrer" target=_blank>#20632</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>Function 'reinterpretAs(x, Type)' renamed into 'reinterpret(x, Type)'. <a href=https://github.com/ClickHouse/ClickHouse/pull/20611 rel="external nofollow noreferrer" target=_blank>#20611</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Support vhost for RabbitMQ engine <a href=https://github.com/ClickHouse/ClickHouse/issues/20576 rel="external nofollow noreferrer" target=_blank>#20576</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20596 rel="external nofollow noreferrer" target=_blank>#20596</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Improved serialization for data types combined of Arrays and Tuples. Improved matching enum data types to protobuf enum type. Fixed serialization of the <code class=syntax>Map</code> data type. Omitted values are now set by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/20506 rel="external nofollow noreferrer" target=_blank>#20506</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fixed race between execution of distributed DDL tasks and cleanup of DDL queue. Now DDL task cannot be removed from ZooKeeper if there are active workers. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20016 rel="external nofollow noreferrer" target=_blank>#20016</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20448 rel="external nofollow noreferrer" target=_blank>#20448</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Make FQDN and other DNS related functions work correctly in alpine images. <a href=https://github.com/ClickHouse/ClickHouse/pull/20336 rel="external nofollow noreferrer" target=_blank>#20336</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Do not allow early constant folding of explicitly forbidden functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/20303 rel="external nofollow noreferrer" target=_blank>#20303</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Implicit conversion from integer to Decimal type might succeeded if integer value doe not fit into Decimal type. Now it throws <code class=syntax>ARGUMENT_OUT_OF_BOUND</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20232 rel="external nofollow noreferrer" target=_blank>#20232</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Lockless <code class=syntax>SYSTEM FLUSH DISTRIBUTED</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20215 rel="external nofollow noreferrer" target=_blank>#20215</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Normalize count(constant), sum(1) to count(). This is needed for projection query routing. <a href=https://github.com/ClickHouse/ClickHouse/pull/20175 rel="external nofollow noreferrer" target=_blank>#20175</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Support all native integer types in bitmap functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/20171 rel="external nofollow noreferrer" target=_blank>#20171</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Updated <code class=syntax>CacheDictionary</code>, <code class=syntax>ComplexCacheDictionary</code>, <code class=syntax>SSDCacheDictionary</code>, <code class=syntax>SSDComplexKeyDictionary</code> to use LRUHashMap as underlying index. <a href=https://github.com/ClickHouse/ClickHouse/pull/20164 rel="external nofollow noreferrer" target=_blank>#20164</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>The setting <code class=syntax>access_management</code> is now configurable on startup by providing <code class=syntax>CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT</code>, defaults to disabled (<code class=syntax>0</code>) which was the prior value. <a href=https://github.com/ClickHouse/ClickHouse/pull/20139 rel="external nofollow noreferrer" target=_blank>#20139</a> (<a href=https://github.com/sonirico rel="external nofollow noreferrer" target=_blank>Marquitos</a>).</li> <li>Fix toDateTime64(toDate()/toDateTime()) for DateTime64 - Implement DateTime64 clamping to match DateTime behaviour. <a href=https://github.com/ClickHouse/ClickHouse/pull/20131 rel="external nofollow noreferrer" target=_blank>#20131</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Quota improvements: SHOW TABLES is now considered as one query in the quota calculations, not two queries. SYSTEM queries now consume quota. Fix calculation of interval's end in quota consumption. <a href=https://github.com/ClickHouse/ClickHouse/pull/20106 rel="external nofollow noreferrer" target=_blank>#20106</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Supports <code class=syntax>path IN (set)</code> expressions for <code class=syntax>system.zookeeper</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/20105 rel="external nofollow noreferrer" target=_blank>#20105</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>).</li> <li>Show full details of <code class=syntax>MaterializeMySQL</code> tables in <code class=syntax>system.tables</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20051 rel="external nofollow noreferrer" target=_blank>#20051</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Fix data race in executable dictionary that was possible only on misuse (when the script returns data ignoring its input). <a href=https://github.com/ClickHouse/ClickHouse/pull/20045 rel="external nofollow noreferrer" target=_blank>#20045</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>The value of MYSQL_OPT_RECONNECT option can now be controlled by "opt_reconnect" parameter in the config section of mysql replica. <a href=https://github.com/ClickHouse/ClickHouse/pull/19998 rel="external nofollow noreferrer" target=_blank>#19998</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>If user calls <code class=syntax>JSONExtract</code> function with <code class=syntax>Float32</code> type requested, allow inaccurate conversion to the result type. For example the number <code class=syntax>0.1</code> in JSON is double precision and is not representable in Float32, but the user still wants to get it. Previous versions return 0 for non-Nullable type and NULL for Nullable type to indicate that conversion is imprecise. The logic was 100% correct but it was surprising to users and leading to questions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13962 rel="external nofollow noreferrer" target=_blank>#13962</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19960 rel="external nofollow noreferrer" target=_blank>#19960</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add conversion of block structure for INSERT into Distributed tables if it does not match. <a href=https://github.com/ClickHouse/ClickHouse/pull/19947 rel="external nofollow noreferrer" target=_blank>#19947</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Improvement for the <code class=syntax>system.distributed_ddl_queue</code> table. Initialize MaxDDLEntryID to the last value after restarting. Before this PR, MaxDDLEntryID will remain zero until a new DDLTask is processed. <a href=https://github.com/ClickHouse/ClickHouse/pull/19924 rel="external nofollow noreferrer" target=_blank>#19924</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Show <code class=syntax>MaterializeMySQL</code> tables in <code class=syntax>system.parts</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19770 rel="external nofollow noreferrer" target=_blank>#19770</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Add separate config directive for <code class=syntax>Buffer</code> profile. <a href=https://github.com/ClickHouse/ClickHouse/pull/19721 rel="external nofollow noreferrer" target=_blank>#19721</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Move conditions that are not related to JOIN to WHERE clause. <a href=https://github.com/ClickHouse/ClickHouse/issues/18720 rel="external nofollow noreferrer" target=_blank>#18720</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19685 rel="external nofollow noreferrer" target=_blank>#19685</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Add ability to throttle INSERT into Distributed based on amount of pending bytes for async send (<code class=syntax>bytes_to_delay_insert</code>/<code class=syntax>max_delay_to_insert</code> and <code class=syntax>bytes_to_throw_insert</code> settings for <code class=syntax>Distributed</code> engine has been added). <a href=https://github.com/ClickHouse/ClickHouse/pull/19673 rel="external nofollow noreferrer" target=_blank>#19673</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix some rare cases when write errors can be ignored in destructors. <a href=https://github.com/ClickHouse/ClickHouse/pull/19451 rel="external nofollow noreferrer" target=_blank>#19451</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Print inline frames in stack traces for fatal errors. <a href=https://github.com/ClickHouse/ClickHouse/pull/19317 rel="external nofollow noreferrer" target=_blank>#19317</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> </ul> <h4 id=bug-fix_3>Bug Fix<a class=headerlink href=#bug-fix_3 title="Permanent link"> </a></h4> <ul> <li>Fix redundant reconnects to ZooKeeper and the possibility of two active sessions for a single clickhouse server. Both problems introduced in #14678. <a href=https://github.com/ClickHouse/ClickHouse/pull/21264 rel="external nofollow noreferrer" target=_blank>#21264</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix error <code class=syntax>Bad cast from type ... to DB::ColumnLowCardinality</code> while inserting into table with <code class=syntax>LowCardinality</code> column from <code class=syntax>Values</code> format. Fixes #21140 <a href=https://github.com/ClickHouse/ClickHouse/pull/21357 rel="external nofollow noreferrer" target=_blank>#21357</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix a deadlock in <code class=syntax>ALTER DELETE</code> mutations for non replicated MergeTree table engines when the predicate contains the table itself. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20558 rel="external nofollow noreferrer" target=_blank>#20558</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21477 rel="external nofollow noreferrer" target=_blank>#21477</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix SIGSEGV for distributed queries on failures. <a href=https://github.com/ClickHouse/ClickHouse/pull/21434 rel="external nofollow noreferrer" target=_blank>#21434</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Now <code class=syntax>ALTER MODIFY COLUMN</code> queries will correctly affect changes in partition key, skip indices, TTLs, and so on. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13675 rel="external nofollow noreferrer" target=_blank>#13675</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21334 rel="external nofollow noreferrer" target=_blank>#21334</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix bug with <code class=syntax>join_use_nulls</code> and joining <code class=syntax>TOTALS</code> from subqueries. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19362 rel="external nofollow noreferrer" target=_blank>#19362</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/21137 rel="external nofollow noreferrer" target=_blank>#21137</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21248 rel="external nofollow noreferrer" target=_blank>#21248</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fix crash in <code class=syntax>EXPLAIN</code> for query with <code class=syntax>UNION</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20876 rel="external nofollow noreferrer" target=_blank>#20876</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/21170 rel="external nofollow noreferrer" target=_blank>#21170</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21246 rel="external nofollow noreferrer" target=_blank>#21246</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Now mutations allowed only for table engines that support them (MergeTree family, Memory, MaterializedView). Other engines will report a more clear error. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21168 rel="external nofollow noreferrer" target=_blank>#21168</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21183 rel="external nofollow noreferrer" target=_blank>#21183</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21112 rel="external nofollow noreferrer" target=_blank>#21112</a>. Fixed bug that could cause duplicates with insert query (if one of the callbacks came a little too late). <a href=https://github.com/ClickHouse/ClickHouse/pull/21138 rel="external nofollow noreferrer" target=_blank>#21138</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Fix <code class=syntax>input_format_null_as_default</code> take effective when types are nullable. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21116 rel="external nofollow noreferrer" target=_blank>#21116</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/21121 rel="external nofollow noreferrer" target=_blank>#21121</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>fix bug related to cast Tuple to Map. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21029 rel="external nofollow noreferrer" target=_blank>#21029</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21120 rel="external nofollow noreferrer" target=_blank>#21120</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix the metadata leak when the Replicated*MergeTree with custom (non default) ZooKeeper cluster is dropped. <a href=https://github.com/ClickHouse/ClickHouse/pull/21119 rel="external nofollow noreferrer" target=_blank>#21119</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix type mismatch issue when using LowCardinality keys in joinGet. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21114 rel="external nofollow noreferrer" target=_blank>#21114</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21117 rel="external nofollow noreferrer" target=_blank>#21117</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>fix default_replica_path and default_replica_name values are useless on Replicated(*)MergeTree engine when the engine needs specify other parameters. <a href=https://github.com/ClickHouse/ClickHouse/pull/21060 rel="external nofollow noreferrer" target=_blank>#21060</a> (<a href=https://github.com/mxzlxy rel="external nofollow noreferrer" target=_blank>mxzlxy</a>).</li> <li>Out of bound memory access was possible when formatting specifically crafted out of range value of type <code class=syntax>DateTime64</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20494 rel="external nofollow noreferrer" target=_blank>#20494</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20543 rel="external nofollow noreferrer" target=_blank>#20543</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21023 rel="external nofollow noreferrer" target=_blank>#21023</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Block parallel insertions into storage join. <a href=https://github.com/ClickHouse/ClickHouse/pull/21009 rel="external nofollow noreferrer" target=_blank>#21009</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fixed behaviour, when <code class=syntax>ALTER MODIFY COLUMN</code> created mutation, that will knowingly fail. <a href=https://github.com/ClickHouse/ClickHouse/pull/21007 rel="external nofollow noreferrer" target=_blank>#21007</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9969 rel="external nofollow noreferrer" target=_blank>#9969</a>. Fixed Brotli http compression error, which reproduced for large data sizes, slightly complicated structure and with json output format. Update Brotli to the latest version to include the "fix rare access to uninitialized data in ring-buffer". <a href=https://github.com/ClickHouse/ClickHouse/pull/20991 rel="external nofollow noreferrer" target=_blank>#20991</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Fix 'Empty task was returned from async task queue' on query cancellation. <a href=https://github.com/ClickHouse/ClickHouse/pull/20881 rel="external nofollow noreferrer" target=_blank>#20881</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>USE database;</code> query did not work when using MySQL 5.7 client to connect to ClickHouse server, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18926 rel="external nofollow noreferrer" target=_blank>#18926</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20878 rel="external nofollow noreferrer" target=_blank>#20878</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix usage of <code class=syntax>-Distinct</code> combinator with <code class=syntax>-State</code> combinator in aggregate functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/20866 rel="external nofollow noreferrer" target=_blank>#20866</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix subquery with union distinct and limit clause. close <a href=https://github.com/ClickHouse/ClickHouse/issues/20597 rel="external nofollow noreferrer" target=_blank>#20597</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20610 rel="external nofollow noreferrer" target=_blank>#20610</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fixed inconsistent behavior of dictionary in case of queries where we look for absent keys in dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/20578 rel="external nofollow noreferrer" target=_blank>#20578</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix the number of threads for scalar subqueries and subqueries for index (after <a href=https://github.com/ClickHouse/ClickHouse/issues/19007 rel="external nofollow noreferrer" target=_blank>#19007</a> single thread was always used). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20457 rel="external nofollow noreferrer" target=_blank>#20457</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/20512 rel="external nofollow noreferrer" target=_blank>#20512</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20550 rel="external nofollow noreferrer" target=_blank>#20550</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix crash which could happen if unknown packet was received from remove query (was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/17868 rel="external nofollow noreferrer" target=_blank>#17868</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/20547 rel="external nofollow noreferrer" target=_blank>#20547</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add proper checks while parsing directory names for async INSERT (fixes SIGSEGV). <a href=https://github.com/ClickHouse/ClickHouse/pull/20498 rel="external nofollow noreferrer" target=_blank>#20498</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix function <code class=syntax>transform</code> does not work properly for floating point keys. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20460 rel="external nofollow noreferrer" target=_blank>#20460</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20479 rel="external nofollow noreferrer" target=_blank>#20479</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fix infinite loop when propagating WITH aliases to subqueries. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20388 rel="external nofollow noreferrer" target=_blank>#20388</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20476 rel="external nofollow noreferrer" target=_blank>#20476</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix abnormal server termination when http client goes away. <a href=https://github.com/ClickHouse/ClickHouse/pull/20464 rel="external nofollow noreferrer" target=_blank>#20464</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix <code class=syntax>LOGICAL_ERROR</code> for <code class=syntax>join_use_nulls=1</code> when JOIN contains const from SELECT. <a href=https://github.com/ClickHouse/ClickHouse/pull/20461 rel="external nofollow noreferrer" target=_blank>#20461</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Check if table function <code class=syntax>view</code> is used in expression list and throw an error. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20342 rel="external nofollow noreferrer" target=_blank>#20342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20350 rel="external nofollow noreferrer" target=_blank>#20350</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Avoid invalid dereference in RANGE_HASHED() dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/20345 rel="external nofollow noreferrer" target=_blank>#20345</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix null dereference with <code class=syntax>join_use_nulls=1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20344 rel="external nofollow noreferrer" target=_blank>#20344</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix incorrect result of binary operations between two constant decimals of different scale. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20283 rel="external nofollow noreferrer" target=_blank>#20283</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20339 rel="external nofollow noreferrer" target=_blank>#20339</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fix too often retries of failed background tasks for <code class=syntax>ReplicatedMergeTree</code> table engines family. This could lead to too verbose logging and increased CPU load. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20203 rel="external nofollow noreferrer" target=_blank>#20203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20335 rel="external nofollow noreferrer" target=_blank>#20335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Restrict to <code class=syntax>DROP</code> or <code class=syntax>RENAME</code> version column of <code class=syntax>*CollapsingMergeTree</code> and <code class=syntax>ReplacingMergeTree</code> table engines. <a href=https://github.com/ClickHouse/ClickHouse/pull/20300 rel="external nofollow noreferrer" target=_blank>#20300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed the behavior when in case of broken JSON we tried to read the whole file into memory which leads to exception from the allocator. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19719 rel="external nofollow noreferrer" target=_blank>#19719</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20286 rel="external nofollow noreferrer" target=_blank>#20286</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix exception during vertical merge for <code class=syntax>MergeTree</code> table engines family which don't allow to perform vertical merges. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20259 rel="external nofollow noreferrer" target=_blank>#20259</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20279 rel="external nofollow noreferrer" target=_blank>#20279</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix rare server crash on config reload during the shutdown. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19689 rel="external nofollow noreferrer" target=_blank>#19689</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20224 rel="external nofollow noreferrer" target=_blank>#20224</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix CTE when using in INSERT SELECT. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20187 rel="external nofollow noreferrer" target=_blank>#20187</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20195 rel="external nofollow noreferrer" target=_blank>#20195</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20211 rel="external nofollow noreferrer" target=_blank>#20211</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19314 rel="external nofollow noreferrer" target=_blank>#19314</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20156 rel="external nofollow noreferrer" target=_blank>#20156</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>fix toMinute function to handle special timezone correctly. <a href=https://github.com/ClickHouse/ClickHouse/pull/20149 rel="external nofollow noreferrer" target=_blank>#20149</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> <li>Fix server crash after query with <code class=syntax>if</code> function with <code class=syntax>Tuple</code> type of then/else branches result. <code class=syntax>Tuple</code> type must contain <code class=syntax>Array</code> or another complex type. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18356 rel="external nofollow noreferrer" target=_blank>#18356</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20133 rel="external nofollow noreferrer" target=_blank>#20133</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>The <code class=syntax>MongoDB</code> table engine now establishes connection only when it's going to read data. <code class=syntax>ATTACH TABLE</code> won't try to connect anymore. <a href=https://github.com/ClickHouse/ClickHouse/pull/20110 rel="external nofollow noreferrer" target=_blank>#20110</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Bugfix in StorageJoin. <a href=https://github.com/ClickHouse/ClickHouse/pull/20079 rel="external nofollow noreferrer" target=_blank>#20079</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fix the case when calculating modulo of division of negative number by small divisor, the resulting data type was not large enough to accomodate the negative result. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20052 rel="external nofollow noreferrer" target=_blank>#20052</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20067 rel="external nofollow noreferrer" target=_blank>#20067</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>MaterializeMySQL: Fix replication for statements that update several tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/20066 rel="external nofollow noreferrer" target=_blank>#20066</a> (<a href=https://github.com/havardk rel="external nofollow noreferrer" target=_blank>Håvard Kvålen</a>).</li> <li>Prevent "Connection refused" in docker during initialization script execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/20012 rel="external nofollow noreferrer" target=_blank>#20012</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li><code class=syntax>EmbeddedRocksDB</code> is an experimental storage. Fix the issue with lack of proper type checking. Simplified code. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19967 rel="external nofollow noreferrer" target=_blank>#19967</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19972 rel="external nofollow noreferrer" target=_blank>#19972</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix a segfault in function <code class=syntax>fromModifiedJulianDay</code> when the argument type is <code class=syntax>Nullable(T)</code> for any integral types other than Int32. <a href=https://github.com/ClickHouse/ClickHouse/pull/19959 rel="external nofollow noreferrer" target=_blank>#19959</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>BloomFilter index crash fix. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19757 rel="external nofollow noreferrer" target=_blank>#19757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19884 rel="external nofollow noreferrer" target=_blank>#19884</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Deadlock was possible if system.text_log is enabled. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19874 rel="external nofollow noreferrer" target=_blank>#19874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19875 rel="external nofollow noreferrer" target=_blank>#19875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix starting the server with tables having default expressions containing dictGet(). Allow getting return type of dictGet() without loading dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/19805 rel="external nofollow noreferrer" target=_blank>#19805</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix clickhouse-client abort exception while executing only <code class=syntax>select</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19790 rel="external nofollow noreferrer" target=_blank>#19790</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> <li>Fix a bug that moving pieces to destination table may failed in case of launching multiple clickhouse-copiers. <a href=https://github.com/ClickHouse/ClickHouse/pull/19743 rel="external nofollow noreferrer" target=_blank>#19743</a> (<a href=https://github.com/mdianjun rel="external nofollow noreferrer" target=_blank>madianjun</a>).</li> <li>Background thread which executes <code class=syntax>ON CLUSTER</code> queries might hang waiting for dropped replicated table to do something. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/19684 rel="external nofollow noreferrer" target=_blank>#19684</a> (<a href=https://github.com/yiguolei rel="external nofollow noreferrer" target=_blank>yiguolei</a>).</li> </ul> <h4 id=build-testing-packaging-improvement_3>Build/Testing/Packaging Improvement<a class=headerlink href=#build-testing-packaging-improvement_3 title="Permanent link"> </a></h4> <ul> <li>Allow to build ClickHouse with AVX-2 enabled globally. It gives slight performance benefits on modern CPUs. Not recommended for production and will not be supported as official build for now. <a href=https://github.com/ClickHouse/ClickHouse/pull/20180 rel="external nofollow noreferrer" target=_blank>#20180</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix some of the issues found by Coverity. See <a href=https://github.com/ClickHouse/ClickHouse/issues/19964 rel="external nofollow noreferrer" target=_blank>#19964</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20010 rel="external nofollow noreferrer" target=_blank>#20010</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow to start up with modified binary under gdb. In previous version if you set up breakpoint in gdb before start, server will refuse to start up due to failed integrity check. <a href=https://github.com/ClickHouse/ClickHouse/pull/21258 rel="external nofollow noreferrer" target=_blank>#21258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add a test for different compression methods in Kafka. <a href=https://github.com/ClickHouse/ClickHouse/pull/21111 rel="external nofollow noreferrer" target=_blank>#21111</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fixed port clash from test_storage_kerberized_hdfs test. <a href=https://github.com/ClickHouse/ClickHouse/pull/19974 rel="external nofollow noreferrer" target=_blank>#19974</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Print <code class=syntax>stdout</code> and <code class=syntax>stderr</code> to log when failed to start docker in integration tests. Before this PR there was a very short error message in this case which didn't help to investigate the problems. <a href=https://github.com/ClickHouse/ClickHouse/pull/20631 rel="external nofollow noreferrer" target=_blank>#20631</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> </ul> <h2 id=clickhouse-release-21-2>ClickHouse release 21.2<a class=headerlink href=#clickhouse-release-21-2 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v21-2-2-8-stable-2021-02-07>ClickHouse release v21.2.2.8-stable, 2021-02-07<a class=headerlink href=#clickhouse-release-v21-2-2-8-stable-2021-02-07 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change_3>Backward Incompatible Change<a class=headerlink href=#backward-incompatible-change_3 title="Permanent link"> </a></h4> <ul> <li>Bitwise functions (<code class=syntax>bitAnd</code>, <code class=syntax>bitOr</code>, etc) are forbidden for floating point arguments. Now you have to do explicit cast to integer. <a href=https://github.com/ClickHouse/ClickHouse/pull/19853 rel="external nofollow noreferrer" target=_blank>#19853</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Forbid <code class=syntax>lcm</code>/<code class=syntax>gcd</code> for floats. <a href=https://github.com/ClickHouse/ClickHouse/pull/19532 rel="external nofollow noreferrer" target=_blank>#19532</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix memory tracking for <code class=syntax>OPTIMIZE TABLE</code>/merges; account query memory limits and sampling for <code class=syntax>OPTIMIZE TABLE</code>/merges. <a href=https://github.com/ClickHouse/ClickHouse/pull/18772 rel="external nofollow noreferrer" target=_blank>#18772</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Disallow floating point column as partition key, see <a href=https://github.com/ClickHouse/ClickHouse/issues/18421#event-4147046255 rel="external nofollow noreferrer" target=_blank>#18421</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18464 rel="external nofollow noreferrer" target=_blank>#18464</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Excessive parenthesis in type definitions no longer supported, example: <code class=syntax>Array((UInt8))</code>.</li> </ul> <h4 id=new-feature_4>New Feature<a class=headerlink href=#new-feature_4 title="Permanent link"> </a></h4> <ul> <li>Added <code class=syntax>PostgreSQL</code> table engine (both select/insert, with support for multidimensional arrays), also as table function. Added <code class=syntax>PostgreSQL</code> dictionary source. Added <code class=syntax>PostgreSQL</code> database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/18554 rel="external nofollow noreferrer" target=_blank>#18554</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Data type <code class=syntax>Nested</code> now supports arbitrary levels of nesting. Introduced subcolumns of complex types, such as <code class=syntax>size0</code> in <code class=syntax>Array</code>, <code class=syntax>null</code> in <code class=syntax>Nullable</code>, names of <code class=syntax>Tuple</code> elements, which can be read without reading of whole column. <a href=https://github.com/ClickHouse/ClickHouse/pull/17310 rel="external nofollow noreferrer" target=_blank>#17310</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Added <code class=syntax>Nullable</code> support for <code class=syntax>FlatDictionary</code>, <code class=syntax>HashedDictionary</code>, <code class=syntax>ComplexKeyHashedDictionary</code>, <code class=syntax>DirectDictionary</code>, <code class=syntax>ComplexKeyDirectDictionary</code>, <code class=syntax>RangeHashedDictionary</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18236 rel="external nofollow noreferrer" target=_blank>#18236</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Adds a new table called <code class=syntax>system.distributed_ddl_queue</code> that displays the queries in the DDL worker queue. <a href=https://github.com/ClickHouse/ClickHouse/pull/17656 rel="external nofollow noreferrer" target=_blank>#17656</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Added support of mapping LDAP group names, and attribute values in general, to local roles for users from ldap user directories. <a href=https://github.com/ClickHouse/ClickHouse/pull/17211 rel="external nofollow noreferrer" target=_blank>#17211</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Support insert into table function <code class=syntax>cluster</code>, and for both table functions <code class=syntax>remote</code> and <code class=syntax>cluster</code>, support distributing data across nodes by specify sharding key. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/16752 rel="external nofollow noreferrer" target=_blank>#16752</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18264 rel="external nofollow noreferrer" target=_blank>#18264</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add function <code class=syntax>decodeXMLComponent</code> to decode characters for XML. Example: <code class=syntax>SELECT decodeXMLComponent('Hello,&amp;quot;world&amp;quot;!')</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/17659 rel="external nofollow noreferrer" target=_blank>#17659</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18542 rel="external nofollow noreferrer" target=_blank>#18542</a> (<a href=https://github.com/nautaa rel="external nofollow noreferrer" target=_blank>nauta</a>).</li> <li>Added functions <code class=syntax>parseDateTimeBestEffortUSOrZero</code>, <code class=syntax>parseDateTimeBestEffortUSOrNull</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19712 rel="external nofollow noreferrer" target=_blank>#19712</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add <code class=syntax>sign</code> math function. <a href=https://github.com/ClickHouse/ClickHouse/pull/19527 rel="external nofollow noreferrer" target=_blank>#19527</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add information about used features (functions, table engines, etc) into system.query_log. <a href=https://github.com/ClickHouse/ClickHouse/issues/18495 rel="external nofollow noreferrer" target=_blank>#18495</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19371 rel="external nofollow noreferrer" target=_blank>#19371</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Function <code class=syntax>formatDateTime</code> support the <code class=syntax>%Q</code> modification to format date to quarter. <a href=https://github.com/ClickHouse/ClickHouse/pull/19224 rel="external nofollow noreferrer" target=_blank>#19224</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Support MetaKey+Enter hotkey binding in play UI. <a href=https://github.com/ClickHouse/ClickHouse/pull/19012 rel="external nofollow noreferrer" target=_blank>#19012</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Add three functions for map data type: 1. <code class=syntax>mapContains(map, key)</code> to check weather map.keys include the second parameter key. 2. <code class=syntax>mapKeys(map)</code> return all the keys in Array format 3. <code class=syntax>mapValues(map)</code> return all the values in Array format. <a href=https://github.com/ClickHouse/ClickHouse/pull/18788 rel="external nofollow noreferrer" target=_blank>#18788</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Add <code class=syntax>log_comment</code> setting related to <a href=https://github.com/ClickHouse/ClickHouse/issues/18494 rel="external nofollow noreferrer" target=_blank>#18494</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18549 rel="external nofollow noreferrer" target=_blank>#18549</a> (<a href=https://github.com/TszKitLo40 rel="external nofollow noreferrer" target=_blank>Zijie Lu</a>).</li> <li>Add support of tuple argument to <code class=syntax>argMin</code> and <code class=syntax>argMax</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/17359 rel="external nofollow noreferrer" target=_blank>#17359</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>Support <code class=syntax>EXISTS VIEW</code> syntax. <a href=https://github.com/ClickHouse/ClickHouse/pull/18552 rel="external nofollow noreferrer" target=_blank>#18552</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Add <code class=syntax>SELECT ALL</code> syntax. closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18706 rel="external nofollow noreferrer" target=_blank>#18706</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18723 rel="external nofollow noreferrer" target=_blank>#18723</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> </ul> <h4 id=performance-improvement_4>Performance Improvement<a class=headerlink href=#performance-improvement_4 title="Permanent link"> </a></h4> <ul> <li>Faster parts removal by lowering the number of <code class=syntax>stat</code> syscalls. This returns the optimization that existed while ago. More safe interface of <code class=syntax>IDisk</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19065 rel="external nofollow noreferrer" target=_blank>#19065</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19086 rel="external nofollow noreferrer" target=_blank>#19086</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Aliases declared in <code class=syntax>WITH</code> statement are properly used in index analysis. Queries like <code class=syntax>WITH column AS alias SELECT ... WHERE alias = ...</code> may use index now. <a href=https://github.com/ClickHouse/ClickHouse/pull/18896 rel="external nofollow noreferrer" target=_blank>#18896</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add <code class=syntax>optimize_alias_column_prediction</code> (on by default), that will: - Respect aliased columns in WHERE during partition pruning and skipping data using secondary indexes; - Respect aliased columns in WHERE for trivial count queries for optimize_trivial_count; - Respect aliased columns in GROUP BY/ORDER BY for optimize_aggregation_in_order/optimize_read_in_order. <a href=https://github.com/ClickHouse/ClickHouse/pull/16995 rel="external nofollow noreferrer" target=_blank>#16995</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Speed up aggregate function <code class=syntax>sum</code>. Improvement only visible on synthetic benchmarks and not very practical. <a href=https://github.com/ClickHouse/ClickHouse/pull/19216 rel="external nofollow noreferrer" target=_blank>#19216</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Update libc++ and use another ABI to provide better performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/18914 rel="external nofollow noreferrer" target=_blank>#18914</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>).</li> <li>Rewrite <code class=syntax>sumIf()</code> and <code class=syntax>sum(if())</code> function to <code class=syntax>countIf()</code> function when logically equivalent. <a href=https://github.com/ClickHouse/ClickHouse/pull/17041 rel="external nofollow noreferrer" target=_blank>#17041</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Use a connection pool for S3 connections, controlled by the <code class=syntax>s3_max_connections</code> settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/13405 rel="external nofollow noreferrer" target=_blank>#13405</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add support for zstd long option for better compression of string columns to save space. <a href=https://github.com/ClickHouse/ClickHouse/pull/17184 rel="external nofollow noreferrer" target=_blank>#17184</a> (<a href=https://github.com/ygrek rel="external nofollow noreferrer" target=_blank>ygrek</a>).</li> <li>Slightly improve server latency by removing access to configuration on every connection. <a href=https://github.com/ClickHouse/ClickHouse/pull/19863 rel="external nofollow noreferrer" target=_blank>#19863</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Reduce lock contention for multiple layers of the <code class=syntax>Buffer</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/19379 rel="external nofollow noreferrer" target=_blank>#19379</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Support splitting <code class=syntax>Filter</code> step of query plan into <code class=syntax>Expression + Filter</code> pair. Together with <code class=syntax>Expression + Expression</code> merging optimization (<a href=https://github.com/ClickHouse/ClickHouse/issues/17458 rel="external nofollow noreferrer" target=_blank>#17458</a>) it may delay execution for some expressions after <code class=syntax>Filter</code> step. <a href=https://github.com/ClickHouse/ClickHouse/pull/19253 rel="external nofollow noreferrer" target=_blank>#19253</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> </ul> <h4 id=improvement_4>Improvement<a class=headerlink href=#improvement_4 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>SELECT count() FROM table</code> now can be executed if only one any column can be selected from the <code class=syntax>table</code>. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10639 rel="external nofollow noreferrer" target=_blank>#10639</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18233 rel="external nofollow noreferrer" target=_blank>#18233</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Set charset to <code class=syntax>utf8mb4</code> when interacting with remote MySQL servers. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19795 rel="external nofollow noreferrer" target=_blank>#19795</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19800 rel="external nofollow noreferrer" target=_blank>#19800</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>S3</code> table function now supports <code class=syntax>auto</code> compression mode (autodetect). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18754 rel="external nofollow noreferrer" target=_blank>#18754</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19793 rel="external nofollow noreferrer" target=_blank>#19793</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Correctly output infinite arguments for <code class=syntax>formatReadableTimeDelta</code> function. In previous versions, there was implicit conversion to implementation specific integer value. <a href=https://github.com/ClickHouse/ClickHouse/pull/19791 rel="external nofollow noreferrer" target=_blank>#19791</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Table function <code class=syntax>S3</code> will use global region if the region can't be determined exactly. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10998 rel="external nofollow noreferrer" target=_blank>#10998</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19750 rel="external nofollow noreferrer" target=_blank>#19750</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>In distributed queries if the setting <code class=syntax>async_socket_for_remote</code> is enabled, it was possible to get stack overflow at least in debug build configuration if very deeply nested data type is used in table (e.g. <code class=syntax>Array(Array(Array(...more...)))</code>). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19108 rel="external nofollow noreferrer" target=_blank>#19108</a>. This change introduces minor backward incompatibility: excessive parenthesis in type definitions no longer supported, example: <code class=syntax>Array((UInt8))</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19736 rel="external nofollow noreferrer" target=_blank>#19736</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add separate pool for message brokers (RabbitMQ and Kafka). <a href=https://github.com/ClickHouse/ClickHouse/pull/19722 rel="external nofollow noreferrer" target=_blank>#19722</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix rare <code class=syntax>max_number_of_merges_with_ttl_in_pool</code> limit overrun (more merges with TTL can be assigned) for non-replicated MergeTree. <a href=https://github.com/ClickHouse/ClickHouse/pull/19708 rel="external nofollow noreferrer" target=_blank>#19708</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Dictionary: better error message during attribute parsing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19678 rel="external nofollow noreferrer" target=_blank>#19678</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add an option to disable validation of checksums on reading. Should never be used in production. Please do not expect any benefits in disabling it. It may only be used for experiments and benchmarks. The setting only applicable for tables of MergeTree family. Checksums are always validated for other table engines and when receiving data over network. In my observations there is no performance difference or it is less than 0.5%. <a href=https://github.com/ClickHouse/ClickHouse/pull/19588 rel="external nofollow noreferrer" target=_blank>#19588</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support constant result in function <code class=syntax>multiIf</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19533 rel="external nofollow noreferrer" target=_blank>#19533</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Enable function length/empty/notEmpty for datatype Map, which returns keys number in Map. <a href=https://github.com/ClickHouse/ClickHouse/pull/19530 rel="external nofollow noreferrer" target=_blank>#19530</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> <li>Add <code class=syntax>--reconnect</code> option to <code class=syntax>clickhouse-benchmark</code>. When this option is specified, it will reconnect before every request. This is needed for testing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19872 rel="external nofollow noreferrer" target=_blank>#19872</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support using the new location of <code class=syntax>.debug</code> file. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19348 rel="external nofollow noreferrer" target=_blank>#19348</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19520 rel="external nofollow noreferrer" target=_blank>#19520</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>toIPv6</code> function parses <code class=syntax>IPv4</code> addresses. <a href=https://github.com/ClickHouse/ClickHouse/pull/19518 rel="external nofollow noreferrer" target=_blank>#19518</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Add <code class=syntax>http_referer</code> field to <code class=syntax>system.query_log</code>, <code class=syntax>system.processes</code>, etc. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19389 rel="external nofollow noreferrer" target=_blank>#19389</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19390 rel="external nofollow noreferrer" target=_blank>#19390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve MySQL compatibility by making more functions case insensitive and adding aliases. <a href=https://github.com/ClickHouse/ClickHouse/pull/19387 rel="external nofollow noreferrer" target=_blank>#19387</a> (<a href=https://github.com/dankondr rel="external nofollow noreferrer" target=_blank>Daniil Kondratyev</a>).</li> <li>Add metrics for MergeTree parts (Wide/Compact/InMemory) types. <a href=https://github.com/ClickHouse/ClickHouse/pull/19381 rel="external nofollow noreferrer" target=_blank>#19381</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow docker to be executed with arbitrary uid. <a href=https://github.com/ClickHouse/ClickHouse/pull/19374 rel="external nofollow noreferrer" target=_blank>#19374</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fix wrong alignment of values of <code class=syntax>IPv4</code> data type in Pretty formats. They were aligned to the right, not to the left. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19184 rel="external nofollow noreferrer" target=_blank>#19184</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19339 rel="external nofollow noreferrer" target=_blank>#19339</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow change <code class=syntax>max_server_memory_usage</code> without restart. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18154 rel="external nofollow noreferrer" target=_blank>#18154</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19186 rel="external nofollow noreferrer" target=_blank>#19186</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>The exception when function <code class=syntax>bar</code> is called with certain NaN argument may be slightly misleading in previous versions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19088 rel="external nofollow noreferrer" target=_blank>#19088</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19107 rel="external nofollow noreferrer" target=_blank>#19107</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server images. <a href=https://github.com/ClickHouse/ClickHouse/pull/19096 rel="external nofollow noreferrer" target=_blank>#19096</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fixed <code class=syntax>PeekableReadBuffer: Memory limit exceed</code> error when inserting data with huge strings. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18690 rel="external nofollow noreferrer" target=_blank>#18690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18979 rel="external nofollow noreferrer" target=_blank>#18979</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Docker image: several improvements for clickhouse-server entrypoint. <a href=https://github.com/ClickHouse/ClickHouse/pull/18954 rel="external nofollow noreferrer" target=_blank>#18954</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Add <code class=syntax>normalizeQueryKeepNames</code> and <code class=syntax>normalizedQueryHashKeepNames</code> to normalize queries without masking long names with <code class=syntax>?</code>. This helps better analyze complex query logs. <a href=https://github.com/ClickHouse/ClickHouse/pull/18910 rel="external nofollow noreferrer" target=_blank>#18910</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Check per-block checksum of the distributed batch on the sender before sending (without reading the file twice, the checksums will be verified while reading), this will avoid stuck of the INSERT on the receiver (on truncated .bin file on the sender). Avoid reading .bin files twice for batched INSERT (it was required to calculate rows/bytes to take squashing into account, now this information included into the header, backward compatible is preserved). <a href=https://github.com/ClickHouse/ClickHouse/pull/18853 rel="external nofollow noreferrer" target=_blank>#18853</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix issues with RIGHT and FULL JOIN of tables with aggregate function states. In previous versions exception about <code class=syntax>cloneResized</code> method was thrown. <a href=https://github.com/ClickHouse/ClickHouse/pull/18818 rel="external nofollow noreferrer" target=_blank>#18818</a> (<a href=https://github.com/templarzq rel="external nofollow noreferrer" target=_blank>templarzq</a>).</li> <li>Added prefix-based S3 endpoint settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/18812 rel="external nofollow noreferrer" target=_blank>#18812</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add [UInt8, UInt16, UInt32, UInt64] arguments types support for bitmapTransform, bitmapSubsetInRange, bitmapSubsetLimit, bitmapContains functions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18713 rel="external nofollow noreferrer" target=_blank>#18713</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18791 rel="external nofollow noreferrer" target=_blank>#18791</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Allow CTE (Common Table Expressions) to be further aliased. Propagate CSE (Common Subexpressions Elimination) to subqueries in the same level when <code class=syntax>enable_global_with_statement = 1</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17378 rel="external nofollow noreferrer" target=_blank>#17378</a> . This fixes <a href=https://github.com/ClickHouse/ClickHouse/pull/16575#issuecomment-753416235 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/16575#issuecomment-753416235</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/18684 rel="external nofollow noreferrer" target=_blank>#18684</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Update librdkafka to v1.6.0-RC2. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18668 rel="external nofollow noreferrer" target=_blank>#18668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18671 rel="external nofollow noreferrer" target=_blank>#18671</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>In case of unexpected exceptions automatically restart background thread which is responsible for execution of distributed DDL queries. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17991 rel="external nofollow noreferrer" target=_blank>#17991</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18285 rel="external nofollow noreferrer" target=_blank>#18285</a> (<a href=https://github.com/weeds085490 rel="external nofollow noreferrer" target=_blank>徐炘</a>).</li> <li>Updated AWS C++ SDK in order to utilize global regions in S3. <a href=https://github.com/ClickHouse/ClickHouse/pull/17870 rel="external nofollow noreferrer" target=_blank>#17870</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Added support for <code class=syntax>WITH ... [AND] [PERIODIC] REFRESH [interval_in_sec]</code> clause when creating <code class=syntax>LIVE VIEW</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/14822 rel="external nofollow noreferrer" target=_blank>#14822</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>Restrict <code class=syntax>MODIFY TTL</code> queries for <code class=syntax>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href=https://github.com/ClickHouse/ClickHouse/pull/19064 rel="external nofollow noreferrer" target=_blank>#19064</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=bug-fix_4>Bug Fix<a class=headerlink href=#bug-fix_4 title="Permanent link"> </a></h4> <ul> <li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18364 rel="external nofollow noreferrer" target=_blank>#18364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18373 rel="external nofollow noreferrer" target=_blank>#18373</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix starting the server with tables having default expressions containing dictGet(). Allow getting return type of dictGet() without loading dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/19805 rel="external nofollow noreferrer" target=_blank>#19805</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix server crash after query with <code class=syntax>if</code> function with <code class=syntax>Tuple</code> type of then/else branches result. <code class=syntax>Tuple</code> type must contain <code class=syntax>Array</code> or another complex type. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18356 rel="external nofollow noreferrer" target=_blank>#18356</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20133 rel="external nofollow noreferrer" target=_blank>#20133</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (experimental feature): Fix replication for statements that update several tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/20066 rel="external nofollow noreferrer" target=_blank>#20066</a> (<a href=https://github.com/havardk rel="external nofollow noreferrer" target=_blank>Håvard Kvålen</a>).</li> <li>Prevent "Connection refused" in docker during initialization script execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/20012 rel="external nofollow noreferrer" target=_blank>#20012</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li><code class=syntax>EmbeddedRocksDB</code> is an experimental storage. Fix the issue with lack of proper type checking. Simplified code. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19967 rel="external nofollow noreferrer" target=_blank>#19967</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19972 rel="external nofollow noreferrer" target=_blank>#19972</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix a segfault in function <code class=syntax>fromModifiedJulianDay</code> when the argument type is <code class=syntax>Nullable(T)</code> for any integral types other than Int32. <a href=https://github.com/ClickHouse/ClickHouse/pull/19959 rel="external nofollow noreferrer" target=_blank>#19959</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>The function <code class=syntax>greatCircleAngle</code> returned inaccurate results in previous versions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19769 rel="external nofollow noreferrer" target=_blank>#19769</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19789 rel="external nofollow noreferrer" target=_blank>#19789</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix rare bug when some replicated operations (like mutation) cannot process some parts after data corruption. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19593 rel="external nofollow noreferrer" target=_blank>#19593</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19702 rel="external nofollow noreferrer" target=_blank>#19702</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Background thread which executes <code class=syntax>ON CLUSTER</code> queries might hang waiting for dropped replicated table to do something. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/19684 rel="external nofollow noreferrer" target=_blank>#19684</a> (<a href=https://github.com/yiguolei rel="external nofollow noreferrer" target=_blank>yiguolei</a>).</li> <li>Fix wrong deserialization of columns description. It makes INSERT into a table with a column named <code class=syntax>\</code> impossible. <a href=https://github.com/ClickHouse/ClickHouse/pull/19479 rel="external nofollow noreferrer" target=_blank>#19479</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Mark distributed batch as broken in case of empty data block in one of files. <a href=https://github.com/ClickHouse/ClickHouse/pull/19449 rel="external nofollow noreferrer" target=_blank>#19449</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed very rare bug that might cause mutation to hang after <code class=syntax>DROP/DETACH/REPLACE/MOVE PARTITION</code>. It was partially fixed by <a href=https://github.com/ClickHouse/ClickHouse/issues/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> for the most cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/19443 rel="external nofollow noreferrer" target=_blank>#19443</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix possible error <code class=syntax>Extremes transform was already added to pipeline</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14100 rel="external nofollow noreferrer" target=_blank>#14100</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19430 rel="external nofollow noreferrer" target=_blank>#19430</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix default value in join types with non-zero default (e.g. some Enums). Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18197 rel="external nofollow noreferrer" target=_blank>#18197</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19360 rel="external nofollow noreferrer" target=_blank>#19360</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Do not mark file for distributed send as broken on EOF. <a href=https://github.com/ClickHouse/ClickHouse/pull/19290 rel="external nofollow noreferrer" target=_blank>#19290</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix leaking of pipe fd for <code class=syntax>async_socket_for_remote</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19153 rel="external nofollow noreferrer" target=_blank>#19153</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix infinite reading from file in <code class=syntax>ORC</code> format (was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/10580 rel="external nofollow noreferrer" target=_blank>#10580</a>). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19095 rel="external nofollow noreferrer" target=_blank>#19095</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19134 rel="external nofollow noreferrer" target=_blank>#19134</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix issue in merge tree data writer which can lead to marks with bigger size than fixed granularity size. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18913 rel="external nofollow noreferrer" target=_blank>#18913</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19123 rel="external nofollow noreferrer" target=_blank>#19123</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix startup bug when clickhouse was not able to read compression codec from <code class=syntax>LowCardinality(Nullable(...))</code> and throws exception <code class=syntax>Attempt to read after EOF</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18340 rel="external nofollow noreferrer" target=_blank>#18340</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19101 rel="external nofollow noreferrer" target=_blank>#19101</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Simplify the implementation of <code class=syntax>tupleHammingDistance</code>. Support for tuples of any equal length. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19029 rel="external nofollow noreferrer" target=_blank>#19029</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19084 rel="external nofollow noreferrer" target=_blank>#19084</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Make sure <code class=syntax>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17875 rel="external nofollow noreferrer" target=_blank>#17875</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19019 rel="external nofollow noreferrer" target=_blank>#19019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible error <code class=syntax>Expected single dictionary argument for function</code> if use function <code class=syntax>ignore</code> with <code class=syntax>LowCardinality</code> argument. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14275 rel="external nofollow noreferrer" target=_blank>#14275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19016 rel="external nofollow noreferrer" target=_blank>#19016</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix inserting of <code class=syntax>LowCardinality</code> column to table with <code class=syntax>TinyLog</code> engine. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18629 rel="external nofollow noreferrer" target=_blank>#18629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19010 rel="external nofollow noreferrer" target=_blank>#19010</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix minor issue in JOIN: Join tries to materialize const columns, but our code waits for them in other places. <a href=https://github.com/ClickHouse/ClickHouse/pull/18982 rel="external nofollow noreferrer" target=_blank>#18982</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Disable <code class=syntax>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18051 rel="external nofollow noreferrer" target=_blank>#18051</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18973 rel="external nofollow noreferrer" target=_blank>#18973</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18981 rel="external nofollow noreferrer" target=_blank>#18981</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible exception <code class=syntax>QueryPipeline stream: different number of columns</code> caused by merging of query plan's <code class=syntax>Expression</code> steps. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18190 rel="external nofollow noreferrer" target=_blank>#18190</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18980 rel="external nofollow noreferrer" target=_blank>#18980</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed very rare deadlock at shutdown. <a href=https://github.com/ClickHouse/ClickHouse/pull/18977 rel="external nofollow noreferrer" target=_blank>#18977</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed rare crashes when server run out of memory. <a href=https://github.com/ClickHouse/ClickHouse/pull/18976 rel="external nofollow noreferrer" target=_blank>#18976</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix incorrect behavior when <code class=syntax>ALTER TABLE ... DROP PART 'part_name'</code> query removes all deduplication blocks for the whole partition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18874 rel="external nofollow noreferrer" target=_blank>#18874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18969 rel="external nofollow noreferrer" target=_blank>#18969</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed issue <a href=https://github.com/ClickHouse/ClickHouse/issues/18894 rel="external nofollow noreferrer" target=_blank>#18894</a> Add a check to avoid exception when long column alias('table.column' style, usually auto-generated by BI tools like Looker) equals to long table name. <a href=https://github.com/ClickHouse/ClickHouse/pull/18968 rel="external nofollow noreferrer" target=_blank>#18968</a> (<a href=https://github.com/mathfool rel="external nofollow noreferrer" target=_blank>Daniel Qin</a>).</li> <li>Fix error <code class=syntax>Task was not found in task queue</code> (possible only for remote queries, with <code class=syntax>async_socket_for_remote = 1</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/18964 rel="external nofollow noreferrer" target=_blank>#18964</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug when mutation with some escaped text (like <code class=syntax>ALTER ... UPDATE e = CAST('foo', 'Enum8(\'foo\' = 1')</code> serialized incorrectly. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18878 rel="external nofollow noreferrer" target=_blank>#18878</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18944 rel="external nofollow noreferrer" target=_blank>#18944</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>ATTACH PARTITION will reset mutations. <a href=https://github.com/ClickHouse/ClickHouse/issues/18804 rel="external nofollow noreferrer" target=_blank>#18804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18935 rel="external nofollow noreferrer" target=_blank>#18935</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix issue with <code class=syntax>bitmapOrCardinality</code> that may lead to nullptr dereference. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18911 rel="external nofollow noreferrer" target=_blank>#18911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18912 rel="external nofollow noreferrer" target=_blank>#18912</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fixed <code class=syntax>Attempt to read after eof</code> error when trying to <code class=syntax>CAST</code> <code class=syntax>NULL</code> from <code class=syntax>Nullable(String)</code> to <code class=syntax>Nullable(Decimal(P, S))</code>. Now function <code class=syntax>CAST</code> returns <code class=syntax>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7690 rel="external nofollow noreferrer" target=_blank>#7690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18718 rel="external nofollow noreferrer" target=_blank>#18718</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix data type convert issue for MySQL engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/18124 rel="external nofollow noreferrer" target=_blank>#18124</a> (<a href=https://github.com/mis98zb rel="external nofollow noreferrer" target=_blank>bo zeng</a>).</li> <li>Fix clickhouse-client abort exception while executing only <code class=syntax>select</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19790 rel="external nofollow noreferrer" target=_blank>#19790</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> </ul> <h4 id=build-testing-packaging-improvement_4>Build/Testing/Packaging Improvement<a class=headerlink href=#build-testing-packaging-improvement_4 title="Permanent link"> </a></h4> <ul> <li>Run <a href=https://twitter.com/RiggerManuel/status/1352345625480884228 rel="external nofollow noreferrer" target=_blank>SQLancer</a> (logical SQL fuzzer) in CI. <a href=https://github.com/ClickHouse/ClickHouse/pull/19006 rel="external nofollow noreferrer" target=_blank>#19006</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Query Fuzzer will fuzz newly added tests more extensively. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18916 rel="external nofollow noreferrer" target=_blank>#18916</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19185 rel="external nofollow noreferrer" target=_blank>#19185</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Integrate with <a href=https://github.com/minimaxir/big-list-of-naughty-strings/ rel="external nofollow noreferrer" target=_blank>Big List of Naughty Strings</a> for better fuzzing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19480 rel="external nofollow noreferrer" target=_blank>#19480</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add integration tests run with MSan. <a href=https://github.com/ClickHouse/ClickHouse/pull/18974 rel="external nofollow noreferrer" target=_blank>#18974</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed MemorySanitizer errors in cyrus-sasl and musl. <a href=https://github.com/ClickHouse/ClickHouse/pull/19821 rel="external nofollow noreferrer" target=_blank>#19821</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Insuffiient arguments check in <code class=syntax>positionCaseInsensitiveUTF8</code> function triggered address sanitizer. <a href=https://github.com/ClickHouse/ClickHouse/pull/19720 rel="external nofollow noreferrer" target=_blank>#19720</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove --project-directory for docker-compose in integration test. Fix logs formatting from docker container. <a href=https://github.com/ClickHouse/ClickHouse/pull/19706 rel="external nofollow noreferrer" target=_blank>#19706</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Made generation of macros.xml easier for integration tests. No more excessive logging from dicttoxml. dicttoxml project is not active for 5+ years. <a href=https://github.com/ClickHouse/ClickHouse/pull/19697 rel="external nofollow noreferrer" target=_blank>#19697</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Allow to explicitly enable or disable watchdog via environment variable <code class=syntax>CLICKHOUSE_WATCHDOG_ENABLE</code>. By default it is enabled if server is not attached to terminal. <a href=https://github.com/ClickHouse/ClickHouse/pull/19522 rel="external nofollow noreferrer" target=_blank>#19522</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow building ClickHouse with Kafka support on arm64. <a href=https://github.com/ClickHouse/ClickHouse/pull/19369 rel="external nofollow noreferrer" target=_blank>#19369</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Allow building librdkafka without ssl. <a href=https://github.com/ClickHouse/ClickHouse/pull/19337 rel="external nofollow noreferrer" target=_blank>#19337</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Restore Kafka input in FreeBSD builds. <a href=https://github.com/ClickHouse/ClickHouse/pull/18924 rel="external nofollow noreferrer" target=_blank>#18924</a> (<a href=https://github.com/snar rel="external nofollow noreferrer" target=_blank>Alexandre Snarskii</a>).</li> <li>Fix potential nullptr dereference in table function <code class=syntax>VALUES</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19357 rel="external nofollow noreferrer" target=_blank>#19357</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Avoid UBSan reports in <code class=syntax>arrayElement</code> function, <code class=syntax>substring</code> and <code class=syntax>arraySum</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19305 rel="external nofollow noreferrer" target=_blank>#19305</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19287 rel="external nofollow noreferrer" target=_blank>#19287</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19336 rel="external nofollow noreferrer" target=_blank>#19336</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19347 rel="external nofollow noreferrer" target=_blank>#19347</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h2 id=clickhouse-release-21-1>ClickHouse release 21.1<a class=headerlink href=#clickhouse-release-21-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v21-1-3-32-stable-2021-02-03>ClickHouse release v21.1.3.32-stable, 2021-02-03<a class=headerlink href=#clickhouse-release-v21-1-3-32-stable-2021-02-03 title="Permanent link"> </a></h3> <h4 id=bug-fix_5>Bug Fix<a class=headerlink href=#bug-fix_5 title="Permanent link"> </a></h4> <ul> <li>BloomFilter index crash fix. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19757 rel="external nofollow noreferrer" target=_blank>#19757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19884 rel="external nofollow noreferrer" target=_blank>#19884</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fix crash when pushing down predicates to union distinct subquery. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19855 rel="external nofollow noreferrer" target=_blank>#19855</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19861 rel="external nofollow noreferrer" target=_blank>#19861</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix filtering by UInt8 greater than 127. <a href=https://github.com/ClickHouse/ClickHouse/pull/19799 rel="external nofollow noreferrer" target=_blank>#19799</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>In previous versions, unusual arguments for function arrayEnumerateUniq may cause crash or infinite loop. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19787 rel="external nofollow noreferrer" target=_blank>#19787</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19788 rel="external nofollow noreferrer" target=_blank>#19788</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed stack overflow when using accurate comparison of arithmetic type with string type. <a href=https://github.com/ClickHouse/ClickHouse/pull/19773 rel="external nofollow noreferrer" target=_blank>#19773</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix crash when nested column name was used in <code class=syntax>WHERE</code> or <code class=syntax>PREWHERE</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19755 rel="external nofollow noreferrer" target=_blank>#19755</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19763 rel="external nofollow noreferrer" target=_blank>#19763</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix a segmentation fault in <code class=syntax>bitmapAndnot</code> function. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19668 rel="external nofollow noreferrer" target=_blank>#19668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19713 rel="external nofollow noreferrer" target=_blank>#19713</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Some functions with big integers may cause segfault. Big integers is experimental feature. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19667 rel="external nofollow noreferrer" target=_blank>#19667</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19672 rel="external nofollow noreferrer" target=_blank>#19672</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix wrong result of function <code class=syntax>neighbor</code> for <code class=syntax>LowCardinality</code> argument. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10333 rel="external nofollow noreferrer" target=_blank>#10333</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19617 rel="external nofollow noreferrer" target=_blank>#19617</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix use-after-free of the CompressedWriteBuffer in Connection after disconnect. <a href=https://github.com/ClickHouse/ClickHouse/pull/19599 rel="external nofollow noreferrer" target=_blank>#19599</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>DROP/DETACH TABLE table ON CLUSTER cluster SYNC</code> query might hang, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19568 rel="external nofollow noreferrer" target=_blank>#19568</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19572 rel="external nofollow noreferrer" target=_blank>#19572</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Query CREATE DICTIONARY id expression fix. <a href=https://github.com/ClickHouse/ClickHouse/pull/19571 rel="external nofollow noreferrer" target=_blank>#19571</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fix SIGSEGV with merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read=0/UINT64_MAX. <a href=https://github.com/ClickHouse/ClickHouse/pull/19528 rel="external nofollow noreferrer" target=_blank>#19528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Buffer overflow (on memory read) was possible if <code class=syntax>addMonth</code> function was called with specifically crafted arguments. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19441 rel="external nofollow noreferrer" target=_blank>#19441</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19413 rel="external nofollow noreferrer" target=_blank>#19413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19472 rel="external nofollow noreferrer" target=_blank>#19472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Uninitialized memory read was possible in encrypt/decrypt functions if empty string was passed as IV. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19391 rel="external nofollow noreferrer" target=_blank>#19391</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19397 rel="external nofollow noreferrer" target=_blank>#19397</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible buffer overflow in Uber H3 library. See <a href=https://github.com/uber/h3/issues/392 target=_blank>https://github.com/uber/h3/issues/392</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19219 rel="external nofollow noreferrer" target=_blank>#19219</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19383 rel="external nofollow noreferrer" target=_blank>#19383</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix system.parts _state column (LOGICAL_ERROR when querying this column, due to incorrect order). <a href=https://github.com/ClickHouse/ClickHouse/pull/19346 rel="external nofollow noreferrer" target=_blank>#19346</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed possible wrong result or segfault on aggregation when Materialized View and its target table have different structure. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18063 rel="external nofollow noreferrer" target=_blank>#18063</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19322 rel="external nofollow noreferrer" target=_blank>#19322</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix error <code class=syntax>Cannot convert column now64() because it is constant but values of constants are different in source and result</code>. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/7156 rel="external nofollow noreferrer" target=_blank>#7156</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19316 rel="external nofollow noreferrer" target=_blank>#19316</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug when concurrent <code class=syntax>ALTER</code> and <code class=syntax>DROP</code> queries may hang while processing ReplicatedMergeTree table. <a href=https://github.com/ClickHouse/ClickHouse/pull/19237 rel="external nofollow noreferrer" target=_blank>#19237</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed <code class=syntax>There is no checkpoint</code> error when inserting data through http interface using <code class=syntax>Template</code> or <code class=syntax>CustomSeparated</code> format. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19021 rel="external nofollow noreferrer" target=_blank>#19021</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19072 rel="external nofollow noreferrer" target=_blank>#19072</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Disable constant folding for subqueries on the analysis stage, when the result cannot be calculated. <a href=https://github.com/ClickHouse/ClickHouse/pull/18446 rel="external nofollow noreferrer" target=_blank>#18446</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Mutation might hang waiting for some non-existent part after <code class=syntax>MOVE</code> or <code class=syntax>REPLACE PARTITION</code> or, in rare cases, after <code class=syntax>DETACH</code> or <code class=syntax>DROP PARTITION</code>. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h3 id=clickhouse-release-v21-1-2-15-stable-2021-01-18>ClickHouse release v21.1.2.15-stable 2021-01-18<a class=headerlink href=#clickhouse-release-v21-1-2-15-stable-2021-01-18 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change_4>Backward Incompatible Change<a class=headerlink href=#backward-incompatible-change_4 title="Permanent link"> </a></h4> <ul> <li>The setting <code class=syntax>input_format_null_as_default</code> is enabled by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/17525 rel="external nofollow noreferrer" target=_blank>#17525</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Check settings constraints for profile settings from config. Server will fail to start if users.xml contain settings that do not meet corresponding constraints. <a href=https://github.com/ClickHouse/ClickHouse/pull/18486 rel="external nofollow noreferrer" target=_blank>#18486</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Restrict <code class=syntax>ALTER MODIFY SETTING</code> from changing storage settings that affects data parts (<code class=syntax>write_final_mark</code> and <code class=syntax>enable_mixed_granularity_parts</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/18306 rel="external nofollow noreferrer" target=_blank>#18306</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Set <code class=syntax>insert_quorum_parallel</code> to 1 by default. It is significantly more convenient to use than "sequential" quorum inserts. But if you rely to sequential consistency, you should set the setting back to zero. <a href=https://github.com/ClickHouse/ClickHouse/pull/17567 rel="external nofollow noreferrer" target=_blank>#17567</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove <code class=syntax>sumburConsistentHash</code> function. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18120 rel="external nofollow noreferrer" target=_blank>#18120</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18656 rel="external nofollow noreferrer" target=_blank>#18656</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Removed aggregate functions <code class=syntax>timeSeriesGroupSum</code>, <code class=syntax>timeSeriesGroupRateSum</code> because a friend of mine said they never worked. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16869 rel="external nofollow noreferrer" target=_blank>#16869</a>. If you have luck using these functions, write a email to <a href=mailto:clickhouse-feedback@yandex-team.com>clickhouse-feedback@yandex-team.com</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17423 rel="external nofollow noreferrer" target=_blank>#17423</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Prohibit toUnixTimestamp(Date()) (before it just returns UInt16 representation of Date). <a href=https://github.com/ClickHouse/ClickHouse/pull/17376 rel="external nofollow noreferrer" target=_blank>#17376</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow using extended integer types (<code class=syntax>Int128</code>, <code class=syntax>Int256</code>, <code class=syntax>UInt256</code>) in <code class=syntax>avg</code> and <code class=syntax>avgWeighted</code> functions. Also allow using different types (integer, decimal, floating point) for value and for weight in <code class=syntax>avgWeighted</code> function. This is a backward-incompatible change: now the <code class=syntax>avg</code> and <code class=syntax>avgWeighted</code> functions always return <code class=syntax>Float64</code> (as documented). Before this change the return type for <code class=syntax>Decimal</code> arguments was also <code class=syntax>Decimal</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15419 rel="external nofollow noreferrer" target=_blank>#15419</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>Expression <code class=syntax>toUUID(N)</code> no longer works. Replace with <code class=syntax>toUUID('00000000-0000-0000-0000-000000000000')</code>. This change is motivated by non-obvious results of <code class=syntax>toUUID(N)</code> where N is non zero.</li> <li>SSL Certificates with incorrect "key usage" are rejected. In previous versions they are used to work. See <a href=https://github.com/ClickHouse/ClickHouse/issues/19262 rel="external nofollow noreferrer" target=_blank>#19262</a>.</li> <li><code class=syntax>incl</code> references to substitutions file (<code class=syntax>/etc/metrika.xml</code>) were removed from the default config (<code class=syntax>&lt;remote_servers&gt;</code>, <code class=syntax>&lt;zookeeper&gt;</code>, <code class=syntax>&lt;macros&gt;</code>, <code class=syntax>&lt;compression&gt;</code>, <code class=syntax>&lt;networks&gt;</code>). If you were using substitutions file and were relying on those implicit references, you should put them back manually and explicitly by adding corresponding sections with <code class=syntax>incl="..."</code> attributes before the update. See <a href=https://github.com/ClickHouse/ClickHouse/pull/18740 rel="external nofollow noreferrer" target=_blank>#18740</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=new-feature_5>New Feature<a class=headerlink href=#new-feature_5 title="Permanent link"> </a></h4> <ul> <li>Implement gRPC protocol in ClickHouse. <a href=https://github.com/ClickHouse/ClickHouse/pull/15111 rel="external nofollow noreferrer" target=_blank>#15111</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Allow to use multiple zookeeper clusters. <a href=https://github.com/ClickHouse/ClickHouse/pull/17070 rel="external nofollow noreferrer" target=_blank>#17070</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Implemented <code class=syntax>REPLACE TABLE</code> and <code class=syntax>CREATE OR REPLACE TABLE</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/18521 rel="external nofollow noreferrer" target=_blank>#18521</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Implement <code class=syntax>UNION DISTINCT</code> and treat the plain <code class=syntax>UNION</code> clause as <code class=syntax>UNION DISTINCT</code> by default. Add a setting <code class=syntax>union_default_mode</code> that allows to treat it as <code class=syntax>UNION ALL</code> or require explicit mode specification. <a href=https://github.com/ClickHouse/ClickHouse/pull/16338 rel="external nofollow noreferrer" target=_blank>#16338</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Added function <code class=syntax>accurateCastOrNull</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10290 rel="external nofollow noreferrer" target=_blank>#10290</a>. Add type conversions in <code class=syntax>x IN (subquery)</code> expressions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10266 rel="external nofollow noreferrer" target=_blank>#10266</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16724 rel="external nofollow noreferrer" target=_blank>#16724</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>IP Dictionary supports <code class=syntax>IPv4</code> / <code class=syntax>IPv6</code> types directly. <a href=https://github.com/ClickHouse/ClickHouse/pull/17571 rel="external nofollow noreferrer" target=_blank>#17571</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>IP Dictionary supports key fetching. Resolves <a href=https://github.com/ClickHouse/ClickHouse/issues/18241 rel="external nofollow noreferrer" target=_blank>#18241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18480 rel="external nofollow noreferrer" target=_blank>#18480</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Add <code class=syntax>*.zst</code> compression/decompression support for data import and export. It enables using <code class=syntax>*.zst</code> in <code class=syntax>file()</code> function and <code class=syntax>Content-encoding: zstd</code> in HTTP client. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/16791 rel="external nofollow noreferrer" target=_blank>#16791 </a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17144 rel="external nofollow noreferrer" target=_blank>#17144</a> (<a href=https://github.com/fibersel rel="external nofollow noreferrer" target=_blank>Abi Palagashvili</a>).</li> <li>Added <code class=syntax>mannWitneyUTest</code>, <code class=syntax>studentTTest</code> and <code class=syntax>welchTTest</code> aggregate functions. Refactored <code class=syntax>rankCorr</code> a bit. <a href=https://github.com/ClickHouse/ClickHouse/pull/16883 rel="external nofollow noreferrer" target=_blank>#16883</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Add functions <code class=syntax>countMatches</code>/<code class=syntax>countMatchesCaseInsensitive</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17459 rel="external nofollow noreferrer" target=_blank>#17459</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Implement <code class=syntax>countSubstrings()</code>/<code class=syntax>countSubstringsCaseInsensitive()</code>/<code class=syntax>countSubstringsCaseInsensitiveUTF8()</code> (Count the number of substring occurrences). <a href=https://github.com/ClickHouse/ClickHouse/pull/17347 rel="external nofollow noreferrer" target=_blank>#17347</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add information about used databases, tables and columns in system.query_log. Add <code class=syntax>query_kind</code> and <code class=syntax>normalized_query_hash</code> fields. <a href=https://github.com/ClickHouse/ClickHouse/pull/17726 rel="external nofollow noreferrer" target=_blank>#17726</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add a setting <code class=syntax>optimize_on_insert</code>. When enabled, do the same transformation for INSERTed block of data as if merge was done on this block (e.g. Replacing, Collapsing, Aggregating...). This setting is enabled by default. This can influence Materialized View and MaterializeMySQL behaviour (see detailed description). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10683 rel="external nofollow noreferrer" target=_blank>#10683</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16954 rel="external nofollow noreferrer" target=_blank>#16954</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Kerberos Authenticaiton for HDFS. <a href=https://github.com/ClickHouse/ClickHouse/pull/16621 rel="external nofollow noreferrer" target=_blank>#16621</a> (<a href=https://github.com/ilejn rel="external nofollow noreferrer" target=_blank>Ilya Golshtein</a>).</li> <li>Support <code class=syntax>SHOW SETTINGS</code> statement to show parameters in system.settings. <code class=syntax>SHOW CHANGED SETTINGS</code> and <code class=syntax>LIKE/ILIKE</code> clause are also supported. <a href=https://github.com/ClickHouse/ClickHouse/pull/18056 rel="external nofollow noreferrer" target=_blank>#18056</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Function <code class=syntax>position</code> now supports <code class=syntax>POSITION(needle IN haystack)</code> synax for SQL compatibility. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18701 rel="external nofollow noreferrer" target=_blank>#18701</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/18779 rel="external nofollow noreferrer" target=_blank>#18779</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Now we have a new storage setting <code class=syntax>max_partitions_to_read</code> for tables in the MergeTree family. It limits the max number of partitions that can be accessed in one query. A user setting <code class=syntax>force_max_partition_limit</code> is also added to enforce this constraint. <a href=https://github.com/ClickHouse/ClickHouse/pull/18712 rel="external nofollow noreferrer" target=_blank>#18712</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add <code class=syntax>query_id</code> column to <code class=syntax>system.part_log</code> for inserted parts. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10097 rel="external nofollow noreferrer" target=_blank>#10097</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18644 rel="external nofollow noreferrer" target=_blank>#18644</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Allow create table as select with columns specification. Example <code class=syntax>CREATE TABLE t1 (x String) ENGINE = Memory AS SELECT 1;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18060 rel="external nofollow noreferrer" target=_blank>#18060</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added <code class=syntax>arrayMin</code>, <code class=syntax>arrayMax</code>, <code class=syntax>arrayAvg</code> aggregation functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/18032 rel="external nofollow noreferrer" target=_blank>#18032</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Implemented <code class=syntax>ATTACH TABLE name FROM 'path/to/data/' (col1 Type1, ...</code> query. It creates new table with provided structure and attaches table data from provided directory in <code class=syntax>user_files</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17903 rel="external nofollow noreferrer" target=_blank>#17903</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Add mutation support for StorageMemory. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9117 rel="external nofollow noreferrer" target=_blank>#9117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15127 rel="external nofollow noreferrer" target=_blank>#15127</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Support syntax <code class=syntax>EXISTS DATABASE name</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18458 rel="external nofollow noreferrer" target=_blank>#18458</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Support builtin function <code class=syntax>isIPv4String</code> &amp;&amp; <code class=syntax>isIPv6String</code> like <a href="https://github.com/ClickHouse/ClickHouse/compare/master...spongedu:support_is_ipv4?expand=1" rel="external nofollow noreferrer" target=_blank>MySQL</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18349 rel="external nofollow noreferrer" target=_blank>#18349</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Add a new setting <code class=syntax>insert_distributed_one_random_shard = 1</code> to allow insertion into multi-sharded distributed table without any distributed key. <a href=https://github.com/ClickHouse/ClickHouse/pull/18294 rel="external nofollow noreferrer" target=_blank>#18294</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add settings <code class=syntax>min_compress_block_size</code> and <code class=syntax>max_compress_block_size</code> to MergeTreeSettings, which have higher priority than the global settings and take effect when they are set. close <a href=https://github.com/ClickHouse/ClickHouse/issues/13890 rel="external nofollow noreferrer" target=_blank>13890</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17867 rel="external nofollow noreferrer" target=_blank>#17867</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add support for 64bit roaring bitmaps. <a href=https://github.com/ClickHouse/ClickHouse/pull/17858 rel="external nofollow noreferrer" target=_blank>#17858</a> (<a href=https://github.com/andyyzh rel="external nofollow noreferrer" target=_blank>Andy Yang</a>).</li> <li>Extended <code class=syntax>OPTIMIZE ... DEDUPLICATE</code> syntax to allow explicit (or implicit with asterisk/column transformers) list of columns to check for duplicates on. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/17846 rel="external nofollow noreferrer" target=_blank>#17846</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Added functions <code class=syntax>toModifiedJulianDay</code>, <code class=syntax>fromModifiedJulianDay</code>, <code class=syntax>toModifiedJulianDayOrNull</code>, and <code class=syntax>fromModifiedJulianDayOrNull</code>. These functions convert between Proleptic Gregorian calendar date and Modified Julian Day number. <a href=https://github.com/ClickHouse/ClickHouse/pull/17750 rel="external nofollow noreferrer" target=_blank>#17750</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>Add ability to use custom TLD list: added functions <code class=syntax>firstSignificantSubdomainCustom</code>, <code class=syntax>cutToFirstSignificantSubdomainCustom</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17748 rel="external nofollow noreferrer" target=_blank>#17748</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add support for <code class=syntax>PROXYv1</code> protocol to wrap native TCP interface. Allow quotas to be keyed by proxy-forwarded IP address (applied for <code class=syntax>PROXYv1</code> address and for <code class=syntax>X-Forwarded-For</code> from HTTP interface). This is useful when you provide access to ClickHouse only via trusted proxy (e.g. CloudFlare) but want to account user resources by their original IP addresses. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17268 rel="external nofollow noreferrer" target=_blank>#17268</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17707 rel="external nofollow noreferrer" target=_blank>#17707</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Now clickhouse-client supports opening <code class=syntax>EDITOR</code> to edit commands. <code class=syntax>Alt-Shift-E</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17665 rel="external nofollow noreferrer" target=_blank>#17665</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add function <code class=syntax>encodeXMLComponent</code> to escape characters to place string into XML text node or attribute. <a href=https://github.com/ClickHouse/ClickHouse/pull/17659 rel="external nofollow noreferrer" target=_blank>#17659</a> (<a href=https://github.com/nautaa rel="external nofollow noreferrer" target=_blank>nauta</a>).</li> <li>Introduce <code class=syntax>DETACH TABLE/VIEW ... PERMANENTLY</code> syntax, so that after restarting the table does not reappear back automatically on restart (only by explicit request). The table can still be attached back using the short syntax ATTACH TABLE. Implements <a href=https://github.com/ClickHouse/ClickHouse/issues/5555 rel="external nofollow noreferrer" target=_blank>#5555</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13850 rel="external nofollow noreferrer" target=_blank>#13850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17642 rel="external nofollow noreferrer" target=_blank>#17642</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Add asynchronous metrics on total amount of rows, bytes and parts in MergeTree tables. This fix <a href=https://github.com/ClickHouse/ClickHouse/issues/11714 rel="external nofollow noreferrer" target=_blank>#11714</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17639 rel="external nofollow noreferrer" target=_blank>#17639</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add settings <code class=syntax>limit</code> and <code class=syntax>offset</code> for out-of-SQL pagination: <a href=https://github.com/ClickHouse/ClickHouse/issues/16176 rel="external nofollow noreferrer" target=_blank>#16176</a> They are useful for building APIs. These two settings will affect SELECT query as if it is added like <code class=syntax>select * from (your_original_select_query) t limit xxx offset xxx;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17633 rel="external nofollow noreferrer" target=_blank>#17633</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Provide a new aggregator combinator : <code class=syntax>-SimpleState</code> to build <code class=syntax>SimpleAggregateFunction</code> types via query. It's useful for defining MaterializedView of AggregatingMergeTree engine, and will benefit projections too. <a href=https://github.com/ClickHouse/ClickHouse/pull/16853 rel="external nofollow noreferrer" target=_blank>#16853</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added <code class=syntax>queries-file</code> parameter for <code class=syntax>clickhouse-client</code> and <code class=syntax>clickhouse-local</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15930 rel="external nofollow noreferrer" target=_blank>#15930</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added <code class=syntax>query</code> parameter for <code class=syntax>clickhouse-benchmark</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17832 rel="external nofollow noreferrer" target=_blank>#17832</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li><code class=syntax>EXPLAIN AST</code> now support queries other then <code class=syntax>SELECT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18136 rel="external nofollow noreferrer" target=_blank>#18136</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> </ul> <h4 id=experimental-feature_3>Experimental Feature<a class=headerlink href=#experimental-feature_3 title="Permanent link"> </a></h4> <ul> <li>Added functions for calculation of minHash and simHash of text n-grams and shingles. They are intended for semi-duplicate search. Also functions <code class=syntax>bitHammingDistance</code> and <code class=syntax>tupleHammingDistance</code> are added. <a href=https://github.com/ClickHouse/ClickHouse/pull/7649 rel="external nofollow noreferrer" target=_blank>#7649</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add new data type <code class=syntax>Map</code>. See <a href=https://github.com/ClickHouse/ClickHouse/issues/1841 rel="external nofollow noreferrer" target=_blank>#1841</a>. First version for Map only supports <code class=syntax>String</code> type of key and value. <a href=https://github.com/ClickHouse/ClickHouse/pull/15806 rel="external nofollow noreferrer" target=_blank>#15806</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Implement alternative SQL parser based on ANTLR4 runtime and generated from EBNF grammar. <a href=https://github.com/ClickHouse/ClickHouse/pull/11298 rel="external nofollow noreferrer" target=_blank>#11298</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> </ul> <h4 id=performance-improvement_5>Performance Improvement<a class=headerlink href=#performance-improvement_5 title="Permanent link"> </a></h4> <ul> <li>New IP Dictionary implementation with lower memory consumption, improved performance for some cases, and fixed bugs. <a href=https://github.com/ClickHouse/ClickHouse/pull/16804 rel="external nofollow noreferrer" target=_blank>#16804</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Parallel formatting for data export. <a href=https://github.com/ClickHouse/ClickHouse/pull/11617 rel="external nofollow noreferrer" target=_blank>#11617</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>LDAP integration: Added <code class=syntax>verification_cooldown</code> parameter in LDAP server connection configuration to allow caching of successful "bind" attempts for configurable period of time. <a href=https://github.com/ClickHouse/ClickHouse/pull/15988 rel="external nofollow noreferrer" target=_blank>#15988</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Add <code class=syntax>--no-system-table</code> option for <code class=syntax>clickhouse-local</code> to run without system tables. This avoids initialization of <code class=syntax>DateLUT</code> that may take noticeable amount of time (tens of milliseconds) at startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/18899 rel="external nofollow noreferrer" target=_blank>#18899</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Replace <code class=syntax>PODArray</code> with <code class=syntax>PODArrayWithStackMemory</code> in <code class=syntax>AggregateFunctionWindowFunnelData</code> to improve <code class=syntax>windowFunnel</code> function performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/18817 rel="external nofollow noreferrer" target=_blank>#18817</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Don't send empty blocks to shards on synchronous INSERT into Distributed table. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14571 rel="external nofollow noreferrer" target=_blank>#14571</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18775 rel="external nofollow noreferrer" target=_blank>#18775</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Optimized read for StorageMemory. <a href=https://github.com/ClickHouse/ClickHouse/pull/18052 rel="external nofollow noreferrer" target=_blank>#18052</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Using Dragonbox algorithm for float to string conversion instead of ryu. This improves performance of float to string conversion significantly. <a href=https://github.com/ClickHouse/ClickHouse/pull/17831 rel="external nofollow noreferrer" target=_blank>#17831</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Speedup <code class=syntax>IPv6CIDRToRange</code> implementation. <a href=https://github.com/ClickHouse/ClickHouse/pull/17569 rel="external nofollow noreferrer" target=_blank>#17569</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Add <code class=syntax>remerge_sort_lowered_memory_bytes_ratio</code> setting (If memory usage after remerge does not reduced by this ratio, remerge will be disabled). <a href=https://github.com/ClickHouse/ClickHouse/pull/17539 rel="external nofollow noreferrer" target=_blank>#17539</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Improve performance of AggregatingMergeTree with SimpleAggregateFunction(String) in PK. <a href=https://github.com/ClickHouse/ClickHouse/pull/17109 rel="external nofollow noreferrer" target=_blank>#17109</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Now the <code class=syntax>-If</code> combinator is devirtualized, and <code class=syntax>count</code> is properly vectorized. It is for <a href=https://github.com/ClickHouse/ClickHouse/pull/17041 rel="external nofollow noreferrer" target=_blank>this PR</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17043 rel="external nofollow noreferrer" target=_blank>#17043</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix performance of reading from <code class=syntax>Merge</code> tables over huge number of <code class=syntax>MergeTree</code> tables. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7748 rel="external nofollow noreferrer" target=_blank>#7748</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16988 rel="external nofollow noreferrer" target=_blank>#16988</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Improved performance of function <code class=syntax>repeat</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16937 rel="external nofollow noreferrer" target=_blank>#16937</a> (<a href=https://github.com/satanson rel="external nofollow noreferrer" target=_blank>satanson</a>).</li> <li>Slightly improved performance of float parsing. <a href=https://github.com/ClickHouse/ClickHouse/pull/16809 rel="external nofollow noreferrer" target=_blank>#16809</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add possibility to skip merged partitions for <code class=syntax>OPTIMIZE TABLE ... FINAL</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15939 rel="external nofollow noreferrer" target=_blank>#15939</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Integrate with <a href=https://github.com/lemire/fast_float rel="external nofollow noreferrer" target=_blank>fast_float from Daniel Lemire</a> to parse floating point numbers. <a href=https://github.com/ClickHouse/ClickHouse/pull/16787 rel="external nofollow noreferrer" target=_blank>#16787</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>). It is not enabled, because performance its performance is still lower than rough float parser in ClickHouse.</li> <li>Fix max_distributed_connections (affects <code class=syntax>prefer_localhost_replica = 1</code> and <code class=syntax>max_threads != max_distributed_connections</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17848 rel="external nofollow noreferrer" target=_blank>#17848</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Adaptive choice of single/multi part upload when sending data to S3. Single part upload is controlled by a new setting <code class=syntax>max_single_part_upload_size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17934 rel="external nofollow noreferrer" target=_blank>#17934</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Support for async tasks in <code class=syntax>PipelineExecutor</code>. Initial support of async sockets for remote queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/17868 rel="external nofollow noreferrer" target=_blank>#17868</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Allow to use <code class=syntax>optimize_move_to_prewhere</code> optimization with compact parts, when sizes of columns are unknown. <a href=https://github.com/ClickHouse/ClickHouse/pull/17330 rel="external nofollow noreferrer" target=_blank>#17330</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=improvement_5>Improvement<a class=headerlink href=#improvement_5 title="Permanent link"> </a></h4> <ul> <li>Avoid deadlock when executing INSERT SELECT into itself from a table with <code class=syntax>TinyLog</code> or <code class=syntax>Log</code> table engines. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/6802 rel="external nofollow noreferrer" target=_blank>#6802</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18691 rel="external nofollow noreferrer" target=_blank>#18691</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/16812 rel="external nofollow noreferrer" target=_blank>#16812</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14570 rel="external nofollow noreferrer" target=_blank>#14570</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15260 rel="external nofollow noreferrer" target=_blank>#15260</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support <code class=syntax>SHOW CREATE VIEW name</code> syntax like <a href=https://dev.mysql.com/doc/refman/5.7/en/show-create-view.html rel="external nofollow noreferrer" target=_blank>MySQL</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18095 rel="external nofollow noreferrer" target=_blank>#18095</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>All queries of type <code class=syntax>Decimal * Float</code> or vice versa are allowed, including aggregate ones (e.g. <code class=syntax>SELECT sum(decimal_field * 1.1)</code> or <code class=syntax>SELECT dec_col * float_col</code>), the result type is Float32 or Float64. <a href=https://github.com/ClickHouse/ClickHouse/pull/18145 rel="external nofollow noreferrer" target=_blank>#18145</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>Improved minimal Web UI: add history; add sharing support; avoid race condition of different requests; add request in-flight and ready indicators; add favicon; detect Ctrl+Enter if textarea is not in focus. <a href=https://github.com/ClickHouse/ClickHouse/pull/17293 rel="external nofollow noreferrer" target=_blank>#17293</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17770 rel="external nofollow noreferrer" target=_blank>#17770</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>clickhouse-server didn't send <code class=syntax>close</code> request to ZooKeeper server. <a href=https://github.com/ClickHouse/ClickHouse/pull/16837 rel="external nofollow noreferrer" target=_blank>#16837</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Avoid server abnormal termination in case of too low memory limits (<code class=syntax>max_memory_usage = 1</code> / <code class=syntax>max_untracked_memory = 1</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17453 rel="external nofollow noreferrer" target=_blank>#17453</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix non-deterministic result of <code class=syntax>windowFunnel</code> function in case of same timestamp for different events. <a href=https://github.com/ClickHouse/ClickHouse/pull/18884 rel="external nofollow noreferrer" target=_blank>#18884</a> (<a href=https://github.com/fuwhu rel="external nofollow noreferrer" target=_blank>Fuwang Hu</a>).</li> <li>Docker: Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server Docker images. <a href=https://github.com/ClickHouse/ClickHouse/pull/19096 rel="external nofollow noreferrer" target=_blank>#19096</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Asynchronous INSERTs to <code class=syntax>Distributed</code> tables: Two new settings (by analogy with MergeTree family) has been added: - <code class=syntax>fsync_after_insert</code> - Do fsync for every inserted. Will decreases performance of inserts. - <code class=syntax>fsync_directories</code> - Do fsync for temporary directory (that is used for async INSERT only) after all operations (writes, renames, etc.). <a href=https://github.com/ClickHouse/ClickHouse/pull/18864 rel="external nofollow noreferrer" target=_blank>#18864</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>SYSTEM KILL</code> command started to work in Docker. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18847 rel="external nofollow noreferrer" target=_blank>#18847</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18848 rel="external nofollow noreferrer" target=_blank>#18848</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Expand macros in the zk path when executing <code class=syntax>FETCH PARTITION</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18839 rel="external nofollow noreferrer" target=_blank>#18839</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Apply <code class=syntax>ALTER TABLE &lt;replicated_table&gt; ON CLUSTER MODIFY SETTING ...</code> to all replicas. Because we don't replicate such alter commands. <a href=https://github.com/ClickHouse/ClickHouse/pull/18789 rel="external nofollow noreferrer" target=_blank>#18789</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Allow column transformer <code class=syntax>EXCEPT</code> to accept a string as regular expression matcher. This resolves <a href=https://github.com/ClickHouse/ClickHouse/issues/18685 rel="external nofollow noreferrer" target=_blank>#18685</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/18699 rel="external nofollow noreferrer" target=_blank>#18699</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix SimpleAggregateFunction in SummingMergeTree. Now it works like AggregateFunction. In previous versions values were summed together regardless to the aggregate function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18564 rel="external nofollow noreferrer" target=_blank>#18564</a> . <a href=https://github.com/ClickHouse/ClickHouse/issues/8052 rel="external nofollow noreferrer" target=_blank>#8052</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18637 rel="external nofollow noreferrer" target=_blank>#18637</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>). Another fix of using <code class=syntax>SimpleAggregateFunction</code> in <code class=syntax>SummingMergeTree</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18676 rel="external nofollow noreferrer" target=_blank>#18676</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/18677 rel="external nofollow noreferrer" target=_blank>#18677</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixed assertion error inside allocator in case when last argument of function bar is NaN. Now simple ClickHouse's exception is being thrown. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17876 rel="external nofollow noreferrer" target=_blank>#17876</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18520 rel="external nofollow noreferrer" target=_blank>#18520</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix usability issue: no newline after exception message in some tools. <a href=https://github.com/ClickHouse/ClickHouse/pull/18444 rel="external nofollow noreferrer" target=_blank>#18444</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add ability to modify primary and partition key column type from <code class=syntax>LowCardinality(Type)</code> to <code class=syntax>Type</code> and vice versa. Also add an ability to modify primary key column type from <code class=syntax>EnumX</code> to <code class=syntax>IntX</code> type. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5604 rel="external nofollow noreferrer" target=_blank>#5604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18362 rel="external nofollow noreferrer" target=_blank>#18362</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Implement <code class=syntax>untuple</code> field access. <a href=https://github.com/ClickHouse/ClickHouse/issues/18133 rel="external nofollow noreferrer" target=_blank>#18133</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18309 rel="external nofollow noreferrer" target=_blank>#18309</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Allow to parse Array fields from CSV if it is represented as a string containing array that was serialized as nested CSV. Example: <code class=syntax>"[""Hello"", ""world"", ""42"""" TV""]"</code> will parse as <code class=syntax>['Hello', 'world', '42" TV']</code>. Allow to parse array in CSV in a string without enclosing braces. Example: <code class=syntax>"'Hello', 'world', '42"" TV'"</code> will parse as <code class=syntax>['Hello', 'world', '42" TV']</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18271 rel="external nofollow noreferrer" target=_blank>#18271</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Make better adaptive granularity calculation for merge tree wide parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/18223 rel="external nofollow noreferrer" target=_blank>#18223</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Now <code class=syntax>clickhouse install</code> could work on Mac. The problem was that there is no procfs on this platform. <a href=https://github.com/ClickHouse/ClickHouse/pull/18201 rel="external nofollow noreferrer" target=_blank>#18201</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Better hints for <code class=syntax>SHOW ...</code> query syntax. <a href=https://github.com/ClickHouse/ClickHouse/pull/18183 rel="external nofollow noreferrer" target=_blank>#18183</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Array aggregation <code class=syntax>arrayMin</code>, <code class=syntax>arrayMax</code>, <code class=syntax>arraySum</code>, <code class=syntax>arrayAvg</code> support for <code class=syntax>Int128</code>, <code class=syntax>Int256</code>, <code class=syntax>UInt256</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18147 rel="external nofollow noreferrer" target=_blank>#18147</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add <code class=syntax>disk</code> to Set and Join storage settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/18112 rel="external nofollow noreferrer" target=_blank>#18112</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>).</li> <li>Access control: Now table function <code class=syntax>merge()</code> requires current user to have <code class=syntax>SELECT</code> privilege on each table it receives data from. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16964 rel="external nofollow noreferrer" target=_blank>#16964</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18104 rel="external nofollow noreferrer" target=_blank>#18104</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17983 rel="external nofollow noreferrer" target=_blank>#17983</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Temporary tables are visible in the system tables <code class=syntax>system.tables</code> and <code class=syntax>system.columns</code> now only in those session where they have been created. The internal database <code class=syntax>_temporary_and_external_tables</code> is now hidden in those system tables; temporary tables are shown as tables with empty database with the <code class=syntax>is_temporary</code> flag set instead. <a href=https://github.com/ClickHouse/ClickHouse/pull/18014 rel="external nofollow noreferrer" target=_blank>#18014</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix clickhouse-client rendering issue when the size of terminal window changes. <a href=https://github.com/ClickHouse/ClickHouse/pull/18009 rel="external nofollow noreferrer" target=_blank>#18009</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Decrease log verbosity of the events when the client drops the connection from Warning to Information. <a href=https://github.com/ClickHouse/ClickHouse/pull/18005 rel="external nofollow noreferrer" target=_blank>#18005</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Forcibly removing empty or bad metadata files from filesystem for DiskS3. S3 is an experimental feature. <a href=https://github.com/ClickHouse/ClickHouse/pull/17935 rel="external nofollow noreferrer" target=_blank>#17935</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Access control: <code class=syntax>allow_introspection_functions=0</code> prohibits usage of introspection functions but doesn't prohibit giving grants for them anymore (the grantee will need to set <code class=syntax>allow_introspection_functions=1</code> for himself to be able to use that grant). Similarly <code class=syntax>allow_ddl=0</code> prohibits usage of DDL commands but doesn't prohibit giving grants for them anymore. <a href=https://github.com/ClickHouse/ClickHouse/pull/17908 rel="external nofollow noreferrer" target=_blank>#17908</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Usability improvement: hints for column names. <a href=https://github.com/ClickHouse/ClickHouse/issues/17112 rel="external nofollow noreferrer" target=_blank>#17112</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17857 rel="external nofollow noreferrer" target=_blank>#17857</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Add diagnostic information when two merge tables try to read each other's data. <a href=https://github.com/ClickHouse/ClickHouse/pull/17854 rel="external nofollow noreferrer" target=_blank>#17854</a> (<a href=https://github.com/weeds085490 rel="external nofollow noreferrer" target=_blank>徐炘</a>).</li> <li>Let the possibility to override timeout value for running script using the ClickHouse docker image. <a href=https://github.com/ClickHouse/ClickHouse/pull/17818 rel="external nofollow noreferrer" target=_blank>#17818</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li> <li>Check system log tables' engine definition grammar to prevent some configuration errors. Notes that this grammar check is not semantical, that means such mistakes as non-existent columns / expression functions would be not found out util the table is created. <a href=https://github.com/ClickHouse/ClickHouse/pull/17739 rel="external nofollow noreferrer" target=_blank>#17739</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Removed exception throwing at <code class=syntax>RabbitMQ</code> table initialization if there was no connection (it will be reconnecting in the background). <a href=https://github.com/ClickHouse/ClickHouse/pull/17709 rel="external nofollow noreferrer" target=_blank>#17709</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Do not ignore server memory limits during Buffer flush. <a href=https://github.com/ClickHouse/ClickHouse/pull/17646 rel="external nofollow noreferrer" target=_blank>#17646</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Switch to patched version of RocksDB (from ClickHouse-Extras) to fix use-after-free error. <a href=https://github.com/ClickHouse/ClickHouse/pull/17643 rel="external nofollow noreferrer" target=_blank>#17643</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Added an offset to exception message for parallel parsing. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17457 rel="external nofollow noreferrer" target=_blank>#17457</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17641 rel="external nofollow noreferrer" target=_blank>#17641</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Don't throw "Too many parts" error in the middle of INSERT query. <a href=https://github.com/ClickHouse/ClickHouse/pull/17566 rel="external nofollow noreferrer" target=_blank>#17566</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow query parameters in UPDATE statement of ALTER query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10976 rel="external nofollow noreferrer" target=_blank>#10976</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17563 rel="external nofollow noreferrer" target=_blank>#17563</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Query obfuscator: avoid usage of some SQL keywords for identifier names. <a href=https://github.com/ClickHouse/ClickHouse/pull/17526 rel="external nofollow noreferrer" target=_blank>#17526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Export current max ddl entry executed by DDLWorker via server metric. It's useful to check if DDLWorker hangs somewhere. <a href=https://github.com/ClickHouse/ClickHouse/pull/17464 rel="external nofollow noreferrer" target=_blank>#17464</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Export asynchronous metrics of all servers current threads. It's useful to track down issues like <a href=https://github.com/ClickHouse-Extras/poco/pull/28 rel="external nofollow noreferrer" target=_blank>this</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17463 rel="external nofollow noreferrer" target=_blank>#17463</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Include dynamic columns like MATERIALIZED / ALIAS for wildcard query when settings <code class=syntax>asterisk_include_materialized_columns</code> and <code class=syntax>asterisk_include_alias_columns</code> are turned on. <a href=https://github.com/ClickHouse/ClickHouse/pull/17462 rel="external nofollow noreferrer" target=_blank>#17462</a> (<a href=https://github.com/chenziliang rel="external nofollow noreferrer" target=_blank>Ken Chen</a>).</li> <li>Allow specifying <a href=https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl target=_blank>TTL</a> to remove old entries from <a href=https://clickhouse.tech/docs/en/operations/system-tables/ target=_blank>system log tables</a>, using the <code class=syntax>&lt;ttl&gt;</code> attribute in <code class=syntax>config.xml</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17438 rel="external nofollow noreferrer" target=_blank>#17438</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Now queries coming to the server via MySQL and PostgreSQL protocols have distinctive interface types (which can be seen in the <code class=syntax>interface</code> column of the table<code class=syntax>system.query_log</code>): <code class=syntax>4</code> for MySQL, and <code class=syntax>5</code> for PostgreSQL, instead of formerly used <code class=syntax>1</code> which is now used for the native protocol only. <a href=https://github.com/ClickHouse/ClickHouse/pull/17437 rel="external nofollow noreferrer" target=_blank>#17437</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix parsing of SETTINGS clause of the <code class=syntax>INSERT ... SELECT ... SETTINGS</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/17414 rel="external nofollow noreferrer" target=_blank>#17414</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Correctly account memory in RadixSort. <a href=https://github.com/ClickHouse/ClickHouse/pull/17412 rel="external nofollow noreferrer" target=_blank>#17412</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Add eof check in <code class=syntax>receiveHello</code> in server to prevent getting <code class=syntax>Attempt to read after eof</code> exception. <a href=https://github.com/ClickHouse/ClickHouse/pull/17365 rel="external nofollow noreferrer" target=_blank>#17365</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Avoid possible stack overflow in bigint conversion. Big integers are experimental. <a href=https://github.com/ClickHouse/ClickHouse/pull/17269 rel="external nofollow noreferrer" target=_blank>#17269</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Now <code class=syntax>set</code> indices will work with <code class=syntax>GLOBAL IN</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17232 rel="external nofollow noreferrer" target=_blank>#17232</a> , <a href=https://github.com/ClickHouse/ClickHouse/issues/5576 rel="external nofollow noreferrer" target=_blank>#5576</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/17253 rel="external nofollow noreferrer" target=_blank>#17253</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add limit for http redirects in request to S3 storage (<code class=syntax>s3_max_redirects</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17220 rel="external nofollow noreferrer" target=_blank>#17220</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>When <code class=syntax>-OrNull</code> combinator combined <code class=syntax>-If</code>, <code class=syntax>-Merge</code>, <code class=syntax>-MergeState</code>, <code class=syntax>-State</code> combinators, we should put <code class=syntax>-OrNull</code> in front. <a href=https://github.com/ClickHouse/ClickHouse/pull/16935 rel="external nofollow noreferrer" target=_blank>#16935</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Support HTTP proxy and HTTPS S3 endpoint configuration. <a href=https://github.com/ClickHouse/ClickHouse/pull/16861 rel="external nofollow noreferrer" target=_blank>#16861</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Added proper authentication using environment, <code class=syntax>~/.aws</code> and <code class=syntax>AssumeRole</code> for S3 client. <a href=https://github.com/ClickHouse/ClickHouse/pull/16856 rel="external nofollow noreferrer" target=_blank>#16856</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add more OpenTelemetry spans. Add an example of how to export the span data to Zipkin. <a href=https://github.com/ClickHouse/ClickHouse/pull/16535 rel="external nofollow noreferrer" target=_blank>#16535</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Cache dictionaries: Completely eliminate callbacks and locks for acquiring them. Keys are not divided into "not found" and "expired", but stored in the same map during query. <a href=https://github.com/ClickHouse/ClickHouse/pull/14958 rel="external nofollow noreferrer" target=_blank>#14958</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix never worked <code class=syntax>fsync_part_directory</code>/<code class=syntax>fsync_after_insert</code>/<code class=syntax>in_memory_parts_insert_sync</code> (experimental feature). <a href=https://github.com/ClickHouse/ClickHouse/pull/18845 rel="external nofollow noreferrer" target=_blank>#18845</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow using <code class=syntax>Atomic</code> engine for nested database of <code class=syntax>MaterializeMySQL</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/14849 rel="external nofollow noreferrer" target=_blank>#14849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h4 id=bug-fix_6>Bug Fix<a class=headerlink href=#bug-fix_6 title="Permanent link"> </a></h4> <ul> <li>Fix the issue when server can stop accepting connections in very rare cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/17542 rel="external nofollow noreferrer" target=_blank>#17542</a> (Amos Bird, <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18364 rel="external nofollow noreferrer" target=_blank>#18364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18373 rel="external nofollow noreferrer" target=_blank>#18373</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix possible wrong index analysis when the types of the index comparison are different. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17122 rel="external nofollow noreferrer" target=_blank>#17122</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17145 rel="external nofollow noreferrer" target=_blank>#17145</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href=https://github.com/ClickHouse/ClickHouse/pull/18481 rel="external nofollow noreferrer" target=_blank>#18481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href=https://github.com/ClickHouse/ClickHouse/pull/18381 rel="external nofollow noreferrer" target=_blank>#18381</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix possible incomplete query result while reading from <code class=syntax>MergeTree*</code> in case of read backoff (message <code class=syntax>&lt;Debug&gt; MergeTreeReadPool: Will lower number of threads</code> in logs). Was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/16423 rel="external nofollow noreferrer" target=_blank>#16423</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18137 rel="external nofollow noreferrer" target=_blank>#18137</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18216 rel="external nofollow noreferrer" target=_blank>#18216</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix use after free bug in <code class=syntax>rocksdb</code> library. <a href=https://github.com/ClickHouse/ClickHouse/pull/18862 rel="external nofollow noreferrer" target=_blank>#18862</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix infinite reading from file in <code class=syntax>ORC</code> format (was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/10580 rel="external nofollow noreferrer" target=_blank>#10580</a>). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19095 rel="external nofollow noreferrer" target=_blank>#19095</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19134 rel="external nofollow noreferrer" target=_blank>#19134</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug in merge tree data writer which can lead to marks with bigger size than fixed granularity size. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18913 rel="external nofollow noreferrer" target=_blank>#18913</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19123 rel="external nofollow noreferrer" target=_blank>#19123</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix startup bug when clickhouse was not able to read compression codec from <code class=syntax>LowCardinality(Nullable(...))</code> and throws exception <code class=syntax>Attempt to read after EOF</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18340 rel="external nofollow noreferrer" target=_blank>#18340</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19101 rel="external nofollow noreferrer" target=_blank>#19101</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Restrict <code class=syntax>MODIFY TTL</code> queries for <code class=syntax>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href=https://github.com/ClickHouse/ClickHouse/pull/19064 rel="external nofollow noreferrer" target=_blank>#19064</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Make sure <code class=syntax>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17875 rel="external nofollow noreferrer" target=_blank>#17875</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19019 rel="external nofollow noreferrer" target=_blank>#19019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible error <code class=syntax>Expected single dictionary argument for function</code> if use function <code class=syntax>ignore</code> with <code class=syntax>LowCardinality</code> argument. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14275 rel="external nofollow noreferrer" target=_blank>#14275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19016 rel="external nofollow noreferrer" target=_blank>#19016</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix inserting of <code class=syntax>LowCardinality</code> column to table with <code class=syntax>TinyLog</code> engine. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18629 rel="external nofollow noreferrer" target=_blank>#18629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19010 rel="external nofollow noreferrer" target=_blank>#19010</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Join tries to materialize const columns, but our code wants them in other places. <a href=https://github.com/ClickHouse/ClickHouse/pull/18982 rel="external nofollow noreferrer" target=_blank>#18982</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Disable <code class=syntax>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18051 rel="external nofollow noreferrer" target=_blank>#18051</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18973 rel="external nofollow noreferrer" target=_blank>#18973</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18981 rel="external nofollow noreferrer" target=_blank>#18981</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible exception <code class=syntax>QueryPipeline stream: different number of columns</code> caused by merging of query plan's <code class=syntax>Expression</code> steps. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18190 rel="external nofollow noreferrer" target=_blank>#18190</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18980 rel="external nofollow noreferrer" target=_blank>#18980</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed very rare deadlock at shutdown. <a href=https://github.com/ClickHouse/ClickHouse/pull/18977 rel="external nofollow noreferrer" target=_blank>#18977</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix incorrect behavior when <code class=syntax>ALTER TABLE ... DROP PART 'part_name'</code> query removes all deduplication blocks for the whole partition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18874 rel="external nofollow noreferrer" target=_blank>#18874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18969 rel="external nofollow noreferrer" target=_blank>#18969</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Attach partition should reset the mutation. <a href=https://github.com/ClickHouse/ClickHouse/issues/18804 rel="external nofollow noreferrer" target=_blank>#18804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18935 rel="external nofollow noreferrer" target=_blank>#18935</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix issue with <code class=syntax>bitmapOrCardinality</code> that may lead to nullptr dereference. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18911 rel="external nofollow noreferrer" target=_blank>#18911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18912 rel="external nofollow noreferrer" target=_blank>#18912</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix possible hang at shutdown in <code class=syntax>clickhouse-local</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18891 rel="external nofollow noreferrer" target=_blank>#18891</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18893 rel="external nofollow noreferrer" target=_blank>#18893</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Queries for external databases (MySQL, ODBC, JDBC) were incorrectly rewritten if there was an expression in form of <code class=syntax>x IN table</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9756 rel="external nofollow noreferrer" target=_blank>#9756</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18876 rel="external nofollow noreferrer" target=_blank>#18876</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix *If combinator with unary function and Nullable types. <a href=https://github.com/ClickHouse/ClickHouse/pull/18806 rel="external nofollow noreferrer" target=_blank>#18806</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix the issue that asynchronous distributed INSERTs can be rejected by the server if the setting <code class=syntax>network_compression_method</code> is globally set to non-default value. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18741 rel="external nofollow noreferrer" target=_blank>#18741</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18776 rel="external nofollow noreferrer" target=_blank>#18776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed <code class=syntax>Attempt to read after eof</code> error when trying to <code class=syntax>CAST</code> <code class=syntax>NULL</code> from <code class=syntax>Nullable(String)</code> to <code class=syntax>Nullable(Decimal(P, S))</code>. Now function <code class=syntax>CAST</code> returns <code class=syntax>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7690 rel="external nofollow noreferrer" target=_blank>#7690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18718 rel="external nofollow noreferrer" target=_blank>#18718</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix minor issue with logging. <a href=https://github.com/ClickHouse/ClickHouse/pull/18717 rel="external nofollow noreferrer" target=_blank>#18717</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix removing of empty parts in <code class=syntax>ReplicatedMergeTree</code> tables, created with old syntax. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18582 rel="external nofollow noreferrer" target=_blank>#18582</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18614 rel="external nofollow noreferrer" target=_blank>#18614</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix previous bug when date overflow with different values. Strict Date value limit to "2106-02-07", cast date &gt; "2106-02-07" to value 0. <a href=https://github.com/ClickHouse/ClickHouse/pull/18565 rel="external nofollow noreferrer" target=_blank>#18565</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Add FixedString data type support for replication from MySQL. Replication from MySQL is an experimental feature. This patch fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18450 rel="external nofollow noreferrer" target=_blank>#18450</a> Also fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6556 rel="external nofollow noreferrer" target=_blank>#6556</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18553 rel="external nofollow noreferrer" target=_blank>#18553</a> (<a href=https://github.com/awesomeleo rel="external nofollow noreferrer" target=_blank>awesomeleo</a>).</li> <li>Fix possible <code class=syntax>Pipeline stuck</code> error while using <code class=syntax>ORDER BY</code> after subquery with <code class=syntax>RIGHT</code> or <code class=syntax>FULL</code> join. <a href=https://github.com/ClickHouse/ClickHouse/pull/18550 rel="external nofollow noreferrer" target=_blank>#18550</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug which may lead to <code class=syntax>ALTER</code> queries hung after corresponding mutation kill. Found by thread fuzzer. <a href=https://github.com/ClickHouse/ClickHouse/pull/18518 rel="external nofollow noreferrer" target=_blank>#18518</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Proper support for 12AM in <code class=syntax>parseDateTimeBestEffort</code> function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18402 rel="external nofollow noreferrer" target=_blank>#18402</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18449 rel="external nofollow noreferrer" target=_blank>#18449</a> (<a href=https://github.com/vladimir-golovchenko rel="external nofollow noreferrer" target=_blank>vladimir-golovchenko</a>).</li> <li>Fixed <code class=syntax>value is too short</code> error when executing <code class=syntax>toType(...)</code> functions (<code class=syntax>toDate</code>, <code class=syntax>toUInt32</code>, etc) with argument of type <code class=syntax>Nullable(String)</code>. Now such functions return <code class=syntax>NULL</code> on parsing errors instead of throwing exception. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7673 rel="external nofollow noreferrer" target=_blank>#7673</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18445 rel="external nofollow noreferrer" target=_blank>#18445</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix the unexpected behaviour of <code class=syntax>SHOW TABLES</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18431 rel="external nofollow noreferrer" target=_blank>#18431</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix -SimpleState combinator generates incompatible arugment type and return type. <a href=https://github.com/ClickHouse/ClickHouse/pull/18404 rel="external nofollow noreferrer" target=_blank>#18404</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix possible race condition in concurrent usage of <code class=syntax>Set</code> or <code class=syntax>Join</code> tables and selects from <code class=syntax>system.tables</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18385 rel="external nofollow noreferrer" target=_blank>#18385</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix filling table <code class=syntax>system.settings_profile_elements</code>. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18231 rel="external nofollow noreferrer" target=_blank>#18231</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18379 rel="external nofollow noreferrer" target=_blank>#18379</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix possible crashes in aggregate functions with combinator <code class=syntax>Distinct</code>, while using two-level aggregation. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17682 rel="external nofollow noreferrer" target=_blank>#17682</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18365 rel="external nofollow noreferrer" target=_blank>#18365</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fixed issue when <code class=syntax>clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual IPv4/IPv6 stack; Fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes of the odbc-bridge process; Possibly closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14489 rel="external nofollow noreferrer" target=_blank>#14489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18278 rel="external nofollow noreferrer" target=_blank>#18278</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Access control: <code class=syntax>SELECT count() FROM table</code> now can be executed if the user has access to at least single column from a table. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10639 rel="external nofollow noreferrer" target=_blank>#10639</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18233 rel="external nofollow noreferrer" target=_blank>#18233</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Access control: <code class=syntax>SELECT JOIN</code> now requires the <code class=syntax>SELECT</code> privilege on each of the joined tables. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17654 rel="external nofollow noreferrer" target=_blank>#17654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18232 rel="external nofollow noreferrer" target=_blank>#18232</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix key comparison between Enum and Int types. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17989 rel="external nofollow noreferrer" target=_blank>#17989</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18214 rel="external nofollow noreferrer" target=_blank>#18214</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Replication from MySQL (experimental feature). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18186 rel="external nofollow noreferrer" target=_blank>#18186</a> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16372 rel="external nofollow noreferrer" target=_blank>#16372</a> Fix unique key convert issue in MaterializeMySQL database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/18211 rel="external nofollow noreferrer" target=_blank>#18211</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix inconsistency for queries with both <code class=syntax>WITH FILL</code> and <code class=syntax>WITH TIES</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/17466 rel="external nofollow noreferrer" target=_blank>#17466</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18188 rel="external nofollow noreferrer" target=_blank>#18188</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix inserting a row with default value in case of parsing error in the last column. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17712 rel="external nofollow noreferrer" target=_blank>#17712</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18182 rel="external nofollow noreferrer" target=_blank>#18182</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Fix <code class=syntax>Unknown setting profile</code> error on attempt to set settings profile. <a href=https://github.com/ClickHouse/ClickHouse/pull/18167 rel="external nofollow noreferrer" target=_blank>#18167</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix error when query <code class=syntax>MODIFY COLUMN ... REMOVE TTL</code> doesn't actually remove column TTL. <a href=https://github.com/ClickHouse/ClickHouse/pull/18130 rel="external nofollow noreferrer" target=_blank>#18130</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed <code class=syntax>std::out_of_range: basic_string</code> in S3 URL parsing. <a href=https://github.com/ClickHouse/ClickHouse/pull/18059 rel="external nofollow noreferrer" target=_blank>#18059</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Fix comparison of <code class=syntax>DateTime64</code> and <code class=syntax>Date</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13804 rel="external nofollow noreferrer" target=_blank>#13804</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/11222 rel="external nofollow noreferrer" target=_blank>#11222</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/18050 rel="external nofollow noreferrer" target=_blank>#18050</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Replication from MySQL (experimental feature): Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/15187 rel="external nofollow noreferrer" target=_blank>#15187</a> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17912 rel="external nofollow noreferrer" target=_blank>#17912</a> support convert MySQL prefix index for MaterializeMySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/17944 rel="external nofollow noreferrer" target=_blank>#17944</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>When server log rotation was configured using <code class=syntax>logger.size</code> parameter with numeric value larger than 2^32, the logs were not rotated properly. This is fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/17905 rel="external nofollow noreferrer" target=_blank>#17905</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Trivial query optimization was producing wrong result if query contains ARRAY JOIN (so query is actually non trivial). <a href=https://github.com/ClickHouse/ClickHouse/pull/17887 rel="external nofollow noreferrer" target=_blank>#17887</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix possible segfault in <code class=syntax>topK</code> aggregate function. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17404 rel="external nofollow noreferrer" target=_blank>#17404</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17845 rel="external nofollow noreferrer" target=_blank>#17845</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>WAL (experimental feature): Do not restore parts from WAL if <code class=syntax>in_memory_parts_enable_wal</code> is disabled. <a href=https://github.com/ClickHouse/ClickHouse/pull/17802 rel="external nofollow noreferrer" target=_blank>#17802</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>Exception message about max table size to drop was displayed incorrectly. <a href=https://github.com/ClickHouse/ClickHouse/pull/17764 rel="external nofollow noreferrer" target=_blank>#17764</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed possible segfault when there is not enough space when inserting into <code class=syntax>Distributed</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/17737 rel="external nofollow noreferrer" target=_blank>#17737</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>Windows: Fixed <code class=syntax>Function not implemented</code> error when executing <code class=syntax>RENAME</code> query in <code class=syntax>Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17661 rel="external nofollow noreferrer" target=_blank>#17661</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17664 rel="external nofollow noreferrer" target=_blank>#17664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>In might be determined incorrectly if cluster is circular- (cross-) replicated or not when executing <code class=syntax>ON CLUSTER</code> query due to race condition when <code class=syntax>pool_size</code> &gt; 1. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/17640 rel="external nofollow noreferrer" target=_blank>#17640</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix empty <code class=syntax>system.stack_trace</code> table when server is running in daemon mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/17630 rel="external nofollow noreferrer" target=_blank>#17630</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Exception <code class=syntax>fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17613 rel="external nofollow noreferrer" target=_blank>#17613</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17615 rel="external nofollow noreferrer" target=_blank>#17615</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13654 rel="external nofollow noreferrer" target=_blank>#13654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17565 rel="external nofollow noreferrer" target=_blank>#17565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix issue with memory accounting when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix <code class=syntax>ORDER BY</code> with enabled setting <code class=syntax>optimize_redundant_functions_in_order_by</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix duplicates after <code class=syntax>DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17294 rel="external nofollow noreferrer" target=_blank>#17294</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17296 rel="external nofollow noreferrer" target=_blank>#17296</a> (<a href=https://github.com/chengxianglibra rel="external nofollow noreferrer" target=_blank>li chengxiang</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17439 rel="external nofollow noreferrer" target=_blank>#17439</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed high CPU usage in background tasks of *MergeTree tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/17416 rel="external nofollow noreferrer" target=_blank>#17416</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix possible crash while reading from <code class=syntax>JOIN</code> table with <code class=syntax>LowCardinality</code> types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17228 rel="external nofollow noreferrer" target=_blank>#17228</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17397 rel="external nofollow noreferrer" target=_blank>#17397</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Replication from MySQL (experimental feature): Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16835 rel="external nofollow noreferrer" target=_blank>#16835</a> try fix miss match header with MySQL SHOW statement. <a href=https://github.com/ClickHouse/ClickHouse/pull/17366 rel="external nofollow noreferrer" target=_blank>#17366</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix nondeterministic functions with predicate optimizer. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17244 rel="external nofollow noreferrer" target=_blank>#17244</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17273 rel="external nofollow noreferrer" target=_blank>#17273</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix possible <code class=syntax>Unexpected packet Data received from client</code> error for Distributed queries with <code class=syntax>LIMIT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17254 rel="external nofollow noreferrer" target=_blank>#17254</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17246 rel="external nofollow noreferrer" target=_blank>#17246</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17249 rel="external nofollow noreferrer" target=_blank>#17249</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>clickhouse-copier: Fix for non-partitioned tables <a href=https://github.com/ClickHouse/ClickHouse/issues/15235 rel="external nofollow noreferrer" target=_blank>#15235</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17248 rel="external nofollow noreferrer" target=_blank>#17248</a> (<a href=https://github.com/kaka11chen rel="external nofollow noreferrer" target=_blank>Qi Chen</a>).</li> <li>Fixed possible not-working mutations for parts stored on S3 disk (experimental feature). <a href=https://github.com/ClickHouse/ClickHouse/pull/17227 rel="external nofollow noreferrer" target=_blank>#17227</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Bug fix for funciton <code class=syntax>fuzzBits</code>, related issue: <a href=https://github.com/ClickHouse/ClickHouse/issues/16980 rel="external nofollow noreferrer" target=_blank>#16980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17051 rel="external nofollow noreferrer" target=_blank>#17051</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix <code class=syntax>optimize_distributed_group_by_sharding_key</code> for query with OFFSET only. <a href=https://github.com/ClickHouse/ClickHouse/pull/16996 rel="external nofollow noreferrer" target=_blank>#16996</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix queries from <code class=syntax>Merge</code> tables over <code class=syntax>Distributed</code> tables with JOINs. <a href=https://github.com/ClickHouse/ClickHouse/pull/16993 rel="external nofollow noreferrer" target=_blank>#16993</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix order by optimization with monotonic functions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16107 rel="external nofollow noreferrer" target=_blank>#16107</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16956 rel="external nofollow noreferrer" target=_blank>#16956</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix incorrect comparison of types <code class=syntax>DateTime64</code> with different scales. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16655 rel="external nofollow noreferrer" target=_blank>#16655</a> ... <a href=https://github.com/ClickHouse/ClickHouse/pull/16952 rel="external nofollow noreferrer" target=_blank>#16952</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Fix optimization of group by with enabled setting <code class=syntax>optimize_aggregators_of_group_by_keys</code> and joins. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12604 rel="external nofollow noreferrer" target=_blank>#12604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16951 rel="external nofollow noreferrer" target=_blank>#16951</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Minor fix in SHOW ACCESS query. <a href=https://github.com/ClickHouse/ClickHouse/pull/16866 rel="external nofollow noreferrer" target=_blank>#16866</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix the behaviour with enabled <code class=syntax>optimize_trivial_count_query</code> setting with partition predicate. <a href=https://github.com/ClickHouse/ClickHouse/pull/16767 rel="external nofollow noreferrer" target=_blank>#16767</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Return number of affected rows for INSERT queries via MySQL wire protocol. Previously ClickHouse used to always return 0, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16605 rel="external nofollow noreferrer" target=_blank>#16605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16715 rel="external nofollow noreferrer" target=_blank>#16715</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix inconsistent behavior caused by <code class=syntax>select_sequential_consistency</code> for optimized trivial count query and system tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/16309 rel="external nofollow noreferrer" target=_blank>#16309</a> (<a href=https://github.com/haoch rel="external nofollow noreferrer" target=_blank>Hao Chen</a>).</li> <li>Throw error when <code class=syntax>REPLACE</code> column transformer operates on non existing column. <a href=https://github.com/ClickHouse/ClickHouse/pull/16183 rel="external nofollow noreferrer" target=_blank>#16183</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Throw exception in case of not equi-join ON expression in RIGH|FULL JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/15162 rel="external nofollow noreferrer" target=_blank>#15162</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h4 id=build-testing-packaging-improvement_5>Build/Testing/Packaging Improvement<a class=headerlink href=#build-testing-packaging-improvement_5 title="Permanent link"> </a></h4> <ul> <li>Add simple integrity check for ClickHouse binary. It allows to detect corruption due to faulty hardware (bit rot on storage media or bit flips in RAM). <a href=https://github.com/ClickHouse/ClickHouse/pull/18811 rel="external nofollow noreferrer" target=_blank>#18811</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Change <code class=syntax>OpenSSL</code> to <code class=syntax>BoringSSL</code>. It allows to avoid issues with sanitizers. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12490 rel="external nofollow noreferrer" target=_blank>#12490</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17502 rel="external nofollow noreferrer" target=_blank>#17502</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12952 rel="external nofollow noreferrer" target=_blank>#12952</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18129 rel="external nofollow noreferrer" target=_blank>#18129</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Simplify <code class=syntax>Sys/V</code> init script. It was not working on Ubuntu 12.04 or older. <a href=https://github.com/ClickHouse/ClickHouse/pull/17428 rel="external nofollow noreferrer" target=_blank>#17428</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Multiple improvements in <code class=syntax>./clickhouse install</code> script. <a href=https://github.com/ClickHouse/ClickHouse/pull/17421 rel="external nofollow noreferrer" target=_blank>#17421</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Now ClickHouse can pretend to be a fake ZooKeeper. Currently, storage implementation is just stored in-memory hash-table, and server partially support ZooKeeper protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/16877 rel="external nofollow noreferrer" target=_blank>#16877</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix dead list watches removal for TestKeeperStorage (a mock for ZooKeeper). <a href=https://github.com/ClickHouse/ClickHouse/pull/18065 rel="external nofollow noreferrer" target=_blank>#18065</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Add <code class=syntax>SYSTEM SUSPEND</code> command for fault injection. It can be used to faciliate failover tests. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/15979 rel="external nofollow noreferrer" target=_blank>#15979</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18850 rel="external nofollow noreferrer" target=_blank>#18850</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Generate build id when ClickHouse is linked with <code class=syntax>lld</code>. It's appeared that <code class=syntax>lld</code> does not generate it by default on my machine. Build id is used for crash reports and introspection. <a href=https://github.com/ClickHouse/ClickHouse/pull/18808 rel="external nofollow noreferrer" target=_blank>#18808</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix shellcheck errors in style check. <a href=https://github.com/ClickHouse/ClickHouse/pull/18566 rel="external nofollow noreferrer" target=_blank>#18566</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Update timezones info to 2020e. <a href=https://github.com/ClickHouse/ClickHouse/pull/18531 rel="external nofollow noreferrer" target=_blank>#18531</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix codespell warnings. Split style checks into separate parts. Update style checks docker image. <a href=https://github.com/ClickHouse/ClickHouse/pull/18463 rel="external nofollow noreferrer" target=_blank>#18463</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Automated check for leftovers of conflict markers in docs. <a href=https://github.com/ClickHouse/ClickHouse/pull/18332 rel="external nofollow noreferrer" target=_blank>#18332</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Enable Thread Fuzzer for stateless tests flaky check. <a href=https://github.com/ClickHouse/ClickHouse/pull/18299 rel="external nofollow noreferrer" target=_blank>#18299</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Do not use non thread-safe function <code class=syntax>strerror</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18204 rel="external nofollow noreferrer" target=_blank>#18204</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Update <code class=syntax>anchore/scan-action@main</code> workflow action (was moved from <code class=syntax>master</code> to <code class=syntax>main</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/18192 rel="external nofollow noreferrer" target=_blank>#18192</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Now <code class=syntax>clickhouse-test</code> does DROP/CREATE databases with a timeout. <a href=https://github.com/ClickHouse/ClickHouse/pull/18098 rel="external nofollow noreferrer" target=_blank>#18098</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Enable experimental support for Pytest framework for stateless tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/17902 rel="external nofollow noreferrer" target=_blank>#17902</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Now we use the fresh docker daemon version in integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/17671 rel="external nofollow noreferrer" target=_blank>#17671</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Send info about official build, memory, cpu and free disk space to Sentry if it is enabled. Sentry is opt-in feature to help ClickHouse developers. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17279 rel="external nofollow noreferrer" target=_blank>#17279</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17543 rel="external nofollow noreferrer" target=_blank>#17543</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>There was an uninitialized variable in the code of clickhouse-copier. <a href=https://github.com/ClickHouse/ClickHouse/pull/17363 rel="external nofollow noreferrer" target=_blank>#17363</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix <a href=https://clickhouse-test-reports.s3.yandex.net/17309/065cd002578f2e8228f12a2744bd40c970065e0c/stress_test_(memory)/stderr.log rel="external nofollow noreferrer" target=_blank>one MSan report</a> from <a href=https://github.com/ClickHouse/ClickHouse/issues/17309 rel="external nofollow noreferrer" target=_blank>#17309</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17344 rel="external nofollow noreferrer" target=_blank>#17344</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix for the issue with IPv6 in Arrow Flight library. See <a href=https://github.com/ClickHouse/ClickHouse/pull/16243#issuecomment-720830294 rel="external nofollow noreferrer" target=_blank>the comments</a> for details. <a href=https://github.com/ClickHouse/ClickHouse/pull/16664 rel="external nofollow noreferrer" target=_blank>#16664</a> (<a href=https://github.com/FawnD2 rel="external nofollow noreferrer" target=_blank>Zhanna</a>).</li> <li>Add a library that replaces some <code class=syntax>libc</code> functions to traps that will terminate the process. <a href=https://github.com/ClickHouse/ClickHouse/pull/16366 rel="external nofollow noreferrer" target=_blank>#16366</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Provide diagnostics in server logs in case of stack overflow, send error message to clickhouse-client. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14840 rel="external nofollow noreferrer" target=_blank>#14840</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16346 rel="external nofollow noreferrer" target=_blank>#16346</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Now we can run almost all stateless functional tests in parallel. <a href=https://github.com/ClickHouse/ClickHouse/pull/15236 rel="external nofollow noreferrer" target=_blank>#15236</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix corruption in <code class=syntax>librdkafka</code> snappy decompression (was a problem only for gcc10 builds, but official builds uses clang already, so at least recent official releases are not affected). <a href=https://github.com/ClickHouse/ClickHouse/pull/18053 rel="external nofollow noreferrer" target=_blank>#18053</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>If server was terminated by OOM killer, print message in log. <a href=https://github.com/ClickHouse/ClickHouse/pull/13516 rel="external nofollow noreferrer" target=_blank>#13516</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>PODArray: Avoid call to memcpy with (nullptr, 0) arguments (Fix UBSan report). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18525 rel="external nofollow noreferrer" target=_blank>#18525</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18526 rel="external nofollow noreferrer" target=_blank>#18526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Minor improvement for path concatenation of zookeeper paths inside DDLWorker. <a href=https://github.com/ClickHouse/ClickHouse/pull/17767 rel="external nofollow noreferrer" target=_blank>#17767</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Allow to reload symbols from debug file. This PR also fixes a build-id issue. <a href=https://github.com/ClickHouse/ClickHouse/pull/17637 rel="external nofollow noreferrer" target=_blank>#17637</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>TestFlows: fixes to LDAP tests that fail due to slow test execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/18790 rel="external nofollow noreferrer" target=_blank>#18790</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: Merging requirements for AES encryption functions. Updating aes_encryption tests to use new requirements. Updating TestFlows version to 1.6.72. <a href=https://github.com/ClickHouse/ClickHouse/pull/18221 rel="external nofollow noreferrer" target=_blank>#18221</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: Updating TestFlows version to the latest 1.6.72. Re-generating requirements.py. <a href=https://github.com/ClickHouse/ClickHouse/pull/18208 rel="external nofollow noreferrer" target=_blank>#18208</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: Updating TestFlows README.md to include "How To Debug Why Test Failed" section. <a href=https://github.com/ClickHouse/ClickHouse/pull/17808 rel="external nofollow noreferrer" target=_blank>#17808</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: tests for RBAC <a href=https://clickhouse.tech/docs/en/sql-reference/statements/grant/#grant-access-management target=_blank>ACCESS MANAGEMENT</a> privileges. <a href=https://github.com/ClickHouse/ClickHouse/pull/17804 rel="external nofollow noreferrer" target=_blank>#17804</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> <li>TestFlows: RBAC tests for SHOW, TRUNCATE, KILL, and OPTIMIZE. - Updates to old tests. - Resolved comments from #<a href=https://github.com/ClickHouse/ClickHouse/pull/16977 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/16977</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17657 rel="external nofollow noreferrer" target=_blank>#17657</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> <li>TestFlows: Added RBAC tests for <code class=syntax>ATTACH</code>, <code class=syntax>CREATE</code>, <code class=syntax>DROP</code>, and <code class=syntax>DETACH</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16977 rel="external nofollow noreferrer" target=_blank>#16977</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> </ul> <h2 id=changelog-for-2020><a href=https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2020.md rel="external nofollow noreferrer" target=_blank>Changelog for 2020</a><a class=headerlink href=#changelog-for-2020 title="Permanent link"> </a></h2> </div> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Was this content helpful?</span> <div id=rating-stars class="display-6 mb-0" data-titles="['Unusable', 'Poor', 'OK', 'Good', 'Excellent']" data-documentation=documentation>RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2021 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/878a159538935028f2d2dce3eb3074d44eb191df rel="external nofollow noreferrer" target=_blank class=text-reset>878a159538</a> </div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Table of Contents</label> <a href=#clickhouse-release-21-6-2021-06-05 title="ClickHouse release 21.6, 2021-06-05" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.6, 2021-06-05 </a> <nav id=toc-toc-1 class="nav flex-column pl-2"> <a href=#upgrade-notes title="Upgrade Notes" class="nav-link text-wrap d-inline-block w-100"> Upgrade Notes </a> <a href=#new-feature title="New Feature" class="nav-link text-wrap d-inline-block w-100"> New Feature </a> <a href=#experimental-feature title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100"> Experimental Feature </a> <a href=#performance-improvement title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100"> Performance Improvement </a> <a href=#improvement title=Improvement class="nav-link text-wrap d-inline-block w-100"> Improvement </a> <a href=#bug-fix title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> <a href=#build-testing-packaging-improvement title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100"> Build/Testing/Packaging Improvement </a> </nav> <a href=#clickhouse-release-21-5-2021-05-20 title="ClickHouse release 21.5, 2021-05-20" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.5, 2021-05-20 </a> <nav id=toc-toc-2 class="nav flex-column pl-2"> <a href=#backward-incompatible-change title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100"> Backward Incompatible Change </a> <a href=#new-feature_1 title="New Feature" class="nav-link text-wrap d-inline-block w-100"> New Feature </a> <a href=#performance-improvement_1 title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100"> Performance Improvement </a> <a href=#improvement_1 title=Improvement class="nav-link text-wrap d-inline-block w-100"> Improvement </a> <a href=#bug-fix_1 title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> <a href=#build-testing-packaging-improvement_1 title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100"> Build/Testing/Packaging Improvement </a> </nav> <a href=#clickhouse-release-21-4 title="ClickHouse release 21.4" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.4 </a> <nav id=toc-toc-3 class="nav flex-column pl-2"> <a href=#clickhouse-release-21-4-1-2021-04-12 title="ClickHouse release 21.4.1 2021-04-12" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.4.1 2021-04-12 </a> <nav id=toc-toc-3-1 class="nav flex-column pl-2"> <a href=#backward-incompatible-change_1 title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100"> Backward Incompatible Change </a> <a href=#new-feature_2 title="New Feature" class="nav-link text-wrap d-inline-block w-100"> New Feature </a> <a href=#experimental-feature_1 title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100"> Experimental Feature </a> <a href=#performance-improvement_2 title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100"> Performance Improvement </a> <a href=#improvement_2 title=Improvement class="nav-link text-wrap d-inline-block w-100"> Improvement </a> <a href=#bug-fix_2 title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> <a href=#build-testing-packaging-improvement_2 title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100"> Build/Testing/Packaging Improvement </a> </nav> </nav> <a href=#clickhouse-release-21-3-lts title="ClickHouse release 21.3 (LTS)" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.3 (LTS) </a> <nav id=toc-toc-4 class="nav flex-column pl-2"> <a href=#clickhouse-release-v21-3-2021-03-12 title="ClickHouse release v21.3, 2021-03-12" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release v21.3, 2021-03-12 </a> <nav id=toc-toc-4-1 class="nav flex-column pl-2"> <a href=#backward-incompatible-change_2 title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100"> Backward Incompatible Change </a> <a href=#new-feature_3 title="New Feature" class="nav-link text-wrap d-inline-block w-100"> New Feature </a> <a href=#experimental-feature_2 title="Experimental feature" class="nav-link text-wrap d-inline-block w-100"> Experimental feature </a> <a href=#performance-improvement_3 title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100"> Performance Improvement </a> <a href=#improvement_3 title=Improvement class="nav-link text-wrap d-inline-block w-100"> Improvement </a> <a href=#bug-fix_3 title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> <a href=#build-testing-packaging-improvement_3 title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100"> Build/Testing/Packaging Improvement </a> </nav> </nav> <a href=#clickhouse-release-21-2 title="ClickHouse release 21.2" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.2 </a> <nav id=toc-toc-5 class="nav flex-column pl-2"> <a href=#clickhouse-release-v21-2-2-8-stable-2021-02-07 title="ClickHouse release v21.2.2.8-stable, 2021-02-07" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release v21.2.2.8-stable, 2021-02-07 </a> <nav id=toc-toc-5-1 class="nav flex-column pl-2"> <a href=#backward-incompatible-change_3 title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100"> Backward Incompatible Change </a> <a href=#new-feature_4 title="New Feature" class="nav-link text-wrap d-inline-block w-100"> New Feature </a> <a href=#performance-improvement_4 title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100"> Performance Improvement </a> <a href=#improvement_4 title=Improvement class="nav-link text-wrap d-inline-block w-100"> Improvement </a> <a href=#bug-fix_4 title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> <a href=#build-testing-packaging-improvement_4 title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100"> Build/Testing/Packaging Improvement </a> </nav> </nav> <a href=#clickhouse-release-21-1 title="ClickHouse release 21.1" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release 21.1 </a> <nav id=toc-toc-6 class="nav flex-column pl-2"> <a href=#clickhouse-release-v21-1-3-32-stable-2021-02-03 title="ClickHouse release v21.1.3.32-stable, 2021-02-03" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release v21.1.3.32-stable, 2021-02-03 </a> <nav id=toc-toc-6-1 class="nav flex-column pl-2"> <a href=#bug-fix_5 title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> </nav> <a href=#clickhouse-release-v21-1-2-15-stable-2021-01-18 title="ClickHouse release v21.1.2.15-stable 2021-01-18" class="nav-link text-wrap d-inline-block w-100"> ClickHouse release v21.1.2.15-stable 2021-01-18 </a> <nav id=toc-toc-6-2 class="nav flex-column pl-2"> <a href=#backward-incompatible-change_4 title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100"> Backward Incompatible Change </a> <a href=#new-feature_5 title="New Feature" class="nav-link text-wrap d-inline-block w-100"> New Feature </a> <a href=#experimental-feature_3 title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100"> Experimental Feature </a> <a href=#performance-improvement_5 title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100"> Performance Improvement </a> <a href=#improvement_5 title=Improvement class="nav-link text-wrap d-inline-block w-100"> Improvement </a> <a href=#bug-fix_6 title="Bug Fix" class="nav-link text-wrap d-inline-block w-100"> Bug Fix </a> <a href=#build-testing-packaging-improvement_5 title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100"> Build/Testing/Packaging Improvement </a> </nav> </nav> <a href=#changelog-for-2020 title="Changelog for 2020" class="nav-link text-wrap d-inline-block w-100"> Changelog for 2020 </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?da3fd50d></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>