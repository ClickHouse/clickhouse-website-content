










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="en">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>Usage Recommendations | ClickHouse Documentation</title>
    <link rel="canonical" href="https://clickhouse.com/docs/en/operations/tips/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Usage Recommendations | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.com/docs/en/operations/tips/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Usage Recommendations | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>@charset "UTF-8";:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer{display:block}body{margin:0;font-family:"Noto Sans",sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}blockquote{margin:0 0 1rem}b{font-weight:bolder}small{font-size:80%}a{color:#ff8c00;text-decoration:none;background-color:transparent}a:hover{color:#ff8c00;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:"Hind Siliguri",sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.small,small{font-size:80%;font-weight:400}.blockquote{margin-bottom:8px;font-size:1.25rem}.blockquote-footer{display:block;font-size:80%;color:#6c757d}.blockquote-footer::before{content:"— "}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn.focus,.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info.focus,.btn-info:focus{color:#fff;background-color:#138496;border-color:#117a8b;box-shadow:0 0 0 0 rgba(58,176,195,.5)}.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light.focus,.btn-light:focus{color:#495057;background-color:#d6e5ee;border-color:#cddfea;box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark.focus,.btn-dark:focus{color:#fff;background-color:#383d42;border-color:#32373b;box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white.focus,.btn-white:focus{color:#495057;background-color:#ececec;border-color:#e6e6e6;box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black.focus,.btn-black:focus{color:#fff;background-color:#101214;border-color:#0a0c0d;box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange.focus,.btn-orange:focus{color:#fff;background-color:#d97700;border-color:#cc7000;box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange.focus,.btn-light-orange:focus{color:#495057;background-color:#ffd68f;border-color:#ffd182;box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info.focus,.btn-outline-info:focus{box-shadow:0 0 0 0 rgba(23,162,184,.5)}.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light.focus,.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark.focus,.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white.focus,.btn-outline-white:focus{box-shadow:0 0 0 0 rgba(255,255,255,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black.focus,.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange.focus,.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange.focus,.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link.focus,.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:8px}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-info{color:#1c6673;background-color:#d1ecf1;border-color:#bee5eb}.alert-info .alert-link{color:#12424a}.alert-light{color:#8d9295;background-color:#fcfdfe;border-color:#fbfcfd}.alert-light .alert-link{color:#73797c}.alert-dark{color:#363b41;background-color:#dbdcdd;border-color:#ccced0}.alert-dark .alert-link{color:#1f2225}.alert-white{color:#949698;background-color:#fff;border-color:#fff}.alert-white .alert-link{color:#7a7d7f}.alert-black{color:#212529;background-color:#d3d3d4;border-color:#c1c2c3}.alert-black .alert-link{color:#0a0c0d}.alert-orange{color:#945b14;background-color:#ffe8cc;border-color:#ffdfb8}.alert-orange .alert-link{color:#673f0e}.alert-light-orange{color:#948872;background-color:#fffaf0;border-color:#fff7ea}.alert-light-orange .alert-link{color:#786e5b}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@-webkit-keyframes spinner-border{to{transform:rotate(360deg)}}@keyframes spinner-border{to{transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{transform:scale(0)}50%{opacity:1}}.bg-info{background-color:#17a2b8}a.bg-info:focus,a.bg-info:hover{background-color:#117a8b}.bg-light{background-color:#f1f6f9}a.bg-light:focus,a.bg-light:hover{background-color:#cddfea}.bg-dark{background-color:#495057}a.bg-dark:focus,a.bg-dark:hover{background-color:#32373b}.bg-white{background-color:#fff}a.bg-white:focus,a.bg-white:hover{background-color:#e6e6e6}.bg-black{background-color:#212529}a.bg-black:focus,a.bg-black:hover{background-color:#0a0c0d}.bg-orange{background-color:#ff8c00}a.bg-orange:focus,a.bg-orange:hover{background-color:#cc7000}.bg-light-orange{background-color:#ffe4b5}a.bg-light-orange:focus,a.bg-light-orange:hover{background-color:#ffd182}.bg-white{background-color:#fff}.bg-transparent{background-color:transparent}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}}@media(min-width:980px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:980px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-top{position:fixed;top:0;right:0;left:0;z-index:1030}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}@supports(position:sticky){.sticky-top{position:sticky;top:0;z-index:1020}}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.m-0{margin:0}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.m-1{margin:8px}.my-1{margin-top:8px}.mr-1{margin-right:8px}.mb-1,.my-1{margin-bottom:8px}.m-2{margin:16px}.my-2{margin-top:16px}.mr-2{margin-right:16px}.mb-2,.my-2{margin-bottom:16px}.m-3{margin:24px}.my-3{margin-top:24px}.mr-3{margin-right:24px}.mb-3,.my-3{margin-bottom:24px}.m-4{margin:32px}.my-4{margin-top:32px}.mr-4{margin-right:32px}.mb-4,.my-4{margin-bottom:32px}.m-5{margin:40px}.my-5{margin-top:40px}.mr-5{margin-right:40px}.mb-5,.my-5{margin-bottom:40px}.m-6{margin:48px}.my-6{margin-top:48px}.mr-6{margin-right:48px}.mb-6,.my-6{margin-bottom:48px}.m-7{margin:56px}.my-7{margin-top:56px}.mr-7{margin-right:56px}.mb-7,.my-7{margin-bottom:56px}.m-8{margin:64px}.my-8{margin-top:64px}.mr-8{margin-right:64px}.mb-8,.my-8{margin-bottom:64px}.m-9{margin:72px}.my-9{margin-top:72px}.mr-9{margin-right:72px}.mb-9,.my-9{margin-bottom:72px}.m-10{margin:80px}.my-10{margin-top:80px}.mr-10{margin-right:80px}.mb-10,.my-10{margin-bottom:80px}.m-12{margin:96px}.my-12{margin-top:96px}.mr-12{margin-right:96px}.mb-12,.my-12{margin-bottom:96px}.m-15{margin:120px}.my-15{margin-top:120px}.mr-15{margin-right:120px}.mb-15,.my-15{margin-bottom:120px}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:8px}.pt-1,.py-1{padding-top:8px}.pb-1,.py-1{padding-bottom:8px}.p-2{padding:16px}.pt-2,.py-2{padding-top:16px}.pb-2,.py-2{padding-bottom:16px}.p-3{padding:24px}.pt-3,.py-3{padding-top:24px}.pb-3,.py-3{padding-bottom:24px}.p-4{padding:32px}.pt-4,.py-4{padding-top:32px}.pb-4,.py-4{padding-bottom:32px}.p-5{padding:40px}.pt-5,.py-5{padding-top:40px}.pb-5,.py-5{padding-bottom:40px}.p-6{padding:48px}.pt-6,.py-6{padding-top:48px}.pb-6,.py-6{padding-bottom:48px}.p-7{padding:56px}.pt-7,.py-7{padding-top:56px}.pb-7,.py-7{padding-bottom:56px}.p-8{padding:64px}.pt-8,.py-8{padding-top:64px}.pb-8,.py-8{padding-bottom:64px}.p-9{padding:72px}.pt-9,.py-9{padding-top:72px}.pb-9,.py-9{padding-bottom:72px}.p-10{padding:80px}.pt-10,.py-10{padding-top:80px}.pb-10,.py-10{padding-bottom:80px}.p-12{padding:96px}.pt-12,.py-12{padding-top:96px}.pb-12,.py-12{padding-bottom:96px}.p-15{padding:120px}.pt-15,.py-15{padding-top:120px}.pb-15,.py-15{padding-bottom:120px}@media(min-width:768px){.m-md-0{margin:0}.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.m-md-1{margin:8px}.my-md-1{margin-top:8px}.mr-md-1{margin-right:8px}.mb-md-1,.my-md-1{margin-bottom:8px}.m-md-2{margin:16px}.my-md-2{margin-top:16px}.mr-md-2{margin-right:16px}.mb-md-2,.my-md-2{margin-bottom:16px}.m-md-3{margin:24px}.my-md-3{margin-top:24px}.mr-md-3{margin-right:24px}.mb-md-3,.my-md-3{margin-bottom:24px}.m-md-4{margin:32px}.my-md-4{margin-top:32px}.mr-md-4{margin-right:32px}.mb-md-4,.my-md-4{margin-bottom:32px}.m-md-5{margin:40px}.my-md-5{margin-top:40px}.mr-md-5{margin-right:40px}.mb-md-5,.my-md-5{margin-bottom:40px}.m-md-6{margin:48px}.my-md-6{margin-top:48px}.mr-md-6{margin-right:48px}.mb-md-6,.my-md-6{margin-bottom:48px}.m-md-7{margin:56px}.my-md-7{margin-top:56px}.mr-md-7{margin-right:56px}.mb-md-7,.my-md-7{margin-bottom:56px}.m-md-8{margin:64px}.my-md-8{margin-top:64px}.mr-md-8{margin-right:64px}.mb-md-8,.my-md-8{margin-bottom:64px}.m-md-9{margin:72px}.my-md-9{margin-top:72px}.mr-md-9{margin-right:72px}.mb-md-9,.my-md-9{margin-bottom:72px}.m-md-10{margin:80px}.my-md-10{margin-top:80px}.mr-md-10{margin-right:80px}.mb-md-10,.my-md-10{margin-bottom:80px}.m-md-12{margin:96px}.my-md-12{margin-top:96px}.mr-md-12{margin-right:96px}.mb-md-12,.my-md-12{margin-bottom:96px}.m-md-15{margin:120px}.my-md-15{margin-top:120px}.mr-md-15{margin-right:120px}.mb-md-15,.my-md-15{margin-bottom:120px}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:8px}.pt-md-1,.py-md-1{padding-top:8px}.pb-md-1,.py-md-1{padding-bottom:8px}.p-md-2{padding:16px}.pt-md-2,.py-md-2{padding-top:16px}.pb-md-2,.py-md-2{padding-bottom:16px}.p-md-3{padding:24px}.pt-md-3,.py-md-3{padding-top:24px}.pb-md-3,.py-md-3{padding-bottom:24px}.p-md-4{padding:32px}.pt-md-4,.py-md-4{padding-top:32px}.pb-md-4,.py-md-4{padding-bottom:32px}.p-md-5{padding:40px}.pt-md-5,.py-md-5{padding-top:40px}.pb-md-5,.py-md-5{padding-bottom:40px}.p-md-6{padding:48px}.pt-md-6,.py-md-6{padding-top:48px}.pb-md-6,.py-md-6{padding-bottom:48px}.p-md-7{padding:56px}.pt-md-7,.py-md-7{padding-top:56px}.pb-md-7,.py-md-7{padding-bottom:56px}.p-md-8{padding:64px}.pt-md-8,.py-md-8{padding-top:64px}.pb-md-8,.py-md-8{padding-bottom:64px}.p-md-9{padding:72px}.pt-md-9,.py-md-9{padding-top:72px}.pb-md-9,.py-md-9{padding-bottom:72px}.p-md-10{padding:80px}.pt-md-10,.py-md-10{padding-top:80px}.pb-md-10,.py-md-10{padding-bottom:80px}.p-md-12{padding:96px}.pt-md-12,.py-md-12{padding-top:96px}.pb-md-12,.py-md-12{padding-bottom:96px}.p-md-15{padding:120px}.pt-md-15,.py-md-15{padding-top:120px}.pb-md-15,.py-md-15{padding-bottom:120px}}@media(min-width:980px){.m-lg-0{margin:0}.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.m-lg-1{margin:8px}.my-lg-1{margin-top:8px}.mr-lg-1{margin-right:8px}.mb-lg-1,.my-lg-1{margin-bottom:8px}.m-lg-2{margin:16px}.my-lg-2{margin-top:16px}.mr-lg-2{margin-right:16px}.mb-lg-2,.my-lg-2{margin-bottom:16px}.m-lg-3{margin:24px}.my-lg-3{margin-top:24px}.mr-lg-3{margin-right:24px}.mb-lg-3,.my-lg-3{margin-bottom:24px}.m-lg-4{margin:32px}.my-lg-4{margin-top:32px}.mr-lg-4{margin-right:32px}.mb-lg-4,.my-lg-4{margin-bottom:32px}.m-lg-5{margin:40px}.my-lg-5{margin-top:40px}.mr-lg-5{margin-right:40px}.mb-lg-5,.my-lg-5{margin-bottom:40px}.m-lg-6{margin:48px}.my-lg-6{margin-top:48px}.mr-lg-6{margin-right:48px}.mb-lg-6,.my-lg-6{margin-bottom:48px}.m-lg-7{margin:56px}.my-lg-7{margin-top:56px}.mr-lg-7{margin-right:56px}.mb-lg-7,.my-lg-7{margin-bottom:56px}.m-lg-8{margin:64px}.my-lg-8{margin-top:64px}.mr-lg-8{margin-right:64px}.mb-lg-8,.my-lg-8{margin-bottom:64px}.m-lg-9{margin:72px}.my-lg-9{margin-top:72px}.mr-lg-9{margin-right:72px}.mb-lg-9,.my-lg-9{margin-bottom:72px}.m-lg-10{margin:80px}.my-lg-10{margin-top:80px}.mr-lg-10{margin-right:80px}.mb-lg-10,.my-lg-10{margin-bottom:80px}.m-lg-12{margin:96px}.my-lg-12{margin-top:96px}.mr-lg-12{margin-right:96px}.mb-lg-12,.my-lg-12{margin-bottom:96px}.m-lg-15{margin:120px}.my-lg-15{margin-top:120px}.mr-lg-15{margin-right:120px}.mb-lg-15,.my-lg-15{margin-bottom:120px}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:8px}.pt-lg-1,.py-lg-1{padding-top:8px}.pb-lg-1,.py-lg-1{padding-bottom:8px}.p-lg-2{padding:16px}.pt-lg-2,.py-lg-2{padding-top:16px}.pb-lg-2,.py-lg-2{padding-bottom:16px}.p-lg-3{padding:24px}.pt-lg-3,.py-lg-3{padding-top:24px}.pb-lg-3,.py-lg-3{padding-bottom:24px}.p-lg-4{padding:32px}.pt-lg-4,.py-lg-4{padding-top:32px}.pb-lg-4,.py-lg-4{padding-bottom:32px}.p-lg-5{padding:40px}.pt-lg-5,.py-lg-5{padding-top:40px}.pb-lg-5,.py-lg-5{padding-bottom:40px}.p-lg-6{padding:48px}.pt-lg-6,.py-lg-6{padding-top:48px}.pb-lg-6,.py-lg-6{padding-bottom:48px}.p-lg-7{padding:56px}.pt-lg-7,.py-lg-7{padding-top:56px}.pb-lg-7,.py-lg-7{padding-bottom:56px}.p-lg-8{padding:64px}.pt-lg-8,.py-lg-8{padding-top:64px}.pb-lg-8,.py-lg-8{padding-bottom:64px}.p-lg-9{padding:72px}.pt-lg-9,.py-lg-9{padding-top:72px}.pb-lg-9,.py-lg-9{padding-bottom:72px}.p-lg-10{padding:80px}.pt-lg-10,.py-lg-10{padding-top:80px}.pb-lg-10,.py-lg-10{padding-bottom:80px}.p-lg-12{padding:96px}.pt-lg-12,.py-lg-12{padding-top:96px}.pb-lg-12,.py-lg-12{padding-bottom:96px}.p-lg-15{padding:120px}.pt-lg-15,.py-lg-15{padding-top:120px}.pb-lg-15,.py-lg-15{padding-bottom:120px}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:980px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-info{color:#17a2b8}a.text-info:focus,a.text-info:hover{color:#0f6674}.text-light{color:#f1f6f9}a.text-light:focus,a.text-light:hover{color:#bbd4e2}.text-dark{color:#495057}a.text-dark:focus,a.text-dark:hover{color:#262a2d}.text-white{color:#fff}a.text-white:focus,a.text-white:hover{color:#d9d9d9}.text-black{color:#212529}a.text-black:focus,a.text-black:hover{color:#000}.text-orange{color:#ff8c00}a.text-orange:focus,a.text-orange:hover{color:#b36200}.text-light-orange{color:#ffe4b5}a.text-light-orange:focus,a.text-light-orange:hover{color:#ffc869}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(33,37,41,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}blockquote,pre{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:980px}.container{min-width:980px}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}.docs a:link,.docs a:visited{color:#f14600;text-decoration:none}.docs a:active,.docs a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.height-20{height:20px}.headerlink{text-decoration:none;margin-left:.5rem}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,p,pre{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}@media(prefers-color-scheme:dark){.syntax{background:#2d2d2d;color:#f2f0ec}.syntax .c{color:#747369}.syntax .o{color:#6cc}.syntax .p{color:#f2f0ec}.syntax .cp{color:#747369}.syntax .c1{color:#747369}.syntax .ld{color:#9c9}.syntax .m{color:#f99157}.syntax .s{color:#9c9}.syntax .nb{color:#f2f0ec}.syntax .no{color:#f2777a}.syntax .py{color:#f2f0ec}.syntax .nv{color:#f2777a}.syntax .s2{color:#9c9}.syntax .s1{color:#9c9}}@media screen and (max-width:978.98px){.btn{padding:8px 16px}}@media screen and (max-width:978.98px){.btn-lg{padding:12px 24px}}img{max-width:100%}.display-5{color:#212529;font-size:20px;font-weight:500}.display-6{color:#212529;font-size:14px;font-weight:700}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=usage-recommendations>Usage Recommendations<a class=headerlink href=../amp/#usage-recommendations title="Permanent link"> </a></h1> <h2 id=cpu-scaling-governor>CPU Scaling Governor<a class=headerlink href=../amp/#cpu-scaling-governor title="Permanent link"> </a></h2> <p>Always use the <code class=syntax>performance</code> scaling governor. The <code class=syntax>on-demand</code> scaling governor works much worse with constantly high demand.</p> <div class=codehilite><pre><span></span><code class=syntax>$ <span class=nb>echo</span> <span class=s1>'performance'</span> <span class=p>|</span> sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</code></pre></div> <h2 id=cpu-limitations>CPU Limitations<a class=headerlink href=../amp/#cpu-limitations title="Permanent link"> </a></h2> <p>Processors can overheat. Use <code class=syntax>dmesg</code> to see if the CPU’s clock rate was limited due to overheating.<br> The restriction can also be set externally at the datacenter level. You can use <code class=syntax>turbostat</code> to monitor it under a load.</p> <h2 id=ram>RAM<a class=headerlink href=../amp/#ram title="Permanent link"> </a></h2> <p>For small amounts of data (up to ~200 GB compressed), it is best to use as much memory as the volume of data.<br> For large amounts of data and when processing interactive (online) queries, you should use a reasonable amount of RAM (128 GB or more) so the hot data subset will fit in the cache of pages.<br> Even for data volumes of ~50 TB per server, using 128 GB of RAM significantly improves query performance compared to 64 GB.</p> <p>Do not disable overcommit. The value <code class=syntax>cat /proc/sys/vm/overcommit_memory</code> should be 0 or 1. Run</p> <div class=codehilite><pre><span></span><code class=syntax>$ <span class=nb>echo</span> <span class=m>0</span> <span class=p>|</span> sudo tee /proc/sys/vm/overcommit_memory
</code></pre></div> <p>Use <code class=syntax>perf top</code> to watch the time spent in the kernel for memory management.<br> Permanent huge pages also do not need to be allocated.</p> <h2 id=storage-subsystem>Storage Subsystem<a class=headerlink href=../amp/#storage-subsystem title="Permanent link"> </a></h2> <p>If your budget allows you to use SSD, use SSD.<br> If not, use HDD. SATA HDDs 7200 RPM will do.</p> <p>Give preference to a lot of servers with local hard drives over a smaller number of servers with attached disk shelves.<br> But for storing archives with rare queries, shelves will work.</p> <h2 id=raid>RAID<a class=headerlink href=../amp/#raid title="Permanent link"> </a></h2> <p>When using HDD, you can combine their RAID-10, RAID-5, RAID-6 or RAID-50.<br> For Linux, software RAID is better (with <code class=syntax>mdadm</code>). We do not recommend using LVM.<br> When creating RAID-10, select the <code class=syntax>far</code> layout.<br> If your budget allows, choose RAID-10.</p> <p>If you have more than 4 disks, use RAID-6 (preferred) or RAID-50, instead of RAID-5.<br> When using RAID-5, RAID-6 or RAID-50, always increase stripe_cache_size, since the default value is usually not the best choice.</p> <div class=codehilite><pre><span></span><code class=syntax>$ <span class=nb>echo</span> <span class=m>4096</span> <span class=p>|</span> sudo tee /sys/block/md2/md/stripe_cache_size
</code></pre></div> <p>Calculate the exact number from the number of devices and the block size, using the formula: <code class=syntax>2 * num_devices * chunk_size_in_bytes / 4096</code>.</p> <p>A block size of 1024 KB is sufficient for all RAID configurations.<br> Never set the block size too small or too large.</p> <p>You can use RAID-0 on SSD.<br> Regardless of RAID use, always use replication for data security.</p> <p>Enable NCQ with a long queue. For HDD, choose the CFQ scheduler, and for SSD, choose noop. Don’t reduce the ‘readahead’ setting.<br> For HDD, enable the write cache.</p> <h2 id=file-system>File System<a class=headerlink href=../amp/#file-system title="Permanent link"> </a></h2> <p>Ext4 is the most reliable option. Set the mount options <code class=syntax>noatime, nobarrier</code>.<br> XFS is also suitable, but it hasn’t been as thoroughly tested with ClickHouse.<br> Most other file systems should also work fine. File systems with delayed allocation work better.</p> <h2 id=linux-kernel>Linux Kernel<a class=headerlink href=../amp/#linux-kernel title="Permanent link"> </a></h2> <p>Don’t use an outdated Linux kernel.</p> <h2 id=network>Network<a class=headerlink href=../amp/#network title="Permanent link"> </a></h2> <p>If you are using IPv6, increase the size of the route cache.<br> The Linux kernel prior to 3.2 had a multitude of problems with IPv6 implementation.</p> <p>Use at least a 10 GB network, if possible. 1 Gb will also work, but it will be much worse for patching replicas with tens of terabytes of data, or for processing distributed queries with a large amount of intermediate data.</p> <h2 id=huge-pages>Huge Pages<a class=headerlink href=../amp/#huge-pages title="Permanent link"> </a></h2> <p>If you are using old Linux kernel, disable transparent huge pages. It interferes with memory allocators, which leads to significant performance degradation.<br> On newer Linux kernels transparent huge pages are alright.</p> <div class=codehilite><pre><span></span><code class=syntax>$ <span class=nb>echo</span> <span class=s1>'madvise'</span> <span class=p>|</span> sudo tee /sys/kernel/mm/transparent_hugepage/enabled
</code></pre></div> <h2 id=hypervisor-configuration>Hypervisor configuration<a class=headerlink href=../amp/#hypervisor-configuration title="Permanent link"> </a></h2> <p>If you are using OpenStack, set</p> <div class=codehilite><pre><span></span><code class=syntax>cpu_mode=host-passthrough
</code></pre></div> <p>in nova.conf.</p> <p>If you are using libvirt, set</p> <div class=codehilite><pre><span></span><code class=syntax>&lt;cpu mode='host-passthrough'/&gt;
</code></pre></div> <p>in XML configuration.</p> <p>This is important for ClickHouse to be able to get correct information with <code class=syntax>cpuid</code> instruction.<br> Otherwise you may get <code class=syntax>Illegal instruction</code> crashes when hypervisor is run on old CPU models.</p> <h2 id=zookeeper>ZooKeeper<a class=headerlink href=../amp/#zookeeper title="Permanent link"> </a></h2> <p>You are probably already using ZooKeeper for other purposes. You can use the same installation of ZooKeeper, if it isn’t already overloaded.</p> <p>It’s best to use a fresh version of ZooKeeper – 3.4.9 or later. The version in stable Linux distributions may be outdated.</p> <p>You should never use manually written scripts to transfer data between different ZooKeeper clusters, because the result will be incorrect for sequential nodes. Never use the “zkcopy” utility for the same reason: <a href=https://github.com/ksprojects/zkcopy/issues/15 target=_blank>https://github.com/ksprojects/zkcopy/issues/15</a></p> <p>If you want to divide an existing ZooKeeper cluster into two, the correct way is to increase the number of its replicas and then reconfigure it as two independent clusters.</p> <p>Do not run ZooKeeper on the same servers as ClickHouse. Because ZooKeeper is very sensitive for latency and ClickHouse may utilize all available system resources.</p> <p>With the default settings, ZooKeeper is a time bomb:</p> <blockquote> <p>The ZooKeeper server won’t delete files from old snapshots and logs when using the default configuration (see autopurge), and this is the responsibility of the operator.</p> </blockquote> <p>This bomb must be defused.</p> <p>The ZooKeeper (3.5.1) configuration below is used in the Yandex.Metrica production environment as of May 20, 2017:</p> <p>zoo.cfg:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=c1># http://hadoop.apache.org/zookeeper/docs/current/zookeeperAdmin.html</span>

<span class=c1># The number of milliseconds of each tick</span>
<span class=nv>tickTime</span><span class=o>=</span><span class=m>2000</span>
<span class=c1># The number of ticks that the initial</span>
<span class=c1># synchronization phase can take</span>
<span class=c1># This value is not quite motivated</span>
<span class=nv>initLimit</span><span class=o>=</span><span class=m>300</span>
<span class=c1># The number of ticks that can pass between</span>
<span class=c1># sending a request and getting an acknowledgement</span>
<span class=nv>syncLimit</span><span class=o>=</span><span class=m>10</span>

<span class=nv>maxClientCnxns</span><span class=o>=</span><span class=m>2000</span>

<span class=c1># It is the maximum value that client may request and the server will accept.</span>
<span class=c1># It is Ok to have high maxSessionTimeout on server to allow clients to work with high session timeout if they want.</span>
<span class=c1># But we request session timeout of 30 seconds by default (you can change it with session_timeout_ms in ClickHouse config).</span>
<span class=nv>maxSessionTimeout</span><span class=o>=</span><span class=m>60000000</span>
<span class=c1># the directory where the snapshot is stored.</span>
<span class=nv>dataDir</span><span class=o>=</span>/opt/zookeeper/<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>'name'</span><span class=o>]</span> <span class=o>}}</span>/data
<span class=c1># Place the dataLogDir to a separate physical disc for better performance</span>
<span class=nv>dataLogDir</span><span class=o>=</span>/opt/zookeeper/<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>'name'</span><span class=o>]</span> <span class=o>}}</span>/logs

autopurge.snapRetainCount<span class=o>=</span><span class=m>10</span>
autopurge.purgeInterval<span class=o>=</span><span class=m>1</span>


<span class=c1># To avoid seeks ZooKeeper allocates space in the transaction log file in</span>
<span class=c1># blocks of preAllocSize kilobytes. The default block size is 64M. One reason</span>
<span class=c1># for changing the size of the blocks is to reduce the block size if snapshots</span>
<span class=c1># are taken more often. (Also, see snapCount).</span>
<span class=nv>preAllocSize</span><span class=o>=</span><span class=m>131072</span>

<span class=c1># Clients can submit requests faster than ZooKeeper can process them,</span>
<span class=c1># especially if there are a lot of clients. To prevent ZooKeeper from running</span>
<span class=c1># out of memory due to queued requests, ZooKeeper will throttle clients so that</span>
<span class=c1># there is no more than globalOutstandingLimit outstanding requests in the</span>
<span class=c1># system. The default limit is 1,000.ZooKeeper logs transactions to a</span>
<span class=c1># transaction log. After snapCount transactions are written to a log file a</span>
<span class=c1># snapshot is started and a new transaction log file is started. The default</span>
<span class=c1># snapCount is 10,000.</span>
<span class=nv>snapCount</span><span class=o>=</span><span class=m>3000000</span>

<span class=c1># If this option is defined, requests will be will logged to a trace file named</span>
<span class=c1># traceFile.year.month.day.</span>
<span class=c1>#traceFile=</span>

<span class=c1># Leader accepts client connections. Default value is "yes". The leader machine</span>
<span class=c1># coordinates updates. For higher update throughput at thes slight expense of</span>
<span class=c1># read throughput the leader can be configured to not accept clients and focus</span>
<span class=c1># on coordination.</span>
<span class=nv>leaderServes</span><span class=o>=</span>yes

<span class=nv>standaloneEnabled</span><span class=o>=</span><span class=nb>false</span>
<span class=nv>dynamicConfigFile</span><span class=o>=</span>/etc/zookeeper-<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>'name'</span><span class=o>]</span> <span class=o>}}</span>/conf/zoo.cfg.dynamic
</code></pre></div> <p>Java version:</p> <div class=codehilite><pre><span></span><code class=syntax>openjdk 11.0.5-shenandoah 2019-10-15
OpenJDK Runtime Environment (build 11.0.5-shenandoah+10-adhoc.heretic.src)
OpenJDK 64-Bit Server VM (build 11.0.5-shenandoah+10-adhoc.heretic.src, mixed mode)
</code></pre></div> <p>JVM parameters:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nv>NAME</span><span class=o>=</span>zookeeper-<span class=o>{{</span> cluster<span class=o>[</span><span class=s1>'name'</span><span class=o>]</span> <span class=o>}}</span>
<span class=nv>ZOOCFGDIR</span><span class=o>=</span>/etc/<span class=nv>$NAME</span>/conf

<span class=c1># TODO this is really ugly</span>
<span class=c1># How to find out, which jars are needed?</span>
<span class=c1># seems, that log4j requires the log4j.properties file to be in the classpath</span>
<span class=nv>CLASSPATH</span><span class=o>=</span><span class=s2>"</span><span class=nv>$ZOOCFGDIR</span><span class=s2>:/usr/build/classes:/usr/build/lib/*.jar:/usr/share/zookeeper-3.6.2/lib/audience-annotations-0.5.0.jar:/usr/share/zookeeper-3.6.2/lib/commons-cli-1.2.jar:/usr/share/zookeeper-3.6.2/lib/commons-lang-2.6.jar:/usr/share/zookeeper-3.6.2/lib/jackson-annotations-2.10.3.jar:/usr/share/zookeeper-3.6.2/lib/jackson-core-2.10.3.jar:/usr/share/zookeeper-3.6.2/lib/jackson-databind-2.10.3.jar:/usr/share/zookeeper-3.6.2/lib/javax.servlet-api-3.1.0.jar:/usr/share/zookeeper-3.6.2/lib/jetty-http-9.4.24.v20191120.jar:/usr/share/zookeeper-3.6.2/lib/jetty-io-9.4.24.v20191120.jar:/usr/share/zookeeper-3.6.2/lib/jetty-security-9.4.24.v20191120.jar:/usr/share/zookeeper-3.6.2/lib/jetty-server-9.4.24.v20191120.jar:/usr/share/zookeeper-3.6.2/lib/jetty-servlet-9.4.24.v20191120.jar:/usr/share/zookeeper-3.6.2/lib/jetty-util-9.4.24.v20191120.jar:/usr/share/zookeeper-3.6.2/lib/jline-2.14.6.jar:/usr/share/zookeeper-3.6.2/lib/json-simple-1.1.1.jar:/usr/share/zookeeper-3.6.2/lib/log4j-1.2.17.jar:/usr/share/zookeeper-3.6.2/lib/metrics-core-3.2.5.jar:/usr/share/zookeeper-3.6.2/lib/netty-buffer-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-codec-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-common-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-handler-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-resolver-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-transport-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-transport-native-epoll-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/netty-transport-native-unix-common-4.1.50.Final.jar:/usr/share/zookeeper-3.6.2/lib/simpleclient-0.6.0.jar:/usr/share/zookeeper-3.6.2/lib/simpleclient_common-0.6.0.jar:/usr/share/zookeeper-3.6.2/lib/simpleclient_hotspot-0.6.0.jar:/usr/share/zookeeper-3.6.2/lib/simpleclient_servlet-0.6.0.jar:/usr/share/zookeeper-3.6.2/lib/slf4j-api-1.7.25.jar:/usr/share/zookeeper-3.6.2/lib/slf4j-log4j12-1.7.25.jar:/usr/share/zookeeper-3.6.2/lib/snappy-java-1.1.7.jar:/usr/share/zookeeper-3.6.2/lib/zookeeper-3.6.2.jar:/usr/share/zookeeper-3.6.2/lib/zookeeper-jute-3.6.2.jar:/usr/share/zookeeper-3.6.2/lib/zookeeper-prometheus-metrics-3.6.2.jar:/usr/share/zookeeper-3.6.2/etc"</span>

<span class=nv>ZOOCFG</span><span class=o>=</span><span class=s2>"</span><span class=nv>$ZOOCFGDIR</span><span class=s2>/zoo.cfg"</span>
<span class=nv>ZOO_LOG_DIR</span><span class=o>=</span>/var/log/<span class=nv>$NAME</span>
<span class=nv>USER</span><span class=o>=</span>zookeeper
<span class=nv>GROUP</span><span class=o>=</span>zookeeper
<span class=nv>PIDDIR</span><span class=o>=</span>/var/run/<span class=nv>$NAME</span>
<span class=nv>PIDFILE</span><span class=o>=</span><span class=nv>$PIDDIR</span>/<span class=nv>$NAME</span>.pid
<span class=nv>SCRIPTNAME</span><span class=o>=</span>/etc/init.d/<span class=nv>$NAME</span>
<span class=nv>JAVA</span><span class=o>=</span>/usr/local/jdk-11/bin/java
<span class=nv>ZOOMAIN</span><span class=o>=</span><span class=s2>"org.apache.zookeeper.server.quorum.QuorumPeerMain"</span>
<span class=nv>ZOO_LOG4J_PROP</span><span class=o>=</span><span class=s2>"INFO,ROLLINGFILE"</span>
<span class=nv>JMXLOCALONLY</span><span class=o>=</span><span class=nb>false</span>
<span class=nv>JAVA_OPTS</span><span class=o>=</span><span class=s2>"-Xms{{ cluster.get('xms','128M') }} \</span>
<span class=s2>    -Xmx{{ cluster.get('xmx','1G') }} \</span>
<span class=s2>    -Xlog:safepoint,gc*=info,age*=debug:file=/var/log/</span><span class=nv>$NAME</span><span class=s2>/zookeeper-gc.log:time,level,tags:filecount=16,filesize=16M</span>
<span class=s2>    -verbose:gc \</span>
<span class=s2>    -XX:+UseG1GC \</span>
<span class=s2>    -Djute.maxbuffer=8388608 \</span>
<span class=s2>    -XX:MaxGCPauseMillis=50"</span>
</code></pre></div> <p>Salt init:</p> <div class=codehilite><pre><span></span><code class=syntax>description "zookeeper-{{ cluster['name'] }} centralized coordination service"

start on runlevel [2345]
stop on runlevel [!2345]

respawn

limit nofile 8192 8192

pre-start script
    [ -r "/etc/zookeeper-{{ cluster['name'] }}/conf/environment" ] || exit 0
    . /etc/zookeeper-{{ cluster['name'] }}/conf/environment
    [ -d $ZOO_LOG_DIR ] || mkdir -p $ZOO_LOG_DIR
    chown $USER:$GROUP $ZOO_LOG_DIR
end script

script
    . /etc/zookeeper-{{ cluster['name'] }}/conf/environment
    [ -r /etc/default/zookeeper ] &amp;&amp; . /etc/default/zookeeper
    if [ -z "$JMXDISABLE" ]; then
        JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=$JMXLOCALONLY"
    fi
    exec start-stop-daemon --start -c $USER --exec $JAVA --name zookeeper-{{ cluster['name'] }} \
        -- -cp $CLASSPATH $JAVA_OPTS -Dzookeeper.log.dir=${ZOO_LOG_DIR} \
        -Dzookeeper.root.logger=${ZOO_LOG4J_PROP} $ZOOMAIN $ZOOCFG
end script
</code></pre></div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2021 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/0456f20bf4dfe43e56279f2734c4dda7e89f437b" rel="external nofollow noreferrer" target="_blank" class="text-reset">0456f20bf4</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/en/operations/tips/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
