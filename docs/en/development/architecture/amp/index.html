










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="en">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>Architecture Overview | ClickHouse Documentation</title>
    <link rel="canonical" href="https://clickhouse.com/docs/en/development/architecture/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Architecture Overview | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.com/docs/en/development/architecture/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Architecture Overview | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>@charset "UTF-8";:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,header,section{display:block}body{margin:0;font-family:"Noto Sans",sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}a{color:#ff8c00;text-decoration:none;background-color:transparent}a:hover{color:#ff8c00;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}th{text-align:inherit}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}template{display:none}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:"Hind Siliguri",sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.small,small{font-size:80%;font-weight:400}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.blockquote{margin-bottom:8px;font-size:1.25rem}.blockquote-footer{display:block;font-size:80%;color:#6c757d}.blockquote-footer::before{content:"— "}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}.offset-1{margin-left:8.3333333333%}.offset-2{margin-left:16.6666666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.3333333333%}.offset-5{margin-left:41.6666666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.3333333333%}.offset-8{margin-left:66.6666666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.3333333333%}.offset-11{margin-left:91.6666666667%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-first{order:-1}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.3333333333%}.offset-md-2{margin-left:16.6666666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.3333333333%}.offset-md-5{margin-left:41.6666666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.3333333333%}.offset-md-8{margin-left:66.6666666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.3333333333%}.offset-md-11{margin-left:91.6666666667%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-first{order:-1}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.3333333333%}.offset-lg-2{margin-left:16.6666666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.3333333333%}.offset-lg-5{margin-left:41.6666666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.3333333333%}.offset-lg-8{margin-left:66.6666666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.3333333333%}.offset-lg-11{margin-left:91.6666666667%}}.table{width:100%;margin-bottom:8px;color:#212529}.table th{padding:.75rem;vertical-align:top;border-top:1px solid #d6dbdf}.table-primary,.table-primary>th{background-color:#fff1b8}.table-primary th{border-color:#ffe47a}.table-light,.table-light>th{background-color:#fbfcfd}.table-light th{border-color:#f8fafc}.table-dark,.table-dark>th{background-color:#ccced0}.table-dark th{border-color:#a0a4a8}.table-primary-light,.table-primary-light>th{background-color:#fffefb}.table-primary-light th{border-color:#fffcf7}.table-white,.table-white>th{background-color:#fff}.table-white th{border-color:#fff}.table-black,.table-black>th{background-color:#c1c2c3}.table-black th{border-color:#8c8e90}.table-orange,.table-orange>th{background-color:#ffdfb8}.table-orange th{border-color:#ffc37a}.table-light-orange,.table-light-orange>th{background-color:#fff7ea}.table-light-orange th{border-color:#fff1d9}.table-dark{color:#fff;background-color:#343a40}.table-dark th{border-color:#454d55}.form-control{display:block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:8px;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.form-control{transition:none}}.form-control::-ms-expand{background-color:transparent;border:0}.form-control:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.form-control:focus{color:#6c757d;background-color:#fff;border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.form-control::-moz-placeholder{color:#6c757d;opacity:1}.form-control:-ms-input-placeholder{color:#6c757d;opacity:1}.form-control::placeholder{color:#6c757d;opacity:1}.form-control:disabled,.form-control[readonly]{background-color:#e9ecef;opacity:1}select.form-control:focus::-ms-value{color:#6c757d;background-color:#fff}.form-control-file,.form-control-range{display:block;width:100%}.form-control-lg{height:calc(1.5em+1rem+2px);padding:.5rem 1rem;font-size:1.125rem;line-height:1.5;border-radius:8px}select.form-control[multiple],select.form-control[size]{height:auto}.form-group{margin-bottom:1rem}.form-text{display:block;margin-top:.25rem}.form-row{display:flex;flex-wrap:wrap;margin-right:-5px;margin-left:-5px}.form-row>.col,.form-row>[class*=col-]{padding-right:5px;padding-left:5px}.form-check{position:relative;display:block;padding-left:1.25rem}.form-check-input{position:absolute;margin-top:.3rem;margin-left:-1.25rem}.form-check-inline{display:inline-flex;align-items:center;padding-left:0;margin-right:.75rem}.form-check-inline .form-check-input{position:static;margin-top:0;margin-right:.3125rem;margin-left:0}.form-inline{display:flex;flex-flow:row wrap;align-items:center}.form-inline .form-check{width:100%}@media(min-width:616px){.form-inline .form-group{display:flex;flex:0 0 auto;flex-flow:row wrap;align-items:center;margin-bottom:0}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .custom-select,.form-inline .input-group{width:auto}.form-inline .form-check{display:flex;align-items:center;justify-content:center;width:auto;padding-left:0}.form-inline .form-check-input{position:relative;flex-shrink:0;margin-top:0;margin-right:.25rem;margin-left:0}.form-inline .custom-control{align-items:center;justify-content:center}}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{color:#495057;background-color:#d9ad00;border-color:#cca300;box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{color:#495057;background-color:#d6e5ee;border-color:#cddfea;box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{color:#fff;background-color:#383d42;border-color:#32373b;box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{color:#495057;background-color:#ffedca;border-color:#ffe9bd;box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{color:#495057;background-color:#ececec;border-color:#e6e6e6;box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{color:#fff;background-color:#101214;border-color:#0a0c0d;box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{color:#fff;background-color:#d97700;border-color:#cc7000;box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{color:#495057;background-color:#ffd68f;border-color:#ffd182;box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 rgba(255,255,255,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select,.input-group>.form-control{position:relative;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-file+.form-control,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select,.input-group>.custom-select+.form-control,.input-group>.form-control+.custom-file,.input-group>.form-control+.custom-select,.input-group>.form-control+.form-control{margin-left:-1px}.input-group>.custom-select:focus,.input-group>.form-control:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child),.input-group>.form-control:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child),.input-group>.form-control:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:flex;align-items:center}.input-group-append{display:flex}.input-group-append .btn{position:relative;z-index:2}.input-group-append .btn:focus{z-index:3}.input-group-append .btn+.btn,.input-group-append .btn+.input-group-text,.input-group-append .input-group-text+.btn,.input-group-append .input-group-text+.input-group-text{margin-left:-1px}.input-group-append{margin-left:-1px}.input-group-text{display:flex;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:8px}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select,.input-group-lg>.form-control:not(textarea){height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select,.input-group-lg>.form-control,.input-group-lg>.input-group-append>.btn,.input-group-lg>.input-group-append>.input-group-text{padding:.5rem 1rem;font-size:1.125rem;line-height:1.5;border-radius:8px}.input-group-lg>.custom-select{padding-right:1.75rem}.input-group>.input-group-append:last-child>.input-group-text:not(:last-child),.input-group>.input-group-append:not(:last-child)>.btn,.input-group>.input-group-append:not(:last-child)>.input-group-text{border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.input-group-append>.btn,.input-group>.input-group-append>.input-group-text{border-top-left-radius:0;border-bottom-left-radius:0}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:inline-flex;margin-right:1rem}.custom-control-input{position:absolute;left:0;z-index:-1;width:1rem;height:1.25rem;opacity:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-file-input{position:relative;z-index:2;width:100%;height:calc(1.5em+.75rem+2px);margin:0;opacity:0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#fc0;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#fff0b3}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#fc0;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#fff0b3}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#fc0;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#fff0b3}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px;background-color:#dee2e6;border-radius:1rem}.custom-range:disabled::-webkit-slider-thumb{background-color:#d6dbdf}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#d6dbdf}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#d6dbdf}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:8px}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#947c14;background-color:#fff5cc;border-color:#fff1b8}.alert-primary .alert-link{color:#67560e}.alert-light{color:#8d9295;background-color:#fcfdfe;border-color:#fbfcfd}.alert-light .alert-link{color:#73797c}.alert-dark{color:#363b41;background-color:#dbdcdd;border-color:#ccced0}.alert-dark .alert-link{color:#1f2225}.alert-primary-light{color:#949490;background-color:#fffefc;border-color:#fffefb}.alert-primary-light .alert-link{color:#7b7b76}.alert-white{color:#949698;background-color:#fff;border-color:#fff}.alert-white .alert-link{color:#7a7d7f}.alert-black{color:#212529;background-color:#d3d3d4;border-color:#c1c2c3}.alert-black .alert-link{color:#0a0c0d}.alert-orange{color:#945b14;background-color:#ffe8cc;border-color:#ffdfb8}.alert-orange .alert-link{color:#673f0e}.alert-light-orange{color:#948872;background-color:#fffaf0;border-color:#fff7ea}.alert-light-orange .alert-link{color:#786e5b}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:flex;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{transform:rotate(360deg)}}@keyframes spinner-border{to{transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#fc0}a.bg-primary:focus,a.bg-primary:hover{background-color:#cca300}.bg-light{background-color:#f1f6f9}a.bg-light:focus,a.bg-light:hover{background-color:#cddfea}.bg-dark{background-color:#495057}a.bg-dark:focus,a.bg-dark:hover{background-color:#32373b}.bg-primary-light{background-color:#fffaf0}a.bg-primary-light:focus,a.bg-primary-light:hover{background-color:#ffe9bd}.bg-white{background-color:#fff}a.bg-white:focus,a.bg-white:hover{background-color:#e6e6e6}.bg-black{background-color:#212529}a.bg-black:focus,a.bg-black:hover{background-color:#0a0c0d}.bg-orange{background-color:#ff8c00}a.bg-orange:focus,a.bg-orange:hover{background-color:#cc7000}.bg-light-orange{background-color:#ffe4b5}a.bg-light-orange:focus,a.bg-light-orange:hover{background-color:#ffd182}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:980px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-left{float:left}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-left{float:left}.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:980px){.float-lg-left{float:left}.float-lg-right{float:right}.float-lg-none{float:none}}.position-fixed{position:fixed}.fixed-top{position:fixed;top:0;right:0;left:0;z-index:1030}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}@supports(position:sticky){.sticky-top{position:sticky;top:0;z-index:1020}}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:8px}.mr-1{margin-right:8px}.mb-1,.my-1{margin-bottom:8px}.my-2{margin-top:16px}.mr-2{margin-right:16px}.mb-2,.my-2{margin-bottom:16px}.my-3{margin-top:24px}.mr-3{margin-right:24px}.mb-3,.my-3{margin-bottom:24px}.my-4{margin-top:32px}.mr-4{margin-right:32px}.mb-4,.my-4{margin-bottom:32px}.my-5{margin-top:40px}.mr-5{margin-right:40px}.mb-5,.my-5{margin-bottom:40px}.my-6{margin-top:48px}.mr-6{margin-right:48px}.mb-6,.my-6{margin-bottom:48px}.my-7{margin-top:56px}.mr-7{margin-right:56px}.mb-7,.my-7{margin-bottom:56px}.my-8{margin-top:64px}.mr-8{margin-right:64px}.mb-8,.my-8{margin-bottom:64px}.my-9{margin-top:72px}.mr-9{margin-right:72px}.mb-9,.my-9{margin-bottom:72px}.my-10{margin-top:80px}.mr-10{margin-right:80px}.mb-10,.my-10{margin-bottom:80px}.my-12{margin-top:96px}.mr-12{margin-right:96px}.mb-12,.my-12{margin-bottom:96px}.my-15{margin-top:120px}.mr-15{margin-right:120px}.mb-15,.my-15{margin-bottom:120px}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:8px}.pt-1,.py-1{padding-top:8px}.pb-1,.py-1{padding-bottom:8px}.p-2{padding:16px}.pt-2,.py-2{padding-top:16px}.pb-2,.py-2{padding-bottom:16px}.p-3{padding:24px}.pt-3,.py-3{padding-top:24px}.pb-3,.py-3{padding-bottom:24px}.p-4{padding:32px}.pt-4,.py-4{padding-top:32px}.pb-4,.py-4{padding-bottom:32px}.p-5{padding:40px}.pt-5,.py-5{padding-top:40px}.pb-5,.py-5{padding-bottom:40px}.p-6{padding:48px}.pt-6,.py-6{padding-top:48px}.pb-6,.py-6{padding-bottom:48px}.p-7{padding:56px}.pt-7,.py-7{padding-top:56px}.pb-7,.py-7{padding-bottom:56px}.p-8{padding:64px}.pt-8,.py-8{padding-top:64px}.pb-8,.py-8{padding-bottom:64px}.p-9{padding:72px}.pt-9,.py-9{padding-top:72px}.pb-9,.py-9{padding-bottom:72px}.p-10{padding:80px}.pt-10,.py-10{padding-top:80px}.pb-10,.py-10{padding-bottom:80px}.p-12{padding:96px}.pt-12,.py-12{padding-top:96px}.pb-12,.py-12{padding-bottom:96px}.p-15{padding:120px}.pt-15,.py-15{padding-top:120px}.pb-15,.py-15{padding-bottom:120px}.my-n1{margin-top:-8px}.mr-n1{margin-right:-8px}.mb-n1,.my-n1{margin-bottom:-8px}.my-n2{margin-top:-16px}.mr-n2{margin-right:-16px}.mb-n2,.my-n2{margin-bottom:-16px}.my-n3{margin-top:-24px}.mr-n3{margin-right:-24px}.mb-n3,.my-n3{margin-bottom:-24px}.my-n4{margin-top:-32px}.mr-n4{margin-right:-32px}.mb-n4,.my-n4{margin-bottom:-32px}.my-n5{margin-top:-40px}.mr-n5{margin-right:-40px}.mb-n5,.my-n5{margin-bottom:-40px}.my-n6{margin-top:-48px}.mr-n6{margin-right:-48px}.mb-n6,.my-n6{margin-bottom:-48px}.my-n7{margin-top:-56px}.mr-n7{margin-right:-56px}.mb-n7,.my-n7{margin-bottom:-56px}.my-n8{margin-top:-64px}.mr-n8{margin-right:-64px}.mb-n8,.my-n8{margin-bottom:-64px}.my-n9{margin-top:-72px}.mr-n9{margin-right:-72px}.mb-n9,.my-n9{margin-bottom:-72px}.my-n10{margin-top:-80px}.mr-n10{margin-right:-80px}.mb-n10,.my-n10{margin-bottom:-80px}.my-n12{margin-top:-96px}.mr-n12{margin-right:-96px}.mb-n12,.my-n12{margin-bottom:-96px}.my-n15{margin-top:-120px}.mr-n15{margin-right:-120px}.mb-n15,.my-n15{margin-bottom:-120px}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:8px}.mr-md-1{margin-right:8px}.mb-md-1,.my-md-1{margin-bottom:8px}.my-md-2{margin-top:16px}.mr-md-2{margin-right:16px}.mb-md-2,.my-md-2{margin-bottom:16px}.my-md-3{margin-top:24px}.mr-md-3{margin-right:24px}.mb-md-3,.my-md-3{margin-bottom:24px}.my-md-4{margin-top:32px}.mr-md-4{margin-right:32px}.mb-md-4,.my-md-4{margin-bottom:32px}.my-md-5{margin-top:40px}.mr-md-5{margin-right:40px}.mb-md-5,.my-md-5{margin-bottom:40px}.my-md-6{margin-top:48px}.mr-md-6{margin-right:48px}.mb-md-6,.my-md-6{margin-bottom:48px}.my-md-7{margin-top:56px}.mr-md-7{margin-right:56px}.mb-md-7,.my-md-7{margin-bottom:56px}.my-md-8{margin-top:64px}.mr-md-8{margin-right:64px}.mb-md-8,.my-md-8{margin-bottom:64px}.my-md-9{margin-top:72px}.mr-md-9{margin-right:72px}.mb-md-9,.my-md-9{margin-bottom:72px}.my-md-10{margin-top:80px}.mr-md-10{margin-right:80px}.mb-md-10,.my-md-10{margin-bottom:80px}.my-md-12{margin-top:96px}.mr-md-12{margin-right:96px}.mb-md-12,.my-md-12{margin-bottom:96px}.my-md-15{margin-top:120px}.mr-md-15{margin-right:120px}.mb-md-15,.my-md-15{margin-bottom:120px}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:8px}.pt-md-1,.py-md-1{padding-top:8px}.pb-md-1,.py-md-1{padding-bottom:8px}.p-md-2{padding:16px}.pt-md-2,.py-md-2{padding-top:16px}.pb-md-2,.py-md-2{padding-bottom:16px}.p-md-3{padding:24px}.pt-md-3,.py-md-3{padding-top:24px}.pb-md-3,.py-md-3{padding-bottom:24px}.p-md-4{padding:32px}.pt-md-4,.py-md-4{padding-top:32px}.pb-md-4,.py-md-4{padding-bottom:32px}.p-md-5{padding:40px}.pt-md-5,.py-md-5{padding-top:40px}.pb-md-5,.py-md-5{padding-bottom:40px}.p-md-6{padding:48px}.pt-md-6,.py-md-6{padding-top:48px}.pb-md-6,.py-md-6{padding-bottom:48px}.p-md-7{padding:56px}.pt-md-7,.py-md-7{padding-top:56px}.pb-md-7,.py-md-7{padding-bottom:56px}.p-md-8{padding:64px}.pt-md-8,.py-md-8{padding-top:64px}.pb-md-8,.py-md-8{padding-bottom:64px}.p-md-9{padding:72px}.pt-md-9,.py-md-9{padding-top:72px}.pb-md-9,.py-md-9{padding-bottom:72px}.p-md-10{padding:80px}.pt-md-10,.py-md-10{padding-top:80px}.pb-md-10,.py-md-10{padding-bottom:80px}.p-md-12{padding:96px}.pt-md-12,.py-md-12{padding-top:96px}.pb-md-12,.py-md-12{padding-bottom:96px}.p-md-15{padding:120px}.pt-md-15,.py-md-15{padding-top:120px}.pb-md-15,.py-md-15{padding-bottom:120px}.my-md-n1{margin-top:-8px}.mr-md-n1{margin-right:-8px}.mb-md-n1,.my-md-n1{margin-bottom:-8px}.my-md-n2{margin-top:-16px}.mr-md-n2{margin-right:-16px}.mb-md-n2,.my-md-n2{margin-bottom:-16px}.my-md-n3{margin-top:-24px}.mr-md-n3{margin-right:-24px}.mb-md-n3,.my-md-n3{margin-bottom:-24px}.my-md-n4{margin-top:-32px}.mr-md-n4{margin-right:-32px}.mb-md-n4,.my-md-n4{margin-bottom:-32px}.my-md-n5{margin-top:-40px}.mr-md-n5{margin-right:-40px}.mb-md-n5,.my-md-n5{margin-bottom:-40px}.my-md-n6{margin-top:-48px}.mr-md-n6{margin-right:-48px}.mb-md-n6,.my-md-n6{margin-bottom:-48px}.my-md-n7{margin-top:-56px}.mr-md-n7{margin-right:-56px}.mb-md-n7,.my-md-n7{margin-bottom:-56px}.my-md-n8{margin-top:-64px}.mr-md-n8{margin-right:-64px}.mb-md-n8,.my-md-n8{margin-bottom:-64px}.my-md-n9{margin-top:-72px}.mr-md-n9{margin-right:-72px}.mb-md-n9,.my-md-n9{margin-bottom:-72px}.my-md-n10{margin-top:-80px}.mr-md-n10{margin-right:-80px}.mb-md-n10,.my-md-n10{margin-bottom:-80px}.my-md-n12{margin-top:-96px}.mr-md-n12{margin-right:-96px}.mb-md-n12,.my-md-n12{margin-bottom:-96px}.my-md-n15{margin-top:-120px}.mr-md-n15{margin-right:-120px}.mb-md-n15,.my-md-n15{margin-bottom:-120px}}@media(min-width:980px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:8px}.mr-lg-1{margin-right:8px}.mb-lg-1,.my-lg-1{margin-bottom:8px}.my-lg-2{margin-top:16px}.mr-lg-2{margin-right:16px}.mb-lg-2,.my-lg-2{margin-bottom:16px}.my-lg-3{margin-top:24px}.mr-lg-3{margin-right:24px}.mb-lg-3,.my-lg-3{margin-bottom:24px}.my-lg-4{margin-top:32px}.mr-lg-4{margin-right:32px}.mb-lg-4,.my-lg-4{margin-bottom:32px}.my-lg-5{margin-top:40px}.mr-lg-5{margin-right:40px}.mb-lg-5,.my-lg-5{margin-bottom:40px}.my-lg-6{margin-top:48px}.mr-lg-6{margin-right:48px}.mb-lg-6,.my-lg-6{margin-bottom:48px}.my-lg-7{margin-top:56px}.mr-lg-7{margin-right:56px}.mb-lg-7,.my-lg-7{margin-bottom:56px}.my-lg-8{margin-top:64px}.mr-lg-8{margin-right:64px}.mb-lg-8,.my-lg-8{margin-bottom:64px}.my-lg-9{margin-top:72px}.mr-lg-9{margin-right:72px}.mb-lg-9,.my-lg-9{margin-bottom:72px}.my-lg-10{margin-top:80px}.mr-lg-10{margin-right:80px}.mb-lg-10,.my-lg-10{margin-bottom:80px}.my-lg-12{margin-top:96px}.mr-lg-12{margin-right:96px}.mb-lg-12,.my-lg-12{margin-bottom:96px}.my-lg-15{margin-top:120px}.mr-lg-15{margin-right:120px}.mb-lg-15,.my-lg-15{margin-bottom:120px}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:8px}.pt-lg-1,.py-lg-1{padding-top:8px}.pb-lg-1,.py-lg-1{padding-bottom:8px}.p-lg-2{padding:16px}.pt-lg-2,.py-lg-2{padding-top:16px}.pb-lg-2,.py-lg-2{padding-bottom:16px}.p-lg-3{padding:24px}.pt-lg-3,.py-lg-3{padding-top:24px}.pb-lg-3,.py-lg-3{padding-bottom:24px}.p-lg-4{padding:32px}.pt-lg-4,.py-lg-4{padding-top:32px}.pb-lg-4,.py-lg-4{padding-bottom:32px}.p-lg-5{padding:40px}.pt-lg-5,.py-lg-5{padding-top:40px}.pb-lg-5,.py-lg-5{padding-bottom:40px}.p-lg-6{padding:48px}.pt-lg-6,.py-lg-6{padding-top:48px}.pb-lg-6,.py-lg-6{padding-bottom:48px}.p-lg-7{padding:56px}.pt-lg-7,.py-lg-7{padding-top:56px}.pb-lg-7,.py-lg-7{padding-bottom:56px}.p-lg-8{padding:64px}.pt-lg-8,.py-lg-8{padding-top:64px}.pb-lg-8,.py-lg-8{padding-bottom:64px}.p-lg-9{padding:72px}.pt-lg-9,.py-lg-9{padding-top:72px}.pb-lg-9,.py-lg-9{padding-bottom:72px}.p-lg-10{padding:80px}.pt-lg-10,.py-lg-10{padding-top:80px}.pb-lg-10,.py-lg-10{padding-bottom:80px}.p-lg-12{padding:96px}.pt-lg-12,.py-lg-12{padding-top:96px}.pb-lg-12,.py-lg-12{padding-bottom:96px}.p-lg-15{padding:120px}.pt-lg-15,.py-lg-15{padding-top:120px}.pb-lg-15,.py-lg-15{padding-bottom:120px}.my-lg-n1{margin-top:-8px}.mr-lg-n1{margin-right:-8px}.mb-lg-n1,.my-lg-n1{margin-bottom:-8px}.my-lg-n2{margin-top:-16px}.mr-lg-n2{margin-right:-16px}.mb-lg-n2,.my-lg-n2{margin-bottom:-16px}.my-lg-n3{margin-top:-24px}.mr-lg-n3{margin-right:-24px}.mb-lg-n3,.my-lg-n3{margin-bottom:-24px}.my-lg-n4{margin-top:-32px}.mr-lg-n4{margin-right:-32px}.mb-lg-n4,.my-lg-n4{margin-bottom:-32px}.my-lg-n5{margin-top:-40px}.mr-lg-n5{margin-right:-40px}.mb-lg-n5,.my-lg-n5{margin-bottom:-40px}.my-lg-n6{margin-top:-48px}.mr-lg-n6{margin-right:-48px}.mb-lg-n6,.my-lg-n6{margin-bottom:-48px}.my-lg-n7{margin-top:-56px}.mr-lg-n7{margin-right:-56px}.mb-lg-n7,.my-lg-n7{margin-bottom:-56px}.my-lg-n8{margin-top:-64px}.mr-lg-n8{margin-right:-64px}.mb-lg-n8,.my-lg-n8{margin-bottom:-64px}.my-lg-n9{margin-top:-72px}.mr-lg-n9{margin-right:-72px}.mb-lg-n9,.my-lg-n9{margin-bottom:-72px}.my-lg-n10{margin-top:-80px}.mr-lg-n10{margin-right:-80px}.mb-lg-n10,.my-lg-n10{margin-bottom:-80px}.my-lg-n12{margin-top:-96px}.mr-lg-n12{margin-right:-96px}.mb-lg-n12,.my-lg-n12{margin-bottom:-96px}.my-lg-n15{margin-top:-120px}.mr-lg-n15{margin-right:-120px}.mb-lg-n15,.my-lg-n15{margin-bottom:-120px}}.text-wrap{white-space:normal}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-left{text-align:left}.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:980px){.text-lg-left{text-align:left}.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#fc0}a.text-primary:focus,a.text-primary:hover{color:#b38f00}.text-light{color:#f1f6f9}a.text-light:focus,a.text-light:hover{color:#bbd4e2}.text-dark{color:#495057}a.text-dark:focus,a.text-dark:hover{color:#262a2d}.text-primary-light{color:#fffaf0}a.text-primary-light:focus,a.text-primary-light:hover{color:#ffe1a4}.text-white{color:#fff}a.text-white:focus,a.text-white:hover{color:#d9d9d9}.text-black{color:#212529}a.text-black:focus,a.text-black:hover{color:#000}.text-orange{color:#ff8c00}a.text-orange:focus,a.text-orange:hover{color:#b36200}.text-light-orange{color:#ffe4b5}a.text-light-orange:focus,a.text-light-orange:hover{color:#ffc869}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(33,37,41,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}blockquote{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:980px}.container{min-width:980px}.table{border-collapse:collapse}.table th{background-color:#fff}.table-dark{color:inherit}.table-dark th{border-color:#d6dbdf}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}.docs a:link,.docs a:visited{color:#f14600;text-decoration:none}.docs a:active,.docs a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.height-20{height:20px}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content th{padding:.75rem;vertical-align:top}#content th{border:1px solid #444451}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}@media(max-width:768px){#search-form{width:50%}#search-form .input-group{width:100%}}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,th{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}}@media(prefers-color-scheme:dark){.syntax{background:#2d2d2d;color:#f2f0ec}.syntax .c{color:#747369}.syntax .k{color:#c9c}.syntax .l{color:#f99157}.syntax .n{color:#f2f0ec}.syntax .o{color:#6cc}.syntax .p{color:#f2f0ec}.syntax .c1{color:#747369}.syntax .cs{color:#747369}.syntax .ld{color:#9c9}.syntax .s{color:#9c9}.syntax .no{color:#f2777a}.syntax .py{color:#f2f0ec}.syntax .s2{color:#9c9}.syntax .s1{color:#9c9}}@media screen and (max-width:978.98px){.btn{padding:8px 16px}}@media screen and (max-width:978.98px){.btn-lg{padding:12px 24px}}.btn-primary{color:#212529}.btn-primary:active,.btn-primary:hover{color:#212529}.btn-outline-primary{background:#fffaf0;border-color:#fc0;color:#212529}.btn-outline-primary:active,.btn-outline-primary:hover{background:#fc0;border-color:#fc0;color:#212529}form .form-control{border:1px solid #6c757d;border-radius:6px;box-shadow:0 8px 20px rgba(108,117,125,.2);color:#212529;height:auto;line-height:20px;min-height:44px;padding:12px 16px;width:100%}form .form-control:focus{border-color:#212529;box-shadow:0 8px 20px rgba(108,117,125,.2);color:#212529}form .form-control::-moz-placeholder{color:#6c757d}form .form-control:-ms-input-placeholder{color:#6c757d}form .form-control::placeholder{color:#6c757d}form select.form-control{-webkit-appearance:none;-moz-appearance:none;appearance:none}form select.form-control:not([data-chosen]){color:#6c757d}img{max-width:100%}.section{background-repeat:no-repeat;background-position:center;background-size:cover;overflow:visible;position:relative}.section-bg{background-repeat:no-repeat;background-position:center;background-size:cover;display:block;height:100%;left:50%;position:absolute;top:0;transform:translateX(-50%);z-index:1}.section>.container{position:relative;z-index:2}ul{list-style-type:square;padding-left:1.25em}ul li:not(:last-child){margin-bottom:16px}ul li::marker{color:#ff3939}.bg-offset-right{bottom:0;left:-24px;position:absolute;top:0;width:calc(100vw+24px);z-index:-1}@media screen and (min-width:1240px){.bg-offset-right{left:-96px;width:calc(100vw+96px)}}.display-5{color:#212529;font-size:20px;font-weight:500}.display-6{color:#212529;font-size:14px;font-weight:700}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=overview-of-clickhouse-architecture>Overview of ClickHouse Architecture<a class=headerlink href=../amp/#overview-of-clickhouse-architecture title="Permanent link"> </a></h1> <p>ClickHouse is a true column-oriented DBMS. Data is stored by columns, and during the execution of arrays (vectors or chunks of columns). Whenever possible, operations are dispatched on arrays, rather than on individual values. It is called “vectorized query execution” and it helps lower the cost of actual data processing.</p> <blockquote> <p>This idea is nothing new. It dates back to the <code class=syntax>APL</code> (A programming language, 1957) and its descendants: <code class=syntax>A +</code> (APL dialect), <code class=syntax>J</code> (1990), <code class=syntax>K</code> (1993), and <code class=syntax>Q</code> (programming language from Kx Systems, 2003). Array programming is used in scientific data processing. Neither is this idea something new in relational databases: for example, it is used in the <code class=syntax>VectorWise</code> system (also known as Actian Vector Analytic Database by Actian Corporation).</p> </blockquote> <p>There are two different approaches for speeding up query processing: vectorized query execution and runtime code generation. The latter removes all indirection and dynamic dispatch. Neither of these approaches is strictly better than the other. Runtime code generation can be better when it fuses many operations, thus fully utilizing CPU execution units and the pipeline. Vectorized query execution can be less practical because it involves temporary vectors that must be written to the cache and read back. If the temporary data does not fit in the L2 cache, this becomes an issue. But vectorized query execution more easily utilizes the SIMD capabilities of the CPU. A <a href=http://15721.courses.cs.cmu.edu/spring2016/papers/p5-sompolski.pdf rel="external nofollow noreferrer" target=_blank>research paper</a> written by our friends shows that it is better to combine both approaches. ClickHouse uses vectorized query execution and has limited initial support for runtime code generation.</p> <h2 id=columns>Columns<a class=headerlink href=../amp/#columns title="Permanent link"> </a></h2> <p><code class=syntax>IColumn</code> interface is used to represent columns in memory (actually, chunks of columns). This interface provides helper methods for the implementation of various relational operators. Almost all operations are immutable: they do not modify the original column, but create a new modified one. For example, the <code class=syntax>IColumn :: filter</code> method accepts a filter byte mask. It is used for the <code class=syntax>WHERE</code> and <code class=syntax>HAVING</code> relational operators. Additional examples: the <code class=syntax>IColumn :: permute</code> method to support <code class=syntax>ORDER BY</code>, the <code class=syntax>IColumn :: cut</code> method to support <code class=syntax>LIMIT</code>.</p> <p>Various <code class=syntax>IColumn</code> implementations (<code class=syntax>ColumnUInt8</code>, <code class=syntax>ColumnString</code>, and so on) are responsible for the memory layout of columns. The memory layout is usually a contiguous array. For the integer type of columns, it is just one contiguous array, like <code class=syntax>std :: vector</code>. For <code class=syntax>String</code> and <code class=syntax>Array</code> columns, it is two vectors: one for all array elements, placed contiguously, and a second one for offsets to the beginning of each array. There is also <code class=syntax>ColumnConst</code> that stores just one value in memory, but looks like a column.</p> <h2 id=field>Field<a class=headerlink href=../amp/#field title="Permanent link"> </a></h2> <p>Nevertheless, it is possible to work with individual values as well. To represent an individual value, the <code class=syntax>Field</code> is used. <code class=syntax>Field</code> is just a discriminated union of <code class=syntax>UInt64</code>, <code class=syntax>Int64</code>, <code class=syntax>Float64</code>, <code class=syntax>String</code> and <code class=syntax>Array</code>. <code class=syntax>IColumn</code> has the <code class=syntax>operator []</code> method to get the n-th value as a <code class=syntax>Field</code>, and the <code class=syntax>insert</code> method to append a <code class=syntax>Field</code> to the end of a column. These methods are not very efficient, because they require dealing with temporary <code class=syntax>Field</code> objects representing an individual value. There are more efficient methods, such as <code class=syntax>insertFrom</code>, <code class=syntax>insertRangeFrom</code>, and so on.</p> <p><code class=syntax>Field</code> does not have enough information about a specific data type for a table. For example, <code class=syntax>UInt8</code>, <code class=syntax>UInt16</code>, <code class=syntax>UInt32</code>, and <code class=syntax>UInt64</code> are all represented as <code class=syntax>UInt64</code> in a <code class=syntax>Field</code>.</p> <h2 id=leaky-abstractions>Leaky Abstractions<a class=headerlink href=../amp/#leaky-abstractions title="Permanent link"> </a></h2> <p><code class=syntax>IColumn</code> has methods for common relational transformations of data, but they do not meet all needs. For example, <code class=syntax>ColumnUInt64</code> does not have a method to calculate the sum of two columns, and <code class=syntax>ColumnString</code> does not have a method to run a substring search. These countless routines are implemented outside of <code class=syntax>IColumn</code>.</p> <p>Various functions on columns can be implemented in a generic, non-efficient way using <code class=syntax>IColumn</code> methods to extract <code class=syntax>Field</code> values, or in a specialized way using knowledge of inner memory layout of data in a specific <code class=syntax>IColumn</code> implementation. It is implemented by casting functions to a specific <code class=syntax>IColumn</code> type and deal with internal representation directly. For example, <code class=syntax>ColumnUInt64</code> has the <code class=syntax>getData</code> method that returns a reference to an internal array, then a separate routine reads or fills that array directly. We have “leaky abstractions” to allow efficient specializations of various routines.</p> <h2 id=data_types>Data Types<a class=headerlink href=../amp/#data_types title="Permanent link"> </a></h2> <p><code class=syntax>IDataType</code> is responsible for serialization and deserialization: for reading and writing chunks of columns or individual values in binary or text form. <code class=syntax>IDataType</code> directly corresponds to data types in tables. For example, there are <code class=syntax>DataTypeUInt32</code>, <code class=syntax>DataTypeDateTime</code>, <code class=syntax>DataTypeString</code> and so on.</p> <p><code class=syntax>IDataType</code> and <code class=syntax>IColumn</code> are only loosely related to each other. Different data types can be represented in memory by the same <code class=syntax>IColumn</code> implementations. For example, <code class=syntax>DataTypeUInt32</code> and <code class=syntax>DataTypeDateTime</code> are both represented by <code class=syntax>ColumnUInt32</code> or <code class=syntax>ColumnConstUInt32</code>. In addition, the same data type can be represented by different <code class=syntax>IColumn</code> implementations. For example, <code class=syntax>DataTypeUInt8</code> can be represented by <code class=syntax>ColumnUInt8</code> or <code class=syntax>ColumnConstUInt8</code>.</p> <p><code class=syntax>IDataType</code> only stores metadata. For instance, <code class=syntax>DataTypeUInt8</code> does not store anything at all (except virtual pointer <code class=syntax>vptr</code>) and <code class=syntax>DataTypeFixedString</code> stores just <code class=syntax>N</code> (the size of fixed-size strings).</p> <p><code class=syntax>IDataType</code> has helper methods for various data formats. Examples are methods to serialize a value with possible quoting, to serialize a value for JSON, and to serialize a value as part of the XML format. There is no direct correspondence to data formats. For example, the different data formats <code class=syntax>Pretty</code> and <code class=syntax>TabSeparated</code> can use the same <code class=syntax>serializeTextEscaped</code> helper method from the <code class=syntax>IDataType</code> interface.</p> <h2 id=block>Block<a class=headerlink href=../amp/#block title="Permanent link"> </a></h2> <p>A <code class=syntax>Block</code> is a container that represents a subset (chunk) of a table in memory. It is just a set of triples: <code class=syntax>(IColumn, IDataType, column name)</code>. During query execution, data is processed by <code class=syntax>Block</code>s. If we have a <code class=syntax>Block</code>, we have data (in the <code class=syntax>IColumn</code> object), we have information about its type (in <code class=syntax>IDataType</code>) that tells us how to deal with that column, and we have the column name. It could be either the original column name from the table or some artificial name assigned for getting temporary results of calculations.</p> <p>When we calculate some function over columns in a block, we add another column with its result to the block, and we do not touch columns for arguments of the function because operations are immutable. Later, unneeded columns can be removed from the block, but not modified. It is convenient for the elimination of common subexpressions.</p> <p>Blocks are created for every processed chunk of data. Note that for the same type of calculation, the column names and types remain the same for different blocks, and only column data changes. It is better to split block data from the block header because small block sizes have a high overhead of temporary strings for copying shared_ptrs and column names.</p> <h2 id=block-streams>Block Streams<a class=headerlink href=../amp/#block-streams title="Permanent link"> </a></h2> <p>Block streams are for processing data. We use streams of blocks to read data from somewhere, perform data transformations, or write data to somewhere. <code class=syntax>IBlockInputStream</code> has the <code class=syntax>read</code> method to fetch the next block while available. <code class=syntax>IBlockOutputStream</code> has the <code class=syntax>write</code> method to push the block somewhere.</p> <p>Streams are responsible for:</p> <ol> <li>Reading or writing to a table. The table just returns a stream for reading or writing blocks.</li> <li>Implementing data formats. For example, if you want to output data to a terminal in <code class=syntax>Pretty</code> format, you create a block output stream where you push blocks, and it formats them.</li> <li>Performing data transformations. Let’s say you have <code class=syntax>IBlockInputStream</code> and want to create a filtered stream. You create <code class=syntax>FilterBlockInputStream</code> and initialize it with your stream. Then when you pull a block from <code class=syntax>FilterBlockInputStream</code>, it pulls a block from your stream, filters it, and returns the filtered block to you. Query execution pipelines are represented this way.</li> </ol> <p>There are more sophisticated transformations. For example, when you pull from <code class=syntax>AggregatingBlockInputStream</code>, it reads all data from its source, aggregates it, and then returns a stream of aggregated data for you. Another example: <code class=syntax>UnionBlockInputStream</code> accepts many input sources in the constructor and also a number of threads. It launches multiple threads and reads from multiple sources in parallel.</p> <blockquote> <p>Block streams use the “pull” approach to control flow: when you pull a block from the first stream, it consequently pulls the required blocks from nested streams, and the entire execution pipeline will work. Neither “pull” nor “push” is the best solution, because control flow is implicit, and that limits the implementation of various features like simultaneous execution of multiple queries (merging many pipelines together). This limitation could be overcome with coroutines or just running extra threads that wait for each other. We may have more possibilities if we make control flow explicit: if we locate the logic for passing data from one calculation unit to another outside of those calculation units. Read this <a href=http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/ rel="external nofollow noreferrer" target=_blank>article</a> for more thoughts.</p> </blockquote> <p>We should note that the query execution pipeline creates temporary data at each step. We try to keep block size small enough so that temporary data fits in the CPU cache. With that assumption, writing and reading temporary data is almost free in comparison with other calculations. We could consider an alternative, which is to fuse many operations in the pipeline together. It could make the pipeline as short as possible and remove much of the temporary data, which could be an advantage, but it also has drawbacks. For example, a split pipeline makes it easy to implement caching intermediate data, stealing intermediate data from similar queries running at the same time, and merging pipelines for similar queries.</p> <h2 id=formats>Formats<a class=headerlink href=../amp/#formats title="Permanent link"> </a></h2> <p>Data formats are implemented with block streams. There are “presentational” formats only suitable for the output of data to the client, such as <code class=syntax>Pretty</code> format, which provides only <code class=syntax>IBlockOutputStream</code>. And there are input/output formats, such as <code class=syntax>TabSeparated</code> or <code class=syntax>JSONEachRow</code>.</p> <p>There are also row streams: <code class=syntax>IRowInputStream</code> and <code class=syntax>IRowOutputStream</code>. They allow you to pull/push data by individual rows, not by blocks. And they are only needed to simplify the implementation of row-oriented formats. The wrappers <code class=syntax>BlockInputStreamFromRowInputStream</code> and <code class=syntax>BlockOutputStreamFromRowOutputStream</code> allow you to convert row-oriented streams to regular block-oriented streams.</p> <h2 id=io>I/O<a class=headerlink href=../amp/#io title="Permanent link"> </a></h2> <p>For byte-oriented input/output, there are <code class=syntax>ReadBuffer</code> and <code class=syntax>WriteBuffer</code> abstract classes. They are used instead of C++ <code class=syntax>iostream</code>s. Don’t worry: every mature C++ project is using something other than <code class=syntax>iostream</code>s for good reasons.</p> <p><code class=syntax>ReadBuffer</code> and <code class=syntax>WriteBuffer</code> are just a contiguous buffer and a cursor pointing to the position in that buffer. Implementations may own or not own the memory for the buffer. There is a virtual method to fill the buffer with the following data (for <code class=syntax>ReadBuffer</code>) or to flush the buffer somewhere (for <code class=syntax>WriteBuffer</code>). The virtual methods are rarely called.</p> <p>Implementations of <code class=syntax>ReadBuffer</code>/<code class=syntax>WriteBuffer</code> are used for working with files and file descriptors and network sockets, for implementing compression (<code class=syntax>CompressedWriteBuffer</code> is initialized with another WriteBuffer and performs compression before writing data to it), and for other purposes – the names <code class=syntax>ConcatReadBuffer</code>, <code class=syntax>LimitReadBuffer</code>, and <code class=syntax>HashingWriteBuffer</code> speak for themselves.</p> <p>Read/WriteBuffers only deal with bytes. There are functions from <code class=syntax>ReadHelpers</code> and <code class=syntax>WriteHelpers</code> header files to help with formatting input/output. For example, there are helpers to write a number in decimal format.</p> <p>Let’s look at what happens when you want to write a result set in <code class=syntax>JSON</code> format to stdout. You have a result set ready to be fetched from <code class=syntax>IBlockInputStream</code>. You create <code class=syntax>WriteBufferFromFileDescriptor(STDOUT_FILENO)</code> to write bytes to stdout. You create <code class=syntax>JSONRowOutputStream</code>, initialized with that <code class=syntax>WriteBuffer</code>, to write rows in <code class=syntax>JSON</code> to stdout. You create <code class=syntax>BlockOutputStreamFromRowOutputStream</code> on top of it, to represent it as <code class=syntax>IBlockOutputStream</code>. Then you call <code class=syntax>copyData</code> to transfer data from <code class=syntax>IBlockInputStream</code> to <code class=syntax>IBlockOutputStream</code>, and everything works. Internally, <code class=syntax>JSONRowOutputStream</code> will write various JSON delimiters and call the <code class=syntax>IDataType::serializeTextJSON</code> method with a reference to <code class=syntax>IColumn</code> and the row number as arguments. Consequently, <code class=syntax>IDataType::serializeTextJSON</code> will call a method from <code class=syntax>WriteHelpers.h</code>: for example, <code class=syntax>writeText</code> for numeric types and <code class=syntax>writeJSONString</code> for <code class=syntax>DataTypeString</code>.</p> <h2 id=tables>Tables<a class=headerlink href=../amp/#tables title="Permanent link"> </a></h2> <p>The <code class=syntax>IStorage</code> interface represents tables. Different implementations of that interface are different table engines. Examples are <code class=syntax>StorageMergeTree</code>, <code class=syntax>StorageMemory</code>, and so on. Instances of these classes are just tables.</p> <p>The key <code class=syntax>IStorage</code> methods are <code class=syntax>read</code> and <code class=syntax>write</code>. There are also <code class=syntax>alter</code>, <code class=syntax>rename</code>, <code class=syntax>drop</code>, and so on. The <code class=syntax>read</code> method accepts the following arguments: the set of columns to read from a table, the <code class=syntax>AST</code> query to consider, and the desired number of streams to return. It returns one or multiple <code class=syntax>IBlockInputStream</code> objects and information about the stage of data processing that was completed inside a table engine during query execution.</p> <p>In most cases, the read method is only responsible for reading the specified columns from a table, not for any further data processing. All further data processing is done by the query interpreter and is outside the responsibility of <code class=syntax>IStorage</code>.</p> <p>But there are notable exceptions:</p> <ul> <li>The AST query is passed to the <code class=syntax>read</code> method, and the table engine can use it to derive index usage and to read fewer data from a table.</li> <li>Sometimes the table engine can process data itself to a specific stage. For example, <code class=syntax>StorageDistributed</code> can send a query to remote servers, ask them to process data to a stage where data from different remote servers can be merged, and return that preprocessed data. The query interpreter then finishes processing the data.</li> </ul> <p>The table’s <code class=syntax>read</code> method can return multiple <code class=syntax>IBlockInputStream</code> objects to allow parallel data processing. These multiple block input streams can read from a table in parallel. Then you can wrap these streams with various transformations (such as expression evaluation or filtering) that can be calculated independently and create a <code class=syntax>UnionBlockInputStream</code> on top of them, to read from multiple streams in parallel.</p> <p>There are also <code class=syntax>TableFunction</code>s. These are functions that return a temporary <code class=syntax>IStorage</code> object to use in the <code class=syntax>FROM</code> clause of a query.</p> <p>To get a quick idea of how to implement your table engine, look at something simple, like <code class=syntax>StorageMemory</code> or <code class=syntax>StorageTinyLog</code>.</p> <blockquote> <p>As the result of the <code class=syntax>read</code> method, <code class=syntax>IStorage</code> returns <code class=syntax>QueryProcessingStage</code> – information about what parts of the query were already calculated inside storage.</p> </blockquote> <h2 id=parsers>Parsers<a class=headerlink href=../amp/#parsers title="Permanent link"> </a></h2> <p>A hand-written recursive descent parser parses a query. For example, <code class=syntax>ParserSelectQuery</code> just recursively calls the underlying parsers for various parts of the query. Parsers create an <code class=syntax>AST</code>. The <code class=syntax>AST</code> is represented by nodes, which are instances of <code class=syntax>IAST</code>.</p> <blockquote> <p>Parser generators are not used for historical reasons.</p> </blockquote> <h2 id=interpreters>Interpreters<a class=headerlink href=../amp/#interpreters title="Permanent link"> </a></h2> <p>Interpreters are responsible for creating the query execution pipeline from an <code class=syntax>AST</code>. There are simple interpreters, such as <code class=syntax>InterpreterExistsQuery</code> and <code class=syntax>InterpreterDropQuery</code>, or the more sophisticated <code class=syntax>InterpreterSelectQuery</code>. The query execution pipeline is a combination of block input or output streams. For example, the result of interpreting the <code class=syntax>SELECT</code> query is the <code class=syntax>IBlockInputStream</code> to read the result set from; the result of the INSERT query is the <code class=syntax>IBlockOutputStream</code> to write data for insertion to, and the result of interpreting the <code class=syntax>INSERT SELECT</code> query is the <code class=syntax>IBlockInputStream</code> that returns an empty result set on the first read, but that copies data from <code class=syntax>SELECT</code> to <code class=syntax>INSERT</code> at the same time.</p> <p><code class=syntax>InterpreterSelectQuery</code> uses <code class=syntax>ExpressionAnalyzer</code> and <code class=syntax>ExpressionActions</code> machinery for query analysis and transformations. This is where most rule-based query optimizations are done. <code class=syntax>ExpressionAnalyzer</code> is quite messy and should be rewritten: various query transformations and optimizations should be extracted to separate classes to allow modular transformations of query.</p> <h2 id=functions>Functions<a class=headerlink href=../amp/#functions title="Permanent link"> </a></h2> <p>There are ordinary functions and aggregate functions. For aggregate functions, see the next section.</p> <p>Ordinary functions do not change the number of rows – they work as if they are processing each row independently. In fact, functions are not called for individual rows, but for <code class=syntax>Block</code>’s of data to implement vectorized query execution.</p> <p>There are some miscellaneous functions, like <a href=../../../sql-reference/functions/other-functions/amp/#function-blocksize>blockSize</a>, <a href=../../../sql-reference/functions/other-functions/amp/#function-rownumberinblock>rowNumberInBlock</a>, and <a href=../../../sql-reference/functions/other-functions/amp/#runningaccumulate>runningAccumulate</a>, that exploit block processing and violate the independence of rows.</p> <p>ClickHouse has strong typing, so there’s no implicit type conversion. If a function does not support a specific combination of types, it throws an exception. But functions can work (be overloaded) for many different combinations of types. For example, the <code class=syntax>plus</code> function (to implement the <code class=syntax>+</code> operator) works for any combination of numeric types: <code class=syntax>UInt8</code> + <code class=syntax>Float32</code>, <code class=syntax>UInt16</code> + <code class=syntax>Int8</code>, and so on. Also, some variadic functions can accept any number of arguments, such as the <code class=syntax>concat</code> function.</p> <p>Implementing a function may be slightly inconvenient because a function explicitly dispatches supported data types and supported <code class=syntax>IColumns</code>. For example, the <code class=syntax>plus</code> function has code generated by instantiation of a C++ template for each combination of numeric types, and constant or non-constant left and right arguments.</p> <p>It is an excellent place to implement runtime code generation to avoid template code bloat. Also, it makes it possible to add fused functions like fused multiply-add or to make multiple comparisons in one loop iteration.</p> <p>Due to vectorized query execution, functions are not short-circuited. For example, if you write <code class=syntax>WHERE f(x) AND g(y)</code>, both sides are calculated, even for rows, when <code class=syntax>f(x)</code> is zero (except when <code class=syntax>f(x)</code> is a zero constant expression). But if the selectivity of the <code class=syntax>f(x)</code> condition is high, and calculation of <code class=syntax>f(x)</code> is much cheaper than <code class=syntax>g(y)</code>, it’s better to implement multi-pass calculation. It would first calculate <code class=syntax>f(x)</code>, then filter columns by the result, and then calculate <code class=syntax>g(y)</code> only for smaller, filtered chunks of data.</p> <h2 id=aggregate-functions>Aggregate Functions<a class=headerlink href=../amp/#aggregate-functions title="Permanent link"> </a></h2> <p>Aggregate functions are stateful functions. They accumulate passed values into some state and allow you to get results from that state. They are managed with the <code class=syntax>IAggregateFunction</code> interface. States can be rather simple (the state for <code class=syntax>AggregateFunctionCount</code> is just a single <code class=syntax>UInt64</code> value) or quite complex (the state of <code class=syntax>AggregateFunctionUniqCombined</code> is a combination of a linear array, a hash table, and a <code class=syntax>HyperLogLog</code> probabilistic data structure).</p> <p>States are allocated in <code class=syntax>Arena</code> (a memory pool) to deal with multiple states while executing a high-cardinality <code class=syntax>GROUP BY</code> query. States can have a non-trivial constructor and destructor: for example, complicated aggregation states can allocate additional memory themselves. It requires some attention to creating and destroying states and properly passing their ownership and destruction order.</p> <p>Aggregation states can be serialized and deserialized to pass over the network during distributed query execution or to write them on the disk where there is not enough RAM. They can even be stored in a table with the <code class=syntax>DataTypeAggregateFunction</code> to allow incremental aggregation of data.</p> <blockquote> <p>The serialized data format for aggregate function states is not versioned right now. It is ok if aggregate states are only stored temporarily. But we have the <code class=syntax>AggregatingMergeTree</code> table engine for incremental aggregation, and people are already using it in production. It is the reason why backward compatibility is required when changing the serialized format for any aggregate function in the future.</p> </blockquote> <h2 id=server>Server<a class=headerlink href=../amp/#server title="Permanent link"> </a></h2> <p>The server implements several different interfaces:</p> <ul> <li>An HTTP interface for any foreign clients.</li> <li>A TCP interface for the native ClickHouse client and for cross-server communication during distributed query execution.</li> <li>An interface for transferring data for replication.</li> </ul> <p>Internally, it is just a primitive multithreaded server without coroutines or fibers. Since the server is not designed to process a high rate of simple queries but to process a relatively low rate of complex queries, each of them can process a vast amount of data for analytics.</p> <p>The server initializes the <code class=syntax>Context</code> class with the necessary environment for query execution: the list of available databases, users and access rights, settings, clusters, the process list, the query log, and so on. Interpreters use this environment.</p> <p>We maintain full backward and forward compatibility for the server TCP protocol: old clients can talk to new servers, and new clients can talk to old servers. But we do not want to maintain it eternally, and we are removing support for old versions after about one year.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Note</p> <p>For most external applications, we recommend using the HTTP interface because it is simple and easy to use. The TCP protocol is more tightly linked to internal data structures: it uses an internal format for passing blocks of data, and it uses custom framing for compressed data. We haven’t released a C library for that protocol because it requires linking most of the ClickHouse codebase, which is not practical.</p> </div> <h2 id=distributed-query-execution>Distributed Query Execution<a class=headerlink href=../amp/#distributed-query-execution title="Permanent link"> </a></h2> <p>Servers in a cluster setup are mostly independent. You can create a <code class=syntax>Distributed</code> table on one or all servers in a cluster. The <code class=syntax>Distributed</code> table does not store data itself – it only provides a “view” to all local tables on multiple nodes of a cluster. When you SELECT from a <code class=syntax>Distributed</code> table, it rewrites that query, chooses remote nodes according to load balancing settings, and sends the query to them. The <code class=syntax>Distributed</code> table requests remote servers to process a query just up to a stage where intermediate results from different servers can be merged. Then it receives the intermediate results and merges them. The distributed table tries to distribute as much work as possible to remote servers and does not send much intermediate data over the network.</p> <p>Things become more complicated when you have subqueries in IN or JOIN clauses, and each of them uses a <code class=syntax>Distributed</code> table. We have different strategies for the execution of these queries.</p> <p>There is no global query plan for distributed query execution. Each node has its local query plan for its part of the job. We only have simple one-pass distributed query execution: we send queries for remote nodes and then merge the results. But this is not feasible for complicated queries with high cardinality GROUP BYs or with a large amount of temporary data for JOIN. In such cases, we need to “reshuffle” data between servers, which requires additional coordination. ClickHouse does not support that kind of query execution, and we need to work on it.</p> <h2 id=merge-tree>Merge Tree<a class=headerlink href=../amp/#merge-tree title="Permanent link"> </a></h2> <p><code class=syntax>MergeTree</code> is a family of storage engines that supports indexing by primary key. The primary key can be an arbitrary tuple of columns or expressions. Data in a <code class=syntax>MergeTree</code> table is stored in “parts”. Each part stores data in the primary key order, so data is ordered lexicographically by the primary key tuple. All the table columns are stored in separate <code class=syntax>column.bin</code> files in these parts. The files consist of compressed blocks. Each block is usually from 64 KB to 1 MB of uncompressed data, depending on the average value size. The blocks consist of column values placed contiguously one after the other. Column values are in the same order for each column (the primary key defines the order), so when you iterate by many columns, you get values for the corresponding rows.</p> <p>The primary key itself is “sparse”. It does not address every single row, but only some ranges of data. A separate <code class=syntax>primary.idx</code> file has the value of the primary key for each N-th row, where N is called <code class=syntax>index_granularity</code> (usually, N = 8192). Also, for each column, we have <code class=syntax>column.mrk</code> files with “marks”, which are offsets to each N-th row in the data file. Each mark is a pair: the offset in the file to the beginning of the compressed block, and the offset in the decompressed block to the beginning of data. Usually, compressed blocks are aligned by marks, and the offset in the decompressed block is zero. Data for <code class=syntax>primary.idx</code> always resides in memory, and data for <code class=syntax>column.mrk</code> files is cached.</p> <p>When we are going to read something from a part in <code class=syntax>MergeTree</code>, we look at <code class=syntax>primary.idx</code> data and locate ranges that could contain requested data, then look at <code class=syntax>column.mrk</code> data and calculate offsets for where to start reading those ranges. Because of sparseness, excess data may be read. ClickHouse is not suitable for a high load of simple point queries, because the entire range with <code class=syntax>index_granularity</code> rows must be read for each key, and the entire compressed block must be decompressed for each column. We made the index sparse because we must be able to maintain trillions of rows per single server without noticeable memory consumption for the index. Also, because the primary key is sparse, it is not unique: it cannot check the existence of the key in the table at INSERT time. You could have many rows with the same key in a table.</p> <p>When you <code class=syntax>INSERT</code> a bunch of data into <code class=syntax>MergeTree</code>, that bunch is sorted by primary key order and forms a new part. There are background threads that periodically select some parts and merge them into a single sorted part to keep the number of parts relatively low. That’s why it is called <code class=syntax>MergeTree</code>. Of course, merging leads to “write amplification”. All parts are immutable: they are only created and deleted, but not modified. When SELECT is executed, it holds a snapshot of the table (a set of parts). After merging, we also keep old parts for some time to make a recovery after failure easier, so if we see that some merged part is probably broken, we can replace it with its source parts.</p> <p><code class=syntax>MergeTree</code> is not an LSM tree because it does not contain “memtable” and “log”: inserted data is written directly to the filesystem. This makes it suitable only to INSERT data in batches, not by individual row and not very frequently – about once per second is ok, but a thousand times a second is not. We did it this way for simplicity’s sake, and because we are already inserting data in batches in our applications.</p> <p>There are MergeTree engines that are doing additional work during background merges. Examples are <code class=syntax>CollapsingMergeTree</code> and <code class=syntax>AggregatingMergeTree</code>. This could be treated as special support for updates. Keep in mind that these are not real updates because users usually have no control over the time when background merges are executed, and data in a <code class=syntax>MergeTree</code> table is almost always stored in more than one part, not in completely merged form.</p> <h2 id=replication>Replication<a class=headerlink href=../amp/#replication title="Permanent link"> </a></h2> <p>Replication in ClickHouse can be configured on a per-table basis. You could have some replicated and some non-replicated tables on the same server. You could also have tables replicated in different ways, such as one table with two-factor replication and another with three-factor.</p> <p>Replication is implemented in the <code class=syntax>ReplicatedMergeTree</code> storage engine. The path in <code class=syntax>ZooKeeper</code> is specified as a parameter for the storage engine. All tables with the same path in <code class=syntax>ZooKeeper</code> become replicas of each other: they synchronize their data and maintain consistency. Replicas can be added and removed dynamically simply by creating or dropping a table.</p> <p>Replication uses an asynchronous multi-master scheme. You can insert data into any replica that has a session with <code class=syntax>ZooKeeper</code>, and data is replicated to all other replicas asynchronously. Because ClickHouse does not support UPDATEs, replication is conflict-free. As there is no quorum acknowledgment of inserts, just-inserted data might be lost if one node fails.</p> <p>Metadata for replication is stored in ZooKeeper. There is a replication log that lists what actions to do. Actions are: get part; merge parts; drop a partition, and so on. Each replica copies the replication log to its queue and then executes the actions from the queue. For example, on insertion, the “get the part” action is created in the log, and every replica downloads that part. Merges are coordinated between replicas to get byte-identical results. All parts are merged in the same way on all replicas. One of the leaders initiates a new merge first and writes “merge parts” actions to the log. Multiple replicas (or all) can be leaders at the same time. A replica can be prevented from becoming a leader using the <code class=syntax>merge_tree</code> setting <code class=syntax>replicated_can_become_leader</code>. The leaders are responsible for scheduling background merges.</p> <p>Replication is physical: only compressed parts are transferred between nodes, not queries. Merges are processed on each replica independently in most cases to lower the network costs by avoiding network amplification. Large merged parts are sent over the network only in cases of significant replication lag.</p> <p>Besides, each replica stores its state in ZooKeeper as the set of parts and its checksums. When the state on the local filesystem diverges from the reference state in ZooKeeper, the replica restores its consistency by downloading missing and broken parts from other replicas. When there is some unexpected or broken data in the local filesystem, ClickHouse does not remove it, but moves it to a separate directory and forgets it.</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Note</p> <p>The ClickHouse cluster consists of independent shards, and each shard consists of replicas. The cluster is <strong>not elastic</strong>, so after adding a new shard, data is not rebalanced between shards automatically. Instead, the cluster load is supposed to be adjusted to be uneven. This implementation gives you more control, and it is ok for relatively small clusters, such as tens of nodes. But for clusters with hundreds of nodes that we are using in production, this approach becomes a significant drawback. We should implement a table engine that spans across the cluster with dynamically replicated regions that could be split and balanced between clusters automatically.</p> </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2021 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/0456f20bf4dfe43e56279f2734c4dda7e89f437b" rel="external nofollow noreferrer" target="_blank" class="text-reset">0456f20bf4</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/en/development/architecture/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
