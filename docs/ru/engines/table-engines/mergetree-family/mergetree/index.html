<!DOCTYPE html><html lang=ru data-version=master data-single-page=false> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>MergeTree | Документация ClickHouse</title><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/images/logo-180x180.png><meta property=og:title content="MergeTree | Документация ClickHouse"><meta property=og:description content="MergeTree Движок MergeTree, а также другие движки этого семейства (*MergeTree) — это наиболее функциональные движки табл"><meta property=og:type content=article><meta property=og:image content=https://clickhouse.tech/images/logo.png><meta content=https://clickhouse.tech/docs/ru/engines/table-engines/mergetree-family/mergetree/ property=og:url><link href=https://clickhouse.tech/docs/ru/engines/table-engines/mergetree-family/mergetree/ rel=canonical><link href=https://clickhouse.tech/docs/ru/engines/table-engines/mergetree-family/mergetree/amp/ rel=amphtml><link rel=search href=/opensearch.xml title=ClickHouse type=application/opensearchdescription+xml><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "MergeTree | Документация ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/ru/engines/table-engines/mergetree-family/mergetree/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "MergeTree | Документация ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><meta name=description content="MergeTree Движок MergeTree, а также другие движки этого семейства (*MergeTree) — это наиболее функциональные движки табл"><meta name=keywords content="ClickHouse, DBMS, OLAP, SQL, open-source, relational, analytics, analytical, Big Data, web-analytics"><link rel=alternate href=https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/mergetree/ hreflang=en><link rel=alternate href=https://clickhouse.tech/docs/zh/engines/table-engines/mergetree-family/mergetree/ hreflang=zh><link rel=alternate href=https://clickhouse.tech/docs/ru/engines/table-engines/mergetree-family/mergetree/ hreflang=ru><link rel=alternate href=https://clickhouse.tech/docs/ja/engines/table-engines/mergetree-family/mergetree/ hreflang=ja><link rel=alternate href=https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/mergetree/ hreflang=x-default><link href=/css/base.css?48d3d791 media=all rel=stylesheet></head> <body dir=ltr data-spy=scroll data-target=#toc data-offset=80> <nav id=top-nav class="navbar navbar-dark navbar-expand-md bg-dark-alt text-white sticky-top"> <div class="container-fluid justify-content-between"> <a href=/ class="d-block navbar-brand mr-3"> <img id=docs-logo-icon src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"> </a> <div class="w-100 navbar-text text-left d-none d-md-block"> <h1 class="h3 m-0 p-0 d-inline"> <a href=# class="text-white text-decoration-none"> MergeTree </a> </h1> </div> <div class="d-none d-md-block"> <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end"> <li id=edit-wrapper class=nav-item> <a id=edit-link href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/engines/table-engines/mergetree-family/mergetree.md title="Edit this article" class=nav-link rel="external nofollow noreferrer" target=_blank><img src=/images/mkdocs/edit.svg alt="Edit this article" class=mt-1 height=22></a> </li> <li class=nav-item> <a class=nav-link href=https://github.com/ClickHouse/ClickHouse rel="external nofollow noreferrer"> <img src=/images/index/github.svg alt="GitHub repository" title="Go to GitHub" height=32> </a> </li> <li id=languages-wrapper class="nav-item dropdown"> <div id=languages-dropdown> <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href=# id=lang-dropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false> <img src=/images/flags/ru.svg alt=Русский title=Русский width=32 class="d-inline-block mt-n1"> </a> <div class="dropdown-menu bg-dark" aria-labelledby=lang-dropdown> <a href=/docs/en/engines/table-engines/mergetree-family/mergetree/ class=dropdown-item> <img src=/images/flags/en.svg alt title width=32 class="d-inline-block mr-2">English </a> <a href=/docs/zh/engines/table-engines/mergetree-family/mergetree/ class=dropdown-item> <img src=/images/flags/zh.svg alt title width=32 class="d-inline-block mr-2">中文 </a> <a href=/docs/ru/engines/table-engines/mergetree-family/mergetree/ class="dropdown-item disabled"> <img src=/images/flags/ru.svg alt title width=32 class="d-inline-block mr-2">Русский </a> <a href=/docs/ja/engines/table-engines/mergetree-family/mergetree/ class=dropdown-item> <img src=/images/flags/ja.svg alt title width=32 class="d-inline-block mr-2">日本語 </a> </div> </div> </li> </ul> </div> <form id=search-form class="form-inline m-0"> <div class=input-group> <div class="input-group-prepend w-100"> <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id=search-icon> <img src=/images/mkdocs/search.svg> </span> <input id=docsearch-input class="form-control bg-secondary-alt text-muted border-0 pl-1" type=search placeholder=Search aria-label=Search> </div> </div> </form> <button id=navbar-toggler class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#sidebar aria-controls=sidebar aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> </nav> <div class=container-fluid> <div class="row justify-content-end justify-content-xl-center"> <div id=sidebar class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto"> <div class=overflow-auto> <div id=single-page-switch class="btn-group mb-2 float-right" role=group aria-label="Multi-page or single-page"> <a href=../../../.. role=button class="btn btn-dark active" aria-pressed=true> <img src=/images/mkdocs/multi.svg alt="Multi-page version" title="Multi-page version"> </a> <a href=../../../../single/ role=button class="btn btn-dark-alt active" aria-pressed=true> <img src=/images/mkdocs/single.svg alt="Single-page version" title="Single-page version"> </a> </div> <nav id=sidebar-nav class="nav flex-column mb-5"> <a href=#sidebar-sidebar-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-1 title=Введение class="nav-link text-light dropdown-toggle px-0">Введение</a> <div id=sidebar-sidebar-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../../../introduction/distinctive-features/ title="Отличительные возможности ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Отличительные возможности ClickHouse</a> <a href=../../../../introduction/performance/ title=Производительность class="nav-link text-light text-wrap d-inline-block w-100 px-0">Производительность</a> <a href=../../../../introduction/history/ title="История ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">История ClickHouse</a> <a href=../../../../introduction/adopters/ title=Adopters class="nav-link text-light text-wrap d-inline-block w-100 px-0">Adopters</a> <a href=../../../../introduction/info/ title="Информационная поддержка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Информационная поддержка</a> </nav> </div> <a href=#sidebar-sidebar-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2 title="Начало работы" class="nav-link text-light dropdown-toggle px-0">Начало работы</a> <div id=sidebar-sidebar-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../getting-started/install/ title=Установка class="nav-link text-light text-wrap d-inline-block w-100 px-0">Установка</a> <a href=../../../../getting-started/tutorial/ title=Tutorial class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tutorial</a> <a href=../../../../getting-started/playground/ title=Playground class="nav-link text-light text-wrap d-inline-block w-100 px-0">Playground</a> <a href=#sidebar-sidebar-2-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-2-5 title="Тестовые массивы данных" class="nav-link text-light dropdown-toggle px-0">Тестовые массивы данных</a> <div id=sidebar-sidebar-2-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../getting-started/example-datasets/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../getting-started/example-datasets/metrica/ title="Анонимизированные данные Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Анонимизированные данные Яндекс.Метрики</a> <a href=../../../../getting-started/example-datasets/star-schema/ title="Star Schema Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema Benchmark</a> <a href=../../../../getting-started/example-datasets/recipes/ title="Набор данных кулинарных рецептов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Набор данных кулинарных рецептов</a> <a href=../../../../getting-started/example-datasets/wikistat/ title=WikiStat class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a> <a href=../../../../getting-started/example-datasets/criteo/ title="Терабайт логов кликов от Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Терабайт логов кликов от Criteo</a> <a href=../../../../getting-started/example-datasets/amplab-benchmark/ title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a> <a href=../../../../getting-started/example-datasets/brown-benchmark/ title="Brown University Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Brown University Benchmark</a> <a href=../../../../getting-started/example-datasets/nyc-taxi/ title="Данные о такси в Нью-Йорке" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные о такси в Нью-Йорке</a> <a href=../../../../getting-started/example-datasets/ontime/ title=OnTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a> <a href=../../../../getting-started/example-datasets/cell-towers/ title="Вышки сотовой связи" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Вышки сотовой связи</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3 title=Интерфейсы class="nav-link text-light dropdown-toggle px-0">Интерфейсы</a> <div id=sidebar-sidebar-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../interfaces/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../interfaces/cli/ title="Клиент командной строки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиент командной строки</a> <a href=../../../../interfaces/tcp/ title="Родной интерфейс (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Родной интерфейс (TCP)</a> <a href=../../../../interfaces/http/ title=HTTP-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP-интерфейс</a> <a href=../../../../interfaces/mysql/ title=MySQL-интерфейс class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL-интерфейс</a> <a href=../../../../interfaces/formats/ title="Форматы входных и выходных данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Форматы входных и выходных данных</a> <a href=../../../../interfaces/jdbc/ title=JDBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC-драйвер</a> <a href=../../../../interfaces/odbc/ title=ODBC-драйвер class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC-драйвер</a> <a href=../../../../interfaces/cpp/ title="C++ клиентская библиотека" class="nav-link text-light text-wrap d-inline-block w-100 px-0">C++ клиентская библиотека</a> <a href=#sidebar-sidebar-3-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-3-10 title="Сторонние интерфейсы" class="nav-link text-light dropdown-toggle px-0">Сторонние интерфейсы</a> <div id=sidebar-sidebar-3-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../interfaces/third-party/ title="Сторонние интерфейсы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Сторонние интерфейсы</a> <a href=../../../../interfaces/third-party/client-libraries/ title="Клиентские библиотеки от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиентские библиотеки от сторонних разработчиков</a> <a href=../../../../interfaces/third-party/integrations/ title="Библиотеки для интеграции от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Библиотеки для интеграции от сторонних разработчиков</a> <a href=../../../../interfaces/third-party/gui/ title="Визуальные интерфейсы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Визуальные интерфейсы от сторонних разработчиков</a> <a href=../../../../interfaces/third-party/proxy/ title="Прокси-серверы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прокси-серверы от сторонних разработчиков</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4 title=Engines class="nav-link text-light dropdown-toggle px-0">Engines</a> <div id=sidebar-sidebar-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-4-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2 title="Движки таблиц" class="nav-link text-light dropdown-toggle px-0">Движки таблиц</a> <div id=sidebar-sidebar-4-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../engines/table-engines/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-4-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-2 title="MergeTree Family" class="nav-link text-light dropdown-toggle px-0">MergeTree Family</a> <div id=sidebar-sidebar-4-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../engines/table-engines/mergetree-family/mergetree/ title=MergeTree class="nav-link text-white active text-wrap d-inline-block w-100 px-0">MergeTree</a> <a href=../../../../engines/table-engines/mergetree-family/replication/ title="Репликация данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Репликация данных</a> <a href=../../../../engines/table-engines/mergetree-family/custom-partitioning-key/ title="Произвольный ключ партиционирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Произвольный ключ партиционирования</a> <a href=../../../../engines/table-engines/mergetree-family/replacingmergetree/ title=ReplacingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a> <a href=../../../../engines/table-engines/mergetree-family/summingmergetree/ title=SummingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a> <a href=../../../../engines/table-engines/mergetree-family/aggregatingmergetree/ title=AggregatingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a> <a href=../../../../engines/table-engines/mergetree-family/collapsingmergetree/ title=CollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a> <a href=../../../../engines/table-engines/mergetree-family/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a> <a href=../../../../engines/table-engines/mergetree-family/graphitemergetree/ title=GraphiteMergeTree class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a> </nav> </div> <a href=#sidebar-sidebar-4-2-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-3 title="Семейство Log" class="nav-link text-light dropdown-toggle px-0">Семейство Log</a> <div id=sidebar-sidebar-4-2-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../engines/table-engines/log-family/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../engines/table-engines/log-family/stripelog/ title=StripeLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a> <a href=../../../../engines/table-engines/log-family/log/ title=Log class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a> <a href=../../../../engines/table-engines/log-family/tinylog/ title=TinyLog class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a> </nav> </div> <a href=#sidebar-sidebar-4-2-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-4 title="Движки таблиц для интеграции" class="nav-link text-light dropdown-toggle px-0">Движки таблиц для интеграции</a> <div id=sidebar-sidebar-4-2-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../engines/table-engines/integrations/odbc/ title=ODBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a> <a href=../../../../engines/table-engines/integrations/jdbc/ title=JDBC class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a> <a href=../../../../engines/table-engines/integrations/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../../../engines/table-engines/integrations/s3/ title=S3 class="nav-link text-light text-wrap d-inline-block w-100 px-0">S3</a> <a href=../../../../engines/table-engines/integrations/mongodb/ title=MongoDB class="nav-link text-light text-wrap d-inline-block w-100 px-0">MongoDB</a> <a href=../../../../engines/table-engines/integrations/hdfs/ title=HDFS class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a> <a href=../../../../engines/table-engines/integrations/kafka/ title=Kafka class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a> <a href=../../../../engines/table-engines/integrations/embedded-rocksdb/ title=EmbeddedRocksDB class="nav-link text-light text-wrap d-inline-block w-100 px-0">EmbeddedRocksDB</a> <a href=../../../../engines/table-engines/integrations/postgresql/ title=PostgreSQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">PostgreSQL</a> <a href=../../../../engines/table-engines/integrations/ExternalDistributed/ title=ExternalDistributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">ExternalDistributed</a> <a href=../../../../engines/table-engines/integrations/ title="Движки таблиц для интеграции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Движки таблиц для интеграции</a> <a href=../../../../engines/table-engines/integrations/rabbitmq/ title=RabbitMQ class="nav-link text-light text-wrap d-inline-block w-100 px-0">RabbitMQ</a> </nav> </div> <a href=#sidebar-sidebar-4-2-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-2-5 title="Специальные движки таблиц" class="nav-link text-light dropdown-toggle px-0">Специальные движки таблиц</a> <div id=sidebar-sidebar-4-2-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../engines/table-engines/special/ title="Специальные движки таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Специальные движки таблиц</a> <a href=../../../../engines/table-engines/special/distributed/ title=Distributed class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a> <a href=../../../../engines/table-engines/special/dictionary/ title=Dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a> <a href=../../../../engines/table-engines/special/merge/ title=Merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a> <a href=../../../../engines/table-engines/special/file/ title=File class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a> <a href=../../../../engines/table-engines/special/null/ title=Null class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a> <a href=../../../../engines/table-engines/special/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../../../engines/table-engines/special/join/ title=Join class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a> <a href=../../../../engines/table-engines/special/url/ title=URL class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a> <a href=../../../../engines/table-engines/special/view/ title=View class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a> <a href=../../../../engines/table-engines/special/materializedview/ title=MaterializedView class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a> <a href=../../../../engines/table-engines/special/memory/ title=Memory class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a> <a href=../../../../engines/table-engines/special/buffer/ title=Buffer class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a> <a href=../../../../engines/table-engines/special/external-data/ title="Внешние данные для обработки запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние данные для обработки запроса</a> <a href=../../../../engines/table-engines/special/generate/ title=GenerateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">GenerateRandom</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-4-3 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-4-3 title="Движки баз данных" class="nav-link text-light dropdown-toggle px-0">Движки баз данных</a> <div id=sidebar-sidebar-4-3 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../engines/database-engines/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../engines/database-engines/materialize-mysql/ title=MaterializeMySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializeMySQL</a> <a href=../../../../engines/database-engines/mysql/ title=MySQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a> <a href=../../../../engines/database-engines/lazy/ title=Lazy class="nav-link text-light text-wrap d-inline-block w-100 px-0">Lazy</a> <a href=../../../../engines/database-engines/atomic/ title=Atomic class="nav-link text-light text-wrap d-inline-block w-100 px-0">Atomic</a> <a href=../../../../engines/database-engines/postgresql/ title=PostgreSQL class="nav-link text-light text-wrap d-inline-block w-100 px-0">PostgreSQL</a> </nav> </div> </nav> </div> <a href=#sidebar-sidebar-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5 title="Справка по SQL" class="nav-link text-light dropdown-toggle px-0">Справка по SQL</a> <div id=sidebar-sidebar-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-5-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2 title=Выражения class="nav-link text-light dropdown-toggle px-0">Выражения</a> <div id=sidebar-sidebar-5-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/statements/ title="SQL выражения в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQL выражения в ClickHouse</a> <a href=#sidebar-sidebar-5-2-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2-2 title=SELECT class="nav-link text-light dropdown-toggle px-0">SELECT</a> <div id=sidebar-sidebar-5-2-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/statements/select/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../../../sql-reference/statements/select/all/ title=ALL class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALL</a> <a href=../../../../sql-reference/statements/select/array-join/ title="ARRAY JOIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ARRAY JOIN</a> <a href=../../../../sql-reference/statements/select/distinct/ title=DISTINCT class="nav-link text-light text-wrap d-inline-block w-100 px-0">DISTINCT</a> <a href=../../../../sql-reference/statements/select/format/ title=FORMAT class="nav-link text-light text-wrap d-inline-block w-100 px-0">FORMAT</a> <a href=../../../../sql-reference/statements/select/from/ title=FROM class="nav-link text-light text-wrap d-inline-block w-100 px-0">FROM</a> <a href=../../../../sql-reference/statements/select/group-by/ title="GROUP BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GROUP BY</a> <a href=../../../../sql-reference/statements/select/having/ title=HAVING class="nav-link text-light text-wrap d-inline-block w-100 px-0">HAVING</a> <a href=../../../../sql-reference/statements/select/into-outfile/ title="INTO OUTFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INTO OUTFILE</a> <a href=../../../../sql-reference/statements/select/join/ title=JOIN class="nav-link text-light text-wrap d-inline-block w-100 px-0">JOIN</a> <a href=../../../../sql-reference/statements/select/limit/ title=LIMIT class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT</a> <a href=../../../../sql-reference/statements/select/limit-by/ title="LIMIT BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT BY</a> <a href=../../../../sql-reference/statements/select/offset/ title=OFFSET class="nav-link text-light text-wrap d-inline-block w-100 px-0">OFFSET</a> <a href=../../../../sql-reference/statements/select/order-by/ title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a> <a href=../../../../sql-reference/statements/select/prewhere/ title=PREWHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">PREWHERE</a> <a href=../../../../sql-reference/statements/select/sample/ title=SAMPLE class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE</a> <a href=../../../../sql-reference/statements/select/union/ title=UNION class="nav-link text-light text-wrap d-inline-block w-100 px-0">UNION</a> <a href=../../../../sql-reference/statements/select/where/ title=WHERE class="nav-link text-light text-wrap d-inline-block w-100 px-0">WHERE</a> <a href=../../../../sql-reference/statements/select/with/ title=WITH class="nav-link text-light text-wrap d-inline-block w-100 px-0">WITH</a> </nav> </div> <a href=../../../../sql-reference/statements/insert-into/ title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a> <a href=#sidebar-sidebar-5-2-4 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2-4 title=CREATE class="nav-link text-light dropdown-toggle px-0">CREATE</a> <div id=sidebar-sidebar-5-2-4 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/statements/create/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../../../sql-reference/statements/create/database/ title="База данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">База данных</a> <a href=../../../../sql-reference/statements/create/table/ title=Таблица class="nav-link text-light text-wrap d-inline-block w-100 px-0">Таблица</a> <a href=../../../../sql-reference/statements/create/view/ title=Представление class="nav-link text-light text-wrap d-inline-block w-100 px-0">Представление</a> <a href=../../../../sql-reference/statements/create/dictionary/ title=Словарь class="nav-link text-light text-wrap d-inline-block w-100 px-0">Словарь</a> <a href=../../../../sql-reference/statements/create/user/ title=Пользователь class="nav-link text-light text-wrap d-inline-block w-100 px-0">Пользователь</a> <a href=../../../../sql-reference/statements/create/role/ title=Роль class="nav-link text-light text-wrap d-inline-block w-100 px-0">Роль</a> <a href=../../../../sql-reference/statements/create/row-policy/ title="Политика доступа" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Политика доступа</a> <a href=../../../../sql-reference/statements/create/quota/ title=Квота class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квота</a> <a href=../../../../sql-reference/statements/create/settings-profile/ title="Профиль настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профиль настроек</a> </nav> </div> <a href=#sidebar-sidebar-5-2-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-2-5 title=ALTER class="nav-link text-light dropdown-toggle px-0">ALTER</a> <div id=sidebar-sidebar-5-2-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/statements/alter/ title=ALTER class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a> <a href=../../../../sql-reference/statements/alter/column/ title="Манипуляции со столбцами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции со столбцами</a> <a href=../../../../sql-reference/statements/alter/partition/ title=PARTITION class="nav-link text-light text-wrap d-inline-block w-100 px-0">PARTITION</a> <a href=../../../../sql-reference/statements/alter/delete/ title=DELETE class="nav-link text-light text-wrap d-inline-block w-100 px-0">DELETE</a> <a href=../../../../sql-reference/statements/alter/update/ title=UPDATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">UPDATE</a> <a href=../../../../sql-reference/statements/alter/order-by/ title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a> <a href=../../../../sql-reference/statements/alter/sample-by/ title="SAMPLE BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE BY</a> <a href=../../../../sql-reference/statements/alter/index/ title="Манипуляции с индексами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции с индексами</a> <a href=../../../../sql-reference/statements/alter/constraint/ title="Манипуляции с ограничениями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции с ограничениями</a> <a href=../../../../sql-reference/statements/alter/ttl/ title=TTL class="nav-link text-light text-wrap d-inline-block w-100 px-0">TTL</a> <a href=../../../../sql-reference/statements/alter/user/ title=USER class="nav-link text-light text-wrap d-inline-block w-100 px-0">USER</a> <a href=../../../../sql-reference/statements/alter/quota/ title=QUOTA class="nav-link text-light text-wrap d-inline-block w-100 px-0">QUOTA</a> <a href=../../../../sql-reference/statements/alter/role/ title=ROLE class="nav-link text-light text-wrap d-inline-block w-100 px-0">ROLE</a> <a href=../../../../sql-reference/statements/alter/row-policy/ title="ROW POLICY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ROW POLICY</a> <a href=../../../../sql-reference/statements/alter/settings-profile/ title="SETTINGS PROFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SETTINGS PROFILE</a> </nav> </div> <a href=../../../../sql-reference/statements/system/ title=SYSTEM class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a> <a href=../../../../sql-reference/statements/show/ title=SHOW class="nav-link text-light text-wrap d-inline-block w-100 px-0">SHOW</a> <a href=../../../../sql-reference/statements/grant/ title=GRANT class="nav-link text-light text-wrap d-inline-block w-100 px-0">GRANT</a> <a href=../../../../sql-reference/statements/explain/ title=EXPLAIN class="nav-link text-light text-wrap d-inline-block w-100 px-0">EXPLAIN</a> <a href=../../../../sql-reference/statements/revoke/ title=REVOKE class="nav-link text-light text-wrap d-inline-block w-100 px-0">REVOKE</a> <a href=../../../../sql-reference/statements/attach/ title=ATTACH class="nav-link text-light text-wrap d-inline-block w-100 px-0">ATTACH</a> <a href=../../../../sql-reference/statements/check-table/ title=CHECK class="nav-link text-light text-wrap d-inline-block w-100 px-0">CHECK</a> <a href=../../../../sql-reference/statements/describe-table/ title=DESCRIBE class="nav-link text-light text-wrap d-inline-block w-100 px-0">DESCRIBE</a> <a href=../../../../sql-reference/statements/detach/ title=DETACH class="nav-link text-light text-wrap d-inline-block w-100 px-0">DETACH</a> <a href=../../../../sql-reference/statements/drop/ title=DROP class="nav-link text-light text-wrap d-inline-block w-100 px-0">DROP</a> <a href=../../../../sql-reference/statements/exists/ title=EXISTS class="nav-link text-light text-wrap d-inline-block w-100 px-0">EXISTS</a> <a href=../../../../sql-reference/statements/kill/ title=KILL class="nav-link text-light text-wrap d-inline-block w-100 px-0">KILL</a> <a href=../../../../sql-reference/statements/optimize/ title=OPTIMIZE class="nav-link text-light text-wrap d-inline-block w-100 px-0">OPTIMIZE</a> <a href=../../../../sql-reference/statements/rename/ title=RENAME class="nav-link text-light text-wrap d-inline-block w-100 px-0">RENAME</a> <a href=../../../../sql-reference/statements/set/ title=SET class="nav-link text-light text-wrap d-inline-block w-100 px-0">SET</a> <a href=../../../../sql-reference/statements/set-role/ title="SET ROLE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SET ROLE</a> <a href=../../../../sql-reference/statements/truncate/ title=TRUNCATE class="nav-link text-light text-wrap d-inline-block w-100 px-0">TRUNCATE</a> <a href=../../../../sql-reference/statements/use/ title=USE class="nav-link text-light text-wrap d-inline-block w-100 px-0">USE</a> <a href=../../../../sql-reference/statements/watch/ title=WATCH class="nav-link text-light text-wrap d-inline-block w-100 px-0">WATCH</a> </nav> </div> <a href=../../../../sql-reference/syntax/ title=Синтаксис class="nav-link text-light text-wrap d-inline-block w-100 px-0">Синтаксис</a> <a href=../../../../sql-reference/distributed-ddl/ title="Распределенные DDL запросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Распределенные DDL запросы</a> <a href=#sidebar-sidebar-5-5 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5 title=Функции class="nav-link text-light dropdown-toggle px-0">Функции</a> <div id=sidebar-sidebar-5-5 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../sql-reference/functions/arithmetic-functions/ title="Арифметические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Арифметические функции</a> <a href=../../../../sql-reference/functions/array-functions/ title=Массивы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Массивы</a> <a href=../../../../sql-reference/functions/comparison-functions/ title="Функции сравнения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции сравнения</a> <a href=../../../../sql-reference/functions/logical-functions/ title="Логические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Логические функции</a> <a href=../../../../sql-reference/functions/type-conversion-functions/ title="Функции преобразования типов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции преобразования типов</a> <a href=../../../../sql-reference/functions/date-time-functions/ title="Функции для работы с датами и временем" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с датами и временем</a> <a href=../../../../sql-reference/functions/string-functions/ title="Функции для работы со строками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со строками</a> <a href=../../../../sql-reference/functions/string-search-functions/ title="Функции поиска в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска в строках</a> <a href=../../../../sql-reference/functions/string-replace-functions/ title="Функции поиска и замены в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска и замены в строках</a> <a href=../../../../sql-reference/functions/conditional-functions/ title="Условные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Условные функции</a> <a href=../../../../sql-reference/functions/files/ title="Функции для работы с файлами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с файлами</a> <a href=../../../../sql-reference/functions/math-functions/ title="Математические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Математические функции</a> <a href=../../../../sql-reference/functions/rounding-functions/ title="Функции округления" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции округления</a> <a href=../../../../sql-reference/functions/tuple-map-functions/ title="Работа с контейнерами map" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Работа с контейнерами map</a> <a href=../../../../sql-reference/functions/splitting-merging-functions/ title="Функции разбиения и слияния строк и массивов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции разбиения и слияния строк и массивов</a> <a href=../../../../sql-reference/functions/bit-functions/ title="Битовые функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Битовые функции</a> <a href=../../../../sql-reference/functions/bitmap-functions/ title="Функции для битмапов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для битмапов</a> <a href=../../../../sql-reference/functions/hash-functions/ title="Функции хэширования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции хэширования</a> <a href=../../../../sql-reference/functions/random-functions/ title="Функции генерации псевдослучайных чисел" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции генерации псевдослучайных чисел</a> <a href=../../../../sql-reference/functions/encoding-functions/ title="Функции кодирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции кодирования</a> <a href=../../../../sql-reference/functions/uuid-functions/ title="Функции для работы с UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с UUID</a> <a href=../../../../sql-reference/functions/url-functions/ title="Функции для работы с URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с URL</a> <a href=../../../../sql-reference/functions/ip-address-functions/ title="Функции для работы с IP-адресами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с IP-адресами</a> <a href=../../../../sql-reference/functions/json-functions/ title=JSON class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON</a> <a href=../../../../sql-reference/functions/ext-dict-functions/ title="Функции для работы с внешними словарями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с внешними словарями</a> <a href=../../../../sql-reference/functions/ym-dict-functions/ title="Функции для работы со словарями Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со словарями Яндекс.Метрики</a> <a href=../../../../sql-reference/functions/in-functions/ title="Функции для реализации оператора IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для реализации оператора IN</a> <a href=../../../../sql-reference/functions/array-join/ title="Функция ArrayJoin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функция ArrayJoin</a> <a href=#sidebar-sidebar-5-5-30 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-5-30 title=Гео-данные class="nav-link text-light dropdown-toggle px-0">Гео-данные</a> <div id=sidebar-sidebar-5-5-30 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/functions/geo/coordinates/ title="Функции для работы с географическими координатами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с географическими координатами</a> <a href=../../../../sql-reference/functions/geo/h3/ title="Функции для работы с индексами H3" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с индексами H3</a> <a href=../../../../sql-reference/functions/geo/geohash/ title="Функции для работы с системой Geohash" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с системой Geohash</a> </nav> </div> <a href=../../../../sql-reference/functions/functions-for-nulls/ title="Функции для работы с Nullable-аргументами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с Nullable-аргументами</a> <a href=../../../../sql-reference/functions/machine-learning-functions/ title="Функции машинного обучения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции машинного обучения</a> <a href=../../../../sql-reference/functions/introspection/ title="Функции интроспекции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции интроспекции</a> <a href=../../../../sql-reference/functions/other-functions/ title="Прочие функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие функции</a> <a href=../../../../sql-reference/functions/encryption-functions/ title="Функции для шифрования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для шифрования</a> <a href=../../../../sql-reference/functions/tuple-functions/ title="Функции для работы с кортежами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с кортежами</a> </nav> </div> <a href=#sidebar-sidebar-5-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-6 title="Агрегатные функции" class="nav-link text-light dropdown-toggle px-0">Агрегатные функции</a> <div id=sidebar-sidebar-5-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/aggregate-functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-5-6-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-6-2 title=Справочник class="nav-link text-light dropdown-toggle px-0">Справочник</a> <div id=sidebar-sidebar-5-6-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/aggregate-functions/reference/count/ title=count class="nav-link text-light text-wrap d-inline-block w-100 px-0">count</a> <a href=../../../../sql-reference/aggregate-functions/reference/min/ title=min class="nav-link text-light text-wrap d-inline-block w-100 px-0">min</a> <a href=../../../../sql-reference/aggregate-functions/reference/max/ title=max class="nav-link text-light text-wrap d-inline-block w-100 px-0">max</a> <a href=../../../../sql-reference/aggregate-functions/reference/sum/ title=sum class="nav-link text-light text-wrap d-inline-block w-100 px-0">sum</a> <a href=../../../../sql-reference/aggregate-functions/reference/avg/ title=avg class="nav-link text-light text-wrap d-inline-block w-100 px-0">avg</a> <a href=../../../../sql-reference/aggregate-functions/reference/any/ title=any class="nav-link text-light text-wrap d-inline-block w-100 px-0">any</a> <a href=../../../../sql-reference/aggregate-functions/reference/stddevpop/ title=stddevPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevPop</a> <a href=../../../../sql-reference/aggregate-functions/reference/stddevsamp/ title=stddevSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevSamp</a> <a href=../../../../sql-reference/aggregate-functions/reference/varpop/ title=varPop(x) class="nav-link text-light text-wrap d-inline-block w-100 px-0">varPop(x)</a> <a href=../../../../sql-reference/aggregate-functions/reference/varsamp/ title=varSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">varSamp</a> <a href=../../../../sql-reference/aggregate-functions/reference/covarpop/ title=covarPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarPop</a> <a href=../../../../sql-reference/aggregate-functions/reference/covarsamp/ title=covarSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarSamp</a> <a href=../../../../sql-reference/aggregate-functions/reference/anyheavy/ title=anyHeavy class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyHeavy</a> <a href=../../../../sql-reference/aggregate-functions/reference/anylast/ title=anyLast class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyLast</a> <a href=../../../../sql-reference/aggregate-functions/reference/argmin/ title=argMin class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMin</a> <a href=../../../../sql-reference/aggregate-functions/reference/argmax/ title=argMax class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMax</a> <a href=../../../../sql-reference/aggregate-functions/reference/avgweighted/ title=avgWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">avgWeighted</a> <a href=../../../../sql-reference/aggregate-functions/reference/corr/ title=corr class="nav-link text-light text-wrap d-inline-block w-100 px-0">corr</a> <a href=../../../../sql-reference/aggregate-functions/reference/topk/ title=topK class="nav-link text-light text-wrap d-inline-block w-100 px-0">topK</a> <a href=../../../../sql-reference/aggregate-functions/reference/topkweighted/ title=topKWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">topKWeighted</a> <a href=../../../../sql-reference/aggregate-functions/reference/grouparray/ title=groupArray class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArray</a> <a href=../../../../sql-reference/aggregate-functions/reference/groupuniqarray/ title=groupUniqArray class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupUniqArray</a> <a href=../../../../sql-reference/aggregate-functions/reference/grouparrayinsertat/ title=groupArrayInsertAt class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayInsertAt</a> <a href=../../../../sql-reference/aggregate-functions/reference/grouparraymovingsum/ title=groupArrayMovingSum class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingSum</a> <a href=../../../../sql-reference/aggregate-functions/reference/grouparraymovingavg/ title=groupArrayMovingAvg class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingAvg</a> <a href=../../../../sql-reference/aggregate-functions/reference/grouparraysample/ title=groupArraySample class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArraySample</a> <a href=../../../../sql-reference/aggregate-functions/reference/groupbitand/ title=groupBitAnd class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitAnd</a> <a href=../../../../sql-reference/aggregate-functions/reference/groupbitor/ title=groupBitOr class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitOr</a> <a href=../../../../sql-reference/aggregate-functions/reference/groupbitxor/ title=groupBitXor class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitXor</a> <a href=../../../../sql-reference/aggregate-functions/reference/groupbitmap/ title=groupBitmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmap</a> <a href=../../../../sql-reference/aggregate-functions/reference/sumwithoverflow/ title=sumWithOverflow class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumWithOverflow</a> <a href=../../../../sql-reference/aggregate-functions/reference/deltasum/ title=deltaSum class="nav-link text-light text-wrap d-inline-block w-100 px-0">deltaSum</a> <a href=../../../../sql-reference/aggregate-functions/reference/deltasumtimestamp/ title=deltaSumTimestamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">deltaSumTimestamp</a> <a href=../../../../sql-reference/aggregate-functions/reference/summap/ title="sumMap(key, value), sumMap(Tuple(key, value))" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumMap(key, value), sumMap(Tuple(key, value))</a> <a href=../../../../sql-reference/aggregate-functions/reference/minmap/ title=minMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">minMap</a> <a href=../../../../sql-reference/aggregate-functions/reference/maxmap/ title=maxMap class="nav-link text-light text-wrap d-inline-block w-100 px-0">maxMap</a> <a href=../../../../sql-reference/aggregate-functions/reference/sumcount/ title=sumCount class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumCount</a> <a href=../../../../sql-reference/aggregate-functions/reference/rankCorr/ title=rankCorr class="nav-link text-light text-wrap d-inline-block w-100 px-0">rankCorr</a> <a href=../../../../sql-reference/aggregate-functions/reference/sumkahan/ title=sumKahan class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumKahan</a> <a href=../../../../sql-reference/aggregate-functions/reference/intervalLengthSum/ title=intervalLengthSum class="nav-link text-light text-wrap d-inline-block w-100 px-0">intervalLengthSum</a> <a href=../../../../sql-reference/aggregate-functions/reference/skewpop/ title=skewPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewPop</a> <a href=../../../../sql-reference/aggregate-functions/reference/skewsamp/ title=skewSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewSamp</a> <a href=../../../../sql-reference/aggregate-functions/reference/kurtpop/ title=kurtPop class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtPop</a> <a href=../../../../sql-reference/aggregate-functions/reference/kurtsamp/ title=kurtSamp class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtSamp</a> <a href=../../../../sql-reference/aggregate-functions/reference/uniq/ title=uniq class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniq</a> <a href=../../../../sql-reference/aggregate-functions/reference/uniqexact/ title=uniqExact class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqExact</a> <a href=../../../../sql-reference/aggregate-functions/reference/uniqcombined/ title=uniqCombined class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined</a> <a href=../../../../sql-reference/aggregate-functions/reference/uniqcombined64/ title=uniqCombined64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined64</a> <a href=../../../../sql-reference/aggregate-functions/reference/uniqhll12/ title=uniqHLL12 class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqHLL12</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantile/ title=quantile class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantile</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantiles/ title=quantiles class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantiles</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantileexact/ title=quantileExact class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExact</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantileexactweighted/ title=quantileExactWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExactWeighted</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantiletiming/ title=quantileTiming class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTiming</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantiletimingweighted/ title=quantileTimingWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTimingWeighted</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantiledeterministic/ title=quantileDeterministic class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileDeterministic</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantiletdigest/ title=quantileTDigest class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigest</a> <a href=../../../../sql-reference/aggregate-functions/reference/quantiletdigestweighted/ title=quantileTDigestWeighted class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigestWeighted</a> <a href=../../../../sql-reference/aggregate-functions/reference/simplelinearregression/ title=simpleLinearRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">simpleLinearRegression</a> <a href=../../../../sql-reference/aggregate-functions/reference/stochasticlinearregression/ title=stochasticLinearRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLinearRegression</a> <a href=../../../../sql-reference/aggregate-functions/reference/stochasticlogisticregression/ title=stochasticLogisticRegression class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLogisticRegression</a> <a href=../../../../sql-reference/aggregate-functions/reference/studentttest/ title=studentTTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">studentTTest</a> <a href=../../../../sql-reference/aggregate-functions/reference/welchttest/ title=welchTTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">welchTTest</a> <a href=../../../../sql-reference/aggregate-functions/reference/mannwhitneyutest/ title=mannWhitneyUTest class="nav-link text-light text-wrap d-inline-block w-100 px-0">mannWhitneyUTest</a> <a href=../../../../sql-reference/aggregate-functions/reference/median/ title=median class="nav-link text-light text-wrap d-inline-block w-100 px-0">median</a> </nav> </div> <a href=../../../../sql-reference/aggregate-functions/combinators/ title="Комбинаторы агрегатных функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Комбинаторы агрегатных функций</a> <a href=../../../../sql-reference/aggregate-functions/parametric-functions/ title="Параметрические агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Параметрические агрегатные функции</a> </nav> </div> <a href=#sidebar-sidebar-5-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-7 title="Табличные функции" class="nav-link text-light dropdown-toggle px-0">Табличные функции</a> <div id=sidebar-sidebar-5-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/table-functions/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../sql-reference/table-functions/file/ title=file class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a> <a href=../../../../sql-reference/table-functions/merge/ title=merge class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a> <a href=../../../../sql-reference/table-functions/numbers/ title=numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a> <a href=../../../../sql-reference/table-functions/remote/ title=remote class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a> <a href=../../../../sql-reference/table-functions/url/ title=url class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a> <a href=../../../../sql-reference/table-functions/mysql/ title=mysql class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a> <a href=../../../../sql-reference/table-functions/postgresql/ title=postgresql class="nav-link text-light text-wrap d-inline-block w-100 px-0">postgresql</a> <a href=../../../../sql-reference/table-functions/jdbc/ title=jdbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a> <a href=../../../../sql-reference/table-functions/odbc/ title=odbc class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a> <a href=../../../../sql-reference/table-functions/hdfs/ title=hdfs class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a> <a href=../../../../sql-reference/table-functions/s3/ title=s3 class="nav-link text-light text-wrap d-inline-block w-100 px-0">s3</a> <a href=../../../../sql-reference/table-functions/input/ title=input class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a> <a href=../../../../sql-reference/table-functions/generate/ title=generateRandom class="nav-link text-light text-wrap d-inline-block w-100 px-0">generateRandom</a> <a href=../../../../sql-reference/table-functions/cluster/ title=cluster class="nav-link text-light text-wrap d-inline-block w-100 px-0">cluster</a> <a href=../../../../sql-reference/table-functions/null/ title="null функция" class="nav-link text-light text-wrap d-inline-block w-100 px-0">null функция</a> <a href=../../../../sql-reference/table-functions/dictionary/ title=dictionary class="nav-link text-light text-wrap d-inline-block w-100 px-0">dictionary</a> <a href=../../../../sql-reference/table-functions/view/ title=view class="nav-link text-light text-wrap d-inline-block w-100 px-0">view</a> </nav> </div> <a href=#sidebar-sidebar-5-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8 title=Словари class="nav-link text-light dropdown-toggle px-0">Словари</a> <div id=sidebar-sidebar-5-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/dictionaries/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=#sidebar-sidebar-5-8-2 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-8-2 title="Внешние словари" class="nav-link text-light dropdown-toggle px-0">Внешние словари</a> <div id=sidebar-sidebar-5-8-2 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts/ title="Внешние словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние словари</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict/ title="Настройка внешнего словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройка внешнего словаря</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/ title="Хранение словарей в памяти" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение словарей в памяти</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-lifetime/ title="Обновление словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление словарей</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources/ title="Источники внешних словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Источники внешних словарей</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-structure/ title="Ключ и поля словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ключ и поля словаря</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-hierarchical/ title="Иерархические словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Иерархические словари</a> <a href=../../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-polygon/ title="Cловари полигонов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Cловари полигонов</a> </nav> </div> <a href=../../../../sql-reference/dictionaries/internal-dicts/ title="Встроенные словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Встроенные словари</a> </nav> </div> <a href=#sidebar-sidebar-5-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9 title="Типы данных" class="nav-link text-light dropdown-toggle px-0">Типы данных</a> <div id=sidebar-sidebar-5-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/data-types/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../sql-reference/data-types/int-uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a> <a href=../../../../sql-reference/data-types/float/ title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a> <a href=../../../../sql-reference/data-types/decimal/ title=Decimal class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a> <a href=../../../../sql-reference/data-types/boolean/ title="Булевы значения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Булевы значения</a> <a href=../../../../sql-reference/data-types/string/ title=String class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a> <a href=../../../../sql-reference/data-types/fixedstring/ title=FixedString(N) class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a> <a href=../../../../sql-reference/data-types/uuid/ title=UUID class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a> <a href=../../../../sql-reference/data-types/date/ title=Date class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a> <a href=../../../../sql-reference/data-types/datetime/ title=DateTime class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a> <a href=../../../../sql-reference/data-types/datetime64/ title=DateTime64 class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime64</a> <a href=../../../../sql-reference/data-types/enum/ title=Enum class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a> <a href=../../../../sql-reference/data-types/lowcardinality/ title=LowCardinality class="nav-link text-light text-wrap d-inline-block w-100 px-0">LowCardinality</a> <a href=../../../../sql-reference/data-types/array/ title=Array(T) class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a> <a href=../../../../sql-reference/data-types/aggregatefunction/ title=AggregateFunction class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction</a> <a href=../../../../sql-reference/data-types/tuple/ title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a> <a href=#sidebar-sidebar-5-9-17 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9-17 title="Вложенные структуры данных" class="nav-link text-light dropdown-toggle px-0">Вложенные структуры данных</a> <div id=sidebar-sidebar-5-9-17 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/data-types/nested-data-structures/nested/ title="Nested(Name1 Type1, Name2 Type2, …)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested(Name1 Type1, Name2 Type2, …)</a> </nav> </div> <a href=../../../../sql-reference/data-types/nullable/ title=Nullable class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a> <a href=#sidebar-sidebar-5-9-19 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9-19 title="Служебные типы данных" class="nav-link text-light dropdown-toggle px-0">Служебные типы данных</a> <div id=sidebar-sidebar-5-9-19 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/data-types/special-data-types/expression/ title=Expression class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a> <a href=../../../../sql-reference/data-types/special-data-types/set/ title=Set class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a> <a href=../../../../sql-reference/data-types/special-data-types/nothing/ title=Nothing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a> <a href=../../../../sql-reference/data-types/special-data-types/interval/ title=Interval class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interval</a> </nav> </div> <a href=#sidebar-sidebar-5-9-20 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-9-20 title=Домены class="nav-link text-light dropdown-toggle px-0">Домены</a> <div id=sidebar-sidebar-5-9-20 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/data-types/domains/ title=Домены class="nav-link text-light text-wrap d-inline-block w-100 px-0">Домены</a> <a href=../../../../sql-reference/data-types/domains/ipv4/ title=IPv4 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a> <a href=../../../../sql-reference/data-types/domains/ipv6/ title=IPv6 class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a> </nav> </div> <a href=../../../../sql-reference/data-types/multiword-types/ title="Составные типы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Составные типы</a> <a href=../../../../sql-reference/data-types/geo/ title="Географические структуры" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Географические структуры</a> <a href=../../../../sql-reference/data-types/map/ title="Map(key, value)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Map(key, value)</a> <a href=../../../../sql-reference/data-types/simpleaggregatefunction/ title="SimpleAggregateFunction(func, type)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SimpleAggregateFunction(func, type)</a> </nav> </div> <a href=#sidebar-sidebar-5-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-5-10 title=Операторы class="nav-link text-light dropdown-toggle px-0">Операторы</a> <div id=sidebar-sidebar-5-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../sql-reference/operators/ title=Операторы class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы</a> <a href=../../../../sql-reference/operators/in/ title="Операторы IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы IN</a> </nav> </div> <a href=../../../../sql-reference/ansi/ title="ANSI Compatibility" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ANSI Compatibility</a> </nav> </div> <a href=#sidebar-sidebar-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-6 title=Руководства class="nav-link text-light dropdown-toggle px-0">Руководства</a> <div id=sidebar-sidebar-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../guides/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../../../guides/apply-catboost-model/ title="Применение модели CatBoost в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение модели CatBoost в ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-7 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7 title=Эксплуатация class="nav-link text-light dropdown-toggle px-0">Эксплуатация</a> <div id=sidebar-sidebar-7 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/ title=Эксплуатация class="nav-link text-light text-wrap d-inline-block w-100 px-0">Эксплуатация</a> <a href=../../../../operations/requirements/ title=Требования class="nav-link text-light text-wrap d-inline-block w-100 px-0">Требования</a> <a href=../../../../operations/monitoring/ title=Мониторинг class="nav-link text-light text-wrap d-inline-block w-100 px-0">Мониторинг</a> <a href=../../../../operations/troubleshooting/ title="Устранение неисправностей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Устранение неисправностей</a> <a href=../../../../operations/update/ title="Обновление ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление ClickHouse</a> <a href=#sidebar-sidebar-7-6 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-6 title="Внешние аутентификаторы пользователей и каталоги" class="nav-link text-light dropdown-toggle px-0">Внешние аутентификаторы пользователей и каталоги</a> <div id=sidebar-sidebar-7-6 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/external-authenticators/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../operations/external-authenticators/kerberos/ title=Kerberos class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kerberos</a> <a href=../../../../operations/external-authenticators/ldap/ title=LDAP class="nav-link text-light text-wrap d-inline-block w-100 px-0">LDAP</a> </nav> </div> <a href=../../../../operations/access-rights/ title="Управление доступом" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Управление доступом</a> <a href=../../../../operations/backup/ title="Резервное копирование данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Резервное копирование данных</a> <a href=../../../../operations/configuration-files/ title="Конфигурационные файлы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные файлы</a> <a href=../../../../operations/quotas/ title=Квоты class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квоты</a> <a href=#sidebar-sidebar-7-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-11 title="Optimizing Performance" class="nav-link text-light dropdown-toggle px-0">Optimizing Performance</a> <div id=sidebar-sidebar-7-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/optimizing-performance/sampling-query-profiler/ title="Query Profiling" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Query Profiling</a> </nav> </div> <a href=#sidebar-sidebar-7-12 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-12 title="Системные таблицы" class="nav-link text-light dropdown-toggle px-0">Системные таблицы</a> <div id=sidebar-sidebar-7-12 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/system-tables/ title="Системные таблицы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Системные таблицы</a> <a href=../../../../operations/system-tables/asynchronous_metric_log/ title=system.asynchronous_metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.asynchronous_metric_log</a> <a href=../../../../operations/system-tables/asynchronous_metrics/ title=system.asynchronous_metrics class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.asynchronous_metrics</a> <a href=../../../../operations/system-tables/clusters/ title=system.clusters class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.clusters</a> <a href=../../../../operations/system-tables/columns/ title=system.columns class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.columns</a> <a href=../../../../operations/system-tables/contributors/ title=system.contributors class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.contributors</a> <a href=../../../../operations/system-tables/crash-log/ title=system.crash_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.crash_log</a> <a href=../../../../operations/system-tables/current-roles/ title=system.current_roles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.current_roles</a> <a href=../../../../operations/system-tables/data_type_families/ title=system.data_type_families class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.data_type_families</a> <a href=../../../../operations/system-tables/databases/ title=system.databases class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.databases</a> <a href=../../../../operations/system-tables/detached_parts/ title=system.detached_parts class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.detached_parts</a> <a href=../../../../operations/system-tables/dictionaries/ title=system.dictionaries class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.dictionaries</a> <a href=../../../../operations/system-tables/disks/ title=system.disks class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.disks</a> <a href=../../../../operations/system-tables/distributed_ddl_queue/ title=system.distributed_ddl_queue class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.distributed_ddl_queue</a> <a href=../../../../operations/system-tables/distribution_queue/ title=system.distribution_queue class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.distribution_queue</a> <a href=../../../../operations/system-tables/enabled-roles/ title=system.enabled_roles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.enabled_roles</a> <a href=../../../../operations/system-tables/errors/ title=system.errors class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.errors</a> <a href=../../../../operations/system-tables/events/ title=system.events class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.events</a> <a href=../../../../operations/system-tables/functions/ title=system.functions class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.functions</a> <a href=../../../../operations/system-tables/grants/ title=system.grants class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.grants</a> <a href=../../../../operations/system-tables/graphite_retentions/ title=system.graphite_retentions class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.graphite_retentions</a> <a href=../../../../operations/system-tables/licenses/ title=system.licenses class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.licenses</a> <a href=../../../../operations/system-tables/merges/ title=system.merges class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.merges</a> <a href=../../../../operations/system-tables/metric_log/ title=system.metric_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.metric_log</a> <a href=../../../../operations/system-tables/metrics/ title=system.metrics class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.metrics</a> <a href=../../../../operations/system-tables/mutations/ title=system.mutations class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.mutations</a> <a href=../../../../operations/system-tables/numbers/ title=system.numbers class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.numbers</a> <a href=../../../../operations/system-tables/numbers_mt/ title=system.numbers_mt class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.numbers_mt</a> <a href=../../../../operations/system-tables/one/ title=system.one class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.one</a> <a href=../../../../operations/system-tables/opentelemetry_span_log/ title=system.opentelemetry_span_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.opentelemetry_span_log</a> <a href=../../../../operations/system-tables/part_log/ title=system.part_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.part_log</a> <a href=../../../../operations/system-tables/parts/ title=system.parts class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.parts</a> <a href=../../../../operations/system-tables/parts_columns/ title=system.parts_columns class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.parts_columns</a> <a href=../../../../operations/system-tables/processes/ title=system.processes class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.processes</a> <a href=../../../../operations/system-tables/query_log/ title=system.query_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_log</a> <a href=../../../../operations/system-tables/query_thread_log/ title=system.query_thread_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_thread_log</a> <a href=../../../../operations/system-tables/quota_limits/ title=system.quota_limits class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quota_limits</a> <a href=../../../../operations/system-tables/quota_usage/ title=system.quota_usage class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quota_usage</a> <a href=../../../../operations/system-tables/quotas/ title=system.quotas class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quotas</a> <a href=../../../../operations/system-tables/quotas_usage/ title=system.quotas_usage class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quotas_usage</a> <a href=../../../../operations/system-tables/replicas/ title=system.replicas class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replicas</a> <a href=../../../../operations/system-tables/replicated_fetches/ title=system.replicated_fetches class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replicated_fetches</a> <a href=../../../../operations/system-tables/replication_queue/ title=system.replication_queue class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replication_queue</a> <a href=../../../../operations/system-tables/role-grants/ title=system.role_grants class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.role_grants</a> <a href=../../../../operations/system-tables/roles/ title=system.roles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.roles</a> <a href=../../../../operations/system-tables/row_policies/ title=system.row_policies class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.row_policies</a> <a href=../../../../operations/system-tables/settings/ title=system.settings class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings</a> <a href=../../../../operations/system-tables/settings_profile_elements/ title=system.settings_profile_elements class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings_profile_elements</a> <a href=../../../../operations/system-tables/settings_profiles/ title=system.settings_profiles class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings_profiles</a> <a href=../../../../operations/system-tables/stack_trace/ title=system.stack_trace class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.stack_trace</a> <a href=../../../../operations/system-tables/storage_policies/ title=system.storage_policies class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.storage_policies</a> <a href=../../../../operations/system-tables/table_engines/ title=system.table_engines class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.table_engines</a> <a href=../../../../operations/system-tables/tables/ title=system.tables class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.tables</a> <a href=../../../../operations/system-tables/text_log/ title=system.text_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.text_log</a> <a href=../../../../operations/system-tables/trace_log/ title=system.trace_log class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.trace_log</a> <a href=../../../../operations/system-tables/users/ title=system.users class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.users</a> <a href=../../../../operations/system-tables/zookeeper/ title=system.zookeeper class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.zookeeper</a> </nav> </div> <a href=../../../../operations/performance-test/ title="Testing Hardware" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Testing Hardware</a> <a href=#sidebar-sidebar-7-14 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-14 title="Конфигурационные параметры сервера" class="nav-link text-light dropdown-toggle px-0">Конфигурационные параметры сервера</a> <div id=sidebar-sidebar-7-14 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/server-configuration-parameters/ title=Введение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a> <a href=../../../../operations/server-configuration-parameters/settings/ title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные параметры сервера</a> </nav> </div> <a href=#sidebar-sidebar-7-15 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-15 title=Settings class="nav-link text-light dropdown-toggle px-0">Settings</a> <div id=sidebar-sidebar-7-15 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/settings/ title=Introduction class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a> <a href=../../../../operations/settings/permissions-for-queries/ title="Разрешения для запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разрешения для запросов</a> <a href=../../../../operations/settings/query-complexity/ title="Ограничения на сложность запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на сложность запроса</a> <a href=../../../../operations/settings/settings/ title=Настройки class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки</a> <a href=../../../../operations/settings/settings-profiles/ title="Профили настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профили настроек</a> <a href=../../../../operations/settings/constraints-on-settings/ title="Ограничения на изменение настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на изменение настроек</a> <a href=../../../../operations/settings/settings-users/ title="Настройки пользователей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки пользователей</a> <a href=../../../../operations/settings/merge-tree-settings/ title="Настройки MergeTree таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки MergeTree таблиц</a> </nav> </div> <a href=#sidebar-sidebar-7-16 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-7-16 title=Утилиты class="nav-link text-light dropdown-toggle px-0">Утилиты</a> <div id=sidebar-sidebar-7-16 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../operations/utilities/ title=Обзор class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a> <a href=../../../../operations/utilities/clickhouse-copier/ title=clickhouse-copier class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a> <a href=../../../../operations/utilities/clickhouse-local/ title=clickhouse-local class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a> <a href=../../../../operations/utilities/clickhouse-benchmark/ title=clickhouse-benchmark class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-benchmark</a> <a href=../../../../operations/utilities/clickhouse-format/ title=clickhouse-format class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-format</a> <a href=../../../../operations/utilities/clickhouse-compressor/ title="ClickHouse compressor" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse compressor</a> <a href=../../../../operations/utilities/odbc-bridge/ title=clickhouse-odbc-bridge class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-odbc-bridge</a> <a href=../../../../operations/utilities/clickhouse-obfuscator/ title="Обфускатор ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обфускатор ClickHouse</a> </nav> </div> <a href=../../../../operations/tips/ title="Usage Recommendations" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Usage Recommendations</a> <a href=../../../../operations/opentelemetry/ title="Поддержка OpenTelemetry" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поддержка OpenTelemetry</a> <a href=../../../../operations/caches/ title=Кеши class="nav-link text-light text-wrap d-inline-block w-100 px-0">Кеши</a> </nav> </div> <a href=#sidebar-sidebar-8 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-8 title=Development class="nav-link text-light dropdown-toggle px-0">Development</a> <div id=sidebar-sidebar-8 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../development/developer-instruction/ title="Инструкция для разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Инструкция для разработчиков</a> <a href=../../../../development/architecture/ title="Обзор архитектуры ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор архитектуры ClickHouse</a> <a href=../../../../development/build/ title="Build on Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux</a> <a href=../../../../development/build-osx/ title="Build on Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Mac OS X</a> <a href=../../../../development/build-cross-osx/ title="Build on Linux for Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux for Mac OS X</a> <a href=../../../../development/build-cross-arm/ title="Build on Linux for AARCH64 (ARM64)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux for AARCH64 (ARM64)</a> <a href=../../../../development/style/ title="Как писать код на C++" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как писать код на C++</a> <a href=../../../../development/tests/ title=Testing class="nav-link text-light text-wrap d-inline-block w-100 px-0">Testing</a> <a href=../../../../development/contrib/ title="Используемые сторонние библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Используемые сторонние библиотеки</a> <a href=../../../../development/browse-code/ title="Навигация по коду ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Навигация по коду ClickHouse</a> </nav> </div> <a href=#sidebar-sidebar-9 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-9 title="Коммерческие услуги" class="nav-link text-light dropdown-toggle px-0">Коммерческие услуги</a> <div id=sidebar-sidebar-9 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../commercial/cloud/ title="Поставщики облачных услуг ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поставщики облачных услуг ClickHouse</a> <a href=../../../../commercial/support/ title=Support class="nav-link text-light text-wrap d-inline-block w-100 px-0">Support</a> <a href=../../../../commercial/ title="Коммерческие услуги" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Коммерческие услуги</a> </nav> </div> <a href=#sidebar-sidebar-10 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-10 title=F.A.Q. class="nav-link text-light dropdown-toggle px-0">F.A.Q.</a> <div id=sidebar-sidebar-10 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../faq/general/ title="Общие вопросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общие вопросы</a> <a href=../../../../faq/use-cases/ title=Применение class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение</a> <a href=../../../../faq/operations/ title=Операции class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операции</a> <a href=../../../../faq/integration/ title=Интеграция class="nav-link text-light text-wrap d-inline-block w-100 px-0">Интеграция</a> </nav> </div> <a href=#sidebar-sidebar-11 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11 title="Что нового?" class="nav-link text-light dropdown-toggle px-0">Что нового?</a> <div id=sidebar-sidebar-11 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=#sidebar-sidebar-11-1 data-toggle=collapse aria-expanded=false aria-controls=sidebar-sidebar-11-1 title=Changelog class="nav-link text-light dropdown-toggle px-0">Changelog</a> <div id=sidebar-sidebar-11-1 class="nav flex-column collapse"> <nav class="nav flex-column pl-2"> <a href=../../../../whats-new/changelog/ title=2021 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2021</a> <a href=../../../../whats-new/changelog/2019/ title=2019 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2019</a> <a href=../../../../whats-new/changelog/2018/ title=2018 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2018</a> <a href=../../../../whats-new/changelog/2017/ title=2017 class="nav-link text-light text-wrap d-inline-block w-100 px-0">2017</a> </nav> </div> <a href=../../../../whats-new/extended-roadmap/ title=Roadmap class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a> <a href=../../../../whats-new/security-changelog/ title="Security Changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security Changelog</a> <a href=../../../../whats-new/ title="Что нового в ClickHouse?" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Что нового в ClickHouse?</a> </nav> </div> <a href=../../../../single/clickhouse_ru.pdf class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light"> <img src=/images/mkdocs/pdf.svg alt="PDF version" title="PDF version" height=24 class="d-block mr-1 float-left"><div>PDF version</div> </a> </nav> </div> </div> <div id=content-wrapper class="col-md-8 p-2 p-md-4"> <div id=content class=mt-md-n3> <nav class=text-muted aria-label=breadcrumb> <ol class="breadcrumb bg-transparent p-0"> <li class=breadcrumb-item><a href=../../../ class=text-reset>Engines</a> </li> <li class=breadcrumb-item><a href=../../ class=text-reset>Движки таблиц</a> </li> <li class=breadcrumb-item><a href=../ class=text-reset>MergeTree Family</a> </li> </ol> </nav> <h1 id=table_engines-mergetree>MergeTree<a class=headerlink href=#table_engines-mergetree title="Permanent link"> </a></h1> <p>Движок <code class=syntax>MergeTree</code>, а также другие движки этого семейства (<code class=syntax>*MergeTree</code>) — это наиболее функциональные движки таблиц ClickHouse.</p> <p>Основная идея, заложенная в основу движков семейства <code class=syntax>MergeTree</code> следующая. Когда у вас есть огромное количество данных, которые должны быть вставлены в таблицу, вы должны быстро записать их по частям, а затем объединить части по некоторым правилам в фоновом режиме. Этот метод намного эффективнее, чем постоянная перезапись данных в хранилище при вставке.</p> <p>Основные возможности:</p> <ul> <li> <p><strong>Хранит данные, отсортированные по первичному ключу.</strong> Это позволяет создавать разреженный индекс небольшого объёма, который позволяет быстрее находить данные.</p> </li> <li> <p><strong>Позволяет оперировать партициями, если задан <a href=../custom-partitioning-key/ >ключ партиционирования</a>.</strong> ClickHouse поддерживает отдельные операции с партициями, которые работают эффективнее, чем общие операции с этим же результатом над этими же данными. Также, ClickHouse автоматически отсекает данные по партициям там, где ключ партиционирования указан в запросе. Это также увеличивает эффективность выполнения запросов.</p> </li> <li> <p><strong>Поддерживает репликацию данных.</strong> Для этого используется семейство таблиц <code class=syntax>ReplicatedMergeTree</code>. Подробнее читайте в разделе <a href=../replication/ >Репликация данных</a>.</p> </li> <li> <p><strong>Поддерживает сэмплирование данных.</strong> При необходимости можно задать способ сэмплирования данных в таблице.</p> </li> </ul> <div class="admonition info alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Info</p> <p>Движок <a class=alert-link href=../../special/merge/#merge>Merge</a> не относится к семейству <code class=syntax>*MergeTree</code>.</p> </div> <h2 id=table_engine-mergetree-creating-a-table>Создание таблицы<a class=headerlink href=#table_engine-mergetree-creating-a-table title="Permanent link"> </a></h2> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>]</span> <span class=p>[</span><span class=n>TTL</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>index_name1</span> <span class=n>expr1</span> <span class=k>TYPE</span> <span class=n>type1</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value1</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>index_name2</span> <span class=n>expr2</span> <span class=k>TYPE</span> <span class=n>type2</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>value2</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>expr</span>
<span class=p>[</span><span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>expr</span><span class=p>]</span>
<span class=p>[</span><span class=n>TTL</span> <span class=n>expr</span>
    <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'xxx'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'xxx'</span> <span class=p>[,</span> <span class=p>...]</span> <span class=p>]</span>
    <span class=p>[</span><span class=k>WHERE</span> <span class=n>conditions</span><span class=p>]</span>
    <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span> <span class=n>key_expr</span> <span class=p>[</span><span class=k>SET</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v1</span><span class=p>)</span> <span class=p>[,</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span> <span class=p>...]]</span> <span class=p>]</span> <span class=p>]</span>
<span class=p>[</span><span class=n>SETTINGS</span> <span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span> <span class=p>...]</span>
</code></pre></div> <p>Описание параметров смотрите в <a href=./ >описании запроса CREATE</a>.</p> <h3 id=mergetree-query-clauses>Секции запроса<a class=headerlink href=#mergetree-query-clauses title="Permanent link"> </a></h3> <ul> <li> <p><code class=syntax>ENGINE</code> — имя и параметры движка. <code class=syntax>ENGINE = MergeTree()</code>. <code class=syntax>MergeTree</code> не имеет параметров.</p> </li> <li> <p><code class=syntax>ORDER BY</code> — ключ сортировки.</p> <p>Кортеж столбцов или произвольных выражений. Пример: <code class=syntax>ORDER BY (CounterID, EventDate)</code>.</p> <p>ClickHouse использует ключ сортировки в качестве первичного ключа, если первичный ключ не задан в секции <code class=syntax>PRIMARY KEY</code>.</p> <p>Чтобы отключить сортировку, используйте синтаксис <code class=syntax>ORDER BY tuple()</code>. Смотрите <a href=#primary-keys-and-indexes-in-queries>выбор первичного ключа</a>.</p> </li> <li> <p><code class=syntax>PARTITION BY</code> — <a href=../custom-partitioning-key/ >ключ партиционирования</a>. Необязательный параметр.</p> <p>Для партиционирования по месяцам используйте выражение <code class=syntax>toYYYYMM(date_column)</code>, где <code class=syntax>date_column</code> — столбец с датой типа <a href=./ >Date</a>. В этом случае имена партиций имеют формат <code class=syntax>"YYYYMM"</code>.</p> </li> <li> <p><code class=syntax>PRIMARY KEY</code> — первичный ключ, если он <a href=#choosing-a-primary-key-that-differs-from-the-sorting-key>отличается от ключа сортировки</a>. Необязательный параметр.</p> <p>По умолчанию первичный ключ совпадает с ключом сортировки (который задаётся секцией <code class=syntax>ORDER BY</code>.) Поэтому в большинстве случаев секцию <code class=syntax>PRIMARY KEY</code> отдельно указывать не нужно.</p> </li> <li> <p><code class=syntax>SAMPLE BY</code> — выражение для сэмплирования. Необязательный параметр.</p> <p>Если используется выражение для сэмплирования, то первичный ключ должен содержать его. Пример: <code class=syntax>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p> </li> <li> <p><code class=syntax>TTL</code> — список правил, определяющих длительности хранения строк, а также задающих правила перемещения частей на определённые тома или диски. Необязательный параметр.</p> <p>Выражение должно возвращать столбец <code class=syntax>Date</code> или <code class=syntax>DateTime</code>. Пример: <code class=syntax>TTL date + INTERVAL 1 DAY</code>.</p> <p>Тип правила <code class=syntax>DELETE|TO DISK 'xxx'|TO VOLUME 'xxx'|GROUP BY</code> указывает действие, которое будет выполнено с частью: удаление строк (прореживание), перемещение (при выполнении условия для всех строк части) на определённый диск (<code class=syntax>TO DISK 'xxx'</code>) или том (<code class=syntax>TO VOLUME 'xxx'</code>), или агрегирование данных в устаревших строках. Поведение по умолчанию соответствует удалению строк (<code class=syntax>DELETE</code>). В списке правил может быть указано только одно выражение с поведением <code class=syntax>DELETE</code>.</p> <p>Дополнительные сведения смотрите в разделе <a href=#table_engine-mergetree-ttl>TTL для столбцов и таблиц</a></p> </li> <li> <p><code class=syntax>SETTINGS</code> — дополнительные параметры, регулирующие поведение <code class=syntax>MergeTree</code> (необязательные):</p> <ul> <li><code class=syntax>index_granularity</code> — максимальное количество строк данных между засечками индекса. По умолчанию — 8192. Смотрите <a href=#mergetree-data-storage>Хранение данных</a>.</li> <li><code class=syntax>index_granularity_bytes</code> — максимальный размер гранул данных в байтах. По умолчанию — 10Mb. Чтобы ограничить размер гранул только количеством строк, установите значение 0 (не рекомендовано). Смотрите <a href=#mergetree-data-storage>Хранение данных</a>.</li> <li><code class=syntax>min_index_granularity_bytes</code> — минимально допустимый размер гранул данных в байтах. Значение по умолчанию — 1024b. Для обеспечения защиты от случайного создания таблиц с очень низким значением <code class=syntax>index_granularity_bytes</code>. Смотрите <a href=#mergetree-data-storage>Хранение данных</a>.</li> <li><code class=syntax>enable_mixed_granularity_parts</code> — включает или выключает переход к ограничению размера гранул с помощью настройки <code class=syntax>index_granularity_bytes</code>. Настройка <code class=syntax>index_granularity_bytes</code> улучшает производительность ClickHouse при выборке данных из таблиц с большими (десятки и сотни мегабайтов) строками. Если у вас есть таблицы с большими строками, можно включить эту настройку, чтобы повысить эффективность запросов <code class=syntax>SELECT</code>.</li> <li><code class=syntax>use_minimalistic_part_header_in_zookeeper</code> — Способ хранения заголовков кусков данных в ZooKeeper. Если <code class=syntax>use_minimalistic_part_header_in_zookeeper = 1</code>, то ZooKeeper хранит меньше данных. Подробнее читайте в <a href=../../../../operations/server-configuration-parameters/settings/#server-settings-use_minimalistic_part_header_in_zookeeper>описании настройки</a> в разделе "Конфигурационные параметры сервера".</li> <li><code class=syntax>min_merge_bytes_to_use_direct_io</code> — минимальный объём данных при слиянии, необходимый для прямого (небуферизованного) чтения/записи (direct I/O) на диск. При слиянии частей данных ClickHouse вычисляет общий объём хранения всех данных, подлежащих слиянию. Если общий объём хранения всех данных для чтения превышает <code class=syntax>min_bytes_to_use_direct_io</code> байт, тогда ClickHouse использует флаг <code class=syntax>O_DIRECT</code> при чтении данных с диска. Если <code class=syntax>min_merge_bytes_to_use_direct_io = 0</code>, тогда прямой ввод-вывод отключен. Значение по умолчанию: <code class=syntax>10 * 1024 * 1024 * 1024</code> байтов.</li> <li><a name=mergetree_setting-merge_with_ttl_timeout></a><code class=syntax>merge_with_ttl_timeout</code> — минимальное время в секундах перед повторным слиянием с TTL. По умолчанию — 86400 (1 день).</li> <li><code class=syntax>write_final_mark</code> — включает или отключает запись последней засечки индекса в конце куска данных, указывающей за последний байт. По умолчанию — 1. Не отключайте её.</li> <li><code class=syntax>merge_max_block_size</code> — максимальное количество строк в блоке для операций слияния. Значение по умолчанию: 8192.</li> <li><code class=syntax>storage_policy</code> — политика хранения данных. Смотрите <a href=#table_engine-mergetree-multiple-volumes>Хранение данных таблицы на нескольких блочных устройствах</a>.</li> <li><code class=syntax>min_bytes_for_wide_part</code>, <code class=syntax>min_rows_for_wide_part</code> — минимальное количество байт/строк в куске данных для хранения в формате <code class=syntax>Wide</code>. Можно задать одну или обе настройки или не задавать ни одной. Подробнее см. в разделе <a href=#mergetree-data-storage>Хранение данных</a>.</li> <li><code class=syntax>max_parts_in_total</code> — максимальное количество кусков во всех партициях.</li> <li><code class=syntax>max_compress_block_size</code> — максимальный размер блоков несжатых данных перед сжатием для записи в таблицу. Вы также можете задать этот параметр в глобальных настройках (смотрите <a href=../../../../operations/settings/settings/#max-compress-block-size>max_compress_block_size</a>). Настройка, которая задается при создании таблицы, имеет более высокий приоритет, чем глобальная.</li> <li><code class=syntax>min_compress_block_size</code> — минимальный размер блоков несжатых данных, необходимых для сжатия при записи следующей засечки. Вы также можете задать этот параметр в глобальных настройках (смотрите <a href=../../../../operations/settings/settings/#min-compress-block-size>min_compress_block_size</a>). Настройка, которая задается при создании таблицы, имеет более высокий приоритет, чем глобальная.</li> <li><code class=syntax>max_partitions_to_read</code> — Ограничивает максимальное число партиций для чтения в одном запросе. Также возможно указать настройку <a href=../../../../operations/settings/merge-tree-settings/#max-partitions-to-read>max_partitions_to_read</a> в глобальных настройках.</li> </ul> </li> </ul> <p><strong>Пример задания секций</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span> <span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>))</span> <span class=n>SAMPLE</span> <span class=k>BY</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>index_granularity</span><span class=o>=</span><span class=mi>8192</span>
</code></pre></div> <p>В примере мы устанавливаем партиционирование по месяцам.</p> <p>Также мы задаем выражение для сэмплирования в виде хэша по идентификатору посетителя. Это позволяет псевдослучайным образом перемешать данные в таблице для каждого <code class=syntax>CounterID</code> и <code class=syntax>EventDate</code>. Если при выборке данных задать секцию <a href=./#select-sample-clause>SAMPLE</a>, то ClickHouse вернёт равномерно-псевдослучайную выборку данных для подмножества посетителей.</p> <p><code class=syntax>index_granularity</code> можно было не указывать, поскольку 8192 — это значение по умолчанию.</p> <details><summary>Устаревший способ создания таблицы</summary> <p></p> <div class="admonition attention alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Attention</p> <p>Не используйте этот способ в новых проектах и по возможности переведите старые проекты на способ, описанный выше.</p> </div> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=p>[</span><span class=k>IF</span> <span class=k>NOT</span> <span class=k>EXISTS</span><span class=p>]</span> <span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span> <span class=p>[</span><span class=k>ON</span> <span class=k>CLUSTER</span> <span class=k>cluster</span><span class=p>]</span>
<span class=p>(</span>
    <span class=n>name1</span> <span class=p>[</span><span class=n>type1</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr1</span><span class=p>],</span>
    <span class=n>name2</span> <span class=p>[</span><span class=n>type2</span><span class=p>]</span> <span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span> <span class=n>expr2</span><span class=p>],</span>
    <span class=p>...</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=p>[</span><span class=o>=</span><span class=p>]</span> <span class=n>MergeTree</span><span class=p>(</span><span class=nb>date</span><span class=o>-</span><span class=k>column</span> <span class=p>[,</span> <span class=n>sampling_expression</span><span class=p>],</span> <span class=p>(</span><span class=k>primary</span><span class=p>,</span> <span class=k>key</span><span class=p>),</span> <span class=n>index_granularity</span><span class=p>)</span>
</code></pre></div> <p><strong>Параметры MergeTree()</strong></p> <ul> <li><code class=syntax>date-column</code> — имя столбца с типом <a href=./ >Date</a>. На основе этого столбца ClickHouse автоматически создаёт партиции по месяцам. Имена партиций имеют формат <code class=syntax>"YYYYMM"</code>.</li> <li><code class=syntax>sampling_expression</code> — выражение для сэмплирования.</li> <li><code class=syntax>(primary, key)</code> — первичный ключ. Тип — <a href=./ >Tuple()</a></li> <li><code class=syntax>index_granularity</code> — гранулярность индекса. Число строк данных между «засечками» индекса. Для большинства задач подходит значение 8192.</li> </ul> <p><strong>Пример</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>MergeTree</span><span class=p>(</span><span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>,</span> <span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>)),</span> <span class=mi>8192</span><span class=p>)</span>
</code></pre></div> <p>Движок <code class=syntax>MergeTree</code> сконфигурирован таким же образом, как и в примере выше для основного способа конфигурирования движка.</p> </details> <h2 id=mergetree-data-storage>Хранение данных<a class=headerlink href=#mergetree-data-storage title="Permanent link"> </a></h2> <p>Таблица состоит из <em>кусков</em> данных (data parts), отсортированных по первичному ключу.</p> <p>При вставке в таблицу создаются отдельные куски данных, каждый из которых лексикографически отсортирован по первичному ключу. Например, если первичный ключ — <code class=syntax>(CounterID, Date)</code>, то данные в куске будут лежать в порядке <code class=syntax>CounterID</code>, а для каждого <code class=syntax>CounterID</code> в порядке <code class=syntax>Date</code>.</p> <p>Данные, относящиеся к разным партициям, разбиваются на разные куски. В фоновом режиме ClickHouse выполняет слияния (merge) кусков данных для более эффективного хранения. Куски, относящиеся к разным партициям не объединяются. Механизм слияния не гарантирует, что все строки с одинаковым первичным ключом окажутся в одном куске.</p> <p>Куски данных могут храниться в формате <code class=syntax>Wide</code> или <code class=syntax>Compact</code>. В формате <code class=syntax>Wide</code> каждый столбец хранится в отдельном файле, а в формате <code class=syntax>Compact</code> все столбцы хранятся в одном файле. Формат <code class=syntax>Compact</code> может быть полезен для повышения производительности при частом добавлении небольших объемов данных.</p> <p>Формат хранения определяется настройками движка <code class=syntax>min_bytes_for_wide_part</code> и <code class=syntax>min_rows_for_wide_part</code>. Если число байт или строк в куске данных меньше значения, указанного в соответствующей настройке, тогда этот кусок данных хранится в формате <code class=syntax>Compact</code>. В противном случае кусок данных хранится в формате <code class=syntax>Wide</code>. Если ни одна из настроек не задана, куски данных хранятся в формате <code class=syntax>Wide</code>.</p> <p>Каждый кусок данных логически делится на гранулы. Гранула — это минимальный неделимый набор данных, который ClickHouse считывает при выборке данных. ClickHouse не разбивает строки и значения и гранула всегда содержит целое число строк. Первая строка гранулы помечается значением первичного ключа для этой строки (засечка). Для каждого куска данных ClickHouse создаёт файл с засечками (индексный файл). Для каждого столбца, независимо от того, входит он в первичный ключ или нет, ClickHouse также сохраняет эти же засечки. Засечки используются для поиска данных напрямую в файлах столбцов.</p> <p>Размер гранул оганичен настройками движка <code class=syntax>index_granularity</code> и <code class=syntax>index_granularity_bytes</code>. Количество строк в грануле лежит в диапазоне <code class=syntax>[1, index_granularity]</code>, в зависимости от размера строк. Размер гранулы может превышать <code class=syntax>index_granularity_bytes</code> в том случае, когда размер единственной строки в грануле превышает значение настройки. В этом случае, размер гранулы равен размеру строки.</p> <h2 id=primary-keys-and-indexes-in-queries>Первичные ключи и индексы в запросах<a class=headerlink href=#primary-keys-and-indexes-in-queries title="Permanent link"> </a></h2> <p>Рассмотрим первичный ключ — <code class=syntax>(CounterID, Date)</code>. В этом случае сортировку и индекс можно проиллюстрировать следующим образом:</p> <div class=codehilite><pre><span></span><code class=syntax>Whole data:     [-------------------------------------------------------------------------]
CounterID:      [aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll]
Date:           [1111111222222233331233211111222222333211111112122222223111112223311122333]
Marks:           |      |      |      |      |      |      |      |      |      |      |
                a,1    a,2    a,3    b,3    e,2    e,3    g,1    h,2    i,1    i,3    l,3
Marks numbers:   0      1      2      3      4      5      6      7      8      9      10
</code></pre></div> <p>Если в запросе к данным указать:</p> <ul> <li><code class=syntax>CounterID IN ('a', 'h')</code>, то сервер читает данные в диапазонах засечек <code class=syntax>[0, 3)</code> и <code class=syntax>[6, 8)</code>.</li> <li><code class=syntax>CounterID IN ('a', 'h') AND Date = 3</code>, то сервер читает данные в диапазонах засечек <code class=syntax>[1, 3)</code> и <code class=syntax>[7, 8)</code>.</li> <li><code class=syntax>Date = 3</code>, то сервер читает данные в диапазоне засечек <code class=syntax>[1, 10]</code>.</li> </ul> <p>Примеры выше показывают, что использование индекса всегда эффективнее, чем full scan.</p> <p>Разреженный индекс допускает чтение лишних строк. При чтении одного диапазона первичного ключа, может быть прочитано до <code class=syntax>index_granularity * 2</code> лишних строк в каждом блоке данных.</p> <p>Разреженный индекс почти всегда помещаеся в оперативную память и позволяет работать с очень большим количеством строк в таблицах.</p> <p>ClickHouse не требует уникального первичного ключа. Можно вставить много строк с одинаковым первичным ключом.</p> <p>Ключ в <code class=syntax>PRIMARY KEY</code> и <code class=syntax>ORDER BY</code> может иметь тип <code class=syntax>Nullable</code>. За поддержку этой возможности отвечает настройка <a href=../../../../operations/settings/settings/#allow-nullable-key>allow_nullable_key</a>.</p> <p>При сортировке с использованием выражения <code class=syntax>ORDER BY</code> для значений <code class=syntax>NULL</code> всегда работает принцип <a href=../../../../sql-reference/statements/select/order-by/#sorting-of-special-values>NULLS_LAST</a>.</p> <h3 id=selecting-the-primary-key>Выбор первичного ключа<a class=headerlink href=#selecting-the-primary-key title="Permanent link"> </a></h3> <p>Количество столбцов в первичном ключе не ограничено явным образом. В зависимости от структуры данных в первичный ключ можно включать больше или меньше столбцов. Это может:</p> <ul> <li> <p>Увеличить эффективность индекса.</p> <p>Пусть первичный ключ — <code class=syntax>(a, b)</code>, тогда добавление ещё одного столбца <code class=syntax>c</code> повысит эффективность, если выполнены условия:</p> <ul> <li>Есть запросы с условием на столбец <code class=syntax>c</code>.</li> <li>Часто встречаются достаточно длинные (в несколько раз больше <code class=syntax>index_granularity</code>) диапазоны данных с одинаковыми значениями <code class=syntax>(a, b)</code>. Иначе говоря, когда добавление ещё одного столбца позволит пропускать достаточно длинные диапазоны данных.</li> </ul> </li> <li> <p>Улучшить сжатие данных.</p> <p>ClickHouse сортирует данные по первичному ключу, поэтому чем выше однородность, тем лучше сжатие.</p> </li> <li> <p>Обеспечить дополнительную логику при слиянии кусков данных в движках <a href=../collapsingmergetree/#table_engine-collapsingmergetree>CollapsingMergeTree</a> и <a href=../summingmergetree/ >SummingMergeTree</a>.</p> <p>В этом случае имеет смысл указать отдельный <em>ключ сортировки</em>, отличающийся от первичного ключа.</p> </li> </ul> <p>Длинный первичный ключ будет негативно влиять на производительность вставки и потребление памяти, однако на производительность ClickHouse при запросах <code class=syntax>SELECT</code> лишние столбцы в первичном ключе не влияют.</p> <p>Вы можете создать таблицу без первичного ключа, используя синтаксис <code class=syntax>ORDER BY tuple()</code>. В этом случае ClickHouse хранит данные в порядке вставки. Если вы хотите сохранить порядок данных при вставке данных с помощью запросов <code class=syntax>INSERT ... SELECT</code>, установите <a href=../../../../operations/settings/settings/#settings-max-insert-threads>max_insert_threads = 1</a>.</p> <p>Чтобы выбрать данные в первоначальном порядке, используйте<br> <a href=../../../../operations/settings/settings/#settings-max_threads>однопоточные</a> запросы `SELECT.</p> <h3 id=choosing-a-primary-key-that-differs-from-the-sorting-key>Первичный ключ, отличный от ключа сортировки<a class=headerlink href=#choosing-a-primary-key-that-differs-from-the-sorting-key title="Permanent link"> </a></h3> <p>Существует возможность задать первичный ключ (выражение, значения которого будут записаны в индексный файл для<br> каждой засечки), отличный от ключа сортировки (выражение, по которому будут упорядочены строки в кусках<br> данных). Кортеж выражения первичного ключа при этом должен быть префиксом кортежа выражения ключа<br> сортировки.</p> <p>Данная возможность особенно полезна при использовании движков <a href=../summingmergetree/ >SummingMergeTree</a><br> и <a href=../aggregatingmergetree/ >AggregatingMergeTree</a>. В типичном сценарии использования этих движков таблица<br> содержит столбцы двух типов: <em>измерения</em> (dimensions) и <em>меры</em> (measures). Типичные запросы агрегируют<br> значения столбцов-мер с произвольной группировкой и фильтрацией по измерениям. Так как <code class=syntax>SummingMergeTree</code><br> и <code class=syntax>AggregatingMergeTree</code> производят фоновую агрегацию строк с одинаковым значением ключа сортировки, приходится<br> добавлять в него все столбцы-измерения. В результате выражение ключа содержит большой список столбцов,<br> который приходится постоянно расширять при добавлении новых измерений.</p> <p>В этом сценарии имеет смысл оставить в первичном ключе всего несколько столбцов, которые обеспечат эффективную фильтрацию по индексу, а остальные столбцы-измерения добавить в выражение ключа сортировки.</p> <p><a href=./ >ALTER ключа сортировки</a> — лёгкая операция, так как при одновременном добавлении нового столбца в таблицу и ключ сортировки не нужно изменять данные кусков (они остаются упорядоченными и по новому выражению ключа).</p> <h3 id=use-of-indexes-and-partitions-in-queries>Использование индексов и партиций в запросах<a class=headerlink href=#use-of-indexes-and-partitions-in-queries title="Permanent link"> </a></h3> <p>Для запросов <code class=syntax>SELECT</code> ClickHouse анализирует возможность использования индекса. Индекс может использоваться, если в секции <code class=syntax>WHERE/PREWHERE</code>, в качестве одного из элементов конъюнкции, или целиком, есть выражение, представляющее операции сравнения на равенства, неравенства, а также <code class=syntax>IN</code> или <code class=syntax>LIKE</code> с фиксированным префиксом, над столбцами или выражениями, входящими в первичный ключ или ключ партиционирования, либо над некоторыми частично монотонными функциями от этих столбцов, а также логические связки над такими выражениями.</p> <p>Таким образом, обеспечивается возможность быстро выполнять запросы по одному или многим диапазонам первичного ключа. Например, в указанном примере будут быстро работать запросы для конкретного счётчика; для конкретного счётчика и диапазона дат; для конкретного счётчика и даты, для нескольких счётчиков и диапазона дат и т. п.</p> <p>Рассмотрим движок сконфигурированный следующим образом:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>ENGINE</span> <span class=n>MergeTree</span><span class=p>()</span> <span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>CounterID</span><span class=p>,</span> <span class=n>EventDate</span><span class=p>)</span> <span class=n>SETTINGS</span> <span class=n>index_granularity</span><span class=o>=</span><span class=mi>8192</span>
</code></pre></div> <p>В этом случае в запросах:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=n>now</span><span class=p>())</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=p>((</span><span class=n>EventDate</span> <span class=o>&gt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-01'</span><span class=p>)</span> <span class=k>AND</span> <span class=n>EventDate</span> <span class=o>&lt;=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-01-31'</span><span class=p>))</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span> <span class=k>AND</span> <span class=n>CounterID</span> <span class=k>IN</span> <span class=p>(</span><span class=mi>101500</span><span class=p>,</span> <span class=mi>731962</span><span class=p>,</span> <span class=mi>160656</span><span class=p>)</span> <span class=k>AND</span> <span class=p>(</span><span class=n>CounterID</span> <span class=o>=</span> <span class=mi>101500</span> <span class=k>OR</span> <span class=n>EventDate</span> <span class=o>!=</span> <span class=n>toDate</span><span class=p>(</span><span class=s1>'2014-05-01'</span><span class=p>))</span>
</code></pre></div> <p>ClickHouse будет использовать индекс по первичному ключу для отсечения не подходящих данных, а также ключ партиционирования по месяцам для отсечения партиций, которые находятся в не подходящих диапазонах дат.</p> <p>Запросы выше показывают, что индекс используется даже для сложных выражений. Чтение из таблицы организовано так, что использование индекса не может быть медленнее, чем full scan.</p> <p>В примере ниже индекс не может использоваться.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>CounterID</span> <span class=o>=</span> <span class=mi>34</span> <span class=k>OR</span> <span class=n>URL</span> <span class=k>LIKE</span> <span class=s1>'%upyachka%'</span>
</code></pre></div> <p>Чтобы проверить, сможет ли ClickHouse использовать индекс при выполнении запроса, используйте настройки <a href=../../../../operations/settings/settings/#settings-force_index_by_date>force_index_by_date</a> и <a href=../../../../operations/settings/settings/#settings-force_primary_key>force_primary_key</a>.</p> <p>Ключ партиционирования по месяцам обеспечивает чтение только тех блоков данных, которые содержат даты из нужного диапазона. При этом блок данных может содержать данные за многие даты (до целого месяца). В пределах одного блока данные упорядочены по первичному ключу, который может не содержать дату в качестве первого столбца. В связи с этим, при использовании запроса с указанием условия только на дату, но не на префикс первичного ключа, будет читаться данных больше, чем за одну дату.</p> <h3 id=use-of-index-for-partially-monotonic-primary-keys>Использование индекса для частично-монотонных первичных ключей<a class=headerlink href=#use-of-index-for-partially-monotonic-primary-keys title="Permanent link"> </a></h3> <p>Рассмотрим, например, дни месяца. Они образуют последовательность <a href=https://ru.wikipedia.org/wiki/Монотонная_последовательность rel="external nofollow noreferrer" target=_blank>монотонную</a> в течение одного месяца, но не монотонную на более длительных периодах. Это частично-монотонная последовательность. Если пользователь создаёт таблицу с частично-монотонным первичным ключом, ClickHouse как обычно создаёт разреженный индекс. Когда пользователь выбирает данные из такого рода таблиц, ClickHouse анализирует условия запроса. Если пользователь хочет получить данные между двумя метками индекса, и обе эти метки находятся внутри одного месяца, ClickHouse может использовать индекс в данном конкретном случае, поскольку он может рассчитать расстояние между параметрами запроса и индексными метками.</p> <p>ClickHouse не может использовать индекс, если значения первичного ключа в диапазоне параметров запроса не представляют собой монотонную последовательность. В этом случае ClickHouse использует метод полного сканирования.</p> <p>ClickHouse использует эту логику не только для последовательностей дней месяца, но и для любого частично-монотонного первичного ключа.</p> <h3 id=table_engine-mergetree-data_skipping-indexes>Индексы пропуска данных<a class=headerlink href=#table_engine-mergetree-data_skipping-indexes title="Permanent link"> </a></h3> <p>Объявление индексов при определении столбцов в запросе <code class=syntax>CREATE</code>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>index_name</span> <span class=n>expr</span> <span class=k>TYPE</span> <span class=k>type</span><span class=p>(...)</span> <span class=n>GRANULARITY</span> <span class=n>granularity_value</span>
</code></pre></div> <p>Для таблиц семейства <code class=syntax>*MergeTree</code> можно задать дополнительные индексы в секции столбцов.</p> <p>Индексы агрегируют для заданного выражения некоторые данные, а потом при <code class=syntax>SELECT</code> запросе используют для пропуска блоков данных (пропускаемый блок состоит из гранул данных в количестве равном гранулярности данного индекса), на которых секция <code class=syntax>WHERE</code> не может быть выполнена, тем самым уменьшая объём данных читаемых с диска.</p> <p><strong>Пример</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=k>table_name</span>
<span class=p>(</span>
    <span class=n>u64</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>i32</span> <span class=n>Int32</span><span class=p>,</span>
    <span class=n>s</span> <span class=n>String</span><span class=p>,</span>
    <span class=p>...</span>
    <span class=k>INDEX</span> <span class=n>a</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>3</span><span class=p>,</span>
    <span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span><span class=p>()</span>
<span class=p>...</span>
</code></pre></div> <p>Эти индексы смогут использоваться для оптимизации следующих запросов</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=s1>'z'</span>
<span class=k>SELECT</span> <span class=k>count</span><span class=p>()</span> <span class=k>FROM</span> <span class=k>table</span> <span class=k>WHERE</span> <span class=n>u64</span> <span class=o>*</span> <span class=n>i32</span> <span class=o>==</span> <span class=mi>10</span> <span class=k>AND</span> <span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1234</span>
</code></pre></div> <h4 id=available-types-of-indices>Доступные индексы<a class=headerlink href=#available-types-of-indices title="Permanent link"> </a></h4> <ul> <li> <p><code class=syntax>minmax</code> — Хранит минимум и максимум выражения (если выражение - <code class=syntax>tuple</code>, то для каждого элемента <code class=syntax>tuple</code>), используя их для пропуска блоков аналогично первичному ключу.</p> </li> <li> <p><code class=syntax>set(max_rows)</code> — Хранит уникальные значения выражения на блоке в количестве не более <code class=syntax>max_rows</code> (если <code class=syntax>max_rows = 0</code>, то ограничений нет), используя их для пропуска блоков, оценивая выполнимость <code class=syntax>WHERE</code> выражения на хранимых данных.</p> </li> <li> <p><code class=syntax>bloom_filter([false_positive])</code> — <a href=https://en.wikipedia.org/wiki/Bloom_filter rel="external nofollow noreferrer" target=_blank>фильтр Блума</a> для указанных стоблцов.</p> <p>Необязательный параметр <code class=syntax>false_positive</code> — это вероятность получения ложноположительного срабатывания. Возможные значения: (0, 1). Значение по умолчанию: 0.025.</p> <p>Поддержанные типы данных: <code class=syntax>Int*</code>, <code class=syntax>UInt*</code>, <code class=syntax>Float*</code>, <code class=syntax>Enum</code>, <code class=syntax>Date</code>, <code class=syntax>DateTime</code>, <code class=syntax>String</code>, <code class=syntax>FixedString</code>.</p> <p>Фильтром могут пользоваться функции: <a href=./ >equals</a>, <a href=./ >notEquals</a>, <a href=./ >in</a>, <a href=./ >notIn</a>.</p> </li> </ul> <p><strong>Примеры</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=n>minmax</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
<span class=k>INDEX</span> <span class=n>b</span> <span class=p>(</span><span class=n>u64</span> <span class=o>*</span> <span class=k>length</span><span class=p>(</span><span class=n>str</span><span class=p>),</span> <span class=n>i32</span> <span class=o>+</span> <span class=n>f64</span> <span class=o>*</span> <span class=mi>100</span><span class=p>,</span> <span class=nb>date</span><span class=p>,</span> <span class=n>str</span><span class=p>)</span> <span class=k>TYPE</span> <span class=k>set</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=n>GRANULARITY</span> <span class=mi>4</span>
</code></pre></div> <h4 id=functions-support>Поддержка для функций<a class=headerlink href=#functions-support title="Permanent link"> </a></h4> <p>Условия в секции <code class=syntax>WHERE</code> содержат вызовы функций, оперирующих со столбцами. Если столбец - часть индекса, ClickHouse пытается использовать индекс при выполнении функции. Для разных видов индексов, ClickHouse поддерживает различные наборы функций, которые могут использоваться индексами.</p> <p>Индекс <code class=syntax>set</code> используется со всеми функциями. Наборы функций для остальных индексов представлены в таблице ниже.</p> <table> <thead> <tr> <th>Функция (оператор) / Индекс</th> <th>primary key</th> <th>minmax</th> <th>ngrambf_v1</th> <th>tokenbf_v1</th> <th>bloom_filter</th> </tr> </thead> <tbody> <tr> <td><a href=../../../../sql-reference/functions/comparison-functions/#function-equals>equals (=, ==)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/comparison-functions/#function-notequals>notEquals(!=, \&lt;&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/string-search-functions/#function-like>like</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/string-search-functions/#function-notlike>notLike</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/string-functions/#startswith>startsWith</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/string-functions/#endswith>endsWith</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✔</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/string-search-functions/#function-multisearchany>multiSearchAny</a></td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/in-functions/#in-functions>in</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/in-functions/#in-functions>notIn</a></td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> <td>✔</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/comparison-functions/#function-less>less (\&lt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/comparison-functions/#function-greater>greater (&gt;)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/comparison-functions/#function-lessorequals>lessOrEquals (\&lt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/comparison-functions/#function-greaterorequals>greaterOrEquals (&gt;=)</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/array-functions/#function-empty>empty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td><a href=../../../../sql-reference/functions/array-functions/#function-notempty>notEmpty</a></td> <td>✔</td> <td>✔</td> <td>✗</td> <td>✗</td> <td>✗</td> </tr> <tr> <td>hasToken</td> <td>✗</td> <td>✗</td> <td>✗</td> <td>✔</td> <td>✗</td> </tr> </tbody> </table> <p>Функции с постоянным агрументом, который меньше, чем размер ngram не могут использовать индекс <code class=syntax>ngrambf_v1</code> для оптимизации запроса.</p> <p>Фильтры Блума могут иметь ложнопозитивные срабатывания, следовательно индексы <code class=syntax>ngrambf_v1</code>, <code class=syntax>tokenbf_v1</code> и <code class=syntax>bloom_filter</code> невозможно использовать для оптимизации запросов, в которых результат функции предполается false, например:</p> <ul> <li>Можно оптимизировать:<ul> <li><code class=syntax>s LIKE '%test%'</code></li> <li><code class=syntax>NOT s NOT LIKE '%test%'</code></li> <li><code class=syntax>s = 1</code></li> <li><code class=syntax>NOT s != 1</code></li> <li><code class=syntax>startsWith(s, 'test')</code></li> </ul> </li> <li>Нельзя оптимизировать:<ul> <li><code class=syntax>NOT s LIKE '%test%'</code></li> <li><code class=syntax>s NOT LIKE '%test%'</code></li> <li><code class=syntax>NOT s = 1</code></li> <li><code class=syntax>s != 1</code></li> <li><code class=syntax>NOT startsWith(s, 'test')</code></li> </ul> </li> </ul> <h2 id=concurrent-data-access>Конкурентный доступ к данным<a class=headerlink href=#concurrent-data-access title="Permanent link"> </a></h2> <p>Для конкурентного доступа к таблице используется мультиверсионность. То есть, при одновременном чтении и обновлении таблицы, данные будут читаться из набора кусочков, актуального на момент запроса. Длинных блокировок нет. Вставки никак не мешают чтениям.</p> <p>Чтения из таблицы автоматически распараллеливаются.</p> <h2 id=table_engine-mergetree-ttl>TTL для столбцов и таблиц<a class=headerlink href=#table_engine-mergetree-ttl title="Permanent link"> </a></h2> <p>Определяет время жизни значений, а также правила перемещения данных на другой диск или том.</p> <p>Секция <code class=syntax>TTL</code> может быть установлена как для всей таблицы, так и для каждого отдельного столбца. Правила <code class=syntax>TTL</code> для таблицы позволяют указать целевые диски или тома для фонового перемещения на них частей данных.</p> <p>Выражения должны возвращать тип <a href=./ >Date</a> или <a href=./ >DateTime</a>.</p> <p>Для задания времени жизни столбца, например:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>time_column</span>
<span class=n>TTL</span> <span class=n>time_column</span> <span class=o>+</span> <span class=nb>interval</span>
</code></pre></div> <p>Чтобы задать <code class=syntax>interval</code>, используйте операторы <a href=./#operators-datetime>интервала времени</a>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span>
<span class=n>TTL</span> <span class=n>date_time</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>15</span> <span class=n>HOUR</span>
</code></pre></div> <h3 id=mergetree-column-ttl>TTL столбца<a class=headerlink href=#mergetree-column-ttl title="Permanent link"> </a></h3> <p>Когда срок действия значений в столбце истечет, ClickHouse заменит их значениями по умолчанию для типа данных столбца. Если срок действия всех значений столбцов в части данных истек, ClickHouse удаляет столбец из куска данных в файловой системе.</p> <p>Секцию <code class=syntax>TTL</code> нельзя использовать для ключевых столбцов.</p> <p>Примеры:</p> <p>Создание таблицы с TTL</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=n>b</span> <span class=nb>Int</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>,</span>
    <span class=k>c</span> <span class=n>String</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span><span class=p>;</span>
</code></pre></div> <p>Добавление TTL на колонку существующей таблицы</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Изменение TTL у колонки</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=k>COLUMN</span>
    <span class=k>c</span> <span class=n>String</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span><span class=p>;</span>
</code></pre></div> <h3 id=mergetree-table-ttl>TTL таблицы<a class=headerlink href=#mergetree-table-ttl title="Permanent link"> </a></h3> <p>Для таблицы можно задать одно выражение для устаревания данных, а также несколько выражений, по срабатывании которых данные переместятся на <a href=#table_engine-mergetree-multiple-volumes>некоторый диск или том</a>. Когда некоторые данные в таблице устаревают, ClickHouse удаляет все соответствующие строки.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>TTL</span> <span class=n>expr</span>
    <span class=p>[</span><span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'xxx'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'xxx'</span><span class=p>][,</span> <span class=k>DELETE</span><span class=o>|</span><span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'aaa'</span><span class=o>|</span><span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'bbb'</span><span class=p>]</span> <span class=p>...</span>
    <span class=p>[</span><span class=k>WHERE</span> <span class=n>conditions</span><span class=p>]</span>
    <span class=p>[</span><span class=k>GROUP</span> <span class=k>BY</span> <span class=n>key_expr</span> <span class=p>[</span><span class=k>SET</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v1</span><span class=p>)</span> <span class=p>[,</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>aggr_func</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span> <span class=p>...]]</span> <span class=p>]</span>
</code></pre></div> <p>За каждым TTL выражением может следовать тип действия, которое выполняется после достижения времени, соответствующего результату TTL выражения:</p> <ul> <li><code class=syntax>DELETE</code> - удалить данные (действие по умолчанию);</li> <li><code class=syntax>TO DISK 'aaa'</code> - переместить данные на диск <code class=syntax>aaa</code>;</li> <li><code class=syntax>TO VOLUME 'bbb'</code> - переместить данные на том <code class=syntax>bbb</code>;</li> <li><code class=syntax>GROUP BY</code> - агрегировать данные.</li> </ul> <p>В секции <code class=syntax>WHERE</code> можно задать условие удаления или агрегирования устаревших строк (для перемещения условие <code class=syntax>WHERE</code> не применимо).</p> <p>Колонки, по которым агрегируются данные в <code class=syntax>GROUP BY</code>, должны являться префиксом первичного ключа таблицы.</p> <p>Если колонка не является частью выражения <code class=syntax>GROUP BY</code> и не задается напрямую в секции <code class=syntax>SET</code>, в результирующих строках она будет содержать случайное значение, взятое из одной из сгруппированных строк (как будто к ней применяется агрегирующая функция <code class=syntax>any</code>).</p> <p><strong>Примеры</strong></p> <p>Создание таблицы с TTL:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>example_table</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=p>[</span><span class=k>DELETE</span><span class=p>],</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>VOLUME</span> <span class=s1>'aaa'</span><span class=p>,</span>
    <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>2</span> <span class=n>WEEK</span> <span class=k>TO</span> <span class=n>DISK</span> <span class=s1>'bbb'</span><span class=p>;</span>
</code></pre></div> <p>Изменение TTL:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>example_table</span>
    <span class=k>MODIFY</span> <span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>DAY</span><span class=p>;</span>
</code></pre></div> <p>Создание таблицы, в которой строки устаревают через месяц. Устаревшие строки удаляются, если дата выпадает на понедельник:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_with_where</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>a</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>d</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=k>DELETE</span> <span class=k>WHERE</span> <span class=n>toDayOfWeek</span><span class=p>(</span><span class=n>d</span><span class=p>)</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</code></pre></div> <p>Создание таблицы, где устаревшие строки агрегируются. В результирующих строках колонка <code class=syntax>x</code> содержит максимальное значение по сгруппированным строкам, <code class=syntax>y</code> — минимальное значение, а <code class=syntax>d</code> — случайное значение из одной из сгуппированных строк.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_for_aggregation</span>
<span class=p>(</span>
    <span class=n>d</span> <span class=n>DateTime</span><span class=p>,</span>
    <span class=n>k1</span> <span class=nb>Int</span><span class=p>,</span>
    <span class=n>k2</span> <span class=nb>Int</span><span class=p>,</span>
    <span class=n>x</span> <span class=nb>Int</span><span class=p>,</span>
    <span class=n>y</span> <span class=nb>Int</span>
<span class=p>)</span>
<span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>k1</span><span class=p>,</span> <span class=n>k2</span><span class=p>)</span>
<span class=n>TTL</span> <span class=n>d</span> <span class=o>+</span> <span class=nb>INTERVAL</span> <span class=mi>1</span> <span class=k>MONTH</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>k1</span><span class=p>,</span> <span class=n>k2</span> <span class=k>SET</span> <span class=n>x</span> <span class=o>=</span> <span class=k>max</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>y</span> <span class=o>=</span> <span class=k>min</span><span class=p>(</span><span class=n>y</span><span class=p>);</span>
</code></pre></div> <p><strong>Удаление данных</strong></p> <p>Данные с истекшим TTL удаляются, когда ClickHouse мёржит куски данных.</p> <p>Когда ClickHouse видит, что некоторые данные устарели, он выполняет внеплановые мёржи. Для управление частотой подобных мёржей, можно задать настройку <code class=syntax>merge_with_ttl_timeout</code>. Если её значение слишком низкое, придется выполнять много внеплановых мёржей, которые могут начать потреблять значительную долю ресурсов сервера.</p> <p>Если вы выполните запрос <code class=syntax>SELECT</code> между слияниями вы можете получить устаревшие данные. Чтобы избежать этого используйте запрос <a href=./#misc_operations-optimize>OPTIMIZE</a> перед <code class=syntax>SELECT</code>.</p> <h2 id=table_engine-mergetree-multiple-volumes>Хранение данных таблицы на нескольких блочных устройствах<a class=headerlink href=#table_engine-mergetree-multiple-volumes title="Permanent link"> </a></h2> <h3 id=introduction>Введение<a class=headerlink href=#introduction title="Permanent link"> </a></h3> <p>Движки таблиц семейства <code class=syntax>MergeTree</code> могут хранить данные на нескольких блочных устройствах. Это может оказаться полезным, например, при неявном разделении данных одной таблицы на «горячие» и «холодные». Наиболее свежая часть занимает малый объём и запрашивается регулярно, а большой хвост исторических данных запрашивается редко. При наличии в системе нескольких дисков, «горячая» часть данных может быть размещена на быстрых дисках (например, на NVMe SSD или в памяти), а холодная на более медленных (например, HDD).</p> <p>Минимальной перемещаемой единицей для <code class=syntax>MergeTree</code> является кусок данных (data part). Данные одного куска могут находится только на одном диске. Куски могут перемещаться между дисками в фоне, согласно пользовательским настройкам, а также с помощью запросов <a href=./#alter_move-partition>ALTER</a>.</p> <h3 id=terms>Термины<a class=headerlink href=#terms title="Permanent link"> </a></h3> <ul> <li>Диск — примонтированное в файловой системе блочное устройство.</li> <li>Диск по умолчанию — диск, на котором находится путь, указанный в конфигурационной настройке сервера <a href=../../../../operations/server-configuration-parameters/settings/#server_configuration_parameters-path>path</a>.</li> <li>Том (Volume) — упорядоченный набор равноценных дисков (схоже с <a href=https://ru.wikipedia.org/wiki/JBOD rel="external nofollow noreferrer" target=_blank>JBOD</a>)</li> <li>Политика хранения (StoragePolicy) — множество томов с правилами перемещения данных между ними.</li> </ul> <p>У всех описанных сущностей при создании указываются имена, можно найти в системных таблицах <a href=./#system_tables-storage_policies>system.storage_policies</a> и <a href=./#system_tables-disks>system.disks</a>. Имя политики хранения можно указать в настройке <code class=syntax>storage_policy</code> движков таблиц семейства <code class=syntax>MergeTree</code>.</p> <h3 id=table_engine-mergetree-multiple-volumes_configure>Конфигурация<a class=headerlink href=#table_engine-mergetree-multiple-volumes_configure title="Permanent link"> </a></h3> <p>Диски, тома и политики хранения задаются внутри тега <code class=syntax>&lt;storage_configuration&gt;</code> в основном файле <code class=syntax>config.xml</code> или в отдельном файле в директории <code class=syntax>config.d</code>.</p> <p>Структура конфигурации:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;disk_name_1&gt;</span> <span class=c>&lt;!-- disk name --&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/fast_ssd/clickhouse/<span class=nt>&lt;/path&gt;</span>
        <span class=nt>&lt;/disk_name_1&gt;</span>
        <span class=nt>&lt;disk_name_2&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd1/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_2&gt;</span>
        <span class=nt>&lt;disk_name_3&gt;</span>
            <span class=nt>&lt;path&gt;</span>/mnt/hdd2/clickhouse/<span class=nt>&lt;/path&gt;</span>
            <span class=nt>&lt;keep_free_space_bytes&gt;</span>10485760<span class=nt>&lt;/keep_free_space_bytes&gt;</span>
        <span class=nt>&lt;/disk_name_3&gt;</span>

        ...
    <span class=nt>&lt;/disks&gt;</span>

    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Теги:</p> <ul> <li><code class=syntax>&lt;disk_name_N&gt;</code> — имя диска. Имена должны быть разными для всех дисков.</li> <li><code class=syntax>path</code> — путь по которому будут храниться данные сервера (каталоги <code class=syntax>data</code> и <code class=syntax>shadow</code>), должен быть терминирован <code class=syntax>/</code>.</li> <li><code class=syntax>keep_free_space_bytes</code> — размер зарезервированного свободного места на диске.</li> </ul> <p>Порядок задания дисков не имеет значения.</p> <p>Общий вид конфигурации политик хранения:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;policy_name_1&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;volume_name_1&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk_name_from_disks_configuration<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/volume_name_1&gt;</span>
                <span class=nt>&lt;volume_name_2&gt;</span>
                    <span class=c>&lt;!-- configuration --&gt;</span>
                <span class=nt>&lt;/volume_name_2&gt;</span>
                <span class=c>&lt;!-- more volumes --&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/policy_name_1&gt;</span>
        <span class=nt>&lt;policy_name_2&gt;</span>
            <span class=c>&lt;!-- configuration --&gt;</span>
        <span class=nt>&lt;/policy_name_2&gt;</span>

        <span class=c>&lt;!-- more policies --&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Тэги:</p> <ul> <li><code class=syntax>policy_name_N</code> — название политики. Названия политик должны быть уникальны.</li> <li><code class=syntax>volume_name_N</code> — название тома. Названия томов должны быть уникальны.</li> <li><code class=syntax>disk</code> — диск, находящийся внутри тома.</li> <li><code class=syntax>max_data_part_size_bytes</code> — максимальный размер куска данных, который может находится на любом из дисков этого тома.</li> <li><code class=syntax>move_factor</code> — доля доступного свободного места на томе, если места становится меньше, то данные начнут перемещение на следующий том, если он есть (по умолчанию 0.1).</li> <li><code class=syntax>prefer_not_to_merge</code> — Отключает слияние кусков данных, хранящихся на данном томе. Если данная настройка включена, то слияние данных, хранящихся на данном томе, не допускается. Это позволяет контролировать работу ClickHouse с медленными дисками.</li> </ul> <p>Примеры конфигураций:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;hdd_in_order&gt;</span> <span class=c>&lt;!-- policy name --&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;single&gt;</span> <span class=c>&lt;!-- volume name --&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk2<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/single&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/hdd_in_order&gt;</span>

        <span class=nt>&lt;moving_from_ssd_to_hdd&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;hot&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>fast_ssd<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;max_data_part_size_bytes&gt;</span>1073741824<span class=nt>&lt;/max_data_part_size_bytes&gt;</span>
                <span class=nt>&lt;/hot&gt;</span>
                <span class=nt>&lt;cold&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>disk1<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/cold&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/moving_from_ssd_to_hdd&gt;</span>

        <span class=nt>&lt;small_jbod_with_external_no_merges&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;main&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>jbod1<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/main&gt;</span>
                <span class=nt>&lt;external&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>external<span class=nt>&lt;/disk&gt;</span>
                    <span class=nt>&lt;prefer_not_to_merge&gt;</span>true<span class=nt>&lt;/prefer_not_to_merge&gt;</span>
                <span class=nt>&lt;/external&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/small_jbod_with_external_no_merges&gt;</span>

    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>В приведенном примере, политика <code class=syntax>hdd_in_order</code> реализует прицип <a href=https://ru.wikipedia.org/wiki/Round-robin_(%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC) rel="external nofollow noreferrer" target=_blank>round-robin</a>. Так как в политике есть всего один том (<code class=syntax>single</code>), то все записи производятся на его диски по круговому циклу. Такая политика может быть полезна при наличии в системе нескольких похожих дисков, но при этом не сконфигурирован RAID. Учтите, что каждый отдельный диск ненадёжен и чтобы не потерять важные данные это необходимо скомпенсировать за счет хранения данных в трёх копиях.</p> <p>Если система содержит диски различных типов, то может пригодиться политика <code class=syntax>moving_from_ssd_to_hdd</code>. В томе <code class=syntax>hot</code> находится один SSD-диск (<code class=syntax>fast_ssd</code>), а также задается ограничение на максимальный размер куска, который может храниться на этом томе (1GB). Все куски такой таблицы больше 1GB будут записываться сразу на том <code class=syntax>cold</code>, в котором содержится один HDD-диск <code class=syntax>disk1</code>. Также, при заполнении диска <code class=syntax>fast_ssd</code> более чем на 80% данные будут переносится на диск <code class=syntax>disk1</code> фоновым процессом.</p> <p>Порядок томов в политиках хранения важен, при достижении условий на переполнение тома данные переносятся на следующий. Порядок дисков в томах так же важен, данные пишутся по очереди на каждый из них.</p> <p>После задания конфигурации политик хранения их можно использовать, как настройку при создании таблиц:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>table_with_non_default_policy</span> <span class=p>(</span>
    <span class=n>EventDate</span> <span class=nb>Date</span><span class=p>,</span>
    <span class=n>OrderID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>BannerID</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>SearchPhrase</span> <span class=n>String</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>MergeTree</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=p>(</span><span class=n>OrderID</span><span class=p>,</span> <span class=n>BannerID</span><span class=p>)</span>
<span class=n>PARTITION</span> <span class=k>BY</span> <span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span>
<span class=n>SETTINGS</span> <span class=n>storage_policy</span> <span class=o>=</span> <span class=s1>'moving_from_ssd_to_hdd'</span>
</code></pre></div> <p>По умолчанию используется политика хранения <code class=syntax>default</code> в которой есть один том и один диск, указанный в <code class=syntax>&lt;path&gt;</code>.<br> Изменить политику хранения после создания таблицы можно при помощи запроса [ALTER TABLE ... MODIFY SETTING]. При этом необходимо учесть, что новая политика должна содержать все тома и диски предыдущей политики с теми же именами.</p> <p>Количество потоков для фоновых перемещений кусков между дисками можно изменить с помощью настройки <a href=../../../../operations/settings/settings/#background_move_pool_size>background_move_pool_size</a></p> <h3 id=details>Особенности работы<a class=headerlink href=#details title="Permanent link"> </a></h3> <p>В таблицах <code class=syntax>MergeTree</code> данные попадают на диск несколькими способами:</p> <ul> <li>В результате вставки (запрос <code class=syntax>INSERT</code>).</li> <li>В фоновых операциях слияний и <a href=../../../../sql-reference/statements/alter/#mutations>мутаций</a>.</li> <li>При скачивании данных с другой реплики.</li> <li>В результате заморозки партиций <a href=./#alter_freeze-partition>ALTER TABLE … FREEZE PARTITION</a>.</li> </ul> <p>Во всех случаях, кроме мутаций и заморозки партиций, при записи куска выбирается том и диск в соответствии с указанной конфигурацией хранилища:</p> <ol> <li>Выбирается первый по порядку том, на котором есть свободное место для записи куска (<code class=syntax>unreserved_space &gt; current_part_size</code>) и который позволяет записывать куски требуемого размера <code class=syntax>max_data_part_size_bytes &gt; current_part_size</code>.</li> <li>Внутри тома выбирается следующий диск после того, на который была предыдущая запись и на котором свободного места больше чем размер куска (<code class=syntax>unreserved_space - keep_free_space_bytes &gt; current_part_size</code>)</li> </ol> <p>Мутации и запросы заморозки партиций в реализации используют <a href=https://ru.wikipedia.org/wiki/%D0%96%D1%91%D1%81%D1%82%D0%BA%D0%B0%D1%8F_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B0 rel="external nofollow noreferrer" target=_blank>жесткие ссылки</a>. Жесткие ссылки между различными дисками не поддерживаются, поэтому в случае таких операций куски размещаются на тех же дисках, что и исходные.</p> <p>В фоне куски перемещаются между томами на основе информации о занятом месте (настройка <code class=syntax>move_factor</code>) по порядку, в котором указаны тома в конфигурации. Данные никогда не перемещаются с последнего тома и на первый том. Следить за фоновыми перемещениями можно с помощью системных таблиц <a href=./#system_tables-part-log>system.part_log</a> (поле <code class=syntax>type = MOVE_PART</code>) и <a href=./#system_tables-parts>system.parts</a> (поля <code class=syntax>path</code> и <code class=syntax>disk</code>). Также подробная информация о перемещениях доступна в логах сервера.<br> С помощью запроса <a href=./#alter_move-partition>ALTER TABLE … MOVE PART|PARTITION … TO VOLUME|DISK …</a> пользователь может принудительно перенести кусок или партицию с одного раздела на другой. При этом учитываются все ограничения, указанные для фоновых операций. Запрос самостоятельно инициирует процесс перемещения не дожидаясь фоновых операций. В случае недостатка места или неудовлетворения ограничениям пользователь получит сообщение об ошибке.</p> <p>Перемещения данных не взаимодействуют с репликацией данных, поэтому на разных репликах одной и той же таблицы могут быть указаны разные политики хранения.</p> <p>После выполнения фоновых слияний или мутаций старые куски не удаляются сразу, а через некоторое время (табличная настройка <code class=syntax>old_parts_lifetime</code>). Также они не перемещаются на другие тома или диски, поэтому до момента удаления они продолжают учитываться при подсчёте занятого дискового пространства.</p> <h2 id=table_engine-mergetree-s3>Использование сервиса S3 для хранения данных<a class=headerlink href=#table_engine-mergetree-s3 title="Permanent link"> </a></h2> <p>Таблицы семейства <code class=syntax>MergeTree</code> могут хранить данные в сервисе <a href=https://aws.amazon.com/s3/ rel="external nofollow noreferrer" target=_blank>S3</a> при использовании диска типа <code class=syntax>s3</code>.</p> <p>Конфигурация:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;s3&gt;</span>
            <span class=nt>&lt;type&gt;</span>s3<span class=nt>&lt;/type&gt;</span>
            <span class=nt>&lt;endpoint&gt;</span>https://storage.yandexcloud.net/my-bucket/root-path/<span class=nt>&lt;/endpoint&gt;</span>
            <span class=nt>&lt;access_key_id&gt;</span>your_access_key_id<span class=nt>&lt;/access_key_id&gt;</span>
            <span class=nt>&lt;secret_access_key&gt;</span>your_secret_access_key<span class=nt>&lt;/secret_access_key&gt;</span>
            <span class=nt>&lt;region&gt;&lt;/region&gt;</span>
            <span class=nt>&lt;proxy&gt;</span>
                <span class=nt>&lt;uri&gt;</span>http://proxy1<span class=nt>&lt;/uri&gt;</span>
                <span class=nt>&lt;uri&gt;</span>http://proxy2<span class=nt>&lt;/uri&gt;</span>
            <span class=nt>&lt;/proxy&gt;</span>
            <span class=nt>&lt;connect_timeout_ms&gt;</span>10000<span class=nt>&lt;/connect_timeout_ms&gt;</span>
            <span class=nt>&lt;request_timeout_ms&gt;</span>5000<span class=nt>&lt;/request_timeout_ms&gt;</span>
            <span class=nt>&lt;retry_attempts&gt;</span>10<span class=nt>&lt;/retry_attempts&gt;</span>
            <span class=nt>&lt;single_read_retries&gt;</span>4<span class=nt>&lt;/single_read_retries&gt;</span>
            <span class=nt>&lt;min_bytes_for_seek&gt;</span>1000<span class=nt>&lt;/min_bytes_for_seek&gt;</span>
            <span class=nt>&lt;metadata_path&gt;</span>/var/lib/clickhouse/disks/s3/<span class=nt>&lt;/metadata_path&gt;</span>
            <span class=nt>&lt;cache_enabled&gt;</span>true<span class=nt>&lt;/cache_enabled&gt;</span>
            <span class=nt>&lt;cache_path&gt;</span>/var/lib/clickhouse/disks/s3/cache/<span class=nt>&lt;/cache_path&gt;</span>
            <span class=nt>&lt;skip_access_check&gt;</span>false<span class=nt>&lt;/skip_access_check&gt;</span>
        <span class=nt>&lt;/s3&gt;</span>
    <span class=nt>&lt;/disks&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Обязательные параметры:</p> <ul> <li><code class=syntax>endpoint</code> — URL точки приема запроса на стороне S3 в <a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/VirtualHosting.html rel="external nofollow noreferrer" target=_blank>форматах</a> <code class=syntax>path</code> или <code class=syntax>virtual hosted</code>. URL точки должен содержать бакет и путь к корневой директории на сервере, где хранятся данные.</li> <li><code class=syntax>access_key_id</code> — id ключа доступа к S3.</li> <li><code class=syntax>secret_access_key</code> — секретный ключ доступа к S3.</li> </ul> <p>Необязательные параметры:</p> <ul> <li><code class=syntax>region</code> — название региона S3.</li> <li><code class=syntax>use_environment_credentials</code> — признак, нужно ли считывать учетные данные AWS из сетевого окружения, а также из переменных окружения <code class=syntax>AWS_ACCESS_KEY_ID</code>, <code class=syntax>AWS_SECRET_ACCESS_KEY</code> и <code class=syntax>AWS_SESSION_TOKEN</code>, если они есть. Значение по умолчанию: <code class=syntax>false</code>.</li> <li><code class=syntax>use_insecure_imds_request</code> — признак, нужно ли использовать менее безопасное соединение при выполнении запроса к IMDS при получении учётных данных из метаданных Amazon EC2. Значение по умолчанию: <code class=syntax>false</code>.</li> <li><code class=syntax>proxy</code> — конфигурация прокси-сервера для конечной точки S3. Каждый элемент <code class=syntax>uri</code> внутри блока <code class=syntax>proxy</code> должен содержать URL прокси-сервера.</li> <li><code class=syntax>connect_timeout_ms</code> — таймаут подключения к сокету в миллисекундах. Значение по умолчанию: 10 секунд.</li> <li><code class=syntax>request_timeout_ms</code> — таймаут выполнения запроса в миллисекундах. Значение по умолчанию: 5 секунд.</li> <li><code class=syntax>retry_attempts</code> — число попыток выполнения запроса в случае возникновения ошибки. Значение по умолчанию: <code class=syntax>10</code>.</li> <li><code class=syntax>single_read_retries</code> — число попыток выполнения запроса в случае возникновения ошибки в процессе чтения. Значение по умолчанию: <code class=syntax>4</code>.</li> <li><code class=syntax>min_bytes_for_seek</code> — минимальное количество байтов, которые используются для операций поиска вместо последовательного чтения. Значение по умолчанию: 1 МБайт.</li> <li><code class=syntax>metadata_path</code> — путь к локальному файловому хранилищу для хранения файлов с метаданными для S3. Значение по умолчанию: <code class=syntax>/var/lib/clickhouse/disks/&lt;disk_name&gt;/</code>.</li> <li><code class=syntax>cache_enabled</code> — признак, разрешено ли хранение кэша засечек и файлов индекса в локальной файловой системе. Значение по умолчанию: <code class=syntax>true</code>.</li> <li><code class=syntax>cache_path</code> — путь в локальной файловой системе, где будут храниться кэш засечек и файлы индекса. Значение по умолчанию: <code class=syntax>/var/lib/clickhouse/disks/&lt;disk_name&gt;/cache/</code>.</li> <li><code class=syntax>skip_access_check</code> — признак, выполнять ли проверку доступов при запуске диска. Если установлено значение <code class=syntax>true</code>, то проверка не выполняется. Значение по умолчанию: <code class=syntax>false</code>.</li> </ul> <p>Диск S3 может быть сконфигурирован как <code class=syntax>main</code> или <code class=syntax>cold</code>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;storage_configuration&gt;</span>
    ...
    <span class=nt>&lt;disks&gt;</span>
        <span class=nt>&lt;s3&gt;</span>
            <span class=nt>&lt;type&gt;</span>s3<span class=nt>&lt;/type&gt;</span>
            <span class=nt>&lt;endpoint&gt;</span>https://storage.yandexcloud.net/my-bucket/root-path/<span class=nt>&lt;/endpoint&gt;</span>
            <span class=nt>&lt;access_key_id&gt;</span>your_access_key_id<span class=nt>&lt;/access_key_id&gt;</span>
            <span class=nt>&lt;secret_access_key&gt;</span>your_secret_access_key<span class=nt>&lt;/secret_access_key&gt;</span>
        <span class=nt>&lt;/s3&gt;</span>
    <span class=nt>&lt;/disks&gt;</span>
    <span class=nt>&lt;policies&gt;</span>
        <span class=nt>&lt;s3_main&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;main&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>s3<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/main&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
        <span class=nt>&lt;/s3_main&gt;</span>
        <span class=nt>&lt;s3_cold&gt;</span>
            <span class=nt>&lt;volumes&gt;</span>
                <span class=nt>&lt;main&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>default<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/main&gt;</span>
                <span class=nt>&lt;external&gt;</span>
                    <span class=nt>&lt;disk&gt;</span>s3<span class=nt>&lt;/disk&gt;</span>
                <span class=nt>&lt;/external&gt;</span>
            <span class=nt>&lt;/volumes&gt;</span>
            <span class=nt>&lt;move_factor&gt;</span>0.2<span class=nt>&lt;/move_factor&gt;</span>
        <span class=nt>&lt;/s3_cold&gt;</span>
    <span class=nt>&lt;/policies&gt;</span>
    ...
<span class=nt>&lt;/storage_configuration&gt;</span>
</code></pre></div> <p>Если диск сконфигурирован как <code class=syntax>cold</code>, данные будут переноситься в S3 при срабатывании правил TTL или когда свободное место на локальном диске станет меньше порогового значения, которое определяется как <code class=syntax>move_factor * disk_size</code>.</p> </div> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Was this content helpful?</span> <div id=rating-stars class="display-6 mb-0" data-titles="['Unusable', 'Poor', 'OK', 'Good', 'Excellent']" data-documentation=documentation>RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2021 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/878a159538935028f2d2dce3eb3074d44eb191df rel="external nofollow noreferrer" target=_blank class=text-reset>878a159538</a> </div> </div> </div> <div id=toc class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5"> <nav class="nav flex-column text-wrap"> <label for=toc>Table of Contents</label> <a href=#table_engine-mergetree-creating-a-table title="Создание таблицы" class="nav-link text-wrap d-inline-block w-100"> Создание таблицы </a> <nav id=toc-toc-1 class="nav flex-column pl-2"> <a href=#mergetree-query-clauses title="Секции запроса" class="nav-link text-wrap d-inline-block w-100"> Секции запроса </a> </nav> <a href=#mergetree-data-storage title="Хранение данных" class="nav-link text-wrap d-inline-block w-100"> Хранение данных </a> <a href=#primary-keys-and-indexes-in-queries title="Первичные ключи и индексы в запросах" class="nav-link text-wrap d-inline-block w-100"> Первичные ключи и индексы в запросах </a> <nav id=toc-toc-3 class="nav flex-column pl-2"> <a href=#selecting-the-primary-key title="Выбор первичного ключа" class="nav-link text-wrap d-inline-block w-100"> Выбор первичного ключа </a> <a href=#choosing-a-primary-key-that-differs-from-the-sorting-key title="Первичный ключ, отличный от ключа сортировки" class="nav-link text-wrap d-inline-block w-100"> Первичный ключ, отличный от ключа сортировки </a> <a href=#use-of-indexes-and-partitions-in-queries title="Использование индексов и партиций в запросах" class="nav-link text-wrap d-inline-block w-100"> Использование индексов и партиций в запросах </a> <a href=#use-of-index-for-partially-monotonic-primary-keys title="Использование индекса для частично-монотонных первичных ключей" class="nav-link text-wrap d-inline-block w-100"> Использование индекса для частично-монотонных первичных ключей </a> <a href=#table_engine-mergetree-data_skipping-indexes title="Индексы пропуска данных" class="nav-link text-wrap d-inline-block w-100"> Индексы пропуска данных </a> <nav id=toc-toc-3-5 class="nav flex-column pl-2"> <a href=#available-types-of-indices title="Доступные индексы" class="nav-link text-wrap d-inline-block w-100"> Доступные индексы </a> <a href=#functions-support title="Поддержка для функций" class="nav-link text-wrap d-inline-block w-100"> Поддержка для функций </a> </nav> </nav> <a href=#concurrent-data-access title="Конкурентный доступ к данным" class="nav-link text-wrap d-inline-block w-100"> Конкурентный доступ к данным </a> <a href=#table_engine-mergetree-ttl title="TTL для столбцов и таблиц" class="nav-link text-wrap d-inline-block w-100"> TTL для столбцов и таблиц </a> <nav id=toc-toc-5 class="nav flex-column pl-2"> <a href=#mergetree-column-ttl title="TTL столбца" class="nav-link text-wrap d-inline-block w-100"> TTL столбца </a> <a href=#mergetree-table-ttl title="TTL таблицы" class="nav-link text-wrap d-inline-block w-100"> TTL таблицы </a> </nav> <a href=#table_engine-mergetree-multiple-volumes title="Хранение данных таблицы на нескольких блочных устройствах" class="nav-link text-wrap d-inline-block w-100"> Хранение данных таблицы на нескольких блочных устройствах </a> <nav id=toc-toc-6 class="nav flex-column pl-2"> <a href=#introduction title=Введение class="nav-link text-wrap d-inline-block w-100"> Введение </a> <a href=#terms title=Термины class="nav-link text-wrap d-inline-block w-100"> Термины </a> <a href=#table_engine-mergetree-multiple-volumes_configure title=Конфигурация class="nav-link text-wrap d-inline-block w-100"> Конфигурация </a> <a href=#details title="Особенности работы" class="nav-link text-wrap d-inline-block w-100"> Особенности работы </a> </nav> <a href=#table_engine-mergetree-s3 title="Использование сервиса S3 для хранения данных" class="nav-link text-wrap d-inline-block w-100"> Использование сервиса S3 для хранения данных </a> </nav> </div> </div> </div> <script async type=text/javascript src=/js/base.js?da3fd50d></script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 alt=Yandex></div> </noscript> </body> </html>