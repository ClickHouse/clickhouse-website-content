<!doctype html><html ⚡ lang=en> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>Storing Dictionaries in Memory | ClickHouse Documentation</title><link href=https://clickhouse.tech/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Storing Dictionaries in Memory | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.tech/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Storing Dictionaries in Memory | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer,section{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b{font-weight:bolder}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-primary{background-color:#b8daff}.table-warning{background-color:#ffeeba}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-dark{color:#fff;background-color:#343a40}.form-group{margin-bottom:1rem}.form-text{display:block;margin-top:.25rem}.form-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-5px;margin-left:-5px}.form-row>.col,.form-row>[class*=col-]{padding-right:5px;padding-left:5px}.custom-select.is-invalid{border-color:#dc3545;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.form-inline{display:-ms-flexbox;display:flex;-ms-flex-flow:row wrap;flex-flow:row wrap;-ms-flex-align:center;align-items:center}@media(min-width:576px){.form-inline .form-group{display:-ms-flexbox;display:flex;-ms-flex:0 0 auto;flex:0 0 auto;-ms-flex-flow:row wrap;flex-flow:row wrap;-ms-flex-align:center;align-items:center;margin-bottom:0}.form-inline .custom-select{width:auto}}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-primary{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:hover{color:#fff;background-color:#0069d9;border-color:#0062cc}.btn-primary:focus{color:#fff;background-color:#0069d9;border-color:#0062cc;box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-primary:disabled{color:#fff;background-color:#007bff;border-color:#007bff}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-primary{color:#007bff;border-color:#007bff}.btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-primary:disabled{color:#007bff;background-color:transparent}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.btn-group{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group>.btn:hover{z-index:1}.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#007bff;border:0;border-radius:1rem;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#b3d7ff}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#007bff;border:0;border-radius:1rem;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#b3d7ff}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#007bff;border:0;border-radius:1rem;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#b3d7ff}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px;background-color:#dee2e6;border-radius:1rem}.custom-range:disabled::-webkit-slider-thumb{background-color:#adb5bd}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#adb5bd}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#adb5bd}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25;color:#007bff;background-color:#fff;border:1px solid #dee2e6}.page-link:hover{z-index:2;color:#0056b3;text-decoration:none;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#004085;background-color:#cce5ff;border-color:#b8daff}.alert-primary .alert-link{color:#002752}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#007bff}a.bg-primary:focus,a.bg-primary:hover{background-color:#0062cc}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.rounded{border-radius:.25rem}.rounded-right{border-top-right-radius:.25rem;border-bottom-right-radius:.25rem}.rounded-bottom{border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}.rounded-lg{border-radius:.3rem}.rounded-0{border-radius:0}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}.d-table-cell{display:table-cell}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}.d-md-table-cell{display:table-cell}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}.d-lg-table-cell{display:table-cell}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pb-5,.py-5{padding-bottom:3rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#007bff}a.text-primary:focus,a.text-primary:hover{color:#0056b3}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}details{background:#444451;color:#eee;padding:1rem;margin-bottom:1rem;margin-top:1rem}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .k{color:#000;font-weight:700}.syntax .n{color:#2f1e2e}.syntax .o{color:#800}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .ld{color:#48b685}.syntax .s{color:#48b685}.syntax .nb{color:#2f1e2e}.syntax .py{color:#2f1e2e}.syntax .nt{color:#5bc4bf}.syntax .mi{color:#08f}.syntax .s2{color:#48b685}.syntax .s1{color:#080}@media(prefers-color-scheme:dark){.syntax .k{color:#c78cff}.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .nb{color:#f8f9fa}.syntax .py{color:#f8f9fa}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <h1 id=dicts-external-dicts-dict-layout>Storing Dictionaries in Memory<a class=headerlink href=../amp/#dicts-external-dicts-dict-layout title="Permanent link"> </a></h1> <p>There are a variety of ways to store dictionaries in memory.</p> <p>We recommend <a href=../amp/#flat>flat</a>, <a href=../amp/#dicts-external_dicts_dict_layout-hashed>hashed</a> and <a href=../amp/#complex-key-hashed>complex_key_hashed</a>. which provide optimal processing speed.</p> <p>Caching is not recommended because of potentially poor performance and difficulties in selecting optimal parameters. Read more in the section “<a href=../amp/#cache>cache</a>”.</p> <p>There are several ways to improve dictionary performance:</p> <ul> <li>Call the function for working with the dictionary after <code class=syntax>GROUP BY</code>.</li> <li>Mark attributes to extract as injective. An attribute is called injective if different attribute values correspond to different keys. So when <code class=syntax>GROUP BY</code> uses a function that fetches an attribute value by the key, this function is automatically taken out of <code class=syntax>GROUP BY</code>.</li> </ul> <p>ClickHouse generates an exception for errors with dictionaries. Examples of errors:</p> <ul> <li>The dictionary being accessed could not be loaded.</li> <li>Error querying a <code class=syntax>cached</code> dictionary.</li> </ul> <p>You can view the list of external dictionaries and their statuses in the <code class=syntax>system.dictionaries</code> table.</p> <p>The configuration looks like this:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;yandex&gt;</span>
    <span class=nt>&lt;dictionary&gt;</span>
        ...
        <span class=nt>&lt;layout&gt;</span>
            <span class=nt>&lt;layout_type&gt;</span>
                <span class=c>&lt;!-- layout settings --&gt;</span>
            <span class=nt>&lt;/layout_type&gt;</span>
        <span class=nt>&lt;/layout&gt;</span>
        ...
    <span class=nt>&lt;/dictionary&gt;</span>
<span class=nt>&lt;/yandex&gt;</span>
</code></pre></div> <p>Corresponding <a href=../../../../statements/create/dictionary/amp/ >DDL-query</a>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>DICTIONARY</span> <span class=p>(...)</span>
<span class=p>...</span>
<span class=n>LAYOUT</span><span class=p>(</span><span class=n>LAYOUT_TYPE</span><span class=p>(</span><span class=n>param</span> <span class=n>value</span><span class=p>))</span> <span class=c1>-- layout settings</span>
<span class=p>...</span>
</code></pre></div> <h2 id=ways-to-store-dictionaries-in-memory>Ways to Store Dictionaries in Memory<a class=headerlink href=../amp/#ways-to-store-dictionaries-in-memory title="Permanent link"> </a></h2> <ul> <li><a href=../amp/#flat>flat</a></li> <li><a href=../amp/#dicts-external_dicts_dict_layout-hashed>hashed</a></li> <li><a href=../amp/#dicts-external_dicts_dict_layout-sparse_hashed>sparse_hashed</a></li> <li><a href=../amp/#cache>cache</a></li> <li><a href=../amp/#ssd-cache>ssd_cache</a></li> <li><a href=../amp/#direct>direct</a></li> <li><a href=../amp/#range-hashed>range_hashed</a></li> <li><a href=../amp/#complex-key-hashed>complex_key_hashed</a></li> <li><a href=../amp/#complex-key-cache>complex_key_cache</a></li> <li><a href=../amp/#ssd-cache>ssd_cache</a></li> <li><a href=../amp/#complex-key-ssd-cache>ssd_complex_key_cache</a></li> <li><a href=../amp/#complex-key-direct>complex_key_direct</a></li> <li><a href=../amp/#ip-trie>ip_trie</a></li> </ul> <h3 id=flat>flat<a class=headerlink href=../amp/#flat title="Permanent link"> </a></h3> <p>The dictionary is completely stored in memory in the form of flat arrays. How much memory does the dictionary use? The amount is proportional to the size of the largest key (in space used).</p> <p>The dictionary key has the <code class=syntax>UInt64</code> type and the value is limited to 500,000. If a larger key is discovered when creating the dictionary, ClickHouse throws an exception and does not create the dictionary.</p> <p>All types of sources are supported. When updating, data (from a file or from a table) is read in its entirety.</p> <p>This method provides the best performance among all available methods of storing the dictionary.</p> <p>Configuration example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
  <span class=nt>&lt;flat</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=n>FLAT</span><span class=p>())</span>
</code></pre></div> <h3 id=dicts-external_dicts_dict_layout-hashed>hashed<a class=headerlink href=../amp/#dicts-external_dicts_dict_layout-hashed title="Permanent link"> </a></h3> <p>The dictionary is completely stored in memory in the form of a hash table. The dictionary can contain any number of elements with any identifiers In practice, the number of keys can reach tens of millions of items.</p> <p>The hash table will be preallocated (this will make dictionary load faster), if the is approx number of total rows is known, this is supported only if the source is <code class=syntax>clickhouse</code> without any <code class=syntax>&lt;where&gt;</code> (since in case of <code class=syntax>&lt;where&gt;</code> you can filter out too much rows and the dictionary will allocate too much memory, that will not be used eventually).</p> <p>All types of sources are supported. When updating, data (from a file or from a table) is read in its entirety.</p> <p>Configuration example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
  <span class=nt>&lt;hashed</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=n>HASHED</span><span class=p>())</span>
</code></pre></div> <h3 id=dicts-external_dicts_dict_layout-sparse_hashed>sparse_hashed<a class=headerlink href=../amp/#dicts-external_dicts_dict_layout-sparse_hashed title="Permanent link"> </a></h3> <p>Similar to <code class=syntax>hashed</code>, but uses less memory in favor more CPU usage.</p> <p>It will be also preallocated so as <code class=syntax>hashed</code>, note that it is even more significant for <code class=syntax>sparse_hashed</code>.</p> <p>Configuration example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
  <span class=nt>&lt;sparse_hashed</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=n>SPARSE_HASHED</span><span class=p>())</span>
</code></pre></div> <h3 id=complex-key-hashed>complex_key_hashed<a class=headerlink href=../amp/#complex-key-hashed title="Permanent link"> </a></h3> <p>This type of storage is for use with composite <a href=../../external-dicts-dict-structure/amp/ >keys</a>. Similar to <code class=syntax>hashed</code>.</p> <p>Configuration example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
  <span class=nt>&lt;complex_key_hashed</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=n>COMPLEX_KEY_HASHED</span><span class=p>())</span>
</code></pre></div> <h3 id=range-hashed>range_hashed<a class=headerlink href=../amp/#range-hashed title="Permanent link"> </a></h3> <p>The dictionary is stored in memory in the form of a hash table with an ordered array of ranges and their corresponding values.</p> <p>This storage method works the same way as hashed and allows using date/time (arbitrary numeric type) ranges in addition to the key.</p> <p>Example: The table contains discounts for each advertiser in the format:</p> <div class=codehilite><pre><span></span><code class=syntax>+---------|-------------|-------------|------+
| advertiser id | discount start date | discount end date | amount |
+===============+=====================+===================+========+
| 123           | 2015-01-01          | 2015-01-15        | 0.15   |
+---------|-------------|-------------|------+
| 123           | 2015-01-16          | 2015-01-31        | 0.25   |
+---------|-------------|-------------|------+
| 456           | 2015-01-01          | 2015-01-15        | 0.05   |
+---------|-------------|-------------|------+
</code></pre></div> <p>To use a sample for date ranges, define the <code class=syntax>range_min</code> and <code class=syntax>range_max</code> elements in the <a href=../../external-dicts-dict-structure/amp/ >structure</a>. These elements must contain elements <code class=syntax>name</code> and<code class=syntax>type</code> (if <code class=syntax>type</code> is not specified, the default type will be used - Date). <code class=syntax>type</code> can be any numeric type (Date / DateTime / UInt64 / Int32 / others).</p> <p>Example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;structure&gt;</span>
    <span class=nt>&lt;id&gt;</span>
        <span class=nt>&lt;name&gt;</span>Id<span class=nt>&lt;/name&gt;</span>
    <span class=nt>&lt;/id&gt;</span>
    <span class=nt>&lt;range_min&gt;</span>
        <span class=nt>&lt;name&gt;</span>first<span class=nt>&lt;/name&gt;</span>
        <span class=nt>&lt;type&gt;</span>Date<span class=nt>&lt;/type&gt;</span>
    <span class=nt>&lt;/range_min&gt;</span>
    <span class=nt>&lt;range_max&gt;</span>
        <span class=nt>&lt;name&gt;</span>last<span class=nt>&lt;/name&gt;</span>
        <span class=nt>&lt;type&gt;</span>Date<span class=nt>&lt;/type&gt;</span>
    <span class=nt>&lt;/range_max&gt;</span>
    ...
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>DICTIONARY</span> <span class=n>somedict</span> <span class=p>(</span>
    <span class=n>id</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=k>first</span> <span class=nb>Date</span><span class=p>,</span>
    <span class=k>last</span> <span class=nb>Date</span>
<span class=p>)</span>
<span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>id</span>
<span class=n>LAYOUT</span><span class=p>(</span><span class=n>RANGE_HASHED</span><span class=p>())</span>
<span class=n>RANGE</span><span class=p>(</span><span class=k>MIN</span> <span class=k>first</span> <span class=k>MAX</span> <span class=k>last</span><span class=p>)</span>
</code></pre></div> <p>To work with these dictionaries, you need to pass an additional argument to the <code class=syntax>dictGetT</code> function, for which a range is selected:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>dictGetT</span><span class=p>(</span><span class=s1>'dict_name'</span><span class=p>,</span> <span class=s1>'attr_name'</span><span class=p>,</span> <span class=n>id</span><span class=p>,</span> <span class=nb>date</span><span class=p>)</span>
</code></pre></div> <p>This function returns the value for the specified <code class=syntax>id</code>s and the date range that includes the passed date.</p> <p>Details of the algorithm:</p> <ul> <li>If the <code class=syntax>id</code> is not found or a range is not found for the <code class=syntax>id</code>, it returns the default value for the dictionary.</li> <li>If there are overlapping ranges, it returns value for any (random) range.</li> <li>If the range delimiter is <code class=syntax>NULL</code> or an invalid date (such as 1900-01-01), the range is open. The range can be open on both sides.</li> </ul> <p>Configuration example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;yandex&gt;</span>
        <span class=nt>&lt;dictionary&gt;</span>

                ...

                <span class=nt>&lt;layout&gt;</span>
                        <span class=nt>&lt;range_hashed</span> <span class=nt>/&gt;</span>
                <span class=nt>&lt;/layout&gt;</span>

                <span class=nt>&lt;structure&gt;</span>
                        <span class=nt>&lt;id&gt;</span>
                                <span class=nt>&lt;name&gt;</span>Abcdef<span class=nt>&lt;/name&gt;</span>
                        <span class=nt>&lt;/id&gt;</span>
                        <span class=nt>&lt;range_min&gt;</span>
                                <span class=nt>&lt;name&gt;</span>StartTimeStamp<span class=nt>&lt;/name&gt;</span>
                                <span class=nt>&lt;type&gt;</span>UInt64<span class=nt>&lt;/type&gt;</span>
                        <span class=nt>&lt;/range_min&gt;</span>
                        <span class=nt>&lt;range_max&gt;</span>
                                <span class=nt>&lt;name&gt;</span>EndTimeStamp<span class=nt>&lt;/name&gt;</span>
                                <span class=nt>&lt;type&gt;</span>UInt64<span class=nt>&lt;/type&gt;</span>
                        <span class=nt>&lt;/range_max&gt;</span>
                        <span class=nt>&lt;attribute&gt;</span>
                                <span class=nt>&lt;name&gt;</span>XXXType<span class=nt>&lt;/name&gt;</span>
                                <span class=nt>&lt;type&gt;</span>String<span class=nt>&lt;/type&gt;</span>
                                <span class=nt>&lt;null_value</span> <span class=nt>/&gt;</span>
                        <span class=nt>&lt;/attribute&gt;</span>
                <span class=nt>&lt;/structure&gt;</span>

        <span class=nt>&lt;/dictionary&gt;</span>
<span class=nt>&lt;/yandex&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>DICTIONARY</span> <span class=n>somedict</span><span class=p>(</span>
    <span class=n>Abcdef</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>StartTimeStamp</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>EndTimeStamp</span> <span class=n>UInt64</span><span class=p>,</span>
    <span class=n>XXXType</span> <span class=n>String</span> <span class=k>DEFAULT</span> <span class=s1>''</span>
<span class=p>)</span>
<span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>Abcdef</span>
<span class=n>RANGE</span><span class=p>(</span><span class=k>MIN</span> <span class=n>StartTimeStamp</span> <span class=k>MAX</span> <span class=n>EndTimeStamp</span><span class=p>)</span>
</code></pre></div> <h3 id=cache>cache<a class=headerlink href=../amp/#cache title="Permanent link"> </a></h3> <p>The dictionary is stored in a cache that has a fixed number of cells. These cells contain frequently used elements.</p> <p>When searching for a dictionary, the cache is searched first. For each block of data, all keys that are not found in the cache or are outdated are requested from the source using <code class=syntax>SELECT attrs... FROM db.table WHERE id IN (k1, k2, ...)</code>. The received data is then written to the cache.</p> <p>For cache dictionaries, the expiration <a href=../../external-dicts-dict-lifetime/amp/ >lifetime</a> of data in the cache can be set. If more time than <code class=syntax>lifetime</code> has passed since loading the data in a cell, the cell’s value is not used, and it is re-requested the next time it needs to be used.<br> This is the least effective of all the ways to store dictionaries. The speed of the cache depends strongly on correct settings and the usage scenario. A cache type dictionary performs well only when the hit rates are high enough (recommended 99% and higher). You can view the average hit rate in the <code class=syntax>system.dictionaries</code> table.</p> <p>To improve cache performance, use a subquery with <code class=syntax>LIMIT</code>, and call the function with the dictionary externally.</p> <p>Supported <a href=../../external-dicts-dict-sources/amp/ >sources</a>: MySQL, ClickHouse, executable, HTTP.</p> <p>Example of settings:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
    <span class=nt>&lt;cache&gt;</span>
        <span class=c>&lt;!-- The size of the cache, in number of cells. Rounded up to a power of two. --&gt;</span>
        <span class=nt>&lt;size_in_cells&gt;</span>1000000000<span class=nt>&lt;/size_in_cells&gt;</span>
    <span class=nt>&lt;/cache&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=k>CACHE</span><span class=p>(</span><span class=n>SIZE_IN_CELLS</span> <span class=mi>1000000000</span><span class=p>))</span>
</code></pre></div> <p>Set a large enough cache size. You need to experiment to select the number of cells:</p> <ol> <li>Set some value.</li> <li>Run queries until the cache is completely full.</li> <li>Assess memory consumption using the <code class=syntax>system.dictionaries</code> table.</li> <li>Increase or decrease the number of cells until the required memory consumption is reached.</li> </ol> <div class="admonition warning alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-6 mb-2">Warning</p> <p>Do not use ClickHouse as a source, because it is slow to process queries with random reads.</p> </div> <h3 id=complex-key-cache>complex_key_cache<a class=headerlink href=../amp/#complex-key-cache title="Permanent link"> </a></h3> <p>This type of storage is for use with composite <a href=../../external-dicts-dict-structure/amp/ >keys</a>. Similar to <code class=syntax>cache</code>.</p> <h3 id=ssd-cache>ssd_cache<a class=headerlink href=../amp/#ssd-cache title="Permanent link"> </a></h3> <p>Similar to <code class=syntax>cache</code>, but stores data on SSD and index in RAM.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
    <span class=nt>&lt;ssd_cache&gt;</span>
        <span class=c>&lt;!-- Size of elementary read block in bytes. Recommended to be equal to SSD's page size. --&gt;</span>
        <span class=nt>&lt;block_size&gt;</span>4096<span class=nt>&lt;/block_size&gt;</span>
        <span class=c>&lt;!-- Max cache file size in bytes. --&gt;</span>
        <span class=nt>&lt;file_size&gt;</span>16777216<span class=nt>&lt;/file_size&gt;</span>
        <span class=c>&lt;!-- Size of RAM buffer in bytes for reading elements from SSD. --&gt;</span>
        <span class=nt>&lt;read_buffer_size&gt;</span>131072<span class=nt>&lt;/read_buffer_size&gt;</span>
        <span class=c>&lt;!-- Size of RAM buffer in bytes for aggregating elements before flushing to SSD. --&gt;</span>
        <span class=nt>&lt;write_buffer_size&gt;</span>1048576<span class=nt>&lt;/write_buffer_size&gt;</span>
        <span class=c>&lt;!-- Path where cache file will be stored. --&gt;</span>
        <span class=nt>&lt;path&gt;</span>/var/lib/clickhouse/clickhouse_dictionaries/test_dict<span class=nt>&lt;/path&gt;</span>
        <span class=c>&lt;!-- Max number on stored keys in the cache. Rounded up to a power of two. --&gt;</span>
        <span class=nt>&lt;max_stored_keys&gt;</span>1048576<span class=nt>&lt;/max_stored_keys&gt;</span>
    <span class=nt>&lt;/ssd_cache&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=k>CACHE</span><span class=p>(</span><span class=n>BLOCK_SIZE</span> <span class=mi>4096</span> <span class=n>FILE_SIZE</span> <span class=mi>16777216</span> <span class=n>READ_BUFFER_SIZE</span> <span class=mi>1048576</span>
    <span class=n>PATH</span> <span class=o>/</span><span class=n>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>clickhouse</span><span class=o>/</span><span class=n>clickhouse_dictionaries</span><span class=o>/</span><span class=n>test_dict</span> <span class=n>MAX_STORED_KEYS</span> <span class=mi>1048576</span><span class=p>))</span>
</code></pre></div> <h3 id=complex-key-ssd-cache>complex_key_ssd_cache<a class=headerlink href=../amp/#complex-key-ssd-cache title="Permanent link"> </a></h3> <p>This type of storage is for use with composite <a href=../../external-dicts-dict-structure/amp/ >keys</a>. Similar to <code class=syntax>ssd_cache</code>.</p> <h3 id=direct>direct<a class=headerlink href=../amp/#direct title="Permanent link"> </a></h3> <p>The dictionary is not stored in memory and directly goes to the source during the processing of a request.</p> <p>The dictionary key has the <code class=syntax>UInt64</code> type.</p> <p>All types of <a href=../../external-dicts-dict-sources/amp/ >sources</a>, except local files, are supported.</p> <p>Configuration example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;layout&gt;</span>
  <span class=nt>&lt;direct</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>LAYOUT</span><span class=p>(</span><span class=n>DIRECT</span><span class=p>())</span>
</code></pre></div> <h3 id=complex-key-direct>complex_key_direct<a class=headerlink href=../amp/#complex-key-direct title="Permanent link"> </a></h3> <p>This type of storage is for use with composite <a href=../../external-dicts-dict-structure/amp/ >keys</a>. Similar to <code class=syntax>direct</code>.</p> <h3 id=ip-trie>ip_trie<a class=headerlink href=../amp/#ip-trie title="Permanent link"> </a></h3> <p>This type of storage is for mapping network prefixes (IP addresses) to metadata such as ASN.</p> <p>Example: The table contains network prefixes and their corresponding AS number and country code:</p> <div class=codehilite><pre><span></span><code class=syntax>  +-----------|-----|------+
  | prefix          | asn   | cca2   |
  +=================+=======+========+
  | 202.79.32.0/20  | 17501 | NP     |
  +-----------|-----|------+
  | 2620:0:870::/48 | 3856  | US     |
  +-----------|-----|------+
  | 2a02:6b8:1::/48 | 13238 | RU     |
  +-----------|-----|------+
  | 2001:db8::/32   | 65536 | ZZ     |
  +-----------|-----|------+
</code></pre></div> <p>When using this type of layout, the structure must have a composite key.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;structure&gt;</span>
    <span class=nt>&lt;key&gt;</span>
        <span class=nt>&lt;attribute&gt;</span>
            <span class=nt>&lt;name&gt;</span>prefix<span class=nt>&lt;/name&gt;</span>
            <span class=nt>&lt;type&gt;</span>String<span class=nt>&lt;/type&gt;</span>
        <span class=nt>&lt;/attribute&gt;</span>
    <span class=nt>&lt;/key&gt;</span>
    <span class=nt>&lt;attribute&gt;</span>
            <span class=nt>&lt;name&gt;</span>asn<span class=nt>&lt;/name&gt;</span>
            <span class=nt>&lt;type&gt;</span>UInt32<span class=nt>&lt;/type&gt;</span>
            <span class=nt>&lt;null_value</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/attribute&gt;</span>
    <span class=nt>&lt;attribute&gt;</span>
            <span class=nt>&lt;name&gt;</span>cca2<span class=nt>&lt;/name&gt;</span>
            <span class=nt>&lt;type&gt;</span>String<span class=nt>&lt;/type&gt;</span>
            <span class=nt>&lt;null_value&gt;</span>??<span class=nt>&lt;/null_value&gt;</span>
    <span class=nt>&lt;/attribute&gt;</span>
    ...
<span class=nt>&lt;/structure&gt;</span>
<span class=nt>&lt;layout&gt;</span>
    <span class=nt>&lt;ip_trie&gt;</span>
        <span class=c>&lt;!-- Key attribute `prefix` can be retrieved via dictGetString. --&gt;</span>
        <span class=c>&lt;!-- This option increases memory usage. --&gt;</span>
        <span class=nt>&lt;access_to_key_from_attributes&gt;</span>true<span class=nt>&lt;/access_to_key_from_attributes&gt;</span>
    <span class=nt>&lt;/ip_trie&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</code></pre></div> <p>or</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span> <span class=k>DICTIONARY</span> <span class=n>somedict</span> <span class=p>(</span>
    <span class=k>prefix</span> <span class=n>String</span><span class=p>,</span>
    <span class=n>asn</span> <span class=n>UInt32</span><span class=p>,</span>
    <span class=n>cca2</span> <span class=n>String</span> <span class=k>DEFAULT</span> <span class=s1>'??'</span>
<span class=p>)</span>
<span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=k>prefix</span>
</code></pre></div> <p>The key must have only one String type attribute that contains an allowed IP prefix. Other types are not supported yet.</p> <p>For queries, you must use the same functions (<code class=syntax>dictGetT</code> with a tuple) as for dictionaries with composite keys:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>dictGetT</span><span class=p>(</span><span class=s1>'dict_name'</span><span class=p>,</span> <span class=s1>'attr_name'</span><span class=p>,</span> <span class=n>tuple</span><span class=p>(</span><span class=n>ip</span><span class=p>))</span>
</code></pre></div> <p>The function takes either <code class=syntax>UInt32</code> for IPv4, or <code class=syntax>FixedString(16)</code> for IPv6:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=n>dictGetString</span><span class=p>(</span><span class=s1>'prefix'</span><span class=p>,</span> <span class=s1>'asn'</span><span class=p>,</span> <span class=n>tuple</span><span class=p>(</span><span class=n>IPv6StringToNum</span><span class=p>(</span><span class=s1>'2001:db8::1'</span><span class=p>)))</span>
</code></pre></div> <p>Other types are not supported yet. The function returns the attribute for the prefix that corresponds to this IP address. If there are overlapping prefixes, the most specific one is returned.</p> <p>Data must completely fit into RAM.</p> <p><a href=https://clickhouse.tech/docs/en/query_language/dicts/external_dicts_dict_layout/ target=_blank>Original article</a> <!--hide--></p> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 