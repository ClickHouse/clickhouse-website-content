<!doctype html><html ⚡ lang=ru> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>Комбинаторы агрегатных функций | Документация ClickHouse</title><link href=https://clickhouse.tech/docs/ru/sql-reference/aggregate-functions/combinators/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Комбинаторы агрегатных функций | Документация ClickHouse",
"mainEntityOfPage": "https://clickhouse.tech/docs/ru/sql-reference/aggregate-functions/combinators/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Комбинаторы агрегатных функций | Документация ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ul{margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}strong{font-weight:bolder}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#212529}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn:disabled{opacity:.65}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-right{float:right}.float-lg-none{float:none}}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pb-5,.py-5{padding-bottom:3rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}@media(min-width:768px){.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}}@media(min-width:992px){.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}pre{white-space:pre-wrap}pre{border:1px solid #adb5bd;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn:disabled{cursor:default;opacity:.4}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}#content pre{background:#efefef;padding:1rem;line-height:1.25}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p,pre{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}#content pre{background:#444;color:#eee}}@media(prefers-color-scheme:dark){.syntax{background:#2d2d2d;color:#f2f0ec}.syntax .c{color:#747369}.syntax .k{color:#c9c}.syntax .n{color:#f2f0ec}.syntax .o{color:#6cc}.syntax .p{color:#f2f0ec}.syntax .c1{color:#747369}.syntax .ld{color:#9c9}.syntax .s{color:#9c9}.syntax .nb{color:#f2f0ec}.syntax .py{color:#f2f0ec}.syntax .mi{color:#f99157}.syntax .s2{color:#9c9}.syntax .s1{color:#9c9}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <h1 id=aggregate_functions_combinators>Комбинаторы агрегатных функций<a class=headerlink href=../amp/#aggregate_functions_combinators title="Permanent link"> </a></h1> <p>К имени агрегатной функции может быть приписан некоторый суффикс. При этом, работа агрегатной функции некоторым образом модифицируется.</p> <h2 id=agg-functions-combinator-if>-If<a class=headerlink href=../amp/#agg-functions-combinator-if title="Permanent link"> </a></h2> <p>К имени любой агрегатной функции может быть приписан суффикс -If. В этом случае, агрегатная функция принимает ещё один дополнительный аргумент - условие (типа UInt8). Агрегатная функция будет обрабатывать только те строки, для которых условие сработало. Если условие ни разу не сработало - возвращается некоторое значение по умолчанию (обычно - нули, пустые строки).</p> <p>Примеры: <code class=syntax>sumIf(column, cond)</code>, <code class=syntax>countIf(cond)</code>, <code class=syntax>avgIf(x, cond)</code>, <code class=syntax>quantilesTimingIf(level1, level2)(x, cond)</code>, <code class=syntax>argMinIf(arg, val, cond)</code> и т. п.</p> <p>С помощью условных агрегатных функций, вы можете вычислить агрегаты сразу для нескольких условий, не используя подзапросы и <code class=syntax>JOIN</code>-ы.<br> Например, в Яндекс.Метрике, условные агрегатные функции используются для реализации функциональности сравнения сегментов.</p> <h2 id=array>-Array<a class=headerlink href=../amp/#array title="Permanent link"> </a></h2> <p>К имени любой агрегатной функции может быть приписан суффикс -Array. В этом случае, агрегатная функция вместо аргументов типов T принимает аргументы типов Array(T) (массивы). Если агрегатная функция принимает несколько аргументов, то это должны быть массивы одинаковых длин. При обработке массивов, агрегатная функция работает, как исходная агрегатная функция по всем элементам массивов.</p> <p>Пример 1: <code class=syntax>sumArray(arr)</code> - просуммировать все элементы всех массивов arr. В данном примере можно было бы написать проще: <code class=syntax>sum(arraySum(arr))</code>.</p> <p>Пример 2: <code class=syntax>uniqArray(arr)</code> - посчитать количество уникальных элементов всех массивов arr. Это можно было бы сделать проще: <code class=syntax>uniq(arrayJoin(arr))</code>, но не всегда есть возможность добавить arrayJoin в запрос.</p> <p>Комбинаторы -If и -Array можно сочетать. При этом, должен сначала идти Array, а потом If. Примеры: <code class=syntax>uniqArrayIf(arr, cond)</code>, <code class=syntax>quantilesTimingArrayIf(level1, level2)(arr, cond)</code>. Из-за такого порядка получается, что аргумент cond не должен быть массивом.</p> <h2 id=agg-functions-combinator-simplestate>-SimpleState<a class=headerlink href=../amp/#agg-functions-combinator-simplestate title="Permanent link"> </a></h2> <p>При использовании этого комбинатора агрегатная функция возвращает то же значение, но типа <a href=../../../data-types/simpleaggregatefunction/amp/ >SimpleAggregateFunction(...)</a>. Текущее значение функции может храниться в таблице для последующей работы с таблицами семейства <a href=../../../../engines/table-engines/mergetree-family/aggregatingmergetree/amp/ >AggregatingMergeTree</a>.</p> <p><strong>Синтаксис</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>SimpleState</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div> <p><strong>Аргументы</strong></p> <ul> <li><code class=syntax>x</code> — параметры агрегатной функции.</li> </ul> <p><strong>Возвращаемое значение</strong></p> <p>Значение агрегатной функции типа <code class=syntax>SimpleAggregateFunction(...)</code>.</p> <p><strong>Пример</strong></p> <p>Запрос:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>WITH</span> <span class=n>anySimpleState</span><span class=p>(</span><span class=nb>number</span><span class=p>)</span> <span class=k>AS</span> <span class=k>c</span> <span class=k>SELECT</span> <span class=n>toTypeName</span><span class=p>(</span><span class=k>c</span><span class=p>),</span> <span class=k>c</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</code></pre></div> <p>Результат:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─toTypeName(c)────────────────────────┬─c─┐
│ SimpleAggregateFunction(any, UInt64) │ 0 │
└──────────────────────────────────────┴───┘
</code></pre></div> <h2 id=state>-State<a class=headerlink href=../amp/#state title="Permanent link"> </a></h2> <p>В случае применения этого комбинатора, агрегатная функция возвращает не готовое значение (например, в случае функции <a href=../../reference/uniq/amp/#agg_function-uniq>uniq</a> — количество уникальных значений), а промежуточное состояние агрегации (например, в случае функции <code class=syntax>uniq</code> — хэш-таблицу для расчёта количества уникальных значений), которое имеет тип <code class=syntax>AggregateFunction(...)</code> и может использоваться для дальнейшей обработки или может быть сохранено в таблицу для последующей доагрегации.</p> <p>Для работы с промежуточными состояниями предназначены:</p> <ul> <li>Движок таблиц <a href=../../../../engines/table-engines/mergetree-family/aggregatingmergetree/amp/ >AggregatingMergeTree</a>.</li> <li>Функция <a href=.././amp/#function-finalizeaggregation>finalizeAggregation</a>.</li> <li>Функция <a href=.././amp/#runningaccumulate>runningAccumulate</a>.</li> <li>Комбинатор <a href=../amp/#aggregate_functions_combinators-merge>-Merge</a>.</li> <li>Комбинатор <a href=../amp/#aggregate_functions_combinators-mergestate>-MergeState</a>.</li> </ul> <h2 id=aggregate_functions_combinators-merge>-Merge<a class=headerlink href=../amp/#aggregate_functions_combinators-merge title="Permanent link"> </a></h2> <p>В случае применения этого комбинатора, агрегатная функция будет принимать в качестве аргумента промежуточное состояние агрегации, доагрегировать (объединять вместе) эти состояния, и возвращать готовое значение.</p> <h2 id=aggregate_functions_combinators-mergestate>-MergeState<a class=headerlink href=../amp/#aggregate_functions_combinators-mergestate title="Permanent link"> </a></h2> <p>Выполняет слияние промежуточных состояний агрегации, аналогично комбинатору -Merge, но возвращает не готовое значение, а промежуточное состояние агрегации, аналогично комбинатору -State.</p> <h2 id=foreach>-ForEach<a class=headerlink href=../amp/#foreach title="Permanent link"> </a></h2> <p>Преобразует агрегатную функцию для таблиц в агрегатную функцию для массивов, которая применяет агрегирование для соответствующих элементов массивов и возвращает массив результатов. Например, <code class=syntax>sumForEach</code> для массивов <code class=syntax>[1, 2]</code>, <code class=syntax>[3, 4, 5]</code> и <code class=syntax>[6, 7]</code> даст результат <code class=syntax>[10, 13, 5]</code>, сложив соответственные элементы массивов.</p> <h2 id=agg-functions-combinator-distinct>-Distinct<a class=headerlink href=../amp/#agg-functions-combinator-distinct title="Permanent link"> </a></h2> <p>При наличии комбинатора Distinct, каждое уникальное значение аргументов, будет учитано в агрегатной функции только один раз.<br> Примеры: <code class=syntax>sum(DISTINCT x)</code>, <code class=syntax>groupArray(DISTINCT x)</code>, <code class=syntax>corrStableDistinct(DISTINCT x, y)</code> и т.п.</p> <h2 id=agg-functions-combinator-ordefault>-OrDefault<a class=headerlink href=../amp/#agg-functions-combinator-ordefault title="Permanent link"> </a></h2> <p>Изменяет поведение агрегатной функции.</p> <p>Если на вход агрегатной функции передан пустой набор данных, то с помощью комбинатора <code class=syntax>-OrDefault</code> функция возвращает значение по умолчанию для соответствующего типа данных. Комбинатор применяется к агрегатным функциям, которые могут принимать пустые входные данные.</p> <p><code class=syntax>-OrDefault</code> можно использовать с другими комбинаторами.</p> <p><strong>Синтаксис</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>OrDefault</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div> <p><strong>Аргументы</strong></p> <ul> <li><code class=syntax>x</code> — аргументы агрегатной функции.</li> </ul> <p><strong>Возращаемые зачения</strong></p> <p>Возвращает значение по умолчанию для соответствующего типа агрегатной функции, если агрегировать нечего.</p> <p>Тип данных зависит от используемой агрегатной функции.</p> <p><strong>Пример</strong></p> <p>Запрос:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=k>avg</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span> <span class=n>avgOrDefault</span><span class=p>(</span><span class=nb>number</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</code></pre></div> <p>Результат:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avg(number)─┬─avgOrDefault(number)─┐
│         nan │                    0 │
└─────────────┴──────────────────────┘
</code></pre></div> <p>Также <code class=syntax>-OrDefault</code> может использоваться с другими комбинаторами. Это полезно, когда агрегатная функция не принимает пустые входные данные.</p> <p>Запрос:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>avgOrDefaultIf</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>)</span>
<span class=k>FROM</span>
<span class=p>(</span>
    <span class=k>SELECT</span> <span class=n>toDecimal32</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>23</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=k>AS</span> <span class=n>x</span>
<span class=p>)</span>
</code></pre></div> <p>Результат:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avgOrDefaultIf(x, greater(x, 10))─┐
│                              0.00 │
└───────────────────────────────────┘
</code></pre></div> <h2 id=agg-functions-combinator-ornull>-OrNull<a class=headerlink href=../amp/#agg-functions-combinator-ornull title="Permanent link"> </a></h2> <p>Изменяет поведение агрегатной функции.</p> <p>Комбинатор преобразует результат агрегатной функции к типу <a href=../../../data-types/nullable/amp/ >Nullable</a>. Если агрегатная функция не получает данных на вход, то с комбинатором она возвращает <a href=../../../syntax/amp/#null-literal>NULL</a>.</p> <p><code class=syntax>-OrNull</code> может использоваться с другими комбинаторами.</p> <p><strong>Синтаксис</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>OrNull</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div> <p><strong>Аргументы</strong></p> <ul> <li><code class=syntax>x</code> — аргументы агрегатной функции.</li> </ul> <p><strong>Возвращаемые значения</strong></p> <ul> <li>Результат агрегатной функции, преобразованный в тип данных <code class=syntax>Nullable</code>.</li> <li><code class=syntax>NULL</code>, если у агрегатной функции нет входных данных.</li> </ul> <p>Тип: <code class=syntax>Nullable(aggregate function return type)</code>.</p> <p><strong>Пример</strong></p> <p>Добавьте <code class=syntax>-orNull</code> в конец агрегатной функции.</p> <p>Запрос:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>sumOrNull</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span> <span class=n>toTypeName</span><span class=p>(</span><span class=n>sumOrNull</span><span class=p>(</span><span class=nb>number</span><span class=p>))</span> <span class=k>FROM</span> <span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=k>WHERE</span> <span class=nb>number</span> <span class=o>&gt;</span> <span class=mi>10</span>
</code></pre></div> <p>Результат:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─sumOrNull(number)─┬─toTypeName(sumOrNull(number))─┐
│              ᴺᵁᴸᴸ │ Nullable(UInt64)              │
└───────────────────┴───────────────────────────────┘
</code></pre></div> <p>Также <code class=syntax>-OrNull</code> может использоваться с другими комбинаторами. Это полезно, когда агрегатная функция не принимает пустые входные данные.</p> <p>Запрос:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>avgOrNullIf</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>)</span>
<span class=k>FROM</span>
<span class=p>(</span>
    <span class=k>SELECT</span> <span class=n>toDecimal32</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>23</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=k>AS</span> <span class=n>x</span>
<span class=p>)</span>
</code></pre></div> <p>Результат:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avgOrNullIf(x, greater(x, 10))─┐
│                           ᴺᵁᴸᴸ │
└────────────────────────────────┘
</code></pre></div> <h2 id=agg-functions-combinator-resample>-Resample<a class=headerlink href=../amp/#agg-functions-combinator-resample title="Permanent link"> </a></h2> <p>Позволяет поделить данные на группы, а затем по-отдельности агрегирует данные для этих групп. Группы образуются разбиением значений одного из столбцов на интервалы.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>Resample</span><span class=p>(</span><span class=k>start</span><span class=p>,</span> <span class=k>end</span><span class=p>,</span> <span class=n>step</span><span class=p>)(</span><span class=o>&lt;</span><span class=n>aggFunction_params</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>resampling_key</span><span class=p>)</span>
</code></pre></div> <p><strong>Аргументы</strong></p> <ul> <li><code class=syntax>start</code> — начальное значение для интервала значений <code class=syntax>resampling_key</code>.</li> <li><code class=syntax>stop</code> — конечное значение для интервала значений <code class=syntax>resampling_key</code>. Интервал не включает значение <code class=syntax>stop</code> (<code class=syntax>[start, stop)</code>).</li> <li><code class=syntax>step</code> — шаг деления полного интервала на подинтервалы. Функция <code class=syntax>aggFunction</code> выполняется для каждого из подинтервалов независимо.</li> <li><code class=syntax>resampling_key</code> — столбец, значения которого используются для разделения данных на интервалы.</li> <li><code class=syntax>aggFunction_params</code> — параметры <code class=syntax>aggFunction</code>.</li> </ul> <p><strong>Возвращаемые значения</strong></p> <ul> <li>Массив результатов <code class=syntax>aggFunction</code> для каждого подинтервала.</li> </ul> <p><strong>Пример</strong></p> <p>Рассмотрим таблицу <code class=syntax>people</code> со следующими данными:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─name───┬─age─┬─wage─┐
│ John   │  16 │   10 │
│ Alice  │  30 │   15 │
│ Mary   │  35 │    8 │
│ Evelyn │  48 │ 11.5 │
│ David  │  62 │  9.9 │
│ Brian  │  60 │   16 │
└────────┴─────┴──────┘
</code></pre></div> <p>Получим имена людей, чей возраст находится в интервалах <code class=syntax>[30,60)</code> и <code class=syntax>[60,75)</code>. Поскольку мы используем целочисленное представление возраста, то интервалы будут выглядеть как <code class=syntax>[30, 59]</code> и <code class=syntax>[60,74]</code>.</p> <p>Чтобы собрать имена в массив, возьмём агрегатную функцию <a href=../../reference/grouparray/amp/#agg_function-grouparray>groupArray</a>. Она принимает один аргумент. В нашем случае, это столбец <code class=syntax>name</code>. Функция <code class=syntax>groupArrayResample</code> должна использовать столбец <code class=syntax>age</code> для агрегирования имён по возрасту. Чтобы определить необходимые интервалы, передадим в функцию <code class=syntax>groupArrayResample</code> аргументы <code class=syntax>30, 75, 30</code>.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span> <span class=n>groupArrayResample</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>30</span><span class=p>)(</span><span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>)</span> <span class=k>from</span> <span class=n>people</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─groupArrayResample(30, 75, 30)(name, age)─────┐
│ [['Alice','Mary','Evelyn'],['David','Brian']] │
└───────────────────────────────────────────────┘
</code></pre></div> <p>Посмотрим на результаты.</p> <p><code class=syntax>Jonh</code> не попал в выдачу, поскольку слишком молод. Остальные распределены согласно заданным возрастным интервалам.</p> <p>Теперь посчитаем общее количество людей и их среднюю заработную плату в заданных возрастных интервалах.</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span>
    <span class=n>countResample</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>30</span><span class=p>)(</span><span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>)</span> <span class=k>AS</span> <span class=n>amount</span><span class=p>,</span>
    <span class=n>avgResample</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>30</span><span class=p>)(</span><span class=n>wage</span><span class=p>,</span> <span class=n>age</span><span class=p>)</span> <span class=k>AS</span> <span class=n>avg_wage</span>
<span class=k>FROM</span> <span class=n>people</span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─amount─┬─avg_wage──────────────────┐
│ [3,2]  │ [11.5,12.949999809265137] │
└────────┴───────────────────────────┘
</code></pre></div> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2021 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/878a159538935028f2d2dce3eb3074d44eb191df rel="external nofollow noreferrer" target=_blank class=text-reset>878a159538</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/ru/sql-reference/aggregate-functions/combinators/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 