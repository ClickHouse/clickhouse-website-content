










    



    



    



    
    






    
        
        
    
    <!DOCTYPE html>
<html lang="ru" data-version="master" data-single-page="false">
<head>
    
<meta charset="utf-8" />
<META http-equiv="Content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>2020 | Документация ClickHouse</title>

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/logo-180x180.png" />

<meta property="og:title" content="2020 | Документация ClickHouse"/>
<meta property="og:description" content="ClickHouse release 20.12 ClickHouse release v20.12.5.14-stable, 2020-12-28 Bug Fix Disable write with AIO during merges " />
<meta property="og:type" content="article" />

<meta property="og:image" content="https://clickhouse.tech/images/logo.png" />

<meta property="og:url" content="https://clickhouse.com/docs/ru/whats-new/changelog/2020/"/>
<link rel="canonical" href="https://clickhouse.com/docs/en/whats-new/changelog/2020/" />

<link rel="amphtml" href="https://clickhouse.com/docs/ru/whats-new/changelog/2020/amp/" />

<link rel="search" href="/opensearch.xml" title="ClickHouse" type="application/opensearchdescription+xml" />

<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "2020 | Документация ClickHouse",
"mainEntityOfPage": "https://clickhouse.com/docs/ru/whats-new/changelog/2020/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "2020 | Документация ClickHouse",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>


<meta name="description" content="ClickHouse release 20.12 ClickHouse release v20.12.5.14-stable, 2020-12-28 Bug Fix Disable write with AIO during merges " />

<meta name="keywords"
      content="ClickHouse, DBMS, OLAP, SQL, open-source, relational, analytics, analytical, Big Data, web-analytics" />




    
    <link rel="alternate" hreflang="en" href="https://clickhouse.com/docs/en/whats-new/changelog/2020/" />
    
    <link rel="alternate" hreflang="zh" href="https://clickhouse.com/docs/zh/whats-new/changelog/2020/" />
    
    <link rel="alternate" hreflang="ru" href="https://clickhouse.com/docs/ru/whats-new/changelog/2020/" />
    
    <link rel="alternate" hreflang="ja" href="https://clickhouse.com/docs/ja/whats-new/changelog/2020/" />
    
    <link rel="alternate" hreflang="x-default" href="https://clickhouse.com/docs/en/whats-new/changelog/2020/" />





    
    <link href="/css/base.css?css_digest" media="all" rel="stylesheet" />


</head>
<body dir="ltr" data-spy="scroll" data-target="#toc" data-offset="80">
    
    <div class="page">
        
    
        <nav id="top-nav" class="navbar py-1 navbar-dark navbar-expand-md bg-dark-alt text-white fixed-top">
    <div class="container-fluid justify-content-between">
        <a class="d-block navbar-brand mr-3" href="/">
            <img id="docs-logo-icon" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"/>
        </a>
        <div class="w-100 navbar-text text-left d-none d-md-block">
            <h1 class="h3 m-0 p-0 d-inline">
                <a href="#" class="text-white text-decoration-none">
                    
                        2020
                    
                </a>
            </h1>
        </div>

        <div class="d-none d-md-block">
            <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-end">
                
                    
                
                
                <li id="edit-wrapper" class="nav-item">
                    <a id="edit-link" href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/whats-new/changelog/2020.md" title="Edit this article" class="nav-link" rel="external nofollow noreferrer" target="_blank"><img src="/images/mkdocs/edit.svg" alt="Edit this article" height="60" /></a>
                </li>
                
                <li class="nav-item">
                     <a class="nav-link" href="https://github.com/ClickHouse/ClickHouse" rel="external nofollow noreferrer">
                        <img src="/images/index/github.svg" alt="GitHub repository" title="Go to GitHub" height="72" />
                    </a>
                </li>
                <li id="languages-wrapper" class="nav-item dropdown mr-3">
                    <div id="languages-dropdown">
                        <a class="nav-link dropdown-toggle d-inline-block mt-1 text-muted" href="#" id="lang-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img src="/images/flags/ru.svg" alt="Русский" title="Русский" width="60" class="d-inline-block mt-n1" />
                        </a>
                        <div class="dropdown-menu bg-dark" aria-labelledby="lang-dropdown">
                            
                            <a class="dropdown-item"
                               href="/docs/en/whats-new/changelog/2020/">
                                <img src="/images/flags/en.svg" alt="" title="" width="32" class="d-inline-block mr-2" />English
                            </a>
                            
                            <a class="dropdown-item"
                               href="/docs/zh/whats-new/changelog/2020/">
                                <img src="/images/flags/zh.svg" alt="" title="" width="32" class="d-inline-block mr-2" />中文
                            </a>
                            
                            <a class="dropdown-item disabled"
                               href="/docs/ru/whats-new/changelog/2020/">
                                <img src="/images/flags/ru.svg" alt="" title="" width="32" class="d-inline-block mr-2" />Русский
                            </a>
                            
                            <a class="dropdown-item"
                               href="/docs/ja/whats-new/changelog/2020/">
                                <img src="/images/flags/ja.svg" alt="" title="" width="32" class="d-inline-block mr-2" />日本語
                            </a>
                            
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <form id="search-form" class="form-inline m-0">
            <div class="input-group">
                <div class="input-group-prepend w-100">
                    <span class="input-group-text bg-secondary-alt text-muted border-0 mr-n1" id="search-icon">
                        <img src="/images/mkdocs/search.svg" />
                    </span>
                    <input id="docsearch-input" class="form-control bg-secondary-alt text-muted border-0 pl-1" type="search" placeholder="Search" aria-label="Search">
                </div>
            </div>
        </form>

        <button id="navbar-toggler" class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#sidebar" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</nav>
        <div class="docs container-fluid mt-3">
            <div class="row justify-content-end justify-content-xl-center">
                <div id="sidebar" class="col-xl-2 col-md-4 bg-secondary-alt p-3 d-print-none min-vh-100 overflow-auto">
    <div class="overflow-auto">
        <div id="single-page-switch" class="btn-group mb-2 float-right" role="group" aria-label="Multi-page or single-page">
            <a href="../../.." role="button" class="btn btn-dark active" aria-pressed="true">
                <img src="/images/mkdocs/multi.svg" alt="Multi-page version" title="Multi-page version" />
            </a>
            <a href="../../../single/" role="button" class="btn btn-dark-alt active" aria-pressed="true">
                <img src="/images/mkdocs/single.svg" alt="Single-page version" title="Single-page version" />
            </a>
        </div>
        
        <nav id="sidebar-nav" class="nav flex-column mb-5">
            
                
                
                


<a href="#sidebar-sidebar-1" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-1" title="Введение" class="nav-link text-light dropdown-toggle px-0">Введение</a>
<div id="sidebar-sidebar-1" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../" title="Обзор" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a>


    
        
        
        

    
        
        
        


<a href="../../../introduction/distinctive-features/" title="Отличительные возможности ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Отличительные возможности ClickHouse</a>


    
        
        
        


<a href="../../../introduction/performance/" title="Производительность" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Производительность</a>


    
        
        
        


<a href="../../../introduction/history/" title="История ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">История ClickHouse</a>


    
        
        
        


<a href="../../../introduction/adopters/" title="Adopters" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Adopters</a>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-2" title="Начало работы" class="nav-link text-light dropdown-toggle px-0">Начало работы</a>
<div id="sidebar-sidebar-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../getting-started/install/" title="Установка" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Установка</a>


    
        
        
        


<a href="../../../getting-started/tutorial/" title="Tutorial" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tutorial</a>


    
        
        
        


<a href="../../../getting-started/playground/" title="Playground" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Playground</a>


    
        
        
        


<a href="#sidebar-sidebar-2-5" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-2-5" title="Тестовые массивы данных" class="nav-link text-light dropdown-toggle px-0">Тестовые массивы данных</a>
<div id="sidebar-sidebar-2-5" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../getting-started/example-datasets/github-events/" title="GitHub Events" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GitHub Events</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/metrica/" title="Анонимизированные данные Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Анонимизированные данные Яндекс.Метрики</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/star-schema/" title="Star Schema Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Star Schema Benchmark</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/recipes/" title="Набор данных кулинарных рецептов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Набор данных кулинарных рецептов</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/wikistat/" title="WikiStat" class="nav-link text-light text-wrap d-inline-block w-100 px-0">WikiStat</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/criteo/" title="Терабайт логов кликов от Criteo" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Терабайт логов кликов от Criteo</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/amplab-benchmark/" title="AMPLab Big Data Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AMPLab Big Data Benchmark</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/brown-benchmark/" title="Brown University Benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Brown University Benchmark</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/nyc-taxi/" title="Данные о такси в Нью-Йорке" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Данные о такси в Нью-Йорке</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/opensky/" title="Набор данных о воздушном движении OpenSky Network 2020" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Набор данных о воздушном движении OpenSky Network 2020</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/uk-price-paid/" title="Набор данных о стоимости недвижимости в Великобритании" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Набор данных о стоимости недвижимости в Великобритании</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/menus/" title="Menus" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Menus</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/ontime/" title="OnTime" class="nav-link text-light text-wrap d-inline-block w-100 px-0">OnTime</a>


    
        
        
        


<a href="../../../getting-started/example-datasets/cell-towers/" title="Вышки сотовой связи" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Вышки сотовой связи</a>


    
    </nav>
</div>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-3" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-3" title="Интерфейсы" class="nav-link text-light dropdown-toggle px-0">Интерфейсы</a>
<div id="sidebar-sidebar-3" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../interfaces/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../interfaces/cli/" title="Клиент командной строки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиент командной строки</a>


    
        
        
        


<a href="../../../interfaces/tcp/" title="Родной интерфейс (TCP)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Родной интерфейс (TCP)</a>


    
        
        
        


<a href="../../../interfaces/http/" title="HTTP-интерфейс" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HTTP-интерфейс</a>


    
        
        
        


<a href="../../../interfaces/mysql/" title="MySQL-интерфейс" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL-интерфейс</a>


    
        
        
        


<a href="../../../interfaces/formats/" title="Форматы входных и выходных данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Форматы входных и выходных данных</a>


    
        
        
        


<a href="../../../interfaces/jdbc/" title="JDBC-драйвер" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC-драйвер</a>


    
        
        
        


<a href="../../../interfaces/odbc/" title="ODBC-драйвер" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC-драйвер</a>


    
        
        
        


<a href="../../../interfaces/cpp/" title="C++ клиентская библиотека" class="nav-link text-light text-wrap d-inline-block w-100 px-0">C++ клиентская библиотека</a>


    
        
        
        


<a href="#sidebar-sidebar-3-10" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-3-10" title="Сторонние интерфейсы" class="nav-link text-light dropdown-toggle px-0">Сторонние интерфейсы</a>
<div id="sidebar-sidebar-3-10" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../interfaces/third-party/" title="Сторонние интерфейсы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Сторонние интерфейсы</a>


    
        
        
        


<a href="../../../interfaces/third-party/client-libraries/" title="Клиентские библиотеки от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Клиентские библиотеки от сторонних разработчиков</a>


    
        
        
        


<a href="../../../interfaces/third-party/integrations/" title="Библиотеки для интеграции от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Библиотеки для интеграции от сторонних разработчиков</a>


    
        
        
        


<a href="../../../interfaces/third-party/gui/" title="Визуальные интерфейсы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Визуальные интерфейсы от сторонних разработчиков</a>


    
        
        
        


<a href="../../../interfaces/third-party/proxy/" title="Прокси-серверы от сторонних разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прокси-серверы от сторонних разработчиков</a>


    
    </nav>
</div>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-4" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4" title="Engines" class="nav-link text-light dropdown-toggle px-0">Engines</a>
<div id="sidebar-sidebar-4" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="#sidebar-sidebar-4-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4-2" title="Движки таблиц" class="nav-link text-light dropdown-toggle px-0">Движки таблиц</a>
<div id="sidebar-sidebar-4-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../engines/table-engines/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="#sidebar-sidebar-4-2-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4-2-2" title="MergeTree Family" class="nav-link text-light dropdown-toggle px-0">MergeTree Family</a>
<div id="sidebar-sidebar-4-2-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/mergetree/" title="MergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MergeTree</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/replication/" title="Репликация данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Репликация данных</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/custom-partitioning-key/" title="Произвольный ключ партиционирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Произвольный ключ партиционирования</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/replacingmergetree/" title="ReplacingMergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ReplacingMergeTree</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/summingmergetree/" title="SummingMergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SummingMergeTree</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/aggregatingmergetree/" title="AggregatingMergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregatingMergeTree</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/collapsingmergetree/" title="CollapsingMergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">CollapsingMergeTree</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/versionedcollapsingmergetree/" title="VersionedCollapsingMergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">VersionedCollapsingMergeTree</a>


    
        
        
        


<a href="../../../engines/table-engines/mergetree-family/graphitemergetree/" title="GraphiteMergeTree" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GraphiteMergeTree</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-4-2-3" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4-2-3" title="Семейство Log" class="nav-link text-light dropdown-toggle px-0">Семейство Log</a>
<div id="sidebar-sidebar-4-2-3" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../engines/table-engines/log-family/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../engines/table-engines/log-family/stripelog/" title="StripeLog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">StripeLog</a>


    
        
        
        


<a href="../../../engines/table-engines/log-family/log/" title="Log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Log</a>


    
        
        
        


<a href="../../../engines/table-engines/log-family/tinylog/" title="TinyLog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">TinyLog</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-4-2-4" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4-2-4" title="Движки таблиц для интеграции" class="nav-link text-light dropdown-toggle px-0">Движки таблиц для интеграции</a>
<div id="sidebar-sidebar-4-2-4" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../engines/table-engines/integrations/odbc/" title="ODBC" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ODBC</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/jdbc/" title="JDBC" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JDBC</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/mysql/" title="MySQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/s3/" title="S3" class="nav-link text-light text-wrap d-inline-block w-100 px-0">S3</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/mongodb/" title="MongoDB" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MongoDB</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/hdfs/" title="HDFS" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HDFS</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/sqlite/" title="SQLite" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQLite</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/kafka/" title="Kafka" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kafka</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/embedded-rocksdb/" title="EmbeddedRocksDB" class="nav-link text-light text-wrap d-inline-block w-100 px-0">EmbeddedRocksDB</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/postgresql/" title="PostgreSQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">PostgreSQL</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/ExternalDistributed/" title="ExternalDistributed" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ExternalDistributed</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/materialized-postgresql/" title="MaterializedPostgreSQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedPostgreSQL</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/" title="Движки таблиц для интеграции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Движки таблиц для интеграции</a>


    
        
        
        


<a href="../../../engines/table-engines/integrations/rabbitmq/" title="RabbitMQ" class="nav-link text-light text-wrap d-inline-block w-100 px-0">RabbitMQ</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-4-2-5" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4-2-5" title="Специальные движки таблиц" class="nav-link text-light dropdown-toggle px-0">Специальные движки таблиц</a>
<div id="sidebar-sidebar-4-2-5" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../engines/table-engines/special/" title="Специальные движки таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Специальные движки таблиц</a>


    
        
        
        


<a href="../../../engines/table-engines/special/distributed/" title="Distributed" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Distributed</a>


    
        
        
        


<a href="../../../engines/table-engines/special/dictionary/" title="Dictionary" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Dictionary</a>


    
        
        
        


<a href="../../../engines/table-engines/special/merge/" title="Merge" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Merge</a>


    
        
        
        


<a href="../../../engines/table-engines/special/file/" title="File" class="nav-link text-light text-wrap d-inline-block w-100 px-0">File</a>


    
        
        
        


<a href="../../../engines/table-engines/special/null/" title="Null" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Null</a>


    
        
        
        


<a href="../../../engines/table-engines/special/set/" title="Set" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a>


    
        
        
        


<a href="../../../engines/table-engines/special/join/" title="Join" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Join</a>


    
        
        
        


<a href="../../../engines/table-engines/special/url/" title="URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">URL</a>


    
        
        
        


<a href="../../../engines/table-engines/special/view/" title="View" class="nav-link text-light text-wrap d-inline-block w-100 px-0">View</a>


    
        
        
        


<a href="../../../engines/table-engines/special/materializedview/" title="MaterializedView" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedView</a>


    
        
        
        


<a href="../../../engines/table-engines/special/memory/" title="Memory" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Memory</a>


    
        
        
        


<a href="../../../engines/table-engines/special/buffer/" title="Buffer" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Buffer</a>


    
        
        
        


<a href="../../../engines/table-engines/special/external-data/" title="Внешние данные для обработки запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние данные для обработки запроса</a>


    
        
        
        


<a href="../../../engines/table-engines/special/generate/" title="GenerateRandom" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GenerateRandom</a>


    
    </nav>
</div>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-4-3" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-4-3" title="Движки баз данных" class="nav-link text-light dropdown-toggle px-0">Движки баз данных</a>
<div id="sidebar-sidebar-4-3" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../engines/database-engines/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../engines/database-engines/materialized-mysql/" title="[experimental] MaterializedMySQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">[experimental] MaterializedMySQL</a>


    
        
        
        


<a href="../../../engines/database-engines/materialized-postgresql/" title="MaterializedPostgreSQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MaterializedPostgreSQL</a>


    
        
        
        


<a href="../../../engines/database-engines/mysql/" title="MySQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">MySQL</a>


    
        
        
        


<a href="../../../engines/database-engines/lazy/" title="Lazy" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Lazy</a>


    
        
        
        


<a href="../../../engines/database-engines/atomic/" title="Atomic" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Atomic</a>


    
        
        
        


<a href="../../../engines/database-engines/sqlite/" title="SQLite" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQLite</a>


    
        
        
        


<a href="../../../engines/database-engines/postgresql/" title="PostgreSQL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">PostgreSQL</a>


    
        
        
        


<a href="../../../engines/database-engines/replicated/" title="Replicated" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Replicated</a>


    
    </nav>
</div>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-5" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5" title="Справка по SQL" class="nav-link text-light dropdown-toggle px-0">Справка по SQL</a>
<div id="sidebar-sidebar-5" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="#sidebar-sidebar-5-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-2" title="Выражения" class="nav-link text-light dropdown-toggle px-0">Выражения</a>
<div id="sidebar-sidebar-5-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/statements/" title="SQL выражения в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SQL выражения в ClickHouse</a>


    
        
        
        


<a href="#sidebar-sidebar-5-2-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-2-2" title="SELECT" class="nav-link text-light dropdown-toggle px-0">SELECT</a>
<div id="sidebar-sidebar-5-2-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/statements/select/" title="Обзор" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/all/" title="ALL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALL</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/array-join/" title="ARRAY JOIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ARRAY JOIN</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/distinct/" title="DISTINCT" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DISTINCT</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/format/" title="FORMAT" class="nav-link text-light text-wrap d-inline-block w-100 px-0">FORMAT</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/from/" title="FROM" class="nav-link text-light text-wrap d-inline-block w-100 px-0">FROM</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/group-by/" title="GROUP BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GROUP BY</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/having/" title="HAVING" class="nav-link text-light text-wrap d-inline-block w-100 px-0">HAVING</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/into-outfile/" title="INTO OUTFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INTO OUTFILE</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/join/" title="JOIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JOIN</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/limit/" title="LIMIT" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/limit-by/" title="LIMIT BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LIMIT BY</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/offset/" title="OFFSET" class="nav-link text-light text-wrap d-inline-block w-100 px-0">OFFSET</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/order-by/" title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/prewhere/" title="PREWHERE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">PREWHERE</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/sample/" title="SAMPLE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/union/" title="UNION" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UNION</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/where/" title="WHERE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">WHERE</a>


    
        
        
        


<a href="../../../sql-reference/statements/select/with/" title="WITH" class="nav-link text-light text-wrap d-inline-block w-100 px-0">WITH</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/statements/insert-into/" title="INSERT INTO" class="nav-link text-light text-wrap d-inline-block w-100 px-0">INSERT INTO</a>


    
        
        
        


<a href="#sidebar-sidebar-5-2-4" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-2-4" title="CREATE" class="nav-link text-light dropdown-toggle px-0">CREATE</a>
<div id="sidebar-sidebar-5-2-4" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/statements/create/" title="Обзор" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/database/" title="База данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">База данных</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/table/" title="Таблица" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Таблица</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/view/" title="Представление" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Представление</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/function/" title="FUNCTION" class="nav-link text-light text-wrap d-inline-block w-100 px-0">FUNCTION</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/dictionary/" title="Словарь" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Словарь</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/user/" title="Пользователь" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Пользователь</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/role/" title="Роль" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Роль</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/row-policy/" title="Политика доступа" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Политика доступа</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/quota/" title="Квота" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квота</a>


    
        
        
        


<a href="../../../sql-reference/statements/create/settings-profile/" title="Профиль настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профиль настроек</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-2-5" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-2-5" title="ALTER" class="nav-link text-light dropdown-toggle px-0">ALTER</a>
<div id="sidebar-sidebar-5-2-5" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/statements/alter/" title="ALTER" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ALTER</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/column/" title="Манипуляции со столбцами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции со столбцами</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/partition/" title="PARTITION" class="nav-link text-light text-wrap d-inline-block w-100 px-0">PARTITION</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/setting/" title="SETTING" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SETTING</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/delete/" title="DELETE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DELETE</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/update/" title="UPDATE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UPDATE</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/order-by/" title="ORDER BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ORDER BY</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/sample-by/" title="SAMPLE BY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SAMPLE BY</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/index/" title="Манипуляции с индексами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции с индексами</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/constraint/" title="Манипуляции с ограничениями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Манипуляции с ограничениями</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/ttl/" title="TTL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">TTL</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/user/" title="USER" class="nav-link text-light text-wrap d-inline-block w-100 px-0">USER</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/quota/" title="QUOTA" class="nav-link text-light text-wrap d-inline-block w-100 px-0">QUOTA</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/role/" title="ROLE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ROLE</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/row-policy/" title="ROW POLICY" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ROW POLICY</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/settings-profile/" title="SETTINGS PROFILE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SETTINGS PROFILE</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/projection/" title="PROJECTION" class="nav-link text-light text-wrap d-inline-block w-100 px-0">PROJECTION</a>


    
        
        
        


<a href="../../../sql-reference/statements/alter/view/" title="VIEW" class="nav-link text-light text-wrap d-inline-block w-100 px-0">VIEW</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/statements/system/" title="SYSTEM" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SYSTEM</a>


    
        
        
        


<a href="../../../sql-reference/statements/show/" title="SHOW" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SHOW</a>


    
        
        
        


<a href="../../../sql-reference/statements/grant/" title="GRANT" class="nav-link text-light text-wrap d-inline-block w-100 px-0">GRANT</a>


    
        
        
        


<a href="../../../sql-reference/statements/explain/" title="EXPLAIN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">EXPLAIN</a>


    
        
        
        


<a href="../../../sql-reference/statements/revoke/" title="REVOKE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">REVOKE</a>


    
        
        
        


<a href="../../../sql-reference/statements/attach/" title="ATTACH" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ATTACH</a>


    
        
        
        


<a href="../../../sql-reference/statements/check-table/" title="CHECK" class="nav-link text-light text-wrap d-inline-block w-100 px-0">CHECK</a>


    
        
        
        

    
        
        
        


<a href="../../../sql-reference/statements/describe-table/" title="DESCRIBE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DESCRIBE</a>


    
        
        
        


<a href="../../../sql-reference/statements/detach/" title="DETACH" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DETACH</a>


    
        
        
        


<a href="../../../sql-reference/statements/drop/" title="DROP" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DROP</a>


    
        
        
        


<a href="../../../sql-reference/statements/exists/" title="EXISTS" class="nav-link text-light text-wrap d-inline-block w-100 px-0">EXISTS</a>


    
        
        
        


<a href="../../../sql-reference/statements/kill/" title="KILL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">KILL</a>


    
        
        
        


<a href="../../../sql-reference/statements/optimize/" title="OPTIMIZE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">OPTIMIZE</a>


    
        
        
        


<a href="../../../sql-reference/statements/rename/" title="RENAME" class="nav-link text-light text-wrap d-inline-block w-100 px-0">RENAME</a>


    
        
        
        


<a href="../../../sql-reference/statements/exchange/" title="EXCHANGE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">EXCHANGE</a>


    
        
        
        


<a href="../../../sql-reference/statements/set/" title="SET" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SET</a>


    
        
        
        


<a href="../../../sql-reference/statements/set-role/" title="SET ROLE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SET ROLE</a>


    
        
        
        


<a href="../../../sql-reference/statements/truncate/" title="TRUNCATE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">TRUNCATE</a>


    
        
        
        


<a href="../../../sql-reference/statements/use/" title="USE" class="nav-link text-light text-wrap d-inline-block w-100 px-0">USE</a>


    
        
        
        


<a href="../../../sql-reference/statements/watch/" title="WATCH" class="nav-link text-light text-wrap d-inline-block w-100 px-0">WATCH</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/syntax/" title="Синтаксис" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Синтаксис</a>


    
        
        
        


<a href="../../../sql-reference/distributed-ddl/" title="Распределенные DDL запросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Распределенные DDL запросы</a>


    
        
        
        


<a href="#sidebar-sidebar-5-5" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-5" title="Функции" class="nav-link text-light dropdown-toggle px-0">Функции</a>
<div id="sidebar-sidebar-5-5" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/functions/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../sql-reference/functions/arithmetic-functions/" title="Арифметические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Арифметические функции</a>


    
        
        
        


<a href="../../../sql-reference/functions/array-functions/" title="Массивы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Массивы</a>


    
        
        
        


<a href="../../../sql-reference/functions/comparison-functions/" title="Функции сравнения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции сравнения</a>


    
        
        
        


<a href="../../../sql-reference/functions/logical-functions/" title="Логические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Логические функции</a>


    
        
        
        


<a href="../../../sql-reference/functions/type-conversion-functions/" title="Функции преобразования типов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции преобразования типов</a>


    
        
        
        


<a href="../../../sql-reference/functions/date-time-functions/" title="Функции для работы с датами и временем" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с датами и временем</a>


    
        
        
        


<a href="../../../sql-reference/functions/string-functions/" title="Функции для работы со строками" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со строками</a>


    
        
        
        


<a href="../../../sql-reference/functions/string-search-functions/" title="Функции поиска в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска в строках</a>


    
        
        
        


<a href="../../../sql-reference/functions/string-replace-functions/" title="Функции поиска и замены в строках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции поиска и замены в строках</a>


    
        
        
        


<a href="../../../sql-reference/functions/conditional-functions/" title="Условные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Условные функции</a>


    
        
        
        


<a href="../../../sql-reference/functions/files/" title="Функции для работы с файлами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с файлами</a>


    
        
        
        


<a href="../../../sql-reference/functions/math-functions/" title="Математические функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Математические функции</a>


    
        
        
        


<a href="../../../sql-reference/functions/rounding-functions/" title="Функции округления" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции округления</a>


    
        
        
        


<a href="../../../sql-reference/functions/tuple-map-functions/" title="Работа с контейнерами map" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Работа с контейнерами map</a>


    
        
        
        


<a href="../../../sql-reference/functions/splitting-merging-functions/" title="Функции разбиения и слияния строк и массивов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции разбиения и слияния строк и массивов</a>


    
        
        
        


<a href="../../../sql-reference/functions/bit-functions/" title="Битовые функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Битовые функции</a>


    
        
        
        


<a href="../../../sql-reference/functions/bitmap-functions/" title="Функции для битмапов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для битмапов</a>


    
        
        
        


<a href="../../../sql-reference/functions/hash-functions/" title="Функции хэширования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции хэширования</a>


    
        
        
        


<a href="../../../sql-reference/functions/random-functions/" title="Функции генерации псевдослучайных чисел" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции генерации псевдослучайных чисел</a>


    
        
        
        


<a href="../../../sql-reference/functions/encoding-functions/" title="Функции кодирования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции кодирования</a>


    
        
        
        


<a href="../../../sql-reference/functions/uuid-functions/" title="Функции для работы с UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с UUID</a>


    
        
        
        


<a href="../../../sql-reference/functions/url-functions/" title="Функции для работы с URL" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с URL</a>


    
        
        
        


<a href="../../../sql-reference/functions/ip-address-functions/" title="Функции для работы с IP-адресами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с IP-адресами</a>


    
        
        
        


<a href="../../../sql-reference/functions/json-functions/" title="JSON" class="nav-link text-light text-wrap d-inline-block w-100 px-0">JSON</a>


    
        
        
        


<a href="../../../sql-reference/functions/ext-dict-functions/" title="Функции для работы с внешними словарями" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с внешними словарями</a>


    
        
        
        


<a href="../../../sql-reference/functions/ym-dict-functions/" title="Функции для работы со словарями Яндекс.Метрики" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы со словарями Яндекс.Метрики</a>


    
        
        
        


<a href="../../../sql-reference/functions/in-functions/" title="Функции для реализации оператора IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для реализации оператора IN</a>


    
        
        
        


<a href="../../../sql-reference/functions/array-join/" title="Функция ArrayJoin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функция ArrayJoin</a>


    
        
        
        


<a href="#sidebar-sidebar-5-5-30" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-5-30" title="Гео-данные" class="nav-link text-light dropdown-toggle px-0">Гео-данные</a>
<div id="sidebar-sidebar-5-5-30" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../sql-reference/functions/geo/coordinates/" title="Функции для работы с географическими координатами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с географическими координатами</a>


    
        
        
        


<a href="../../../sql-reference/functions/geo/h3/" title="Функции для работы с индексами H3" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с индексами H3</a>


    
        
        
        


<a href="../../../sql-reference/functions/geo/geohash/" title="Функции для работы с системой Geohash" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с системой Geohash</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/functions/functions-for-nulls/" title="Функции для работы с Nullable-аргументами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с Nullable-аргументами</a>


    
        
        
        


<a href="../../../sql-reference/functions/machine-learning-functions/" title="Функции машинного обучения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции машинного обучения</a>


    
        
        
        


<a href="../../../sql-reference/functions/introspection/" title="Функции интроспекции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции интроспекции</a>


    
        
        
        


<a href="../../../sql-reference/functions/other-functions/" title="Прочие функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Прочие функции</a>


    
        
        
        


<a href="../../../sql-reference/functions/nlp-functions/" title="NLP" class="nav-link text-light text-wrap d-inline-block w-100 px-0">NLP</a>


    
        
        
        


<a href="../../../sql-reference/functions/encryption-functions/" title="Функции для шифрования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для шифрования</a>


    
        
        
        


<a href="../../../sql-reference/functions/tuple-functions/" title="Функции для работы с кортежами" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для работы с кортежами</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-6" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-6" title="Агрегатные функции" class="nav-link text-light dropdown-toggle px-0">Агрегатные функции</a>
<div id="sidebar-sidebar-5-6" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/aggregate-functions/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="#sidebar-sidebar-5-6-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-6-2" title="Справочник" class="nav-link text-light dropdown-toggle px-0">Справочник</a>
<div id="sidebar-sidebar-5-6-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/count/" title="count" class="nav-link text-light text-wrap d-inline-block w-100 px-0">count</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/min/" title="min" class="nav-link text-light text-wrap d-inline-block w-100 px-0">min</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/max/" title="max" class="nav-link text-light text-wrap d-inline-block w-100 px-0">max</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/sum/" title="sum" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sum</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/avg/" title="avg" class="nav-link text-light text-wrap d-inline-block w-100 px-0">avg</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/any/" title="any" class="nav-link text-light text-wrap d-inline-block w-100 px-0">any</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/stddevpop/" title="stddevPop" class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevPop</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/stddevsamp/" title="stddevSamp" class="nav-link text-light text-wrap d-inline-block w-100 px-0">stddevSamp</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/varpop/" title="varPop(x)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">varPop(x)</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/varsamp/" title="varSamp" class="nav-link text-light text-wrap d-inline-block w-100 px-0">varSamp</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/covarpop/" title="covarPop" class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarPop</a>


    
        
        
        

    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/covarsamp/" title="covarSamp" class="nav-link text-light text-wrap d-inline-block w-100 px-0">covarSamp</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/anyheavy/" title="anyHeavy" class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyHeavy</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/anylast/" title="anyLast" class="nav-link text-light text-wrap d-inline-block w-100 px-0">anyLast</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/argmin/" title="argMin" class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMin</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/argmax/" title="argMax" class="nav-link text-light text-wrap d-inline-block w-100 px-0">argMax</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/avgweighted/" title="avgWeighted" class="nav-link text-light text-wrap d-inline-block w-100 px-0">avgWeighted</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/corr/" title="corr" class="nav-link text-light text-wrap d-inline-block w-100 px-0">corr</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/topk/" title="topK" class="nav-link text-light text-wrap d-inline-block w-100 px-0">topK</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/topkweighted/" title="topKWeighted" class="nav-link text-light text-wrap d-inline-block w-100 px-0">topKWeighted</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/grouparray/" title="groupArray" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArray</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupuniqarray/" title="groupUniqArray" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupUniqArray</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/grouparrayinsertat/" title="groupArrayInsertAt" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayInsertAt</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/grouparraymovingsum/" title="groupArrayMovingSum" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingSum</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/grouparraymovingavg/" title="groupArrayMovingAvg" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArrayMovingAvg</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/grouparraysample/" title="groupArraySample" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupArraySample</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitand/" title="groupBitAnd" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitAnd</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitor/" title="groupBitOr" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitOr</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitxor/" title="groupBitXor" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitXor</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitmap/" title="groupBitmap" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmap</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitmapand/" title="groupBitmapAnd" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmapAnd</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitmapor/" title="groupBitmapOr" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmapOr</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/groupbitmapxor/" title="groupBitmapXor" class="nav-link text-light text-wrap d-inline-block w-100 px-0">groupBitmapXor</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/sumwithoverflow/" title="sumWithOverflow" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumWithOverflow</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/deltasum/" title="deltaSum" class="nav-link text-light text-wrap d-inline-block w-100 px-0">deltaSum</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/deltasumtimestamp/" title="deltaSumTimestamp" class="nav-link text-light text-wrap d-inline-block w-100 px-0">deltaSumTimestamp</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/summap/" title="sumMap(key, value), sumMap(Tuple(key, value))" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumMap(key, value), sumMap(Tuple(key, value))</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/minmap/" title="minMap" class="nav-link text-light text-wrap d-inline-block w-100 px-0">minMap</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/maxmap/" title="maxMap" class="nav-link text-light text-wrap d-inline-block w-100 px-0">maxMap</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/sumcount/" title="sumCount" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumCount</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/rankCorr/" title="rankCorr" class="nav-link text-light text-wrap d-inline-block w-100 px-0">rankCorr</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/sumkahan/" title="sumKahan" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sumKahan</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/intervalLengthSum/" title="intervalLengthSum" class="nav-link text-light text-wrap d-inline-block w-100 px-0">intervalLengthSum</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/skewpop/" title="skewPop" class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewPop</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/skewsamp/" title="skewSamp" class="nav-link text-light text-wrap d-inline-block w-100 px-0">skewSamp</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/kurtpop/" title="kurtPop" class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtPop</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/kurtsamp/" title="kurtSamp" class="nav-link text-light text-wrap d-inline-block w-100 px-0">kurtSamp</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/uniq/" title="uniq" class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniq</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/uniqexact/" title="uniqExact" class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqExact</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/uniqcombined/" title="uniqCombined" class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/uniqcombined64/" title="uniqCombined64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqCombined64</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/uniqhll12/" title="uniqHLL12" class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqHLL12</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/uniqthetasketch/" title="uniqTheta" class="nav-link text-light text-wrap d-inline-block w-100 px-0">uniqTheta</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantile/" title="quantile" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantile</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantiles/" title="Функции для нескольких квантилей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции для нескольких квантилей</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantileexact/" title="Функции quantileExact" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Функции quantileExact</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantileexactweighted/" title="quantileExactWeighted" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileExactWeighted</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantiletiming/" title="quantileTiming" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTiming</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantiletimingweighted/" title="quantileTimingWeighted" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTimingWeighted</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantiledeterministic/" title="quantileDeterministic" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileDeterministic</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantiletdigest/" title="quantileTDigest" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigest</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantiletdigestweighted/" title="quantileTDigestWeighted" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileTDigestWeighted</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/quantilebfloat16/" title="quantileBFloat16" class="nav-link text-light text-wrap d-inline-block w-100 px-0">quantileBFloat16</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/simplelinearregression/" title="simpleLinearRegression" class="nav-link text-light text-wrap d-inline-block w-100 px-0">simpleLinearRegression</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/stochasticlinearregression/" title="stochasticLinearRegression" class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLinearRegression</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/stochasticlogisticregression/" title="stochasticLogisticRegression" class="nav-link text-light text-wrap d-inline-block w-100 px-0">stochasticLogisticRegression</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/categoricalinformationvalue/" title="categoricalInformationValue" class="nav-link text-light text-wrap d-inline-block w-100 px-0">categoricalInformationValue</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/studentttest/" title="studentTTest" class="nav-link text-light text-wrap d-inline-block w-100 px-0">studentTTest</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/welchttest/" title="welchTTest" class="nav-link text-light text-wrap d-inline-block w-100 px-0">welchTTest</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/mannwhitneyutest/" title="mannWhitneyUTest" class="nav-link text-light text-wrap d-inline-block w-100 px-0">mannWhitneyUTest</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/reference/median/" title="median" class="nav-link text-light text-wrap d-inline-block w-100 px-0">median</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/combinators/" title="Комбинаторы агрегатных функций" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Комбинаторы агрегатных функций</a>


    
        
        
        


<a href="../../../sql-reference/aggregate-functions/parametric-functions/" title="Параметрические агрегатные функции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Параметрические агрегатные функции</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-7" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-7" title="Табличные функции" class="nav-link text-light dropdown-toggle px-0">Табличные функции</a>
<div id="sidebar-sidebar-5-7" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/table-functions/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/file/" title="file" class="nav-link text-light text-wrap d-inline-block w-100 px-0">file</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/merge/" title="merge" class="nav-link text-light text-wrap d-inline-block w-100 px-0">merge</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/numbers/" title="numbers" class="nav-link text-light text-wrap d-inline-block w-100 px-0">numbers</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/remote/" title="remote" class="nav-link text-light text-wrap d-inline-block w-100 px-0">remote</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/url/" title="url" class="nav-link text-light text-wrap d-inline-block w-100 px-0">url</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/mysql/" title="mysql" class="nav-link text-light text-wrap d-inline-block w-100 px-0">mysql</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/postgresql/" title="postgresql" class="nav-link text-light text-wrap d-inline-block w-100 px-0">postgresql</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/jdbc/" title="jdbc" class="nav-link text-light text-wrap d-inline-block w-100 px-0">jdbc</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/odbc/" title="odbc" class="nav-link text-light text-wrap d-inline-block w-100 px-0">odbc</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/hdfs/" title="hdfs" class="nav-link text-light text-wrap d-inline-block w-100 px-0">hdfs</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/s3/" title="s3" class="nav-link text-light text-wrap d-inline-block w-100 px-0">s3</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/input/" title="input" class="nav-link text-light text-wrap d-inline-block w-100 px-0">input</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/generate/" title="generateRandom" class="nav-link text-light text-wrap d-inline-block w-100 px-0">generateRandom</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/cluster/" title="cluster" class="nav-link text-light text-wrap d-inline-block w-100 px-0">cluster</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/null/" title="null функция" class="nav-link text-light text-wrap d-inline-block w-100 px-0">null функция</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/dictionary/" title="dictionary" class="nav-link text-light text-wrap d-inline-block w-100 px-0">dictionary</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/s3Cluster/" title="s3Cluster" class="nav-link text-light text-wrap d-inline-block w-100 px-0">s3Cluster</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/sqlite/" title="sqlite" class="nav-link text-light text-wrap d-inline-block w-100 px-0">sqlite</a>


    
        
        
        


<a href="../../../sql-reference/table-functions/view/" title="view" class="nav-link text-light text-wrap d-inline-block w-100 px-0">view</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-8" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-8" title="Словари" class="nav-link text-light dropdown-toggle px-0">Словари</a>
<div id="sidebar-sidebar-5-8" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/dictionaries/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="#sidebar-sidebar-5-8-2" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-8-2" title="Внешние словари" class="nav-link text-light dropdown-toggle px-0">Внешние словари</a>
<div id="sidebar-sidebar-5-8-2" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts/" title="Внешние словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Внешние словари</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict/" title="Настройка внешнего словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройка внешнего словаря</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-layout/" title="Хранение словарей в памяти" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение словарей в памяти</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-lifetime/" title="Обновление словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление словарей</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-sources/" title="Источники внешних словарей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Источники внешних словарей</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-structure/" title="Ключ и поля словаря" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ключ и поля словаря</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-hierarchical/" title="Иерархические словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Иерархические словари</a>


    
        
        
        


<a href="../../../sql-reference/dictionaries/external-dictionaries/external-dicts-dict-polygon/" title="Cловари полигонов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Cловари полигонов</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/dictionaries/internal-dicts/" title="Встроенные словари" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Встроенные словари</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-9" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-9" title="Типы данных" class="nav-link text-light dropdown-toggle px-0">Типы данных</a>
<div id="sidebar-sidebar-5-9" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/data-types/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../sql-reference/data-types/int-uint/" title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64</a>


    
        
        
        


<a href="../../../sql-reference/data-types/float/" title="Float32, Float64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Float32, Float64</a>


    
        
        
        


<a href="../../../sql-reference/data-types/decimal/" title="Decimal" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Decimal</a>


    
        
        
        


<a href="../../../sql-reference/data-types/boolean/" title="Булевы значения" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Булевы значения</a>


    
        
        
        


<a href="../../../sql-reference/data-types/string/" title="String" class="nav-link text-light text-wrap d-inline-block w-100 px-0">String</a>


    
        
        
        


<a href="../../../sql-reference/data-types/fixedstring/" title="FixedString(N)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">FixedString(N)</a>


    
        
        
        


<a href="../../../sql-reference/data-types/uuid/" title="UUID" class="nav-link text-light text-wrap d-inline-block w-100 px-0">UUID</a>


    
        
        
        


<a href="../../../sql-reference/data-types/date/" title="Date" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date</a>


    
        
        
        


<a href="../../../sql-reference/data-types/date32/" title="Date32" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Date32</a>


    
        
        
        


<a href="../../../sql-reference/data-types/datetime/" title="DateTime" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime</a>


    
        
        
        


<a href="../../../sql-reference/data-types/datetime64/" title="DateTime64" class="nav-link text-light text-wrap d-inline-block w-100 px-0">DateTime64</a>


    
        
        
        


<a href="../../../sql-reference/data-types/enum/" title="Enum" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Enum</a>


    
        
        
        


<a href="../../../sql-reference/data-types/lowcardinality/" title="LowCardinality" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LowCardinality</a>


    
        
        
        


<a href="../../../sql-reference/data-types/array/" title="Array(T)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Array(T)</a>


    
        
        
        


<a href="../../../sql-reference/data-types/aggregatefunction/" title="AggregateFunction" class="nav-link text-light text-wrap d-inline-block w-100 px-0">AggregateFunction</a>


    
        
        
        


<a href="../../../sql-reference/data-types/tuple/" title="Tuple(T1, T2, ...)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Tuple(T1, T2, ...)</a>


    
        
        
        


<a href="#sidebar-sidebar-5-9-18" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-9-18" title="Вложенные структуры данных" class="nav-link text-light dropdown-toggle px-0">Вложенные структуры данных</a>
<div id="sidebar-sidebar-5-9-18" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../sql-reference/data-types/nested-data-structures/nested/" title="Nested" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nested</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/data-types/nullable/" title="Nullable" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nullable</a>


    
        
        
        


<a href="#sidebar-sidebar-5-9-20" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-9-20" title="Служебные типы данных" class="nav-link text-light dropdown-toggle px-0">Служебные типы данных</a>
<div id="sidebar-sidebar-5-9-20" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../sql-reference/data-types/special-data-types/expression/" title="Expression" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Expression</a>


    
        
        
        


<a href="../../../sql-reference/data-types/special-data-types/set/" title="Set" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Set</a>


    
        
        
        


<a href="../../../sql-reference/data-types/special-data-types/nothing/" title="Nothing" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Nothing</a>


    
        
        
        


<a href="../../../sql-reference/data-types/special-data-types/interval/" title="Interval" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Interval</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-9-21" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-9-21" title="Домены" class="nav-link text-light dropdown-toggle px-0">Домены</a>
<div id="sidebar-sidebar-5-9-21" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/data-types/domains/" title="Домены" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Домены</a>


    
        
        
        


<a href="../../../sql-reference/data-types/domains/ipv4/" title="IPv4" class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv4</a>


    
        
        
        


<a href="../../../sql-reference/data-types/domains/ipv6/" title="IPv6" class="nav-link text-light text-wrap d-inline-block w-100 px-0">IPv6</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/data-types/multiword-types/" title="Составные типы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Составные типы</a>


    
        
        
        


<a href="../../../sql-reference/data-types/geo/" title="Географические структуры" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Географические структуры</a>


    
        
        
        


<a href="../../../sql-reference/data-types/map/" title="Map(key, value)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Map(key, value)</a>


    
        
        
        


<a href="../../../sql-reference/data-types/simpleaggregatefunction/" title="SimpleAggregateFunction(func, type)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">SimpleAggregateFunction(func, type)</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-5-10" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-10" title="Операторы" class="nav-link text-light dropdown-toggle px-0">Операторы</a>
<div id="sidebar-sidebar-5-10" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/operators/" title="Операторы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы</a>


    
        
        
        


<a href="../../../sql-reference/operators/in/" title="Операторы IN" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операторы IN</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../sql-reference/ansi/" title="ANSI Compatibility" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ANSI Compatibility</a>


    
        
        
        


<a href="#sidebar-sidebar-5-12" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-5-12" title="Window Functions" class="nav-link text-light dropdown-toggle px-0">Window Functions</a>
<div id="sidebar-sidebar-5-12" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../sql-reference/window-functions/" title="Window Functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Window Functions</a>


    
    </nav>
</div>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-6" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-6" title="Руководства" class="nav-link text-light dropdown-toggle px-0">Руководства</a>
<div id="sidebar-sidebar-6" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../guides/" title="Обзор" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a>


    
        
        
        


<a href="../../../guides/apply-catboost-model/" title="Применение модели CatBoost в ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение модели CatBoost в ClickHouse</a>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-7" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7" title="Эксплуатация" class="nav-link text-light dropdown-toggle px-0">Эксплуатация</a>
<div id="sidebar-sidebar-7" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../operations/" title="Эксплуатация" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Эксплуатация</a>


    
        
        
        


<a href="../../../operations/requirements/" title="Требования" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Требования</a>


    
        
        
        


<a href="../../../operations/monitoring/" title="Мониторинг" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Мониторинг</a>


    
        
        
        


<a href="../../../operations/troubleshooting/" title="Устранение неисправностей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Устранение неисправностей</a>


    
        
        
        


<a href="../../../operations/update/" title="Обновление ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обновление ClickHouse</a>


    
        
        
        


<a href="#sidebar-sidebar-7-6" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7-6" title="Внешние аутентификаторы пользователей и каталоги" class="nav-link text-light dropdown-toggle px-0">Внешние аутентификаторы пользователей и каталоги</a>
<div id="sidebar-sidebar-7-6" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../operations/external-authenticators/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../operations/external-authenticators/kerberos/" title="Kerberos" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Kerberos</a>


    
        
        
        


<a href="../../../operations/external-authenticators/ldap/" title="LDAP" class="nav-link text-light text-wrap d-inline-block w-100 px-0">LDAP</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../operations/access-rights/" title="Управление доступом" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Управление доступом</a>


    
        
        
        


<a href="../../../operations/backup/" title="Резервное копирование данных" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Резервное копирование данных</a>


    
        
        
        


<a href="../../../operations/configuration-files/" title="Конфигурационные файлы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные файлы</a>


    
        
        
        


<a href="../../../operations/quotas/" title="Квоты" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Квоты</a>


    
        
        
        


<a href="#sidebar-sidebar-7-11" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7-11" title="Optimizing Performance" class="nav-link text-light dropdown-toggle px-0">Optimizing Performance</a>
<div id="sidebar-sidebar-7-11" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../operations/optimizing-performance/sampling-query-profiler/" title="Query Profiling" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Query Profiling</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-7-12" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7-12" title="Системные таблицы" class="nav-link text-light dropdown-toggle px-0">Системные таблицы</a>
<div id="sidebar-sidebar-7-12" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../operations/system-tables/" title="Системные таблицы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Системные таблицы</a>


    
        
        
        


<a href="../../../operations/system-tables/asynchronous_metric_log/" title="system.asynchronous_metric_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.asynchronous_metric_log</a>


    
        
        
        


<a href="../../../operations/system-tables/asynchronous_metrics/" title="system.asynchronous_metrics" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.asynchronous_metrics</a>


    
        
        
        


<a href="../../../operations/system-tables/clusters/" title="system.clusters" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.clusters</a>


    
        
        
        


<a href="../../../operations/system-tables/columns/" title="system.columns" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.columns</a>


    
        
        
        


<a href="../../../operations/system-tables/contributors/" title="system.contributors" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.contributors</a>


    
        
        
        


<a href="../../../operations/system-tables/crash-log/" title="system.crash_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.crash_log</a>


    
        
        
        


<a href="../../../operations/system-tables/current-roles/" title="system.current_roles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.current_roles</a>


    
        
        
        


<a href="../../../operations/system-tables/data_skipping_indices/" title="system.data_skipping_indices" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.data_skipping_indices</a>


    
        
        
        


<a href="../../../operations/system-tables/data_type_families/" title="system.data_type_families" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.data_type_families</a>


    
        
        
        


<a href="../../../operations/system-tables/databases/" title="system.databases" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.databases</a>


    
        
        
        


<a href="../../../operations/system-tables/detached_parts/" title="system.detached_parts" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.detached_parts</a>


    
        
        
        


<a href="../../../operations/system-tables/dictionaries/" title="system.dictionaries" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.dictionaries</a>


    
        
        
        


<a href="../../../operations/system-tables/disks/" title="system.disks" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.disks</a>


    
        
        
        


<a href="../../../operations/system-tables/distributed_ddl_queue/" title="system.distributed_ddl_queue" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.distributed_ddl_queue</a>


    
        
        
        


<a href="../../../operations/system-tables/distribution_queue/" title="system.distribution_queue" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.distribution_queue</a>


    
        
        
        


<a href="../../../operations/system-tables/enabled-roles/" title="system.enabled_roles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.enabled_roles</a>


    
        
        
        


<a href="../../../operations/system-tables/errors/" title="system.errors" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.errors</a>


    
        
        
        


<a href="../../../operations/system-tables/events/" title="system.events" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.events</a>


    
        
        
        


<a href="../../../operations/system-tables/functions/" title="system.functions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.functions</a>


    
        
        
        


<a href="../../../operations/system-tables/grants/" title="system.grants" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.grants</a>


    
        
        
        


<a href="../../../operations/system-tables/graphite_retentions/" title="system.graphite_retentions" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.graphite_retentions</a>


    
        
        
        


<a href="../../../operations/system-tables/licenses/" title="system.licenses" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.licenses</a>


    
        
        
        


<a href="../../../operations/system-tables/merge_tree_settings/" title="system.merge_tree_settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.merge_tree_settings</a>


    
        
        
        


<a href="../../../operations/system-tables/merges/" title="system.merges" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.merges</a>


    
        
        
        


<a href="../../../operations/system-tables/metric_log/" title="system.metric_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.metric_log</a>


    
        
        
        


<a href="../../../operations/system-tables/metrics/" title="system.metrics" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.metrics</a>


    
        
        
        


<a href="../../../operations/system-tables/mutations/" title="system.mutations" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.mutations</a>


    
        
        
        


<a href="../../../operations/system-tables/numbers/" title="system.numbers" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.numbers</a>


    
        
        
        


<a href="../../../operations/system-tables/numbers_mt/" title="system.numbers_mt" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.numbers_mt</a>


    
        
        
        


<a href="../../../operations/system-tables/one/" title="system.one" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.one</a>


    
        
        
        


<a href="../../../operations/system-tables/opentelemetry_span_log/" title="system.opentelemetry_span_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.opentelemetry_span_log</a>


    
        
        
        


<a href="../../../operations/system-tables/part_log/" title="system.part_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.part_log</a>


    
        
        
        


<a href="../../../operations/system-tables/parts/" title="system.parts" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.parts</a>


    
        
        
        


<a href="../../../operations/system-tables/parts_columns/" title="system.parts_columns" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.parts_columns</a>


    
        
        
        


<a href="../../../operations/system-tables/processes/" title="system.processes" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.processes</a>


    
        
        
        


<a href="../../../operations/system-tables/query_log/" title="system.query_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_log</a>


    
        
        
        


<a href="../../../operations/system-tables/query_thread_log/" title="system.query_thread_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_thread_log</a>


    
        
        
        


<a href="../../../operations/system-tables/query_views_log/" title="system.query_views_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.query_views_log</a>


    
        
        
        


<a href="../../../operations/system-tables/quota_limits/" title="system.quota_limits" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quota_limits</a>


    
        
        
        


<a href="../../../operations/system-tables/quota_usage/" title="system.quota_usage" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quota_usage</a>


    
        
        
        


<a href="../../../operations/system-tables/quotas/" title="system.quotas" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quotas</a>


    
        
        
        


<a href="../../../operations/system-tables/quotas_usage/" title="system.quotas_usage" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.quotas_usage</a>


    
        
        
        


<a href="../../../operations/system-tables/replicas/" title="system.replicas" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replicas</a>


    
        
        
        


<a href="../../../operations/system-tables/replicated_fetches/" title="system.replicated_fetches" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replicated_fetches</a>


    
        
        
        


<a href="../../../operations/system-tables/replication_queue/" title="system.replication_queue" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.replication_queue</a>


    
        
        
        


<a href="../../../operations/system-tables/role-grants/" title="system.role_grants" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.role_grants</a>


    
        
        
        


<a href="../../../operations/system-tables/roles/" title="system.roles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.roles</a>


    
        
        
        


<a href="../../../operations/system-tables/row_policies/" title="system.row_policies" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.row_policies</a>


    
        
        
        


<a href="../../../operations/system-tables/settings/" title="system.settings" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings</a>


    
        
        
        


<a href="../../../operations/system-tables/settings_profile_elements/" title="system.settings_profile_elements" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings_profile_elements</a>


    
        
        
        


<a href="../../../operations/system-tables/settings_profiles/" title="system.settings_profiles" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.settings_profiles</a>


    
        
        
        


<a href="../../../operations/system-tables/stack_trace/" title="system.stack_trace" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.stack_trace</a>


    
        
        
        


<a href="../../../operations/system-tables/storage_policies/" title="system.storage_policies" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.storage_policies</a>


    
        
        
        


<a href="../../../operations/system-tables/table_engines/" title="system.table_engines" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.table_engines</a>


    
        
        
        


<a href="../../../operations/system-tables/tables/" title="system.tables" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.tables</a>


    
        
        
        


<a href="../../../operations/system-tables/text_log/" title="system.text_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.text_log</a>


    
        
        
        


<a href="../../../operations/system-tables/time_zones/" title="system.time_zones" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.time_zones</a>


    
        
        
        


<a href="../../../operations/system-tables/trace_log/" title="system.trace_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.trace_log</a>


    
        
        
        


<a href="../../../operations/system-tables/users/" title="system.users" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.users</a>


    
        
        
        


<a href="../../../operations/system-tables/zookeeper/" title="system.zookeeper" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.zookeeper</a>


    
        
        
        


<a href="../../../operations/system-tables/zookeeper_log/" title="system.zookeeper_log" class="nav-link text-light text-wrap d-inline-block w-100 px-0">system.zookeeper_log</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../operations/performance-test/" title="Testing Hardware" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Testing Hardware</a>


    
        
        
        


<a href="#sidebar-sidebar-7-14" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7-14" title="Конфигурационные параметры сервера" class="nav-link text-light dropdown-toggle px-0">Конфигурационные параметры сервера</a>
<div id="sidebar-sidebar-7-14" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../operations/server-configuration-parameters/" title="Введение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Введение</a>


    
        
        
        


<a href="../../../operations/server-configuration-parameters/settings/" title="Конфигурационные параметры сервера" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Конфигурационные параметры сервера</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-7-15" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7-15" title="Settings" class="nav-link text-light dropdown-toggle px-0">Settings</a>
<div id="sidebar-sidebar-7-15" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../operations/settings/" title="Introduction" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Introduction</a>


    
        
        
        


<a href="../../../operations/settings/permissions-for-queries/" title="Разрешения для запросов" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Разрешения для запросов</a>


    
        
        
        


<a href="../../../operations/settings/query-complexity/" title="Ограничения на сложность запроса" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на сложность запроса</a>


    
        
        
        


<a href="../../../operations/settings/settings/" title="Настройки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки</a>


    
        
        
        


<a href="../../../operations/settings/settings-profiles/" title="Профили настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Профили настроек</a>


    
        
        
        


<a href="../../../operations/settings/constraints-on-settings/" title="Ограничения на изменение настроек" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Ограничения на изменение настроек</a>


    
        
        
        


<a href="../../../operations/settings/settings-users/" title="Настройки пользователей" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки пользователей</a>


    
        
        
        


<a href="../../../operations/settings/merge-tree-settings/" title="Настройки MergeTree таблиц" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Настройки MergeTree таблиц</a>


    
    </nav>
</div>


    
        
        
        


<a href="#sidebar-sidebar-7-16" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-7-16" title="Утилиты" class="nav-link text-light dropdown-toggle px-0">Утилиты</a>
<div id="sidebar-sidebar-7-16" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../operations/utilities/" title="Обзор" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор</a>


    
        
        
        


<a href="../../../operations/utilities/clickhouse-copier/" title="clickhouse-copier" class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-copier</a>


    
        
        
        


<a href="../../../operations/utilities/clickhouse-local/" title="clickhouse-local" class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-local</a>


    
        
        
        


<a href="../../../operations/utilities/clickhouse-benchmark/" title="clickhouse-benchmark" class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-benchmark</a>


    
        
        
        


<a href="../../../operations/utilities/clickhouse-format/" title="clickhouse-format" class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-format</a>


    
        
        
        


<a href="../../../operations/utilities/clickhouse-compressor/" title="ClickHouse compressor" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse compressor</a>


    
        
        
        


<a href="../../../operations/utilities/odbc-bridge/" title="clickhouse-odbc-bridge" class="nav-link text-light text-wrap d-inline-block w-100 px-0">clickhouse-odbc-bridge</a>


    
        
        
        


<a href="../../../operations/utilities/clickhouse-obfuscator/" title="Обфускатор ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обфускатор ClickHouse</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../operations/tips/" title="Usage Recommendations" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Usage Recommendations</a>


    
        
        
        


<a href="../../../operations/opentelemetry/" title="Поддержка OpenTelemetry" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поддержка OpenTelemetry</a>


    
        
        
        


<a href="../../../operations/caches/" title="Кеши" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Кеши</a>


    
        
        
        


<a href="../../../operations/clickhouse-keeper/" title="ClickHouse Keeper" class="nav-link text-light text-wrap d-inline-block w-100 px-0">ClickHouse Keeper</a>


    
        
        
        


<a href="../../../operations/storing-data/" title="Хранение данных на внешних дисках" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Хранение данных на внешних дисках</a>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-8" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-8" title="Development" class="nav-link text-light dropdown-toggle px-0">Development</a>
<div id="sidebar-sidebar-8" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        

    
        
        
        


<a href="../../../development/developer-instruction/" title="Инструкция для разработчиков" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Инструкция для разработчиков</a>


    
        
        
        


<a href="../../../development/continuous-integration/" title="Continuous Integration Checks" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Continuous Integration Checks</a>


    
        
        
        


<a href="../../../development/architecture/" title="Обзор архитектуры ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Обзор архитектуры ClickHouse</a>


    
        
        
        


<a href="../../../development/build/" title="Build on Linux" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux</a>


    
        
        
        


<a href="../../../development/build-osx/" title="Сборка на Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Сборка на Mac OS X</a>


    
        
        
        


<a href="../../../development/build-cross-osx/" title="Build on Linux for Mac OS X" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux for Mac OS X</a>


    
        
        
        


<a href="../../../development/build-cross-arm/" title="Build on Linux for AARCH64 (ARM64)" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Build on Linux for AARCH64 (ARM64)</a>


    
        
        
        


<a href="../../../development/style/" title="Как писать код на C++" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Как писать код на C++</a>


    
        
        
        


<a href="../../../development/tests/" title="Testing" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Testing</a>


    
        
        
        


<a href="../../../development/contrib/" title="Используемые сторонние библиотеки" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Используемые сторонние библиотеки</a>


    
        
        
        


<a href="../../../development/browse-code/" title="Навигация по коду ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Навигация по коду ClickHouse</a>


    
        
        
        


<a href="../../../development/cmake-in-clickhouse/" title="CMake in ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">CMake in ClickHouse</a>


    
        
        
        


<a href="../../../development/adding_test_queries/" title="How to add test queries to ClickHouse CI" class="nav-link text-light text-wrap d-inline-block w-100 px-0">How to add test queries to ClickHouse CI</a>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-9" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-9" title="Коммерческие услуги" class="nav-link text-light dropdown-toggle px-0">Коммерческие услуги</a>
<div id="sidebar-sidebar-9" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../commercial/cloud/" title="Поставщики облачных услуг ClickHouse" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Поставщики облачных услуг ClickHouse</a>


    
        
        
        


<a href="../../../commercial/support/" title="Support" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Support</a>


    
        
        
        


<a href="../../../commercial/" title="Коммерческие услуги" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Коммерческие услуги</a>


    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-10" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-10" title="F.A.Q." class="nav-link text-light dropdown-toggle px-0">F.A.Q.</a>
<div id="sidebar-sidebar-10" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../faq/general/" title="Общие вопросы" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Общие вопросы</a>


    
        
        
        


<a href="../../../faq/use-cases/" title="Применение" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Применение</a>


    
        
        
        


<a href="../../../faq/operations/" title="Операции" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Операции</a>


    
        
        
        


<a href="../../../faq/integration/" title="Интеграция" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Интеграция</a>


    
        
        
        

    
    </nav>
</div>


            
                
                
                


<a href="#sidebar-sidebar-11" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-11" title="Что нового?" class="nav-link text-light dropdown-toggle px-0">Что нового?</a>
<div id="sidebar-sidebar-11" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="#sidebar-sidebar-11-1" data-toggle="collapse" aria-expanded="false" aria-controls="sidebar-sidebar-11-1" title="Changelog" class="nav-link text-light dropdown-toggle px-0">Changelog</a>
<div id="sidebar-sidebar-11-1" class="nav flex-column collapse">
    <nav class="nav flex-column pl-2">
    
    
        
        
        


<a href="../../../whats-new/changelog/" title="2021" class="nav-link text-light text-wrap d-inline-block w-100 px-0">2021</a>


    
        
        
        


<a href="../../../whats-new/changelog/2020/" title="2020" class="nav-link text-white active text-wrap d-inline-block w-100 px-0">2020</a>


    
        
        
        


<a href="../../../whats-new/changelog/2019/" title="2019" class="nav-link text-light text-wrap d-inline-block w-100 px-0">2019</a>


    
        
        
        


<a href="../../../whats-new/changelog/2018/" title="2018" class="nav-link text-light text-wrap d-inline-block w-100 px-0">2018</a>


    
        
        
        


<a href="../../../whats-new/changelog/2017/" title="2017" class="nav-link text-light text-wrap d-inline-block w-100 px-0">2017</a>


    
    </nav>
</div>


    
        
        
        


<a href="../../../whats-new/extended-roadmap/" title="Roadmap" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Roadmap</a>


    
        
        
        


<a href="../../../whats-new/security-changelog/" title="Security Changelog" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Security Changelog</a>


    
        
        
        


<a href="../../../whats-new/" title="Что нового в ClickHouse?" class="nav-link text-light text-wrap d-inline-block w-100 px-0">Что нового в ClickHouse?</a>


    
    </nav>
</div>


            
            <a href="../../../single/clickhouse_ru.pdf" class="nav-link border-top border-secondary mt-3 px-0 pt-3 text-light">
                <img src="/images/mkdocs/pdf.svg" alt="PDF version" title="PDF version" height="24" class="d-block mr-1 float-left" /><div>PDF version</div>
            </a>
        </nav>
        
    </div>
</div>
                <div id="content-wrapper" class="col-md-8 mt-5 p-2 p-md-4">
    <div id="content">
        
            
            
            
                
                <nav class="text-muted" aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0">
                        
                        
                        
                        <li class="breadcrumb-item"><a href="../../" class="text-reset">Что нового?</a>
                            
                        </li>
                       
                        
                        
                        <li class="breadcrumb-item"><a href="../" class="text-reset">Changelog</a>
                            
                        </li>
                       
                    </ol>
                </nav>
            

            
            <h3 id="clickhouse-release-20-12">ClickHouse release 20.12<a class="headerlink" href="#clickhouse-release-20-12" title="Permanent link"> </a></h3>
<h3 id="clickhouse-release-v20-12-5-14-stable-2020-12-28">ClickHouse release v20.12.5.14-stable, 2020-12-28<a class="headerlink" href="#clickhouse-release-v20-12-5-14-stable-2020-12-28" title="Permanent link"> </a></h3>
<h4 id="bug-fix">Bug Fix<a class="headerlink" href="#bug-fix" title="Permanent link"> </a></h4>
<ul>
<li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" rel="external nofollow noreferrer" target="_blank">#18481</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">value is too short</code> error when executing <code class="syntax">toType(...)</code> functions (<code class="syntax">toDate</code>, <code class="syntax">toUInt32</code>, etc) with argument of type <code class="syntax">Nullable(String)</code>. Now such functions return <code class="syntax">NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" rel="external nofollow noreferrer" target="_blank">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" rel="external nofollow noreferrer" target="_blank">#18445</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" rel="external nofollow noreferrer" target="_blank">#18381</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix filling table <code class="syntax">system.settings_profile_elements</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18231" rel="external nofollow noreferrer" target="_blank">#18231</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18379" rel="external nofollow noreferrer" target="_blank">#18379</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix possible crashes in aggregate functions with combinator <code class="syntax">Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" rel="external nofollow noreferrer" target="_blank">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" rel="external nofollow noreferrer" target="_blank">#18365</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix error when query <code class="syntax">MODIFY COLUMN ... REMOVE TTL</code> does not actually remove column TTL. <a href="https://github.com/ClickHouse/ClickHouse/pull/18130" rel="external nofollow noreferrer" target="_blank">#18130</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement" title="Permanent link"> </a></h4>
<ul>
<li>Update timezones info to 2020e. <a href="https://github.com/ClickHouse/ClickHouse/pull/18531" rel="external nofollow noreferrer" target="_blank">#18531</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-12-4-5-stable-2020-12-24">ClickHouse release v20.12.4.5-stable, 2020-12-24<a class="headerlink" href="#clickhouse-release-v20-12-4-5-stable-2020-12-24" title="Permanent link"> </a></h3>
<h4 id="bug-fix_1">Bug Fix<a class="headerlink" href="#bug-fix_1" title="Permanent link"> </a></h4>
<ul>
<li>Fixed issue when <code class="syntax">clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual IPv4/IPv6 stack; - Fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes; Possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" rel="external nofollow noreferrer" target="_blank">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" rel="external nofollow noreferrer" target="_blank">#18278</a> (<a href="https://github.com/traceon" rel="external nofollow noreferrer" target="_blank">Denis Glazachev</a>).</li>
<li>Fixed key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" rel="external nofollow noreferrer" target="_blank">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" rel="external nofollow noreferrer" target="_blank">#18214</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed unique key convert crash in <code class="syntax">MaterializeMySQL</code> database engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" rel="external nofollow noreferrer" target="_blank">#18186</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" rel="external nofollow noreferrer" target="_blank">#16372</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" rel="external nofollow noreferrer" target="_blank">#18211</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" rel="external nofollow noreferrer" target="_blank">#18059</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fixed the issue when some tables not synchronized to ClickHouse from MySQL caused by the fact that convertion MySQL prefix index wasn't supported for MaterializeMySQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" rel="external nofollow noreferrer" target="_blank">#15187</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" rel="external nofollow noreferrer" target="_blank">#17912</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" rel="external nofollow noreferrer" target="_blank">#17944</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed the issue when query optimization was producing wrong result if query contains <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" rel="external nofollow noreferrer" target="_blank">#17887</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Fixed possible segfault in <code class="syntax">topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" rel="external nofollow noreferrer" target="_blank">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" rel="external nofollow noreferrer" target="_blank">#17845</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Fixed empty <code class="syntax">system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" rel="external nofollow noreferrer" target="_blank">#17630</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-12-3-3-stable-2020-12-13">ClickHouse release v20.12.3.3-stable, 2020-12-13<a class="headerlink" href="#clickhouse-release-v20-12-3-3-stable-2020-12-13" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change" title="Permanent link"> </a></h4>
<ul>
<li>Enable <code class="syntax">use_compact_format_in_distributed_parts_names</code> by default (see the documentation for the reference). <a href="https://github.com/ClickHouse/ClickHouse/pull/16728" rel="external nofollow noreferrer" target="_blank">#16728</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Accept user settings related to file formats (e.g. <code class="syntax">format_csv_delimiter</code>) in the <code class="syntax">SETTINGS</code> clause when creating a table that uses <code class="syntax">File</code> engine, and use these settings in all <code class="syntax">INSERT</code>s and <code class="syntax">SELECT</code>s. The file format settings changed in the current user session, or in the <code class="syntax">SETTINGS</code> clause of a DML query itself, no longer affect the query. <a href="https://github.com/ClickHouse/ClickHouse/pull/16591" rel="external nofollow noreferrer" target="_blank">#16591</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
</ul>
<h4 id="new-feature">New Feature<a class="headerlink" href="#new-feature" title="Permanent link"> </a></h4>
<ul>
<li>add <code class="syntax">*.xz</code> compression/decompression support.It enables using <code class="syntax">*.xz</code> in <code class="syntax">file()</code> function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8828" rel="external nofollow noreferrer" target="_blank">#8828</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16578" rel="external nofollow noreferrer" target="_blank">#16578</a> (<a href="https://github.com/fibersel" rel="external nofollow noreferrer" target="_blank">Abi Palagashvili</a>).</li>
<li>Introduce the query <code class="syntax">ALTER TABLE ... DROP|DETACH PART 'part_name'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15511" rel="external nofollow noreferrer" target="_blank">#15511</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
<li>Added new ALTER UPDATE/DELETE IN PARTITION syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/13403" rel="external nofollow noreferrer" target="_blank">#13403</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Allow formatting named tuples as JSON objects when using JSON input/output formats, controlled by the <code class="syntax">output_format_json_named_tuples_as_objects</code> setting, disabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/17175" rel="external nofollow noreferrer" target="_blank">#17175</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Add a possibility to input enum value as it's id in TSV and CSV formats by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/16834" rel="external nofollow noreferrer" target="_blank">#16834</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>Add COLLATE support for Nullable, LowCardinality, Array and Tuple, where nested type is String. Also refactor the code associated with collations in ColumnString.cpp. <a href="https://github.com/ClickHouse/ClickHouse/pull/16273" rel="external nofollow noreferrer" target="_blank">#16273</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>New <code class="syntax">tcpPort</code> function returns TCP port listened by this server. <a href="https://github.com/ClickHouse/ClickHouse/pull/17134" rel="external nofollow noreferrer" target="_blank">#17134</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Add new math functions: <code class="syntax">acosh</code>, <code class="syntax">asinh</code>, <code class="syntax">atan2</code>, <code class="syntax">atanh</code>, <code class="syntax">cosh</code>, <code class="syntax">hypot</code>, <code class="syntax">log1p</code>, <code class="syntax">sinh</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16636" rel="external nofollow noreferrer" target="_blank">#16636</a> (<a href="https://github.com/hombit" rel="external nofollow noreferrer" target="_blank">Konstantin Malanchev</a>).</li>
<li>Possibility to distribute the merges between different replicas. Introduces the <code class="syntax">execute_merges_on_single_replica_time_threshold</code> mergetree setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/16424" rel="external nofollow noreferrer" target="_blank">#16424</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Add setting <code class="syntax">aggregate_functions_null_for_empty</code> for SQL standard compatibility. This option will rewrite all aggregate functions in a query, adding -OrNull suffix to them. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/10273" rel="external nofollow noreferrer" target="_blank">10273</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16123" rel="external nofollow noreferrer" target="_blank">#16123</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Updated DateTime, DateTime64 parsing to accept string Date literal format. <a href="https://github.com/ClickHouse/ClickHouse/pull/16040" rel="external nofollow noreferrer" target="_blank">#16040</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Make it possible to change the path to history file in <code class="syntax">clickhouse-client</code> using the <code class="syntax">--history_file</code> parameter. <a href="https://github.com/ClickHouse/ClickHouse/pull/15960" rel="external nofollow noreferrer" target="_blank">#15960</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
</ul>
<h4 id="bug-fix_2">Bug Fix<a class="headerlink" href="#bug-fix_2" title="Permanent link"> </a></h4>
<ul>
<li>Fix the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" rel="external nofollow noreferrer" target="_blank">#17542</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed <code class="syntax">Function not implemented</code> error when executing <code class="syntax">RENAME</code> query in <code class="syntax">Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17661" rel="external nofollow noreferrer" target="_blank">#17661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17664" rel="external nofollow noreferrer" target="_blank">#17664</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Do not restore parts from WAL if <code class="syntax">in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" rel="external nofollow noreferrer" target="_blank">#17802</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>fix incorrect initialization of <code class="syntax">max_compress_block_size</code> of MergeTreeWriterSettings with <code class="syntax">min_compress_block_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17833" rel="external nofollow noreferrer" target="_blank">#17833</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Exception message about max table size to drop was displayed incorrectly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17764" rel="external nofollow noreferrer" target="_blank">#17764</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed possible segfault when there is not enough space when inserting into <code class="syntax">Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/17737" rel="external nofollow noreferrer" target="_blank">#17737</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" rel="external nofollow noreferrer" target="_blank">#17681</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>In might be determined incorrectly if cluster is circular- (cross-) replicated or not when executing <code class="syntax">ON CLUSTER</code> query due to race condition when <code class="syntax">pool_size</code> &gt; 1. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/17640" rel="external nofollow noreferrer" target="_blank">#17640</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Exception <code class="syntax">fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17613" rel="external nofollow noreferrer" target="_blank">#17613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17615" rel="external nofollow noreferrer" target="_blank">#17615</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" rel="external nofollow noreferrer" target="_blank">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" rel="external nofollow noreferrer" target="_blank">#17565</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" rel="external nofollow noreferrer" target="_blank">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" rel="external nofollow noreferrer" target="_blank">#17499</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix issue when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" rel="external nofollow noreferrer" target="_blank">#17496</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix <code class="syntax">ORDER BY</code> with enabled setting <code class="syntax">optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" rel="external nofollow noreferrer" target="_blank">#17471</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix duplicates after <code class="syntax">DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" rel="external nofollow noreferrer" target="_blank">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" rel="external nofollow noreferrer" target="_blank">#17296</a> (<a href="https://github.com/chengxianglibra" rel="external nofollow noreferrer" target="_blank">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" rel="external nofollow noreferrer" target="_blank">#17439</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix crash while reading from <code class="syntax">JOIN</code> table with <code class="syntax">LowCardinality</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" rel="external nofollow noreferrer" target="_blank">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" rel="external nofollow noreferrer" target="_blank">#17397</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>fix <code class="syntax">toInt256(inf)</code> stack overflow. Int256 is an experimental feature. Closed <a href="https://github.com/ClickHouse/ClickHouse/issues/17235" rel="external nofollow noreferrer" target="_blank">#17235</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17257" rel="external nofollow noreferrer" target="_blank">#17257</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Fix possible <code class="syntax">Unexpected packet Data received from client</code> error logged for Distributed queries with <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17254" rel="external nofollow noreferrer" target="_blank">#17254</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" rel="external nofollow noreferrer" target="_blank">#17246</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" rel="external nofollow noreferrer" target="_blank">#17249</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix possible wrong index analysis when the types of the index comparison are different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17122" rel="external nofollow noreferrer" target="_blank">#17122</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17145" rel="external nofollow noreferrer" target="_blank">#17145</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix ColumnConst comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" rel="external nofollow noreferrer" target="_blank">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" rel="external nofollow noreferrer" target="_blank">#17135</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Multiple fixed for MaterializeMySQL (experimental feature). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16923" rel="external nofollow noreferrer" target="_blank">#16923</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15883" rel="external nofollow noreferrer" target="_blank">#15883</a> Fix MaterializeMySQL SYNC failure when the modify MySQL binlog_checksum. <a href="https://github.com/ClickHouse/ClickHouse/pull/17091" rel="external nofollow noreferrer" target="_blank">#17091</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix bug when <code class="syntax">ON CLUSTER</code> queries may hang forever for non-leader ReplicatedMergeTreeTables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" rel="external nofollow noreferrer" target="_blank">#17089</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed crash on <code class="syntax">CREATE TABLE ... AS some_table</code> query when <code class="syntax">some_table</code> was created <code class="syntax">AS table_function()</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16944" rel="external nofollow noreferrer" target="_blank">#16944</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17072" rel="external nofollow noreferrer" target="_blank">#17072</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Bug unfinished implementation for funciton fuzzBits, related issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" rel="external nofollow noreferrer" target="_blank">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" rel="external nofollow noreferrer" target="_blank">#17051</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Fix LLVM's libunwind in the case when CFA register is RAX. This is the <a href="https://bugs.llvm.org/show_bug.cgi?id=48186" rel="external nofollow noreferrer" target="_blank">bug</a> in <a href="https://github.com/llvm/llvm-project/tree/master/libunwind" rel="external nofollow noreferrer" target="_blank">LLVM's libunwind</a>. We already have workarounds for this bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/17046" rel="external nofollow noreferrer" target="_blank">#17046</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" rel="external nofollow noreferrer" target="_blank">#17006</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix <code class="syntax">optimize_distributed_group_by_sharding_key</code> setting (that is disabled by default) for query with OFFSET only. <a href="https://github.com/ClickHouse/ClickHouse/pull/16996" rel="external nofollow noreferrer" target="_blank">#16996</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix for Merge tables over Distributed tables with JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/16993" rel="external nofollow noreferrer" target="_blank">#16993</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong result in big integers (128, 256 bit) when casting from double. Big integers support is experimental. <a href="https://github.com/ClickHouse/ClickHouse/pull/16986" rel="external nofollow noreferrer" target="_blank">#16986</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Fix possible server crash after <code class="syntax">ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code class="syntax">SELECT</code> have <code class="syntax">WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" rel="external nofollow noreferrer" target="_blank">#16968</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Blame info was not calculated correctly in <code class="syntax">clickhouse-git-import</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16959" rel="external nofollow noreferrer" target="_blank">#16959</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix order by optimization with monotonous functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" rel="external nofollow noreferrer" target="_blank">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" rel="external nofollow noreferrer" target="_blank">#16956</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix optimization of group by with enabled setting <code class="syntax">optimize_aggregators_of_group_by_keys</code> and joins. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" rel="external nofollow noreferrer" target="_blank">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" rel="external nofollow noreferrer" target="_blank">#16951</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix possible error <code class="syntax">Illegal type of argument</code> for queries with <code class="syntax">ORDER BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" rel="external nofollow noreferrer" target="_blank">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" rel="external nofollow noreferrer" target="_blank">#16928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix strange code in InterpreterShowAccessQuery. <a href="https://github.com/ClickHouse/ClickHouse/pull/16866" rel="external nofollow noreferrer" target="_blank">#16866</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Prevent clickhouse server crashes when using the function <code class="syntax">timeSeriesGroupSum</code>. The function is removed from newer ClickHouse releases. <a href="https://github.com/ClickHouse/ClickHouse/pull/16865" rel="external nofollow noreferrer" target="_blank">#16865</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" rel="external nofollow noreferrer" target="_blank">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" rel="external nofollow noreferrer" target="_blank">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" rel="external nofollow noreferrer" target="_blank">#16846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash when using <code class="syntax">any</code> without any arguments. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" rel="external nofollow noreferrer" target="_blank">#16803</a> . cc @azat. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" rel="external nofollow noreferrer" target="_blank">#16826</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>If no memory can be allocated while writing table metadata on disk, broken metadata file can be written. <a href="https://github.com/ClickHouse/ClickHouse/pull/16772" rel="external nofollow noreferrer" target="_blank">#16772</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix trivial query optimization with partition predicate. <a href="https://github.com/ClickHouse/ClickHouse/pull/16767" rel="external nofollow noreferrer" target="_blank">#16767</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix <code class="syntax">IN</code> operator over several columns and tuples with enabled <code class="syntax">transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" rel="external nofollow noreferrer" target="_blank">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" rel="external nofollow noreferrer" target="_blank">#16722</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Return number of affected rows for INSERT queries via MySQL protocol. Previously ClickHouse used to always return 0, it's fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" rel="external nofollow noreferrer" target="_blank">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" rel="external nofollow noreferrer" target="_blank">#16715</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix remote query failure when using 'if' suffix aggregate function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" rel="external nofollow noreferrer" target="_blank">#16574</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" rel="external nofollow noreferrer" target="_blank">#16231</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" rel="external nofollow noreferrer" target="_blank">#16610</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix inconsistent behavior caused by <code class="syntax">select_sequential_consistency</code> for optimized trivial count query and system.tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/16309" rel="external nofollow noreferrer" target="_blank">#16309</a> (<a href="https://github.com/haoch" rel="external nofollow noreferrer" target="_blank">Hao Chen</a>).</li>
</ul>
<h4 id="improvement">Improvement<a class="headerlink" href="#improvement" title="Permanent link"> </a></h4>
<ul>
<li>Remove empty parts after they were pruned by TTL, mutation, or collapsing merge algorithm. <a href="https://github.com/ClickHouse/ClickHouse/pull/16895" rel="external nofollow noreferrer" target="_blank">#16895</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Enable compact format of directories for asynchronous sends in Distributed tables: <code class="syntax">use_compact_format_in_distributed_parts_names</code> is set to 1 by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/16788" rel="external nofollow noreferrer" target="_blank">#16788</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Abort multipart upload if no data was written to S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" rel="external nofollow noreferrer" target="_blank">#16840</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Reresolve the IP of the <code class="syntax">format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" rel="external nofollow noreferrer" target="_blank">#16985</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Mask password in data_path in the system.distribution_queue. <a href="https://github.com/ClickHouse/ClickHouse/pull/16727" rel="external nofollow noreferrer" target="_blank">#16727</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Throw error when use column transformer replaces non existing column. <a href="https://github.com/ClickHouse/ClickHouse/pull/16183" rel="external nofollow noreferrer" target="_blank">#16183</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Turn off parallel parsing when there is no enough memory for all threads to work simultaneously. Also there could be exceptions like "Memory limit exceeded" when somebody will try to insert extremely huge rows (&gt; min_chunk_bytes_for_parallel_parsing), because each piece to parse has to be independent set of strings (one or more). <a href="https://github.com/ClickHouse/ClickHouse/pull/16721" rel="external nofollow noreferrer" target="_blank">#16721</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" rel="external nofollow noreferrer" target="_blank">#16936</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Correct grammar in error message in JSONEachRow, JSONCompactEachRow, and RegexpRow input formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/17205" rel="external nofollow noreferrer" target="_blank">#17205</a> (<a href="https://github.com/sneako" rel="external nofollow noreferrer" target="_blank">nico piderman</a>).</li>
<li>Set default <code class="syntax">host</code> and <code class="syntax">port</code> parameters for <code class="syntax">SOURCE(CLICKHOUSE(...))</code> to current instance and set default <code class="syntax">user</code> value to <code class="syntax">'default'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16997" rel="external nofollow noreferrer" target="_blank">#16997</a> (<a href="https://github.com/vdimir" rel="external nofollow noreferrer" target="_blank">vdimir</a>).</li>
<li>Throw an informative error message when doing <code class="syntax">ATTACH/DETACH TABLE &lt;DICTIONARY&gt;</code>. Before this PR, <code class="syntax">detach table &lt;dict&gt;</code> works but leads to an ill-formed in-memory metadata. <a href="https://github.com/ClickHouse/ClickHouse/pull/16885" rel="external nofollow noreferrer" target="_blank">#16885</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add cutToFirstSignificantSubdomainWithWWW(). <a href="https://github.com/ClickHouse/ClickHouse/pull/16845" rel="external nofollow noreferrer" target="_blank">#16845</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Server refused to startup with exception message if wrong config is given (<code class="syntax">metric_log</code>.<code class="syntax">collect_interval_milliseconds</code> is missing). <a href="https://github.com/ClickHouse/ClickHouse/pull/16815" rel="external nofollow noreferrer" target="_blank">#16815</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Better exception message when configuration for distributed DDL is absent. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5075" rel="external nofollow noreferrer" target="_blank">#5075</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16769" rel="external nofollow noreferrer" target="_blank">#16769</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Usability improvement: better suggestions in syntax error message when <code class="syntax">CODEC</code> expression is misplaced in <code class="syntax">CREATE TABLE</code> query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12493" rel="external nofollow noreferrer" target="_blank">#12493</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16768" rel="external nofollow noreferrer" target="_blank">#16768</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove empty directories for async INSERT at start of Distributed engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/16729" rel="external nofollow noreferrer" target="_blank">#16729</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Workaround for use S3 with nginx server as proxy. Nginx currenty does not accept urls with empty path like <code class="syntax">http://domain.com?delete</code>, but vanilla aws-sdk-cpp produces this kind of urls. This commit uses patched aws-sdk-cpp version, which makes urls with "/" as path in this cases, like <code class="syntax">http://domain.com/?delete</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16709" rel="external nofollow noreferrer" target="_blank">#16709</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Allow <code class="syntax">reinterpretAs*</code> functions to work for integers and floats of the same size. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/16640" rel="external nofollow noreferrer" target="_blank">16640</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16657" rel="external nofollow noreferrer" target="_blank">#16657</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Now, <code class="syntax">&lt;auxiliary_zookeepers&gt;</code> configuration can be changed in <code class="syntax">config.xml</code> and reloaded without server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/16627" rel="external nofollow noreferrer" target="_blank">#16627</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Support SNI in https connections to remote resources. This will allow to connect to Cloudflare servers that require SNI. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10055" rel="external nofollow noreferrer" target="_blank">#10055</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16252" rel="external nofollow noreferrer" target="_blank">#16252</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Make it possible to connect to <code class="syntax">clickhouse-server</code> secure endpoint which requires SNI. This is possible when <code class="syntax">clickhouse-server</code> is hosted behind TLS proxy. <a href="https://github.com/ClickHouse/ClickHouse/pull/16938" rel="external nofollow noreferrer" target="_blank">#16938</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix possible stack overflow if a loop of materialized views is created. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15732" rel="external nofollow noreferrer" target="_blank">#15732</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16048" rel="external nofollow noreferrer" target="_blank">#16048</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Simplify the implementation of background tasks processing for the MergeTree table engines family. There should be no visible changes for user. <a href="https://github.com/ClickHouse/ClickHouse/pull/15983" rel="external nofollow noreferrer" target="_blank">#15983</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Improvement for MaterializeMySQL (experimental feature). Throw exception about right sync privileges when MySQL sync user has error privileges. <a href="https://github.com/ClickHouse/ClickHouse/pull/15977" rel="external nofollow noreferrer" target="_blank">#15977</a> (<a href="https://github.com/TCeason" rel="external nofollow noreferrer" target="_blank">TCeason</a>).</li>
<li>Made <code class="syntax">indexOf()</code> use BloomFilter. <a href="https://github.com/ClickHouse/ClickHouse/pull/14977" rel="external nofollow noreferrer" target="_blank">#14977</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>).</li>
</ul>
<h4 id="performance-improvement">Performance Improvement<a class="headerlink" href="#performance-improvement" title="Permanent link"> </a></h4>
<ul>
<li>Use Floyd-Rivest algorithm, it is the best for the ClickHouse use case of partial sorting. Bechmarks are in <a href="https://github.com/danlark1/miniselect" target="_blank">https://github.com/danlark1/miniselect</a> and <a href="https://drive.google.com/drive/folders/1DHEaeXgZuX6AJ9eByeZ8iQVQv0ueP8XM" rel="external nofollow noreferrer" target="_blank">here</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16825" rel="external nofollow noreferrer" target="_blank">#16825</a> (<a href="https://github.com/danlark1" rel="external nofollow noreferrer" target="_blank">Danila Kutenin</a>).</li>
<li>Now <code class="syntax">ReplicatedMergeTree</code> tree engines family uses a separate thread pool for replicated fetches. Size of the pool limited by setting <code class="syntax">background_fetches_pool_size</code> which can be tuned with a server restart. The default value of the setting is 3 and it means that the maximum amount of parallel fetches is equal to 3 (and it allows to utilize 10G network). Fixes #520. <a href="https://github.com/ClickHouse/ClickHouse/pull/16390" rel="external nofollow noreferrer" target="_blank">#16390</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed uncontrolled growth of the state of <code class="syntax">quantileTDigest</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16680" rel="external nofollow noreferrer" target="_blank">#16680</a> (<a href="https://github.com/hrissan" rel="external nofollow noreferrer" target="_blank">hrissan</a>).</li>
<li>Add <code class="syntax">VIEW</code> subquery description to <code class="syntax">EXPLAIN</code>. Limit push down optimisation for <code class="syntax">VIEW</code>. Add local replicas of <code class="syntax">Distributed</code> to query plan. <a href="https://github.com/ClickHouse/ClickHouse/pull/14936" rel="external nofollow noreferrer" target="_blank">#14936</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix optimize_read_in_order/optimize_aggregation_in_order with max_threads &gt; 0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" rel="external nofollow noreferrer" target="_blank">#16637</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix performance of reading from <code class="syntax">Merge</code> tables over huge number of <code class="syntax">MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7748" rel="external nofollow noreferrer" target="_blank">#7748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16988" rel="external nofollow noreferrer" target="_blank">#16988</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Now we can safely prune partitions with exact match. Useful case: Suppose table is partitioned by <code class="syntax">intHash64(x) % 100</code> and the query has condition on <code class="syntax">intHash64(x) % 100</code> verbatim, not on x. <a href="https://github.com/ClickHouse/ClickHouse/pull/16253" rel="external nofollow noreferrer" target="_blank">#16253</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
</ul>
<h4 id="experimental-feature">Experimental Feature<a class="headerlink" href="#experimental-feature" title="Permanent link"> </a></h4>
<ul>
<li>Add <code class="syntax">EmbeddedRocksDB</code> table engine (can be used for dictionaries). <a href="https://github.com/ClickHouse/ClickHouse/pull/15073" rel="external nofollow noreferrer" target="_blank">#15073</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_1">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_1" title="Permanent link"> </a></h4>
<ul>
<li>Improvements in test coverage building images. <a href="https://github.com/ClickHouse/ClickHouse/pull/17233" rel="external nofollow noreferrer" target="_blank">#17233</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Update embedded timezone data to version 2020d (also update cctz to the latest master). <a href="https://github.com/ClickHouse/ClickHouse/pull/17204" rel="external nofollow noreferrer" target="_blank">#17204</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix UBSan report in Poco. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12719" rel="external nofollow noreferrer" target="_blank">#12719</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16765" rel="external nofollow noreferrer" target="_blank">#16765</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Do not instrument 3rd-party libraries with UBSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/16764" rel="external nofollow noreferrer" target="_blank">#16764</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan report in cache dictionaries. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12641" rel="external nofollow noreferrer" target="_blank">#12641</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16763" rel="external nofollow noreferrer" target="_blank">#16763</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan report when trying to convert infinite floating point number to integer. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14190" rel="external nofollow noreferrer" target="_blank">#14190</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16677" rel="external nofollow noreferrer" target="_blank">#16677</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h2 id="clickhouse-release-20-11">ClickHouse release 20.11<a class="headerlink" href="#clickhouse-release-20-11" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-11-7-16-stable-2021-03-02">ClickHouse release v20.11.7.16-stable, 2021-03-02<a class="headerlink" href="#clickhouse-release-v20-11-7-16-stable-2021-03-02" title="Permanent link"> </a></h3>
<h4 id="improvement_1">Improvement<a class="headerlink" href="#improvement_1" title="Permanent link"> </a></h4>
<ul>
<li>Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server images. <a href="https://github.com/ClickHouse/ClickHouse/pull/19096" rel="external nofollow noreferrer" target="_blank">#19096</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h4 id="bug-fix_3">Bug Fix<a class="headerlink" href="#bug-fix_3" title="Permanent link"> </a></h4>
<ul>
<li>BloomFilter index crash fix. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19757" rel="external nofollow noreferrer" target="_blank">#19757</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19884" rel="external nofollow noreferrer" target="_blank">#19884</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Deadlock was possible if system.text_log is enabled. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19874" rel="external nofollow noreferrer" target="_blank">#19874</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19875" rel="external nofollow noreferrer" target="_blank">#19875</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>In previous versions, unusual arguments for function arrayEnumerateUniq may cause crash or infinite loop. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19787" rel="external nofollow noreferrer" target="_blank">#19787</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19788" rel="external nofollow noreferrer" target="_blank">#19788</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed stack overflow when using accurate comparison of arithmetic type with string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/19773" rel="external nofollow noreferrer" target="_blank">#19773</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix a segmentation fault in <code class="syntax">bitmapAndnot</code> function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19668" rel="external nofollow noreferrer" target="_blank">#19668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19713" rel="external nofollow noreferrer" target="_blank">#19713</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Some functions with big integers may cause segfault. Big integers is experimental feature. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19667" rel="external nofollow noreferrer" target="_blank">#19667</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19672" rel="external nofollow noreferrer" target="_blank">#19672</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix wrong result of function <code class="syntax">neighbor</code> for <code class="syntax">LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10333" rel="external nofollow noreferrer" target="_blank">#10333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19617" rel="external nofollow noreferrer" target="_blank">#19617</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix use-after-free of the CompressedWriteBuffer in Connection after disconnect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19599" rel="external nofollow noreferrer" target="_blank">#19599</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li><code class="syntax">DROP/DETACH TABLE table ON CLUSTER cluster SYNC</code> query might hang, it's fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19568" rel="external nofollow noreferrer" target="_blank">#19568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19572" rel="external nofollow noreferrer" target="_blank">#19572</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Query CREATE DICTIONARY id expression fix. <a href="https://github.com/ClickHouse/ClickHouse/pull/19571" rel="external nofollow noreferrer" target="_blank">#19571</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Fix SIGSEGV with merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read=0/UINT64_MAX. <a href="https://github.com/ClickHouse/ClickHouse/pull/19528" rel="external nofollow noreferrer" target="_blank">#19528</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Buffer overflow (on memory read) was possible if <code class="syntax">addMonth</code> function was called with specifically crafted arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19441" rel="external nofollow noreferrer" target="_blank">#19441</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19413" rel="external nofollow noreferrer" target="_blank">#19413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19472" rel="external nofollow noreferrer" target="_blank">#19472</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Mark distributed batch as broken in case of empty data block in one of files. <a href="https://github.com/ClickHouse/ClickHouse/pull/19449" rel="external nofollow noreferrer" target="_blank">#19449</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix possible buffer overflow in Uber H3 library. See <a href="https://github.com/uber/h3/issues/392" target="_blank">https://github.com/uber/h3/issues/392</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19219" rel="external nofollow noreferrer" target="_blank">#19219</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19383" rel="external nofollow noreferrer" target="_blank">#19383</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix system.parts _state column (LOGICAL_ERROR when querying this column, due to incorrect order). <a href="https://github.com/ClickHouse/ClickHouse/pull/19346" rel="external nofollow noreferrer" target="_blank">#19346</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix error <code class="syntax">Cannot convert column now64() because it is constant but values of constants are different in source and result</code>. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/7156" rel="external nofollow noreferrer" target="_blank">#7156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19316" rel="external nofollow noreferrer" target="_blank">#19316</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix bug when concurrent <code class="syntax">ALTER</code> and <code class="syntax">DROP</code> queries may hang while processing ReplicatedMergeTree table. <a href="https://github.com/ClickHouse/ClickHouse/pull/19237" rel="external nofollow noreferrer" target="_blank">#19237</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix infinite reading from file in <code class="syntax">ORC</code> format (was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/10580" rel="external nofollow noreferrer" target="_blank">#10580</a>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19095" rel="external nofollow noreferrer" target="_blank">#19095</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19134" rel="external nofollow noreferrer" target="_blank">#19134</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix startup bug when clickhouse was not able to read compression codec from <code class="syntax">LowCardinality(Nullable(...))</code> and throws exception <code class="syntax">Attempt to read after EOF</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18340" rel="external nofollow noreferrer" target="_blank">#18340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19101" rel="external nofollow noreferrer" target="_blank">#19101</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">There is no checkpoint</code> error when inserting data through http interface using <code class="syntax">Template</code> or <code class="syntax">CustomSeparated</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19021" rel="external nofollow noreferrer" target="_blank">#19021</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19072" rel="external nofollow noreferrer" target="_blank">#19072</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Restrict <code class="syntax">MODIFY TTL</code> queries for <code class="syntax">MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19064" rel="external nofollow noreferrer" target="_blank">#19064</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Make sure <code class="syntax">groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17875" rel="external nofollow noreferrer" target="_blank">#17875</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19019" rel="external nofollow noreferrer" target="_blank">#19019</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix possible error <code class="syntax">Expected single dictionary argument for function</code> if use function <code class="syntax">ignore</code> with <code class="syntax">LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14275" rel="external nofollow noreferrer" target="_blank">#14275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19016" rel="external nofollow noreferrer" target="_blank">#19016</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix inserting of <code class="syntax">LowCardinality</code> column to table with <code class="syntax">TinyLog</code> engine. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18629" rel="external nofollow noreferrer" target="_blank">#18629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19010" rel="external nofollow noreferrer" target="_blank">#19010</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Disable <code class="syntax">optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18051" rel="external nofollow noreferrer" target="_blank">#18051</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18973" rel="external nofollow noreferrer" target="_blank">#18973</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18981" rel="external nofollow noreferrer" target="_blank">#18981</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed very rare deadlock at shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/18977" rel="external nofollow noreferrer" target="_blank">#18977</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix bug when mutation with some escaped text (like <code class="syntax">ALTER ... UPDATE e = CAST('foo', 'Enum8(\'foo\' = 1')</code> serialized incorrectly. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18878" rel="external nofollow noreferrer" target="_blank">#18878</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18944" rel="external nofollow noreferrer" target="_blank">#18944</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Attach partition should reset the mutation. <a href="https://github.com/ClickHouse/ClickHouse/issues/18804" rel="external nofollow noreferrer" target="_blank">#18804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18935" rel="external nofollow noreferrer" target="_blank">#18935</a> (<a href="https://github.com/fastio" rel="external nofollow noreferrer" target="_blank">fastio</a>).</li>
<li>Fix possible hang at shutdown in clickhouse-local. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18891" rel="external nofollow noreferrer" target="_blank">#18891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18893" rel="external nofollow noreferrer" target="_blank">#18893</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix *If combinator with unary function and Nullable types. <a href="https://github.com/ClickHouse/ClickHouse/pull/18806" rel="external nofollow noreferrer" target="_blank">#18806</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Asynchronous distributed INSERTs can be rejected by the server if the setting <code class="syntax">network_compression_method</code> is globally set to non-default value. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18741" rel="external nofollow noreferrer" target="_blank">#18741</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18776" rel="external nofollow noreferrer" target="_blank">#18776</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">Attempt to read after eof</code> error when trying to <code class="syntax">CAST</code> <code class="syntax">NULL</code> from <code class="syntax">Nullable(String)</code> to <code class="syntax">Nullable(Decimal(P, S))</code>. Now function <code class="syntax">CAST</code> returns <code class="syntax">NULL</code> when it cannot parse decimal from nullable string. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7690" rel="external nofollow noreferrer" target="_blank">#7690</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18718" rel="external nofollow noreferrer" target="_blank">#18718</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix Logger with unmatched arg size. <a href="https://github.com/ClickHouse/ClickHouse/pull/18717" rel="external nofollow noreferrer" target="_blank">#18717</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Add FixedString Data type support. I'll get this exception "Code: 50, e.displayText() = DB::Exception: Unsupported type FixedString(1)" when replicating data from MySQL to ClickHouse. This patch fixes bug <a href="https://github.com/ClickHouse/ClickHouse/issues/18450" rel="external nofollow noreferrer" target="_blank">#18450</a> Also fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6556" rel="external nofollow noreferrer" target="_blank">#6556</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18553" rel="external nofollow noreferrer" target="_blank">#18553</a> (<a href="https://github.com/awesomeleo" rel="external nofollow noreferrer" target="_blank">awesomeleo</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error while using <code class="syntax">ORDER BY</code> after subquery with <code class="syntax">RIGHT</code> or <code class="syntax">FULL</code> join. <a href="https://github.com/ClickHouse/ClickHouse/pull/18550" rel="external nofollow noreferrer" target="_blank">#18550</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix bug which may lead to <code class="syntax">ALTER</code> queries hung after corresponding mutation kill. Found by thread fuzzer. <a href="https://github.com/ClickHouse/ClickHouse/pull/18518" rel="external nofollow noreferrer" target="_blank">#18518</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" rel="external nofollow noreferrer" target="_blank">#18481</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Disable constant folding for subqueries on the analysis stage, when the result cannot be calculated. <a href="https://github.com/ClickHouse/ClickHouse/pull/18446" rel="external nofollow noreferrer" target="_blank">#18446</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">value is too short</code> error when executing <code class="syntax">toType(...)</code> functions (<code class="syntax">toDate</code>, <code class="syntax">toUInt32</code>, etc) with argument of type <code class="syntax">Nullable(String)</code>. Now such functions return <code class="syntax">NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" rel="external nofollow noreferrer" target="_blank">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" rel="external nofollow noreferrer" target="_blank">#18445</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" rel="external nofollow noreferrer" target="_blank">#18381</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix filling table <code class="syntax">system.settings_profile_elements</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18231" rel="external nofollow noreferrer" target="_blank">#18231</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18379" rel="external nofollow noreferrer" target="_blank">#18379</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18364" rel="external nofollow noreferrer" target="_blank">#18364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18373" rel="external nofollow noreferrer" target="_blank">#18373</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix possible crashes in aggregate functions with combinator <code class="syntax">Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" rel="external nofollow noreferrer" target="_blank">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" rel="external nofollow noreferrer" target="_blank">#18365</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li><code class="syntax">SELECT count() FROM table</code> now can be executed if only one any column can be selected from the <code class="syntax">table</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10639" rel="external nofollow noreferrer" target="_blank">#10639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18233" rel="external nofollow noreferrer" target="_blank">#18233</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li><code class="syntax">SELECT JOIN</code> now requires the <code class="syntax">SELECT</code> privilege on each of the joined tables. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17654" rel="external nofollow noreferrer" target="_blank">#17654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18232" rel="external nofollow noreferrer" target="_blank">#18232</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix possible incomplete query result while reading from <code class="syntax">MergeTree*</code> in case of read backoff (message <code class="syntax">&lt;Debug&gt; MergeTreeReadPool: Will lower number of threads</code> in logs). Was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/16423" rel="external nofollow noreferrer" target="_blank">#16423</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18137" rel="external nofollow noreferrer" target="_blank">#18137</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18216" rel="external nofollow noreferrer" target="_blank">#18216</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix error when query <code class="syntax">MODIFY COLUMN ... REMOVE TTL</code> does not actually remove column TTL. <a href="https://github.com/ClickHouse/ClickHouse/pull/18130" rel="external nofollow noreferrer" target="_blank">#18130</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix indeterministic functions with predicate optimizer. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17244" rel="external nofollow noreferrer" target="_blank">#17244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17273" rel="external nofollow noreferrer" target="_blank">#17273</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Mutation might hang waiting for some non-existent part after <code class="syntax">MOVE</code> or <code class="syntax">REPLACE PARTITION</code> or, in rare cases, after <code class="syntax">DETACH</code> or <code class="syntax">DROP PARTITION</code>. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" rel="external nofollow noreferrer" target="_blank">#15537</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_2">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_2" title="Permanent link"> </a></h4>
<ul>
<li>Update timezones info to 2020e. <a href="https://github.com/ClickHouse/ClickHouse/pull/18531" rel="external nofollow noreferrer" target="_blank">#18531</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-11-6-6-stable-2020-12-24">ClickHouse release v20.11.6.6-stable, 2020-12-24<a class="headerlink" href="#clickhouse-release-v20-11-6-6-stable-2020-12-24" title="Permanent link"> </a></h3>
<h4 id="bug-fix_4">Bug Fix<a class="headerlink" href="#bug-fix_4" title="Permanent link"> </a></h4>
<ul>
<li>Fixed issue when <code class="syntax">clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual <code class="syntax">IPv4/IPv6 stack</code> and fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes. This possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" rel="external nofollow noreferrer" target="_blank">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" rel="external nofollow noreferrer" target="_blank">#18278</a> (<a href="https://github.com/traceon" rel="external nofollow noreferrer" target="_blank">Denis Glazachev</a>).</li>
<li>Fixed key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" rel="external nofollow noreferrer" target="_blank">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" rel="external nofollow noreferrer" target="_blank">#18214</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed unique key convert crash in <code class="syntax">MaterializeMySQL</code> database engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" rel="external nofollow noreferrer" target="_blank">#18186</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" rel="external nofollow noreferrer" target="_blank">#16372</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" rel="external nofollow noreferrer" target="_blank">#18211</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" rel="external nofollow noreferrer" target="_blank">#18059</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fixed the issue when some tables not synchronized to ClickHouse from MySQL caused by the fact that convertion MySQL prefix index wasn't supported for MaterializeMySQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" rel="external nofollow noreferrer" target="_blank">#15187</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" rel="external nofollow noreferrer" target="_blank">#17912</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" rel="external nofollow noreferrer" target="_blank">#17944</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed the issue when query optimization was producing wrong result if query contains <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" rel="external nofollow noreferrer" target="_blank">#17887</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Fix possible segfault in <code class="syntax">topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" rel="external nofollow noreferrer" target="_blank">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" rel="external nofollow noreferrer" target="_blank">#17845</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Do not restore parts from WAL if <code class="syntax">in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" rel="external nofollow noreferrer" target="_blank">#17802</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" rel="external nofollow noreferrer" target="_blank">#17681</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fixed inconsistent behaviour of <code class="syntax">optimize_trivial_count_query</code> with partition predicate. <a href="https://github.com/ClickHouse/ClickHouse/pull/17644" rel="external nofollow noreferrer" target="_blank">#17644</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed empty <code class="syntax">system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" rel="external nofollow noreferrer" target="_blank">#17630</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed the behaviour when xxception <code class="syntax">fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17613" rel="external nofollow noreferrer" target="_blank">#17613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17615" rel="external nofollow noreferrer" target="_blank">#17615</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the behaviour when clickhouse-client is used in interactive mode with multiline queries and single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" rel="external nofollow noreferrer" target="_blank">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" rel="external nofollow noreferrer" target="_blank">#17565</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" rel="external nofollow noreferrer" target="_blank">#17542</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed alter query hang when the corresponding mutation was killed on the different replica. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" rel="external nofollow noreferrer" target="_blank">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" rel="external nofollow noreferrer" target="_blank">#17499</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed bug when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" rel="external nofollow noreferrer" target="_blank">#17496</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">ORDER BY</code> with enabled setting <code class="syntax">optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" rel="external nofollow noreferrer" target="_blank">#17471</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed duplicates after <code class="syntax">DISTINCT</code> which were possible because of incorrect optimization. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" rel="external nofollow noreferrer" target="_blank">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" rel="external nofollow noreferrer" target="_blank">#17296</a> (<a href="https://github.com/chengxianglibra" rel="external nofollow noreferrer" target="_blank">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" rel="external nofollow noreferrer" target="_blank">#17439</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed crash while reading from <code class="syntax">JOIN</code> table with <code class="syntax">LowCardinality</code> types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" rel="external nofollow noreferrer" target="_blank">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" rel="external nofollow noreferrer" target="_blank">#17397</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" rel="external nofollow noreferrer" target="_blank">#17246</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" rel="external nofollow noreferrer" target="_blank">#17249</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed possible wrong index analysis when the types of the index comparison are different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17122" rel="external nofollow noreferrer" target="_blank">#17122</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17145" rel="external nofollow noreferrer" target="_blank">#17145</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed <code class="syntax">ColumnConst</code> comparison which leads to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" rel="external nofollow noreferrer" target="_blank">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" rel="external nofollow noreferrer" target="_blank">#17135</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed bug when <code class="syntax">ON CLUSTER</code> queries may hang forever for non-leader <code class="syntax">ReplicatedMergeTreeTables</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" rel="external nofollow noreferrer" target="_blank">#17089</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed fuzzer-found bug in funciton <code class="syntax">fuzzBits</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" rel="external nofollow noreferrer" target="_blank">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" rel="external nofollow noreferrer" target="_blank">#17051</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" rel="external nofollow noreferrer" target="_blank">#17006</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong result in big integers (128, 256 bit) when casting from double. <a href="https://github.com/ClickHouse/ClickHouse/pull/16986" rel="external nofollow noreferrer" target="_blank">#16986</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Reresolve the IP of the <code class="syntax">format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" rel="external nofollow noreferrer" target="_blank">#16985</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed possible server crash after <code class="syntax">ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code class="syntax">SELECT</code> have <code class="syntax">WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" rel="external nofollow noreferrer" target="_blank">#16968</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Blame info was not calculated correctly in <code class="syntax">clickhouse-git-import</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16959" rel="external nofollow noreferrer" target="_blank">#16959</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed order by optimization with monotonous functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" rel="external nofollow noreferrer" target="_blank">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" rel="external nofollow noreferrer" target="_blank">#16956</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed optimization of group by with enabled setting <code class="syntax">optimize_aggregators_of_group_by_keys</code> and joins. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" rel="external nofollow noreferrer" target="_blank">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" rel="external nofollow noreferrer" target="_blank">#16951</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" rel="external nofollow noreferrer" target="_blank">#16936</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed possible error <code class="syntax">Illegal type of argument</code> for queries with <code class="syntax">ORDER BY</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" rel="external nofollow noreferrer" target="_blank">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" rel="external nofollow noreferrer" target="_blank">#16928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Abort multipart upload if no data was written to WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" rel="external nofollow noreferrer" target="_blank">#16840</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fixed crash when using <code class="syntax">any</code> without any arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" rel="external nofollow noreferrer" target="_blank">#16803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" rel="external nofollow noreferrer" target="_blank">#16826</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed the behaviour when ClickHouse used to always return 0 insted of a number of affected rows for <code class="syntax">INSERT</code> queries via MySQL protocol. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" rel="external nofollow noreferrer" target="_blank">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" rel="external nofollow noreferrer" target="_blank">#16715</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed uncontrolled growth of TDigest. <a href="https://github.com/ClickHouse/ClickHouse/pull/16680" rel="external nofollow noreferrer" target="_blank">#16680</a> (<a href="https://github.com/hrissan" rel="external nofollow noreferrer" target="_blank">hrissan</a>).</li>
<li>Fixed remote query failure when using suffix <code class="syntax">if</code> in Aggregate function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" rel="external nofollow noreferrer" target="_blank">#16574</a> fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" rel="external nofollow noreferrer" target="_blank">#16231</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" rel="external nofollow noreferrer" target="_blank">#16610</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed inconsistent behavior caused by <code class="syntax">select_sequential_consistency</code> for optimized trivial count query and system.tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/16309" rel="external nofollow noreferrer" target="_blank">#16309</a> (<a href="https://github.com/haoch" rel="external nofollow noreferrer" target="_blank">Hao Chen</a>).</li>
<li>Throw error when use ColumnTransformer replace non exist column. <a href="https://github.com/ClickHouse/ClickHouse/pull/16183" rel="external nofollow noreferrer" target="_blank">#16183</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-11-3-3-stable-2020-11-13">ClickHouse release v20.11.3.3-stable, 2020-11-13<a class="headerlink" href="#clickhouse-release-v20-11-3-3-stable-2020-11-13" title="Permanent link"> </a></h3>
<h4 id="bug-fix_5">Bug Fix<a class="headerlink" href="#bug-fix_5" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" rel="external nofollow noreferrer" target="_blank">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" rel="external nofollow noreferrer" target="_blank">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" rel="external nofollow noreferrer" target="_blank">#16846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-11-2-1-2020-11-11">ClickHouse release v20.11.2.1, 2020-11-11<a class="headerlink" href="#clickhouse-release-v20-11-2-1-2020-11-11" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_1">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_1" title="Permanent link"> </a></h4>
<ul>
<li>If some <code class="syntax">profile</code> was specified in <code class="syntax">distributed_ddl</code> config section, then this profile could overwrite settings of <code class="syntax">default</code> profile on server startup. It's fixed, now settings of distributed DDL queries should not affect global server settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/16635" rel="external nofollow noreferrer" target="_blank">#16635</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Restrict to use of non-comparable data types (like <code class="syntax">AggregateFunction</code>) in keys (Sorting key, Primary key, Partition key, and so on). <a href="https://github.com/ClickHouse/ClickHouse/pull/16601" rel="external nofollow noreferrer" target="_blank">#16601</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Remove <code class="syntax">ANALYZE</code> and <code class="syntax">AST</code> queries, and make the setting <code class="syntax">enable_debug_queries</code> obsolete since now it is the part of full featured <code class="syntax">EXPLAIN</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/16536" rel="external nofollow noreferrer" target="_blank">#16536</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Aggregate functions <code class="syntax">boundingRatio</code>, <code class="syntax">rankCorr</code>, <code class="syntax">retention</code>, <code class="syntax">timeSeriesGroupSum</code>, <code class="syntax">timeSeriesGroupRateSum</code>, <code class="syntax">windowFunnel</code> were erroneously made case-insensitive. Now their names are made case sensitive as designed. Only functions that are specified in SQL standard or made for compatibility with other DBMS or functions similar to those should be case-insensitive. <a href="https://github.com/ClickHouse/ClickHouse/pull/16407" rel="external nofollow noreferrer" target="_blank">#16407</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Make <code class="syntax">rankCorr</code> function return nan on insufficient data <a href="https://github.com/ClickHouse/ClickHouse/issues/16124" rel="external nofollow noreferrer" target="_blank">#16124</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16135" rel="external nofollow noreferrer" target="_blank">#16135</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_1">New Feature<a class="headerlink" href="#new-feature_1" title="Permanent link"> </a></h4>
<ul>
<li>Added support of LDAP as a user directory for locally non-existent users. <a href="https://github.com/ClickHouse/ClickHouse/pull/12736" rel="external nofollow noreferrer" target="_blank">#12736</a> (<a href="https://github.com/traceon" rel="external nofollow noreferrer" target="_blank">Denis Glazachev</a>).</li>
<li>Add <code class="syntax">system.replicated_fetches</code> table which shows currently running background fetches. <a href="https://github.com/ClickHouse/ClickHouse/pull/16428" rel="external nofollow noreferrer" target="_blank">#16428</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Added setting <code class="syntax">date_time_output_format</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15845" rel="external nofollow noreferrer" target="_blank">#15845</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Added minimal web UI to ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/16158" rel="external nofollow noreferrer" target="_blank">#16158</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allows to read/write Single protobuf message at once (w/o length-delimiters). <a href="https://github.com/ClickHouse/ClickHouse/pull/15199" rel="external nofollow noreferrer" target="_blank">#15199</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Added initial OpenTelemetry support. ClickHouse now accepts OpenTelemetry traceparent headers over Native and HTTP protocols, and passes them downstream in some cases. The trace spans for executed queries are saved into the <code class="syntax">system.opentelemetry_span_log</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/14195" rel="external nofollow noreferrer" target="_blank">#14195</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Allow specify primary key in column list of <code class="syntax">CREATE TABLE</code> query. This is needed for compatibility with other SQL dialects. <a href="https://github.com/ClickHouse/ClickHouse/pull/15823" rel="external nofollow noreferrer" target="_blank">#15823</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Implement <code class="syntax">OFFSET offset_row_count {ROW | ROWS} FETCH {FIRST | NEXT} fetch_row_count {ROW | ROWS} {ONLY | WITH TIES}</code> in SELECT query with ORDER BY. This is the SQL-standard way to specify <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15855" rel="external nofollow noreferrer" target="_blank">#15855</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li><code class="syntax">errorCodeToName</code> function - return variable name of the error (useful for analyzing query_log and similar). <code class="syntax">system.errors</code> table - shows how many times errors has been happened (respects <code class="syntax">system_events_show_zero_values</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/16438" rel="external nofollow noreferrer" target="_blank">#16438</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Added function <code class="syntax">untuple</code> which is a special function which can introduce new columns to the SELECT list by expanding a named tuple. <a href="https://github.com/ClickHouse/ClickHouse/pull/16242" rel="external nofollow noreferrer" target="_blank">#16242</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>, <a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Now we can provide identifiers via query parameters. And these parameters can be used as table objects or columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/16594" rel="external nofollow noreferrer" target="_blank">#16594</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Added big integers (UInt256, Int128, Int256) and UUID data types support for MergeTree BloomFilter index. Big integers is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/16642" rel="external nofollow noreferrer" target="_blank">#16642</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Add <code class="syntax">farmFingerprint64</code> function (non-cryptographic string hashing). <a href="https://github.com/ClickHouse/ClickHouse/pull/16570" rel="external nofollow noreferrer" target="_blank">#16570</a> (<a href="https://github.com/JacobHayes" rel="external nofollow noreferrer" target="_blank">Jacob Hayes</a>).</li>
<li>Add <code class="syntax">log_queries_min_query_duration_ms</code>, only queries slower than the value of this setting will go to <code class="syntax">query_log</code>/<code class="syntax">query_thread_log</code> (i.e. something like <code class="syntax">slow_query_log</code> in mysql). <a href="https://github.com/ClickHouse/ClickHouse/pull/16529" rel="external nofollow noreferrer" target="_blank">#16529</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Ability to create a docker image on the top of <code class="syntax">Alpine</code>. Uses precompiled binary and glibc components from ubuntu 20.04. <a href="https://github.com/ClickHouse/ClickHouse/pull/16479" rel="external nofollow noreferrer" target="_blank">#16479</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Added <code class="syntax">toUUIDOrNull</code>, <code class="syntax">toUUIDOrZero</code> cast functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/16337" rel="external nofollow noreferrer" target="_blank">#16337</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Add <code class="syntax">max_concurrent_queries_for_all_users</code> setting, see <a href="https://github.com/ClickHouse/ClickHouse/issues/6636" rel="external nofollow noreferrer" target="_blank">#6636</a> for use cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/16154" rel="external nofollow noreferrer" target="_blank">#16154</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
<li>Add a new option <code class="syntax">print_query_id</code> to clickhouse-client. It helps generate arbitrary strings with the current query id generated by the client. Also print query id in clickhouse-client by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/15809" rel="external nofollow noreferrer" target="_blank">#15809</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add <code class="syntax">tid</code> and <code class="syntax">logTrace</code> functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9434" rel="external nofollow noreferrer" target="_blank">#9434</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15803" rel="external nofollow noreferrer" target="_blank">#15803</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Add function <code class="syntax">formatReadableTimeDelta</code> that format time delta to human readable string ... <a href="https://github.com/ClickHouse/ClickHouse/pull/15497" rel="external nofollow noreferrer" target="_blank">#15497</a> (<a href="https://github.com/filipecaixeta" rel="external nofollow noreferrer" target="_blank">Filipe Caixeta</a>).</li>
<li>Added <code class="syntax">disable_merges</code> option for volumes in multi-disk configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/13956" rel="external nofollow noreferrer" target="_blank">#13956</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
</ul>
<h4 id="experimental-feature_1">Experimental Feature<a class="headerlink" href="#experimental-feature_1" title="Permanent link"> </a></h4>
<ul>
<li>New functions <code class="syntax">encrypt</code>, <code class="syntax">aes_encrypt_mysql</code>, <code class="syntax">decrypt</code>, <code class="syntax">aes_decrypt_mysql</code>. These functions are working slowly, so we consider it as an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/11844" rel="external nofollow noreferrer" target="_blank">#11844</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
</ul>
<h4 id="bug-fix_6">Bug Fix<a class="headerlink" href="#bug-fix_6" title="Permanent link"> </a></h4>
<ul>
<li>Mask password in data_path in the <code class="syntax">system.distribution_queue</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16727" rel="external nofollow noreferrer" target="_blank">#16727</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix <code class="syntax">IN</code> operator over several columns and tuples with enabled <code class="syntax">transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" rel="external nofollow noreferrer" target="_blank">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" rel="external nofollow noreferrer" target="_blank">#16722</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>The setting <code class="syntax">max_parallel_replicas</code> worked incorrectly if the queried table has no sampling. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5733" rel="external nofollow noreferrer" target="_blank">#5733</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16675" rel="external nofollow noreferrer" target="_blank">#16675</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix optimize_read_in_order/optimize_aggregation_in_order with max_threads &gt; 0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" rel="external nofollow noreferrer" target="_blank">#16637</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Calculation of <code class="syntax">DEFAULT</code> expressions was involving possible name collisions (that was very unlikely to encounter). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9359" rel="external nofollow noreferrer" target="_blank">#9359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16612" rel="external nofollow noreferrer" target="_blank">#16612</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">query_thread_log.query_duration_ms</code> unit. <a href="https://github.com/ClickHouse/ClickHouse/pull/16563" rel="external nofollow noreferrer" target="_blank">#16563</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix a bug when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine. <code class="syntax">MaterializeMySQL</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" rel="external nofollow noreferrer" target="_blank">#16504</a> (<a href="https://github.com/TCeason" rel="external nofollow noreferrer" target="_blank">TCeason</a>).</li>
<li>Specifically crafted argument of <code class="syntax">round</code> function with <code class="syntax">Decimal</code> was leading to integer division by zero. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13338" rel="external nofollow noreferrer" target="_blank">#13338</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16451" rel="external nofollow noreferrer" target="_blank">#16451</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" rel="external nofollow noreferrer" target="_blank">#16409</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" rel="external nofollow noreferrer" target="_blank">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" rel="external nofollow noreferrer" target="_blank">#16332</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the inconsistent behaviour when a part of return data could be dropped because the set for its filtration wasn't created. <a href="https://github.com/ClickHouse/ClickHouse/pull/16308" rel="external nofollow noreferrer" target="_blank">#16308</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix dictGet in sharding_key (and similar places, i.e. when the function context is stored permanently). <a href="https://github.com/ClickHouse/ClickHouse/pull/16205" rel="external nofollow noreferrer" target="_blank">#16205</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix the exception thrown in <code class="syntax">clickhouse-local</code> when trying to execute <code class="syntax">OPTIMIZE</code> command. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16076" rel="external nofollow noreferrer" target="_blank">#16076</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16192" rel="external nofollow noreferrer" target="_blank">#16192</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15780" rel="external nofollow noreferrer" target="_blank">#15780</a> regression, e.g. <code class="syntax">indexOf([1, 2, 3], toLowCardinality(1))</code> now is prohibited but it should not be. <a href="https://github.com/ClickHouse/ClickHouse/pull/16038" rel="external nofollow noreferrer" target="_blank">#16038</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it's unnecessary. For example, query <code class="syntax">SELECT ... FROM system.parts</code> should work only with MergeTree tables and don't touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" rel="external nofollow noreferrer" target="_blank">#16032</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>Now exception will be thrown when <code class="syntax">ALTER MODIFY COLUMN ... DEFAULT ...</code> has incompatible default with column type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15854" rel="external nofollow noreferrer" target="_blank">#15854</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15858" rel="external nofollow noreferrer" target="_blank">#15858</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed IPv4CIDRToRange/IPv6CIDRToRange functions to accept const IP-column values. <a href="https://github.com/ClickHouse/ClickHouse/pull/15856" rel="external nofollow noreferrer" target="_blank">#15856</a> (<a href="https://github.com/vladimir-golovchenko" rel="external nofollow noreferrer" target="_blank">vladimir-golovchenko</a>).</li>
</ul>
<h4 id="improvement_2">Improvement<a class="headerlink" href="#improvement_2" title="Permanent link"> </a></h4>
<ul>
<li>Treat <code class="syntax">INTERVAL '1 hour'</code> as equivalent to <code class="syntax">INTERVAL 1 HOUR</code>, to be compatible with Postgres and similar. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15637" rel="external nofollow noreferrer" target="_blank">#15637</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15978" rel="external nofollow noreferrer" target="_blank">#15978</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Enable parsing enum values by their numeric ids for CSV, TSV and JSON input formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/15685" rel="external nofollow noreferrer" target="_blank">#15685</a> (<a href="https://github.com/vivarum" rel="external nofollow noreferrer" target="_blank">vivarum</a>).</li>
<li>Better read task scheduling for JBOD architecture and <code class="syntax">MergeTree</code> storage. New setting <code class="syntax">read_backoff_min_concurrency</code> which serves as the lower limit to the number of reading threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/16423" rel="external nofollow noreferrer" target="_blank">#16423</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add missing support for <code class="syntax">LowCardinality</code> in <code class="syntax">Avro</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" rel="external nofollow noreferrer" target="_blank">#16521</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Workaround for use <code class="syntax">S3</code> with nginx server as proxy. Nginx currenty does not accept urls with empty path like <code class="syntax">http://domain.com?delete</code>, but vanilla aws-sdk-cpp produces this kind of urls. This commit uses patched aws-sdk-cpp version, which makes urls with "/" as path in this cases, like <code class="syntax">http://domain.com/?delete</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16814" rel="external nofollow noreferrer" target="_blank">#16814</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Better diagnostics on parse errors in input data. Provide row number on <code class="syntax">Cannot read all data</code> errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16644" rel="external nofollow noreferrer" target="_blank">#16644</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Make the behaviour of <code class="syntax">minMap</code> and <code class="syntax">maxMap</code> more desireable. It will not skip zero values in the result. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16087" rel="external nofollow noreferrer" target="_blank">#16087</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16631" rel="external nofollow noreferrer" target="_blank">#16631</a> (<a href="https://github.com/ildus" rel="external nofollow noreferrer" target="_blank">Ildus Kurbangaliev</a>).</li>
<li>Better update of ZooKeeper configuration in runtime. <a href="https://github.com/ClickHouse/ClickHouse/pull/16630" rel="external nofollow noreferrer" target="_blank">#16630</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Apply SETTINGS clause as early as possible. It allows to modify more settings in the query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3178" rel="external nofollow noreferrer" target="_blank">#3178</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16619" rel="external nofollow noreferrer" target="_blank">#16619</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now <code class="syntax">event_time_microseconds</code> field stores in Decimal64, not UInt64. <a href="https://github.com/ClickHouse/ClickHouse/pull/16617" rel="external nofollow noreferrer" target="_blank">#16617</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Now paratmeterized functions can be used in <code class="syntax">APPLY</code> column transformer. <a href="https://github.com/ClickHouse/ClickHouse/pull/16589" rel="external nofollow noreferrer" target="_blank">#16589</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Improve scheduling of background task which removes data of dropped tables in <code class="syntax">Atomic</code> databases. <code class="syntax">Atomic</code> databases do not create broken symlink to table data directory if table actually has no data directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/16584" rel="external nofollow noreferrer" target="_blank">#16584</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Subqueries in <code class="syntax">WITH</code> section (CTE) can reference previous subqueries in <code class="syntax">WITH</code> section by their name. <a href="https://github.com/ClickHouse/ClickHouse/pull/16575" rel="external nofollow noreferrer" target="_blank">#16575</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add current_database into <code class="syntax">system.query_thread_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16558" rel="external nofollow noreferrer" target="_blank">#16558</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Allow to fetch parts that are already committed or outdated in the current instance into the detached directory. It's useful when migrating tables from another cluster and having N to 1 shards mapping. It's also consistent with the current fetchPartition implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16538" rel="external nofollow noreferrer" target="_blank">#16538</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Multiple improvements for <code class="syntax">RabbitMQ</code>: Fixed bug for <a href="https://github.com/ClickHouse/ClickHouse/issues/16263" rel="external nofollow noreferrer" target="_blank">#16263</a>. Also minimized event loop lifetime. Added more efficient queues setup. <a href="https://github.com/ClickHouse/ClickHouse/pull/16426" rel="external nofollow noreferrer" target="_blank">#16426</a> (<a href="https://github.com/kssenii" rel="external nofollow noreferrer" target="_blank">Kseniia Sumarokova</a>).</li>
<li>Fix debug assertion in <code class="syntax">quantileDeterministic</code> function. In previous version it may also transfer up to two times more data over the network. Although no bug existed. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15683" rel="external nofollow noreferrer" target="_blank">#15683</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16410" rel="external nofollow noreferrer" target="_blank">#16410</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add <code class="syntax">TablesToDropQueueSize</code> metric. It's equal to number of dropped tables, that are waiting for background data removal. <a href="https://github.com/ClickHouse/ClickHouse/pull/16364" rel="external nofollow noreferrer" target="_blank">#16364</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Better diagnostics when client has dropped connection. In previous versions, <code class="syntax">Attempt to read after EOF</code> and <code class="syntax">Broken pipe</code> exceptions were logged in server. In new version, it's information message <code class="syntax">Client has dropped the connection, cancel the query.</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16329" rel="external nofollow noreferrer" target="_blank">#16329</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add total_rows/total_bytes (from system.tables) support for Set/Join table engines. <a href="https://github.com/ClickHouse/ClickHouse/pull/16306" rel="external nofollow noreferrer" target="_blank">#16306</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Now it's possible to specify <code class="syntax">PRIMARY KEY</code> without <code class="syntax">ORDER BY</code> for MergeTree table engines family. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15591" rel="external nofollow noreferrer" target="_blank">#15591</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16284" rel="external nofollow noreferrer" target="_blank">#16284</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>If there is no tmp folder in the system (chroot, misconfigutation etc) <code class="syntax">clickhouse-local</code> will create temporary subfolder in the current directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/16280" rel="external nofollow noreferrer" target="_blank">#16280</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Add support for nested data types (like named tuple) as sub-types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15587" rel="external nofollow noreferrer" target="_blank">#15587</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16262" rel="external nofollow noreferrer" target="_blank">#16262</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Support for <code class="syntax">database_atomic_wait_for_drop_and_detach_synchronously</code>/<code class="syntax">NO DELAY</code>/<code class="syntax">SYNC</code> for <code class="syntax">DROP DATABASE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16127" rel="external nofollow noreferrer" target="_blank">#16127</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add <code class="syntax">allow_nondeterministic_optimize_skip_unused_shards</code> (to allow non deterministic like <code class="syntax">rand()</code> or <code class="syntax">dictGet()</code> in sharding key). <a href="https://github.com/ClickHouse/ClickHouse/pull/16105" rel="external nofollow noreferrer" target="_blank">#16105</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix <code class="syntax">memory_profiler_step</code>/<code class="syntax">max_untracked_memory</code> for queries via HTTP (test included). Fix the issue that adjusting this value globally in xml config does not help either, since those settings are not applied anyway, only default (4MB) value is <a href="https://github.com/ClickHouse/ClickHouse/blob/17731245336d8c84f75e4c0894c5797ed7732190/src/Common/ThreadStatus.h#L104" rel="external nofollow noreferrer" target="_blank">used</a>. Fix <code class="syntax">query_id</code> for the most root ThreadStatus of the http query (by initializing QueryScope after reading query_id). <a href="https://github.com/ClickHouse/ClickHouse/pull/16101" rel="external nofollow noreferrer" target="_blank">#16101</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Now it's allowed to execute <code class="syntax">ALTER ... ON CLUSTER</code> queries regardless of the <code class="syntax">&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" rel="external nofollow noreferrer" target="_blank">#16075</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix rare issue when <code class="syntax">clickhouse-client</code> may abort on exit due to loading of suggestions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16035" rel="external nofollow noreferrer" target="_blank">#16035</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16047" rel="external nofollow noreferrer" target="_blank">#16047</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add support of <code class="syntax">cache</code> layout for <code class="syntax">Redis</code> dictionaries with complex key. <a href="https://github.com/ClickHouse/ClickHouse/pull/15985" rel="external nofollow noreferrer" target="_blank">#15985</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix query hang (endless loop) in case of misconfiguration (<code class="syntax">connections_with_failover_max_tries</code> set to 0). <a href="https://github.com/ClickHouse/ClickHouse/pull/15876" rel="external nofollow noreferrer" target="_blank">#15876</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Change level of some log messages from information to debug, so information messages will not appear for every query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5293" rel="external nofollow noreferrer" target="_blank">#5293</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15816" rel="external nofollow noreferrer" target="_blank">#15816</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove <code class="syntax">MemoryTrackingInBackground*</code> metrics to avoid potentially misleading results. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15684" rel="external nofollow noreferrer" target="_blank">#15684</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15813" rel="external nofollow noreferrer" target="_blank">#15813</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add reconnects to <code class="syntax">zookeeper-dump-tree</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/15711" rel="external nofollow noreferrer" target="_blank">#15711</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow explicitly specify columns list in <code class="syntax">CREATE TABLE table AS table_function(...)</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9249" rel="external nofollow noreferrer" target="_blank">#9249</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14214" rel="external nofollow noreferrer" target="_blank">#14214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14295" rel="external nofollow noreferrer" target="_blank">#14295</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
</ul>
<h4 id="performance-improvement_1">Performance Improvement<a class="headerlink" href="#performance-improvement_1" title="Permanent link"> </a></h4>
<ul>
<li>Do not merge parts across partitions in SELECT FINAL. <a href="https://github.com/ClickHouse/ClickHouse/pull/15938" rel="external nofollow noreferrer" target="_blank">#15938</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>Improve performance of <code class="syntax">-OrNull</code> and <code class="syntax">-OrDefault</code> aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/16661" rel="external nofollow noreferrer" target="_blank">#16661</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improve performance of <code class="syntax">quantileMerge</code>. In previous versions it was obnoxiously slow. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1463" rel="external nofollow noreferrer" target="_blank">#1463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16643" rel="external nofollow noreferrer" target="_blank">#16643</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improve performance of logical functions a little. <a href="https://github.com/ClickHouse/ClickHouse/pull/16347" rel="external nofollow noreferrer" target="_blank">#16347</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improved performance of merges assignment in MergeTree table engines. Shouldn't be visible for the user. <a href="https://github.com/ClickHouse/ClickHouse/pull/16191" rel="external nofollow noreferrer" target="_blank">#16191</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Speedup hashed/sparse_hashed dictionary loading by preallocating the hash table. <a href="https://github.com/ClickHouse/ClickHouse/pull/15454" rel="external nofollow noreferrer" target="_blank">#15454</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Now trivial count optimization becomes slightly non-trivial. Predicates that contain exact partition expr can be optimized too. This also fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11092" rel="external nofollow noreferrer" target="_blank">#11092</a> which returns wrong count when <code class="syntax">max_parallel_replicas &gt; 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15074" rel="external nofollow noreferrer" target="_blank">#15074</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_3">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_3" title="Permanent link"> </a></h4>
<ul>
<li>Add flaky check for stateless tests. It will detect potentially flaky functional tests in advance, before they are merged. <a href="https://github.com/ClickHouse/ClickHouse/pull/16238" rel="external nofollow noreferrer" target="_blank">#16238</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Use proper version for <code class="syntax">croaring</code> instead of amalgamation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16285" rel="external nofollow noreferrer" target="_blank">#16285</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Improve generation of build files for <code class="syntax">ya.make</code> build system (Arcadia). <a href="https://github.com/ClickHouse/ClickHouse/pull/16700" rel="external nofollow noreferrer" target="_blank">#16700</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add MySQL BinLog file check tool for <code class="syntax">MaterializeMySQL</code> database engine. <code class="syntax">MaterializeMySQL</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/16223" rel="external nofollow noreferrer" target="_blank">#16223</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Check for executable bit on non-executable files. People often accidentially commit executable files from Windows. <a href="https://github.com/ClickHouse/ClickHouse/pull/15843" rel="external nofollow noreferrer" target="_blank">#15843</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Check for <code class="syntax">#pragma once</code> in headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/15818" rel="external nofollow noreferrer" target="_blank">#15818</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix illegal code style <code class="syntax">&amp;vector[idx]</code> in libhdfs3. This fixes libcxx debug build. See also <a href="https://github.com/ClickHouse-Extras/libhdfs3/pull/8" target="_blank">https://github.com/ClickHouse-Extras/libhdfs3/pull/8</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/15815" rel="external nofollow noreferrer" target="_blank">#15815</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix build of one miscellaneous example tool on Mac OS. Note that we don't build examples on Mac OS in our CI (we build only ClickHouse binary), so there is zero chance it will not break again. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15804" rel="external nofollow noreferrer" target="_blank">#15804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15808" rel="external nofollow noreferrer" target="_blank">#15808</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Simplify Sys/V init script. <a href="https://github.com/ClickHouse/ClickHouse/pull/14135" rel="external nofollow noreferrer" target="_blank">#14135</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added <code class="syntax">boost::program_options</code> to <code class="syntax">db_generator</code> in order to increase its usability. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15940" rel="external nofollow noreferrer" target="_blank">#15940</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15973" rel="external nofollow noreferrer" target="_blank">#15973</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
</ul>
<h2 id="clickhouse-release-20-10">ClickHouse release 20.10<a class="headerlink" href="#clickhouse-release-20-10" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-10-7-4-stable-2020-12-24">ClickHouse release v20.10.7.4-stable, 2020-12-24<a class="headerlink" href="#clickhouse-release-v20-10-7-4-stable-2020-12-24" title="Permanent link"> </a></h3>
<h4 id="bug-fix_7">Bug Fix<a class="headerlink" href="#bug-fix_7" title="Permanent link"> </a></h4>
<ul>
<li>Fixed issue when <code class="syntax">clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual <code class="syntax">IPv4/IPv6</code> stack and fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes. This possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" rel="external nofollow noreferrer" target="_blank">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" rel="external nofollow noreferrer" target="_blank">#18278</a> (<a href="https://github.com/traceon" rel="external nofollow noreferrer" target="_blank">Denis Glazachev</a>).</li>
<li>Fix key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" rel="external nofollow noreferrer" target="_blank">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" rel="external nofollow noreferrer" target="_blank">#18214</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed unique key convert crash in <code class="syntax">MaterializeMySQL</code> database engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" rel="external nofollow noreferrer" target="_blank">#18186</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" rel="external nofollow noreferrer" target="_blank">#16372</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" rel="external nofollow noreferrer" target="_blank">#18211</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" rel="external nofollow noreferrer" target="_blank">#18059</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fixed the issue when some tables not synchronized to ClickHouse from MySQL caused by the fact that convertion MySQL prefix index wasn't supported for MaterializeMySQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" rel="external nofollow noreferrer" target="_blank">#15187</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" rel="external nofollow noreferrer" target="_blank">#17912</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" rel="external nofollow noreferrer" target="_blank">#17944</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix possible segfault in <code class="syntax">topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" rel="external nofollow noreferrer" target="_blank">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" rel="external nofollow noreferrer" target="_blank">#17845</a> (<a href="https://github.com/kitaisreal" rel="external nofollow noreferrer" target="_blank">Maksim Kita</a>).</li>
<li>Do not restore parts from <code class="syntax">WAL</code> if <code class="syntax">in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" rel="external nofollow noreferrer" target="_blank">#17802</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" rel="external nofollow noreferrer" target="_blank">#17681</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fixed empty <code class="syntax">system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" rel="external nofollow noreferrer" target="_blank">#17630</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed the behaviour when <code class="syntax">clickhouse-client</code> is used in interactive mode with multiline queries and single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" rel="external nofollow noreferrer" target="_blank">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" rel="external nofollow noreferrer" target="_blank">#17565</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" rel="external nofollow noreferrer" target="_blank">#17542</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">ALTER</code> query hang when the corresponding mutation was killed on the different replica. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" rel="external nofollow noreferrer" target="_blank">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" rel="external nofollow noreferrer" target="_blank">#17499</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed bug when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" rel="external nofollow noreferrer" target="_blank">#17496</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">ORDER BY</code> with enabled setting <code class="syntax">optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" rel="external nofollow noreferrer" target="_blank">#17471</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed duplicates after <code class="syntax">DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" rel="external nofollow noreferrer" target="_blank">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" rel="external nofollow noreferrer" target="_blank">#17296</a> (<a href="https://github.com/chengxianglibra" rel="external nofollow noreferrer" target="_blank">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" rel="external nofollow noreferrer" target="_blank">#17439</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed crash while reading from <code class="syntax">JOIN</code> table with <code class="syntax">LowCardinality</code> types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" rel="external nofollow noreferrer" target="_blank">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" rel="external nofollow noreferrer" target="_blank">#17397</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" rel="external nofollow noreferrer" target="_blank">#17246</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" rel="external nofollow noreferrer" target="_blank">#17249</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed <code class="syntax">ColumnConst</code> comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" rel="external nofollow noreferrer" target="_blank">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" rel="external nofollow noreferrer" target="_blank">#17135</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed bug when <code class="syntax">ON CLUSTER</code> queries may hang forever for non-leader <code class="syntax">ReplicatedMergeTreeTables</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" rel="external nofollow noreferrer" target="_blank">#17089</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed fuzzer-found bug in function <code class="syntax">fuzzBits</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" rel="external nofollow noreferrer" target="_blank">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" rel="external nofollow noreferrer" target="_blank">#17051</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" rel="external nofollow noreferrer" target="_blank">#17006</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong result in big integers (128, 256 bit) when casting from double. <a href="https://github.com/ClickHouse/ClickHouse/pull/16986" rel="external nofollow noreferrer" target="_blank">#16986</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Reresolve the IP of the <code class="syntax">format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" rel="external nofollow noreferrer" target="_blank">#16985</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed possible server crash after <code class="syntax">ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code class="syntax">SELECT</code> have <code class="syntax">WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" rel="external nofollow noreferrer" target="_blank">#16968</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Blame info was not calculated correctly in <code class="syntax">clickhouse-git-import</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16959" rel="external nofollow noreferrer" target="_blank">#16959</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed order by optimization with monotonous functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" rel="external nofollow noreferrer" target="_blank">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" rel="external nofollow noreferrer" target="_blank">#16956</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixrf optimization of group by with enabled setting <code class="syntax">optimize_aggregators_of_group_by_keys</code> and joins. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" rel="external nofollow noreferrer" target="_blank">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" rel="external nofollow noreferrer" target="_blank">#16951</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" rel="external nofollow noreferrer" target="_blank">#16936</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixrf possible error <code class="syntax">Illegal type of argument</code> for queries with <code class="syntax">ORDER BY</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" rel="external nofollow noreferrer" target="_blank">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" rel="external nofollow noreferrer" target="_blank">#16928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Abort multipart upload if no data was written to <code class="syntax">WriteBufferFromS3</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" rel="external nofollow noreferrer" target="_blank">#16840</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fixed crash when using <code class="syntax">any</code> without any arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" rel="external nofollow noreferrer" target="_blank">#16803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" rel="external nofollow noreferrer" target="_blank">#16826</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed the behaviour when ClickHouse used to always return 0 insted of a number of affected rows for <code class="syntax">INSERT</code> queries via MySQL protocol. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" rel="external nofollow noreferrer" target="_blank">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" rel="external nofollow noreferrer" target="_blank">#16715</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed uncontrolled growth of <code class="syntax">TDigest</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16680" rel="external nofollow noreferrer" target="_blank">#16680</a> (<a href="https://github.com/hrissan" rel="external nofollow noreferrer" target="_blank">hrissan</a>).</li>
<li>Fixed remote query failure when using suffix <code class="syntax">if</code> in Aggregate function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" rel="external nofollow noreferrer" target="_blank">#16574</a> fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" rel="external nofollow noreferrer" target="_blank">#16231</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" rel="external nofollow noreferrer" target="_blank">#16610</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-10-4-1-stable-2020-11-13">ClickHouse release v20.10.4.1-stable, 2020-11-13<a class="headerlink" href="#clickhouse-release-v20-10-4-1-stable-2020-11-13" title="Permanent link"> </a></h3>
<h4 id="bug-fix_8">Bug Fix<a class="headerlink" href="#bug-fix_8" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" rel="external nofollow noreferrer" target="_blank">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" rel="external nofollow noreferrer" target="_blank">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" rel="external nofollow noreferrer" target="_blank">#16846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">IN</code> operator over several columns and tuples with enabled <code class="syntax">transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" rel="external nofollow noreferrer" target="_blank">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" rel="external nofollow noreferrer" target="_blank">#16722</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>This will fix optimize_read_in_order/optimize_aggregation_in_order with max_threads&gt;0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" rel="external nofollow noreferrer" target="_blank">#16637</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Now when parsing AVRO from input the LowCardinality is removed from type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16188" rel="external nofollow noreferrer" target="_blank">#16188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" rel="external nofollow noreferrer" target="_blank">#16521</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Fix rapid growth of metadata when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine, and <code class="syntax">slave_parallel_worker</code> enabled on MySQL Slave, by properly shrinking GTID sets. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15951" rel="external nofollow noreferrer" target="_blank">#15951</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" rel="external nofollow noreferrer" target="_blank">#16504</a> (<a href="https://github.com/TCeason" rel="external nofollow noreferrer" target="_blank">TCeason</a>).</li>
<li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" rel="external nofollow noreferrer" target="_blank">#16409</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" rel="external nofollow noreferrer" target="_blank">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" rel="external nofollow noreferrer" target="_blank">#16332</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it's unnecessary. For example, query <code class="syntax">SELECT ... FROM system.parts</code> should work only with MergeTree tables and don't touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" rel="external nofollow noreferrer" target="_blank">#16032</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
</ul>
<h4 id="improvement_3">Improvement<a class="headerlink" href="#improvement_3" title="Permanent link"> </a></h4>
<ul>
<li>Workaround for use S3 with nginx server as proxy. Nginx currenty does not accept urls with empty path like <a href="http://domain.com?delete" target="_blank">http://domain.com?delete</a>, but vanilla aws-sdk-cpp produces this kind of urls. This commit uses patched aws-sdk-cpp version, which makes urls with "/" as path in this cases, like <a href="http://domain.com/?delete" target="_blank">http://domain.com/?delete</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16813" rel="external nofollow noreferrer" target="_blank">#16813</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-10-3-30-2020-10-28">ClickHouse release v20.10.3.30, 2020-10-28<a class="headerlink" href="#clickhouse-release-v20-10-3-30-2020-10-28" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_2">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_2" title="Permanent link"> </a></h4>
<ul>
<li>Make <code class="syntax">multiple_joins_rewriter_version</code> obsolete. Remove first version of joins rewriter. <a href="https://github.com/ClickHouse/ClickHouse/pull/15472" rel="external nofollow noreferrer" target="_blank">#15472</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Change default value of <code class="syntax">format_regexp_escaping_rule</code> setting (it's related to <code class="syntax">Regexp</code> format) to <code class="syntax">Raw</code> (it means - read whole subpattern as a value) to make the behaviour more like to what users expect. <a href="https://github.com/ClickHouse/ClickHouse/pull/15426" rel="external nofollow noreferrer" target="_blank">#15426</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add support for nested multiline comments <code class="syntax">/* comment /* comment */ */</code> in SQL. This conforms to the SQL standard. <a href="https://github.com/ClickHouse/ClickHouse/pull/14655" rel="external nofollow noreferrer" target="_blank">#14655</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added MergeTree settings (<code class="syntax">max_replicated_merges_with_ttl_in_queue</code> and <code class="syntax">max_number_of_merges_with_ttl_in_pool</code>) to control the number of merges with TTL in the background pool and replicated queue. This change breaks compatibility with older versions only if you use delete TTL. Otherwise, replication will stay compatible. You can avoid incompatibility issues if you update all shard replicas at once or execute <code class="syntax">SYSTEM STOP TTL MERGES</code> until you finish the update of all replicas. If you'll get an incompatible entry in the replication queue, first of all, execute <code class="syntax">SYSTEM STOP TTL MERGES</code> and after <code class="syntax">ALTER TABLE ... DETACH PARTITION ...</code> the partition where incompatible TTL merge was assigned. Attach it back on a single replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/14490" rel="external nofollow noreferrer" target="_blank">#14490</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_2">New Feature<a class="headerlink" href="#new-feature_2" title="Permanent link"> </a></h4>
<ul>
<li>Background data recompression. Add the ability to specify <code class="syntax">TTL ... RECOMPRESS codec_name</code> for MergeTree table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/14494" rel="external nofollow noreferrer" target="_blank">#14494</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add parallel quorum inserts. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15601" rel="external nofollow noreferrer" target="_blank">#15601</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15601" rel="external nofollow noreferrer" target="_blank">#15601</a> (<a href="https://github.com/alexelex" rel="external nofollow noreferrer" target="_blank">Latysheva Alexandra</a>).</li>
<li>Settings for additional enforcement of data durability. Useful for non-replicated setups. <a href="https://github.com/ClickHouse/ClickHouse/pull/11948" rel="external nofollow noreferrer" target="_blank">#11948</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>When duplicate block is written to replica where it does not exist locally (has not been fetched from replicas), don't ignore it and write locally to achieve the same effect as if it was successfully replicated. <a href="https://github.com/ClickHouse/ClickHouse/pull/11684" rel="external nofollow noreferrer" target="_blank">#11684</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now we support <code class="syntax">WITH &lt;identifier&gt; AS (subquery) ...</code> to introduce named subqueries in the query context. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2416" rel="external nofollow noreferrer" target="_blank">#2416</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/4967" rel="external nofollow noreferrer" target="_blank">#4967</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14771" rel="external nofollow noreferrer" target="_blank">#14771</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Introduce <code class="syntax">enable_global_with_statement</code> setting which propagates the first select's <code class="syntax">WITH</code> statements to other select queries at the same level, and makes aliases in <code class="syntax">WITH</code> statements visible to subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/15451" rel="external nofollow noreferrer" target="_blank">#15451</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Secure inter-cluster query execution (with initial_user as current query user). <a href="https://github.com/ClickHouse/ClickHouse/pull/13156" rel="external nofollow noreferrer" target="_blank">#13156</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/15551" rel="external nofollow noreferrer" target="_blank">#15551</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add the ability to remove column properties and table TTLs. Introduced queries <code class="syntax">ALTER TABLE MODIFY COLUMN col_name REMOVE what_to_remove</code> and <code class="syntax">ALTER TABLE REMOVE TTL</code>. Both operations are lightweight and executed at the metadata level. <a href="https://github.com/ClickHouse/ClickHouse/pull/14742" rel="external nofollow noreferrer" target="_blank">#14742</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Added format <code class="syntax">RawBLOB</code>. It is intended for input or output a single value without any escaping and delimiters. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15349" rel="external nofollow noreferrer" target="_blank">#15349</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15364" rel="external nofollow noreferrer" target="_blank">#15364</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add the <code class="syntax">reinterpretAsUUID</code> function that allows to convert a big-endian byte string to UUID. <a href="https://github.com/ClickHouse/ClickHouse/pull/15480" rel="external nofollow noreferrer" target="_blank">#15480</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Implement <code class="syntax">force_data_skipping_indices</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/15642" rel="external nofollow noreferrer" target="_blank">#15642</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add a setting <code class="syntax">output_format_pretty_row_numbers</code> to numerate the result in Pretty formats. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15350" rel="external nofollow noreferrer" target="_blank">#15350</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15443" rel="external nofollow noreferrer" target="_blank">#15443</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Added query obfuscation tool. It allows to share more queries for better testing. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15268" rel="external nofollow noreferrer" target="_blank">#15268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15321" rel="external nofollow noreferrer" target="_blank">#15321</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add table function <code class="syntax">null('structure')</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14797" rel="external nofollow noreferrer" target="_blank">#14797</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>).</li>
<li>Added <code class="syntax">formatReadableQuantity</code> function. It is useful for reading big numbers by human. <a href="https://github.com/ClickHouse/ClickHouse/pull/14725" rel="external nofollow noreferrer" target="_blank">#14725</a> (<a href="https://github.com/BooBSD" rel="external nofollow noreferrer" target="_blank">Artem Hnilov</a>).</li>
<li>Add format <code class="syntax">LineAsString</code> that accepts a sequence of lines separated by newlines, every line is parsed as a whole as a single String field. <a href="https://github.com/ClickHouse/ClickHouse/pull/14703" rel="external nofollow noreferrer" target="_blank">#14703</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>), <a href="https://github.com/ClickHouse/ClickHouse/pull/13846" rel="external nofollow noreferrer" target="_blank">#13846</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Add <code class="syntax">JSONStrings</code> format which output data in arrays of strings. <a href="https://github.com/ClickHouse/ClickHouse/pull/14333" rel="external nofollow noreferrer" target="_blank">#14333</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Add support for "Raw" column format for <code class="syntax">Regexp</code> format. It allows to simply extract subpatterns as a whole without any escaping rules. <a href="https://github.com/ClickHouse/ClickHouse/pull/15363" rel="external nofollow noreferrer" target="_blank">#15363</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow configurable <code class="syntax">NULL</code> representation for <code class="syntax">TSV</code> output format. It is controlled by the setting <code class="syntax">output_format_tsv_null_representation</code> which is <code class="syntax">\N</code> by default. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9375" rel="external nofollow noreferrer" target="_blank">#9375</a>. Note that the setting only controls output format and <code class="syntax">\N</code> is the only supported <code class="syntax">NULL</code> representation for <code class="syntax">TSV</code> input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/14586" rel="external nofollow noreferrer" target="_blank">#14586</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>Support Decimal data type for <code class="syntax">MaterializeMySQL</code>. <code class="syntax">MaterializeMySQL</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14535" rel="external nofollow noreferrer" target="_blank">#14535</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Add new feature: <code class="syntax">SHOW DATABASES LIKE 'xxx'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14521" rel="external nofollow noreferrer" target="_blank">#14521</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Added a script to import (arbitrary) git repository to ClickHouse as a sample dataset. <a href="https://github.com/ClickHouse/ClickHouse/pull/14471" rel="external nofollow noreferrer" target="_blank">#14471</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now insert statements can have asterisk (or variants) with column transformers in the column list. <a href="https://github.com/ClickHouse/ClickHouse/pull/14453" rel="external nofollow noreferrer" target="_blank">#14453</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>New query complexity limit settings <code class="syntax">max_rows_to_read_leaf</code>, <code class="syntax">max_bytes_to_read_leaf</code> for distributed queries to limit max rows/bytes read on the leaf nodes. Limit is applied for local reads only, <em>excluding</em> the final merge stage on the root node. <a href="https://github.com/ClickHouse/ClickHouse/pull/14221" rel="external nofollow noreferrer" target="_blank">#14221</a> (<a href="https://github.com/hagen1778" rel="external nofollow noreferrer" target="_blank">Roman Khavronenko</a>).</li>
<li>Allow user to specify settings for <code class="syntax">ReplicatedMergeTree*</code> storage in <code class="syntax">&lt;replicated_merge_tree&gt;</code> section of config file. It works similarly to <code class="syntax">&lt;merge_tree&gt;</code> section. For <code class="syntax">ReplicatedMergeTree*</code> storages settings from <code class="syntax">&lt;merge_tree&gt;</code> and <code class="syntax">&lt;replicated_merge_tree&gt;</code> are applied together, but settings from <code class="syntax">&lt;replicated_merge_tree&gt;</code> has higher priority. Added <code class="syntax">system.replicated_merge_tree_settings</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13573" rel="external nofollow noreferrer" target="_blank">#13573</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add <code class="syntax">mapPopulateSeries</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/13166" rel="external nofollow noreferrer" target="_blank">#13166</a> (<a href="https://github.com/ildus" rel="external nofollow noreferrer" target="_blank">Ildus Kurbangaliev</a>).</li>
<li>Supporting MySQL types: <code class="syntax">decimal</code> (as ClickHouse <code class="syntax">Decimal</code>) and <code class="syntax">datetime</code> with sub-second precision (as <code class="syntax">DateTime64</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11512" rel="external nofollow noreferrer" target="_blank">#11512</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Introduce <code class="syntax">event_time_microseconds</code> field to <code class="syntax">system.text_log</code>, <code class="syntax">system.trace_log</code>, <code class="syntax">system.query_log</code> and <code class="syntax">system.query_thread_log</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14760" rel="external nofollow noreferrer" target="_blank">#14760</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Add <code class="syntax">event_time_microseconds</code> to <code class="syntax">system.asynchronous_metric_log</code> &amp; <code class="syntax">system.metric_log</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14514" rel="external nofollow noreferrer" target="_blank">#14514</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Add <code class="syntax">query_start_time_microseconds</code> field to <code class="syntax">system.query_log</code> &amp; <code class="syntax">system.query_thread_log</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14252" rel="external nofollow noreferrer" target="_blank">#14252</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
</ul>
<h4 id="bug-fix_9">Bug Fix<a class="headerlink" href="#bug-fix_9" title="Permanent link"> </a></h4>
<ul>
<li>Fix the case when memory can be overallocated regardless to the limit. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14560" rel="external nofollow noreferrer" target="_blank">#14560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16206" rel="external nofollow noreferrer" target="_blank">#16206</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">executable</code> dictionary source hang. In previous versions, when using some formats (e.g. <code class="syntax">JSONEachRow</code>) data was not feed to a child process before it outputs at least something. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1697" rel="external nofollow noreferrer" target="_blank">#1697</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2455" rel="external nofollow noreferrer" target="_blank">#2455</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14525" rel="external nofollow noreferrer" target="_blank">#14525</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix double free in case of exception in function <code class="syntax">dictGet</code>. It could have happened if dictionary was loaded with error. <a href="https://github.com/ClickHouse/ClickHouse/pull/16429" rel="external nofollow noreferrer" target="_blank">#16429</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix group by with totals/rollup/cube modifers and min/max functions over group by keys. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16393" rel="external nofollow noreferrer" target="_blank">#16393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16397" rel="external nofollow noreferrer" target="_blank">#16397</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix async Distributed INSERT with prefer_localhost_replica=0 and internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/16358" rel="external nofollow noreferrer" target="_blank">#16358</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix a very wrong code in TwoLevelStringHashTable implementation, which might lead to memory leak. <a href="https://github.com/ClickHouse/ClickHouse/pull/16264" rel="external nofollow noreferrer" target="_blank">#16264</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix segfault in some cases of wrong aggregation in lambdas. <a href="https://github.com/ClickHouse/ClickHouse/pull/16082" rel="external nofollow noreferrer" target="_blank">#16082</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix <code class="syntax">ALTER MODIFY ... ORDER BY</code> query hang for <code class="syntax">ReplicatedVersionedCollapsingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15980" rel="external nofollow noreferrer" target="_blank">#15980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16011" rel="external nofollow noreferrer" target="_blank">#16011</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li><code class="syntax">MaterializeMySQL</code> (experimental feature): Fix collate name &amp; charset name parser and support <code class="syntax">length = 0</code> for string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/16008" rel="external nofollow noreferrer" target="_blank">#16008</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Allow to use <code class="syntax">direct</code> layout for dictionaries with complex keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/16007" rel="external nofollow noreferrer" target="_blank">#16007</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Prevent replica hang for 5-10 mins when replication error happens after a period of inactivity. <a href="https://github.com/ClickHouse/ClickHouse/pull/15987" rel="external nofollow noreferrer" target="_blank">#15987</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix rare segfaults when inserting into or selecting from MaterializedView and concurrently dropping target table (for Atomic database engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/15984" rel="external nofollow noreferrer" target="_blank">#15984</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix ambiguity in parsing of settings profiles: <code class="syntax">CREATE USER ... SETTINGS profile readonly</code> is now considered as using a profile named <code class="syntax">readonly</code>, not a setting named <code class="syntax">profile</code> with the readonly constraint. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15628" rel="external nofollow noreferrer" target="_blank">#15628</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15982" rel="external nofollow noreferrer" target="_blank">#15982</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li><code class="syntax">MaterializeMySQL</code> (experimental feature): Fix crash on create database failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/15954" rel="external nofollow noreferrer" target="_blank">#15954</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">DROP TABLE IF EXISTS</code> failure with <code class="syntax">Table ... does not exist</code> error when table is concurrently renamed (for Atomic database engine). Fixed rare deadlock when concurrently executing some DDL queries with multiple tables (like <code class="syntax">DROP DATABASE</code> and <code class="syntax">RENAME TABLE</code>) - Fixed <code class="syntax">DROP/DETACH DATABASE</code> failure with <code class="syntax">Table ... does not exist</code> when concurrently executing <code class="syntax">DROP/DETACH TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15934" rel="external nofollow noreferrer" target="_blank">#15934</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix incorrect empty result for query from <code class="syntax">Distributed</code> table if query has <code class="syntax">WHERE</code>, <code class="syntax">PREWHERE</code> and <code class="syntax">GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" rel="external nofollow noreferrer" target="_blank">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" rel="external nofollow noreferrer" target="_blank">#15933</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12513" rel="external nofollow noreferrer" target="_blank">#12513</a>: difference expressions with same alias when query is reanalyzed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15886" rel="external nofollow noreferrer" target="_blank">#15886</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix possible very rare deadlocks in RBAC implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/15875" rel="external nofollow noreferrer" target="_blank">#15875</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix exception <code class="syntax">Block structure mismatch</code> in <code class="syntax">SELECT ... ORDER BY DESC</code> queries which were executed after <code class="syntax">ALTER MODIFY COLUMN</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15800" rel="external nofollow noreferrer" target="_blank">#15800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15852" rel="external nofollow noreferrer" target="_blank">#15852</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li><code class="syntax">MaterializeMySQL</code> (experimental feature): Fix <code class="syntax">select count()</code> inaccuracy. <a href="https://github.com/ClickHouse/ClickHouse/pull/15767" rel="external nofollow noreferrer" target="_blank">#15767</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix some cases of queries, in which only virtual columns are selected. Previously <code class="syntax">Not found column _nothing in block</code> exception may be thrown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12298" rel="external nofollow noreferrer" target="_blank">#12298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15756" rel="external nofollow noreferrer" target="_blank">#15756</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix drop of materialized view with inner table in Atomic database (hangs all subsequent DROP TABLE due to hang of the worker thread, due to recursive DROP TABLE for inner table of MV). <a href="https://github.com/ClickHouse/ClickHouse/pull/15743" rel="external nofollow noreferrer" target="_blank">#15743</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Possibility to move part to another disk/volume if the first attempt was failed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15723" rel="external nofollow noreferrer" target="_blank">#15723</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fix error <code class="syntax">Cannot find column</code> which may happen at insertion into <code class="syntax">MATERIALIZED VIEW</code> in case if query for <code class="syntax">MV</code> containes <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15717" rel="external nofollow noreferrer" target="_blank">#15717</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed too low default value of <code class="syntax">max_replicated_logs_to_keep</code> setting, which might cause replicas to become lost too often. Improve lost replica recovery process by choosing the most up-to-date replica to clone. Also do not remove old parts from lost replica, detach them instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/15701" rel="external nofollow noreferrer" target="_blank">#15701</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix rare race condition in dictionaries and tables from MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/15686" rel="external nofollow noreferrer" target="_blank">#15686</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix (benign) race condition in AMQP-CPP. <a href="https://github.com/ClickHouse/ClickHouse/pull/15667" rel="external nofollow noreferrer" target="_blank">#15667</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix error <code class="syntax">Cannot add simple transform to empty Pipe</code> which happened while reading from <code class="syntax">Buffer</code> table which has different structure than destination table. It was possible if destination table returned empty result for query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15529" rel="external nofollow noreferrer" target="_blank">#15529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15662" rel="external nofollow noreferrer" target="_blank">#15662</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Proper error handling during insert into MergeTree with S3. MergeTree over S3 is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/15657" rel="external nofollow noreferrer" target="_blank">#15657</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fixed bug with S3 table function: region from URL was not applied to S3 client configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/15646" rel="external nofollow noreferrer" target="_blank">#15646</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fix the order of destruction for resources in <code class="syntax">ReadFromStorage</code> step of query plan. It might cause crashes in rare cases. Possibly connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/15610" rel="external nofollow noreferrer" target="_blank">#15610</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15645" rel="external nofollow noreferrer" target="_blank">#15645</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Subtract <code class="syntax">ReadonlyReplica</code> metric when detach readonly tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/15592" rel="external nofollow noreferrer" target="_blank">#15592</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Fixed <code class="syntax">Element ... is not a constant expression</code> error when using <code class="syntax">JSON*</code> function result in <code class="syntax">VALUES</code>, <code class="syntax">LIMIT</code> or right side of <code class="syntax">IN</code> operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15589" rel="external nofollow noreferrer" target="_blank">#15589</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Query will finish faster in case of exception. Cancel execution on remote replicas if exception happens. <a href="https://github.com/ClickHouse/ClickHouse/pull/15578" rel="external nofollow noreferrer" target="_blank">#15578</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Prevent the possibility of error message <code class="syntax">Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15541" rel="external nofollow noreferrer" target="_blank">#15541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15557" rel="external nofollow noreferrer" target="_blank">#15557</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">Database &lt;db&gt; does not exist.</code> in queries with IN and Distributed table when there's no database on initiator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15538" rel="external nofollow noreferrer" target="_blank">#15538</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Mutation might hang waiting for some non-existent part after <code class="syntax">MOVE</code> or <code class="syntax">REPLACE PARTITION</code> or, in rare cases, after <code class="syntax">DETACH</code> or <code class="syntax">DROP PARTITION</code>. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" rel="external nofollow noreferrer" target="_blank">#15537</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix bug when <code class="syntax">ILIKE</code> operator stops being case insensitive if <code class="syntax">LIKE</code> with the same pattern was executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15536" rel="external nofollow noreferrer" target="_blank">#15536</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix <code class="syntax">Missing columns</code> errors when selecting columns which absent in data, but depend on other columns which also absent in data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15530" rel="external nofollow noreferrer" target="_blank">#15530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15532" rel="external nofollow noreferrer" target="_blank">#15532</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Throw an error when a single parameter is passed to ReplicatedMergeTree instead of ignoring it. <a href="https://github.com/ClickHouse/ClickHouse/pull/15516" rel="external nofollow noreferrer" target="_blank">#15516</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
<li>Fix bug with event subscription in DDLWorker which rarely may lead to query hangs in <code class="syntax">ON CLUSTER</code>. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/13450" rel="external nofollow noreferrer" target="_blank">#13450</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15477" rel="external nofollow noreferrer" target="_blank">#15477</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Report proper error when the second argument of <code class="syntax">boundingRatio</code> aggregate function has a wrong type. <a href="https://github.com/ClickHouse/ClickHouse/pull/15407" rel="external nofollow noreferrer" target="_blank">#15407</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15365" rel="external nofollow noreferrer" target="_blank">#15365</a>: attach a database with MySQL engine throws exception (no query context). <a href="https://github.com/ClickHouse/ClickHouse/pull/15384" rel="external nofollow noreferrer" target="_blank">#15384</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix the case of multiple occurrences of column transformers in a select query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15378" rel="external nofollow noreferrer" target="_blank">#15378</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed compression in <code class="syntax">S3</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/15376" rel="external nofollow noreferrer" target="_blank">#15376</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fix bug where queries like <code class="syntax">SELECT toStartOfDay(today())</code> fail complaining about empty time_zone argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/15319" rel="external nofollow noreferrer" target="_blank">#15319</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix race condition during MergeTree table rename and background cleanup. <a href="https://github.com/ClickHouse/ClickHouse/pull/15304" rel="external nofollow noreferrer" target="_blank">#15304</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix rare race condition on server startup when system logs are enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/15300" rel="external nofollow noreferrer" target="_blank">#15300</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix hang of queries with a lot of subqueries to same table of <code class="syntax">MySQL</code> engine. Previously, if there were more than 16 subqueries to same <code class="syntax">MySQL</code> table in query, it hang forever. <a href="https://github.com/ClickHouse/ClickHouse/pull/15299" rel="external nofollow noreferrer" target="_blank">#15299</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix MSan report in QueryLog. Uninitialized memory can be used for the field <code class="syntax">memory_usage</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15258" rel="external nofollow noreferrer" target="_blank">#15258</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix 'Unknown identifier' in GROUP BY when query has JOIN over Merge table. <a href="https://github.com/ClickHouse/ClickHouse/pull/15242" rel="external nofollow noreferrer" target="_blank">#15242</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix instance crash when using <code class="syntax">joinGet</code> with <code class="syntax">LowCardinality</code> types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15214" rel="external nofollow noreferrer" target="_blank">#15214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15220" rel="external nofollow noreferrer" target="_blank">#15220</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix bug in table engine <code class="syntax">Buffer</code> which does not allow to insert data of new structure into <code class="syntax">Buffer</code> after <code class="syntax">ALTER</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15117" rel="external nofollow noreferrer" target="_blank">#15117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15192" rel="external nofollow noreferrer" target="_blank">#15192</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Adjust Decimal field size in MySQL column definition packet. <a href="https://github.com/ClickHouse/ClickHouse/pull/15152" rel="external nofollow noreferrer" target="_blank">#15152</a> (<a href="https://github.com/maqroll" rel="external nofollow noreferrer" target="_blank">maqroll</a>).</li>
<li>Fixes <code class="syntax">Data compressed with different methods</code> in <code class="syntax">join_algorithm='auto'</code>. Keep LowCardinality as type for left table join key in <code class="syntax">join_algorithm='partial_merge'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15088" rel="external nofollow noreferrer" target="_blank">#15088</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Update <code class="syntax">jemalloc</code> to fix <code class="syntax">percpu_arena</code> with affinity mask. <a href="https://github.com/ClickHouse/ClickHouse/pull/15035" rel="external nofollow noreferrer" target="_blank">#15035</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/14957" rel="external nofollow noreferrer" target="_blank">#14957</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>We already use padded comparison between String and FixedString (<a href="https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333" target="_blank">https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333</a>). This PR applies the same logic to field comparison which corrects the usage of FixedString as primary keys. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14908" rel="external nofollow noreferrer" target="_blank">#14908</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15033" rel="external nofollow noreferrer" target="_blank">#15033</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>If function <code class="syntax">bar</code> was called with specifically crafted arguments, buffer overflow was possible. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13926" rel="external nofollow noreferrer" target="_blank">#13926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15028" rel="external nofollow noreferrer" target="_blank">#15028</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">Cannot rename ... errno: 22, strerror: Invalid argument</code> error on DDL query execution in Atomic database when running clickhouse-server in Docker on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/15024" rel="external nofollow noreferrer" target="_blank">#15024</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix crash in RIGHT or FULL JOIN with join_algorith='auto' when memory limit exceeded and we should change HashJoin with MergeJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/15002" rel="external nofollow noreferrer" target="_blank">#15002</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Now settings <code class="syntax">number_of_free_entries_in_pool_to_execute_mutation</code> and <code class="syntax">number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> can be equal to <code class="syntax">background_pool_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14975" rel="external nofollow noreferrer" target="_blank">#14975</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix to make predicate push down work when subquery contains <code class="syntax">finalizeAggregation</code> function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" rel="external nofollow noreferrer" target="_blank">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" rel="external nofollow noreferrer" target="_blank">#14937</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Publish CPU frequencies per logical core in <code class="syntax">system.asynchronous_metrics</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14923" rel="external nofollow noreferrer" target="_blank">#14923</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14924" rel="external nofollow noreferrer" target="_blank">#14924</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li><code class="syntax">MaterializeMySQL</code> (experimental feature): Fixed <code class="syntax">.metadata.tmp File exists</code> error. <a href="https://github.com/ClickHouse/ClickHouse/pull/14898" rel="external nofollow noreferrer" target="_blank">#14898</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix the issue when some invocations of <code class="syntax">extractAllGroups</code> function may trigger "Memory limit exceeded" error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13383" rel="external nofollow noreferrer" target="_blank">#13383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14889" rel="external nofollow noreferrer" target="_blank">#14889</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix SIGSEGV for an attempt to INSERT into StorageFile with file descriptor. <a href="https://github.com/ClickHouse/ClickHouse/pull/14887" rel="external nofollow noreferrer" target="_blank">#14887</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed segfault in <code class="syntax">cache</code> dictionary <a href="https://github.com/ClickHouse/ClickHouse/issues/14837" rel="external nofollow noreferrer" target="_blank">#14837</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14879" rel="external nofollow noreferrer" target="_blank">#14879</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li><code class="syntax">MaterializeMySQL</code> (experimental feature): Fixed bug in parsing MySQL binlog events, which causes <code class="syntax">Attempt to read after eof</code> and <code class="syntax">Packet payload is not fully read</code> in <code class="syntax">MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14852" rel="external nofollow noreferrer" target="_blank">#14852</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix rare error in <code class="syntax">SELECT</code> queries when the queried column has <code class="syntax">DEFAULT</code> expression which depends on the other column which also has <code class="syntax">DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" rel="external nofollow noreferrer" target="_blank">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" rel="external nofollow noreferrer" target="_blank">#14845</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code class="syntax">from_zk</code> include option). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14814" rel="external nofollow noreferrer" target="_blank">#14814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14843" rel="external nofollow noreferrer" target="_blank">#14843</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fix wrong monotonicity detection for shrunk <code class="syntax">Int -&gt; Int</code> cast of signed types. It might lead to incorrect query result. This bug is unveiled in <a href="https://github.com/ClickHouse/ClickHouse/issues/14513" rel="external nofollow noreferrer" target="_blank">#14513</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14783" rel="external nofollow noreferrer" target="_blank">#14783</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li><code class="syntax">Replace</code> column transformer should replace identifiers with cloned ASTs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14695" rel="external nofollow noreferrer" target="_blank">#14695</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/14734" rel="external nofollow noreferrer" target="_blank">#14734</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed missed default database name in metadata of materialized view when executing <code class="syntax">ALTER ... MODIFY QUERY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14664" rel="external nofollow noreferrer" target="_blank">#14664</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix bug when <code class="syntax">ALTER UPDATE</code> mutation with <code class="syntax">Nullable</code> column in assignment expression and constant value (like <code class="syntax">UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" rel="external nofollow noreferrer" target="_blank">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" rel="external nofollow noreferrer" target="_blank">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" rel="external nofollow noreferrer" target="_blank">#14646</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" rel="external nofollow noreferrer" target="_blank">#14603</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix function <code class="syntax">has</code> with <code class="syntax">LowCardinality</code> of <code class="syntax">Nullable</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14591" rel="external nofollow noreferrer" target="_blank">#14591</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Cleanup data directory after Zookeeper exceptions during CreateQuery for StorageReplicatedMergeTree Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14563" rel="external nofollow noreferrer" target="_blank">#14563</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix rare segfaults in functions with combinator <code class="syntax">-Resample</code>, which could appear in result of overflow with very large parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14562" rel="external nofollow noreferrer" target="_blank">#14562</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix a bug when converting <code class="syntax">Nullable(String)</code> to Enum. Introduced by <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" rel="external nofollow noreferrer" target="_blank">#12745</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14435" rel="external nofollow noreferrer" target="_blank">#14435</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14530" rel="external nofollow noreferrer" target="_blank">#14530</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed the incorrect sorting order of <code class="syntax">Nullable</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14344" rel="external nofollow noreferrer" target="_blank">#14344</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14495" rel="external nofollow noreferrer" target="_blank">#14495</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix <code class="syntax">currentDatabase()</code> function cannot be used in <code class="syntax">ON CLUSTER</code> ddl query. <a href="https://github.com/ClickHouse/ClickHouse/pull/14211" rel="external nofollow noreferrer" target="_blank">#14211</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li><code class="syntax">MaterializeMySQL</code> (experimental feature): Fixed <code class="syntax">Packet payload is not fully read</code> error in <code class="syntax">MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14696" rel="external nofollow noreferrer" target="_blank">#14696</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
</ul>
<h4 id="improvement_4">Improvement<a class="headerlink" href="#improvement_4" title="Permanent link"> </a></h4>
<ul>
<li>Enable <code class="syntax">Atomic</code> database engine by default for newly created databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/15003" rel="external nofollow noreferrer" target="_blank">#15003</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Add the ability to specify specialized codecs like <code class="syntax">Delta</code>, <code class="syntax">T64</code>, etc. for columns with subtypes. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/12551" rel="external nofollow noreferrer" target="_blank">#12551</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11397" rel="external nofollow noreferrer" target="_blank">#11397</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4609" rel="external nofollow noreferrer" target="_blank">#4609</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15089" rel="external nofollow noreferrer" target="_blank">#15089</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Dynamic reload of zookeeper config. <a href="https://github.com/ClickHouse/ClickHouse/pull/14678" rel="external nofollow noreferrer" target="_blank">#14678</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Now it's allowed to execute <code class="syntax">ALTER ... ON CLUSTER</code> queries regardless of the <code class="syntax">&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" rel="external nofollow noreferrer" target="_blank">#16075</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Now <code class="syntax">joinGet</code> supports multi-key lookup. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/12418" rel="external nofollow noreferrer" target="_blank">#12418</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13015" rel="external nofollow noreferrer" target="_blank">#13015</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Wait for <code class="syntax">DROP/DETACH TABLE</code> to actually finish if <code class="syntax">NO DELAY</code> or <code class="syntax">SYNC</code> is specified for <code class="syntax">Atomic</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/15448" rel="external nofollow noreferrer" target="_blank">#15448</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now it's possible to change the type of version column for <code class="syntax">VersionedCollapsingMergeTree</code> with <code class="syntax">ALTER</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15442" rel="external nofollow noreferrer" target="_blank">#15442</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Unfold <code class="syntax">{database}</code>, <code class="syntax">{table}</code> and <code class="syntax">{uuid}</code> macros in <code class="syntax">zookeeper_path</code> on replicated table creation. Do not allow <code class="syntax">RENAME TABLE</code> if it may break <code class="syntax">zookeeper_path</code> after server restart. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6917" rel="external nofollow noreferrer" target="_blank">#6917</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15348" rel="external nofollow noreferrer" target="_blank">#15348</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>The function <code class="syntax">now</code> allows an argument with timezone. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15264" rel="external nofollow noreferrer" target="_blank">15264</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15285" rel="external nofollow noreferrer" target="_blank">#15285</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Do not allow connections to ClickHouse server until all scripts in <code class="syntax">/docker-entrypoint-initdb.d/</code> are executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15244" rel="external nofollow noreferrer" target="_blank">#15244</a> (<a href="https://github.com/alekseik1" rel="external nofollow noreferrer" target="_blank">Aleksei Kozharin</a>).</li>
<li>Added <code class="syntax">optimize</code> setting to <code class="syntax">EXPLAIN PLAN</code> query. If enabled, query plan level optimisations are applied. Enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/15201" rel="external nofollow noreferrer" target="_blank">#15201</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Proper exception message for wrong number of arguments of CAST. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13992" rel="external nofollow noreferrer" target="_blank">#13992</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15029" rel="external nofollow noreferrer" target="_blank">#15029</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add option to disable TTL move on data part insert. <a href="https://github.com/ClickHouse/ClickHouse/pull/15000" rel="external nofollow noreferrer" target="_blank">#15000</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Ignore key constraints when doing mutations. Without this pull request, it's not possible to do mutations when <code class="syntax">force_index_by_date = 1</code> or <code class="syntax">force_primary_key = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14973" rel="external nofollow noreferrer" target="_blank">#14973</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Allow to drop Replicated table if previous drop attempt was failed due to ZooKeeper session expiration. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11891" rel="external nofollow noreferrer" target="_blank">#11891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14926" rel="external nofollow noreferrer" target="_blank">#14926</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed excessive settings constraint violation when running SELECT with SETTINGS from a distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/14876" rel="external nofollow noreferrer" target="_blank">#14876</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Provide a <code class="syntax">load_balancing_first_offset</code> query setting to explicitly state what the first replica is. It's used together with <code class="syntax">FIRST_OR_RANDOM</code> load balancing strategy, which allows to control replicas workload. <a href="https://github.com/ClickHouse/ClickHouse/pull/14867" rel="external nofollow noreferrer" target="_blank">#14867</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Show subqueries for <code class="syntax">SET</code> and <code class="syntax">JOIN</code> in <code class="syntax">EXPLAIN</code> result. <a href="https://github.com/ClickHouse/ClickHouse/pull/14856" rel="external nofollow noreferrer" target="_blank">#14856</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Allow using multi-volume storage configuration in storage <code class="syntax">Distributed</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14839" rel="external nofollow noreferrer" target="_blank">#14839</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Construct <code class="syntax">query_start_time</code> and <code class="syntax">query_start_time_microseconds</code> from the same timespec. <a href="https://github.com/ClickHouse/ClickHouse/pull/14831" rel="external nofollow noreferrer" target="_blank">#14831</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Support for disabling persistency for <code class="syntax">StorageJoin</code> and <code class="syntax">StorageSet</code>, this feature is controlled by setting <code class="syntax">disable_set_and_join_persistency</code>. And this PR solved issue <a href="https://github.com/ClickHouse/ClickHouse/issues/6318" rel="external nofollow noreferrer" target="_blank">#6318</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14776" rel="external nofollow noreferrer" target="_blank">#14776</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>).</li>
<li>Now <code class="syntax">COLUMNS</code> can be used to wrap over a list of columns and apply column transformers afterwards. <a href="https://github.com/ClickHouse/ClickHouse/pull/14775" rel="external nofollow noreferrer" target="_blank">#14775</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add <code class="syntax">merge_algorithm</code> to <code class="syntax">system.merges</code> table to improve merging inspections. <a href="https://github.com/ClickHouse/ClickHouse/pull/14705" rel="external nofollow noreferrer" target="_blank">#14705</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix potential memory leak caused by zookeeper exists watch. <a href="https://github.com/ClickHouse/ClickHouse/pull/14693" rel="external nofollow noreferrer" target="_blank">#14693</a> (<a href="https://github.com/hustnn" rel="external nofollow noreferrer" target="_blank">hustnn</a>).</li>
<li>Allow parallel execution of distributed DDL. <a href="https://github.com/ClickHouse/ClickHouse/pull/14684" rel="external nofollow noreferrer" target="_blank">#14684</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add <code class="syntax">QueryMemoryLimitExceeded</code> event counter. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14589" rel="external nofollow noreferrer" target="_blank">#14589</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14647" rel="external nofollow noreferrer" target="_blank">#14647</a> (<a href="https://github.com/fastio" rel="external nofollow noreferrer" target="_blank">fastio</a>).</li>
<li>Fix some trailing whitespaces in query formatting. <a href="https://github.com/ClickHouse/ClickHouse/pull/14595" rel="external nofollow noreferrer" target="_blank">#14595</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>ClickHouse treats partition expr and key expr differently. Partition expr is used to construct an minmax index containing related columns, while primary key expr is stored as an expr. Sometimes user might partition a table at coarser levels, such as <code class="syntax">partition by i / 1000</code>. However, binary operators are not monotonic and this PR tries to fix that. It might also benifit other use cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/14513" rel="external nofollow noreferrer" target="_blank">#14513</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add an option to skip access checks for <code class="syntax">DiskS3</code>. <code class="syntax">s3</code> disk is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14497" rel="external nofollow noreferrer" target="_blank">#14497</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Speed up server shutdown process if there are ongoing S3 requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14496" rel="external nofollow noreferrer" target="_blank">#14496</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li><code class="syntax">SYSTEM RELOAD CONFIG</code> now throws an exception if failed to reload and continues using the previous users.xml. The background periodic reloading also continues using the previous users.xml if failed to reload. <a href="https://github.com/ClickHouse/ClickHouse/pull/14492" rel="external nofollow noreferrer" target="_blank">#14492</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>For INSERTs with inline data in VALUES format in the script mode of <code class="syntax">clickhouse-client</code>, support semicolon as the data terminator, in addition to the new line. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12288" rel="external nofollow noreferrer" target="_blank">#12288</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13192" rel="external nofollow noreferrer" target="_blank">#13192</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" rel="external nofollow noreferrer" target="_blank">#12183</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="performance-improvement_2">Performance Improvement<a class="headerlink" href="#performance-improvement_2" title="Permanent link"> </a></h4>
<ul>
<li>Enable compact parts by default for small parts. This will allow to process frequent inserts slightly more efficiently (4..100 times). <a href="https://github.com/ClickHouse/ClickHouse/pull/11913" rel="external nofollow noreferrer" target="_blank">#11913</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improve <code class="syntax">quantileTDigest</code> performance. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/2668" rel="external nofollow noreferrer" target="_blank">#2668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15542" rel="external nofollow noreferrer" target="_blank">#15542</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>Significantly reduce memory usage in AggregatingInOrderTransform/optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/15543" rel="external nofollow noreferrer" target="_blank">#15543</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Faster 256-bit multiplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/15418" rel="external nofollow noreferrer" target="_blank">#15418</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Improve performance of 256-bit types using (u)int64_t as base type for wide integers. Original wide integers use 8-bit types as base. <a href="https://github.com/ClickHouse/ClickHouse/pull/14859" rel="external nofollow noreferrer" target="_blank">#14859</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Explicitly use a temporary disk to store vertical merge temporary data. <a href="https://github.com/ClickHouse/ClickHouse/pull/15639" rel="external nofollow noreferrer" target="_blank">#15639</a> (<a href="https://github.com/GrigoryPervakov" rel="external nofollow noreferrer" target="_blank">Grigory Pervakov</a>).</li>
<li>Use one S3 DeleteObjects request instead of multiple DeleteObject in a loop. No any functionality changes, so covered by existing tests like integration/test_log_family_s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/15238" rel="external nofollow noreferrer" target="_blank">#15238</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Fix <code class="syntax">DateTime &lt;op&gt; DateTime</code> mistakenly choosing the slow generic implementation. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15153" rel="external nofollow noreferrer" target="_blank">#15153</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15178" rel="external nofollow noreferrer" target="_blank">#15178</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Improve performance of GROUP BY key of type <code class="syntax">FixedString</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15034" rel="external nofollow noreferrer" target="_blank">#15034</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Only <code class="syntax">mlock</code> code segment when starting clickhouse-server. In previous versions, all mapped regions were locked in memory, including debug info. Debug info is usually splitted to a separate file but if it isn't, it led to +2..3 GiB memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/14929" rel="external nofollow noreferrer" target="_blank">#14929</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>ClickHouse binary become smaller due to link time optimization.</li>
</ul>
<h4 id="build-testing-packaging-improvement_4">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_4" title="Permanent link"> </a></h4>
<ul>
<li>Now we use clang-11 for production ClickHouse build. <a href="https://github.com/ClickHouse/ClickHouse/pull/15239" rel="external nofollow noreferrer" target="_blank">#15239</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Now we use clang-11 to build ClickHouse in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/14846" rel="external nofollow noreferrer" target="_blank">#14846</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Switch binary builds (Linux, Darwin, AArch64, FreeDSD) to clang-11. <a href="https://github.com/ClickHouse/ClickHouse/pull/15622" rel="external nofollow noreferrer" target="_blank">#15622</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Now all test images use <code class="syntax">llvm-symbolizer-11</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15069" rel="external nofollow noreferrer" target="_blank">#15069</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Allow to build with llvm-11. <a href="https://github.com/ClickHouse/ClickHouse/pull/15366" rel="external nofollow noreferrer" target="_blank">#15366</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Switch from <code class="syntax">clang-tidy-10</code> to <code class="syntax">clang-tidy-11</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14922" rel="external nofollow noreferrer" target="_blank">#14922</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Use LLVM's experimental pass manager by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/15608" rel="external nofollow noreferrer" target="_blank">#15608</a> (<a href="https://github.com/danlark1" rel="external nofollow noreferrer" target="_blank">Danila Kutenin</a>).</li>
<li>Don't allow any C++ translation unit to build more than 10 minutes or to use more than 10 GB or memory. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14925" rel="external nofollow noreferrer" target="_blank">#14925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15060" rel="external nofollow noreferrer" target="_blank">#15060</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Make performance test more stable and representative by splitting test runs and profile runs. <a href="https://github.com/ClickHouse/ClickHouse/pull/15027" rel="external nofollow noreferrer" target="_blank">#15027</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Attempt to make performance test more reliable. It is done by remapping the executable memory of the process on the fly with <code class="syntax">madvise</code> to use transparent huge pages - it can lower the number of iTLB misses which is the main source of instabilities in performance tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14685" rel="external nofollow noreferrer" target="_blank">#14685</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Convert to python3. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14886" rel="external nofollow noreferrer" target="_blank">#14886</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15007" rel="external nofollow noreferrer" target="_blank">#15007</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fail early in functional tests if server failed to respond. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15262" rel="external nofollow noreferrer" target="_blank">#15262</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15267" rel="external nofollow noreferrer" target="_blank">#15267</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow to run AArch64 version of clickhouse-server without configs. This facilitates <a href="https://github.com/ClickHouse/ClickHouse/issues/15174" rel="external nofollow noreferrer" target="_blank">#15174</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15266" rel="external nofollow noreferrer" target="_blank">#15266</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improvements in CI docker images: get rid of ZooKeeper and single script for test configs installation. <a href="https://github.com/ClickHouse/ClickHouse/pull/15215" rel="external nofollow noreferrer" target="_blank">#15215</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix CMake options forwarding in fast test script. Fixes error in <a href="https://github.com/ClickHouse/ClickHouse/issues/14711" rel="external nofollow noreferrer" target="_blank">#14711</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15155" rel="external nofollow noreferrer" target="_blank">#15155</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Added a script to perform hardware benchmark in a single command. <a href="https://github.com/ClickHouse/ClickHouse/pull/15115" rel="external nofollow noreferrer" target="_blank">#15115</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Splitted huge test <code class="syntax">test_dictionaries_all_layouts_and_sources</code> into smaller ones. <a href="https://github.com/ClickHouse/ClickHouse/pull/15110" rel="external nofollow noreferrer" target="_blank">#15110</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Maybe fix MSan report in base64 (on servers with AVX-512). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14006" rel="external nofollow noreferrer" target="_blank">#14006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15030" rel="external nofollow noreferrer" target="_blank">#15030</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Reformat and cleanup code in all integration test *.py files. <a href="https://github.com/ClickHouse/ClickHouse/pull/14864" rel="external nofollow noreferrer" target="_blank">#14864</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix MaterializeMySQL empty transaction unstable test case found in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/14854" rel="external nofollow noreferrer" target="_blank">#14854</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Attempt to speed up build a little. <a href="https://github.com/ClickHouse/ClickHouse/pull/14808" rel="external nofollow noreferrer" target="_blank">#14808</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Speed up build a little by removing unused headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/14714" rel="external nofollow noreferrer" target="_blank">#14714</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix build failure in OSX. <a href="https://github.com/ClickHouse/ClickHouse/pull/14761" rel="external nofollow noreferrer" target="_blank">#14761</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Enable ccache by default in cmake if it's found in OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/14575" rel="external nofollow noreferrer" target="_blank">#14575</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Control CI builds configuration from the ClickHouse repository. <a href="https://github.com/ClickHouse/ClickHouse/pull/14547" rel="external nofollow noreferrer" target="_blank">#14547</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>In CMake files: - Moved some options' descriptions' parts to comments above. - Replace 0 -&gt; <code class="syntax">OFF</code>, 1 -&gt; <code class="syntax">ON</code> in <code class="syntax">option</code>s default values. - Added some descriptions and links to docs to the options. - Replaced <code class="syntax">FUZZER</code> option (there is another option <code class="syntax">ENABLE_FUZZING</code> which also enables same functionality). - Removed <code class="syntax">ENABLE_GTEST_LIBRARY</code> option as there is <code class="syntax">ENABLE_TESTS</code>. See the full description in PR: <a href="https://github.com/ClickHouse/ClickHouse/pull/14711" rel="external nofollow noreferrer" target="_blank">#14711</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Make binary a bit smaller (~50 Mb for debug version). <a href="https://github.com/ClickHouse/ClickHouse/pull/14555" rel="external nofollow noreferrer" target="_blank">#14555</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Use std::filesystem::path in ConfigProcessor for concatenating file paths. <a href="https://github.com/ClickHouse/ClickHouse/pull/14558" rel="external nofollow noreferrer" target="_blank">#14558</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix debug assertion in <code class="syntax">bitShiftLeft()</code> when called with negative big integer. <a href="https://github.com/ClickHouse/ClickHouse/pull/14697" rel="external nofollow noreferrer" target="_blank">#14697</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
</ul>
<h2 id="clickhouse-release-20-9">ClickHouse release 20.9<a class="headerlink" href="#clickhouse-release-20-9" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-9-7-11-stable-2020-12-07">ClickHouse release v20.9.7.11-stable, 2020-12-07<a class="headerlink" href="#clickhouse-release-v20-9-7-11-stable-2020-12-07" title="Permanent link"> </a></h3>
<h4 id="performance-improvement_3">Performance Improvement<a class="headerlink" href="#performance-improvement_3" title="Permanent link"> </a></h4>
<ul>
<li>Fix performance of reading from <code class="syntax">Merge</code> tables over huge number of <code class="syntax">MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7748" rel="external nofollow noreferrer" target="_blank">#7748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16988" rel="external nofollow noreferrer" target="_blank">#16988</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="bug-fix_10">Bug Fix<a class="headerlink" href="#bug-fix_10" title="Permanent link"> </a></h4>
<ul>
<li>Do not restore parts from WAL if <code class="syntax">in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" rel="external nofollow noreferrer" target="_blank">#17802</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>Fixed segfault when there is not enough space when inserting into <code class="syntax">Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/17737" rel="external nofollow noreferrer" target="_blank">#17737</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" rel="external nofollow noreferrer" target="_blank">#17681</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fixed <code class="syntax">Function not implemented</code> error when executing <code class="syntax">RENAME</code> query in <code class="syntax">Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17661" rel="external nofollow noreferrer" target="_blank">#17661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17664" rel="external nofollow noreferrer" target="_blank">#17664</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" rel="external nofollow noreferrer" target="_blank">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" rel="external nofollow noreferrer" target="_blank">#17565</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" rel="external nofollow noreferrer" target="_blank">#17542</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" rel="external nofollow noreferrer" target="_blank">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" rel="external nofollow noreferrer" target="_blank">#17499</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix bug when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" rel="external nofollow noreferrer" target="_blank">#17496</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix <code class="syntax">ORDER BY</code> with enabled setting <code class="syntax">optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" rel="external nofollow noreferrer" target="_blank">#17471</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix duplicates after <code class="syntax">DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" rel="external nofollow noreferrer" target="_blank">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" rel="external nofollow noreferrer" target="_blank">#17296</a> (<a href="https://github.com/chengxianglibra" rel="external nofollow noreferrer" target="_blank">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" rel="external nofollow noreferrer" target="_blank">#17439</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix crash while reading from <code class="syntax">JOIN</code> table with <code class="syntax">LowCardinality</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" rel="external nofollow noreferrer" target="_blank">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" rel="external nofollow noreferrer" target="_blank">#17397</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" rel="external nofollow noreferrer" target="_blank">#17246</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" rel="external nofollow noreferrer" target="_blank">#17249</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix ColumnConst comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" rel="external nofollow noreferrer" target="_blank">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" rel="external nofollow noreferrer" target="_blank">#17135</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed crash on <code class="syntax">CREATE TABLE ... AS some_table</code> query when <code class="syntax">some_table</code> was created <code class="syntax">AS table_function()</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16944" rel="external nofollow noreferrer" target="_blank">#16944</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17072" rel="external nofollow noreferrer" target="_blank">#17072</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Bug fix for funciton fuzzBits, related issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" rel="external nofollow noreferrer" target="_blank">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" rel="external nofollow noreferrer" target="_blank">#17051</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" rel="external nofollow noreferrer" target="_blank">#17006</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>TODO. <a href="https://github.com/ClickHouse/ClickHouse/pull/16866" rel="external nofollow noreferrer" target="_blank">#16866</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Return number of affected rows for INSERT queries via MySQL protocol. Previously ClickHouse used to always return 0, it's fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" rel="external nofollow noreferrer" target="_blank">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" rel="external nofollow noreferrer" target="_blank">#16715</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_5">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_5" title="Permanent link"> </a></h4>
<ul>
<li>Update embedded timezone data to version 2020d (also update cctz to the latest master). <a href="https://github.com/ClickHouse/ClickHouse/pull/17204" rel="external nofollow noreferrer" target="_blank">#17204</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-9-6-14-stable-2020-11-20">ClickHouse release v20.9.6.14-stable, 2020-11-20<a class="headerlink" href="#clickhouse-release-v20-9-6-14-stable-2020-11-20" title="Permanent link"> </a></h3>
<h4 id="improvement_5">Improvement<a class="headerlink" href="#improvement_5" title="Permanent link"> </a></h4>
<ul>
<li>Make it possible to connect to <code class="syntax">clickhouse-server</code> secure endpoint which requires SNI. This is possible when <code class="syntax">clickhouse-server</code> is hosted behind TLS proxy. <a href="https://github.com/ClickHouse/ClickHouse/pull/16938" rel="external nofollow noreferrer" target="_blank">#16938</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Conditional aggregate functions (for example: <code class="syntax">avgIf</code>, <code class="syntax">sumIf</code>, <code class="syntax">maxIf</code>) should return <code class="syntax">NULL</code> when miss rows and use nullable arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/13964" rel="external nofollow noreferrer" target="_blank">#13964</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
</ul>
<h4 id="bug-fix_11">Bug Fix<a class="headerlink" href="#bug-fix_11" title="Permanent link"> </a></h4>
<ul>
<li>Fix bug when <code class="syntax">ON CLUSTER</code> queries may hang forever for non-leader ReplicatedMergeTreeTables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" rel="external nofollow noreferrer" target="_blank">#17089</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Reresolve the IP of the <code class="syntax">format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" rel="external nofollow noreferrer" target="_blank">#16985</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix possible server crash after <code class="syntax">ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code class="syntax">SELECT</code> have <code class="syntax">WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" rel="external nofollow noreferrer" target="_blank">#16968</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" rel="external nofollow noreferrer" target="_blank">#16936</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix possible error <code class="syntax">Illegal type of argument</code> for queries with <code class="syntax">ORDER BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" rel="external nofollow noreferrer" target="_blank">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" rel="external nofollow noreferrer" target="_blank">#16928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Abort multipart upload if no data was written to WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" rel="external nofollow noreferrer" target="_blank">#16840</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fix crash when using <code class="syntax">any</code> without any arguments. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" rel="external nofollow noreferrer" target="_blank">#16803</a> . cc @azat. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" rel="external nofollow noreferrer" target="_blank">#16826</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix <code class="syntax">IN</code> operator over several columns and tuples with enabled <code class="syntax">transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" rel="external nofollow noreferrer" target="_blank">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" rel="external nofollow noreferrer" target="_blank">#16722</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>This will fix optimize_read_in_order/optimize_aggregation_in_order with max_threads&gt;0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" rel="external nofollow noreferrer" target="_blank">#16637</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" rel="external nofollow noreferrer" target="_blank">#16574</a> fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" rel="external nofollow noreferrer" target="_blank">#16231</a> fix remote query failure when using 'if' suffix aggregate function. <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" rel="external nofollow noreferrer" target="_blank">#16610</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Query is finished faster in case of exception. Cancel execution on remote replicas if exception happens. <a href="https://github.com/ClickHouse/ClickHouse/pull/15578" rel="external nofollow noreferrer" target="_blank">#15578</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-9-5-5-stable-2020-11-13">ClickHouse release v20.9.5.5-stable, 2020-11-13<a class="headerlink" href="#clickhouse-release-v20-9-5-5-stable-2020-11-13" title="Permanent link"> </a></h3>
<h4 id="bug-fix_12">Bug Fix<a class="headerlink" href="#bug-fix_12" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" rel="external nofollow noreferrer" target="_blank">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" rel="external nofollow noreferrer" target="_blank">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" rel="external nofollow noreferrer" target="_blank">#16846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now when parsing AVRO from input the LowCardinality is removed from type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16188" rel="external nofollow noreferrer" target="_blank">#16188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" rel="external nofollow noreferrer" target="_blank">#16521</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Fix rapid growth of metadata when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine, and <code class="syntax">slave_parallel_worker</code> enabled on MySQL Slave, by properly shrinking GTID sets. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15951" rel="external nofollow noreferrer" target="_blank">#15951</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" rel="external nofollow noreferrer" target="_blank">#16504</a> (<a href="https://github.com/TCeason" rel="external nofollow noreferrer" target="_blank">TCeason</a>).</li>
<li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" rel="external nofollow noreferrer" target="_blank">#16409</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" rel="external nofollow noreferrer" target="_blank">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" rel="external nofollow noreferrer" target="_blank">#16332</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the inconsistent behaviour when a part of return data could be dropped because the set for its filtration wasn't created. <a href="https://github.com/ClickHouse/ClickHouse/pull/16308" rel="external nofollow noreferrer" target="_blank">#16308</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it's unnecessary. For example, query <code class="syntax">SELECT ... FROM system.parts</code> should work only with MergeTree tables and don't touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" rel="external nofollow noreferrer" target="_blank">#16032</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-9-4-76-stable-2020-10-29">ClickHouse release v20.9.4.76-stable (2020-10-29)<a class="headerlink" href="#clickhouse-release-v20-9-4-76-stable-2020-10-29" title="Permanent link"> </a></h3>
<h4 id="bug-fix_13">Bug Fix<a class="headerlink" href="#bug-fix_13" title="Permanent link"> </a></h4>
<ul>
<li>Fix double free in case of exception in function <code class="syntax">dictGet</code>. It could have happened if dictionary was loaded with error. <a href="https://github.com/ClickHouse/ClickHouse/pull/16429" rel="external nofollow noreferrer" target="_blank">#16429</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix group by with totals/rollup/cube modifers and min/max functions over group by keys. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16393" rel="external nofollow noreferrer" target="_blank">#16393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16397" rel="external nofollow noreferrer" target="_blank">#16397</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix async Distributed INSERT w/ prefer_localhost_replica=0 and internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/16358" rel="external nofollow noreferrer" target="_blank">#16358</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix a very wrong code in TwoLevelStringHashTable implementation, which might lead to memory leak. I'm suprised how this bug can lurk for so long.... <a href="https://github.com/ClickHouse/ClickHouse/pull/16264" rel="external nofollow noreferrer" target="_blank">#16264</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix the case when memory can be overallocated regardless to the limit. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14560" rel="external nofollow noreferrer" target="_blank">#14560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16206" rel="external nofollow noreferrer" target="_blank">#16206</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">ALTER MODIFY ... ORDER BY</code> query hang for <code class="syntax">ReplicatedVersionedCollapsingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15980" rel="external nofollow noreferrer" target="_blank">#15980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16011" rel="external nofollow noreferrer" target="_blank">#16011</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix collate name &amp; charset name parser and support <code class="syntax">length = 0</code> for string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/16008" rel="external nofollow noreferrer" target="_blank">#16008</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Allow to use direct layout for dictionaries with complex keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/16007" rel="external nofollow noreferrer" target="_blank">#16007</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Prevent replica hang for 5-10 mins when replication error happens after a period of inactivity. <a href="https://github.com/ClickHouse/ClickHouse/pull/15987" rel="external nofollow noreferrer" target="_blank">#15987</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix rare segfaults when inserting into or selecting from MaterializedView and concurrently dropping target table (for Atomic database engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/15984" rel="external nofollow noreferrer" target="_blank">#15984</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix ambiguity in parsing of settings profiles: <code class="syntax">CREATE USER ... SETTINGS profile readonly</code> is now considered as using a profile named <code class="syntax">readonly</code>, not a setting named <code class="syntax">profile</code> with the readonly constraint. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15628" rel="external nofollow noreferrer" target="_blank">#15628</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15982" rel="external nofollow noreferrer" target="_blank">#15982</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix a crash when database creation fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/15954" rel="external nofollow noreferrer" target="_blank">#15954</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">DROP TABLE IF EXISTS</code> failure with <code class="syntax">Table ... does not exist</code> error when table is concurrently renamed (for Atomic database engine). Fixed rare deadlock when concurrently executing some DDL queries with multiple tables (like <code class="syntax">DROP DATABASE</code> and <code class="syntax">RENAME TABLE</code>) Fixed <code class="syntax">DROP/DETACH DATABASE</code> failure with <code class="syntax">Table ... does not exist</code> when concurrently executing <code class="syntax">DROP/DETACH TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15934" rel="external nofollow noreferrer" target="_blank">#15934</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix incorrect empty result for query from <code class="syntax">Distributed</code> table if query has <code class="syntax">WHERE</code>, <code class="syntax">PREWHERE</code> and <code class="syntax">GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" rel="external nofollow noreferrer" target="_blank">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" rel="external nofollow noreferrer" target="_blank">#15933</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible deadlocks in RBAC. <a href="https://github.com/ClickHouse/ClickHouse/pull/15875" rel="external nofollow noreferrer" target="_blank">#15875</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix exception <code class="syntax">Block structure mismatch</code> in <code class="syntax">SELECT ... ORDER BY DESC</code> queries which were executed after <code class="syntax">ALTER MODIFY COLUMN</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15800" rel="external nofollow noreferrer" target="_blank">#15800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15852" rel="external nofollow noreferrer" target="_blank">#15852</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix <code class="syntax">select count()</code> inaccuracy for MaterializeMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/15767" rel="external nofollow noreferrer" target="_blank">#15767</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix some cases of queries, in which only virtual columns are selected. Previously <code class="syntax">Not found column _nothing in block</code> exception may be thrown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12298" rel="external nofollow noreferrer" target="_blank">#12298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15756" rel="external nofollow noreferrer" target="_blank">#15756</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed too low default value of <code class="syntax">max_replicated_logs_to_keep</code> setting, which might cause replicas to become lost too often. Improve lost replica recovery process by choosing the most up-to-date replica to clone. Also do not remove old parts from lost replica, detach them instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/15701" rel="external nofollow noreferrer" target="_blank">#15701</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix error <code class="syntax">Cannot add simple transform to empty Pipe</code> which happened while reading from <code class="syntax">Buffer</code> table which has different structure than destination table. It was possible if destination table returned empty result for query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15529" rel="external nofollow noreferrer" target="_blank">#15529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15662" rel="external nofollow noreferrer" target="_blank">#15662</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed bug with globs in S3 table function, region from URL was not applied to S3 client configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/15646" rel="external nofollow noreferrer" target="_blank">#15646</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Decrement the <code class="syntax">ReadonlyReplica</code> metric when detaching read-only tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15598" rel="external nofollow noreferrer" target="_blank">#15598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15592" rel="external nofollow noreferrer" target="_blank">#15592</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Throw an error when a single parameter is passed to ReplicatedMergeTree instead of ignoring it. <a href="https://github.com/ClickHouse/ClickHouse/pull/15516" rel="external nofollow noreferrer" target="_blank">#15516</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
</ul>
<h4 id="improvement_6">Improvement<a class="headerlink" href="#improvement_6" title="Permanent link"> </a></h4>
<ul>
<li>Now it's allowed to execute <code class="syntax">ALTER ... ON CLUSTER</code> queries regardless of the <code class="syntax">&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" rel="external nofollow noreferrer" target="_blank">#16075</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Unfold <code class="syntax">{database}</code>, <code class="syntax">{table}</code> and <code class="syntax">{uuid}</code> macros in <code class="syntax">ReplicatedMergeTree</code> arguments on table creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16160" rel="external nofollow noreferrer" target="_blank">#16160</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-9-3-45-stable-2020-10-09">ClickHouse release v20.9.3.45-stable (2020-10-09)<a class="headerlink" href="#clickhouse-release-v20-9-3-45-stable-2020-10-09" title="Permanent link"> </a></h3>
<h4 id="bug-fix_14">Bug Fix<a class="headerlink" href="#bug-fix_14" title="Permanent link"> </a></h4>
<ul>
<li>Fix error <code class="syntax">Cannot find column</code> which may happen at insertion into <code class="syntax">MATERIALIZED VIEW</code> in case if query for <code class="syntax">MV</code> containes <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15717" rel="external nofollow noreferrer" target="_blank">#15717</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix race condition in AMQP-CPP. <a href="https://github.com/ClickHouse/ClickHouse/pull/15667" rel="external nofollow noreferrer" target="_blank">#15667</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix the order of destruction for resources in <code class="syntax">ReadFromStorage</code> step of query plan. It might cause crashes in rare cases. Possibly connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/15610" rel="external nofollow noreferrer" target="_blank">#15610</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15645" rel="external nofollow noreferrer" target="_blank">#15645</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed <code class="syntax">Element ... is not a constant expression</code> error when using <code class="syntax">JSON*</code> function result in <code class="syntax">VALUES</code>, <code class="syntax">LIMIT</code> or right side of <code class="syntax">IN</code> operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15589" rel="external nofollow noreferrer" target="_blank">#15589</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Prevent the possibility of error message <code class="syntax">Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15541" rel="external nofollow noreferrer" target="_blank">#15541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15557" rel="external nofollow noreferrer" target="_blank">#15557</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Significantly reduce memory usage in AggregatingInOrderTransform/optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/15543" rel="external nofollow noreferrer" target="_blank">#15543</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Mutation might hang waiting for some non-existent part after <code class="syntax">MOVE</code> or <code class="syntax">REPLACE PARTITION</code> or, in rare cases, after <code class="syntax">DETACH</code> or <code class="syntax">DROP PARTITION</code>. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" rel="external nofollow noreferrer" target="_blank">#15537</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix bug when <code class="syntax">ILIKE</code> operator stops being case insensitive if <code class="syntax">LIKE</code> with the same pattern was executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15536" rel="external nofollow noreferrer" target="_blank">#15536</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix <code class="syntax">Missing columns</code> errors when selecting columns which absent in data, but depend on other columns which also absent in data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15530" rel="external nofollow noreferrer" target="_blank">#15530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15532" rel="external nofollow noreferrer" target="_blank">#15532</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix bug with event subscription in DDLWorker which rarely may lead to query hangs in <code class="syntax">ON CLUSTER</code>. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/13450" rel="external nofollow noreferrer" target="_blank">#13450</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15477" rel="external nofollow noreferrer" target="_blank">#15477</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Report proper error when the second argument of <code class="syntax">boundingRatio</code> aggregate function has a wrong type. <a href="https://github.com/ClickHouse/ClickHouse/pull/15407" rel="external nofollow noreferrer" target="_blank">#15407</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>Fix bug where queries like <code class="syntax">SELECT toStartOfDay(today())</code> fail complaining about empty time_zone argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/15319" rel="external nofollow noreferrer" target="_blank">#15319</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix race condition during MergeTree table rename and background cleanup. <a href="https://github.com/ClickHouse/ClickHouse/pull/15304" rel="external nofollow noreferrer" target="_blank">#15304</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix rare race condition on server startup when system.logs are enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/15300" rel="external nofollow noreferrer" target="_blank">#15300</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix MSan report in QueryLog. Uninitialized memory can be used for the field <code class="syntax">memory_usage</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15258" rel="external nofollow noreferrer" target="_blank">#15258</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix instance crash when using joinGet with LowCardinality types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15214" rel="external nofollow noreferrer" target="_blank">#15214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15220" rel="external nofollow noreferrer" target="_blank">#15220</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix bug in table engine <code class="syntax">Buffer</code> which does not allow to insert data of new structure into <code class="syntax">Buffer</code> after <code class="syntax">ALTER</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15117" rel="external nofollow noreferrer" target="_blank">#15117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15192" rel="external nofollow noreferrer" target="_blank">#15192</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Adjust decimals field size in mysql column definition packet. <a href="https://github.com/ClickHouse/ClickHouse/pull/15152" rel="external nofollow noreferrer" target="_blank">#15152</a> (<a href="https://github.com/maqroll" rel="external nofollow noreferrer" target="_blank">maqroll</a>).</li>
<li>Fixed <code class="syntax">Cannot rename ... errno: 22, strerror: Invalid argument</code> error on DDL query execution in Atomic database when running clickhouse-server in docker on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/15024" rel="external nofollow noreferrer" target="_blank">#15024</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix to make predicate push down work when subquery contains finalizeAggregation function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" rel="external nofollow noreferrer" target="_blank">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" rel="external nofollow noreferrer" target="_blank">#14937</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code class="syntax">from_zk</code> include option). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14814" rel="external nofollow noreferrer" target="_blank">#14814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14843" rel="external nofollow noreferrer" target="_blank">#14843</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
</ul>
<h4 id="improvement_7">Improvement<a class="headerlink" href="#improvement_7" title="Permanent link"> </a></h4>
<ul>
<li>Now it's possible to change the type of version column for <code class="syntax">VersionedCollapsingMergeTree</code> with <code class="syntax">ALTER</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15442" rel="external nofollow noreferrer" target="_blank">#15442</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-9-2-20-2020-09-22">ClickHouse release v20.9.2.20, 2020-09-22<a class="headerlink" href="#clickhouse-release-v20-9-2-20-2020-09-22" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_3">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_3" title="Permanent link"> </a></h4>
<ul>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_3">New Feature<a class="headerlink" href="#new-feature_3" title="Permanent link"> </a></h4>
<ul>
<li>Added column transformers <code class="syntax">EXCEPT</code>, <code class="syntax">REPLACE</code>, <code class="syntax">APPLY</code>, which can be applied to the list of selected columns (after <code class="syntax">*</code> or <code class="syntax">COLUMNS(...)</code>). For example, you can write <code class="syntax">SELECT * EXCEPT(URL) REPLACE(number + 1 AS number)</code>. Another example: <code class="syntax">select * apply(length) apply(max) from wide_string_table</code> to find out the maxium length of all string columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/14233" rel="external nofollow noreferrer" target="_blank">#14233</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Added an aggregate function <code class="syntax">rankCorr</code> which computes a rank correlation coefficient. <a href="https://github.com/ClickHouse/ClickHouse/pull/11769" rel="external nofollow noreferrer" target="_blank">#11769</a> (<a href="https://github.com/antikvist" rel="external nofollow noreferrer" target="_blank">antikvist</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/14411" rel="external nofollow noreferrer" target="_blank">#14411</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Added table function <code class="syntax">view</code> which turns a subquery into a table object. This helps passing queries around. For instance, it can be used in remote/cluster table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/12567" rel="external nofollow noreferrer" target="_blank">#12567</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
</ul>
<h4 id="bug-fix_15">Bug Fix<a class="headerlink" href="#bug-fix_15" title="Permanent link"> </a></h4>
<ul>
<li>Fix bug when <code class="syntax">ALTER UPDATE</code> mutation with Nullable column in assignment expression and constant value (like <code class="syntax">UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" rel="external nofollow noreferrer" target="_blank">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" rel="external nofollow noreferrer" target="_blank">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" rel="external nofollow noreferrer" target="_blank">#14646</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" rel="external nofollow noreferrer" target="_blank">#14603</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed the incorrect sorting order of <code class="syntax">Nullable</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14344" rel="external nofollow noreferrer" target="_blank">#14344</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14495" rel="external nofollow noreferrer" target="_blank">#14495</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed inconsistent comparison with primary key of type <code class="syntax">FixedString</code> on index analysis if they're compered with a string of less size. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14908" rel="external nofollow noreferrer" target="_blank">#14908</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15033" rel="external nofollow noreferrer" target="_blank">#15033</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix bug which leads to wrong merges assignment if table has partitions with a single part. <a href="https://github.com/ClickHouse/ClickHouse/pull/14444" rel="external nofollow noreferrer" target="_blank">#14444</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>If function <code class="syntax">bar</code> was called with specifically crafted arguments, buffer overflow was possible. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13926" rel="external nofollow noreferrer" target="_blank">#13926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15028" rel="external nofollow noreferrer" target="_blank">#15028</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Publish CPU frequencies per logical core in <code class="syntax">system.asynchronous_metrics</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14923" rel="external nofollow noreferrer" target="_blank">#14923</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14924" rel="external nofollow noreferrer" target="_blank">#14924</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fixed <code class="syntax">.metadata.tmp File exists</code> error when using <code class="syntax">MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14898" rel="external nofollow noreferrer" target="_blank">#14898</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix the issue when some invocations of <code class="syntax">extractAllGroups</code> function may trigger "Memory limit exceeded" error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13383" rel="external nofollow noreferrer" target="_blank">#13383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14889" rel="external nofollow noreferrer" target="_blank">#14889</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix SIGSEGV for an attempt to INSERT into StorageFile(fd). <a href="https://github.com/ClickHouse/ClickHouse/pull/14887" rel="external nofollow noreferrer" target="_blank">#14887</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix rare error in <code class="syntax">SELECT</code> queries when the queried column has <code class="syntax">DEFAULT</code> expression which depends on the other column which also has <code class="syntax">DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" rel="external nofollow noreferrer" target="_blank">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" rel="external nofollow noreferrer" target="_blank">#14845</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix wrong monotonicity detection for shrunk <code class="syntax">Int -&gt; Int</code> cast of signed types. It might lead to incorrect query result. This bug is unveiled in <a href="https://github.com/ClickHouse/ClickHouse/issues/14513" rel="external nofollow noreferrer" target="_blank">#14513</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14783" rel="external nofollow noreferrer" target="_blank">#14783</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed missed default database name in metadata of materialized view when executing <code class="syntax">ALTER ... MODIFY QUERY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14664" rel="external nofollow noreferrer" target="_blank">#14664</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix possibly incorrect result of function <code class="syntax">has</code> when LowCardinality and Nullable types are involved. <a href="https://github.com/ClickHouse/ClickHouse/pull/14591" rel="external nofollow noreferrer" target="_blank">#14591</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Cleanup data directory after Zookeeper exceptions during CREATE query for tables with ReplicatedMergeTree Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14563" rel="external nofollow noreferrer" target="_blank">#14563</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix rare segfaults in functions with combinator <code class="syntax">-Resample</code>, which could appear in result of overflow with very large parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14562" rel="external nofollow noreferrer" target="_blank">#14562</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Check for array size overflow in <code class="syntax">topK</code> aggregate function. Without this check the user may send a query with carefully crafted parameters that will lead to server crash. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14452" rel="external nofollow noreferrer" target="_blank">#14452</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14467" rel="external nofollow noreferrer" target="_blank">#14467</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Proxy restart/start/stop/reload of SysVinit to systemd (if it is used). <a href="https://github.com/ClickHouse/ClickHouse/pull/14460" rel="external nofollow noreferrer" target="_blank">#14460</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Stop query execution if exception happened in <code class="syntax">PipelineExecutor</code> itself. This could prevent rare possible query hung. <a href="https://github.com/ClickHouse/ClickHouse/pull/14334" rel="external nofollow noreferrer" target="_blank">#14334</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/14402" rel="external nofollow noreferrer" target="_blank">#14402</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix crash during <code class="syntax">ALTER</code> query for table which was created <code class="syntax">AS table_function</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14212" rel="external nofollow noreferrer" target="_blank">#14212</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14326" rel="external nofollow noreferrer" target="_blank">#14326</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix exception during ALTER LIVE VIEW query with REFRESH command. LIVE VIEW is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14320" rel="external nofollow noreferrer" target="_blank">#14320</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix QueryPlan lifetime (for EXPLAIN PIPELINE graph=1) for queries with nested interpreter. <a href="https://github.com/ClickHouse/ClickHouse/pull/14315" rel="external nofollow noreferrer" target="_blank">#14315</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Better check for tuple size in SSD cache complex key external dictionaries. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13981" rel="external nofollow noreferrer" target="_blank">#13981</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14313" rel="external nofollow noreferrer" target="_blank">#14313</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Disallows <code class="syntax">CODEC</code> on <code class="syntax">ALIAS</code> column type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13911" rel="external nofollow noreferrer" target="_blank">#13911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14263" rel="external nofollow noreferrer" target="_blank">#14263</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix GRANT ALL statement when executed on a non-global level. <a href="https://github.com/ClickHouse/ClickHouse/pull/13987" rel="external nofollow noreferrer" target="_blank">#13987</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix arrayJoin() capturing in lambda (exception with logical error message was thrown). <a href="https://github.com/ClickHouse/ClickHouse/pull/13792" rel="external nofollow noreferrer" target="_blank">#13792</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h4 id="experimental-feature_2">Experimental Feature<a class="headerlink" href="#experimental-feature_2" title="Permanent link"> </a></h4>
<ul>
<li>Added <code class="syntax">db-generator</code> tool for random database generation by given SELECT queries. It may faciliate reproducing issues when there is only incomplete bug report from the user. <a href="https://github.com/ClickHouse/ClickHouse/pull/14442" rel="external nofollow noreferrer" target="_blank">#14442</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>) <a href="https://github.com/ClickHouse/ClickHouse/issues/10973" rel="external nofollow noreferrer" target="_blank">#10973</a> (<a href="https://github.com/ZeDRoman" rel="external nofollow noreferrer" target="_blank">ZeDRoman</a>).</li>
</ul>
<h4 id="improvement_8">Improvement<a class="headerlink" href="#improvement_8" title="Permanent link"> </a></h4>
<ul>
<li>Allow using multi-volume storage configuration in storage Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/14839" rel="external nofollow noreferrer" target="_blank">#14839</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Disallow empty time_zone argument in <code class="syntax">toStartOf*</code> type of functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/14509" rel="external nofollow noreferrer" target="_blank">#14509</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>MySQL handler returns <code class="syntax">OK</code> for queries like <code class="syntax">SET @@var = value</code>. Such statement is ignored. It is needed because some MySQL drivers send <code class="syntax">SET @@</code> query for setup after handshake <a href="https://github.com/ClickHouse/ClickHouse/issues/9336#issuecomment-686222422" target="_blank">https://github.com/ClickHouse/ClickHouse/issues/9336#issuecomment-686222422</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/14469" rel="external nofollow noreferrer" target="_blank">#14469</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
<li>Now TTLs will be applied during merge if they were not previously materialized. <a href="https://github.com/ClickHouse/ClickHouse/pull/14438" rel="external nofollow noreferrer" target="_blank">#14438</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Now <code class="syntax">clickhouse-obfuscator</code> supports UUID type as proposed in <a href="https://github.com/ClickHouse/ClickHouse/issues/13163" rel="external nofollow noreferrer" target="_blank">#13163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14409" rel="external nofollow noreferrer" target="_blank">#14409</a> (<a href="https://github.com/dimarub2000" rel="external nofollow noreferrer" target="_blank">dimarub2000</a>).</li>
<li>Added new setting <code class="syntax">system_events_show_zero_values</code> as proposed in <a href="https://github.com/ClickHouse/ClickHouse/issues/11384" rel="external nofollow noreferrer" target="_blank">#11384</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14404" rel="external nofollow noreferrer" target="_blank">#14404</a> (<a href="https://github.com/dimarub2000" rel="external nofollow noreferrer" target="_blank">dimarub2000</a>).</li>
<li>Implicitly convert primary key to not null in <code class="syntax">MaterializeMySQL</code> (Same as <code class="syntax">MySQL</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14114" rel="external nofollow noreferrer" target="_blank">#14114</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14397" rel="external nofollow noreferrer" target="_blank">#14397</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Replace wide integers (256 bit) from boost multiprecision with implementation from <a href="https://github.com/cerevra/int" target="_blank">https://github.com/cerevra/int</a>. 256bit integers are experimental. <a href="https://github.com/ClickHouse/ClickHouse/pull/14229" rel="external nofollow noreferrer" target="_blank">#14229</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Add default compression codec for parts in <code class="syntax">system.part_log</code> with the name <code class="syntax">default_compression_codec</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14116" rel="external nofollow noreferrer" target="_blank">#14116</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add precision argument for <code class="syntax">DateTime</code> type. It allows to use <code class="syntax">DateTime</code> name instead of <code class="syntax">DateTime64</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13761" rel="external nofollow noreferrer" target="_blank">#13761</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Added requirepass authorization for <code class="syntax">Redis</code> external dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/13688" rel="external nofollow noreferrer" target="_blank">#13688</a> (<a href="https://github.com/it1804" rel="external nofollow noreferrer" target="_blank">Ivan Torgashov</a>).</li>
<li>Improvements in <code class="syntax">RabbitMQ</code> engine: added connection and channels failure handling, proper commits, insert failures handling, better exchanges, queue durability and queue resume opportunity, new queue settings. Fixed tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12761" rel="external nofollow noreferrer" target="_blank">#12761</a> (<a href="https://github.com/kssenii" rel="external nofollow noreferrer" target="_blank">Kseniia Sumarokova</a>).</li>
<li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" rel="external nofollow noreferrer" target="_blank">#12183</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="performance-improvement_4">Performance Improvement<a class="headerlink" href="#performance-improvement_4" title="Permanent link"> </a></h4>
<ul>
<li>Optimize queries with LIMIT/LIMIT BY/ORDER BY for distributed with GROUP BY sharding_key (under <code class="syntax">optimize_skip_unused_shards</code> and <code class="syntax">optimize_distributed_group_by_sharding_key</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10373" rel="external nofollow noreferrer" target="_blank">#10373</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Creating sets for multiple <code class="syntax">JOIN</code> and <code class="syntax">IN</code> in parallel. It may slightly improve performance for queries with several different <code class="syntax">IN subquery</code> expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/14412" rel="external nofollow noreferrer" target="_blank">#14412</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Improve Kafka engine performance by providing independent thread for each consumer. Separate thread pool for streaming engines (like Kafka). <a href="https://github.com/ClickHouse/ClickHouse/pull/13939" rel="external nofollow noreferrer" target="_blank">#13939</a> (<a href="https://github.com/fastio" rel="external nofollow noreferrer" target="_blank">fastio</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_6">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_6" title="Permanent link"> </a></h4>
<ul>
<li>Lower binary size in debug build by removing debug info from <code class="syntax">Functions</code>. This is needed only for one internal project in Yandex who is using very old linker. <a href="https://github.com/ClickHouse/ClickHouse/pull/14549" rel="external nofollow noreferrer" target="_blank">#14549</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Prepare for build with clang 11. <a href="https://github.com/ClickHouse/ClickHouse/pull/14455" rel="external nofollow noreferrer" target="_blank">#14455</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix the logic in backport script. In previous versions it was triggered for any labels of 100% red color. It was strange. <a href="https://github.com/ClickHouse/ClickHouse/pull/14433" rel="external nofollow noreferrer" target="_blank">#14433</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Integration tests use default base config. All config changes are explicit with main_configs, user_configs and dictionaries parameters for instance. <a href="https://github.com/ClickHouse/ClickHouse/pull/13647" rel="external nofollow noreferrer" target="_blank">#13647</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
</ul>
<h2 id="clickhouse-release-20-8">ClickHouse release 20.8<a class="headerlink" href="#clickhouse-release-20-8" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-8-12-2-lts-2021-01-16">ClickHouse release v20.8.12.2-lts, 2021-01-16<a class="headerlink" href="#clickhouse-release-v20-8-12-2-lts-2021-01-16" title="Permanent link"> </a></h3>
<h4 id="bug-fix_16">Bug Fix<a class="headerlink" href="#bug-fix_16" title="Permanent link"> </a></h4>
<ul>
<li>Fix *If combinator with unary function and Nullable types. <a href="https://github.com/ClickHouse/ClickHouse/pull/18806" rel="external nofollow noreferrer" target="_blank">#18806</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" rel="external nofollow noreferrer" target="_blank">#18381</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-11-17-lts-2020-12-25">ClickHouse release v20.8.11.17-lts, 2020-12-25<a class="headerlink" href="#clickhouse-release-v20-8-11-17-lts-2020-12-25" title="Permanent link"> </a></h3>
<h4 id="bug-fix_17">Bug Fix<a class="headerlink" href="#bug-fix_17" title="Permanent link"> </a></h4>
<ul>
<li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" rel="external nofollow noreferrer" target="_blank">#18481</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">value is too short</code> error when executing <code class="syntax">toType(...)</code> functions (<code class="syntax">toDate</code>, <code class="syntax">toUInt32</code>, etc) with argument of type <code class="syntax">Nullable(String)</code>. Now such functions return <code class="syntax">NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" rel="external nofollow noreferrer" target="_blank">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" rel="external nofollow noreferrer" target="_blank">#18445</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix possible crashes in aggregate functions with combinator <code class="syntax">Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" rel="external nofollow noreferrer" target="_blank">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" rel="external nofollow noreferrer" target="_blank">#18365</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-10-13-lts-2020-12-24">ClickHouse release v20.8.10.13-lts, 2020-12-24<a class="headerlink" href="#clickhouse-release-v20-8-10-13-lts-2020-12-24" title="Permanent link"> </a></h3>
<h4 id="bug-fix_18">Bug Fix<a class="headerlink" href="#bug-fix_18" title="Permanent link"> </a></h4>
<ul>
<li>When server log rotation was configured using <code class="syntax">logger.size</code> parameter with numeric value larger than 2^32, the logs were not rotated properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17905" rel="external nofollow noreferrer" target="_blank">#17905</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fixed incorrect initialization of <code class="syntax">max_compress_block_size</code> in MergeTreeWriterSettings with <code class="syntax">min_compress_block_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17833" rel="external nofollow noreferrer" target="_blank">#17833</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" rel="external nofollow noreferrer" target="_blank">#17681</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fixed <code class="syntax">ALTER</code> query hang when the corresponding mutation was killed on the different replica. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" rel="external nofollow noreferrer" target="_blank">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" rel="external nofollow noreferrer" target="_blank">#17499</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed a bug when mark cache size was underestimated by ClickHouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" rel="external nofollow noreferrer" target="_blank">#17496</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">ORDER BY</code> with enabled setting <code class="syntax">optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" rel="external nofollow noreferrer" target="_blank">#17471</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed <code class="syntax">ColumnConst</code> comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" rel="external nofollow noreferrer" target="_blank">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" rel="external nofollow noreferrer" target="_blank">#17135</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed bug when <code class="syntax">ON CLUSTER</code> queries may hang forever for non-leader ReplicatedMergeTreeTables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" rel="external nofollow noreferrer" target="_blank">#17089</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" rel="external nofollow noreferrer" target="_blank">#17006</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Reresolve the IP of the <code class="syntax">format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" rel="external nofollow noreferrer" target="_blank">#16985</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed possible server crash after <code class="syntax">ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code class="syntax">SELECT</code> have <code class="syntax">WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" rel="external nofollow noreferrer" target="_blank">#16968</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" rel="external nofollow noreferrer" target="_blank">#16936</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed possible error <code class="syntax">Illegal type of argument</code> for queries with <code class="syntax">ORDER BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" rel="external nofollow noreferrer" target="_blank">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" rel="external nofollow noreferrer" target="_blank">#16928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Abort multipart upload if no data was written to WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" rel="external nofollow noreferrer" target="_blank">#16840</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fixed crash when using <code class="syntax">any</code> without any arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" rel="external nofollow noreferrer" target="_blank">#16803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" rel="external nofollow noreferrer" target="_blank">#16826</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed <code class="syntax">IN</code> operator over several columns and tuples with enabled <code class="syntax">transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" rel="external nofollow noreferrer" target="_blank">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" rel="external nofollow noreferrer" target="_blank">#16722</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed inconsistent behaviour of <code class="syntax">optimize_read_in_order/optimize_aggregation_in_order</code> with max_threads &gt; 0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" rel="external nofollow noreferrer" target="_blank">#16637</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the issue when query optimization was producing wrong result if query contains <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" rel="external nofollow noreferrer" target="_blank">#17887</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Query is finished faster in case of exception. Cancel execution on remote replicas if exception happens. <a href="https://github.com/ClickHouse/ClickHouse/pull/15578" rel="external nofollow noreferrer" target="_blank">#15578</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-6-6-lts-2020-11-13">ClickHouse release v20.8.6.6-lts, 2020-11-13<a class="headerlink" href="#clickhouse-release-v20-8-6-6-lts-2020-11-13" title="Permanent link"> </a></h3>
<h4 id="bug-fix_19">Bug Fix<a class="headerlink" href="#bug-fix_19" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" rel="external nofollow noreferrer" target="_blank">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" rel="external nofollow noreferrer" target="_blank">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" rel="external nofollow noreferrer" target="_blank">#16846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now when parsing AVRO from input the LowCardinality is removed from type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16188" rel="external nofollow noreferrer" target="_blank">#16188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" rel="external nofollow noreferrer" target="_blank">#16521</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Fix rapid growth of metadata when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine, and <code class="syntax">slave_parallel_worker</code> enabled on MySQL Slave, by properly shrinking GTID sets. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15951" rel="external nofollow noreferrer" target="_blank">#15951</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" rel="external nofollow noreferrer" target="_blank">#16504</a> (<a href="https://github.com/TCeason" rel="external nofollow noreferrer" target="_blank">TCeason</a>).</li>
<li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" rel="external nofollow noreferrer" target="_blank">#16409</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" rel="external nofollow noreferrer" target="_blank">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" rel="external nofollow noreferrer" target="_blank">#16332</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the inconsistent behaviour when a part of return data could be dropped because the set for its filtration wasn't created. <a href="https://github.com/ClickHouse/ClickHouse/pull/16308" rel="external nofollow noreferrer" target="_blank">#16308</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it's unnecessary. For example, query <code class="syntax">SELECT ... FROM system.parts</code> should work only with MergeTree tables and don't touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" rel="external nofollow noreferrer" target="_blank">#16032</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-5-45-lts-2020-10-29">ClickHouse release v20.8.5.45-lts, 2020-10-29<a class="headerlink" href="#clickhouse-release-v20-8-5-45-lts-2020-10-29" title="Permanent link"> </a></h3>
<h4 id="bug-fix_20">Bug Fix<a class="headerlink" href="#bug-fix_20" title="Permanent link"> </a></h4>
<ul>
<li>Fix double free in case of exception in function <code class="syntax">dictGet</code>. It could have happened if dictionary was loaded with error. <a href="https://github.com/ClickHouse/ClickHouse/pull/16429" rel="external nofollow noreferrer" target="_blank">#16429</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix group by with totals/rollup/cube modifers and min/max functions over group by keys. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16393" rel="external nofollow noreferrer" target="_blank">#16393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16397" rel="external nofollow noreferrer" target="_blank">#16397</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix async Distributed INSERT w/ prefer_localhost_replica=0 and internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/16358" rel="external nofollow noreferrer" target="_blank">#16358</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix a possible memory leak during <code class="syntax">GROUP BY</code> with string keys, caused by an error in <code class="syntax">TwoLevelStringHashTable</code> implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16264" rel="external nofollow noreferrer" target="_blank">#16264</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix the case when memory can be overallocated regardless to the limit. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14560" rel="external nofollow noreferrer" target="_blank">#14560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16206" rel="external nofollow noreferrer" target="_blank">#16206</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">ALTER MODIFY ... ORDER BY</code> query hang for <code class="syntax">ReplicatedVersionedCollapsingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15980" rel="external nofollow noreferrer" target="_blank">#15980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16011" rel="external nofollow noreferrer" target="_blank">#16011</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix collate name &amp; charset name parser and support <code class="syntax">length = 0</code> for string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/16008" rel="external nofollow noreferrer" target="_blank">#16008</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Allow to use direct layout for dictionaries with complex keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/16007" rel="external nofollow noreferrer" target="_blank">#16007</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Prevent replica hang for 5-10 mins when replication error happens after a period of inactivity. <a href="https://github.com/ClickHouse/ClickHouse/pull/15987" rel="external nofollow noreferrer" target="_blank">#15987</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix rare segfaults when inserting into or selecting from MaterializedView and concurrently dropping target table (for Atomic database engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/15984" rel="external nofollow noreferrer" target="_blank">#15984</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix ambiguity in parsing of settings profiles: <code class="syntax">CREATE USER ... SETTINGS profile readonly</code> is now considered as using a profile named <code class="syntax">readonly</code>, not a setting named <code class="syntax">profile</code> with the readonly constraint. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15628" rel="external nofollow noreferrer" target="_blank">#15628</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15982" rel="external nofollow noreferrer" target="_blank">#15982</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix a crash when database creation fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/15954" rel="external nofollow noreferrer" target="_blank">#15954</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">DROP TABLE IF EXISTS</code> failure with <code class="syntax">Table ... does not exist</code> error when table is concurrently renamed (for Atomic database engine). Fixed rare deadlock when concurrently executing some DDL queries with multiple tables (like <code class="syntax">DROP DATABASE</code> and <code class="syntax">RENAME TABLE</code>) Fixed <code class="syntax">DROP/DETACH DATABASE</code> failure with <code class="syntax">Table ... does not exist</code> when concurrently executing <code class="syntax">DROP/DETACH TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15934" rel="external nofollow noreferrer" target="_blank">#15934</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix incorrect empty result for query from <code class="syntax">Distributed</code> table if query has <code class="syntax">WHERE</code>, <code class="syntax">PREWHERE</code> and <code class="syntax">GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" rel="external nofollow noreferrer" target="_blank">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" rel="external nofollow noreferrer" target="_blank">#15933</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible deadlocks in RBAC. <a href="https://github.com/ClickHouse/ClickHouse/pull/15875" rel="external nofollow noreferrer" target="_blank">#15875</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix exception <code class="syntax">Block structure mismatch</code> in <code class="syntax">SELECT ... ORDER BY DESC</code> queries which were executed after <code class="syntax">ALTER MODIFY COLUMN</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15800" rel="external nofollow noreferrer" target="_blank">#15800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15852" rel="external nofollow noreferrer" target="_blank">#15852</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix some cases of queries, in which only virtual columns are selected. Previously <code class="syntax">Not found column _nothing in block</code> exception may be thrown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12298" rel="external nofollow noreferrer" target="_blank">#12298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15756" rel="external nofollow noreferrer" target="_blank">#15756</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix error <code class="syntax">Cannot find column</code> which may happen at insertion into <code class="syntax">MATERIALIZED VIEW</code> in case if query for <code class="syntax">MV</code> containes <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15717" rel="external nofollow noreferrer" target="_blank">#15717</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed too low default value of <code class="syntax">max_replicated_logs_to_keep</code> setting, which might cause replicas to become lost too often. Improve lost replica recovery process by choosing the most up-to-date replica to clone. Also do not remove old parts from lost replica, detach them instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/15701" rel="external nofollow noreferrer" target="_blank">#15701</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix error <code class="syntax">Cannot add simple transform to empty Pipe</code> which happened while reading from <code class="syntax">Buffer</code> table which has different structure than destination table. It was possible if destination table returned empty result for query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15529" rel="external nofollow noreferrer" target="_blank">#15529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15662" rel="external nofollow noreferrer" target="_blank">#15662</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed bug with globs in S3 table function, region from URL was not applied to S3 client configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/15646" rel="external nofollow noreferrer" target="_blank">#15646</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Decrement the <code class="syntax">ReadonlyReplica</code> metric when detaching read-only tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15598" rel="external nofollow noreferrer" target="_blank">#15598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15592" rel="external nofollow noreferrer" target="_blank">#15592</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Throw an error when a single parameter is passed to ReplicatedMergeTree instead of ignoring it. <a href="https://github.com/ClickHouse/ClickHouse/pull/15516" rel="external nofollow noreferrer" target="_blank">#15516</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
</ul>
<h4 id="improvement_9">Improvement<a class="headerlink" href="#improvement_9" title="Permanent link"> </a></h4>
<ul>
<li>Now it's allowed to execute <code class="syntax">ALTER ... ON CLUSTER</code> queries regardless of the <code class="syntax">&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" rel="external nofollow noreferrer" target="_blank">#16075</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Unfold <code class="syntax">{database}</code>, <code class="syntax">{table}</code> and <code class="syntax">{uuid}</code> macros in <code class="syntax">ReplicatedMergeTree</code> arguments on table creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16159" rel="external nofollow noreferrer" target="_blank">#16159</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-4-11-lts-2020-10-09">ClickHouse release v20.8.4.11-lts, 2020-10-09<a class="headerlink" href="#clickhouse-release-v20-8-4-11-lts-2020-10-09" title="Permanent link"> </a></h3>
<h4 id="bug-fix_21">Bug Fix<a class="headerlink" href="#bug-fix_21" title="Permanent link"> </a></h4>
<ul>
<li>Fix the order of destruction for resources in <code class="syntax">ReadFromStorage</code> step of query plan. It might cause crashes in rare cases. Possibly connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/15610" rel="external nofollow noreferrer" target="_blank">#15610</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15645" rel="external nofollow noreferrer" target="_blank">#15645</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed <code class="syntax">Element ... is not a constant expression</code> error when using <code class="syntax">JSON*</code> function result in <code class="syntax">VALUES</code>, <code class="syntax">LIMIT</code> or right side of <code class="syntax">IN</code> operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15589" rel="external nofollow noreferrer" target="_blank">#15589</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Prevent the possibility of error message <code class="syntax">Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15541" rel="external nofollow noreferrer" target="_blank">#15541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15557" rel="external nofollow noreferrer" target="_blank">#15557</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Significantly reduce memory usage in AggregatingInOrderTransform/optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/15543" rel="external nofollow noreferrer" target="_blank">#15543</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Mutation might hang waiting for some non-existent part after <code class="syntax">MOVE</code> or <code class="syntax">REPLACE PARTITION</code> or, in rare cases, after <code class="syntax">DETACH</code> or <code class="syntax">DROP PARTITION</code>. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" rel="external nofollow noreferrer" target="_blank">#15537</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix bug when <code class="syntax">ILIKE</code> operator stops being case insensitive if <code class="syntax">LIKE</code> with the same pattern was executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15536" rel="external nofollow noreferrer" target="_blank">#15536</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix <code class="syntax">Missing columns</code> errors when selecting columns which absent in data, but depend on other columns which also absent in data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15530" rel="external nofollow noreferrer" target="_blank">#15530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15532" rel="external nofollow noreferrer" target="_blank">#15532</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix bug with event subscription in DDLWorker which rarely may lead to query hangs in <code class="syntax">ON CLUSTER</code>. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/13450" rel="external nofollow noreferrer" target="_blank">#13450</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15477" rel="external nofollow noreferrer" target="_blank">#15477</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Report proper error when the second argument of <code class="syntax">boundingRatio</code> aggregate function has a wrong type. <a href="https://github.com/ClickHouse/ClickHouse/pull/15407" rel="external nofollow noreferrer" target="_blank">#15407</a> (<a href="https://github.com/detailyang" rel="external nofollow noreferrer" target="_blank">detailyang</a>).</li>
<li>Fix race condition during MergeTree table rename and background cleanup. <a href="https://github.com/ClickHouse/ClickHouse/pull/15304" rel="external nofollow noreferrer" target="_blank">#15304</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix rare race condition on server startup when system.logs are enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/15300" rel="external nofollow noreferrer" target="_blank">#15300</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix MSan report in QueryLog. Uninitialized memory can be used for the field <code class="syntax">memory_usage</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15258" rel="external nofollow noreferrer" target="_blank">#15258</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix instance crash when using joinGet with LowCardinality types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15214" rel="external nofollow noreferrer" target="_blank">#15214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15220" rel="external nofollow noreferrer" target="_blank">#15220</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix bug in table engine <code class="syntax">Buffer</code> which does not allow to insert data of new structure into <code class="syntax">Buffer</code> after <code class="syntax">ALTER</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15117" rel="external nofollow noreferrer" target="_blank">#15117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15192" rel="external nofollow noreferrer" target="_blank">#15192</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Adjust decimals field size in mysql column definition packet. <a href="https://github.com/ClickHouse/ClickHouse/pull/15152" rel="external nofollow noreferrer" target="_blank">#15152</a> (<a href="https://github.com/maqroll" rel="external nofollow noreferrer" target="_blank">maqroll</a>).</li>
<li>We already use padded comparison between String and FixedString (<a href="https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333" target="_blank">https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333</a>). This PR applies the same logic to field comparison which corrects the usage of FixedString as primary keys. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14908" rel="external nofollow noreferrer" target="_blank">#14908</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15033" rel="external nofollow noreferrer" target="_blank">#15033</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>If function <code class="syntax">bar</code> was called with specifically crafted arguments, buffer overflow was possible. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13926" rel="external nofollow noreferrer" target="_blank">#13926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15028" rel="external nofollow noreferrer" target="_blank">#15028</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">Cannot rename ... errno: 22, strerror: Invalid argument</code> error on DDL query execution in Atomic database when running clickhouse-server in docker on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/15024" rel="external nofollow noreferrer" target="_blank">#15024</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now settings <code class="syntax">number_of_free_entries_in_pool_to_execute_mutation</code> and <code class="syntax">number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> can be equal to <code class="syntax">background_pool_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14975" rel="external nofollow noreferrer" target="_blank">#14975</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix to make predicate push down work when subquery contains finalizeAggregation function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" rel="external nofollow noreferrer" target="_blank">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" rel="external nofollow noreferrer" target="_blank">#14937</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Publish CPU frequencies per logical core in <code class="syntax">system.asynchronous_metrics</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14923" rel="external nofollow noreferrer" target="_blank">#14923</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14924" rel="external nofollow noreferrer" target="_blank">#14924</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fixed <code class="syntax">.metadata.tmp File exists</code> error when using <code class="syntax">MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14898" rel="external nofollow noreferrer" target="_blank">#14898</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code class="syntax">from_zk</code> include option). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14814" rel="external nofollow noreferrer" target="_blank">#14814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14843" rel="external nofollow noreferrer" target="_blank">#14843</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fix wrong monotonicity detection for shrunk <code class="syntax">Int -&gt; Int</code> cast of signed types. It might lead to incorrect query result. This bug is unveiled in <a href="https://github.com/ClickHouse/ClickHouse/issues/14513" rel="external nofollow noreferrer" target="_blank">#14513</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14783" rel="external nofollow noreferrer" target="_blank">#14783</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fixed the incorrect sorting order of <code class="syntax">Nullable</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14344" rel="external nofollow noreferrer" target="_blank">#14344</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14495" rel="external nofollow noreferrer" target="_blank">#14495</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
</ul>
<h4 id="improvement_10">Improvement<a class="headerlink" href="#improvement_10" title="Permanent link"> </a></h4>
<ul>
<li>Now it's possible to change the type of version column for <code class="syntax">VersionedCollapsingMergeTree</code> with <code class="syntax">ALTER</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15442" rel="external nofollow noreferrer" target="_blank">#15442</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-3-18-stable-2020-09-18">ClickHouse release v20.8.3.18-stable, 2020-09-18<a class="headerlink" href="#clickhouse-release-v20-8-3-18-stable-2020-09-18" title="Permanent link"> </a></h3>
<h4 id="bug-fix_22">Bug Fix<a class="headerlink" href="#bug-fix_22" title="Permanent link"> </a></h4>
<ul>
<li>Fix the issue when some invocations of <code class="syntax">extractAllGroups</code> function may trigger "Memory limit exceeded" error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13383" rel="external nofollow noreferrer" target="_blank">#13383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14889" rel="external nofollow noreferrer" target="_blank">#14889</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix SIGSEGV for an attempt to INSERT into StorageFile(fd). <a href="https://github.com/ClickHouse/ClickHouse/pull/14887" rel="external nofollow noreferrer" target="_blank">#14887</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix rare error in <code class="syntax">SELECT</code> queries when the queried column has <code class="syntax">DEFAULT</code> expression which depends on the other column which also has <code class="syntax">DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" rel="external nofollow noreferrer" target="_blank">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" rel="external nofollow noreferrer" target="_blank">#14845</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed missed default database name in metadata of materialized view when executing <code class="syntax">ALTER ... MODIFY QUERY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14664" rel="external nofollow noreferrer" target="_blank">#14664</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix bug when <code class="syntax">ALTER UPDATE</code> mutation with Nullable column in assignment expression and constant value (like <code class="syntax">UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" rel="external nofollow noreferrer" target="_blank">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" rel="external nofollow noreferrer" target="_blank">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" rel="external nofollow noreferrer" target="_blank">#14646</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" rel="external nofollow noreferrer" target="_blank">#14603</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Added the checker as neither calling <code class="syntax">lc-&gt;isNullable()</code> nor calling <code class="syntax">ls-&gt;getDictionaryPtr()-&gt;isNullable()</code> would return the correct result. <a href="https://github.com/ClickHouse/ClickHouse/pull/14591" rel="external nofollow noreferrer" target="_blank">#14591</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">myrrc</a>).</li>
<li>Cleanup data directory after Zookeeper exceptions during CreateQuery for StorageReplicatedMergeTree Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14563" rel="external nofollow noreferrer" target="_blank">#14563</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix rare segfaults in functions with combinator -Resample, which could appear in result of overflow with very large parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14562" rel="external nofollow noreferrer" target="_blank">#14562</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="improvement_11">Improvement<a class="headerlink" href="#improvement_11" title="Permanent link"> </a></h4>
<ul>
<li>Speed up server shutdown process if there are ongoing S3 requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14858" rel="external nofollow noreferrer" target="_blank">#14858</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Allow using multi-volume storage configuration in storage Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/14839" rel="external nofollow noreferrer" target="_blank">#14839</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Speed up server shutdown process if there are ongoing S3 requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14496" rel="external nofollow noreferrer" target="_blank">#14496</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" rel="external nofollow noreferrer" target="_blank">#12183</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-8-2-3-stable-2020-09-08">ClickHouse release v20.8.2.3-stable, 2020-09-08<a class="headerlink" href="#clickhouse-release-v20-8-2-3-stable-2020-09-08" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_4">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_4" title="Permanent link"> </a></h4>
<ul>
<li>Now <code class="syntax">OPTIMIZE FINAL</code> query does not recalculate TTL for parts that were added before TTL was created. Use <code class="syntax">ALTER TABLE ... MATERIALIZE TTL</code> once to calculate them, after that <code class="syntax">OPTIMIZE FINAL</code> will evaluate TTL's properly. This behavior never worked for replicated tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14220" rel="external nofollow noreferrer" target="_blank">#14220</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Extend <code class="syntax">parallel_distributed_insert_select</code> setting, adding an option to run <code class="syntax">INSERT</code> into local table. The setting changes type from <code class="syntax">Bool</code> to <code class="syntax">UInt64</code>, so the values <code class="syntax">false</code> and <code class="syntax">true</code> are no longer supported. If you have these values in server configuration, the server will not start. Please replace them with <code class="syntax">0</code> and <code class="syntax">1</code>, respectively. <a href="https://github.com/ClickHouse/ClickHouse/pull/14060" rel="external nofollow noreferrer" target="_blank">#14060</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Remove support for the <code class="syntax">ODBCDriver</code> input/output format. This was a deprecated format once used for communication with the ClickHouse ODBC driver, now long superseded by the <code class="syntax">ODBCDriver2</code> format. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/13629" rel="external nofollow noreferrer" target="_blank">#13629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13847" rel="external nofollow noreferrer" target="_blank">#13847</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_4">New Feature<a class="headerlink" href="#new-feature_4" title="Permanent link"> </a></h4>
<ul>
<li>Add the ability to specify <code class="syntax">Default</code> compression codec for columns that correspond to settings specified in <code class="syntax">config.xml</code>. Implements: <a href="https://github.com/ClickHouse/ClickHouse/issues/9074" rel="external nofollow noreferrer" target="_blank">#9074</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14049" rel="external nofollow noreferrer" target="_blank">#14049</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Support Kerberos authentication in Kafka, using <code class="syntax">krb5</code> and <code class="syntax">cyrus-sasl</code> libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/12771" rel="external nofollow noreferrer" target="_blank">#12771</a> (<a href="https://github.com/ilejn" rel="external nofollow noreferrer" target="_blank">Ilya Golshtein</a>).</li>
<li>Add function <code class="syntax">normalizeQuery</code> that replaces literals, sequences of literals and complex aliases with placeholders. Add function <code class="syntax">normalizedQueryHash</code> that returns identical 64bit hash values for similar queries. It helps to analyze query log. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11271" rel="external nofollow noreferrer" target="_blank">#11271</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13816" rel="external nofollow noreferrer" target="_blank">#13816</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add <code class="syntax">time_zones</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13880" rel="external nofollow noreferrer" target="_blank">#13880</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Add function <code class="syntax">defaultValueOfTypeName</code> that returns the default value for a given type. <a href="https://github.com/ClickHouse/ClickHouse/pull/13877" rel="external nofollow noreferrer" target="_blank">#13877</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Add <code class="syntax">countDigits(x)</code> function that count number of decimal digits in integer or decimal column. Add <code class="syntax">isDecimalOverflow(d, [p])</code> function that checks if the value in Decimal column is out of its (or specified) precision. <a href="https://github.com/ClickHouse/ClickHouse/pull/14151" rel="external nofollow noreferrer" target="_blank">#14151</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Add <code class="syntax">quantileExactLow</code> and <code class="syntax">quantileExactHigh</code> implementations with respective aliases for <code class="syntax">medianExactLow</code> and <code class="syntax">medianExactHigh</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13818" rel="external nofollow noreferrer" target="_blank">#13818</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Added <code class="syntax">date_trunc</code> function that truncates a date/time value to a specified date/time part. <a href="https://github.com/ClickHouse/ClickHouse/pull/13888" rel="external nofollow noreferrer" target="_blank">#13888</a> (<a href="https://github.com/vladimir-golovchenko" rel="external nofollow noreferrer" target="_blank">Vladimir Golovchenko</a>).</li>
<li>Add new optional section <code class="syntax">&lt;user_directories&gt;</code> to the main config. <a href="https://github.com/ClickHouse/ClickHouse/pull/13425" rel="external nofollow noreferrer" target="_blank">#13425</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Add <code class="syntax">ALTER SAMPLE BY</code> statement that allows to change table sample clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/13280" rel="external nofollow noreferrer" target="_blank">#13280</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Function <code class="syntax">position</code> now supports optional <code class="syntax">start_pos</code> argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/13237" rel="external nofollow noreferrer" target="_blank">#13237</a> (<a href="https://github.com/vdimir" rel="external nofollow noreferrer" target="_blank">vdimir</a>).</li>
</ul>
<h4 id="bug-fix_23">Bug Fix<a class="headerlink" href="#bug-fix_23" title="Permanent link"> </a></h4>
<ul>
<li>Fix visible data clobbering by progress bar in client in interactive mode. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12562" rel="external nofollow noreferrer" target="_blank">#12562</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13369" rel="external nofollow noreferrer" target="_blank">#13369</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13584" rel="external nofollow noreferrer" target="_blank">#13584</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12964" rel="external nofollow noreferrer" target="_blank">#12964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13691" rel="external nofollow noreferrer" target="_blank">#13691</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed incorrect sorting order if <code class="syntax">LowCardinality</code> column when sorting by multiple columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13958" rel="external nofollow noreferrer" target="_blank">#13958</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14223" rel="external nofollow noreferrer" target="_blank">#14223</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Check for array size overflow in <code class="syntax">topK</code> aggregate function. Without this check the user may send a query with carefully crafted parameters that will lead to server crash. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14452" rel="external nofollow noreferrer" target="_blank">#14452</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14467" rel="external nofollow noreferrer" target="_blank">#14467</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bug which can lead to wrong merges assignment if table has partitions with a single part. <a href="https://github.com/ClickHouse/ClickHouse/pull/14444" rel="external nofollow noreferrer" target="_blank">#14444</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Stop query execution if exception happened in <code class="syntax">PipelineExecutor</code> itself. This could prevent rare possible query hung. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/14334" rel="external nofollow noreferrer" target="_blank">#14334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14402" rel="external nofollow noreferrer" target="_blank">#14402</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/14334" rel="external nofollow noreferrer" target="_blank">#14334</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix crash during <code class="syntax">ALTER</code> query for table which was created <code class="syntax">AS table_function</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14212" rel="external nofollow noreferrer" target="_blank">#14212</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14326" rel="external nofollow noreferrer" target="_blank">#14326</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix exception during ALTER LIVE VIEW query with REFRESH command. Live view is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14320" rel="external nofollow noreferrer" target="_blank">#14320</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Fix QueryPlan lifetime (for EXPLAIN PIPELINE graph=1) for queries with nested interpreter. <a href="https://github.com/ClickHouse/ClickHouse/pull/14315" rel="external nofollow noreferrer" target="_blank">#14315</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix segfault in <code class="syntax">clickhouse-odbc-bridge</code> during schema fetch from some external sources. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13861" rel="external nofollow noreferrer" target="_blank">#13861</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14267" rel="external nofollow noreferrer" target="_blank">#14267</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix crash in mark inclusion search introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/12277" rel="external nofollow noreferrer" target="_blank">#12277</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14225" rel="external nofollow noreferrer" target="_blank">#14225</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix creation of tables with named tuples. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13027" rel="external nofollow noreferrer" target="_blank">#13027</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14143" rel="external nofollow noreferrer" target="_blank">#14143</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix formatting of minimal negative decimal numbers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14111" rel="external nofollow noreferrer" target="_blank">#14111</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14119" rel="external nofollow noreferrer" target="_blank">#14119</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fix <code class="syntax">DistributedFilesToInsert</code> metric (zeroed when it should not). <a href="https://github.com/ClickHouse/ClickHouse/pull/14095" rel="external nofollow noreferrer" target="_blank">#14095</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix <code class="syntax">pointInPolygon</code> with const 2d array as polygon. <a href="https://github.com/ClickHouse/ClickHouse/pull/14079" rel="external nofollow noreferrer" target="_blank">#14079</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>).</li>
<li>Fixed wrong mount point in extra info for <code class="syntax">Poco::Exception: no space left on device</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14050" rel="external nofollow noreferrer" target="_blank">#14050</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix GRANT ALL statement when executed on a non-global level. <a href="https://github.com/ClickHouse/ClickHouse/pull/13987" rel="external nofollow noreferrer" target="_blank">#13987</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix parser to reject create table as table function with engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/13940" rel="external nofollow noreferrer" target="_blank">#13940</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fix wrong results in select queries with <code class="syntax">DISTINCT</code> keyword and subqueries with UNION ALL in case <code class="syntax">optimize_duplicate_order_by_and_distinct</code> setting is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/13925" rel="external nofollow noreferrer" target="_blank">#13925</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed potential deadlock when renaming <code class="syntax">Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13922" rel="external nofollow noreferrer" target="_blank">#13922</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix incorrect sorting for <code class="syntax">FixedString</code> columns when sorting by multiple columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13182" rel="external nofollow noreferrer" target="_blank">#13182</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13887" rel="external nofollow noreferrer" target="_blank">#13887</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix potentially imprecise result of <code class="syntax">topK</code>/<code class="syntax">topKWeighted</code> merge (with non-default parameters). <a href="https://github.com/ClickHouse/ClickHouse/pull/13817" rel="external nofollow noreferrer" target="_blank">#13817</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix reading from MergeTree table with INDEX of type SET fails when comparing against NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13686" rel="external nofollow noreferrer" target="_blank">#13686</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13793" rel="external nofollow noreferrer" target="_blank">#13793</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix <code class="syntax">arrayJoin</code> capturing in lambda (LOGICAL_ERROR). <a href="https://github.com/ClickHouse/ClickHouse/pull/13792" rel="external nofollow noreferrer" target="_blank">#13792</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add step overflow check in function <code class="syntax">range</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13790" rel="external nofollow noreferrer" target="_blank">#13790</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">Directory not empty</code> error when concurrently executing <code class="syntax">DROP DATABASE</code> and <code class="syntax">CREATE TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13756" rel="external nofollow noreferrer" target="_blank">#13756</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add range check for <code class="syntax">h3KRing</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13633" rel="external nofollow noreferrer" target="_blank">#13633</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13752" rel="external nofollow noreferrer" target="_blank">#13752</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix race condition between DETACH and background merges. Parts may revive after detach. This is continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/8602" rel="external nofollow noreferrer" target="_blank">#8602</a> that did not fix the issue but introduced a test that started to fail in very rare cases, demonstrating the issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/13746" rel="external nofollow noreferrer" target="_blank">#13746</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix logging Settings.Names/Values when log_queries_min_type &gt; QUERY_START. <a href="https://github.com/ClickHouse/ClickHouse/pull/13737" rel="external nofollow noreferrer" target="_blank">#13737</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixes <code class="syntax">/replicas_status</code> endpoint response status code when verbose=1. <a href="https://github.com/ClickHouse/ClickHouse/pull/13722" rel="external nofollow noreferrer" target="_blank">#13722</a> (<a href="https://github.com/javisantana" rel="external nofollow noreferrer" target="_blank">javi santana</a>).</li>
<li>Fix incorrect message in <code class="syntax">clickhouse-server.init</code> while checking user and group. <a href="https://github.com/ClickHouse/ClickHouse/pull/13711" rel="external nofollow noreferrer" target="_blank">#13711</a> (<a href="https://github.com/ylchou" rel="external nofollow noreferrer" target="_blank">ylchou</a>).</li>
<li>Do not optimize any(arrayJoin()) -&gt; arrayJoin() under <code class="syntax">optimize_move_functions_out_of_any</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/13681" rel="external nofollow noreferrer" target="_blank">#13681</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix crash in JOIN with StorageMerge and <code class="syntax">set enable_optimize_predicate_expression=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13679" rel="external nofollow noreferrer" target="_blank">#13679</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix typo in error message about <code class="syntax">The value of 'number_of_free_entries_in_pool_to_lower_max_size_of_merge' setting</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13678" rel="external nofollow noreferrer" target="_blank">#13678</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Concurrent <code class="syntax">ALTER ... REPLACE/MOVE PARTITION ...</code> queries might cause deadlock. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/13626" rel="external nofollow noreferrer" target="_blank">#13626</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed the behaviour when sometimes cache-dictionary returned default value instead of present value from source. <a href="https://github.com/ClickHouse/ClickHouse/pull/13624" rel="external nofollow noreferrer" target="_blank">#13624</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix secondary indices corruption in compact parts. Compact parts are experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13538" rel="external nofollow noreferrer" target="_blank">#13538</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix premature <code class="syntax">ON CLUSTER</code> timeouts for queries that must be executed on a single replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6704" rel="external nofollow noreferrer" target="_blank">#6704</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7228" rel="external nofollow noreferrer" target="_blank">#7228</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/13361" rel="external nofollow noreferrer" target="_blank">#13361</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11884" rel="external nofollow noreferrer" target="_blank">#11884</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13450" rel="external nofollow noreferrer" target="_blank">#13450</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix wrong code in function <code class="syntax">netloc</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13335" rel="external nofollow noreferrer" target="_blank">#13335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13446" rel="external nofollow noreferrer" target="_blank">#13446</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix possible race in <code class="syntax">StorageMemory</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13416" rel="external nofollow noreferrer" target="_blank">#13416</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix missing or excessive headers in <code class="syntax">TSV/CSVWithNames</code> formats in HTTP protocol. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12504" rel="external nofollow noreferrer" target="_blank">#12504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13343" rel="external nofollow noreferrer" target="_blank">#13343</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix parsing row policies from users.xml when names of databases or tables contain dots. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" rel="external nofollow noreferrer" target="_blank">#5779</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12527" rel="external nofollow noreferrer" target="_blank">#12527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13199" rel="external nofollow noreferrer" target="_blank">#13199</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix access to <code class="syntax">redis</code> dictionary after connection was dropped once. It may happen with <code class="syntax">cache</code> and <code class="syntax">direct</code> dictionary layouts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13082" rel="external nofollow noreferrer" target="_blank">#13082</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Removed wrong auth access check when using ClickHouseDictionarySource to query remote tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12756" rel="external nofollow noreferrer" target="_blank">#12756</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Properly distinguish subqueries in some cases for common subexpression elimination. <a href="https://github.com/ClickHouse/ClickHouse/issues/8333" rel="external nofollow noreferrer" target="_blank">#8333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8367" rel="external nofollow noreferrer" target="_blank">#8367</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
</ul>
<h4 id="improvement_12">Improvement<a class="headerlink" href="#improvement_12" title="Permanent link"> </a></h4>
<ul>
<li>Disallows <code class="syntax">CODEC</code> on <code class="syntax">ALIAS</code> column type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13911" rel="external nofollow noreferrer" target="_blank">#13911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14263" rel="external nofollow noreferrer" target="_blank">#14263</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>When waiting for a dictionary update to complete, use the timeout specified by <code class="syntax">query_wait_timeout_milliseconds</code> setting instead of a hard-coded value. <a href="https://github.com/ClickHouse/ClickHouse/pull/14105" rel="external nofollow noreferrer" target="_blank">#14105</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Add setting <code class="syntax">min_index_granularity_bytes</code> that protects against accidentally creating a table with very low <code class="syntax">index_granularity_bytes</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/14139" rel="external nofollow noreferrer" target="_blank">#14139</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Now it's possible to fetch partitions from clusters that use different ZooKeeper: <code class="syntax">ALTER TABLE table_name FETCH PARTITION partition_expr FROM 'zk-name:/path-in-zookeeper'</code>. It's useful for shipping data to new clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14155" rel="external nofollow noreferrer" target="_blank">#14155</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Slightly better performance of Memory table if it was constructed from a huge number of very small blocks (that's unlikely). Author of the idea: <a href="https://github.com/markpapadakis" rel="external nofollow noreferrer" target="_blank">Mark Papadakis</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14043" rel="external nofollow noreferrer" target="_blank">#14043</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14056" rel="external nofollow noreferrer" target="_blank">#14056</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Conditional aggregate functions (for example: <code class="syntax">avgIf</code>, <code class="syntax">sumIf</code>, <code class="syntax">maxIf</code>) should return <code class="syntax">NULL</code> when miss rows and use nullable arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/13964" rel="external nofollow noreferrer" target="_blank">#13964</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Increase limit in -Resample combinator to 1M. <a href="https://github.com/ClickHouse/ClickHouse/pull/13947" rel="external nofollow noreferrer" target="_blank">#13947</a> (<a href="https://github.com/Felixoid" rel="external nofollow noreferrer" target="_blank">Mikhail f. Shiryaev</a>).</li>
<li>Corrected an error in AvroConfluent format that caused the Kafka table engine to stop processing messages when an abnormally small, malformed, message was received. <a href="https://github.com/ClickHouse/ClickHouse/pull/13941" rel="external nofollow noreferrer" target="_blank">#13941</a> (<a href="https://github.com/gervarela" rel="external nofollow noreferrer" target="_blank">Gervasio Varela</a>).</li>
<li>Fix wrong error for long queries. It was possible to get syntax error other than <code class="syntax">Max query size exceeded</code> for correct query. <a href="https://github.com/ClickHouse/ClickHouse/pull/13928" rel="external nofollow noreferrer" target="_blank">#13928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Better error message for null value of <code class="syntax">TabSeparated</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/13906" rel="external nofollow noreferrer" target="_blank">#13906</a> (<a href="https://github.com/tomjiang1987" rel="external nofollow noreferrer" target="_blank">jiang tao</a>).</li>
<li>Function <code class="syntax">arrayCompact</code> will compare NaNs bitwise if the type of array elements is Float32/Float64. In previous versions NaNs were always not equal if the type of array elements is Float32/Float64 and were always equal if the type is more complex, like Nullable(Float64). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13857" rel="external nofollow noreferrer" target="_blank">#13857</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13868" rel="external nofollow noreferrer" target="_blank">#13868</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix data race in <code class="syntax">lgamma</code> function. This race was caught only in <code class="syntax">tsan</code>, no side effects a really happened. <a href="https://github.com/ClickHouse/ClickHouse/pull/13842" rel="external nofollow noreferrer" target="_blank">#13842</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Avoid too slow queries when arrays are manipulated as fields. Throw exception instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/13753" rel="external nofollow noreferrer" target="_blank">#13753</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added Redis requirepass authorization (for redis dictionary source). <a href="https://github.com/ClickHouse/ClickHouse/pull/13688" rel="external nofollow noreferrer" target="_blank">#13688</a> (<a href="https://github.com/it1804" rel="external nofollow noreferrer" target="_blank">Ivan Torgashov</a>).</li>
<li>Add MergeTree Write-Ahead-Log (WAL) dump tool. WAL is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13640" rel="external nofollow noreferrer" target="_blank">#13640</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
<li>In previous versions <code class="syntax">lcm</code> function may produce assertion violation in debug build if called with specifically crafted arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13368" rel="external nofollow noreferrer" target="_blank">#13368</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13510" rel="external nofollow noreferrer" target="_blank">#13510</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Provide monotonicity for <code class="syntax">toDate/toDateTime</code> functions in more cases. Monotonicity information is used for index analysis (more complex queries will be able to use index). Now the input arguments are saturated more naturally and provides better monotonicity. <a href="https://github.com/ClickHouse/ClickHouse/pull/13497" rel="external nofollow noreferrer" target="_blank">#13497</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Support compound identifiers for custom settings. Custom settings is an integration point of ClickHouse codebase with other codebases (no benefits for ClickHouse itself) <a href="https://github.com/ClickHouse/ClickHouse/pull/13496" rel="external nofollow noreferrer" target="_blank">#13496</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Move parts from DiskLocal to DiskS3 in parallel. <code class="syntax">DiskS3</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13459" rel="external nofollow noreferrer" target="_blank">#13459</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Enable mixed granularity parts by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/13449" rel="external nofollow noreferrer" target="_blank">#13449</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Proper remote host checking in S3 redirects (security-related thing). <a href="https://github.com/ClickHouse/ClickHouse/pull/13404" rel="external nofollow noreferrer" target="_blank">#13404</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Add <code class="syntax">QueryTimeMicroseconds</code>, <code class="syntax">SelectQueryTimeMicroseconds</code> and <code class="syntax">InsertQueryTimeMicroseconds</code> to system.events. <a href="https://github.com/ClickHouse/ClickHouse/pull/13336" rel="external nofollow noreferrer" target="_blank">#13336</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Fix debug assertion when Decimal has too large negative exponent. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13188" rel="external nofollow noreferrer" target="_blank">#13188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13228" rel="external nofollow noreferrer" target="_blank">#13228</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added cache layer for DiskS3 (cache to local disk mark and index files). <code class="syntax">DiskS3</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13076" rel="external nofollow noreferrer" target="_blank">#13076</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fix readline so it dumps history to file now. <a href="https://github.com/ClickHouse/ClickHouse/pull/13600" rel="external nofollow noreferrer" target="_blank">#13600</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Create <code class="syntax">system</code> database with <code class="syntax">Atomic</code> engine by default (a preparation to enable <code class="syntax">Atomic</code> database engine by default everywhere). <a href="https://github.com/ClickHouse/ClickHouse/pull/13680" rel="external nofollow noreferrer" target="_blank">#13680</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
</ul>
<h4 id="performance-improvement_5">Performance Improvement<a class="headerlink" href="#performance-improvement_5" title="Permanent link"> </a></h4>
<ul>
<li>Slightly optimize very short queries with <code class="syntax">LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14129" rel="external nofollow noreferrer" target="_blank">#14129</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Enable parallel INSERTs for table engines <code class="syntax">Null</code>, <code class="syntax">Memory</code>, <code class="syntax">Distributed</code> and <code class="syntax">Buffer</code> when the setting <code class="syntax">max_insert_threads</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/14120" rel="external nofollow noreferrer" target="_blank">#14120</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fail fast if <code class="syntax">max_rows_to_read</code> limit is exceeded on parts scan. The motivation behind this change is to skip ranges scan for all selected parts if it is clear that <code class="syntax">max_rows_to_read</code> is already exceeded. The change is quite noticeable for queries over big number of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13677" rel="external nofollow noreferrer" target="_blank">#13677</a> (<a href="https://github.com/hagen1778" rel="external nofollow noreferrer" target="_blank">Roman Khavronenko</a>).</li>
<li>Slightly improve performance of aggregation by UInt8/UInt16 keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/13099" rel="external nofollow noreferrer" target="_blank">#13099</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Optimize <code class="syntax">has()</code>, <code class="syntax">indexOf()</code> and <code class="syntax">countEqual()</code> functions for <code class="syntax">Array(LowCardinality(T))</code> and constant right arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12550" rel="external nofollow noreferrer" target="_blank">#12550</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">myrrc</a>).</li>
<li>When performing trivial <code class="syntax">INSERT SELECT</code> queries, automatically set <code class="syntax">max_threads</code> to 1 or <code class="syntax">max_insert_threads</code>, and set <code class="syntax">max_block_size</code> to <code class="syntax">min_insert_block_size_rows</code>. Related to <a href="https://github.com/ClickHouse/ClickHouse/issues/5907" rel="external nofollow noreferrer" target="_blank">#5907</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12195" rel="external nofollow noreferrer" target="_blank">#12195</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
</ul>
<h4 id="experimental-feature_3">Experimental Feature<a class="headerlink" href="#experimental-feature_3" title="Permanent link"> </a></h4>
<ul>
<li>ClickHouse can work as MySQL replica - it is implemented by <code class="syntax">MaterializeMySQL</code> database engine. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/4006" rel="external nofollow noreferrer" target="_blank">#4006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10851" rel="external nofollow noreferrer" target="_blank">#10851</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Add types <code class="syntax">Int128</code>, <code class="syntax">Int256</code>, <code class="syntax">UInt256</code> and related functions for them. Extend Decimals with Decimal256 (precision up to 76 digits). New types are under the setting <code class="syntax">allow_experimental_bigint_types</code>. It is working extremely slow and bad. The implementation is incomplete. Please don't use this feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13097" rel="external nofollow noreferrer" target="_blank">#13097</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_7">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_7" title="Permanent link"> </a></h4>
<ul>
<li>Added <code class="syntax">clickhouse install</code> script, that is useful if you only have a single binary. <a href="https://github.com/ClickHouse/ClickHouse/pull/13528" rel="external nofollow noreferrer" target="_blank">#13528</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow to run <code class="syntax">clickhouse</code> binary without configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/13515" rel="external nofollow noreferrer" target="_blank">#13515</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Enable check for typos in code with <code class="syntax">codespell</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13513" rel="external nofollow noreferrer" target="_blank">#13513</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/13511" rel="external nofollow noreferrer" target="_blank">#13511</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Enable Shellcheck in CI as a linter of .sh tests. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13168" rel="external nofollow noreferrer" target="_blank">#13168</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13530" rel="external nofollow noreferrer" target="_blank">#13530</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/13529" rel="external nofollow noreferrer" target="_blank">#13529</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add a CMake option to fail configuration instead of auto-reconfiguration, enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/13687" rel="external nofollow noreferrer" target="_blank">#13687</a> (<a href="https://github.com/podshumok" rel="external nofollow noreferrer" target="_blank">Konstantin</a>).</li>
<li>Expose version of embedded tzdata via TZDATA_VERSION in system.build_options. <a href="https://github.com/ClickHouse/ClickHouse/pull/13648" rel="external nofollow noreferrer" target="_blank">#13648</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Improve generation of system.time_zones table during build. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14209" rel="external nofollow noreferrer" target="_blank">#14209</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14215" rel="external nofollow noreferrer" target="_blank">#14215</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Build ClickHouse with the most fresh tzdata from package repository. <a href="https://github.com/ClickHouse/ClickHouse/pull/13623" rel="external nofollow noreferrer" target="_blank">#13623</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add the ability to write js-style comments in skip_list.json. <a href="https://github.com/ClickHouse/ClickHouse/pull/14159" rel="external nofollow noreferrer" target="_blank">#14159</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Ensure that there is no copy-pasted GPL code. <a href="https://github.com/ClickHouse/ClickHouse/pull/13514" rel="external nofollow noreferrer" target="_blank">#13514</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Switch tests docker images to use test-base parent. <a href="https://github.com/ClickHouse/ClickHouse/pull/14167" rel="external nofollow noreferrer" target="_blank">#14167</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Adding retry logic when bringing up docker-compose cluster; Increasing COMPOSE_HTTP_TIMEOUT. <a href="https://github.com/ClickHouse/ClickHouse/pull/14112" rel="external nofollow noreferrer" target="_blank">#14112</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Enabled <code class="syntax">system.text_log</code> in stress test to find more bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/13855" rel="external nofollow noreferrer" target="_blank">#13855</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Testflows LDAP module: adding missing certificates and dhparam.pem for openldap4. <a href="https://github.com/ClickHouse/ClickHouse/pull/13780" rel="external nofollow noreferrer" target="_blank">#13780</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>ZooKeeper cannot work reliably in unit tests in CI infrastructure. Using unit tests for ZooKeeper interaction with real ZooKeeper is bad idea from the start (unit tests are not supposed to verify complex distributed systems). We already using integration tests for this purpose and they are better suited. <a href="https://github.com/ClickHouse/ClickHouse/pull/13745" rel="external nofollow noreferrer" target="_blank">#13745</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added docker image for style check. Added style check that all docker and docker compose files are located in docker directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/13724" rel="external nofollow noreferrer" target="_blank">#13724</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Fix cassandra build on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/13708" rel="external nofollow noreferrer" target="_blank">#13708</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Fix link error in shared build. <a href="https://github.com/ClickHouse/ClickHouse/pull/13700" rel="external nofollow noreferrer" target="_blank">#13700</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Updating LDAP user authentication suite to check that it works with RBAC. <a href="https://github.com/ClickHouse/ClickHouse/pull/13656" rel="external nofollow noreferrer" target="_blank">#13656</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Removed <code class="syntax">-DENABLE_CURL_CLIENT</code> for <code class="syntax">contrib/aws</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13628" rel="external nofollow noreferrer" target="_blank">#13628</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Increasing health-check timeouts for ClickHouse nodes and adding support to dump docker-compose logs if unhealthy containers found. <a href="https://github.com/ClickHouse/ClickHouse/pull/13612" rel="external nofollow noreferrer" target="_blank">#13612</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Make sure <a href="https://github.com/ClickHouse/ClickHouse/issues/10977" rel="external nofollow noreferrer" target="_blank">#10977</a> is invalid. <a href="https://github.com/ClickHouse/ClickHouse/pull/13539" rel="external nofollow noreferrer" target="_blank">#13539</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Skip PR's from robot-clickhouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/13489" rel="external nofollow noreferrer" target="_blank">#13489</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Move Dockerfiles from integration tests to <code class="syntax">docker/test</code> directory. docker_compose files are available in <code class="syntax">runner</code> docker container. Docker images are built in CI and not in integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/13448" rel="external nofollow noreferrer" target="_blank">#13448</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
</ul>
<h2 id="clickhouse-release-20-7">ClickHouse release 20.7<a class="headerlink" href="#clickhouse-release-20-7" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-7-2-30-stable-2020-08-31">ClickHouse release v20.7.2.30-stable, 2020-08-31<a class="headerlink" href="#clickhouse-release-v20-7-2-30-stable-2020-08-31" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_5">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_5" title="Permanent link"> </a></h4>
<ul>
<li>Function <code class="syntax">modulo</code> (operator <code class="syntax">%</code>) with at least one floating point number as argument will calculate remainder of division directly on floating point numbers without converting both arguments to integers. It makes behaviour compatible with most of DBMS. This also applicable for Date and DateTime data types. Added alias <code class="syntax">mod</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7323" rel="external nofollow noreferrer" target="_blank">#7323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12585" rel="external nofollow noreferrer" target="_blank">#12585</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Deprecate special printing of zero Date/DateTime values as <code class="syntax">0000-00-00</code> and <code class="syntax">0000-00-00 00:00:00</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12442" rel="external nofollow noreferrer" target="_blank">#12442</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>The function <code class="syntax">groupArrayMoving*</code> was not working for distributed queries. It's result was calculated within incorrect data type (without promotion to the largest type). The function <code class="syntax">groupArrayMovingAvg</code> was returning integer number that was inconsistent with the <code class="syntax">avg</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12568" rel="external nofollow noreferrer" target="_blank">#12568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12622" rel="external nofollow noreferrer" target="_blank">#12622</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add sanity check for MergeTree settings. If the settings are incorrect, the server will refuse to start or to create a table, printing detailed explanation to the user. <a href="https://github.com/ClickHouse/ClickHouse/pull/13153" rel="external nofollow noreferrer" target="_blank">#13153</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Protect from the cases when user may set <code class="syntax">background_pool_size</code> to value lower than <code class="syntax">number_of_free_entries_in_pool_to_execute_mutation</code> or <code class="syntax">number_of_free_entries_in_pool_to_lower_max_size_of_merge</code>. In these cases ALTERs won't work or the maximum size of merge will be too limited. It will throw exception explaining what to do. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10897" rel="external nofollow noreferrer" target="_blank">#10897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12728" rel="external nofollow noreferrer" target="_blank">#12728</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_5">New Feature<a class="headerlink" href="#new-feature_5" title="Permanent link"> </a></h4>
<ul>
<li>Polygon dictionary type that provides efficient "reverse geocoding" lookups - to find the region by coordinates in a dictionary of many polygons (world map). It is using carefully optimized algorithm with recursive grids to maintain low CPU and memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/9278" rel="external nofollow noreferrer" target="_blank">#9278</a> (<a href="https://github.com/achulkov2" rel="external nofollow noreferrer" target="_blank">achulkov2</a>).</li>
<li>Added support of LDAP authentication for preconfigured users ("Simple Bind" method). <a href="https://github.com/ClickHouse/ClickHouse/pull/11234" rel="external nofollow noreferrer" target="_blank">#11234</a> (<a href="https://github.com/traceon" rel="external nofollow noreferrer" target="_blank">Denis Glazachev</a>).</li>
<li>Introduce setting <code class="syntax">alter_partition_verbose_result</code> which outputs information about touched parts for some types of <code class="syntax">ALTER TABLE ... PARTITION ...</code> queries (currently <code class="syntax">ATTACH</code> and <code class="syntax">FREEZE</code>). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8076" rel="external nofollow noreferrer" target="_blank">#8076</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13017" rel="external nofollow noreferrer" target="_blank">#13017</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add <code class="syntax">bayesAB</code> function for bayesian-ab-testing. <a href="https://github.com/ClickHouse/ClickHouse/pull/12327" rel="external nofollow noreferrer" target="_blank">#12327</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>).</li>
<li>Added <code class="syntax">system.crash_log</code> table into which stack traces for fatal errors are collected. This table should be empty. <a href="https://github.com/ClickHouse/ClickHouse/pull/12316" rel="external nofollow noreferrer" target="_blank">#12316</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added http headers <code class="syntax">X-ClickHouse-Database</code> and <code class="syntax">X-ClickHouse-Format</code> which may be used to set default database and output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/12981" rel="external nofollow noreferrer" target="_blank">#12981</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Add <code class="syntax">minMap</code> and <code class="syntax">maxMap</code> functions support to <code class="syntax">SimpleAggregateFunction</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12662" rel="external nofollow noreferrer" target="_blank">#12662</a> (<a href="https://github.com/ildus" rel="external nofollow noreferrer" target="_blank">Ildus Kurbangaliev</a>).</li>
<li>Add setting <code class="syntax">allow_non_metadata_alters</code> which restricts to execute <code class="syntax">ALTER</code> queries which modify data on disk. Disabled be default. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11547" rel="external nofollow noreferrer" target="_blank">#11547</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12635" rel="external nofollow noreferrer" target="_blank">#12635</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>A function <code class="syntax">formatRow</code> is added to support turning arbitrary expressions into a string via given format. It's useful for manipulating SQL outputs and is quite versatile combined with the <code class="syntax">columns</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/12574" rel="external nofollow noreferrer" target="_blank">#12574</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Add <code class="syntax">FROM_UNIXTIME</code> function for compatibility with MySQL, related to <a href="https://github.com/ClickHouse/ClickHouse/issues/12149" rel="external nofollow noreferrer" target="_blank">12149</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12484" rel="external nofollow noreferrer" target="_blank">#12484</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Allow Nullable types as keys in MergeTree tables if <code class="syntax">allow_nullable_key</code> table setting is enabled. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5319" rel="external nofollow noreferrer" target="_blank">#5319</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12433" rel="external nofollow noreferrer" target="_blank">#12433</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Integration with <a href="https://intl.cloud.tencent.com/product/cos" rel="external nofollow noreferrer" target="_blank">COS</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12386" rel="external nofollow noreferrer" target="_blank">#12386</a> (<a href="https://github.com/fastio" rel="external nofollow noreferrer" target="_blank">fastio</a>).</li>
<li>Add <code class="syntax">mapAdd</code> and <code class="syntax">mapSubtract</code> functions for adding/subtracting key-mapped values. <a href="https://github.com/ClickHouse/ClickHouse/pull/11735" rel="external nofollow noreferrer" target="_blank">#11735</a> (<a href="https://github.com/ildus" rel="external nofollow noreferrer" target="_blank">Ildus Kurbangaliev</a>).</li>
</ul>
<h4 id="bug-fix_24">Bug Fix<a class="headerlink" href="#bug-fix_24" title="Permanent link"> </a></h4>
<ul>
<li>Fix premature <code class="syntax">ON CLUSTER</code> timeouts for queries that must be executed on a single replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6704" rel="external nofollow noreferrer" target="_blank">#6704</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7228" rel="external nofollow noreferrer" target="_blank">#7228</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/13361" rel="external nofollow noreferrer" target="_blank">#13361</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11884" rel="external nofollow noreferrer" target="_blank">#11884</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13450" rel="external nofollow noreferrer" target="_blank">#13450</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix crash in mark inclusion search introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/12277" rel="external nofollow noreferrer" target="_blank">#12277</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14225" rel="external nofollow noreferrer" target="_blank">#14225</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" rel="external nofollow noreferrer" target="_blank">#12566</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix visible data clobbering by progress bar in client in interactive mode. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12562" rel="external nofollow noreferrer" target="_blank">#12562</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13369" rel="external nofollow noreferrer" target="_blank">#13369</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13584" rel="external nofollow noreferrer" target="_blank">#13584</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12964" rel="external nofollow noreferrer" target="_blank">#12964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13691" rel="external nofollow noreferrer" target="_blank">#13691</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed incorrect sorting order for <code class="syntax">LowCardinality</code> columns when ORDER BY multiple columns is used. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13958" rel="external nofollow noreferrer" target="_blank">#13958</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14223" rel="external nofollow noreferrer" target="_blank">#14223</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Removed hardcoded timeout, which wrongly overruled <code class="syntax">query_wait_timeout_milliseconds</code> setting for cache-dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/14105" rel="external nofollow noreferrer" target="_blank">#14105</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed wrong mount point in extra info for <code class="syntax">Poco::Exception: no space left on device</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14050" rel="external nofollow noreferrer" target="_blank">#14050</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix wrong query optimization of select queries with <code class="syntax">DISTINCT</code> keyword when subqueries also have <code class="syntax">DISTINCT</code> in case <code class="syntax">optimize_duplicate_order_by_and_distinct</code> setting is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/13925" rel="external nofollow noreferrer" target="_blank">#13925</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed potential deadlock when renaming <code class="syntax">Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13922" rel="external nofollow noreferrer" target="_blank">#13922</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix incorrect sorting for <code class="syntax">FixedString</code> columns when ORDER BY multiple columns is used. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13182" rel="external nofollow noreferrer" target="_blank">#13182</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13887" rel="external nofollow noreferrer" target="_blank">#13887</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix potentially lower precision of <code class="syntax">topK</code>/<code class="syntax">topKWeighted</code> aggregations (with non-default parameters). <a href="https://github.com/ClickHouse/ClickHouse/pull/13817" rel="external nofollow noreferrer" target="_blank">#13817</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix reading from MergeTree table with INDEX of type SET fails when compared against NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13686" rel="external nofollow noreferrer" target="_blank">#13686</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13793" rel="external nofollow noreferrer" target="_blank">#13793</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix step overflow in function <code class="syntax">range()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13790" rel="external nofollow noreferrer" target="_blank">#13790</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">Directory not empty</code> error when concurrently executing <code class="syntax">DROP DATABASE</code> and <code class="syntax">CREATE TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13756" rel="external nofollow noreferrer" target="_blank">#13756</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add range check for <code class="syntax">h3KRing</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13633" rel="external nofollow noreferrer" target="_blank">#13633</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13752" rel="external nofollow noreferrer" target="_blank">#13752</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix race condition between DETACH and background merges. Parts may revive after detach. This is continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/8602" rel="external nofollow noreferrer" target="_blank">#8602</a> that did not fix the issue but introduced a test that started to fail in very rare cases, demonstrating the issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/13746" rel="external nofollow noreferrer" target="_blank">#13746</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix logging Settings.Names/Values when <code class="syntax">log_queries_min_type</code> greater than <code class="syntax">QUERY_START</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13737" rel="external nofollow noreferrer" target="_blank">#13737</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix incorrect message in <code class="syntax">clickhouse-server.init</code> while checking user and group. <a href="https://github.com/ClickHouse/ClickHouse/pull/13711" rel="external nofollow noreferrer" target="_blank">#13711</a> (<a href="https://github.com/ylchou" rel="external nofollow noreferrer" target="_blank">ylchou</a>).</li>
<li>Do not optimize <code class="syntax">any(arrayJoin())</code> to <code class="syntax">arrayJoin()</code> under <code class="syntax">optimize_move_functions_out_of_any</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13681" rel="external nofollow noreferrer" target="_blank">#13681</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed possible deadlock in concurrent <code class="syntax">ALTER ... REPLACE/MOVE PARTITION ...</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/13626" rel="external nofollow noreferrer" target="_blank">#13626</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed the behaviour when sometimes cache-dictionary returned default value instead of present value from source. <a href="https://github.com/ClickHouse/ClickHouse/pull/13624" rel="external nofollow noreferrer" target="_blank">#13624</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix secondary indices corruption in compact parts (compact parts is an experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/13538" rel="external nofollow noreferrer" target="_blank">#13538</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix wrong code in function <code class="syntax">netloc</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13335" rel="external nofollow noreferrer" target="_blank">#13335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13446" rel="external nofollow noreferrer" target="_blank">#13446</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix error in <code class="syntax">parseDateTimeBestEffort</code> function when unix timestamp was passed as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13362" rel="external nofollow noreferrer" target="_blank">#13362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13441" rel="external nofollow noreferrer" target="_blank">#13441</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix invalid return type for comparison of tuples with <code class="syntax">NULL</code> elements. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12461" rel="external nofollow noreferrer" target="_blank">#12461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13420" rel="external nofollow noreferrer" target="_blank">#13420</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix wrong optimization caused <code class="syntax">aggregate function any(x) is found inside another aggregate function in query</code> error with <code class="syntax">SET optimize_move_functions_out_of_any = 1</code> and aliases inside <code class="syntax">any()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13419" rel="external nofollow noreferrer" target="_blank">#13419</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix possible race in <code class="syntax">StorageMemory</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13416" rel="external nofollow noreferrer" target="_blank">#13416</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix empty output for <code class="syntax">Arrow</code> and <code class="syntax">Parquet</code> formats in case if query return zero rows. It was done because empty output is not valid for this formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/13399" rel="external nofollow noreferrer" target="_blank">#13399</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fix select queries with constant columns and prefix of primary key in <code class="syntax">ORDER BY</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/13396" rel="external nofollow noreferrer" target="_blank">#13396</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix <code class="syntax">PrettyCompactMonoBlock</code> for clickhouse-local. Fix extremes/totals with <code class="syntax">PrettyCompactMonoBlock</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7746" rel="external nofollow noreferrer" target="_blank">#7746</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13394" rel="external nofollow noreferrer" target="_blank">#13394</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed deadlock in system.text_log. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" rel="external nofollow noreferrer" target="_blank">#12452</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>). It is a part of <a href="https://github.com/ClickHouse/ClickHouse/issues/12339" rel="external nofollow noreferrer" target="_blank">#12339</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12325" rel="external nofollow noreferrer" target="_blank">#12325</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13386" rel="external nofollow noreferrer" target="_blank">#13386</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed <code class="syntax">File(TSVWithNames*)</code> (header was written multiple times), fixed <code class="syntax">clickhouse-local --format CSVWithNames*</code> (lacks header, broken after <a href="https://github.com/ClickHouse/ClickHouse/issues/12197" rel="external nofollow noreferrer" target="_blank">#12197</a>), fixed <code class="syntax">clickhouse-local --format CSVWithNames*</code> with zero rows (lacks header). <a href="https://github.com/ClickHouse/ClickHouse/pull/13343" rel="external nofollow noreferrer" target="_blank">#13343</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix segfault when function <code class="syntax">groupArrayMovingSum</code> deserializes empty state. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13339" rel="external nofollow noreferrer" target="_blank">#13339</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13341" rel="external nofollow noreferrer" target="_blank">#13341</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Throw error on <code class="syntax">arrayJoin()</code> function in <code class="syntax">JOIN ON</code> section. <a href="https://github.com/ClickHouse/ClickHouse/pull/13330" rel="external nofollow noreferrer" target="_blank">#13330</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix crash in <code class="syntax">LEFT ASOF JOIN</code> with <code class="syntax">join_use_nulls=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13291" rel="external nofollow noreferrer" target="_blank">#13291</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix possible error <code class="syntax">Totals having transform was already added to pipeline</code> in case of a query from delayed replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/13290" rel="external nofollow noreferrer" target="_blank">#13290</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>The server may crash if user passed specifically crafted arguments to the function <code class="syntax">h3ToChildren</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13275" rel="external nofollow noreferrer" target="_blank">#13275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13277" rel="external nofollow noreferrer" target="_blank">#13277</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potentially low performance and slightly incorrect result for <code class="syntax">uniqExact</code>, <code class="syntax">topK</code>, <code class="syntax">sumDistinct</code> and similar aggregate functions called on Float types with <code class="syntax">NaN</code> values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" rel="external nofollow noreferrer" target="_blank">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" rel="external nofollow noreferrer" target="_blank">#13254</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix assertion in KeyCondition when primary key contains expression with monotonic function and query contains comparison with constant whose type is different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12465" rel="external nofollow noreferrer" target="_blank">#12465</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13251" rel="external nofollow noreferrer" target="_blank">#13251</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Return passed number for numbers with MSB set in function roundUpToPowerOfTwoOrZero(). It prevents potential errors in case of overflow of array sizes. <a href="https://github.com/ClickHouse/ClickHouse/pull/13234" rel="external nofollow noreferrer" target="_blank">#13234</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" rel="external nofollow noreferrer" target="_blank">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" rel="external nofollow noreferrer" target="_blank">#13226</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix assert in <code class="syntax">arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" rel="external nofollow noreferrer" target="_blank">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" rel="external nofollow noreferrer" target="_blank">#13224</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix DateTime64 conversion functions with constant argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/13205" rel="external nofollow noreferrer" target="_blank">#13205</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix parsing row policies from users.xml when names of databases or tables contain dots. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" rel="external nofollow noreferrer" target="_blank">#5779</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12527" rel="external nofollow noreferrer" target="_blank">#12527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13199" rel="external nofollow noreferrer" target="_blank">#13199</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix access to <code class="syntax">redis</code> dictionary after connection was dropped once. It may happen with <code class="syntax">cache</code> and <code class="syntax">direct</code> dictionary layouts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13082" rel="external nofollow noreferrer" target="_blank">#13082</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix wrong index analysis with functions. It could lead to some data parts being skipped when reading from <code class="syntax">MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" rel="external nofollow noreferrer" target="_blank">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" rel="external nofollow noreferrer" target="_blank">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" rel="external nofollow noreferrer" target="_blank">#13081</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix error <code class="syntax">Cannot convert column because it is constant but values of constants are different in source and result</code> for remote queries which use deterministic functions in scope of query, but not deterministic between queries, like <code class="syntax">now()</code>, <code class="syntax">now64()</code>, <code class="syntax">randConstant()</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11327" rel="external nofollow noreferrer" target="_blank">#11327</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13075" rel="external nofollow noreferrer" target="_blank">#13075</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix crash which was possible for queries with <code class="syntax">ORDER BY</code> tuple and small <code class="syntax">LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12623" rel="external nofollow noreferrer" target="_blank">#12623</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13009" rel="external nofollow noreferrer" target="_blank">#13009</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix <code class="syntax">Block structure mismatch</code> error for queries with <code class="syntax">UNION</code> and <code class="syntax">JOIN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12602" rel="external nofollow noreferrer" target="_blank">#12602</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12989" rel="external nofollow noreferrer" target="_blank">#12989</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Corrected <code class="syntax">merge_with_ttl_timeout</code> logic which did not work well when expiration affected more than one partition over one time interval. (Authored by @excitoon). <a href="https://github.com/ClickHouse/ClickHouse/pull/12982" rel="external nofollow noreferrer" target="_blank">#12982</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fix columns duplication for range hashed dictionary created from DDL query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10605" rel="external nofollow noreferrer" target="_blank">#10605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12857" rel="external nofollow noreferrer" target="_blank">#12857</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" rel="external nofollow noreferrer" target="_blank">#12840</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix rare bug when <code class="syntax">ALTER DELETE</code> and <code class="syntax">ALTER MODIFY COLUMN</code> queries executed simultaneously as a single mutation. Bug leads to an incorrect amount of rows in <code class="syntax">count.txt</code> and as a consequence incorrect data in part. Also, fix a small bug with simultaneous <code class="syntax">ALTER RENAME COLUMN</code> and <code class="syntax">ALTER ADD COLUMN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12760" rel="external nofollow noreferrer" target="_blank">#12760</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Wrong credentials being used when using <code class="syntax">clickhouse</code> dictionary source to query remote tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12756" rel="external nofollow noreferrer" target="_blank">#12756</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>).</li>
<li>Fix <code class="syntax">CAST(Nullable(String), Enum())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" rel="external nofollow noreferrer" target="_blank">#12745</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix performance with large tuples, which are interpreted as functions in <code class="syntax">IN</code> section. The case when user writes <code class="syntax">WHERE x IN tuple(1, 2, ...)</code> instead of <code class="syntax">WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" rel="external nofollow noreferrer" target="_blank">#12700</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix memory tracking for input_format_parallel_parsing (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" rel="external nofollow noreferrer" target="_blank">#12672</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix wrong optimization <code class="syntax">optimize_move_functions_out_of_any=1</code> in case of <code class="syntax">any(func(&lt;lambda&gt;))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12664" rel="external nofollow noreferrer" target="_blank">#12664</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" rel="external nofollow noreferrer" target="_blank">#10572</a> fix bloom filter index with const expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" rel="external nofollow noreferrer" target="_blank">#12659</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix SIGSEGV in StorageKafka when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" rel="external nofollow noreferrer" target="_blank">#12658</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add support for function <code class="syntax">if</code> with <code class="syntax">Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" rel="external nofollow noreferrer" target="_blank">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" rel="external nofollow noreferrer" target="_blank">#12648</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>CREATE USER IF NOT EXISTS now does not throw exception if the user exists. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12507" rel="external nofollow noreferrer" target="_blank">#12507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12646" rel="external nofollow noreferrer" target="_blank">#12646</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Exception <code class="syntax">There is no supertype...</code> can be thrown during <code class="syntax">ALTER ... UPDATE</code> in unexpected cases (e.g. when subtracting from UInt64 column). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7306" rel="external nofollow noreferrer" target="_blank">#7306</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4165" rel="external nofollow noreferrer" target="_blank">#4165</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12633" rel="external nofollow noreferrer" target="_blank">#12633</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error for queries with external sorting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12617" rel="external nofollow noreferrer" target="_blank">#12617</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12618" rel="external nofollow noreferrer" target="_blank">#12618</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix error <code class="syntax">Output of TreeExecutor is not sorted</code> for <code class="syntax">OPTIMIZE DEDUPLICATE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" rel="external nofollow noreferrer" target="_blank">#11572</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12613" rel="external nofollow noreferrer" target="_blank">#12613</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix the issue when alias on result of function <code class="syntax">any</code> can be lost during query optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/12593" rel="external nofollow noreferrer" target="_blank">#12593</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Remove data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" rel="external nofollow noreferrer" target="_blank">#12556</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Now ClickHouse will recalculate checksums for parts when file <code class="syntax">checksums.txt</code> is absent. Broken since <a href="https://github.com/ClickHouse/ClickHouse/issues/9827" rel="external nofollow noreferrer" target="_blank">#9827</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12545" rel="external nofollow noreferrer" target="_blank">#12545</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix bug which lead to broken old parts after <code class="syntax">ALTER DELETE</code> query when <code class="syntax">enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" rel="external nofollow noreferrer" target="_blank">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" rel="external nofollow noreferrer" target="_blank">#12543</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixing race condition in live view tables which could cause data duplication. LIVE VIEW is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12519" rel="external nofollow noreferrer" target="_blank">#12519</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fix backwards compatibility in binary format of <code class="syntax">AggregateFunction(avg, ...)</code> values. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12342" rel="external nofollow noreferrer" target="_blank">#12342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12486" rel="external nofollow noreferrer" target="_blank">#12486</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash in JOIN with dictionary when we are joining over expression of dictionary key: <code class="syntax">t JOIN dict ON expr(dict.id) = t.id</code>. Disable dictionary join optimisation for this case. <a href="https://github.com/ClickHouse/ClickHouse/pull/12458" rel="external nofollow noreferrer" target="_blank">#12458</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix overflow when very large LIMIT or OFFSET is specified. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10470" rel="external nofollow noreferrer" target="_blank">#10470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11372" rel="external nofollow noreferrer" target="_blank">#11372</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12427" rel="external nofollow noreferrer" target="_blank">#12427</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>kafka: fix SIGSEGV if there is a message with error in the middle of the batch. <a href="https://github.com/ClickHouse/ClickHouse/pull/12302" rel="external nofollow noreferrer" target="_blank">#12302</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h4 id="improvement_13">Improvement<a class="headerlink" href="#improvement_13" title="Permanent link"> </a></h4>
<ul>
<li>Keep smaller amount of logs in ZooKeeper. Avoid excessive growing of ZooKeeper nodes in case of offline replicas when having many servers/tables/inserts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13100" rel="external nofollow noreferrer" target="_blank">#13100</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now exceptions forwarded to the client if an error happened during ALTER or mutation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11329" rel="external nofollow noreferrer" target="_blank">#11329</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12666" rel="external nofollow noreferrer" target="_blank">#12666</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add <code class="syntax">QueryTimeMicroseconds</code>, <code class="syntax">SelectQueryTimeMicroseconds</code> and <code class="syntax">InsertQueryTimeMicroseconds</code> to <code class="syntax">system.events</code>, along with system.metrics, processes, query_log, etc. <a href="https://github.com/ClickHouse/ClickHouse/pull/13028" rel="external nofollow noreferrer" target="_blank">#13028</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Added <code class="syntax">SelectedRows</code> and <code class="syntax">SelectedBytes</code> to <code class="syntax">system.events</code>, along with system.metrics, processes, query_log, etc. <a href="https://github.com/ClickHouse/ClickHouse/pull/12638" rel="external nofollow noreferrer" target="_blank">#12638</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Added <code class="syntax">current_database</code> information to <code class="syntax">system.query_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12652" rel="external nofollow noreferrer" target="_blank">#12652</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Allow <code class="syntax">TabSeparatedRaw</code> as input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/12009" rel="external nofollow noreferrer" target="_blank">#12009</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Now <code class="syntax">joinGet</code> supports multi-key lookup. <a href="https://github.com/ClickHouse/ClickHouse/pull/12418" rel="external nofollow noreferrer" target="_blank">#12418</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Allow <code class="syntax">*Map</code> aggregate functions to work on Arrays with NULLs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13157" rel="external nofollow noreferrer" target="_blank">#13157</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13225" rel="external nofollow noreferrer" target="_blank">#13225</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Avoid overflow in parsing of DateTime values that will lead to negative unix timestamp in their timezone (for example, <code class="syntax">1970-01-01 00:00:00</code> in Moscow). Saturate to zero instead. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3470" rel="external nofollow noreferrer" target="_blank">#3470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4172" rel="external nofollow noreferrer" target="_blank">#4172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12443" rel="external nofollow noreferrer" target="_blank">#12443</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>AvroConfluent: Skip Kafka tombstone records - Support skipping broken records <a href="https://github.com/ClickHouse/ClickHouse/pull/13203" rel="external nofollow noreferrer" target="_blank">#13203</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>).</li>
<li>Fix wrong error for long queries. It was possible to get syntax error other than <code class="syntax">Max query size exceeded</code> for correct query. <a href="https://github.com/ClickHouse/ClickHouse/pull/13928" rel="external nofollow noreferrer" target="_blank">#13928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix data race in <code class="syntax">lgamma</code> function. This race was caught only in <code class="syntax">tsan</code>, no side effects really happened. <a href="https://github.com/ClickHouse/ClickHouse/pull/13842" rel="external nofollow noreferrer" target="_blank">#13842</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix a 'Week'-interval formatting for ATTACH/ALTER/CREATE QUOTA-statements. <a href="https://github.com/ClickHouse/ClickHouse/pull/13417" rel="external nofollow noreferrer" target="_blank">#13417</a> (<a href="https://github.com/vladimir-golovchenko" rel="external nofollow noreferrer" target="_blank">vladimir-golovchenko</a>).</li>
<li>Now broken parts are also reported when encountered in compact part processing. Compact parts is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13282" rel="external nofollow noreferrer" target="_blank">#13282</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix assert in <code class="syntax">geohashesInBox</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12554" rel="external nofollow noreferrer" target="_blank">#12554</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13229" rel="external nofollow noreferrer" target="_blank">#13229</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix assert in <code class="syntax">parseDateTimeBestEffort</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12649" rel="external nofollow noreferrer" target="_blank">#12649</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13227" rel="external nofollow noreferrer" target="_blank">#13227</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Minor optimization in Processors/PipelineExecutor: breaking out of a loop because it makes sense to do so. <a href="https://github.com/ClickHouse/ClickHouse/pull/13058" rel="external nofollow noreferrer" target="_blank">#13058</a> (<a href="https://github.com/markpapadakis" rel="external nofollow noreferrer" target="_blank">Mark Papadakis</a>).</li>
<li>Support TRUNCATE table without TABLE keyword. <a href="https://github.com/ClickHouse/ClickHouse/pull/12653" rel="external nofollow noreferrer" target="_blank">#12653</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix explain query format overwrite by default. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12432" rel="external nofollow noreferrer" target="_blank">#12541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12541" rel="external nofollow noreferrer" target="_blank">#12541</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
<li>Allow to set JOIN kind and type in more standad way: <code class="syntax">LEFT SEMI JOIN</code> instead of <code class="syntax">SEMI LEFT JOIN</code>. For now both are correct. <a href="https://github.com/ClickHouse/ClickHouse/pull/12520" rel="external nofollow noreferrer" target="_blank">#12520</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Changes default value for <code class="syntax">multiple_joins_rewriter_version</code> to 2. It enables new multiple joins rewriter that knows about column names. <a href="https://github.com/ClickHouse/ClickHouse/pull/12469" rel="external nofollow noreferrer" target="_blank">#12469</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Add several metrics for requests to S3 storages. <a href="https://github.com/ClickHouse/ClickHouse/pull/12464" rel="external nofollow noreferrer" target="_blank">#12464</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Use correct default secure port for clickhouse-benchmark with <code class="syntax">--secure</code> argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11044" rel="external nofollow noreferrer" target="_blank">#11044</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12440" rel="external nofollow noreferrer" target="_blank">#12440</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Rollback insertion errors in <code class="syntax">Log</code>, <code class="syntax">TinyLog</code>, <code class="syntax">StripeLog</code> engines. In previous versions insertion error lead to inconsisent table state (this works as documented and it is normal for these table engines). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12402" rel="external nofollow noreferrer" target="_blank">#12402</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12426" rel="external nofollow noreferrer" target="_blank">#12426</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Implement <code class="syntax">RENAME DATABASE</code> and <code class="syntax">RENAME DICTIONARY</code> for <code class="syntax">Atomic</code> database engine - Add implicit <code class="syntax">{uuid}</code> macro, which can be used in ZooKeeper path for <code class="syntax">ReplicatedMergeTree</code>. It works with <code class="syntax">CREATE ... ON CLUSTER ...</code> queries. Set <code class="syntax">show_table_uuid_in_table_create_query_if_not_nil</code> to <code class="syntax">true</code> to use it. - Make <code class="syntax">ReplicatedMergeTree</code> engine arguments optional, <code class="syntax">/clickhouse/tables/{uuid}/{shard}/</code> and <code class="syntax">{replica}</code> are used by default. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12135" rel="external nofollow noreferrer" target="_blank">#12135</a>. - Minor fixes. - These changes break backward compatibility of <code class="syntax">Atomic</code> database engine. Previously created <code class="syntax">Atomic</code> databases must be manually converted to new format. Atomic database is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12343" rel="external nofollow noreferrer" target="_blank">#12343</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Separated <code class="syntax">AWSAuthV4Signer</code> into different logger, removed excessive <code class="syntax">AWSClient: AWSClient</code> from log messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/12320" rel="external nofollow noreferrer" target="_blank">#12320</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Better exception message in disk access storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/12625" rel="external nofollow noreferrer" target="_blank">#12625</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Better exception for function <code class="syntax">in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" rel="external nofollow noreferrer" target="_blank">#12529</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix error message about adaptive granularity. <a href="https://github.com/ClickHouse/ClickHouse/pull/12624" rel="external nofollow noreferrer" target="_blank">#12624</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix SETTINGS parse after FORMAT. <a href="https://github.com/ClickHouse/ClickHouse/pull/12480" rel="external nofollow noreferrer" target="_blank">#12480</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>If MergeTree table does not contain ORDER BY or PARTITION BY, it was possible to request ALTER to CLEAR all the columns and ALTER will stuck. Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/7941" rel="external nofollow noreferrer" target="_blank">#7941</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12382" rel="external nofollow noreferrer" target="_blank">#12382</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Avoid re-loading completion from the history file after each query (to avoid history overlaps with other client sessions). <a href="https://github.com/ClickHouse/ClickHouse/pull/13086" rel="external nofollow noreferrer" target="_blank">#13086</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h4 id="performance-improvement_6">Performance Improvement<a class="headerlink" href="#performance-improvement_6" title="Permanent link"> </a></h4>
<ul>
<li>Lower memory usage for some operations up to 2 times. <a href="https://github.com/ClickHouse/ClickHouse/pull/12424" rel="external nofollow noreferrer" target="_blank">#12424</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Optimize PK lookup for queries that match exact PK range. <a href="https://github.com/ClickHouse/ClickHouse/pull/12277" rel="external nofollow noreferrer" target="_blank">#12277</a> (<a href="https://github.com/bobrik" rel="external nofollow noreferrer" target="_blank">Ivan Babrou</a>).</li>
<li>Slightly optimize very short queries with <code class="syntax">LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14129" rel="external nofollow noreferrer" target="_blank">#14129</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Slightly improve performance of aggregation by UInt8/UInt16 keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/13091" rel="external nofollow noreferrer" target="_blank">#13091</a> and <a href="https://github.com/ClickHouse/ClickHouse/pull/13055" rel="external nofollow noreferrer" target="_blank">#13055</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Push down <code class="syntax">LIMIT</code> step for query plan (inside subqueries). <a href="https://github.com/ClickHouse/ClickHouse/pull/13016" rel="external nofollow noreferrer" target="_blank">#13016</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Parallel primary key lookup and skipping index stages on parts, as described in <a href="https://github.com/ClickHouse/ClickHouse/issues/11564" rel="external nofollow noreferrer" target="_blank">#11564</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12589" rel="external nofollow noreferrer" target="_blank">#12589</a> (<a href="https://github.com/bobrik" rel="external nofollow noreferrer" target="_blank">Ivan Babrou</a>).</li>
<li>Converting String-type arguments of function "if" and "transform" into enum if <code class="syntax">set optimize_if_transform_strings_to_enum = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12515" rel="external nofollow noreferrer" target="_blank">#12515</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Replaces monotonic functions with its argument in <code class="syntax">ORDER BY</code> if <code class="syntax">set optimize_monotonous_functions_in_order_by=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12467" rel="external nofollow noreferrer" target="_blank">#12467</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Add order by optimization that rewrites <code class="syntax">ORDER BY x, f(x)</code> with <code class="syntax">ORDER by x</code> if <code class="syntax">set optimize_redundant_functions_in_order_by = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12404" rel="external nofollow noreferrer" target="_blank">#12404</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Allow pushdown predicate when subquery contains <code class="syntax">WITH</code> clause. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12293" rel="external nofollow noreferrer" target="_blank">#12293</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/12663" rel="external nofollow noreferrer" target="_blank">#12663</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Improve performance of reading from compact parts. Compact parts is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" rel="external nofollow noreferrer" target="_blank">#12492</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Attempt to implement streaming optimization in <code class="syntax">DiskS3</code>. DiskS3 is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12434" rel="external nofollow noreferrer" target="_blank">#12434</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_8">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_8" title="Permanent link"> </a></h4>
<ul>
<li>Use <code class="syntax">shellcheck</code> for sh tests linting. <a href="https://github.com/ClickHouse/ClickHouse/pull/13200" rel="external nofollow noreferrer" target="_blank">#13200</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/13207" rel="external nofollow noreferrer" target="_blank">#13207</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add script which set labels for pull requests in GitHub hook. <a href="https://github.com/ClickHouse/ClickHouse/pull/13183" rel="external nofollow noreferrer" target="_blank">#13183</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Remove some of recursive submodules. See <a href="https://github.com/ClickHouse/ClickHouse/issues/13378" rel="external nofollow noreferrer" target="_blank">#13378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13379" rel="external nofollow noreferrer" target="_blank">#13379</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Ensure that all the submodules are from proper URLs. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/13379" rel="external nofollow noreferrer" target="_blank">#13379</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13378" rel="external nofollow noreferrer" target="_blank">#13378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13397" rel="external nofollow noreferrer" target="_blank">#13397</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added support for user-declared settings, which can be accessed from inside queries. This is needed when ClickHouse engine is used as a component of another system. <a href="https://github.com/ClickHouse/ClickHouse/pull/13013" rel="external nofollow noreferrer" target="_blank">#13013</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Added testing for RBAC functionality of INSERT privilege in TestFlows. Expanded tables on which SELECT is being tested. Added Requirements to match new table engine tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/13340" rel="external nofollow noreferrer" target="_blank">#13340</a> (<a href="https://github.com/MyroTk" rel="external nofollow noreferrer" target="_blank">MyroTk</a>).</li>
<li>Fix timeout error during server restart in the stress test. <a href="https://github.com/ClickHouse/ClickHouse/pull/13321" rel="external nofollow noreferrer" target="_blank">#13321</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Now fast test will wait server with retries. <a href="https://github.com/ClickHouse/ClickHouse/pull/13284" rel="external nofollow noreferrer" target="_blank">#13284</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Function <code class="syntax">materialize()</code> (the function for ClickHouse testing) will work for NULL as expected - by transforming it to non-constant column. <a href="https://github.com/ClickHouse/ClickHouse/pull/13212" rel="external nofollow noreferrer" target="_blank">#13212</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix libunwind build in AArch64. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13204" rel="external nofollow noreferrer" target="_blank">#13204</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13208" rel="external nofollow noreferrer" target="_blank">#13208</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Even more retries in zkutil gtest to prevent test flakiness. <a href="https://github.com/ClickHouse/ClickHouse/pull/13165" rel="external nofollow noreferrer" target="_blank">#13165</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Small fixes to the RBAC TestFlows. <a href="https://github.com/ClickHouse/ClickHouse/pull/13152" rel="external nofollow noreferrer" target="_blank">#13152</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fixing <code class="syntax">00960_live_view_watch_events_live.py</code> test. <a href="https://github.com/ClickHouse/ClickHouse/pull/13108" rel="external nofollow noreferrer" target="_blank">#13108</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Improve cache purge in documentation deploy script. <a href="https://github.com/ClickHouse/ClickHouse/pull/13107" rel="external nofollow noreferrer" target="_blank">#13107</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Rewrote some orphan tests to gtest. Removed useless includes from tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/13073" rel="external nofollow noreferrer" target="_blank">#13073</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Added tests for RBAC functionality of <code class="syntax">SELECT</code> privilege in TestFlows. <a href="https://github.com/ClickHouse/ClickHouse/pull/13061" rel="external nofollow noreferrer" target="_blank">#13061</a> (<a href="https://github.com/ritaank" rel="external nofollow noreferrer" target="_blank">Ritaank Tiwari</a>).</li>
<li>Rerun some tests in fast test check. <a href="https://github.com/ClickHouse/ClickHouse/pull/12992" rel="external nofollow noreferrer" target="_blank">#12992</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix MSan error in "rdkafka" library. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12990" rel="external nofollow noreferrer" target="_blank">#12990</a>. Updated <code class="syntax">rdkafka</code> to version 1.5 (master). <a href="https://github.com/ClickHouse/ClickHouse/pull/12991" rel="external nofollow noreferrer" target="_blank">#12991</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan report in base64 if tests were run on server with AVX-512. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12318" rel="external nofollow noreferrer" target="_blank">#12318</a>. Author: @qoega. <a href="https://github.com/ClickHouse/ClickHouse/pull/12441" rel="external nofollow noreferrer" target="_blank">#12441</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan report in HDFS library. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12330" rel="external nofollow noreferrer" target="_blank">#12330</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12453" rel="external nofollow noreferrer" target="_blank">#12453</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Check an ability that we able to restore the backup from an old version to the new version. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8979" rel="external nofollow noreferrer" target="_blank">#8979</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12959" rel="external nofollow noreferrer" target="_blank">#12959</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Do not build helper_container image inside integrational tests. Build docker container in CI and use pre-built helper_container in integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12953" rel="external nofollow noreferrer" target="_blank">#12953</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Add a test for <code class="syntax">ALTER TABLE CLEAR COLUMN</code> query for primary key columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/12951" rel="external nofollow noreferrer" target="_blank">#12951</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Increased timeouts in testflows tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12949" rel="external nofollow noreferrer" target="_blank">#12949</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fix build of test under Mac OS X. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12767" rel="external nofollow noreferrer" target="_blank">#12767</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12772" rel="external nofollow noreferrer" target="_blank">#12772</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Connector-ODBC updated to mysql-connector-odbc-8.0.21. <a href="https://github.com/ClickHouse/ClickHouse/pull/12739" rel="external nofollow noreferrer" target="_blank">#12739</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Adding RBAC syntax tests in TestFlows. <a href="https://github.com/ClickHouse/ClickHouse/pull/12642" rel="external nofollow noreferrer" target="_blank">#12642</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Improve performance of TestKeeper. This will speedup tests with heavy usage of Replicated tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12505" rel="external nofollow noreferrer" target="_blank">#12505</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now we check that server is able to start after stress tests run. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12473" rel="external nofollow noreferrer" target="_blank">#12473</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12496" rel="external nofollow noreferrer" target="_blank">#12496</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Update fmtlib to master (7.0.1). <a href="https://github.com/ClickHouse/ClickHouse/pull/12446" rel="external nofollow noreferrer" target="_blank">#12446</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add docker image for fast tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12294" rel="external nofollow noreferrer" target="_blank">#12294</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Rework configuration paths for integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12285" rel="external nofollow noreferrer" target="_blank">#12285</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Add compiler option to control that stack frames are not too large. This will help to run the code in fibers with small stack size. <a href="https://github.com/ClickHouse/ClickHouse/pull/11524" rel="external nofollow noreferrer" target="_blank">#11524</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Update gitignore-files. <a href="https://github.com/ClickHouse/ClickHouse/pull/13447" rel="external nofollow noreferrer" target="_blank">#13447</a> (<a href="https://github.com/vladimir-golovchenko" rel="external nofollow noreferrer" target="_blank">vladimir-golovchenko</a>).</li>
</ul>
<h2 id="clickhouse-release-20-6">ClickHouse release 20.6<a class="headerlink" href="#clickhouse-release-20-6" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-6-3-28-stable">ClickHouse release v20.6.3.28-stable<a class="headerlink" href="#clickhouse-release-v20-6-3-28-stable" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_6">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_6" title="Permanent link"> </a></h4>
<ul>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_6">New Feature<a class="headerlink" href="#new-feature_6" title="Permanent link"> </a></h4>
<ul>
<li>Added an initial implementation of <code class="syntax">EXPLAIN</code> query. Syntax: <code class="syntax">EXPLAIN SELECT ...</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/1118" rel="external nofollow noreferrer" target="_blank">#1118</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11873" rel="external nofollow noreferrer" target="_blank">#11873</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Added storage <code class="syntax">RabbitMQ</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11069" rel="external nofollow noreferrer" target="_blank">#11069</a> (<a href="https://github.com/kssenii" rel="external nofollow noreferrer" target="_blank">Kseniia Sumarokova</a>).</li>
<li>Implemented PostgreSQL-like <code class="syntax">ILIKE</code> operator for <a href="https://github.com/ClickHouse/ClickHouse/issues/11710" rel="external nofollow noreferrer" target="_blank">#11710</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12125" rel="external nofollow noreferrer" target="_blank">#12125</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Supported RIGHT and FULL JOIN with <code class="syntax">SET join_algorithm = 'partial_merge'</code>. Only ALL strictness is allowed (ANY, SEMI, ANTI, ASOF are not). <a href="https://github.com/ClickHouse/ClickHouse/pull/12118" rel="external nofollow noreferrer" target="_blank">#12118</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Added a function <code class="syntax">initializeAggregation</code> to initialize an aggregation based on a single value. <a href="https://github.com/ClickHouse/ClickHouse/pull/12109" rel="external nofollow noreferrer" target="_blank">#12109</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>).</li>
<li>Supported <code class="syntax">ALTER TABLE ... [ADD|MODIFY] COLUMN ... FIRST</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/4006" rel="external nofollow noreferrer" target="_blank">#4006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12073" rel="external nofollow noreferrer" target="_blank">#12073</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Added function <code class="syntax">parseDateTimeBestEffortUS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12028" rel="external nofollow noreferrer" target="_blank">#12028</a> (<a href="https://github.com/ucasFL" rel="external nofollow noreferrer" target="_blank">flynn</a>).</li>
<li>Support format <code class="syntax">ORC</code> for output (was supported only for input). <a href="https://github.com/ClickHouse/ClickHouse/pull/11662" rel="external nofollow noreferrer" target="_blank">#11662</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
</ul>
<h4 id="bug-fix_25">Bug Fix<a class="headerlink" href="#bug-fix_25" title="Permanent link"> </a></h4>
<ul>
<li>Fixed <code class="syntax">aggregate function any(x) is found inside another aggregate function in query</code> error with <code class="syntax">SET optimize_move_functions_out_of_any = 1</code> and aliases inside <code class="syntax">any()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13419" rel="external nofollow noreferrer" target="_blank">#13419</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed <code class="syntax">PrettyCompactMonoBlock</code> for clickhouse-local. Fixed extremes/totals with <code class="syntax">PrettyCompactMonoBlock</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7746" rel="external nofollow noreferrer" target="_blank">#7746</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13394" rel="external nofollow noreferrer" target="_blank">#13394</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed possible error <code class="syntax">Totals having transform was already added to pipeline</code> in case of a query from delayed replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/13290" rel="external nofollow noreferrer" target="_blank">#13290</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>The server may crash if user passed specifically crafted arguments to the function <code class="syntax">h3ToChildren</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13275" rel="external nofollow noreferrer" target="_blank">#13275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13277" rel="external nofollow noreferrer" target="_blank">#13277</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potentially low performance and slightly incorrect result for <code class="syntax">uniqExact</code>, <code class="syntax">topK</code>, <code class="syntax">sumDistinct</code> and similar aggregate functions called on Float types with NaN values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" rel="external nofollow noreferrer" target="_blank">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" rel="external nofollow noreferrer" target="_blank">#13254</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" rel="external nofollow noreferrer" target="_blank">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" rel="external nofollow noreferrer" target="_blank">#13226</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed assert in <code class="syntax">arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" rel="external nofollow noreferrer" target="_blank">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" rel="external nofollow noreferrer" target="_blank">#13224</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">DateTime64</code> conversion functions with constant argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/13205" rel="external nofollow noreferrer" target="_blank">#13205</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong index analysis with functions. It could lead to pruning wrong parts, while reading from <code class="syntax">MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" rel="external nofollow noreferrer" target="_blank">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" rel="external nofollow noreferrer" target="_blank">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" rel="external nofollow noreferrer" target="_blank">#13081</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed error <code class="syntax">Cannot convert column because it is constant but values of constants are different in source and result</code> for remote queries which use deterministic functions in scope of query, but not deterministic between queries, like <code class="syntax">now()</code>, <code class="syntax">now64()</code>, <code class="syntax">randConstant()</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11327" rel="external nofollow noreferrer" target="_blank">#11327</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13075" rel="external nofollow noreferrer" target="_blank">#13075</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" rel="external nofollow noreferrer" target="_blank">#12840</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed rare bug when <code class="syntax">ALTER DELETE</code> and <code class="syntax">ALTER MODIFY COLUMN</code> queries executed simultaneously as a single mutation. Bug leads to an incorrect amount of rows in <code class="syntax">count.txt</code> and as a consequence incorrect data in part. Also, fix a small bug with simultaneous <code class="syntax">ALTER RENAME COLUMN</code> and <code class="syntax">ALTER ADD COLUMN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12760" rel="external nofollow noreferrer" target="_blank">#12760</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">CAST(Nullable(String), Enum())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" rel="external nofollow noreferrer" target="_blank">#12745</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed a performance with large tuples, which are interpreted as functions in <code class="syntax">IN</code> section. The case when user write <code class="syntax">WHERE x IN tuple(1, 2, ...)</code> instead of <code class="syntax">WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" rel="external nofollow noreferrer" target="_blank">#12700</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed memory tracking for <code class="syntax">input_format_parallel_parsing</code> (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" rel="external nofollow noreferrer" target="_blank">#12672</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bloom filter index with const expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" rel="external nofollow noreferrer" target="_blank">#10572</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" rel="external nofollow noreferrer" target="_blank">#12659</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">SIGSEGV</code> in <code class="syntax">StorageKafka</code> when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" rel="external nofollow noreferrer" target="_blank">#12658</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Added support for function <code class="syntax">if</code> with <code class="syntax">Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" rel="external nofollow noreferrer" target="_blank">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" rel="external nofollow noreferrer" target="_blank">#12648</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li><code class="syntax">CREATE USER IF NOT EXISTS</code> now does not throw exception if the user exists. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12507" rel="external nofollow noreferrer" target="_blank">#12507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12646" rel="external nofollow noreferrer" target="_blank">#12646</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Better exception message in disk access storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/12625" rel="external nofollow noreferrer" target="_blank">#12625</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>The function <code class="syntax">groupArrayMoving*</code> was not working for distributed queries. It's result was calculated within incorrect data type (without promotion to the largest type). The function <code class="syntax">groupArrayMovingAvg</code> was returning integer number that was inconsistent with the <code class="syntax">avg</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12568" rel="external nofollow noreferrer" target="_blank">#12568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12622" rel="external nofollow noreferrer" target="_blank">#12622</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed lack of aliases with function <code class="syntax">any</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12593" rel="external nofollow noreferrer" target="_blank">#12593</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" rel="external nofollow noreferrer" target="_blank">#12566</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Remove data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" rel="external nofollow noreferrer" target="_blank">#12556</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bug which lead to broken old parts after <code class="syntax">ALTER DELETE</code> query when <code class="syntax">enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" rel="external nofollow noreferrer" target="_blank">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" rel="external nofollow noreferrer" target="_blank">#12543</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Better exception for function <code class="syntax">in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" rel="external nofollow noreferrer" target="_blank">#12529</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixing race condition in live view tables which could cause data duplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/12519" rel="external nofollow noreferrer" target="_blank">#12519</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" rel="external nofollow noreferrer" target="_blank">#12492</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed backwards compatibility in binary format of <code class="syntax">AggregateFunction(avg, ...)</code> values. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12342" rel="external nofollow noreferrer" target="_blank">#12342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12486" rel="external nofollow noreferrer" target="_blank">#12486</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed SETTINGS parse after FORMAT. <a href="https://github.com/ClickHouse/ClickHouse/pull/12480" rel="external nofollow noreferrer" target="_blank">#12480</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the deadlock if <code class="syntax">text_log</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" rel="external nofollow noreferrer" target="_blank">#12452</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed overflow when very large <code class="syntax">LIMIT</code> or <code class="syntax">OFFSET</code> is specified. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10470" rel="external nofollow noreferrer" target="_blank">#10470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11372" rel="external nofollow noreferrer" target="_blank">#11372</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12427" rel="external nofollow noreferrer" target="_blank">#12427</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed possible segfault if <code class="syntax">StorageMerge</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" rel="external nofollow noreferrer" target="_blank">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" rel="external nofollow noreferrer" target="_blank">#12401</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Reverted change introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/11079" rel="external nofollow noreferrer" target="_blank">#11079</a> to resolve <a href="https://github.com/ClickHouse/ClickHouse/issues/12098" rel="external nofollow noreferrer" target="_blank">#12098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12397" rel="external nofollow noreferrer" target="_blank">#12397</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Additional check for arguments of bloom filter index. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11408" rel="external nofollow noreferrer" target="_blank">#11408</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12388" rel="external nofollow noreferrer" target="_blank">#12388</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Avoid exception when negative or floating point constant is used in WHERE condition for indexed tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11905" rel="external nofollow noreferrer" target="_blank">#11905</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12384" rel="external nofollow noreferrer" target="_blank">#12384</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allowed to <code class="syntax">CLEAR</code> column even if there are depending <code class="syntax">DEFAULT</code> expressions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12333" rel="external nofollow noreferrer" target="_blank">#12333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12378" rel="external nofollow noreferrer" target="_blank">#12378</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">TOTALS/ROLLUP/CUBE</code> for aggregate functions with <code class="syntax">-State</code> and <code class="syntax">Nullable</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12163" rel="external nofollow noreferrer" target="_blank">#12163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12376" rel="external nofollow noreferrer" target="_blank">#12376</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed error message and exit codes for <code class="syntax">ALTER RENAME COLUMN</code> queries, when <code class="syntax">RENAME</code> is not allowed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12301" rel="external nofollow noreferrer" target="_blank">#12301</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/12303" rel="external nofollow noreferrer" target="_blank">#12303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12335" rel="external nofollow noreferrer" target="_blank">#12335</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed very rare race condition in <code class="syntax">ReplicatedMergeTreeQueue</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12315" rel="external nofollow noreferrer" target="_blank">#12315</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>When using codec <code class="syntax">Delta</code> or <code class="syntax">DoubleDelta</code> with non fixed width types, exception with code <code class="syntax">LOGICAL_ERROR</code> was returned instead of exception with code <code class="syntax">BAD_ARGUMENTS</code> (we ensure that exceptions with code logical error never happen). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12110" rel="external nofollow noreferrer" target="_blank">#12110</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12308" rel="external nofollow noreferrer" target="_blank">#12308</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed order of columns in <code class="syntax">WITH FILL</code> modifier. Previously order of columns of <code class="syntax">ORDER BY</code> statement wasn't respected. <a href="https://github.com/ClickHouse/ClickHouse/pull/12306" rel="external nofollow noreferrer" target="_blank">#12306</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Avoid "bad cast" exception when there is an expression that filters data by virtual columns (like <code class="syntax">_table</code> in <code class="syntax">Merge</code> tables) or by "index" columns in system tables such as filtering by database name when querying from <code class="syntax">system.tables</code>, and this expression returns <code class="syntax">Nullable</code> type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12166" rel="external nofollow noreferrer" target="_blank">#12166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12305" rel="external nofollow noreferrer" target="_blank">#12305</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">TTL</code> after renaming column, on which depends TTL expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12304" rel="external nofollow noreferrer" target="_blank">#12304</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed SIGSEGV if there is an message with error in the middle of the batch in <code class="syntax">Kafka</code> Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/12302" rel="external nofollow noreferrer" target="_blank">#12302</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the situation when some threads might randomly hang for a few seconds during <code class="syntax">DNS</code> cache updating. <a href="https://github.com/ClickHouse/ClickHouse/pull/12296" rel="external nofollow noreferrer" target="_blank">#12296</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed typo in setting name. <a href="https://github.com/ClickHouse/ClickHouse/pull/12292" rel="external nofollow noreferrer" target="_blank">#12292</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Show error after <code class="syntax">TrieDictionary</code> failed to load. <a href="https://github.com/ClickHouse/ClickHouse/pull/12290" rel="external nofollow noreferrer" target="_blank">#12290</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>The function <code class="syntax">arrayFill</code> worked incorrectly for empty arrays that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12263" rel="external nofollow noreferrer" target="_blank">#12263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12279" rel="external nofollow noreferrer" target="_blank">#12279</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Implement conversions to the common type for <code class="syntax">LowCardinality</code> types. This allows to execute UNION ALL of tables with columns of LowCardinality and other columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8212" rel="external nofollow noreferrer" target="_blank">#8212</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4342" rel="external nofollow noreferrer" target="_blank">#4342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12275" rel="external nofollow noreferrer" target="_blank">#12275</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the behaviour on reaching redirect limit in request to <code class="syntax">S3</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/12256" rel="external nofollow noreferrer" target="_blank">#12256</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Fixed the behaviour when during multiple sequential inserts in <code class="syntax">StorageFile</code> header for some special types was written more than once. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/6155" rel="external nofollow noreferrer" target="_blank">#6155</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12197" rel="external nofollow noreferrer" target="_blank">#12197</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed logical functions for UInt8 values when they are not equal to 0 or 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/12196" rel="external nofollow noreferrer" target="_blank">#12196</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Cap max_memory_usage* limits to the process resident memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/12182" rel="external nofollow noreferrer" target="_blank">#12182</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix dictGet arguments check during <code class="syntax">GROUP BY</code> injective functions elimination. <a href="https://github.com/ClickHouse/ClickHouse/pull/12179" rel="external nofollow noreferrer" target="_blank">#12179</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the behaviour when <code class="syntax">SummingMergeTree</code> engine sums up columns from partition key. Added an exception in case of explicit definition of columns to sum which intersects with partition key columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7867" rel="external nofollow noreferrer" target="_blank">#7867</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12173" rel="external nofollow noreferrer" target="_blank">#12173</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Don't split the dictionary source's table name into schema and table name itself if ODBC connection does not support schema. <a href="https://github.com/ClickHouse/ClickHouse/pull/12165" rel="external nofollow noreferrer" target="_blank">#12165</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed wrong logic in <code class="syntax">ALTER DELETE</code> that leads to deleting of records when condition evaluates to NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9088" rel="external nofollow noreferrer" target="_blank">#9088</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12106" rel="external nofollow noreferrer" target="_blank">#12106</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12153" rel="external nofollow noreferrer" target="_blank">#12153</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" rel="external nofollow noreferrer" target="_blank">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" rel="external nofollow noreferrer" target="_blank">#12151</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed bad code in redundant ORDER BY optimization. The bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/10067" rel="external nofollow noreferrer" target="_blank">#10067</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12148" rel="external nofollow noreferrer" target="_blank">#12148</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential overflow in integer division. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12119" rel="external nofollow noreferrer" target="_blank">#12119</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12140" rel="external nofollow noreferrer" target="_blank">#12140</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential infinite loop in <code class="syntax">greatCircleDistance</code>, <code class="syntax">geoDistance</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12117" rel="external nofollow noreferrer" target="_blank">#12117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12137" rel="external nofollow noreferrer" target="_blank">#12137</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Normalize "pid" file handling. In previous versions the server may refuse to start if it was killed without proper shutdown and if there is another process that has the same pid as previously runned server. Also pid file may be removed in unsuccessful server startup even if there is another server running. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3501" rel="external nofollow noreferrer" target="_blank">#3501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12133" rel="external nofollow noreferrer" target="_blank">#12133</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed bug which leads to incorrect table metadata in ZooKeepeer for ReplicatedVersionedCollapsingMergeTree tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12093" rel="external nofollow noreferrer" target="_blank">#12093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12121" rel="external nofollow noreferrer" target="_blank">#12121</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Avoid "There is no query" exception for materialized views with joins or with subqueries attached to system logs (system.query_log, metric_log, etc) or to engine=Buffer underlying table. <a href="https://github.com/ClickHouse/ClickHouse/pull/12120" rel="external nofollow noreferrer" target="_blank">#12120</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed handling dependency of table with ENGINE=Dictionary on dictionary. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10994" rel="external nofollow noreferrer" target="_blank">#10994</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10397" rel="external nofollow noreferrer" target="_blank">#10397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12116" rel="external nofollow noreferrer" target="_blank">#12116</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Format <code class="syntax">Parquet</code> now properly works with <code class="syntax">LowCardinality</code> and <code class="syntax">LowCardinality(Nullable)</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12086" rel="external nofollow noreferrer" target="_blank">#12086</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8406" rel="external nofollow noreferrer" target="_blank">#8406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12108" rel="external nofollow noreferrer" target="_blank">#12108</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed performance for selects with <code class="syntax">UNION</code> caused by wrong limit for the total number of threads. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12030" rel="external nofollow noreferrer" target="_blank">#12030</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12103" rel="external nofollow noreferrer" target="_blank">#12103</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed segfault with <code class="syntax">-StateResample</code> combinators. <a href="https://github.com/ClickHouse/ClickHouse/pull/12092" rel="external nofollow noreferrer" target="_blank">#12092</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed empty <code class="syntax">result_rows</code> and <code class="syntax">result_bytes</code> metrics in <code class="syntax">system.quey_log</code> for selects. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11595" rel="external nofollow noreferrer" target="_blank">#11595</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12089" rel="external nofollow noreferrer" target="_blank">#12089</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed unnecessary limiting the number of threads for selects from <code class="syntax">VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" rel="external nofollow noreferrer" target="_blank">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" rel="external nofollow noreferrer" target="_blank">#12085</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed SIGSEGV in StorageKafka on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12075" rel="external nofollow noreferrer" target="_blank">#12075</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed possible crash while using wrong type for <code class="syntax">PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12053" rel="external nofollow noreferrer" target="_blank">#12053</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12060" rel="external nofollow noreferrer" target="_blank">#12060</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12060" rel="external nofollow noreferrer" target="_blank">#12060</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Tuple(LowCardinality)</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9766" rel="external nofollow noreferrer" target="_blank">#9766</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12055" rel="external nofollow noreferrer" target="_blank">#12055</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed constraints check if constraint is a constant expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11360" rel="external nofollow noreferrer" target="_blank">#11360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12042" rel="external nofollow noreferrer" target="_blank">#12042</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed wrong result and potential crash when invoking function <code class="syntax">if</code> with arguments of type <code class="syntax">FixedString</code> with different sizes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11362" rel="external nofollow noreferrer" target="_blank">#11362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12021" rel="external nofollow noreferrer" target="_blank">#12021</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="improvement_14">Improvement<a class="headerlink" href="#improvement_14" title="Permanent link"> </a></h4>
<ul>
<li>Allowed to set <code class="syntax">JOIN</code> kind and type in more standard way: <code class="syntax">LEFT SEMI JOIN</code> instead of <code class="syntax">SEMI LEFT JOIN</code>. For now both are correct. <a href="https://github.com/ClickHouse/ClickHouse/pull/12520" rel="external nofollow noreferrer" target="_blank">#12520</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>lifetime_rows/lifetime_bytes for Buffer engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/12421" rel="external nofollow noreferrer" target="_blank">#12421</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Write the detail exception message to the client instead of 'MySQL server has gone away'. <a href="https://github.com/ClickHouse/ClickHouse/pull/12383" rel="external nofollow noreferrer" target="_blank">#12383</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
<li>Allows to change a charset which is used for printing grids borders. Available charsets are following: UTF-8, ASCII. Setting <code class="syntax">output_format_pretty_grid_charset</code> enables this feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12372" rel="external nofollow noreferrer" target="_blank">#12372</a> (<a href="https://github.com/s-mx" rel="external nofollow noreferrer" target="_blank">Sabyanin Maxim</a>).</li>
<li>Supported MySQL 'SELECT DATABASE()' <a href="https://github.com/ClickHouse/ClickHouse/issues/9336" rel="external nofollow noreferrer" target="_blank">#9336</a> 2. Add MySQL replacement query integration test. <a href="https://github.com/ClickHouse/ClickHouse/pull/12314" rel="external nofollow noreferrer" target="_blank">#12314</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
<li>Added <code class="syntax">KILL QUERY [connection_id]</code> for the MySQL client/driver to cancel the long query, issue <a href="https://github.com/ClickHouse/ClickHouse/issues/12038" rel="external nofollow noreferrer" target="_blank">#12038</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12152" rel="external nofollow noreferrer" target="_blank">#12152</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>).</li>
<li>Added support for <code class="syntax">%g</code> (two digit ISO year) and <code class="syntax">%G</code> (four digit ISO year) substitutions in <code class="syntax">formatDateTime</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/12136" rel="external nofollow noreferrer" target="_blank">#12136</a> (<a href="https://github.com/vivarum" rel="external nofollow noreferrer" target="_blank">vivarum</a>).</li>
<li>Added 'type' column in system.disks. <a href="https://github.com/ClickHouse/ClickHouse/pull/12115" rel="external nofollow noreferrer" target="_blank">#12115</a> (<a href="https://github.com/ianton-ru" rel="external nofollow noreferrer" target="_blank">ianton-ru</a>).</li>
<li>Improved <code class="syntax">REVOKE</code> command: now it requires grant/admin option for only access which will be revoked. For example, to execute <code class="syntax">REVOKE ALL ON *.* FROM user1</code> now it does not require to have full access rights granted with grant option. Added command <code class="syntax">REVOKE ALL FROM user1</code> - it revokes all granted roles from <code class="syntax">user1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12083" rel="external nofollow noreferrer" target="_blank">#12083</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Added replica priority for load_balancing (for manual prioritization of the load balancing). <a href="https://github.com/ClickHouse/ClickHouse/pull/11995" rel="external nofollow noreferrer" target="_blank">#11995</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Switched paths in S3 metadata to relative which allows to handle S3 blobs more easily. <a href="https://github.com/ClickHouse/ClickHouse/pull/11892" rel="external nofollow noreferrer" target="_blank">#11892</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
</ul>
<h4 id="performance-improvement_7">Performance Improvement<a class="headerlink" href="#performance-improvement_7" title="Permanent link"> </a></h4>
<ul>
<li>Improved performace of 'ORDER BY' and 'GROUP BY' by prefix of sorting key (enabled with <code class="syntax">optimize_aggregation_in_order</code> setting, disabled by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/11696" rel="external nofollow noreferrer" target="_blank">#11696</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Removed injective functions inside <code class="syntax">uniq*()</code> if <code class="syntax">set optimize_injective_functions_inside_uniq=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12337" rel="external nofollow noreferrer" target="_blank">#12337</a> (<a href="https://github.com/kamalov-ruslan" rel="external nofollow noreferrer" target="_blank">Ruslan Kamalov</a>).</li>
<li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" rel="external nofollow noreferrer" target="_blank">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" rel="external nofollow noreferrer" target="_blank">#12062</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
<li>Implemented single part uploads for DiskS3 (experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/12026" rel="external nofollow noreferrer" target="_blank">#12026</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
</ul>
<h4 id="experimental-feature_4">Experimental Feature<a class="headerlink" href="#experimental-feature_4" title="Permanent link"> </a></h4>
<ul>
<li>Added new in-memory format of parts in <code class="syntax">MergeTree</code>-family tables, which stores data in memory. Parts are written on disk at first merge. Part will be created in in-memory format if its size in rows or bytes is below thresholds <code class="syntax">min_rows_for_compact_part</code> and <code class="syntax">min_bytes_for_compact_part</code>. Also optional support of Write-Ahead-Log is available, which is enabled by default and is controlled by setting <code class="syntax">in_memory_parts_enable_wal</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10697" rel="external nofollow noreferrer" target="_blank">#10697</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_9">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_9" title="Permanent link"> </a></h4>
<ul>
<li>Implement AST-based query fuzzing mode for clickhouse-client. See <a href="https://github.com/ClickHouse/ClickHouse/issues?q=label%3Afuzz+is%3Aissue" rel="external nofollow noreferrer" target="_blank">this label</a> for the list of issues we recently found by fuzzing. Most of them were found by this tool, and a couple by SQLancer and <code class="syntax">00746_sql_fuzzy.pl</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12111" rel="external nofollow noreferrer" target="_blank">#12111</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Add new type of tests based on Testflows framework. <a href="https://github.com/ClickHouse/ClickHouse/pull/12090" rel="external nofollow noreferrer" target="_blank">#12090</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Added S3 HTTPS integration test. <a href="https://github.com/ClickHouse/ClickHouse/pull/12412" rel="external nofollow noreferrer" target="_blank">#12412</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Log sanitizer trap messages from separate thread. This will prevent possible deadlock under thread sanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/12313" rel="external nofollow noreferrer" target="_blank">#12313</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now functional and stress tests will be able to run with old version of <code class="syntax">clickhouse-test</code> script. <a href="https://github.com/ClickHouse/ClickHouse/pull/12287" rel="external nofollow noreferrer" target="_blank">#12287</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Remove strange file creation during build in <code class="syntax">orc</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12258" rel="external nofollow noreferrer" target="_blank">#12258</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Place common docker compose files to integration docker container. <a href="https://github.com/ClickHouse/ClickHouse/pull/12168" rel="external nofollow noreferrer" target="_blank">#12168</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Fix warnings from CodeQL. <code class="syntax">CodeQL</code> is another static analyzer that we will use along with <code class="syntax">clang-tidy</code> and <code class="syntax">PVS-Studio</code> that we use already. <a href="https://github.com/ClickHouse/ClickHouse/pull/12138" rel="external nofollow noreferrer" target="_blank">#12138</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Minor CMake fixes for UNBUNDLED build. <a href="https://github.com/ClickHouse/ClickHouse/pull/12131" rel="external nofollow noreferrer" target="_blank">#12131</a> (<a href="https://github.com/matwey" rel="external nofollow noreferrer" target="_blank">Matwey V. Kornilov</a>).</li>
<li>Added a showcase of the minimal Docker image without using any Linux distribution. <a href="https://github.com/ClickHouse/ClickHouse/pull/12126" rel="external nofollow noreferrer" target="_blank">#12126</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Perform an upgrade of system packages in the <code class="syntax">clickhouse-server</code> docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/12124" rel="external nofollow noreferrer" target="_blank">#12124</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
<li>Add <code class="syntax">UNBUNDLED</code> flag to <code class="syntax">system.build_options</code> table. Move skip lists for <code class="syntax">clickhouse-test</code> to clickhouse repo. <a href="https://github.com/ClickHouse/ClickHouse/pull/12107" rel="external nofollow noreferrer" target="_blank">#12107</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Regular check by <a href="https://docs.anchore.com" rel="external nofollow noreferrer" target="_blank">Anchore Container Analysis</a> security analysis tool that looks for <a href="https://cve.mitre.org/" rel="external nofollow noreferrer" target="_blank">CVE</a> in <code class="syntax">clickhouse-server</code> Docker image. Also confirms that <code class="syntax">Dockerfile</code> is buildable. Runs daily on <code class="syntax">master</code> and on pull-requests to <code class="syntax">Dockerfile</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12102" rel="external nofollow noreferrer" target="_blank">#12102</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
<li>Daily check by <a href="https://securitylab.github.com/tools/codeql" rel="external nofollow noreferrer" target="_blank">GitHub CodeQL</a> security analysis tool that looks for <a href="https://cwe.mitre.org/" rel="external nofollow noreferrer" target="_blank">CWE</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12101" rel="external nofollow noreferrer" target="_blank">#12101</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
<li>Install <code class="syntax">ca-certificates</code> before the first <code class="syntax">apt-get update</code> in Dockerfile. <a href="https://github.com/ClickHouse/ClickHouse/pull/12095" rel="external nofollow noreferrer" target="_blank">#12095</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
</ul>
<h2 id="clickhouse-release-20-5">ClickHouse release 20.5<a class="headerlink" href="#clickhouse-release-20-5" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-5-4-40-stable-2020-08-10">ClickHouse release v20.5.4.40-stable 2020-08-10<a class="headerlink" href="#clickhouse-release-v20-5-4-40-stable-2020-08-10" title="Permanent link"> </a></h3>
<h4 id="bug-fix_26">Bug Fix<a class="headerlink" href="#bug-fix_26" title="Permanent link"> </a></h4>
<ul>
<li>Fixed wrong index analysis with functions. It could lead to pruning wrong parts, while reading from <code class="syntax">MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" rel="external nofollow noreferrer" target="_blank">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" rel="external nofollow noreferrer" target="_blank">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" rel="external nofollow noreferrer" target="_blank">#13081</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" rel="external nofollow noreferrer" target="_blank">#12840</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed performance with large tuples, which are interpreted as functions in <code class="syntax">IN</code> section. The case when user write <code class="syntax">WHERE x IN tuple(1, 2, ...)</code> instead of <code class="syntax">WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" rel="external nofollow noreferrer" target="_blank">#12700</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed memory tracking for input_format_parallel_parsing (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" rel="external nofollow noreferrer" target="_blank">#12672</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bloom filter index with const expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" rel="external nofollow noreferrer" target="_blank">#10572</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" rel="external nofollow noreferrer" target="_blank">#12659</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">SIGSEGV</code> in <code class="syntax">StorageKafka</code> when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" rel="external nofollow noreferrer" target="_blank">#12658</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Added support for function <code class="syntax">if</code> with <code class="syntax">Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" rel="external nofollow noreferrer" target="_blank">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" rel="external nofollow noreferrer" target="_blank">#12648</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed lack of aliases with function <code class="syntax">any</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12593" rel="external nofollow noreferrer" target="_blank">#12593</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" rel="external nofollow noreferrer" target="_blank">#12566</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Remove data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" rel="external nofollow noreferrer" target="_blank">#12556</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bug which lead to broken old parts after <code class="syntax">ALTER DELETE</code> query when <code class="syntax">enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" rel="external nofollow noreferrer" target="_blank">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" rel="external nofollow noreferrer" target="_blank">#12543</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Better exception for function <code class="syntax">in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" rel="external nofollow noreferrer" target="_blank">#12529</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed race condition in live view tables which could cause data duplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/12519" rel="external nofollow noreferrer" target="_blank">#12519</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" rel="external nofollow noreferrer" target="_blank">#12492</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed backwards compatibility in binary format of <code class="syntax">AggregateFunction(avg, ...)</code> values. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12342" rel="external nofollow noreferrer" target="_blank">#12342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12486" rel="external nofollow noreferrer" target="_blank">#12486</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the deadlock if <code class="syntax">text_log</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" rel="external nofollow noreferrer" target="_blank">#12452</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed overflow when very large LIMIT or OFFSET is specified. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10470" rel="external nofollow noreferrer" target="_blank">#10470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11372" rel="external nofollow noreferrer" target="_blank">#11372</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12427" rel="external nofollow noreferrer" target="_blank">#12427</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed possible segfault if StorageMerge. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" rel="external nofollow noreferrer" target="_blank">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" rel="external nofollow noreferrer" target="_blank">#12401</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Reverts change introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/11079" rel="external nofollow noreferrer" target="_blank">#11079</a> to resolve <a href="https://github.com/ClickHouse/ClickHouse/issues/12098" rel="external nofollow noreferrer" target="_blank">#12098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12397" rel="external nofollow noreferrer" target="_blank">#12397</a> (<a href="https://github.com/myrrc" rel="external nofollow noreferrer" target="_blank">Mike</a>).</li>
<li>Avoid exception when negative or floating point constant is used in WHERE condition for indexed tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11905" rel="external nofollow noreferrer" target="_blank">#11905</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12384" rel="external nofollow noreferrer" target="_blank">#12384</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow to CLEAR column even if there are depending DEFAULT expressions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12333" rel="external nofollow noreferrer" target="_blank">#12333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12378" rel="external nofollow noreferrer" target="_blank">#12378</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed TOTALS/ROLLUP/CUBE for aggregate functions with <code class="syntax">-State</code> and <code class="syntax">Nullable</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12163" rel="external nofollow noreferrer" target="_blank">#12163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12376" rel="external nofollow noreferrer" target="_blank">#12376</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed SIGSEGV if there is an message with error in the middle of the batch in <code class="syntax">Kafka</code> Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/12302" rel="external nofollow noreferrer" target="_blank">#12302</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the behaviour when <code class="syntax">SummingMergeTree</code> engine sums up columns from partition key. Added an exception in case of explicit definition of columns to sum which intersects with partition key columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7867" rel="external nofollow noreferrer" target="_blank">#7867</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12173" rel="external nofollow noreferrer" target="_blank">#12173</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" rel="external nofollow noreferrer" target="_blank">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" rel="external nofollow noreferrer" target="_blank">#12151</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed bug which leads to incorrect table metadata in ZooKeepeer for ReplicatedVersionedCollapsingMergeTree tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12093" rel="external nofollow noreferrer" target="_blank">#12093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12121" rel="external nofollow noreferrer" target="_blank">#12121</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed unnecessary limiting the number of threads for selects from <code class="syntax">VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" rel="external nofollow noreferrer" target="_blank">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" rel="external nofollow noreferrer" target="_blank">#12085</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed crash in JOIN with LowCardinality type with <code class="syntax">join_algorithm=partial_merge</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12035" rel="external nofollow noreferrer" target="_blank">#12035</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed wrong result for <code class="syntax">if()</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" rel="external nofollow noreferrer" target="_blank">#11807</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
</ul>
<h4 id="performance-improvement_8">Performance Improvement<a class="headerlink" href="#performance-improvement_8" title="Permanent link"> </a></h4>
<ul>
<li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" rel="external nofollow noreferrer" target="_blank">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" rel="external nofollow noreferrer" target="_blank">#12062</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_10">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_10" title="Permanent link"> </a></h4>
<ul>
<li>Install <code class="syntax">ca-certificates</code> before the first <code class="syntax">apt-get update</code> in Dockerfile. <a href="https://github.com/ClickHouse/ClickHouse/pull/12095" rel="external nofollow noreferrer" target="_blank">#12095</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-5-2-7-stable-2020-07-02">ClickHouse release v20.5.2.7-stable 2020-07-02<a class="headerlink" href="#clickhouse-release-v20-5-2-7-stable-2020-07-02" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_7">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_7" title="Permanent link"> </a></h4>
<ul>
<li>Return non-Nullable result from COUNT(DISTINCT), and <code class="syntax">uniq</code> aggregate functions family. If all passed values are NULL, return zero instead. This improves SQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/11661" rel="external nofollow noreferrer" target="_blank">#11661</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added a check for the case when user-level setting is specified in a wrong place. User-level settings should be specified in <code class="syntax">users.xml</code> inside <code class="syntax">&lt;profile&gt;</code> section for specific user profile (or in <code class="syntax">&lt;default&gt;</code> for default settings). The server won't start with exception message in log. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9051" rel="external nofollow noreferrer" target="_blank">#9051</a>. If you want to skip the check, you can either move settings to the appropriate place or add <code class="syntax">&lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt;</code> to config.xml. <a href="https://github.com/ClickHouse/ClickHouse/pull/11449" rel="external nofollow noreferrer" target="_blank">#11449</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>The setting <code class="syntax">input_format_with_names_use_header</code> is enabled by default. It will affect parsing of input formats <code class="syntax">-WithNames</code> and <code class="syntax">-WithNamesAndTypes</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10937" rel="external nofollow noreferrer" target="_blank">#10937</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove <code class="syntax">experimental_use_processors</code> setting. It is enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/10924" rel="external nofollow noreferrer" target="_blank">#10924</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Update <code class="syntax">zstd</code> to 1.4.4. It has some minor improvements in performance and compression ratio. If you run replicas with different versions of ClickHouse you may see reasonable error messages <code class="syntax">Data after merge is not byte-identical to data on another replicas.</code> with explanation. These messages are Ok and you should not worry. This change is backward compatible but we list it here in changelog in case you will wonder about these messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/10663" rel="external nofollow noreferrer" target="_blank">#10663</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added a check for meaningless codecs and a setting <code class="syntax">allow_suspicious_codecs</code> to control this check. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/4966" rel="external nofollow noreferrer" target="_blank">#4966</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10645" rel="external nofollow noreferrer" target="_blank">#10645</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Several Kafka setting changes their defaults. See <a href="https://github.com/ClickHouse/ClickHouse/pull/11388" rel="external nofollow noreferrer" target="_blank">#11388</a>.</li>
<li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code class="syntax">Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li>
</ul>
<h4 id="new-feature_7">New Feature<a class="headerlink" href="#new-feature_7" title="Permanent link"> </a></h4>
<ul>
<li><code class="syntax">TTL DELETE WHERE</code> and <code class="syntax">TTL GROUP BY</code> for automatic data coarsening and rollup in tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10537" rel="external nofollow noreferrer" target="_blank">#10537</a> (<a href="https://github.com/expl0si0nn" rel="external nofollow noreferrer" target="_blank">expl0si0nn</a>).</li>
<li>Implementation of PostgreSQL wire protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/10242" rel="external nofollow noreferrer" target="_blank">#10242</a> (<a href="https://github.com/MovElb" rel="external nofollow noreferrer" target="_blank">Movses</a>).</li>
<li>Added system tables for users, roles, grants, settings profiles, quotas, row policies; added commands SHOW USER, SHOW [CURRENT|ENABLED] ROLES, SHOW SETTINGS PROFILES. <a href="https://github.com/ClickHouse/ClickHouse/pull/10387" rel="external nofollow noreferrer" target="_blank">#10387</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Support writes in ODBC Table function <a href="https://github.com/ClickHouse/ClickHouse/pull/10554" rel="external nofollow noreferrer" target="_blank">#10554</a> (<a href="https://github.com/ageraab" rel="external nofollow noreferrer" target="_blank">ageraab</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10901" rel="external nofollow noreferrer" target="_blank">#10901</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Add query performance metrics based on Linux <code class="syntax">perf_events</code> (these metrics are calculated with hardware CPU counters and OS counters). It is optional and requires <code class="syntax">CAP_SYS_ADMIN</code> to be set on clickhouse binary. <a href="https://github.com/ClickHouse/ClickHouse/pull/9545" rel="external nofollow noreferrer" target="_blank">#9545</a> <a href="https://github.com/And42" rel="external nofollow noreferrer" target="_blank">Andrey Skobtsov</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11226" rel="external nofollow noreferrer" target="_blank">#11226</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Now support <code class="syntax">NULL</code> and <code class="syntax">NOT NULL</code> modifiers for data types in <code class="syntax">CREATE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11057" rel="external nofollow noreferrer" target="_blank">#11057</a> (<a href="https://github.com/Potya" rel="external nofollow noreferrer" target="_blank">Павел Потемкин</a>).</li>
<li>Add <code class="syntax">ArrowStream</code> input and output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11088" rel="external nofollow noreferrer" target="_blank">#11088</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Support Cassandra as external dictionary source. <a href="https://github.com/ClickHouse/ClickHouse/pull/4978" rel="external nofollow noreferrer" target="_blank">#4978</a> (<a href="https://github.com/favstovol" rel="external nofollow noreferrer" target="_blank">favstovol</a>).</li>
<li>Added a new layout <code class="syntax">direct</code> which loads all the data directly from the source for each query, without storing or caching data. <a href="https://github.com/ClickHouse/ClickHouse/pull/10622" rel="external nofollow noreferrer" target="_blank">#10622</a> (<a href="https://github.com/kekekekule" rel="external nofollow noreferrer" target="_blank">Artem Streltsov</a>).</li>
<li>Added new <code class="syntax">complex_key_direct</code> layout to dictionaries, that does not store anything locally during query execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/10850" rel="external nofollow noreferrer" target="_blank">#10850</a> (<a href="https://github.com/kekekekule" rel="external nofollow noreferrer" target="_blank">Artem Streltsov</a>).</li>
<li>Added support for MySQL style global variables syntax (stub). This is needed for compatibility of MySQL protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/11832" rel="external nofollow noreferrer" target="_blank">#11832</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added syntax highligting to <code class="syntax">clickhouse-client</code> using <code class="syntax">replxx</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11422" rel="external nofollow noreferrer" target="_blank">#11422</a> (<a href="https://github.com/kuskarov" rel="external nofollow noreferrer" target="_blank">Tagir Kuskarov</a>).</li>
<li><code class="syntax">minMap</code> and <code class="syntax">maxMap</code> functions were added. <a href="https://github.com/ClickHouse/ClickHouse/pull/11603" rel="external nofollow noreferrer" target="_blank">#11603</a> (<a href="https://github.com/ildus" rel="external nofollow noreferrer" target="_blank">Ildus Kurbangaliev</a>).</li>
<li>Add the <code class="syntax">system.asynchronous_metric_log</code> table that logs historical metrics from <code class="syntax">system.asynchronous_metrics</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11588" rel="external nofollow noreferrer" target="_blank">#11588</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Add functions <code class="syntax">extractAllGroupsHorizontal(haystack, re)</code> and <code class="syntax">extractAllGroupsVertical(haystack, re)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11554" rel="external nofollow noreferrer" target="_blank">#11554</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Add SHOW CLUSTER(S) queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11467" rel="external nofollow noreferrer" target="_blank">#11467</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Add <code class="syntax">netloc</code> function for extracting network location, similar to <code class="syntax">urlparse(url)</code>, <code class="syntax">netloc</code> in python. <a href="https://github.com/ClickHouse/ClickHouse/pull/11356" rel="external nofollow noreferrer" target="_blank">#11356</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>).</li>
<li>Add 2 more virtual columns for engine=Kafka to access message headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11283" rel="external nofollow noreferrer" target="_blank">#11283</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Add <code class="syntax">_timestamp_ms</code> virtual column for Kafka engine (type is <code class="syntax">Nullable(DateTime64(3))</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11260" rel="external nofollow noreferrer" target="_blank">#11260</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Add function <code class="syntax">randomFixedString</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10866" rel="external nofollow noreferrer" target="_blank">#10866</a> (<a href="https://github.com/xolm" rel="external nofollow noreferrer" target="_blank">Andrei Nekrashevich</a>).</li>
<li>Add function <code class="syntax">fuzzBits</code> that randomly flips bits in a string with given probability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11237" rel="external nofollow noreferrer" target="_blank">#11237</a> (<a href="https://github.com/xolm" rel="external nofollow noreferrer" target="_blank">Andrei Nekrashevich</a>).</li>
<li>Allow comparison of numbers with constant string in comparison operators, IN and VALUES sections. <a href="https://github.com/ClickHouse/ClickHouse/pull/11647" rel="external nofollow noreferrer" target="_blank">#11647</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add <code class="syntax">round_robin</code> load_balancing mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/11645" rel="external nofollow noreferrer" target="_blank">#11645</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add <code class="syntax">cast_keep_nullable</code> setting. If set <code class="syntax">CAST(something_nullable AS Type)</code> return <code class="syntax">Nullable(Type)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11733" rel="external nofollow noreferrer" target="_blank">#11733</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Added column <code class="syntax">position</code> to <code class="syntax">system.columns</code> table and <code class="syntax">column_position</code> to <code class="syntax">system.parts_columns</code> table. It contains ordinal position of a column in a table starting with 1. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7744" rel="external nofollow noreferrer" target="_blank">#7744</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11655" rel="external nofollow noreferrer" target="_blank">#11655</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>ON CLUSTER support for SYSTEM {FLUSH DISTRIBUTED,STOP/START DISTRIBUTED SEND}. <a href="https://github.com/ClickHouse/ClickHouse/pull/11415" rel="external nofollow noreferrer" target="_blank">#11415</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Add system.distribution_queue table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11394" rel="external nofollow noreferrer" target="_blank">#11394</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Support for all format settings in Kafka, expose some setting on table level, adjust the defaults for better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/11388" rel="external nofollow noreferrer" target="_blank">#11388</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Add <code class="syntax">port</code> function (to extract port from URL). <a href="https://github.com/ClickHouse/ClickHouse/pull/11120" rel="external nofollow noreferrer" target="_blank">#11120</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Now <code class="syntax">dictGet*</code> functions accept table names. <a href="https://github.com/ClickHouse/ClickHouse/pull/11050" rel="external nofollow noreferrer" target="_blank">#11050</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>The <code class="syntax">clickhouse-format</code> tool is now able to format multiple queries when the <code class="syntax">-n</code> argument is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/10852" rel="external nofollow noreferrer" target="_blank">#10852</a> (<a href="https://github.com/dgrr" rel="external nofollow noreferrer" target="_blank">Darío</a>).</li>
<li>Possibility to configure proxy-resolver for DiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/10744" rel="external nofollow noreferrer" target="_blank">#10744</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Make <code class="syntax">pointInPolygon</code> work with non-constant polygon. PointInPolygon now can take Array(Array(Tuple(..., ...))) as second argument, array of polygon and holes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10623" rel="external nofollow noreferrer" target="_blank">#10623</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" rel="external nofollow noreferrer" target="_blank">#11421</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>).</li>
<li>Added <code class="syntax">move_ttl_info</code> to <code class="syntax">system.parts</code> in order to provide introspection of move TTL functionality. <a href="https://github.com/ClickHouse/ClickHouse/pull/10591" rel="external nofollow noreferrer" target="_blank">#10591</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Possibility to work with S3 through proxies. <a href="https://github.com/ClickHouse/ClickHouse/pull/10576" rel="external nofollow noreferrer" target="_blank">#10576</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Add <code class="syntax">NCHAR</code> and <code class="syntax">NVARCHAR</code> synonims for data types. <a href="https://github.com/ClickHouse/ClickHouse/pull/11025" rel="external nofollow noreferrer" target="_blank">#11025</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Resolved <a href="https://github.com/ClickHouse/ClickHouse/issues/7224" rel="external nofollow noreferrer" target="_blank">#7224</a>: added <code class="syntax">FailedQuery</code>, <code class="syntax">FailedSelectQuery</code> and <code class="syntax">FailedInsertQuery</code> metrics to <code class="syntax">system.events</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11151" rel="external nofollow noreferrer" target="_blank">#11151</a> (<a href="https://github.com/naorlov" rel="external nofollow noreferrer" target="_blank">Nikita Orlov</a>).</li>
<li>Add more <code class="syntax">jemalloc</code> statistics to <code class="syntax">system.asynchronous_metrics</code>, and ensure that we see up-to-date values for them. <a href="https://github.com/ClickHouse/ClickHouse/pull/11748" rel="external nofollow noreferrer" target="_blank">#11748</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Allow to specify default S3 credentials and custom auth headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11134" rel="external nofollow noreferrer" target="_blank">#11134</a> (<a href="https://github.com/GrigoryPervakov" rel="external nofollow noreferrer" target="_blank">Grigory Pervakov</a>).</li>
<li>Added new functions to import/export DateTime64 as Int64 with various precision: <code class="syntax">to-/fromUnixTimestamp64Milli/-Micro/-Nano</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10923" rel="external nofollow noreferrer" target="_blank">#10923</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Allow specifying <code class="syntax">mongodb://</code> URI for MongoDB dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/10915" rel="external nofollow noreferrer" target="_blank">#10915</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>OFFSET keyword can now be used without an affiliated LIMIT clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/10802" rel="external nofollow noreferrer" target="_blank">#10802</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>).</li>
<li>Added <code class="syntax">system.licenses</code> table. This table contains licenses of third-party libraries that are located in <code class="syntax">contrib</code> directory. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2890" rel="external nofollow noreferrer" target="_blank">#2890</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10795" rel="external nofollow noreferrer" target="_blank">#10795</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>New function function toStartOfSecond(DateTime64) -&gt; DateTime64 that nullifies sub-second part of DateTime64 value. <a href="https://github.com/ClickHouse/ClickHouse/pull/10722" rel="external nofollow noreferrer" target="_blank">#10722</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Add new input format <code class="syntax">JSONAsString</code> that accepts a sequence of JSON objects separated by newlines, spaces and/or commas. <a href="https://github.com/ClickHouse/ClickHouse/pull/10607" rel="external nofollow noreferrer" target="_blank">#10607</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>).</li>
<li>Allowed to profile memory with finer granularity steps than 4 MiB. Added sampling memory profiler to capture random allocations/deallocations. <a href="https://github.com/ClickHouse/ClickHouse/pull/10598" rel="external nofollow noreferrer" target="_blank">#10598</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li><code class="syntax">SimpleAggregateFunction</code> now also supports <code class="syntax">sumMap</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10000" rel="external nofollow noreferrer" target="_blank">#10000</a> (<a href="https://github.com/ildus" rel="external nofollow noreferrer" target="_blank">Ildus Kurbangaliev</a>).</li>
<li>Support <code class="syntax">ALTER RENAME COLUMN</code> for the distributed table engine. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/10727" rel="external nofollow noreferrer" target="_blank">#10727</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10747" rel="external nofollow noreferrer" target="_blank">#10747</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10887" rel="external nofollow noreferrer" target="_blank">#10887</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h4 id="bug-fix_27">Bug Fix<a class="headerlink" href="#bug-fix_27" title="Permanent link"> </a></h4>
<ul>
<li>Fix UBSan report in Decimal parse. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7540" rel="external nofollow noreferrer" target="_blank">#7540</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10512" rel="external nofollow noreferrer" target="_blank">#10512</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential floating point exception when parsing DateTime64. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11374" rel="external nofollow noreferrer" target="_blank">#11374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11875" rel="external nofollow noreferrer" target="_blank">#11875</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11895" rel="external nofollow noreferrer" target="_blank">#11895</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" rel="external nofollow noreferrer" target="_blank">#11608</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" rel="external nofollow noreferrer" target="_blank">#11869</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" rel="external nofollow noreferrer" target="_blank">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" rel="external nofollow noreferrer" target="_blank">#11846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix wrong result of comparison of FixedString with constant String. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11393" rel="external nofollow noreferrer" target="_blank">#11393</a>. This bug appeared in version 20.4. <a href="https://github.com/ClickHouse/ClickHouse/pull/11828" rel="external nofollow noreferrer" target="_blank">#11828</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix wrong result for <code class="syntax">if</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" rel="external nofollow noreferrer" target="_blank">#11807</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix using too many threads for queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11788" rel="external nofollow noreferrer" target="_blank">#11788</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed <code class="syntax">Scalar does not exist</code> exception when using <code class="syntax">WITH &lt;scalar subquery&gt; ...</code> in <code class="syntax">SELECT ... FROM merge_tree_table ...</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/11621" rel="external nofollow noreferrer" target="_blank">#11621</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11767" rel="external nofollow noreferrer" target="_blank">#11767</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix unexpected behaviour of queries like <code class="syntax">SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" rel="external nofollow noreferrer" target="_blank">#11753</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Now replicated fetches will be cancelled during metadata alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11744" rel="external nofollow noreferrer" target="_blank">#11744</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Parse metadata stored in zookeeper before checking for equality. <a href="https://github.com/ClickHouse/ClickHouse/pull/11739" rel="external nofollow noreferrer" target="_blank">#11739</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" rel="external nofollow noreferrer" target="_blank">#11732</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix <code class="syntax">ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" rel="external nofollow noreferrer" target="_blank">#11697</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix very rare race condition in SYSTEM SYNC REPLICA. If the replicated table is created and at the same time from the separate connection another client is issuing <code class="syntax">SYSTEM SYNC REPLICA</code> command on that table (this is unlikely, because another client should be aware that the table is created), it's possible to get nullptr dereference. <a href="https://github.com/ClickHouse/ClickHouse/pull/11691" rel="external nofollow noreferrer" target="_blank">#11691</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" rel="external nofollow noreferrer" target="_blank">#11690</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">LIMIT n WITH TIES</code> usage together with <code class="syntax">ORDER BY</code> statement, which contains aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11689" rel="external nofollow noreferrer" target="_blank">#11689</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> for selects with parallel <code class="syntax">FINAL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11636" rel="external nofollow noreferrer" target="_blank">#11636</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11682" rel="external nofollow noreferrer" target="_blank">#11682</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix error which leads to an incorrect state of <code class="syntax">system.mutations</code>. It may show that whole mutation is already done but the server still has <code class="syntax">MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11611" rel="external nofollow noreferrer" target="_blank">#11611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11681" rel="external nofollow noreferrer" target="_blank">#11681</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix syntax hilite in CREATE USER query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11664" rel="external nofollow noreferrer" target="_blank">#11664</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" rel="external nofollow noreferrer" target="_blank">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" rel="external nofollow noreferrer" target="_blank">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" rel="external nofollow noreferrer" target="_blank">#11649</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11352" rel="external nofollow noreferrer" target="_blank">#11352</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11644" rel="external nofollow noreferrer" target="_blank">#11644</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" rel="external nofollow noreferrer" target="_blank">#11638</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Without <code class="syntax">-q</code> option the database does not get created at startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/11604" rel="external nofollow noreferrer" target="_blank">#11604</a> (<a href="https://github.com/giordyb" rel="external nofollow noreferrer" target="_blank">giordyb</a>).</li>
<li>Fix error <code class="syntax">Block structure mismatch</code> for queries with sampling reading from <code class="syntax">Buffer</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11602" rel="external nofollow noreferrer" target="_blank">#11602</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix wrong exit code of the clickhouse-client, when <code class="syntax">exception.code() % 256 == 0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" rel="external nofollow noreferrer" target="_blank">#11601</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix race conditions in CREATE/DROP of different replicas of ReplicatedMergeTree. Continue to work if the table was not removed completely from ZooKeeper or not created successfully. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11432" rel="external nofollow noreferrer" target="_blank">#11432</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11592" rel="external nofollow noreferrer" target="_blank">#11592</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" rel="external nofollow noreferrer" target="_blank">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" rel="external nofollow noreferrer" target="_blank">#11589</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix error <code class="syntax">Size of offsets does not match size of column</code> for queries with <code class="syntax">PREWHERE column in (subquery)</code> and <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" rel="external nofollow noreferrer" target="_blank">#11580</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed rare segfault in <code class="syntax">SHOW CREATE TABLE</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11490" rel="external nofollow noreferrer" target="_blank">#11490</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11579" rel="external nofollow noreferrer" target="_blank">#11579</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>All queries in HTTP session have had the same query_id. It is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/11578" rel="external nofollow noreferrer" target="_blank">#11578</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" rel="external nofollow noreferrer" target="_blank">#11550</a> (<a href="https://github.com/istarkov" rel="external nofollow noreferrer" target="_blank">Ivan Starkov</a>).</li>
<li>Fix the error <code class="syntax">Data compressed with different methods</code> that can happen if <code class="syntax">min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" rel="external nofollow noreferrer" target="_blank">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" rel="external nofollow noreferrer" target="_blank">#11540</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix shard_num/replica_num for <code class="syntax">&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href="https://github.com/ClickHouse/ClickHouse/pull/11528" rel="external nofollow noreferrer" target="_blank">#11528</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix async INSERT into Distributed for prefer_localhost_replica=0 and w/o internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/11527" rel="external nofollow noreferrer" target="_blank">#11527</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix memory leak when exception is thrown in the middle of aggregation with <code class="syntax">-State</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" rel="external nofollow noreferrer" target="_blank">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" rel="external nofollow noreferrer" target="_blank">#11496</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">Pipeline stuck</code> exception for <code class="syntax">INSERT SELECT FINAL</code> where <code class="syntax">SELECT</code> (<code class="syntax">max_threads</code>&gt;1) has multiple streams but <code class="syntax">INSERT</code> has only one (<code class="syntax">max_insert_threads</code>==0). <a href="https://github.com/ClickHouse/ClickHouse/pull/11455" rel="external nofollow noreferrer" target="_blank">#11455</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix wrong result in queries like <code class="syntax">select count() from t, u</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11454" rel="external nofollow noreferrer" target="_blank">#11454</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" rel="external nofollow noreferrer" target="_blank">#11448</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" rel="external nofollow noreferrer" target="_blank">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" rel="external nofollow noreferrer" target="_blank">#11431</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix potential uninitialized memory read in MergeTree shutdown if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/11420" rel="external nofollow noreferrer" target="_blank">#11420</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash in JOIN over <code class="syntax">LowCarinality(T)</code> and <code class="syntax">Nullable(T)</code>. <a href="https://github.com/ClickHouse/ClickHouse/issues/11380" rel="external nofollow noreferrer" target="_blank">#11380</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11414" rel="external nofollow noreferrer" target="_blank">#11414</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix error code for wrong <code class="syntax">USING</code> key. <a href="https://github.com/ClickHouse/ClickHouse/issues/11373" rel="external nofollow noreferrer" target="_blank">#11373</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11404" rel="external nofollow noreferrer" target="_blank">#11404</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed <code class="syntax">geohashesInBox</code> with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" rel="external nofollow noreferrer" target="_blank">#11403</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Better errors for <code class="syntax">joinGet()</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/11389" rel="external nofollow noreferrer" target="_blank">#11389</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" rel="external nofollow noreferrer" target="_blank">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" rel="external nofollow noreferrer" target="_blank">#11366</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/11354" rel="external nofollow noreferrer" target="_blank">#11354</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix support for <code class="syntax">\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9933" rel="external nofollow noreferrer" target="_blank">#9933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11350" rel="external nofollow noreferrer" target="_blank">#11350</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential segfault when using <code class="syntax">Lazy</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/11348" rel="external nofollow noreferrer" target="_blank">#11348</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash in direct selects from <code class="syntax">Join</code> table engine (without JOIN) and wrong nullability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11340" rel="external nofollow noreferrer" target="_blank">#11340</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix crash in <code class="syntax">quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" rel="external nofollow noreferrer" target="_blank">#11337</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Now merges stopped before change metadata in <code class="syntax">ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11335" rel="external nofollow noreferrer" target="_blank">#11335</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Make writing to <code class="syntax">MATERIALIZED VIEW</code> with setting <code class="syntax">parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" rel="external nofollow noreferrer" target="_blank">#11330</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix <code class="syntax">visitParamExtractRaw</code> when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" rel="external nofollow noreferrer" target="_blank">#11318</a> (<a href="https://github.com/devwout" rel="external nofollow noreferrer" target="_blank">Ewout</a>).</li>
<li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" rel="external nofollow noreferrer" target="_blank">#11314</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix insignificant data race in <code class="syntax">clickhouse-copier</code>. Found by integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11313" rel="external nofollow noreferrer" target="_blank">#11313</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential uninitialized memory in conversion. Example: <code class="syntax">SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" rel="external nofollow noreferrer" target="_blank">#11311</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class="syntax">empty</code> or <code class="syntax">notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" rel="external nofollow noreferrer" target="_blank">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" rel="external nofollow noreferrer" target="_blank">#11303</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bug when query speed estimation can be incorrect and the limit of <code class="syntax">min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class="syntax">max_network_bandwidth</code>, <code class="syntax">max_execution_speed</code> or <code class="syntax">priority</code> settings. Change the default value of <code class="syntax">timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class="syntax">min_execution_speed</code> and <code class="syntax">max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" rel="external nofollow noreferrer" target="_blank">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" rel="external nofollow noreferrer" target="_blank">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" rel="external nofollow noreferrer" target="_blank">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class="syntax">clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" rel="external nofollow noreferrer" target="_blank">#11296</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash when <code class="syntax">SET DEFAULT ROLE</code> is called with wrong arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10586" rel="external nofollow noreferrer" target="_blank">#10586</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11278" rel="external nofollow noreferrer" target="_blank">#11278</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix crash while reading malformed data in <code class="syntax">Protobuf</code> format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" rel="external nofollow noreferrer" target="_blank">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" rel="external nofollow noreferrer" target="_blank">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" rel="external nofollow noreferrer" target="_blank">#11258</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed a bug when <code class="syntax">cache</code> dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/11233" rel="external nofollow noreferrer" target="_blank">#11233</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix error <code class="syntax">Block structure mismatch in QueryPipeline</code> while reading from <code class="syntax">VIEW</code> with constants in inner query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11181" rel="external nofollow noreferrer" target="_blank">#11181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11205" rel="external nofollow noreferrer" target="_blank">#11205</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible exception <code class="syntax">Invalid status for associated output</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11200" rel="external nofollow noreferrer" target="_blank">#11200</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Now <code class="syntax">primary.idx</code> will be checked if it's defined in <code class="syntax">CREATE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11199" rel="external nofollow noreferrer" target="_blank">#11199</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix possible error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" rel="external nofollow noreferrer" target="_blank">#11185</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed <code class="syntax">S3</code> globbing which could fail in case of more than 1000 keys and some backends. <a href="https://github.com/ClickHouse/ClickHouse/pull/11179" rel="external nofollow noreferrer" target="_blank">#11179</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" rel="external nofollow noreferrer" target="_blank">#11162</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/11145" rel="external nofollow noreferrer" target="_blank">#11145</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href="https://github.com/ClickHouse/ClickHouse/pull/11114" rel="external nofollow noreferrer" target="_blank">#11114</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Remove logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" rel="external nofollow noreferrer" target="_blank">#11109</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed deadlock during server startup after update with changes in structure of system log tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/11106" rel="external nofollow noreferrer" target="_blank">#11106</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed memory leak in registerDiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/11074" rel="external nofollow noreferrer" target="_blank">#11074</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fix error <code class="syntax">No such name in Block::erase()</code> when JOIN appears with PREWHERE or <code class="syntax">optimize_move_to_prewhere</code> makes PREWHERE from WHERE. <a href="https://github.com/ClickHouse/ClickHouse/pull/11051" rel="external nofollow noreferrer" target="_blank">#11051</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixes the potential missed data during termination of Kafka engine table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11048" rel="external nofollow noreferrer" target="_blank">#11048</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed parseDateTime64BestEffort argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/issues/10925" rel="external nofollow noreferrer" target="_blank">#10925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" rel="external nofollow noreferrer" target="_blank">#11038</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Now it's possible to <code class="syntax">ADD/DROP</code> and <code class="syntax">RENAME</code> the same one column in a single <code class="syntax">ALTER</code> query. Exception message for simultaneous <code class="syntax">MODIFY</code> and <code class="syntax">RENAME</code> became more clear. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10669" rel="external nofollow noreferrer" target="_blank">#10669</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11037" rel="external nofollow noreferrer" target="_blank">#11037</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed parsing of S3 URLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11036" rel="external nofollow noreferrer" target="_blank">#11036</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fix memory tracking for two-level <code class="syntax">GROUP BY</code> when there is a <code class="syntax">LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11022" rel="external nofollow noreferrer" target="_blank">#11022</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix very rare potential use-after-free error in MergeTree if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/10986" rel="external nofollow noreferrer" target="_blank">#10986</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix metadata (relative path for rename) and data (relative path for symlink) handling for Atomic database. <a href="https://github.com/ClickHouse/ClickHouse/pull/10980" rel="external nofollow noreferrer" target="_blank">#10980</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix server crash on concurrent <code class="syntax">ALTER</code> and <code class="syntax">DROP DATABASE</code> queries with <code class="syntax">Atomic</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10968" rel="external nofollow noreferrer" target="_blank">#10968</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix incorrect raw data size in method getRawData(). <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" rel="external nofollow noreferrer" target="_blank">#10964</a> (<a href="https://github.com/ObjatieGroba" rel="external nofollow noreferrer" target="_blank">Igr</a>).</li>
<li>Fix incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" rel="external nofollow noreferrer" target="_blank">#10952</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Avoid sending partially written files by the DistributedBlockOutputStream. <a href="https://github.com/ClickHouse/ClickHouse/pull/10940" rel="external nofollow noreferrer" target="_blank">#10940</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix crash in <code class="syntax">SELECT count(notNullIn(NULL, []))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10920" rel="external nofollow noreferrer" target="_blank">#10920</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/10910" rel="external nofollow noreferrer" target="_blank">#10910</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Now it's possible to execute multiple <code class="syntax">ALTER RENAME</code> like <code class="syntax">a TO b, c TO a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10895" rel="external nofollow noreferrer" target="_blank">#10895</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix possible race which could happen when you get result from aggregate function state from multiple thread for the same column. The only way (which I found) it can happen is when you use <code class="syntax">finalizeAggregation</code> function while reading from table with <code class="syntax">Memory</code> engine which stores <code class="syntax">AggregateFunction</code> state for <code class="syntax">quanite*</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/10890" rel="external nofollow noreferrer" target="_blank">#10890</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix backward compatibility with tuples in Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" rel="external nofollow noreferrer" target="_blank">#10889</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix SIGSEGV in StringHashTable (if such key does not exist). <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" rel="external nofollow noreferrer" target="_blank">#10870</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">WATCH</code> hangs after <code class="syntax">LiveView</code> table was dropped from database with <code class="syntax">Atomic</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10859" rel="external nofollow noreferrer" target="_blank">#10859</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed bug in <code class="syntax">ReplicatedMergeTree</code> which might cause some <code class="syntax">ALTER</code> on <code class="syntax">OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" rel="external nofollow noreferrer" target="_blank">#10849</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now constraints are updated if the column participating in <code class="syntax">CONSTRAINT</code> expression was renamed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10844" rel="external nofollow noreferrer" target="_blank">#10844</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10847" rel="external nofollow noreferrer" target="_blank">#10847</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix potential read of uninitialized memory in cache dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/10834" rel="external nofollow noreferrer" target="_blank">#10834</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix columns order after Block::sortColumns() (also add a test that shows that it affects some real use case - Buffer engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" rel="external nofollow noreferrer" target="_blank">#10826</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix the issue with ODBC bridge when no quoting of identifiers is requested. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" rel="external nofollow noreferrer" target="_blank">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" rel="external nofollow noreferrer" target="_blank">#10821</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan and MSan report in DateLUT. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" rel="external nofollow noreferrer" target="_blank">#10798</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Make use of <code class="syntax">src_type</code> for correct type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" rel="external nofollow noreferrer" target="_blank">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" rel="external nofollow noreferrer" target="_blank">#10791</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>).</li>
<li>Get rid of old libunwind patches. <a href="https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012" target="_blank">https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> This allows to disable <code class="syntax">-fno-omit-frame-pointer</code> in <code class="syntax">clang</code> builds that improves performance at least by 1% in average. <a href="https://github.com/ClickHouse/ClickHouse/pull/10761" rel="external nofollow noreferrer" target="_blank">#10761</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix avgWeighted when using floating-point weight over multiple shards. <a href="https://github.com/ClickHouse/ClickHouse/pull/10758" rel="external nofollow noreferrer" target="_blank">#10758</a> (<a href="https://github.com/bgiard" rel="external nofollow noreferrer" target="_blank">Baudouin Giard</a>).</li>
<li>Fix <code class="syntax">parallel_view_processing</code> behavior. Now all insertions into <code class="syntax">MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" rel="external nofollow noreferrer" target="_blank">#10757</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix combinator -OrNull and -OrDefault when combined with -State. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" rel="external nofollow noreferrer" target="_blank">#10741</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fix crash in <code class="syntax">generateRandom</code> with nested types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10583" rel="external nofollow noreferrer" target="_blank">#10583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10734" rel="external nofollow noreferrer" target="_blank">#10734</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix data corruption for <code class="syntax">LowCardinality(FixedString)</code> key column in <code class="syntax">SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" rel="external nofollow noreferrer" target="_blank">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" rel="external nofollow noreferrer" target="_blank">#10721</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix usage of primary key wrapped into a function with 'FINAL' modifier and 'ORDER BY' optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10715" rel="external nofollow noreferrer" target="_blank">#10715</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix possible buffer overflow in function <code class="syntax">h3EdgeAngle</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10711" rel="external nofollow noreferrer" target="_blank">#10711</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" rel="external nofollow noreferrer" target="_blank">#10674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" rel="external nofollow noreferrer" target="_blank">#10698</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix atomicity of HTTP insert. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9666" rel="external nofollow noreferrer" target="_blank">#9666</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10687" rel="external nofollow noreferrer" target="_blank">#10687</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>).</li>
<li>Fix multiple usages of <code class="syntax">IN</code> operator with the identical set in one query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" rel="external nofollow noreferrer" target="_blank">#10686</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed bug, which causes http requests stuck on client close when <code class="syntax">readonly=2</code> and <code class="syntax">cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7939" rel="external nofollow noreferrer" target="_blank">#7939</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7019" rel="external nofollow noreferrer" target="_blank">#7019</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7736" rel="external nofollow noreferrer" target="_blank">#7736</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7091" rel="external nofollow noreferrer" target="_blank">#7091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" rel="external nofollow noreferrer" target="_blank">#10684</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix order of parameters in AggregateTransform constructor. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" rel="external nofollow noreferrer" target="_blank">#10667</a> (<a href="https://github.com/palasonic1" rel="external nofollow noreferrer" target="_blank">palasonic1</a>).</li>
<li>Fix the lack of parallel execution of remote queries with <code class="syntax">distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" rel="external nofollow noreferrer" target="_blank">#10655</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" rel="external nofollow noreferrer" target="_blank">#10664</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible incorrect number of rows for queries with <code class="syntax">LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10566" rel="external nofollow noreferrer" target="_blank">#10566</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10709" rel="external nofollow noreferrer" target="_blank">#10709</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10660" rel="external nofollow noreferrer" target="_blank">#10660</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix bug which locks concurrent alters when table has a lot of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10659" rel="external nofollow noreferrer" target="_blank">#10659</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix nullptr dereference in StorageBuffer if server was shutdown before table startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/10641" rel="external nofollow noreferrer" target="_blank">#10641</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix predicates optimization for distributed queries (<code class="syntax">enable_optimize_predicate_expression=1</code>) for queries with <code class="syntax">HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" rel="external nofollow noreferrer" target="_blank">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" rel="external nofollow noreferrer" target="_blank">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" rel="external nofollow noreferrer" target="_blank">#10621</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix optimize_skip_unused_shards with LowCardinality. <a href="https://github.com/ClickHouse/ClickHouse/pull/10611" rel="external nofollow noreferrer" target="_blank">#10611</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix segfault in StorageBuffer when exception on server startup. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10550" rel="external nofollow noreferrer" target="_blank">#10550</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10609" rel="external nofollow noreferrer" target="_blank">#10609</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>On <code class="syntax">SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" rel="external nofollow noreferrer" target="_blank">#10608</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed incorrect scalar results inside inner query of <code class="syntax">MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" rel="external nofollow noreferrer" target="_blank">#10603</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed handling condition variable for synchronous mutations. In some cases signals to that condition variable could be lost. <a href="https://github.com/ClickHouse/ClickHouse/pull/10588" rel="external nofollow noreferrer" target="_blank">#10588</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fixes possible crash <code class="syntax">createDictionary()</code> is called before <code class="syntax">loadStoredObject()</code> has finished. <a href="https://github.com/ClickHouse/ClickHouse/pull/10587" rel="external nofollow noreferrer" target="_blank">#10587</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix error <code class="syntax">the BloomFilter false positive must be a double number between 0 and 1</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" rel="external nofollow noreferrer" target="_blank">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" rel="external nofollow noreferrer" target="_blank">#10569</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix SELECT of column ALIAS which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" rel="external nofollow noreferrer" target="_blank">#10563</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Implemented comparison between DateTime64 and String values (just like for DateTime). <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" rel="external nofollow noreferrer" target="_blank">#10560</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fix index corruption, which may occur in some cases after merge compact parts into another compact part. <a href="https://github.com/ClickHouse/ClickHouse/pull/10531" rel="external nofollow noreferrer" target="_blank">#10531</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Disable GROUP BY sharding_key optimization by default (<code class="syntax">optimize_distributed_group_by_sharding_key</code> had been introduced and turned of by default, due to trickery of sharding_key analyzing, simple example is <code class="syntax">if</code> in sharding key) and fix it for WITH ROLLUP/CUBE/TOTALS. <a href="https://github.com/ClickHouse/ClickHouse/pull/10516" rel="external nofollow noreferrer" target="_blank">#10516</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10263" rel="external nofollow noreferrer" target="_blank">#10263</a> (after that PR dist send via INSERT had been postponing on each INSERT) Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/8756" rel="external nofollow noreferrer" target="_blank">#8756</a> (that PR breaks distributed sends with all of the following conditions met (unlikely setup for now I guess): <code class="syntax">internal_replication == false</code>, multiple local shards (activates the hardlinking code) and <code class="syntax">distributed_storage_policy</code> (makes <code class="syntax">link(2)</code> fails on <code class="syntax">EXDEV</code>)). <a href="https://github.com/ClickHouse/ClickHouse/pull/10486" rel="external nofollow noreferrer" target="_blank">#10486</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed error with "max_rows_to_sort" limit. <a href="https://github.com/ClickHouse/ClickHouse/pull/10268" rel="external nofollow noreferrer" target="_blank">#10268</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Get dictionary and check access rights only once per each call of any function reading external dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/10928" rel="external nofollow noreferrer" target="_blank">#10928</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
</ul>
<h4 id="improvement_15">Improvement<a class="headerlink" href="#improvement_15" title="Permanent link"> </a></h4>
<ul>
<li>Apply <code class="syntax">TTL</code> for old data, after <code class="syntax">ALTER MODIFY TTL</code> query. This behaviour is controlled by setting <code class="syntax">materialize_ttl_after_modify</code>, which is enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/11042" rel="external nofollow noreferrer" target="_blank">#11042</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>When parsing C-style backslash escapes in string literals, VALUES and various text formats (this is an extension to SQL standard that is endemic for ClickHouse and MySQL), keep backslash if unknown escape sequence is found (e.g. <code class="syntax">\%</code> or <code class="syntax">\w</code>) that will make usage of <code class="syntax">LIKE</code> and <code class="syntax">match</code> regular expressions more convenient (it's enough to write <code class="syntax">name LIKE 'used\_cars'</code> instead of <code class="syntax">name LIKE 'used\\_cars'</code>) and more compatible at the same time. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10922" rel="external nofollow noreferrer" target="_blank">#10922</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11208" rel="external nofollow noreferrer" target="_blank">#11208</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>When reading Decimal value, cut extra digits after point. This behaviour is more compatible with MySQL and PostgreSQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10202" rel="external nofollow noreferrer" target="_blank">#10202</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11831" rel="external nofollow noreferrer" target="_blank">#11831</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow to DROP replicated table if the metadata in ZooKeeper was already removed and does not exist (this is also the case when using TestKeeper for testing and the server was restarted). Allow to RENAME replicated table even if there is an error communicating with ZooKeeper. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10720" rel="external nofollow noreferrer" target="_blank">#10720</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11652" rel="external nofollow noreferrer" target="_blank">#11652</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Slightly improve diagnostic of reading decimal from string. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10202" rel="external nofollow noreferrer" target="_blank">#10202</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11829" rel="external nofollow noreferrer" target="_blank">#11829</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix sleep invocation in signal handler. It was sleeping for less amount of time than expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11825" rel="external nofollow noreferrer" target="_blank">#11825</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>(Only Linux) OS related performance metrics (for CPU and I/O) will work even without <code class="syntax">CAP_NET_ADMIN</code> capability. <a href="https://github.com/ClickHouse/ClickHouse/pull/10544" rel="external nofollow noreferrer" target="_blank">#10544</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Added <code class="syntax">hostname</code> as an alias to function <code class="syntax">hostName</code>. This feature was suggested by Victor Tarnavskiy from Yandex.Metrica. <a href="https://github.com/ClickHouse/ClickHouse/pull/11821" rel="external nofollow noreferrer" target="_blank">#11821</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added support for distributed <code class="syntax">DDL</code> (update/delete/drop partition) on cross replication clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/11703" rel="external nofollow noreferrer" target="_blank">#11703</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Emit warning instead of error in server log at startup if we cannot listen one of the listen addresses (e.g. IPv6 is unavailable inside Docker). Note that if server fails to listen all listed addresses, it will refuse to startup as before. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4406" rel="external nofollow noreferrer" target="_blank">#4406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11687" rel="external nofollow noreferrer" target="_blank">#11687</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Default user and database creation on docker image starting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10637" rel="external nofollow noreferrer" target="_blank">#10637</a> (<a href="https://github.com/tarampampam" rel="external nofollow noreferrer" target="_blank">Paramtamtam</a>).</li>
<li>When multiline query is printed to server log, the lines are joined. Make it to work correct in case of multiline string literals, identifiers and single-line comments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3853" rel="external nofollow noreferrer" target="_blank">#3853</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11686" rel="external nofollow noreferrer" target="_blank">#11686</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Multiple names are now allowed in commands: CREATE USER, CREATE ROLE, ALTER USER, SHOW CREATE USER, SHOW GRANTS and so on. <a href="https://github.com/ClickHouse/ClickHouse/pull/11670" rel="external nofollow noreferrer" target="_blank">#11670</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Add support for distributed DDL (<code class="syntax">UPDATE/DELETE/DROP PARTITION</code>) on cross replication clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/11508" rel="external nofollow noreferrer" target="_blank">#11508</a> (<a href="https://github.com/etah000" rel="external nofollow noreferrer" target="_blank">frank lee</a>).</li>
<li>Clear password from command line in <code class="syntax">clickhouse-client</code> and <code class="syntax">clickhouse-benchmark</code> if the user has specified it with explicit value. This prevents password exposure by <code class="syntax">ps</code> and similar tools. <a href="https://github.com/ClickHouse/ClickHouse/pull/11665" rel="external nofollow noreferrer" target="_blank">#11665</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Don't use debug info from ELF file if it does not correspond to the running binary. It is needed to avoid printing wrong function names and source locations in stack traces. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7514" rel="external nofollow noreferrer" target="_blank">#7514</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11657" rel="external nofollow noreferrer" target="_blank">#11657</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Return NULL/zero when value is not parsed completely in parseDateTimeBestEffortOrNull/Zero functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7876" rel="external nofollow noreferrer" target="_blank">#7876</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11653" rel="external nofollow noreferrer" target="_blank">#11653</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Skip empty parameters in requested URL. They may appear when you write <code class="syntax">http://localhost:8123/?&amp;a=b</code> or <code class="syntax">http://localhost:8123/?a=b&amp;&amp;c=d</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10749" rel="external nofollow noreferrer" target="_blank">#10749</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11651" rel="external nofollow noreferrer" target="_blank">#11651</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow using <code class="syntax">groupArrayArray</code> and <code class="syntax">groupUniqArrayArray</code> as <code class="syntax">SimpleAggregateFunction</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11650" rel="external nofollow noreferrer" target="_blank">#11650</a> (<a href="https://github.com/ksvladimir" rel="external nofollow noreferrer" target="_blank">Volodymyr Kuznetsov</a>).</li>
<li>Allow comparison with constant strings by implicit conversions when analysing index conditions on other types. This may close <a href="https://github.com/ClickHouse/ClickHouse/issues/11630" rel="external nofollow noreferrer" target="_blank">#11630</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11648" rel="external nofollow noreferrer" target="_blank">#11648</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li><a href="https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377" target="_blank">https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377</a> Support config default HTTPHandlers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11628" rel="external nofollow noreferrer" target="_blank">#11628</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Make more input formats to work with Kafka engine. Fix the issue with premature flushes. Fix the performance issue when <code class="syntax">kafka_num_consumers</code> is greater than number of partitions in topic. <a href="https://github.com/ClickHouse/ClickHouse/pull/11599" rel="external nofollow noreferrer" target="_blank">#11599</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Improve <code class="syntax">multiple_joins_rewriter_version=2</code> logic. Fix unknown columns error for lambda aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11587" rel="external nofollow noreferrer" target="_blank">#11587</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Better exception message when cannot parse columns declaration list. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10403" rel="external nofollow noreferrer" target="_blank">#10403</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11537" rel="external nofollow noreferrer" target="_blank">#11537</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improve <code class="syntax">enable_optimize_predicate_expression=1</code> logic for VIEW. <a href="https://github.com/ClickHouse/ClickHouse/pull/11513" rel="external nofollow noreferrer" target="_blank">#11513</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Adding support for PREWHERE in live view tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/11495" rel="external nofollow noreferrer" target="_blank">#11495</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Automatically update DNS cache, which is used to check if user is allowed to connect from an address. <a href="https://github.com/ClickHouse/ClickHouse/pull/11487" rel="external nofollow noreferrer" target="_blank">#11487</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>OPTIMIZE FINAL will force merge even if concurrent merges are performed. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11309" rel="external nofollow noreferrer" target="_blank">#11309</a> and closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11322" rel="external nofollow noreferrer" target="_blank">#11322</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11346" rel="external nofollow noreferrer" target="_blank">#11346</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Suppress output of cancelled queries in clickhouse-client. In previous versions result may continue to print in terminal even after you press Ctrl+C to cancel query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9473" rel="external nofollow noreferrer" target="_blank">#9473</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11342" rel="external nofollow noreferrer" target="_blank">#11342</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now history file is updated after each query and there is no race condition if multiple clients use one history file. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9897" rel="external nofollow noreferrer" target="_blank">#9897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11453" rel="external nofollow noreferrer" target="_blank">#11453</a> (<a href="https://github.com/kuskarov" rel="external nofollow noreferrer" target="_blank">Tagir Kuskarov</a>).</li>
<li>Better log messages in while reloading configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/11341" rel="external nofollow noreferrer" target="_blank">#11341</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove trailing whitespaces from formatted queries in <code class="syntax">clickhouse-client</code> or <code class="syntax">clickhouse-format</code> in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11325" rel="external nofollow noreferrer" target="_blank">#11325</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add setting "output_format_pretty_max_value_width". If value is longer, it will be cut to avoid output of too large values in terminal. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11140" rel="external nofollow noreferrer" target="_blank">#11140</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11324" rel="external nofollow noreferrer" target="_blank">#11324</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Better exception message in case when there is shortage of memory mappings. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11027" rel="external nofollow noreferrer" target="_blank">#11027</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11316" rel="external nofollow noreferrer" target="_blank">#11316</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Support (U)Int8, (U)Int16, Date in ASOF JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/11301" rel="external nofollow noreferrer" target="_blank">#11301</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Support kafka_client_id parameter for Kafka tables. It also changes the default <code class="syntax">client.id</code> used by ClickHouse when communicating with Kafka to be more verbose and usable. <a href="https://github.com/ClickHouse/ClickHouse/pull/11252" rel="external nofollow noreferrer" target="_blank">#11252</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Keep the value of <code class="syntax">DistributedFilesToInsert</code> metric on exceptions. In previous versions, the value was set when we are going to send some files, but it is zero, if there was an exception and some files are still pending. Now it corresponds to the number of pending files in filesystem. <a href="https://github.com/ClickHouse/ClickHouse/pull/11220" rel="external nofollow noreferrer" target="_blank">#11220</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add support for multi-word data type names (such as <code class="syntax">DOUBLE PRECISION</code> and <code class="syntax">CHAR VARYING</code>) for better SQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/11214" rel="external nofollow noreferrer" target="_blank">#11214</a> (<a href="https://github.com/Potya" rel="external nofollow noreferrer" target="_blank">Павел Потемкин</a>).</li>
<li>Provide synonyms for some data types. <a href="https://github.com/ClickHouse/ClickHouse/pull/10856" rel="external nofollow noreferrer" target="_blank">#10856</a> (<a href="https://github.com/Potya" rel="external nofollow noreferrer" target="_blank">Павел Потемкин</a>).</li>
<li>The query log is now enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/11184" rel="external nofollow noreferrer" target="_blank">#11184</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
<li>Show authentication type in table system.users and while executing SHOW CREATE USER query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11080" rel="external nofollow noreferrer" target="_blank">#11080</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Remove data on explicit <code class="syntax">DROP DATABASE</code> for <code class="syntax">Memory</code> database engine. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10557" rel="external nofollow noreferrer" target="_blank">#10557</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11021" rel="external nofollow noreferrer" target="_blank">#11021</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Set thread names for internal threads of rdkafka library. Make logs from rdkafka available in server logs. <a href="https://github.com/ClickHouse/ClickHouse/pull/10983" rel="external nofollow noreferrer" target="_blank">#10983</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Support for unicode whitespaces in queries. This helps when queries are copy-pasted from Word or from web page. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10896" rel="external nofollow noreferrer" target="_blank">#10896</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10903" rel="external nofollow noreferrer" target="_blank">#10903</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Allow large UInt types as the index in function <code class="syntax">tupleElement</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10874" rel="external nofollow noreferrer" target="_blank">#10874</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Respect prefer_localhost_replica/load_balancing on INSERT into Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/10867" rel="external nofollow noreferrer" target="_blank">#10867</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Introduce <code class="syntax">min_insert_block_size_rows_for_materialized_views</code>, <code class="syntax">min_insert_block_size_bytes_for_materialized_views</code> settings. This settings are similar to <code class="syntax">min_insert_block_size_rows</code> and <code class="syntax">min_insert_block_size_bytes</code>, but applied only for blocks inserted into <code class="syntax">MATERIALIZED VIEW</code>. It helps to control blocks squashing while pushing to MVs and avoid excessive memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/10858" rel="external nofollow noreferrer" target="_blank">#10858</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Get rid of exception from replicated queue during server shutdown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10819" rel="external nofollow noreferrer" target="_blank">#10819</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10841" rel="external nofollow noreferrer" target="_blank">#10841</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Ensure that <code class="syntax">varSamp</code>, <code class="syntax">varPop</code> cannot return negative results due to numerical errors and that <code class="syntax">stddevSamp</code>, <code class="syntax">stddevPop</code> cannot be calculated from negative variance. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10532" rel="external nofollow noreferrer" target="_blank">#10532</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10829" rel="external nofollow noreferrer" target="_blank">#10829</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Better DNS exception message. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10813" rel="external nofollow noreferrer" target="_blank">#10813</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10828" rel="external nofollow noreferrer" target="_blank">#10828</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Change HTTP response code in case of some parse errors to 400 Bad Request. This fix <a href="https://github.com/ClickHouse/ClickHouse/issues/10636" rel="external nofollow noreferrer" target="_blank">#10636</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10640" rel="external nofollow noreferrer" target="_blank">#10640</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Print a message if clickhouse-client is newer than clickhouse-server. <a href="https://github.com/ClickHouse/ClickHouse/pull/10627" rel="external nofollow noreferrer" target="_blank">#10627</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Adding support for <code class="syntax">INSERT INTO [db.]table WATCH</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10498" rel="external nofollow noreferrer" target="_blank">#10498</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Allow to pass quota_key in clickhouse-client. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10227" rel="external nofollow noreferrer" target="_blank">#10227</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10270" rel="external nofollow noreferrer" target="_blank">#10270</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="performance-improvement_9">Performance Improvement<a class="headerlink" href="#performance-improvement_9" title="Permanent link"> </a></h4>
<ul>
<li>Allow multiple replicas to assign merges, mutations, partition drop, move and replace concurrently. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10367" rel="external nofollow noreferrer" target="_blank">#10367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11639" rel="external nofollow noreferrer" target="_blank">#11639</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/11795" rel="external nofollow noreferrer" target="_blank">#11795</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Optimization of GROUP BY with respect to table sorting key, enabled with <code class="syntax">optimize_aggregation_in_order</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/9113" rel="external nofollow noreferrer" target="_blank">#9113</a> (<a href="https://github.com/dimarub2000" rel="external nofollow noreferrer" target="_blank">dimarub2000</a>).</li>
<li>Selects with final are executed in parallel. Added setting <code class="syntax">max_final_threads</code> to limit the number of threads used. <a href="https://github.com/ClickHouse/ClickHouse/pull/10463" rel="external nofollow noreferrer" target="_blank">#10463</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Improve performance for INSERT queries via <code class="syntax">INSERT SELECT</code> or INSERT with clickhouse-client when small blocks are generated (typical case with parallel parsing). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11275" rel="external nofollow noreferrer" target="_blank">#11275</a>. Fix the issue that CONSTRAINTs were not working for DEFAULT fields. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11273" rel="external nofollow noreferrer" target="_blank">#11273</a>. Fix the issue that CONSTRAINTS were ignored for TEMPORARY tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11274" rel="external nofollow noreferrer" target="_blank">#11274</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11276" rel="external nofollow noreferrer" target="_blank">#11276</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Optimization that eliminates min/max/any aggregators of GROUP BY keys in SELECT section, enabled with <code class="syntax">optimize_aggregators_of_group_by_keys</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/11667" rel="external nofollow noreferrer" target="_blank">#11667</a> (<a href="https://github.com/xPoSx" rel="external nofollow noreferrer" target="_blank">xPoSx</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11806" rel="external nofollow noreferrer" target="_blank">#11806</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>New optimization that takes all operations out of <code class="syntax">any</code> function, enabled with <code class="syntax">optimize_move_functions_out_of_any</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/11529" rel="external nofollow noreferrer" target="_blank">#11529</a> (<a href="https://github.com/kamalov-ruslan" rel="external nofollow noreferrer" target="_blank">Ruslan</a>).</li>
<li>Improve performance of <code class="syntax">clickhouse-client</code> in interactive mode when Pretty formats are used. In previous versions, significant amount of time can be spent calculating visible width of UTF-8 string. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11323" rel="external nofollow noreferrer" target="_blank">#11323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11323" rel="external nofollow noreferrer" target="_blank">#11323</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improved performance for queries with <code class="syntax">ORDER BY</code> and small <code class="syntax">LIMIT</code> (less, then <code class="syntax">max_block_size</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11171" rel="external nofollow noreferrer" target="_blank">#11171</a> (<a href="https://github.com/Provet" rel="external nofollow noreferrer" target="_blank">Albert Kidrachev</a>).</li>
<li>Add runtime CPU detection to select and dispatch the best function implementation. Add support for codegeneration for multiple targets. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1017" rel="external nofollow noreferrer" target="_blank">#1017</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10058" rel="external nofollow noreferrer" target="_blank">#10058</a> (<a href="https://github.com/DimasKovas" rel="external nofollow noreferrer" target="_blank">DimasKovas</a>).</li>
<li>Enable <code class="syntax">mlock</code> of clickhouse binary by default. It will prevent clickhouse executable from being paged out under high IO load. <a href="https://github.com/ClickHouse/ClickHouse/pull/11139" rel="external nofollow noreferrer" target="_blank">#11139</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Make queries with <code class="syntax">sum</code> aggregate function and without GROUP BY keys to run multiple times faster. <a href="https://github.com/ClickHouse/ClickHouse/pull/10992" rel="external nofollow noreferrer" target="_blank">#10992</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Improving radix sort (used in <code class="syntax">ORDER BY</code> with simple keys) by removing some redundant data moves. <a href="https://github.com/ClickHouse/ClickHouse/pull/10981" rel="external nofollow noreferrer" target="_blank">#10981</a> (<a href="https://github.com/g-arslan" rel="external nofollow noreferrer" target="_blank">Arslan Gumerov</a>).</li>
<li>Sort bigger parts of the left table in MergeJoin. Buffer left blocks in memory. Add <code class="syntax">partial_merge_join_left_table_buffer_bytes</code> setting to manage the left blocks buffers sizes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10601" rel="external nofollow noreferrer" target="_blank">#10601</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Remove duplicate ORDER BY and DISTINCT from subqueries, this optimization is enabled with <code class="syntax">optimize_duplicate_order_by_and_distinct</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10067" rel="external nofollow noreferrer" target="_blank">#10067</a> (<a href="https://github.com/demo-99" rel="external nofollow noreferrer" target="_blank">Mikhail Malafeev</a>).</li>
<li>This feature eliminates functions of other keys in GROUP BY section, enabled with <code class="syntax">optimize_group_by_function_keys</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10051" rel="external nofollow noreferrer" target="_blank">#10051</a> (<a href="https://github.com/xPoSx" rel="external nofollow noreferrer" target="_blank">xPoSx</a>).</li>
<li>New optimization that takes arithmetic operations out of aggregate functions, enabled with <code class="syntax">optimize_arithmetic_operations_in_aggregate_functions</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10047" rel="external nofollow noreferrer" target="_blank">#10047</a> (<a href="https://github.com/kamalov-ruslan" rel="external nofollow noreferrer" target="_blank">Ruslan</a>).</li>
<li>Use HTTP client for S3 based on Poco instead of curl. This will improve performance and lower memory usage of s3 storage and table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/11230" rel="external nofollow noreferrer" target="_blank">#11230</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fix Kafka performance issue related to reschedules based on limits, which were always applied. <a href="https://github.com/ClickHouse/ClickHouse/pull/11149" rel="external nofollow noreferrer" target="_blank">#11149</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Enable percpu_arena:percpu for jemalloc (This will reduce memory fragmentation due to thread pool). <a href="https://github.com/ClickHouse/ClickHouse/pull/11084" rel="external nofollow noreferrer" target="_blank">#11084</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Optimize memory usage when reading a response from an S3 HTTP client. <a href="https://github.com/ClickHouse/ClickHouse/pull/11561" rel="external nofollow noreferrer" target="_blank">#11561</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Adjust the default Kafka settings for better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/11388" rel="external nofollow noreferrer" target="_blank">#11388</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h4 id="experimental-feature_5">Experimental Feature<a class="headerlink" href="#experimental-feature_5" title="Permanent link"> </a></h4>
<ul>
<li>Add data type <code class="syntax">Point</code> (Tuple(Float64, Float64)) and <code class="syntax">Polygon</code> (Array(Array(Tuple(Float64, Float64))). <a href="https://github.com/ClickHouse/ClickHouse/pull/10678" rel="external nofollow noreferrer" target="_blank">#10678</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>).</li>
<li>Add's a <code class="syntax">hasSubstr</code> function that allows for look for subsequences in arrays. Note: this function is likely to be renamed without further notice. <a href="https://github.com/ClickHouse/ClickHouse/pull/11071" rel="external nofollow noreferrer" target="_blank">#11071</a> (<a href="https://github.com/r-zenine" rel="external nofollow noreferrer" target="_blank">Ryad Zenine</a>).</li>
<li>Added OpenCL support and bitonic sort algorithm, which can be used for sorting integer types of data in single column. Needs to be build with flag <code class="syntax">-DENABLE_OPENCL=1</code>. For using bitonic sort algorithm instead of others you need to set <code class="syntax">bitonic_sort</code> for Setting's option <code class="syntax">special_sort</code> and make sure that OpenCL is available. This feature does not improve performance or anything else, it is only provided as an example and for demonstration purposes. It is likely to be removed in near future if there will be no further development in this direction. <a href="https://github.com/ClickHouse/ClickHouse/pull/10232" rel="external nofollow noreferrer" target="_blank">#10232</a> (<a href="https://github.com/margaritiko" rel="external nofollow noreferrer" target="_blank">Ri</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_11">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_11" title="Permanent link"> </a></h4>
<ul>
<li>Enable clang-tidy for programs and utils. <a href="https://github.com/ClickHouse/ClickHouse/pull/10991" rel="external nofollow noreferrer" target="_blank">#10991</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove dependency on <code class="syntax">tzdata</code>: do not fail if <code class="syntax">/usr/share/zoneinfo</code> directory does not exist. Note that all timezones work in ClickHouse even without tzdata installed in system. <a href="https://github.com/ClickHouse/ClickHouse/pull/11827" rel="external nofollow noreferrer" target="_blank">#11827</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added MSan and UBSan stress tests. Note that we already have MSan, UBSan for functional tests and "stress" test is another kind of tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10871" rel="external nofollow noreferrer" target="_blank">#10871</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Print compiler build id in crash messages. It will make us slightly more certain about what binary has crashed. Added new function <code class="syntax">buildId</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11824" rel="external nofollow noreferrer" target="_blank">#11824</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added a test to ensure that mutations continue to work after FREEZE query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11820" rel="external nofollow noreferrer" target="_blank">#11820</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Don't allow tests with "fail" substring in their names because it makes looking at the tests results in browser less convenient when you type Ctrl+F and search for "fail". <a href="https://github.com/ClickHouse/ClickHouse/pull/11817" rel="external nofollow noreferrer" target="_blank">#11817</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Removes unused imports from HTTPHandlerFactory. <a href="https://github.com/ClickHouse/ClickHouse/pull/11660" rel="external nofollow noreferrer" target="_blank">#11660</a> (<a href="https://github.com/bharatnc" rel="external nofollow noreferrer" target="_blank">Bharat Nallan</a>).</li>
<li>Added a random sampling of instances where copier is executed. It is needed to avoid <code class="syntax">Too many simultaneous queries</code> error. Also increased timeout and decreased fault probability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11573" rel="external nofollow noreferrer" target="_blank">#11573</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix missed include. <a href="https://github.com/ClickHouse/ClickHouse/pull/11525" rel="external nofollow noreferrer" target="_blank">#11525</a> (<a href="https://github.com/matwey" rel="external nofollow noreferrer" target="_blank">Matwey V. Kornilov</a>).</li>
<li>Speed up build by removing old example programs. Also found some orphan functional test. <a href="https://github.com/ClickHouse/ClickHouse/pull/11486" rel="external nofollow noreferrer" target="_blank">#11486</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Increase ccache size for builds in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/11450" rel="external nofollow noreferrer" target="_blank">#11450</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Leave only unit_tests_dbms in deb build. <a href="https://github.com/ClickHouse/ClickHouse/pull/11429" rel="external nofollow noreferrer" target="_blank">#11429</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>).</li>
<li>Update librdkafka to version <a href="https://github.com/edenhill/librdkafka/releases/tag/v1.4.2" rel="external nofollow noreferrer" target="_blank">1.4.2</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11256" rel="external nofollow noreferrer" target="_blank">#11256</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Refactor CMake build files. <a href="https://github.com/ClickHouse/ClickHouse/pull/11390" rel="external nofollow noreferrer" target="_blank">#11390</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Fix several flaky integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11355" rel="external nofollow noreferrer" target="_blank">#11355</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add support for unit tests run with UBSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/11345" rel="external nofollow noreferrer" target="_blank">#11345</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove redundant timeout from integration test <code class="syntax">test_insertion_sync_fails_with_timeout</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11343" rel="external nofollow noreferrer" target="_blank">#11343</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Better check for hung queries in clickhouse-test. <a href="https://github.com/ClickHouse/ClickHouse/pull/11321" rel="external nofollow noreferrer" target="_blank">#11321</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Emit a warning if server was build in debug or with sanitizers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11304" rel="external nofollow noreferrer" target="_blank">#11304</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now clickhouse-test check the server aliveness before tests run. <a href="https://github.com/ClickHouse/ClickHouse/pull/11285" rel="external nofollow noreferrer" target="_blank">#11285</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix potentially flacky test <code class="syntax">00731_long_merge_tree_select_opened_files.sh</code>. It does not fail frequently but we have discovered potential race condition in this test while experimenting with ThreadFuzzer: <a href="https://github.com/ClickHouse/ClickHouse/issues/9814" rel="external nofollow noreferrer" target="_blank">#9814</a> See <a href="https://clickhouse-test-reports.s3.yandex.net/9814/40e3023e215df22985d275bf85f4d2290897b76b/functional_stateless_tests_(unbundled).html#fail1" rel="external nofollow noreferrer" target="_blank">link</a> for the example. <a href="https://github.com/ClickHouse/ClickHouse/pull/11270" rel="external nofollow noreferrer" target="_blank">#11270</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Repeat test in CI if <code class="syntax">curl</code> invocation was timed out. It is possible due to system hangups for 10+ seconds that are typical in our CI infrastructure. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11267" rel="external nofollow noreferrer" target="_blank">#11267</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11268" rel="external nofollow noreferrer" target="_blank">#11268</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add a test for Join table engine from @donmikel. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9158" rel="external nofollow noreferrer" target="_blank">#9158</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11265" rel="external nofollow noreferrer" target="_blank">#11265</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix several non significant errors in unit tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11262" rel="external nofollow noreferrer" target="_blank">#11262</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Now parts of linker command for <code class="syntax">cctz</code> library will not be shuffled with other libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11213" rel="external nofollow noreferrer" target="_blank">#11213</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Split /programs/server into actual program and library. <a href="https://github.com/ClickHouse/ClickHouse/pull/11186" rel="external nofollow noreferrer" target="_blank">#11186</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Improve build scripts for protobuf &amp; gRPC. <a href="https://github.com/ClickHouse/ClickHouse/pull/11172" rel="external nofollow noreferrer" target="_blank">#11172</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Enable performance test that was not working. <a href="https://github.com/ClickHouse/ClickHouse/pull/11158" rel="external nofollow noreferrer" target="_blank">#11158</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Create root S3 bucket for tests before any CH instance is started. <a href="https://github.com/ClickHouse/ClickHouse/pull/11142" rel="external nofollow noreferrer" target="_blank">#11142</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Add performance test for non-constant polygons. <a href="https://github.com/ClickHouse/ClickHouse/pull/11141" rel="external nofollow noreferrer" target="_blank">#11141</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixing <code class="syntax">00979_live_view_watch_continuous_aggregates</code> test. <a href="https://github.com/ClickHouse/ClickHouse/pull/11024" rel="external nofollow noreferrer" target="_blank">#11024</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Add ability to run zookeeper in integration tests over tmpfs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11002" rel="external nofollow noreferrer" target="_blank">#11002</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Wait for odbc-bridge with exponential backoff. Previous wait time of 200 ms was not enough in our CI environment. <a href="https://github.com/ClickHouse/ClickHouse/pull/10990" rel="external nofollow noreferrer" target="_blank">#10990</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix non-deterministic test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10989" rel="external nofollow noreferrer" target="_blank">#10989</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added a test for empty external data. <a href="https://github.com/ClickHouse/ClickHouse/pull/10926" rel="external nofollow noreferrer" target="_blank">#10926</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Database is recreated for every test. This improves separation of tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10902" rel="external nofollow noreferrer" target="_blank">#10902</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added more asserts in columns code. <a href="https://github.com/ClickHouse/ClickHouse/pull/10833" rel="external nofollow noreferrer" target="_blank">#10833</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Better cooperation with sanitizers. Print information about query_id in the message of sanitizer failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/10832" rel="external nofollow noreferrer" target="_blank">#10832</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix obvious race condition in "Split build smoke test" check. <a href="https://github.com/ClickHouse/ClickHouse/pull/10820" rel="external nofollow noreferrer" target="_blank">#10820</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href="https://github.com/ClickHouse/ClickHouse/issues/9968" rel="external nofollow noreferrer" target="_blank">#9968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10801" rel="external nofollow noreferrer" target="_blank">#10801</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add MSan suppression for MariaDB Client library. <a href="https://github.com/ClickHouse/ClickHouse/pull/10800" rel="external nofollow noreferrer" target="_blank">#10800</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>GRPC make couldn't find protobuf files, changed make file by adding the right link. <a href="https://github.com/ClickHouse/ClickHouse/pull/10794" rel="external nofollow noreferrer" target="_blank">#10794</a> (<a href="https://github.com/mnkonkova" rel="external nofollow noreferrer" target="_blank">mnkonkova</a>).</li>
<li>Enable extra warnings (<code class="syntax">-Weverything</code>) for base, utils, programs. Note that we already have it for the most of the code. <a href="https://github.com/ClickHouse/ClickHouse/pull/10779" rel="external nofollow noreferrer" target="_blank">#10779</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Suppressions of warnings from libraries was mistakenly declared as public in <a href="https://github.com/ClickHouse/ClickHouse/issues/10396" rel="external nofollow noreferrer" target="_blank">#10396</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10776" rel="external nofollow noreferrer" target="_blank">#10776</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Restore a patch that was accidentially deleted in <a href="https://github.com/ClickHouse/ClickHouse/issues/10396" rel="external nofollow noreferrer" target="_blank">#10396</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10774" rel="external nofollow noreferrer" target="_blank">#10774</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix performance tests errors, part 2. <a href="https://github.com/ClickHouse/ClickHouse/pull/10773" rel="external nofollow noreferrer" target="_blank">#10773</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix performance test errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/10766" rel="external nofollow noreferrer" target="_blank">#10766</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Update cross-builds to use clang-10 compiler. <a href="https://github.com/ClickHouse/ClickHouse/pull/10724" rel="external nofollow noreferrer" target="_blank">#10724</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Update instruction to install RPM packages. This was suggested by Denis (TG login @ldviolet) and implemented by Arkady Shejn. <a href="https://github.com/ClickHouse/ClickHouse/pull/10707" rel="external nofollow noreferrer" target="_blank">#10707</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Trying to fix <code class="syntax">tests/queries/0_stateless/01246_insert_into_watch_live_view.py</code> test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10670" rel="external nofollow noreferrer" target="_blank">#10670</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fixing and re-enabling 00979_live_view_watch_continuous_aggregates.py test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10658" rel="external nofollow noreferrer" target="_blank">#10658</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Fix OOM in ASan stress test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10646" rel="external nofollow noreferrer" target="_blank">#10646</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan report (adding zero to nullptr) in HashTable that appeared after migration to clang-10. <a href="https://github.com/ClickHouse/ClickHouse/pull/10638" rel="external nofollow noreferrer" target="_blank">#10638</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove external call to <code class="syntax">ld</code> (bfd) linker during tzdata processing in compile time. <a href="https://github.com/ClickHouse/ClickHouse/pull/10634" rel="external nofollow noreferrer" target="_blank">#10634</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Allow to use <code class="syntax">lld</code> to link blobs (resources). <a href="https://github.com/ClickHouse/ClickHouse/pull/10632" rel="external nofollow noreferrer" target="_blank">#10632</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan report in <code class="syntax">LZ4</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/10631" rel="external nofollow noreferrer" target="_blank">#10631</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>). See also <a href="https://github.com/lz4/lz4/issues/857" rel="external nofollow noreferrer" target="_blank">https://github.com/lz4/lz4/issues/857</a></li>
<li>Update LZ4 to the latest dev branch. <a href="https://github.com/ClickHouse/ClickHouse/pull/10630" rel="external nofollow noreferrer" target="_blank">#10630</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added auto-generated machine-readable file with the list of stable versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/10628" rel="external nofollow noreferrer" target="_blank">#10628</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">capnproto</code> version check for <code class="syntax">capnp::UnalignedFlatArrayMessageReader</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10618" rel="external nofollow noreferrer" target="_blank">#10618</a> (<a href="https://github.com/matwey" rel="external nofollow noreferrer" target="_blank">Matwey V. Kornilov</a>).</li>
<li>Lower memory usage in tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10617" rel="external nofollow noreferrer" target="_blank">#10617</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixing hard coded timeouts in new live view tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10604" rel="external nofollow noreferrer" target="_blank">#10604</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Increasing timeout when opening a client in tests/queries/0_stateless/helpers/client.py. <a href="https://github.com/ClickHouse/ClickHouse/pull/10599" rel="external nofollow noreferrer" target="_blank">#10599</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>).</li>
<li>Enable ThinLTO for clang builds, continuation of <a href="https://github.com/ClickHouse/ClickHouse/pull/10435" rel="external nofollow noreferrer" target="_blank">#10435</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10585" rel="external nofollow noreferrer" target="_blank">#10585</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Adding fuzzers and preparing for oss-fuzz integration. <a href="https://github.com/ClickHouse/ClickHouse/pull/10546" rel="external nofollow noreferrer" target="_blank">#10546</a> (<a href="https://github.com/kyprizel" rel="external nofollow noreferrer" target="_blank">kyprizel</a>).</li>
<li>Fix FreeBSD build. <a href="https://github.com/ClickHouse/ClickHouse/pull/10150" rel="external nofollow noreferrer" target="_blank">#10150</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
<li>Add new build for query tests using pytest framework. <a href="https://github.com/ClickHouse/ClickHouse/pull/10039" rel="external nofollow noreferrer" target="_blank">#10039</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>).</li>
</ul>
<h2 id="clickhouse-release-v20-4">ClickHouse release v20.4<a class="headerlink" href="#clickhouse-release-v20-4" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-4-8-99-stable-2020-08-10">ClickHouse release v20.4.8.99-stable 2020-08-10<a class="headerlink" href="#clickhouse-release-v20-4-8-99-stable-2020-08-10" title="Permanent link"> </a></h3>
<h4 id="bug-fix_28">Bug Fix<a class="headerlink" href="#bug-fix_28" title="Permanent link"> </a></h4>
<ul>
<li>Fixed error in <code class="syntax">parseDateTimeBestEffort</code> function when unix timestamp was passed as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13362" rel="external nofollow noreferrer" target="_blank">#13362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13441" rel="external nofollow noreferrer" target="_blank">#13441</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potentially low performance and slightly incorrect result for <code class="syntax">uniqExact</code>, <code class="syntax">topK</code>, <code class="syntax">sumDistinct</code> and similar aggregate functions called on Float types with NaN values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" rel="external nofollow noreferrer" target="_blank">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" rel="external nofollow noreferrer" target="_blank">#13254</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" rel="external nofollow noreferrer" target="_blank">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" rel="external nofollow noreferrer" target="_blank">#13226</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed assert in <code class="syntax">arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" rel="external nofollow noreferrer" target="_blank">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" rel="external nofollow noreferrer" target="_blank">#13224</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed wrong index analysis with functions. It could lead to pruning wrong parts, while reading from <code class="syntax">MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" rel="external nofollow noreferrer" target="_blank">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" rel="external nofollow noreferrer" target="_blank">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" rel="external nofollow noreferrer" target="_blank">#13081</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" rel="external nofollow noreferrer" target="_blank">#12840</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed possible extra overflow row in data which could appear for queries <code class="syntax">WITH TOTALS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12747" rel="external nofollow noreferrer" target="_blank">#12747</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed performance with large tuples, which are interpreted as functions in <code class="syntax">IN</code> section. The case when user write <code class="syntax">WHERE x IN tuple(1, 2, ...)</code> instead of <code class="syntax">WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" rel="external nofollow noreferrer" target="_blank">#12700</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed memory tracking for <code class="syntax">input_format_parallel_parsing</code> (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" rel="external nofollow noreferrer" target="_blank">#12672</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/12293" rel="external nofollow noreferrer" target="_blank">#12293</a> allow push predicate when subquery contains with clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/12663" rel="external nofollow noreferrer" target="_blank">#12663</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" rel="external nofollow noreferrer" target="_blank">#10572</a> fix bloom filter index with const expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" rel="external nofollow noreferrer" target="_blank">#12659</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <code class="syntax">SIGSEGV</code> in <code class="syntax">StorageKafka</code> when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" rel="external nofollow noreferrer" target="_blank">#12658</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Added support for function <code class="syntax">if</code> with <code class="syntax">Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" rel="external nofollow noreferrer" target="_blank">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" rel="external nofollow noreferrer" target="_blank">#12648</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" rel="external nofollow noreferrer" target="_blank">#12566</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Removed data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" rel="external nofollow noreferrer" target="_blank">#12556</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bug which lead to broken old parts after <code class="syntax">ALTER DELETE</code> query when <code class="syntax">enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" rel="external nofollow noreferrer" target="_blank">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" rel="external nofollow noreferrer" target="_blank">#12543</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Better exception for function <code class="syntax">in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" rel="external nofollow noreferrer" target="_blank">#12529</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" rel="external nofollow noreferrer" target="_blank">#12492</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed crash in JOIN with dictionary when we are joining over expression of dictionary key: <code class="syntax">t JOIN dict ON expr(dict.id) = t.id</code>. Disable dictionary join optimisation for this case. <a href="https://github.com/ClickHouse/ClickHouse/pull/12458" rel="external nofollow noreferrer" target="_blank">#12458</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed possible segfault if StorageMerge. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" rel="external nofollow noreferrer" target="_blank">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" rel="external nofollow noreferrer" target="_blank">#12401</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed order of columns in <code class="syntax">WITH FILL</code> modifier. Previously order of columns of <code class="syntax">ORDER BY</code> statement wasn't respected. <a href="https://github.com/ClickHouse/ClickHouse/pull/12306" rel="external nofollow noreferrer" target="_blank">#12306</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Avoid "bad cast" exception when there is an expression that filters data by virtual columns (like <code class="syntax">_table</code> in <code class="syntax">Merge</code> tables) or by "index" columns in system tables such as filtering by database name when querying from <code class="syntax">system.tables</code>, and this expression returns <code class="syntax">Nullable</code> type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12166" rel="external nofollow noreferrer" target="_blank">#12166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12305" rel="external nofollow noreferrer" target="_blank">#12305</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Show error after TrieDictionary failed to load. <a href="https://github.com/ClickHouse/ClickHouse/pull/12290" rel="external nofollow noreferrer" target="_blank">#12290</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>The function <code class="syntax">arrayFill</code> worked incorrectly for empty arrays that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12263" rel="external nofollow noreferrer" target="_blank">#12263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12279" rel="external nofollow noreferrer" target="_blank">#12279</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Implemented conversions to the common type for <code class="syntax">LowCardinality</code> types. This allows to execute UNION ALL of tables with columns of LowCardinality and other columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8212" rel="external nofollow noreferrer" target="_blank">#8212</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4342" rel="external nofollow noreferrer" target="_blank">#4342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12275" rel="external nofollow noreferrer" target="_blank">#12275</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the behaviour when during multiple sequential inserts in <code class="syntax">StorageFile</code> header for some special types was written more than once. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/6155" rel="external nofollow noreferrer" target="_blank">#6155</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12197" rel="external nofollow noreferrer" target="_blank">#12197</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed logical functions for UInt8 values when they are not equal to 0 or 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/12196" rel="external nofollow noreferrer" target="_blank">#12196</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Cap max_memory_usage* limits to the process resident memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/12182" rel="external nofollow noreferrer" target="_blank">#12182</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">dictGet</code> arguments check during GROUP BY injective functions elimination. <a href="https://github.com/ClickHouse/ClickHouse/pull/12179" rel="external nofollow noreferrer" target="_blank">#12179</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Don't split the dictionary source's table name into schema and table name itself if ODBC connection does not support schema. <a href="https://github.com/ClickHouse/ClickHouse/pull/12165" rel="external nofollow noreferrer" target="_blank">#12165</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed wrong logic in <code class="syntax">ALTER DELETE</code> that leads to deleting of records when condition evaluates to NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9088" rel="external nofollow noreferrer" target="_blank">#9088</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12106" rel="external nofollow noreferrer" target="_blank">#12106</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12153" rel="external nofollow noreferrer" target="_blank">#12153</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" rel="external nofollow noreferrer" target="_blank">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" rel="external nofollow noreferrer" target="_blank">#12151</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential overflow in integer division. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12119" rel="external nofollow noreferrer" target="_blank">#12119</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12140" rel="external nofollow noreferrer" target="_blank">#12140</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential infinite loop in <code class="syntax">greatCircleDistance</code>, <code class="syntax">geoDistance</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12117" rel="external nofollow noreferrer" target="_blank">#12117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12137" rel="external nofollow noreferrer" target="_blank">#12137</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Normalize "pid" file handling. In previous versions the server may refuse to start if it was killed without proper shutdown and if there is another process that has the same pid as previously runned server. Also pid file may be removed in unsuccessful server startup even if there is another server running. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3501" rel="external nofollow noreferrer" target="_blank">#3501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12133" rel="external nofollow noreferrer" target="_blank">#12133</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed handling dependency of table with ENGINE=Dictionary on dictionary. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10994" rel="external nofollow noreferrer" target="_blank">#10994</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10397" rel="external nofollow noreferrer" target="_blank">#10397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12116" rel="external nofollow noreferrer" target="_blank">#12116</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed performance for selects with <code class="syntax">UNION</code> caused by wrong limit for the total number of threads. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12030" rel="external nofollow noreferrer" target="_blank">#12030</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12103" rel="external nofollow noreferrer" target="_blank">#12103</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed segfault with <code class="syntax">-StateResample</code> combinators. <a href="https://github.com/ClickHouse/ClickHouse/pull/12092" rel="external nofollow noreferrer" target="_blank">#12092</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed empty <code class="syntax">result_rows</code> and <code class="syntax">result_bytes</code> metrics in <code class="syntax">system.quey_log</code> for selects. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11595" rel="external nofollow noreferrer" target="_blank">#11595</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12089" rel="external nofollow noreferrer" target="_blank">#12089</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed unnecessary limiting the number of threads for selects from <code class="syntax">VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" rel="external nofollow noreferrer" target="_blank">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" rel="external nofollow noreferrer" target="_blank">#12085</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed possible crash while using wrong type for <code class="syntax">PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12053" rel="external nofollow noreferrer" target="_blank">#12053</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12060" rel="external nofollow noreferrer" target="_blank">#12060</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12060" rel="external nofollow noreferrer" target="_blank">#12060</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed error <code class="syntax">Expected single dictionary argument for function</code> for function <code class="syntax">defaultValueOfArgumentType</code> with <code class="syntax">LowCardinality</code> type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11808" rel="external nofollow noreferrer" target="_blank">#11808</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12056" rel="external nofollow noreferrer" target="_blank">#12056</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Tuple(LowCardinality)</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9766" rel="external nofollow noreferrer" target="_blank">#9766</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12055" rel="external nofollow noreferrer" target="_blank">#12055</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Parse tables metadata in parallel when loading database. This fixes slow server startup when there are large number of tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12045" rel="external nofollow noreferrer" target="_blank">#12045</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Make <code class="syntax">topK</code> aggregate function return Enum for Enum types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3740" rel="external nofollow noreferrer" target="_blank">#3740</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12043" rel="external nofollow noreferrer" target="_blank">#12043</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed constraints check if constraint is a constant expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11360" rel="external nofollow noreferrer" target="_blank">#11360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12042" rel="external nofollow noreferrer" target="_blank">#12042</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed incorrect comparison of tuples with <code class="syntax">Nullable</code> columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11985" rel="external nofollow noreferrer" target="_blank">#11985</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12039" rel="external nofollow noreferrer" target="_blank">#12039</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed calculation of access rights when allow_introspection_functions=0. <a href="https://github.com/ClickHouse/ClickHouse/pull/12031" rel="external nofollow noreferrer" target="_blank">#12031</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed wrong result and potential crash when invoking function <code class="syntax">if</code> with arguments of type <code class="syntax">FixedString</code> with different sizes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11362" rel="external nofollow noreferrer" target="_blank">#11362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12021" rel="external nofollow noreferrer" target="_blank">#12021</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>A query with function <code class="syntax">neighbor</code> as the only returned expression may return empty result if the function is called with offset <code class="syntax">-9223372036854775808</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11367" rel="external nofollow noreferrer" target="_blank">#11367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12019" rel="external nofollow noreferrer" target="_blank">#12019</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed calculation of access rights when allow_ddl=0. <a href="https://github.com/ClickHouse/ClickHouse/pull/12015" rel="external nofollow noreferrer" target="_blank">#12015</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed potential array size overflow in generateRandom that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11371" rel="external nofollow noreferrer" target="_blank">#11371</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12013" rel="external nofollow noreferrer" target="_blank">#12013</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential floating point exception. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11378" rel="external nofollow noreferrer" target="_blank">#11378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12005" rel="external nofollow noreferrer" target="_blank">#12005</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed wrong setting name in log message at server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/11997" rel="external nofollow noreferrer" target="_blank">#11997</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">Query parameter was not set</code> in <code class="syntax">Values</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11918" rel="external nofollow noreferrer" target="_blank">#11918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11936" rel="external nofollow noreferrer" target="_blank">#11936</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Keep aliases for substitutions in query (parametrized queries). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11914" rel="external nofollow noreferrer" target="_blank">#11914</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11916" rel="external nofollow noreferrer" target="_blank">#11916</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed bug with no moves when changing storage policy from default one. <a href="https://github.com/ClickHouse/ClickHouse/pull/11893" rel="external nofollow noreferrer" target="_blank">#11893</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fixed potential floating point exception when parsing <code class="syntax">DateTime64</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11374" rel="external nofollow noreferrer" target="_blank">#11374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11875" rel="external nofollow noreferrer" target="_blank">#11875</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed memory accounting via HTTP interface (can be significant with <code class="syntax">wait_end_of_query=1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11840" rel="external nofollow noreferrer" target="_blank">#11840</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Parse metadata stored in zookeeper before checking for equality. <a href="https://github.com/ClickHouse/ClickHouse/pull/11739" rel="external nofollow noreferrer" target="_blank">#11739</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h4 id="performance-improvement_10">Performance Improvement<a class="headerlink" href="#performance-improvement_10" title="Permanent link"> </a></h4>
<ul>
<li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" rel="external nofollow noreferrer" target="_blank">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" rel="external nofollow noreferrer" target="_blank">#12062</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_12">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_12" title="Permanent link"> </a></h4>
<ul>
<li>Install <code class="syntax">ca-certificates</code> before the first <code class="syntax">apt-get update</code> in Dockerfile. <a href="https://github.com/ClickHouse/ClickHouse/pull/12095" rel="external nofollow noreferrer" target="_blank">#12095</a> (<a href="https://github.com/blinkov" rel="external nofollow noreferrer" target="_blank">Ivan Blinkov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-4-6-53-stable-2020-06-25">ClickHouse release v20.4.6.53-stable 2020-06-25<a class="headerlink" href="#clickhouse-release-v20-4-6-53-stable-2020-06-25" title="Permanent link"> </a></h3>
<h4 id="bug-fix_29">Bug Fix<a class="headerlink" href="#bug-fix_29" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" rel="external nofollow noreferrer" target="_blank">#11608</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" rel="external nofollow noreferrer" target="_blank">#11869</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" rel="external nofollow noreferrer" target="_blank">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" rel="external nofollow noreferrer" target="_blank">#11846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix wrong result of comparison of FixedString with constant String. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11393" rel="external nofollow noreferrer" target="_blank">#11393</a>. This bug appeared in version 20.4. <a href="https://github.com/ClickHouse/ClickHouse/pull/11828" rel="external nofollow noreferrer" target="_blank">#11828</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix wrong result for <code class="syntax">if()</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" rel="external nofollow noreferrer" target="_blank">#11807</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix using too many threads for queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11788" rel="external nofollow noreferrer" target="_blank">#11788</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix unexpected behaviour of queries like <code class="syntax">SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" rel="external nofollow noreferrer" target="_blank">#11753</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Now replicated fetches will be cancelled during metadata alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11744" rel="external nofollow noreferrer" target="_blank">#11744</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" rel="external nofollow noreferrer" target="_blank">#11732</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix <code class="syntax">ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" rel="external nofollow noreferrer" target="_blank">#11697</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" rel="external nofollow noreferrer" target="_blank">#11690</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">LIMIT n WITH TIES</code> usage together with <code class="syntax">ORDER BY</code> statement, which contains aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11689" rel="external nofollow noreferrer" target="_blank">#11689</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix error which leads to an incorrect state of <code class="syntax">system.mutations</code>. It may show that whole mutation is already done but the server still has <code class="syntax">MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11611" rel="external nofollow noreferrer" target="_blank">#11611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11681" rel="external nofollow noreferrer" target="_blank">#11681</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" rel="external nofollow noreferrer" target="_blank">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" rel="external nofollow noreferrer" target="_blank">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" rel="external nofollow noreferrer" target="_blank">#11649</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11352" rel="external nofollow noreferrer" target="_blank">#11352</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11644" rel="external nofollow noreferrer" target="_blank">#11644</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" rel="external nofollow noreferrer" target="_blank">#11638</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. (Probably it is connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" rel="external nofollow noreferrer" target="_blank">#11572</a> somehow). <a href="https://github.com/ClickHouse/ClickHouse/pull/11608" rel="external nofollow noreferrer" target="_blank">#11608</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix error <code class="syntax">Block structure mismatch</code> for queries with sampling reading from <code class="syntax">Buffer</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11602" rel="external nofollow noreferrer" target="_blank">#11602</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" rel="external nofollow noreferrer" target="_blank">#11601</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" rel="external nofollow noreferrer" target="_blank">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" rel="external nofollow noreferrer" target="_blank">#11589</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix error <code class="syntax">Size of offsets does not match size of column</code> for queries with <code class="syntax">PREWHERE column in (subquery)</code> and <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" rel="external nofollow noreferrer" target="_blank">#11580</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed rare segfault in <code class="syntax">SHOW CREATE TABLE</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11490" rel="external nofollow noreferrer" target="_blank">#11490</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11579" rel="external nofollow noreferrer" target="_blank">#11579</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>All queries in HTTP session have had the same query_id. It is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/11578" rel="external nofollow noreferrer" target="_blank">#11578</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" rel="external nofollow noreferrer" target="_blank">#11550</a> (<a href="https://github.com/istarkov" rel="external nofollow noreferrer" target="_blank">Ivan Starkov</a>).</li>
<li>Fix shard_num/replica_num for <code class="syntax">&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href="https://github.com/ClickHouse/ClickHouse/pull/11528" rel="external nofollow noreferrer" target="_blank">#11528</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix race condition which may lead to an exception during table drop. It's a bit tricky and not dangerous at all. If you want an explanation, just notice me in telegram. <a href="https://github.com/ClickHouse/ClickHouse/pull/11523" rel="external nofollow noreferrer" target="_blank">#11523</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" rel="external nofollow noreferrer" target="_blank">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" rel="external nofollow noreferrer" target="_blank">#11496</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" rel="external nofollow noreferrer" target="_blank">#11162</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Get rid of old libunwind patches. <a href="https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012" target="_blank">https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> This allows to disable <code class="syntax">-fno-omit-frame-pointer</code> in <code class="syntax">clang</code> builds that improves performance at least by 1% in average. <a href="https://github.com/ClickHouse/ClickHouse/pull/10761" rel="external nofollow noreferrer" target="_blank">#10761</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix usage of primary key wrapped into a function with 'FINAL' modifier and 'ORDER BY' optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10715" rel="external nofollow noreferrer" target="_blank">#10715</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_13">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_13" title="Permanent link"> </a></h4>
<ul>
<li>Fix several non significant errors in unit tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11262" rel="external nofollow noreferrer" target="_blank">#11262</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href="https://github.com/ClickHouse/ClickHouse/issues/9968" rel="external nofollow noreferrer" target="_blank">#9968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10801" rel="external nofollow noreferrer" target="_blank">#10801</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-4-5-36-stable-2020-06-10">ClickHouse release v20.4.5.36-stable 2020-06-10<a class="headerlink" href="#clickhouse-release-v20-4-5-36-stable-2020-06-10" title="Permanent link"> </a></h3>
<h4 id="bug-fix_30">Bug Fix<a class="headerlink" href="#bug-fix_30" title="Permanent link"> </a></h4>
<ul>
<li>Fix the error <code class="syntax">Data compressed with different methods</code> that can happen if <code class="syntax">min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" rel="external nofollow noreferrer" target="_blank">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" rel="external nofollow noreferrer" target="_blank">#11540</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" rel="external nofollow noreferrer" target="_blank">#11448</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" rel="external nofollow noreferrer" target="_blank">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" rel="external nofollow noreferrer" target="_blank">#11431</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix pointInPolygon with nan as point. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11375" rel="external nofollow noreferrer" target="_blank">#11375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" rel="external nofollow noreferrer" target="_blank">#11421</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>).</li>
<li>Fix potential uninitialized memory read in MergeTree shutdown if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/11420" rel="external nofollow noreferrer" target="_blank">#11420</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" rel="external nofollow noreferrer" target="_blank">#11403</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" rel="external nofollow noreferrer" target="_blank">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" rel="external nofollow noreferrer" target="_blank">#11366</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/11354" rel="external nofollow noreferrer" target="_blank">#11354</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix support for <code class="syntax">\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9933" rel="external nofollow noreferrer" target="_blank">#9933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11350" rel="external nofollow noreferrer" target="_blank">#11350</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential segfault when using <code class="syntax">Lazy</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/11348" rel="external nofollow noreferrer" target="_blank">#11348</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash in <code class="syntax">quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" rel="external nofollow noreferrer" target="_blank">#11337</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Now merges stopped before change metadata in <code class="syntax">ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11335" rel="external nofollow noreferrer" target="_blank">#11335</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Make writing to <code class="syntax">MATERIALIZED VIEW</code> with setting <code class="syntax">parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" rel="external nofollow noreferrer" target="_blank">#11330</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" rel="external nofollow noreferrer" target="_blank">#11318</a> (<a href="https://github.com/devwout" rel="external nofollow noreferrer" target="_blank">Ewout</a>).</li>
<li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" rel="external nofollow noreferrer" target="_blank">#11314</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix insignificant data race in clickhouse-copier. Found by integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11313" rel="external nofollow noreferrer" target="_blank">#11313</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential uninitialized memory in conversion. Example: <code class="syntax">SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" rel="external nofollow noreferrer" target="_blank">#11311</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class="syntax">empty</code> or <code class="syntax">notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" rel="external nofollow noreferrer" target="_blank">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" rel="external nofollow noreferrer" target="_blank">#11303</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bug when query speed estimation can be incorrect and the limit of <code class="syntax">min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class="syntax">max_network_bandwidth</code>, <code class="syntax">max_execution_speed</code> or <code class="syntax">priority</code> settings. Change the default value of <code class="syntax">timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class="syntax">min_execution_speed</code> and <code class="syntax">max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" rel="external nofollow noreferrer" target="_blank">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" rel="external nofollow noreferrer" target="_blank">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" rel="external nofollow noreferrer" target="_blank">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class="syntax">clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" rel="external nofollow noreferrer" target="_blank">#11296</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash when SET DEFAULT ROLE is called with wrong arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10586" rel="external nofollow noreferrer" target="_blank">#10586</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11278" rel="external nofollow noreferrer" target="_blank">#11278</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix crash while reading malformed data in Protobuf format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" rel="external nofollow noreferrer" target="_blank">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" rel="external nofollow noreferrer" target="_blank">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" rel="external nofollow noreferrer" target="_blank">#11258</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed a bug when cache-dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/11233" rel="external nofollow noreferrer" target="_blank">#11233</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix error <code class="syntax">Block structure mismatch in QueryPipeline</code> while reading from <code class="syntax">VIEW</code> with constants in inner query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11181" rel="external nofollow noreferrer" target="_blank">#11181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11205" rel="external nofollow noreferrer" target="_blank">#11205</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible exception <code class="syntax">Invalid status for associated output</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11200" rel="external nofollow noreferrer" target="_blank">#11200</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" rel="external nofollow noreferrer" target="_blank">#11185</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed S3 globbing which could fail in case of more than 1000 keys and some backends. <a href="https://github.com/ClickHouse/ClickHouse/pull/11179" rel="external nofollow noreferrer" target="_blank">#11179</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" rel="external nofollow noreferrer" target="_blank">#11162</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix Kafka performance issue related to reschedules based on limits, which were always applied. <a href="https://github.com/ClickHouse/ClickHouse/pull/11149" rel="external nofollow noreferrer" target="_blank">#11149</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/11145" rel="external nofollow noreferrer" target="_blank">#11145</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href="https://github.com/ClickHouse/ClickHouse/pull/11114" rel="external nofollow noreferrer" target="_blank">#11114</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix predicates optimization for distributed queries (<code class="syntax">enable_optimize_predicate_expression=1</code>) for queries with <code class="syntax">HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" rel="external nofollow noreferrer" target="_blank">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" rel="external nofollow noreferrer" target="_blank">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" rel="external nofollow noreferrer" target="_blank">#10621</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_14">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_14" title="Permanent link"> </a></h4>
<ul>
<li>Fix several flaky integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11355" rel="external nofollow noreferrer" target="_blank">#11355</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-4-4-18-stable-2020-05-26">ClickHouse release v20.4.4.18-stable 2020-05-26<a class="headerlink" href="#clickhouse-release-v20-4-4-18-stable-2020-05-26" title="Permanent link"> </a></h3>
<p>No changes compared to v20.4.3.16-stable.</p>
<h3 id="clickhouse-release-v20-4-3-16-stable-2020-05-23">ClickHouse release v20.4.3.16-stable 2020-05-23<a class="headerlink" href="#clickhouse-release-v20-4-3-16-stable-2020-05-23" title="Permanent link"> </a></h3>
<h4 id="bug-fix_31">Bug Fix<a class="headerlink" href="#bug-fix_31" title="Permanent link"> </a></h4>
<ul>
<li>Removed logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" rel="external nofollow noreferrer" target="_blank">#11109</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed memory leak in registerDiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/11074" rel="external nofollow noreferrer" target="_blank">#11074</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>).</li>
<li>Fixed the potential missed data during termination of Kafka engine table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11048" rel="external nofollow noreferrer" target="_blank">#11048</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed <code class="syntax">parseDateTime64BestEffort</code> argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" rel="external nofollow noreferrer" target="_blank">#11038</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fixed very rare potential use-after-free error in <code class="syntax">MergeTree</code> if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/10986" rel="external nofollow noreferrer" target="_blank">#10986</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/10970" rel="external nofollow noreferrer" target="_blank">#10970</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed metadata (relative path for rename) and data (relative path for symlink) handling for Atomic database. <a href="https://github.com/ClickHouse/ClickHouse/pull/10980" rel="external nofollow noreferrer" target="_blank">#10980</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed server crash on concurrent <code class="syntax">ALTER</code> and <code class="syntax">DROP DATABASE</code> queries with <code class="syntax">Atomic</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10968" rel="external nofollow noreferrer" target="_blank">#10968</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed incorrect raw data size in <code class="syntax">getRawData()</code> method. <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" rel="external nofollow noreferrer" target="_blank">#10964</a> (<a href="https://github.com/ObjatieGroba" rel="external nofollow noreferrer" target="_blank">Igr</a>).</li>
<li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" rel="external nofollow noreferrer" target="_blank">#10952</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed sending partially written files by the <code class="syntax">DistributedBlockOutputStream</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10940" rel="external nofollow noreferrer" target="_blank">#10940</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed crash in <code class="syntax">SELECT count(notNullIn(NULL, []))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10920" rel="external nofollow noreferrer" target="_blank">#10920</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed the hang which was happening sometimes during <code class="syntax">DROP</code> of <code class="syntax">Kafka</code> table engine. (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/10910" rel="external nofollow noreferrer" target="_blank">#10910</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed the impossibility of executing multiple <code class="syntax">ALTER RENAME</code> like <code class="syntax">a TO b, c TO a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10895" rel="external nofollow noreferrer" target="_blank">#10895</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed possible race which could happen when you get result from aggregate function state from multiple thread for the same column. The only way it can happen is when you use <code class="syntax">finalizeAggregation</code> function while reading from table with <code class="syntax">Memory</code> engine which stores <code class="syntax">AggregateFunction</code> state for <code class="syntax">quantile*</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/10890" rel="external nofollow noreferrer" target="_blank">#10890</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed backward compatibility with tuples in Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" rel="external nofollow noreferrer" target="_blank">#10889</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed <code class="syntax">SIGSEGV</code> in <code class="syntax">StringHashTable</code> if such a key does not exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" rel="external nofollow noreferrer" target="_blank">#10870</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">WATCH</code> hangs after <code class="syntax">LiveView</code> table was dropped from database with <code class="syntax">Atomic</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10859" rel="external nofollow noreferrer" target="_blank">#10859</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed bug in <code class="syntax">ReplicatedMergeTree</code> which might cause some <code class="syntax">ALTER</code> on <code class="syntax">OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" rel="external nofollow noreferrer" target="_blank">#10849</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now constraints are updated if the column participating in <code class="syntax">CONSTRAINT</code> expression was renamed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10844" rel="external nofollow noreferrer" target="_blank">#10844</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10847" rel="external nofollow noreferrer" target="_blank">#10847</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed potential read of uninitialized memory in cache-dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/10834" rel="external nofollow noreferrer" target="_blank">#10834</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed columns order after <code class="syntax">Block::sortColumns()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" rel="external nofollow noreferrer" target="_blank">#10826</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the issue with <code class="syntax">ODBC</code> bridge when no quoting of identifiers is requested. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" rel="external nofollow noreferrer" target="_blank">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" rel="external nofollow noreferrer" target="_blank">#10821</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">UBSan</code> and <code class="syntax">MSan</code> report in <code class="syntax">DateLUT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" rel="external nofollow noreferrer" target="_blank">#10798</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed incorrect type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" rel="external nofollow noreferrer" target="_blank">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" rel="external nofollow noreferrer" target="_blank">#10791</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>).</li>
<li>Fixed <code class="syntax">parallel_view_processing</code> behavior. Now all insertions into <code class="syntax">MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" rel="external nofollow noreferrer" target="_blank">#10757</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed combinator <code class="syntax">-OrNull</code> and <code class="syntax">-OrDefault</code> when combined with <code class="syntax">-State</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" rel="external nofollow noreferrer" target="_blank">#10741</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fixed possible buffer overflow in function <code class="syntax">h3EdgeAngle</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10711" rel="external nofollow noreferrer" target="_blank">#10711</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed bug which locks concurrent alters when table has a lot of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10659" rel="external nofollow noreferrer" target="_blank">#10659</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">nullptr</code> dereference in <code class="syntax">StorageBuffer</code> if server was shutdown before table startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/10641" rel="external nofollow noreferrer" target="_blank">#10641</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">optimize_skip_unused_shards</code> with <code class="syntax">LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10611" rel="external nofollow noreferrer" target="_blank">#10611</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed handling condition variable for synchronous mutations. In some cases signals to that condition variable could be lost. <a href="https://github.com/ClickHouse/ClickHouse/pull/10588" rel="external nofollow noreferrer" target="_blank">#10588</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>Fixed possible crash when <code class="syntax">createDictionary()</code> is called before <code class="syntax">loadStoredObject()</code> has finished. <a href="https://github.com/ClickHouse/ClickHouse/pull/10587" rel="external nofollow noreferrer" target="_blank">#10587</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed <code class="syntax">SELECT</code> of column <code class="syntax">ALIAS</code> which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" rel="external nofollow noreferrer" target="_blank">#10563</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Implemented comparison between DateTime64 and String values. <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" rel="external nofollow noreferrer" target="_blank">#10560</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Disable <code class="syntax">GROUP BY</code> sharding_key optimization by default (<code class="syntax">optimize_distributed_group_by_sharding_key</code> had been introduced and turned of by default, due to trickery of sharding_key analyzing, simple example is <code class="syntax">if</code> in sharding key) and fix it for <code class="syntax">WITH ROLLUP/CUBE/TOTALS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10516" rel="external nofollow noreferrer" target="_blank">#10516</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10263" rel="external nofollow noreferrer" target="_blank">#10263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10486" rel="external nofollow noreferrer" target="_blank">#10486</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Added tests about <code class="syntax">max_rows_to_sort</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10268" rel="external nofollow noreferrer" target="_blank">#10268</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added backward compatibility for create bloom filter index. <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" rel="external nofollow noreferrer" target="_blank">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" rel="external nofollow noreferrer" target="_blank">#10569</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-4-2-9-2020-05-12">ClickHouse release v20.4.2.9, 2020-05-12<a class="headerlink" href="#clickhouse-release-v20-4-2-9-2020-05-12" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_8">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_8" title="Permanent link"> </a></h4>
<ul>
<li>System tables (e.g. system.query_log, system.trace_log, system.metric_log) are using compact data part format for parts smaller than 10 MiB in size. Compact data part format is supported since version 20.3. If you are going to downgrade to version less than 20.3, you should manually delete table data for system logs in <code class="syntax">/var/lib/clickhouse/data/system/</code>.</li>
<li>When string comparison involves FixedString and compared arguments are of different sizes, do comparison as if smaller string is padded to the length of the larger. This is intented for SQL compatibility if we imagine that FixedString data type corresponds to SQL CHAR. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9272" rel="external nofollow noreferrer" target="_blank">#9272</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10363" rel="external nofollow noreferrer" target="_blank">#10363</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Make SHOW CREATE TABLE multiline. Now it is more readable and more like MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/10049" rel="external nofollow noreferrer" target="_blank">#10049</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Added a setting <code class="syntax">validate_polygons</code> that is used in <code class="syntax">pointInPolygon</code> function and enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/9857" rel="external nofollow noreferrer" target="_blank">#9857</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h4 id="new-feature_8">New Feature<a class="headerlink" href="#new-feature_8" title="Permanent link"> </a></h4>
<ul>
<li>Add support for secured connection from ClickHouse to Zookeeper <a href="https://github.com/ClickHouse/ClickHouse/pull/10184" rel="external nofollow noreferrer" target="_blank">#10184</a> (<a href="https://github.com/xzkostyan" rel="external nofollow noreferrer" target="_blank">Konstantin Lebedev</a>)</li>
<li>Support custom HTTP handlers. See <a href="https://github.com/ClickHouse/ClickHouse/issues/5436" rel="external nofollow noreferrer" target="_blank">#5436</a> for description. <a href="https://github.com/ClickHouse/ClickHouse/pull/7572" rel="external nofollow noreferrer" target="_blank">#7572</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Add MessagePack Input/Output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/9889" rel="external nofollow noreferrer" target="_blank">#9889</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>)</li>
<li>Add Regexp input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/9196" rel="external nofollow noreferrer" target="_blank">#9196</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>)</li>
<li>Added output format <code class="syntax">Markdown</code> for embedding tables in markdown documents. <a href="https://github.com/ClickHouse/ClickHouse/pull/10317" rel="external nofollow noreferrer" target="_blank">#10317</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>)</li>
<li>Added support for custom settings section in dictionaries. Also fixes issue <a href="https://github.com/ClickHouse/ClickHouse/issues/2829" rel="external nofollow noreferrer" target="_blank">#2829</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10137" rel="external nofollow noreferrer" target="_blank">#10137</a> (<a href="https://github.com/kekekekule" rel="external nofollow noreferrer" target="_blank">Artem Streltsov</a>)</li>
<li>Added custom settings support in DDL-queries for <code class="syntax">CREATE DICTIONARY</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10465" rel="external nofollow noreferrer" target="_blank">#10465</a> (<a href="https://github.com/kekekekule" rel="external nofollow noreferrer" target="_blank">Artem Streltsov</a>)</li>
<li>Add simple server-wide memory profiler that will collect allocation contexts when server memory usage becomes higher than the next allocation threshold. <a href="https://github.com/ClickHouse/ClickHouse/pull/10444" rel="external nofollow noreferrer" target="_blank">#10444</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add setting <code class="syntax">always_fetch_merged_part</code> which restrict replica to merge parts by itself and always prefer dowloading from other replicas. <a href="https://github.com/ClickHouse/ClickHouse/pull/10379" rel="external nofollow noreferrer" target="_blank">#10379</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Add function <code class="syntax">JSONExtractKeysAndValuesRaw</code> which extracts raw data from JSON objects <a href="https://github.com/ClickHouse/ClickHouse/pull/10378" rel="external nofollow noreferrer" target="_blank">#10378</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Add memory usage from OS to <code class="syntax">system.asynchronous_metrics</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10361" rel="external nofollow noreferrer" target="_blank">#10361</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added generic variants for functions <code class="syntax">least</code> and <code class="syntax">greatest</code>. Now they work with arbitrary number of arguments of arbitrary types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4767" rel="external nofollow noreferrer" target="_blank">#4767</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10318" rel="external nofollow noreferrer" target="_blank">#10318</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Now ClickHouse controls timeouts of dictionary sources on its side. Two new settings added to cache dictionary configuration: <code class="syntax">strict_max_lifetime_seconds</code>, which is <code class="syntax">max_lifetime</code> by default, and <code class="syntax">query_wait_timeout_milliseconds</code>, which is one minute by default. The first settings is also useful with <code class="syntax">allow_read_expired_keys</code> settings (to forbid reading very expired keys). <a href="https://github.com/ClickHouse/ClickHouse/pull/10337" rel="external nofollow noreferrer" target="_blank">#10337</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Add log_queries_min_type to filter which entries will be written to query_log <a href="https://github.com/ClickHouse/ClickHouse/pull/10053" rel="external nofollow noreferrer" target="_blank">#10053</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Added function <code class="syntax">isConstant</code>. This function checks whether its argument is constant expression and returns 1 or 0. It is intended for development, debugging and demonstration purposes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10198" rel="external nofollow noreferrer" target="_blank">#10198</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>add joinGetOrNull to return NULL when key is missing instead of returning the default value. <a href="https://github.com/ClickHouse/ClickHouse/pull/10094" rel="external nofollow noreferrer" target="_blank">#10094</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Consider <code class="syntax">NULL</code> to be equal to <code class="syntax">NULL</code> in <code class="syntax">IN</code> operator, if the option <code class="syntax">transform_null_in</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/10085" rel="external nofollow noreferrer" target="_blank">#10085</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>)</li>
<li>Add <code class="syntax">ALTER TABLE ... RENAME COLUMN</code> for MergeTree table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/9948" rel="external nofollow noreferrer" target="_blank">#9948</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Support parallel distributed INSERT SELECT. <a href="https://github.com/ClickHouse/ClickHouse/pull/9759" rel="external nofollow noreferrer" target="_blank">#9759</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>)</li>
<li>Add ability to query Distributed over Distributed (w/o <code class="syntax">distributed_group_by_no_merge</code>) ... <a href="https://github.com/ClickHouse/ClickHouse/pull/9923" rel="external nofollow noreferrer" target="_blank">#9923</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Add function <code class="syntax">arrayReduceInRanges</code> which aggregates array elements in given ranges. <a href="https://github.com/ClickHouse/ClickHouse/pull/9598" rel="external nofollow noreferrer" target="_blank">#9598</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Add Dictionary Status on prometheus exporter. <a href="https://github.com/ClickHouse/ClickHouse/pull/9622" rel="external nofollow noreferrer" target="_blank">#9622</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>Add function <code class="syntax">arrayAUC</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8698" rel="external nofollow noreferrer" target="_blank">#8698</a> (<a href="https://github.com/taiyang-li" rel="external nofollow noreferrer" target="_blank">taiyang-li</a>)</li>
<li>Support <code class="syntax">DROP VIEW</code> statement for better TPC-H compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/9831" rel="external nofollow noreferrer" target="_blank">#9831</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Add 'strict_order' option to windowFunnel() <a href="https://github.com/ClickHouse/ClickHouse/pull/9773" rel="external nofollow noreferrer" target="_blank">#9773</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>)</li>
<li>Support <code class="syntax">DATE</code> and <code class="syntax">TIMESTAMP</code> SQL operators, e.g. <code class="syntax">SELECT date '2001-01-01'</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9691" rel="external nofollow noreferrer" target="_blank">#9691</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
</ul>
<h4 id="experimental-feature_6">Experimental Feature<a class="headerlink" href="#experimental-feature_6" title="Permanent link"> </a></h4>
<ul>
<li>Added experimental database engine Atomic. It supports non-blocking <code class="syntax">DROP</code> and <code class="syntax">RENAME TABLE</code> queries and atomic <code class="syntax">EXCHANGE TABLES t1 AND t2</code> query <a href="https://github.com/ClickHouse/ClickHouse/pull/7512" rel="external nofollow noreferrer" target="_blank">#7512</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Initial support for ReplicatedMergeTree over S3 (it works in suboptimal way) <a href="https://github.com/ClickHouse/ClickHouse/pull/10126" rel="external nofollow noreferrer" target="_blank">#10126</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
</ul>
<h4 id="bug-fix_32">Bug Fix<a class="headerlink" href="#bug-fix_32" title="Permanent link"> </a></h4>
<ul>
<li>Fixed incorrect scalar results inside inner query of <code class="syntax">MATERIALIZED VIEW</code> in case if this query contained dependent table <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" rel="external nofollow noreferrer" target="_blank">#10603</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed bug, which caused HTTP requests to get stuck on client closing connection when <code class="syntax">readonly=2</code> and <code class="syntax">cancel_http_readonly_queries_on_client_close=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" rel="external nofollow noreferrer" target="_blank">#10684</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix segfault in StorageBuffer when exception is thrown on server startup. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10550" rel="external nofollow noreferrer" target="_blank">#10550</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10609" rel="external nofollow noreferrer" target="_blank">#10609</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>The query<code class="syntax">SYSTEM DROP DNS CACHE</code> now also drops caches used to check if user is allowed to connect from some IP addresses <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" rel="external nofollow noreferrer" target="_blank">#10608</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix usage of multiple <code class="syntax">IN</code> operators with an identical set in one query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10539" rel="external nofollow noreferrer" target="_blank">#10539</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" rel="external nofollow noreferrer" target="_blank">#10686</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix crash in <code class="syntax">generateRandom</code> with nested types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10583" rel="external nofollow noreferrer" target="_blank">#10583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10734" rel="external nofollow noreferrer" target="_blank">#10734</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix data corruption for <code class="syntax">LowCardinality(FixedString)</code> key column in <code class="syntax">SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" rel="external nofollow noreferrer" target="_blank">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" rel="external nofollow noreferrer" target="_blank">#10721</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix logic for aggregation_memory_efficient_merge_threads setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" rel="external nofollow noreferrer" target="_blank">#10667</a> (<a href="https://github.com/palasonic1" rel="external nofollow noreferrer" target="_blank">palasonic1</a>)</li>
<li>Fix disappearing totals. Totals could have being filtered if query had <code class="syntax">JOIN</code> or subquery with external <code class="syntax">WHERE</code> condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" rel="external nofollow noreferrer" target="_blank">#10674</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" rel="external nofollow noreferrer" target="_blank">#10698</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix the lack of parallel execution of remote queries with <code class="syntax">distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" rel="external nofollow noreferrer" target="_blank">#10655</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" rel="external nofollow noreferrer" target="_blank">#10664</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix possible incorrect number of rows for queries with <code class="syntax">LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10566" rel="external nofollow noreferrer" target="_blank">#10566</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10709" rel="external nofollow noreferrer" target="_blank">#10709</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10660" rel="external nofollow noreferrer" target="_blank">#10660</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix index corruption, which may occur in some cases after merging compact parts into another compact part. <a href="https://github.com/ClickHouse/ClickHouse/pull/10531" rel="external nofollow noreferrer" target="_blank">#10531</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix the situation, when mutation finished all parts, but hung up in <code class="syntax">is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10526" rel="external nofollow noreferrer" target="_blank">#10526</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix overflow at beginning of unix epoch for timezones with fractional offset from UTC. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9335" rel="external nofollow noreferrer" target="_blank">#9335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10513" rel="external nofollow noreferrer" target="_blank">#10513</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Better diagnostics for input formats. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10204" rel="external nofollow noreferrer" target="_blank">#10204</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10418" rel="external nofollow noreferrer" target="_blank">#10418</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix numeric overflow in <code class="syntax">simpleLinearRegression()</code> over large integers <a href="https://github.com/ClickHouse/ClickHouse/pull/10474" rel="external nofollow noreferrer" target="_blank">#10474</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Fix use-after-free in Distributed shutdown, avoid waiting for sending all batches <a href="https://github.com/ClickHouse/ClickHouse/pull/10491" rel="external nofollow noreferrer" target="_blank">#10491</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Add CA certificates to clickhouse-server docker image <a href="https://github.com/ClickHouse/ClickHouse/pull/10476" rel="external nofollow noreferrer" target="_blank">#10476</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fix a rare endless loop that might have occurred when using the <code class="syntax">addressToLine</code> function or AggregateFunctionState columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/10466" rel="external nofollow noreferrer" target="_blank">#10466</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Handle zookeeper "no node error" during distributed query <a href="https://github.com/ClickHouse/ClickHouse/pull/10050" rel="external nofollow noreferrer" target="_blank">#10050</a> (<a href="https://github.com/Phantomape" rel="external nofollow noreferrer" target="_blank">Daniel Chen</a>)</li>
<li>Fix bug when server cannot attach table after column's default was altered. <a href="https://github.com/ClickHouse/ClickHouse/pull/10441" rel="external nofollow noreferrer" target="_blank">#10441</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Implicitly cast the default expression type to the column type for the ALIAS columns <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" rel="external nofollow noreferrer" target="_blank">#10563</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Don't remove metadata directory if <code class="syntax">ATTACH DATABASE</code> fails <a href="https://github.com/ClickHouse/ClickHouse/pull/10442" rel="external nofollow noreferrer" target="_blank">#10442</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Avoid dependency on system tzdata. Fixes loading of <code class="syntax">Africa/Casablanca</code> timezone on CentOS 8. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10211" rel="external nofollow noreferrer" target="_blank">#10211</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10425" rel="external nofollow noreferrer" target="_blank">#10425</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix some issues if data is inserted with quorum and then gets deleted (DROP PARTITION, TTL, etc.). It led to stuck of INSERTs or false-positive exceptions in SELECTs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9946" rel="external nofollow noreferrer" target="_blank">#9946</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10188" rel="external nofollow noreferrer" target="_blank">#10188</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Check the number and type of arguments when creating BloomFilter index <a href="https://github.com/ClickHouse/ClickHouse/issues/9623" rel="external nofollow noreferrer" target="_blank">#9623</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10431" rel="external nofollow noreferrer" target="_blank">#10431</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Prefer <code class="syntax">fallback_to_stale_replicas</code> over <code class="syntax">skip_unavailable_shards</code>, otherwise when both settings specified and there are no up-to-date replicas the query will fail (patch from @alex-zaitsev ) <a href="https://github.com/ClickHouse/ClickHouse/pull/10422" rel="external nofollow noreferrer" target="_blank">#10422</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix the issue when a query with ARRAY JOIN, ORDER BY and LIMIT may return incomplete result. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10226" rel="external nofollow noreferrer" target="_blank">#10226</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10427" rel="external nofollow noreferrer" target="_blank">#10427</a> (<a href="https://github.com/VadimPlh" rel="external nofollow noreferrer" target="_blank">Vadim Plakhtinskiy</a>)</li>
<li>Add database name to dictionary name after DETACH/ATTACH. Fixes system.dictionaries table and <code class="syntax">SYSTEM RELOAD</code> query <a href="https://github.com/ClickHouse/ClickHouse/pull/10415" rel="external nofollow noreferrer" target="_blank">#10415</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix possible incorrect result for extremes in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/10131" rel="external nofollow noreferrer" target="_blank">#10131</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix possible segfault when the setting <code class="syntax">distributed_group_by_no_merge</code> is enabled (introduced in 20.3.7.46 by <a href="https://github.com/ClickHouse/ClickHouse/issues/10131" rel="external nofollow noreferrer" target="_blank">#10131</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10399" rel="external nofollow noreferrer" target="_blank">#10399</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix wrong flattening of <code class="syntax">Array(Tuple(...))</code> data types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10259" rel="external nofollow noreferrer" target="_blank">#10259</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10390" rel="external nofollow noreferrer" target="_blank">#10390</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN <a href="https://github.com/ClickHouse/ClickHouse/pull/9950" rel="external nofollow noreferrer" target="_blank">#9950</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Fix order of columns after Block::sortColumns() <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" rel="external nofollow noreferrer" target="_blank">#10826</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error in <code class="syntax">ConcatProcessor</code> which may happen in remote query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10381" rel="external nofollow noreferrer" target="_blank">#10381</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Don't make disk reservations for aggregations. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9241" rel="external nofollow noreferrer" target="_blank">#9241</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10375" rel="external nofollow noreferrer" target="_blank">#10375</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix wrong behaviour of datetime functions for timezones that has altered between positive and negative offsets from UTC (e.g. Pacific/Kiritimati). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7202" rel="external nofollow noreferrer" target="_blank">#7202</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10369" rel="external nofollow noreferrer" target="_blank">#10369</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Avoid infinite loop in <code class="syntax">dictIsIn</code> function. Fixes #515 <a href="https://github.com/ClickHouse/ClickHouse/pull/10365" rel="external nofollow noreferrer" target="_blank">#10365</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Disable GROUP BY sharding_key optimization by default and fix it for WITH ROLLUP/CUBE/TOTALS <a href="https://github.com/ClickHouse/ClickHouse/pull/10516" rel="external nofollow noreferrer" target="_blank">#10516</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Check for error code when checking parts and don't mark part as broken if the error is like "not enough memory". Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6269" rel="external nofollow noreferrer" target="_blank">#6269</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10364" rel="external nofollow noreferrer" target="_blank">#10364</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Show information about not loaded dictionaries in system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10234" rel="external nofollow noreferrer" target="_blank">#10234</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fix nullptr dereference in StorageBuffer if server was shutdown before table startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/10641" rel="external nofollow noreferrer" target="_blank">#10641</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed <code class="syntax">DROP</code> vs <code class="syntax">OPTIMIZE</code> race in <code class="syntax">ReplicatedMergeTree</code>. <code class="syntax">DROP</code> could left some garbage in replica path in ZooKeeper if there was concurrent <code class="syntax">OPTIMIZE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10312" rel="external nofollow noreferrer" target="_blank">#10312</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix 'Logical error: CROSS JOIN has expressions' error for queries with comma and names joins mix. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9910" rel="external nofollow noreferrer" target="_blank">#9910</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10311" rel="external nofollow noreferrer" target="_blank">#10311</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix queries with <code class="syntax">max_bytes_before_external_group_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10302" rel="external nofollow noreferrer" target="_blank">#10302</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix the issue with limiting maximum recursion depth in parser in certain cases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10283" rel="external nofollow noreferrer" target="_blank">#10283</a> This fix may introduce minor incompatibility: long and deep queries via clickhouse-client may refuse to work, and you should adjust settings <code class="syntax">max_query_size</code> and <code class="syntax">max_parser_depth</code> accordingly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10295" rel="external nofollow noreferrer" target="_blank">#10295</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Allow to use <code class="syntax">count(*)</code> with multiple JOINs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9853" rel="external nofollow noreferrer" target="_blank">#9853</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10291" rel="external nofollow noreferrer" target="_blank">#10291</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix error <code class="syntax">Pipeline stuck</code> with <code class="syntax">max_rows_to_group_by</code> and <code class="syntax">group_by_overflow_mode = 'break'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10279" rel="external nofollow noreferrer" target="_blank">#10279</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix 'Cannot add column' error while creating <code class="syntax">range_hashed</code> dictionary using DDL query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10093" rel="external nofollow noreferrer" target="_blank">#10093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10235" rel="external nofollow noreferrer" target="_blank">#10235</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix rare possible exception <code class="syntax">Cannot drain connections: cancel first</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10239" rel="external nofollow noreferrer" target="_blank">#10239</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed bug where ClickHouse would throw "Unknown function lambda." error message when user tries to run ALTER UPDATE/DELETE on tables with ENGINE = Replicated*. Check for nondeterministic functions now handles lambda expressions correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10237" rel="external nofollow noreferrer" target="_blank">#10237</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Fixed reasonably rare segfault in StorageSystemTables that happens when SELECT ... FROM system.tables is run on a database with Lazy engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10209" rel="external nofollow noreferrer" target="_blank">#10209</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Fix possible infinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code class="syntax">system.numbers</code> or <code class="syntax">system.zeros</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10206" rel="external nofollow noreferrer" target="_blank">#10206</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed "generateRandom" function for Date type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9973" rel="external nofollow noreferrer" target="_blank">#9973</a>. Fix an edge case when dates with year 2106 are inserted to MergeTree tables with old-style partitioning but partitions are named with year 1970. <a href="https://github.com/ClickHouse/ClickHouse/pull/10218" rel="external nofollow noreferrer" target="_blank">#10218</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Convert types if the table definition of a View does not correspond to the SELECT query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10180" rel="external nofollow noreferrer" target="_blank">#10180</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/10022" rel="external nofollow noreferrer" target="_blank">#10022</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10217" rel="external nofollow noreferrer" target="_blank">#10217</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix <code class="syntax">parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10082" rel="external nofollow noreferrer" target="_blank">#10082</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10214" rel="external nofollow noreferrer" target="_blank">#10214</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/10207" rel="external nofollow noreferrer" target="_blank">#10207</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix move-to-prewhere optimization in presense of arrayJoin functions (in certain cases). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10092" rel="external nofollow noreferrer" target="_blank">#10092</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10195" rel="external nofollow noreferrer" target="_blank">#10195</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix issue with separator appearing in SCRAMBLE for native mysql-connector-java (JDBC) <a href="https://github.com/ClickHouse/ClickHouse/pull/10140" rel="external nofollow noreferrer" target="_blank">#10140</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>)</li>
<li>Fix using the current database for an access checking when the database isn't specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/10192" rel="external nofollow noreferrer" target="_blank">#10192</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fix ALTER of tables with compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10130" rel="external nofollow noreferrer" target="_blank">#10130</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code class="syntax">allow_nondeterministic_mutations</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10186" rel="external nofollow noreferrer" target="_blank">#10186</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fix <code class="syntax">DROP TABLE</code> invoked for dictionary <a href="https://github.com/ClickHouse/ClickHouse/pull/10165" rel="external nofollow noreferrer" target="_blank">#10165</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Convert blocks if structure does not match when doing <code class="syntax">INSERT</code> into Distributed table <a href="https://github.com/ClickHouse/ClickHouse/pull/10135" rel="external nofollow noreferrer" target="_blank">#10135</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>The number of rows was logged incorrectly (as sum across all parts) when inserted block is split by parts with partition key. <a href="https://github.com/ClickHouse/ClickHouse/pull/10138" rel="external nofollow noreferrer" target="_blank">#10138</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add some arguments check and support identifier arguments for MySQL Database Engine <a href="https://github.com/ClickHouse/ClickHouse/pull/10077" rel="external nofollow noreferrer" target="_blank">#10077</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Fix incorrect <code class="syntax">index_granularity_bytes</code> check while creating new replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10098" rel="external nofollow noreferrer" target="_blank">#10098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10121" rel="external nofollow noreferrer" target="_blank">#10121</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix bug in <code class="syntax">CHECK TABLE</code> query when table contain skip indices. <a href="https://github.com/ClickHouse/ClickHouse/pull/10068" rel="external nofollow noreferrer" target="_blank">#10068</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix Distributed-over-Distributed with the only one shard in a nested table <a href="https://github.com/ClickHouse/ClickHouse/pull/9997" rel="external nofollow noreferrer" target="_blank">#9997</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix possible rows loss for queries with <code class="syntax">JOIN</code> and <code class="syntax">UNION ALL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9826" rel="external nofollow noreferrer" target="_blank">#9826</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10113" rel="external nofollow noreferrer" target="_blank">#10113</a>. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/10099" rel="external nofollow noreferrer" target="_blank">#10099</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix bug in dictionary when local clickhouse server is used as source. It may caused memory corruption if types in dictionary and source are not compatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/10071" rel="external nofollow noreferrer" target="_blank">#10071</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed replicated tables startup when updating from an old ClickHouse version where <code class="syntax">/table/replicas/replica_name/metadata</code> node does not exist. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10037" rel="external nofollow noreferrer" target="_blank">#10037</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10095" rel="external nofollow noreferrer" target="_blank">#10095</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix error <code class="syntax">Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code class="syntax">distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with mixed single and two-level aggregation from different shards.  <a href="https://github.com/ClickHouse/ClickHouse/pull/10063" rel="external nofollow noreferrer" target="_blank">#10063</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix deadlock when database with materialized view failed attach at start <a href="https://github.com/ClickHouse/ClickHouse/pull/10054" rel="external nofollow noreferrer" target="_blank">#10054</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix a segmentation fault that could occur in GROUP BY over string keys containing trailing zero bytes (<a href="https://github.com/ClickHouse/ClickHouse/issues/8636" rel="external nofollow noreferrer" target="_blank">#8636</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8925" rel="external nofollow noreferrer" target="_blank">#8925</a>). ... <a href="https://github.com/ClickHouse/ClickHouse/pull/10025" rel="external nofollow noreferrer" target="_blank">#10025</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Fix wrong results of distributed queries when alias could override qualified column name. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9672" rel="external nofollow noreferrer" target="_blank">#9672</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/9714" rel="external nofollow noreferrer" target="_blank">#9714</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9972" rel="external nofollow noreferrer" target="_blank">#9972</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix possible deadlock in <code class="syntax">SYSTEM RESTART REPLICAS</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9955" rel="external nofollow noreferrer" target="_blank">#9955</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix the number of threads used for remote query execution (performance regression, since 20.3). This happened when query from <code class="syntax">Distributed</code> table was executed simultaneously on local and remote shards. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9965" rel="external nofollow noreferrer" target="_blank">#9965</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9971" rel="external nofollow noreferrer" target="_blank">#9971</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed <code class="syntax">DeleteOnDestroy</code> logic in <code class="syntax">ATTACH PART</code> which could lead to automatic removal of attached part and added few tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9410" rel="external nofollow noreferrer" target="_blank">#9410</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix a bug with <code class="syntax">ON CLUSTER</code> DDL queries freezing on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/9927" rel="external nofollow noreferrer" target="_blank">#9927</a> (<a href="https://github.com/garneja" rel="external nofollow noreferrer" target="_blank">Gagan Arneja</a>)</li>
<li>Fix bug in which the necessary tables weren't retrieved at one of the processing stages of queries to some databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9699" rel="external nofollow noreferrer" target="_blank">#9699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9949" rel="external nofollow noreferrer" target="_blank">#9949</a> (<a href="https://github.com/achulkov2" rel="external nofollow noreferrer" target="_blank">achulkov2</a>)</li>
<li>Fix 'Not found column in block' error when <code class="syntax">JOIN</code> appears with <code class="syntax">TOTALS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9839" rel="external nofollow noreferrer" target="_blank">#9839</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9939" rel="external nofollow noreferrer" target="_blank">#9939</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix parsing multiple hosts set in the CREATE USER command <a href="https://github.com/ClickHouse/ClickHouse/pull/9924" rel="external nofollow noreferrer" target="_blank">#9924</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fix <code class="syntax">TRUNCATE</code> for Join table engine (<a href="https://github.com/ClickHouse/ClickHouse/issues/9917" rel="external nofollow noreferrer" target="_blank">#9917</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9920" rel="external nofollow noreferrer" target="_blank">#9920</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Fix race condition between drop and optimize in <code class="syntax">ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9901" rel="external nofollow noreferrer" target="_blank">#9901</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix <code class="syntax">DISTINCT</code> for Distributed when <code class="syntax">optimize_skip_unused_shards</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/9808" rel="external nofollow noreferrer" target="_blank">#9808</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix "scalar does not exist" error in ALTERs (<a href="https://github.com/ClickHouse/ClickHouse/issues/9878" rel="external nofollow noreferrer" target="_blank">#9878</a>). ... <a href="https://github.com/ClickHouse/ClickHouse/pull/9904" rel="external nofollow noreferrer" target="_blank">#9904</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Fix error with qualified names in <code class="syntax">distributed_product_mode=\'local\'</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4756" rel="external nofollow noreferrer" target="_blank">#4756</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9891" rel="external nofollow noreferrer" target="_blank">#9891</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>For INSERT queries shards now do clamp the settings from the initiator to their constraints instead of throwing an exception. This fix allows to send INSERT queries to a shard with another constraints. This change improves fix <a href="https://github.com/ClickHouse/ClickHouse/issues/9447" rel="external nofollow noreferrer" target="_blank">#9447</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9852" rel="external nofollow noreferrer" target="_blank">#9852</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Add some retries when commiting offsets to Kafka broker, since it can reject commit if during <code class="syntax">offsets.commit.timeout.ms</code> there were no enough replicas available for the <code class="syntax">__consumer_offsets</code> topic <a href="https://github.com/ClickHouse/ClickHouse/pull/9884" rel="external nofollow noreferrer" target="_blank">#9884</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fix Distributed engine behavior when virtual columns of the underlying table used in <code class="syntax">WHERE</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9847" rel="external nofollow noreferrer" target="_blank">#9847</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fixed some cases when timezone of the function argument wasn't used properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/9574" rel="external nofollow noreferrer" target="_blank">#9574</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Fix 'Different expressions with the same alias' error when query has PREWHERE and WHERE on distributed table and <code class="syntax">SET distributed_product_mode = 'local'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9871" rel="external nofollow noreferrer" target="_blank">#9871</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9850" rel="external nofollow noreferrer" target="_blank">#9850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9860" rel="external nofollow noreferrer" target="_blank">#9860</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix calculating grants for introspection functions from the setting <code class="syntax">allow_introspection_functions</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9840" rel="external nofollow noreferrer" target="_blank">#9840</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fix max_distributed_connections (w/ and w/o Processors) <a href="https://github.com/ClickHouse/ClickHouse/pull/9673" rel="external nofollow noreferrer" target="_blank">#9673</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix possible exception <code class="syntax">Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code class="syntax">JOIN</code> in case if right joined table had zero rows. Example: <code class="syntax">select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9777" rel="external nofollow noreferrer" target="_blank">#9777</a>. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/9823" rel="external nofollow noreferrer" target="_blank">#9823</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix 'COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query' error in case of subqueries with COMMA JOIN out of tables lists (i.e. in WHERE). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9782" rel="external nofollow noreferrer" target="_blank">#9782</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9830" rel="external nofollow noreferrer" target="_blank">#9830</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix server crashing when <code class="syntax">optimize_skip_unused_shards</code> is set and expression for key can't be converted to its field type <a href="https://github.com/ClickHouse/ClickHouse/pull/9804" rel="external nofollow noreferrer" target="_blank">#9804</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix empty string handling in <code class="syntax">splitByString</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9767" rel="external nofollow noreferrer" target="_blank">#9767</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Fix broken <code class="syntax">ALTER TABLE DELETE COLUMN</code> query for compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/9779" rel="external nofollow noreferrer" target="_blank">#9779</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed missing <code class="syntax">rows_before_limit_at_least</code> for queries over http (with processors pipeline). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9730" rel="external nofollow noreferrer" target="_blank">#9730</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9757" rel="external nofollow noreferrer" target="_blank">#9757</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix excessive memory consumption in <code class="syntax">ALTER</code> queries (mutations). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9533" rel="external nofollow noreferrer" target="_blank">#9533</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/9670" rel="external nofollow noreferrer" target="_blank">#9670</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9754" rel="external nofollow noreferrer" target="_blank">#9754</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix possible permanent "Cannot schedule a task" error. <a href="https://github.com/ClickHouse/ClickHouse/pull/9154" rel="external nofollow noreferrer" target="_blank">#9154</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix bug in backquoting in external dictionaries DDL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9619" rel="external nofollow noreferrer" target="_blank">#9619</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9734" rel="external nofollow noreferrer" target="_blank">#9734</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed data race in <code class="syntax">text_log</code>. It does not correspond to any real bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/9726" rel="external nofollow noreferrer" target="_blank">#9726</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix bug in a replication that does not allow replication to work if the user has executed mutations on the previous version. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9645" rel="external nofollow noreferrer" target="_blank">#9645</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9652" rel="external nofollow noreferrer" target="_blank">#9652</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed incorrect internal function names for <code class="syntax">sumKahan</code> and <code class="syntax">sumWithOverflow</code>. It led to exception while using this functions in remote queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9636" rel="external nofollow noreferrer" target="_blank">#9636</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Add setting <code class="syntax">use_compact_format_in_distributed_parts_names</code> which allows to write files for <code class="syntax">INSERT</code> queries into <code class="syntax">Distributed</code> table with more compact format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9647" rel="external nofollow noreferrer" target="_blank">#9647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9653" rel="external nofollow noreferrer" target="_blank">#9653</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix RIGHT and FULL JOIN with LowCardinality in JOIN keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/9610" rel="external nofollow noreferrer" target="_blank">#9610</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix possible exceptions <code class="syntax">Size of filter does not match size of column</code> and <code class="syntax">Invalid number of rows in Chunk</code> in <code class="syntax">MergeTreeRangeReader</code>. They could appear while executing <code class="syntax">PREWHERE</code> in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/9612" rel="external nofollow noreferrer" target="_blank">#9612</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Allow <code class="syntax">ALTER ON CLUSTER</code> of Distributed tables with internal replication. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3268" rel="external nofollow noreferrer" target="_blank">#3268</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9617" rel="external nofollow noreferrer" target="_blank">#9617</a> (<a href="https://github.com/shinoi2" rel="external nofollow noreferrer" target="_blank">shinoi2</a>)</li>
<li>Fix issue when timezone was not preserved if you write a simple arithmetic expression like <code class="syntax">time + 1</code> (in contrast to an expression like <code class="syntax">time + INTERVAL 1 SECOND</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5743" rel="external nofollow noreferrer" target="_blank">#5743</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9323" rel="external nofollow noreferrer" target="_blank">#9323</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h4 id="improvement_16">Improvement<a class="headerlink" href="#improvement_16" title="Permanent link"> </a></h4>
<ul>
<li>Use time zone when comparing DateTime with string literal. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5206" rel="external nofollow noreferrer" target="_blank">#5206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10515" rel="external nofollow noreferrer" target="_blank">#10515</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Print verbose diagnostic info if Decimal value cannot be parsed from text input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/10205" rel="external nofollow noreferrer" target="_blank">#10205</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add tasks/memory metrics for distributed/buffer schedule pools <a href="https://github.com/ClickHouse/ClickHouse/pull/10449" rel="external nofollow noreferrer" target="_blank">#10449</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Display result as soon as it's ready for SELECT DISTINCT queries in clickhouse-local and HTTP interface. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8951" rel="external nofollow noreferrer" target="_blank">#8951</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9559" rel="external nofollow noreferrer" target="_blank">#9559</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Allow to use <code class="syntax">SAMPLE OFFSET</code> query instead of <code class="syntax">cityHash64(PRIMARY KEY) % N == n</code> for splitting in <code class="syntax">clickhouse-copier</code>. To use this feature, pass <code class="syntax">--experimental-use-sample-offset 1</code> as a command line argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/10414" rel="external nofollow noreferrer" target="_blank">#10414</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Allow to parse BOM in TSV if the first column cannot contain BOM in its value. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10301" rel="external nofollow noreferrer" target="_blank">#10301</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10424" rel="external nofollow noreferrer" target="_blank">#10424</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add Avro nested fields insert support <a href="https://github.com/ClickHouse/ClickHouse/pull/10354" rel="external nofollow noreferrer" target="_blank">#10354</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
<li>Allowed to alter column in non-modifying data mode when the same type is specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/10382" rel="external nofollow noreferrer" target="_blank">#10382</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Auto <code class="syntax">distributed_group_by_no_merge</code> on GROUP BY sharding key (if <code class="syntax">optimize_skip_unused_shards</code> is set) <a href="https://github.com/ClickHouse/ClickHouse/pull/10341" rel="external nofollow noreferrer" target="_blank">#10341</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Optimize queries with LIMIT/LIMIT BY/ORDER BY for distributed with GROUP BY sharding_key <a href="https://github.com/ClickHouse/ClickHouse/pull/10373" rel="external nofollow noreferrer" target="_blank">#10373</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Added a setting <code class="syntax">max_server_memory_usage</code> to limit total memory usage of the server. The metric <code class="syntax">MemoryTracking</code> is now calculated without a drift. The setting <code class="syntax">max_memory_usage_for_all_queries</code> is now obsolete and does nothing. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10293" rel="external nofollow noreferrer" target="_blank">#10293</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10362" rel="external nofollow noreferrer" target="_blank">#10362</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add config option <code class="syntax">system_tables_lazy_load</code>. If it's set to false, then system tables with logs are loaded at the server startup. <a href="https://github.com/Alex-Burmak" rel="external nofollow noreferrer" target="_blank">Alexander Burmak</a>, <a href="https://github.com/DeifyTheGod" rel="external nofollow noreferrer" target="_blank">Svyatoslav Tkhon Il Pak</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/9642" rel="external nofollow noreferrer" target="_blank">#9642</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10359" rel="external nofollow noreferrer" target="_blank">#10359</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Use background thread pool (background_schedule_pool_size) for distributed sends <a href="https://github.com/ClickHouse/ClickHouse/pull/10263" rel="external nofollow noreferrer" target="_blank">#10263</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Use background thread pool for background buffer flushes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10315" rel="external nofollow noreferrer" target="_blank">#10315</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Support for one special case of removing incompletely written parts. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9940" rel="external nofollow noreferrer" target="_blank">#9940</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10221" rel="external nofollow noreferrer" target="_blank">#10221</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Use isInjective() over manual list of such functions for GROUP BY optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10342" rel="external nofollow noreferrer" target="_blank">#10342</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Avoid printing error message in log if client sends RST packet immediately on connect. It is typical behaviour of IPVS balancer with keepalived and VRRP. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/1851" rel="external nofollow noreferrer" target="_blank">#1851</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10274" rel="external nofollow noreferrer" target="_blank">#10274</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Allow to parse <code class="syntax">+inf</code> for floating point types. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1839" rel="external nofollow noreferrer" target="_blank">#1839</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10272" rel="external nofollow noreferrer" target="_blank">#10272</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Implemented <code class="syntax">generateRandom</code> table function for Nested types. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9903" rel="external nofollow noreferrer" target="_blank">#9903</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10219" rel="external nofollow noreferrer" target="_blank">#10219</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Provide <code class="syntax">max_allowed_packed</code> in MySQL compatibility interface that will help some clients to communicate with ClickHouse via MySQL protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/10199" rel="external nofollow noreferrer" target="_blank">#10199</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>)</li>
<li>Allow literals for GLOBAL IN (i.e. <code class="syntax">SELECT * FROM remote('localhost', system.one) WHERE dummy global in (0)</code>) <a href="https://github.com/ClickHouse/ClickHouse/pull/10196" rel="external nofollow noreferrer" target="_blank">#10196</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix various small issues in interactive mode of clickhouse-client <a href="https://github.com/ClickHouse/ClickHouse/pull/10194" rel="external nofollow noreferrer" target="_blank">#10194</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Avoid superfluous dictionaries load (system.tables, DROP/SHOW CREATE TABLE) <a href="https://github.com/ClickHouse/ClickHouse/pull/10164" rel="external nofollow noreferrer" target="_blank">#10164</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Update to RWLock: timeout parameter for getLock() + implementation reworked to be phase fair <a href="https://github.com/ClickHouse/ClickHouse/pull/10073" rel="external nofollow noreferrer" target="_blank">#10073</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Enhanced compatibility with native mysql-connector-java(JDBC) <a href="https://github.com/ClickHouse/ClickHouse/pull/10021" rel="external nofollow noreferrer" target="_blank">#10021</a> (<a href="https://github.com/BohuTANG" rel="external nofollow noreferrer" target="_blank">BohuTANG</a>)</li>
<li>The function <code class="syntax">toString</code> is considered monotonic and can be used for index analysis even when applied in tautological cases with String or LowCardinality(String) argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/10110" rel="external nofollow noreferrer" target="_blank">#10110</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Add <code class="syntax">ON CLUSTER</code> clause support to commands <code class="syntax">{CREATE|DROP} USER/ROLE/ROW POLICY/SETTINGS PROFILE/QUOTA</code>, <code class="syntax">GRANT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9811" rel="external nofollow noreferrer" target="_blank">#9811</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Virtual hosted-style support for S3 URI <a href="https://github.com/ClickHouse/ClickHouse/pull/9998" rel="external nofollow noreferrer" target="_blank">#9998</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Now layout type for dictionaries with no arguments can be specified without round brackets in dictionaries DDL-queries. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10057" rel="external nofollow noreferrer" target="_blank">#10057</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10064" rel="external nofollow noreferrer" target="_blank">#10064</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Add ability to use number ranges with leading zeros in filepath <a href="https://github.com/ClickHouse/ClickHouse/pull/9989" rel="external nofollow noreferrer" target="_blank">#9989</a> (<a href="https://github.com/stavrolia" rel="external nofollow noreferrer" target="_blank">Olga Khvostikova</a>)</li>
<li>Better memory usage in CROSS JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/10029" rel="external nofollow noreferrer" target="_blank">#10029</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Try to connect to all shards in cluster when getting structure of remote table and skip_unavailable_shards is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/7278" rel="external nofollow noreferrer" target="_blank">#7278</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>)</li>
<li>Add <code class="syntax">total_rows</code>/<code class="syntax">total_bytes</code> into the <code class="syntax">system.tables</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/9919" rel="external nofollow noreferrer" target="_blank">#9919</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>System log tables now use polymorpic parts by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/9905" rel="external nofollow noreferrer" target="_blank">#9905</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Add type column into system.settings/merge_tree_settings <a href="https://github.com/ClickHouse/ClickHouse/pull/9909" rel="external nofollow noreferrer" target="_blank">#9909</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Check for available CPU instructions at server startup as early as possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/9888" rel="external nofollow noreferrer" target="_blank">#9888</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove <code class="syntax">ORDER BY</code> stage from mutations because we read from a single ordered part in a single thread. Also add check that the rows in mutation are ordered by sorting key and this order is not violated. <a href="https://github.com/ClickHouse/ClickHouse/pull/9886" rel="external nofollow noreferrer" target="_blank">#9886</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Implement operator LIKE for FixedString at left hand side. This is needed to better support TPC-DS queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9890" rel="external nofollow noreferrer" target="_blank">#9890</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add <code class="syntax">force_optimize_skip_unused_shards_no_nested</code> that will disable <code class="syntax">force_optimize_skip_unused_shards</code> for nested Distributed table <a href="https://github.com/ClickHouse/ClickHouse/pull/9812" rel="external nofollow noreferrer" target="_blank">#9812</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Now columns size is calculated only once for MergeTree data parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/9827" rel="external nofollow noreferrer" target="_blank">#9827</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Evaluate constant expressions for <code class="syntax">optimize_skip_unused_shards</code> (i.e. <code class="syntax">SELECT * FROM foo_dist WHERE key=xxHash32(0)</code>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8846" rel="external nofollow noreferrer" target="_blank">#8846</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Check for using <code class="syntax">Date</code> or <code class="syntax">DateTime</code> column from TTL expressions was removed. <a href="https://github.com/ClickHouse/ClickHouse/pull/9967" rel="external nofollow noreferrer" target="_blank">#9967</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>DiskS3 hard links optimal implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/9760" rel="external nofollow noreferrer" target="_blank">#9760</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>If <code class="syntax">set multiple_joins_rewriter_version = 2</code> enables second version of multiple JOIN rewrites that keeps not clashed column names as is. It supports multiple JOINs with <code class="syntax">USING</code> and allow <code class="syntax">select *</code> for JOINs with subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9739" rel="external nofollow noreferrer" target="_blank">#9739</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Implementation of "non-blocking" alter for StorageMergeTree <a href="https://github.com/ClickHouse/ClickHouse/pull/9606" rel="external nofollow noreferrer" target="_blank">#9606</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Add MergeTree full support for DiskS3 <a href="https://github.com/ClickHouse/ClickHouse/pull/9646" rel="external nofollow noreferrer" target="_blank">#9646</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Extend <code class="syntax">splitByString</code> to support empty strings as separators. <a href="https://github.com/ClickHouse/ClickHouse/pull/9742" rel="external nofollow noreferrer" target="_blank">#9742</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Add a <code class="syntax">timestamp_ns</code> column to <code class="syntax">system.trace_log</code>. It contains a high-definition timestamp of the trace event, and allows to build timelines of thread profiles ("flame charts"). <a href="https://github.com/ClickHouse/ClickHouse/pull/9696" rel="external nofollow noreferrer" target="_blank">#9696</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>When the setting <code class="syntax">send_logs_level</code> is enabled, avoid intermixing of log messages and query progress. <a href="https://github.com/ClickHouse/ClickHouse/pull/9634" rel="external nofollow noreferrer" target="_blank">#9634</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Added support of <code class="syntax">MATERIALIZE TTL IN PARTITION</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9581" rel="external nofollow noreferrer" target="_blank">#9581</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Support complex types inside Avro nested fields <a href="https://github.com/ClickHouse/ClickHouse/pull/10502" rel="external nofollow noreferrer" target="_blank">#10502</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
</ul>
<h4 id="performance-improvement_11">Performance Improvement<a class="headerlink" href="#performance-improvement_11" title="Permanent link"> </a></h4>
<ul>
<li>Better insert logic for right table for Partial MergeJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/10467" rel="external nofollow noreferrer" target="_blank">#10467</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Improved performance of row-oriented formats (more than 10% for CSV and more than 35% for Avro in case of narrow tables). <a href="https://github.com/ClickHouse/ClickHouse/pull/10503" rel="external nofollow noreferrer" target="_blank">#10503</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
<li>Improved performance of queries with explicitly defined sets at right side of IN operator and tuples on the left side. <a href="https://github.com/ClickHouse/ClickHouse/pull/10385" rel="external nofollow noreferrer" target="_blank">#10385</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Use less memory for hash table in HashJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/10416" rel="external nofollow noreferrer" target="_blank">#10416</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Special HashJoin over StorageDictionary. Allow rewrite <code class="syntax">dictGet()</code> functions with JOINs. It's not backward incompatible itself but could uncover <a href="https://github.com/ClickHouse/ClickHouse/issues/8400" rel="external nofollow noreferrer" target="_blank">#8400</a> on some installations. <a href="https://github.com/ClickHouse/ClickHouse/pull/10133" rel="external nofollow noreferrer" target="_blank">#10133</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Enable parallel insert of materialized view when its target table supports. <a href="https://github.com/ClickHouse/ClickHouse/pull/10052" rel="external nofollow noreferrer" target="_blank">#10052</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>)</li>
<li>Improved performance of index analysis with monotonic functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9607" rel="external nofollow noreferrer" target="_blank">#9607</a><a href="https://github.com/ClickHouse/ClickHouse/pull/10026" rel="external nofollow noreferrer" target="_blank">#10026</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Using SSE2 or SSE4.2 SIMD intrinsics to speed up tokenization in bloom filters. <a href="https://github.com/ClickHouse/ClickHouse/pull/9968" rel="external nofollow noreferrer" target="_blank">#9968</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Improved performance of queries with explicitly defined sets at right side of <code class="syntax">IN</code> operator. This fixes performance regression in version 20.3. <a href="https://github.com/ClickHouse/ClickHouse/pull/9740" rel="external nofollow noreferrer" target="_blank">#9740</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Now clickhouse-copier splits each partition in number of pieces and copies them independently. <a href="https://github.com/ClickHouse/ClickHouse/pull/9075" rel="external nofollow noreferrer" target="_blank">#9075</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Adding more aggregation methods. For example TPC-H query 1 will now pick <code class="syntax">FixedHashMap&lt;UInt16, AggregateDataPtr&gt;</code> and gets 25% performance gain <a href="https://github.com/ClickHouse/ClickHouse/pull/9829" rel="external nofollow noreferrer" target="_blank">#9829</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Use single row counter for multiple streams in pre-limit transform. This helps to avoid uniting pipeline streams in queries with <code class="syntax">limit</code> but without <code class="syntax">order by</code> (like <code class="syntax">select f(x) from (select x from t limit 1000000000)</code>) and use multiple threads for further processing. <a href="https://github.com/ClickHouse/ClickHouse/pull/9602" rel="external nofollow noreferrer" target="_blank">#9602</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
</ul>
<h4 id="build-testing-packaging-improvement_15">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_15" title="Permanent link"> </a></h4>
<ul>
<li>Use a fork of AWS SDK libraries from ClickHouse-Extras <a href="https://github.com/ClickHouse/ClickHouse/pull/10527" rel="external nofollow noreferrer" target="_blank">#10527</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Add integration tests for new ALTER RENAME COLUMN query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10654" rel="external nofollow noreferrer" target="_blank">#10654</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>)</li>
<li>Fix possible signed integer overflow in invocation of function <code class="syntax">now64</code> with wrong arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8973" rel="external nofollow noreferrer" target="_blank">#8973</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10511" rel="external nofollow noreferrer" target="_blank">#10511</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Split fuzzer and sanitizer configurations to make build config compatible with Oss-fuzz. <a href="https://github.com/ClickHouse/ClickHouse/pull/10494" rel="external nofollow noreferrer" target="_blank">#10494</a> (<a href="https://github.com/kyprizel" rel="external nofollow noreferrer" target="_blank">kyprizel</a>)</li>
<li>Fixes for clang-tidy on clang-10. <a href="https://github.com/ClickHouse/ClickHouse/pull/10420" rel="external nofollow noreferrer" target="_blank">#10420</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Display absolute paths in error messages. Otherwise KDevelop fails to navigate to correct file and opens a new file instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/10434" rel="external nofollow noreferrer" target="_blank">#10434</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added <code class="syntax">ASAN_OPTIONS</code> environment variable to investigate errors in CI stress tests with Address sanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/10440" rel="external nofollow noreferrer" target="_blank">#10440</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Enable ThinLTO for clang builds (experimental). <a href="https://github.com/ClickHouse/ClickHouse/pull/10435" rel="external nofollow noreferrer" target="_blank">#10435</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove accidential dependency on Z3 that may be introduced if the system has Z3 solver installed. <a href="https://github.com/ClickHouse/ClickHouse/pull/10426" rel="external nofollow noreferrer" target="_blank">#10426</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Move integration tests docker files to docker/ directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/10335" rel="external nofollow noreferrer" target="_blank">#10335</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>)</li>
<li>Allow to use <code class="syntax">clang-10</code> in CI. It ensures that <a href="https://github.com/ClickHouse/ClickHouse/issues/10238" rel="external nofollow noreferrer" target="_blank">#10238</a> is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/10384" rel="external nofollow noreferrer" target="_blank">#10384</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update OpenSSL to upstream master. Fixed the issue when TLS connections may fail with the message <code class="syntax">OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error</code> and <code class="syntax">SSL Exception: error:2400006E:random number generator::error retrieving entropy</code>. The issue was present in version 20.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/8956" rel="external nofollow noreferrer" target="_blank">#8956</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix clang-10 build. <a href="https://github.com/ClickHouse/ClickHouse/issues/10238" rel="external nofollow noreferrer" target="_blank">#10238</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10370" rel="external nofollow noreferrer" target="_blank">#10370</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Add performance test for <a href="https://github.com/ClickHouse/ClickHouse/pull/10052" rel="external nofollow noreferrer" target="_blank">Parallel INSERT for materialized view</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10345" rel="external nofollow noreferrer" target="_blank">#10345</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>)</li>
<li>Fix flaky test <code class="syntax">test_settings_constraints_distributed.test_insert_clamps_settings</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10346" rel="external nofollow noreferrer" target="_blank">#10346</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Add util to test results upload in CI ClickHouse <a href="https://github.com/ClickHouse/ClickHouse/pull/10330" rel="external nofollow noreferrer" target="_blank">#10330</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>)</li>
<li>Convert test results to JSONEachRow format in junit_to_html tool <a href="https://github.com/ClickHouse/ClickHouse/pull/10323" rel="external nofollow noreferrer" target="_blank">#10323</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>)</li>
<li>Update cctz. <a href="https://github.com/ClickHouse/ClickHouse/pull/10215" rel="external nofollow noreferrer" target="_blank">#10215</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Allow to create HTML report from the purest JUnit XML report. <a href="https://github.com/ClickHouse/ClickHouse/pull/10247" rel="external nofollow noreferrer" target="_blank">#10247</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>)</li>
<li>Update the check for minimal compiler version. Fix the root cause of the issue <a href="https://github.com/ClickHouse/ClickHouse/issues/10250" rel="external nofollow noreferrer" target="_blank">#10250</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10256" rel="external nofollow noreferrer" target="_blank">#10256</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Initial support for live view tables over distributed <a href="https://github.com/ClickHouse/ClickHouse/pull/10179" rel="external nofollow noreferrer" target="_blank">#10179</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>)</li>
<li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href="https://github.com/ClickHouse/ClickHouse/issues/9968" rel="external nofollow noreferrer" target="_blank">#9968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10801" rel="external nofollow noreferrer" target="_blank">#10801</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>clickhouse-docker-util <a href="https://github.com/ClickHouse/ClickHouse/pull/10151" rel="external nofollow noreferrer" target="_blank">#10151</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Update pdqsort to recent version <a href="https://github.com/ClickHouse/ClickHouse/pull/10171" rel="external nofollow noreferrer" target="_blank">#10171</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Update libdivide to v3.0 <a href="https://github.com/ClickHouse/ClickHouse/pull/10169" rel="external nofollow noreferrer" target="_blank">#10169</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Add check with enabled polymorphic parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10086" rel="external nofollow noreferrer" target="_blank">#10086</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Add cross-compile build for FreeBSD. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9465" rel="external nofollow noreferrer" target="_blank">#9465</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9643" rel="external nofollow noreferrer" target="_blank">#9643</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Add performance test for <a href="https://github.com/ClickHouse/ClickHouse/issues/6924" rel="external nofollow noreferrer" target="_blank">#6924</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/6980" rel="external nofollow noreferrer" target="_blank">#6980</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Add support of <code class="syntax">/dev/null</code> in the <code class="syntax">File</code> engine for better performance testing <a href="https://github.com/ClickHouse/ClickHouse/pull/8455" rel="external nofollow noreferrer" target="_blank">#8455</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Move all folders inside /dbms one level up <a href="https://github.com/ClickHouse/ClickHouse/pull/9974" rel="external nofollow noreferrer" target="_blank">#9974</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Add a test that checks that read from MergeTree with single thread is performed in order. Addition to <a href="https://github.com/ClickHouse/ClickHouse/issues/9670" rel="external nofollow noreferrer" target="_blank">#9670</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9762" rel="external nofollow noreferrer" target="_blank">#9762</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix the <code class="syntax">00964_live_view_watch_events_heartbeat.py</code> test to avoid race condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/9944" rel="external nofollow noreferrer" target="_blank">#9944</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>)</li>
<li>Fix integration test <code class="syntax">test_settings_constraints</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9962" rel="external nofollow noreferrer" target="_blank">#9962</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Every function in its own file, part 12. <a href="https://github.com/ClickHouse/ClickHouse/pull/9922" rel="external nofollow noreferrer" target="_blank">#9922</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added performance test for the case of extremely slow analysis of array of tuples. <a href="https://github.com/ClickHouse/ClickHouse/pull/9872" rel="external nofollow noreferrer" target="_blank">#9872</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update zstd to 1.4.4. It has some minor improvements in performance and compression ratio. If you run replicas with different versions of ClickHouse you may see reasonable error messages <code class="syntax">Data after merge is not byte-identical to data on another replicas.</code> with explanation. These messages are Ok and you should not worry. <a href="https://github.com/ClickHouse/ClickHouse/pull/10663" rel="external nofollow noreferrer" target="_blank">#10663</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix TSan report in <code class="syntax">system.stack_trace</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9832" rel="external nofollow noreferrer" target="_blank">#9832</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Removed dependency on <code class="syntax">clock_getres</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9833" rel="external nofollow noreferrer" target="_blank">#9833</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added identifier names check with clang-tidy. <a href="https://github.com/ClickHouse/ClickHouse/pull/9799" rel="external nofollow noreferrer" target="_blank">#9799</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update "builder" docker image. This image is not used in CI but is useful for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/9809" rel="external nofollow noreferrer" target="_blank">#9809</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove old <code class="syntax">performance-test</code> tool that is no longer used in CI. <code class="syntax">clickhouse-performance-test</code> is great but now we are using way superior tool that is doing comparison testing with sophisticated statistical formulas to achieve confident results regardless to various changes in environment. <a href="https://github.com/ClickHouse/ClickHouse/pull/9796" rel="external nofollow noreferrer" target="_blank">#9796</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added most of clang-static-analyzer checks. <a href="https://github.com/ClickHouse/ClickHouse/pull/9765" rel="external nofollow noreferrer" target="_blank">#9765</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update Poco to 1.9.3 in preparation for MongoDB URI support. <a href="https://github.com/ClickHouse/ClickHouse/pull/6892" rel="external nofollow noreferrer" target="_blank">#6892</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Fix build with <code class="syntax">-DUSE_STATIC_LIBRARIES=0 -DENABLE_JEMALLOC=0</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9651" rel="external nofollow noreferrer" target="_blank">#9651</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>For change log script, if merge commit was cherry-picked to release branch, take PR name from commit description. <a href="https://github.com/ClickHouse/ClickHouse/pull/9708" rel="external nofollow noreferrer" target="_blank">#9708</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Support <code class="syntax">vX.X-conflicts</code> tag in backport script. <a href="https://github.com/ClickHouse/ClickHouse/pull/9705" rel="external nofollow noreferrer" target="_blank">#9705</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix <code class="syntax">auto-label</code> for backporting script. <a href="https://github.com/ClickHouse/ClickHouse/pull/9685" rel="external nofollow noreferrer" target="_blank">#9685</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Use libc++ in Darwin cross-build to make it consistent with native build. <a href="https://github.com/ClickHouse/ClickHouse/pull/9665" rel="external nofollow noreferrer" target="_blank">#9665</a> (<a href="https://github.com/huiwang" rel="external nofollow noreferrer" target="_blank">Hui Wang</a>)</li>
<li>Fix flacky test <code class="syntax">01017_uniqCombined_memory_usage</code>. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/7236" rel="external nofollow noreferrer" target="_blank">#7236</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9667" rel="external nofollow noreferrer" target="_blank">#9667</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix build for native MacOS Clang compiler <a href="https://github.com/ClickHouse/ClickHouse/pull/9649" rel="external nofollow noreferrer" target="_blank">#9649</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Allow to add various glitches around <code class="syntax">pthread_mutex_lock</code>, <code class="syntax">pthread_mutex_unlock</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9635" rel="external nofollow noreferrer" target="_blank">#9635</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add support for <code class="syntax">clang-tidy</code> in <code class="syntax">packager</code> script. <a href="https://github.com/ClickHouse/ClickHouse/pull/9625" rel="external nofollow noreferrer" target="_blank">#9625</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add ability to use unbundled msgpack. <a href="https://github.com/ClickHouse/ClickHouse/pull/10168" rel="external nofollow noreferrer" target="_blank">#10168</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
</ul>
<h2 id="clickhouse-release-v20-3">ClickHouse release v20.3<a class="headerlink" href="#clickhouse-release-v20-3" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-3-21-2-lts-2020-11-02">ClickHouse release v20.3.21.2-lts, 2020-11-02<a class="headerlink" href="#clickhouse-release-v20-3-21-2-lts-2020-11-02" title="Permanent link"> </a></h3>
<h4 id="bug-fix_33">Bug Fix<a class="headerlink" href="#bug-fix_33" title="Permanent link"> </a></h4>
<ul>
<li>Fix dictGet in sharding_key (and similar places, i.e. when the function context is stored permanently). <a href="https://github.com/ClickHouse/ClickHouse/pull/16205" rel="external nofollow noreferrer" target="_blank">#16205</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix incorrect empty result for query from <code class="syntax">Distributed</code> table if query has <code class="syntax">WHERE</code>, <code class="syntax">PREWHERE</code> and <code class="syntax">GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" rel="external nofollow noreferrer" target="_blank">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" rel="external nofollow noreferrer" target="_blank">#15933</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix missing or excessive headers in <code class="syntax">TSV/CSVWithNames</code> formats. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12504" rel="external nofollow noreferrer" target="_blank">#12504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13343" rel="external nofollow noreferrer" target="_blank">#13343</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-20-6-lts-2020-10-09">ClickHouse release v20.3.20.6-lts, 2020-10-09<a class="headerlink" href="#clickhouse-release-v20-3-20-6-lts-2020-10-09" title="Permanent link"> </a></h3>
<h4 id="bug-fix_34">Bug Fix<a class="headerlink" href="#bug-fix_34" title="Permanent link"> </a></h4>
<ul>
<li>Mutation might hang waiting for some non-existent part after <code class="syntax">MOVE</code> or <code class="syntax">REPLACE PARTITION</code> or, in rare cases, after <code class="syntax">DETACH</code> or <code class="syntax">DROP PARTITION</code>. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15724" rel="external nofollow noreferrer" target="_blank">#15724</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" rel="external nofollow noreferrer" target="_blank">#15537</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix hang of queries with a lot of subqueries to same table of <code class="syntax">MySQL</code> engine. Previously, if there were more than 16 subqueries to same <code class="syntax">MySQL</code> table in query, it hang forever. <a href="https://github.com/ClickHouse/ClickHouse/pull/15299" rel="external nofollow noreferrer" target="_blank">#15299</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix 'Unknown identifier' in GROUP BY when query has JOIN over Merge table. <a href="https://github.com/ClickHouse/ClickHouse/pull/15242" rel="external nofollow noreferrer" target="_blank">#15242</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix to make predicate push down work when subquery contains finalizeAggregation function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" rel="external nofollow noreferrer" target="_blank">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" rel="external nofollow noreferrer" target="_blank">#14937</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Concurrent <code class="syntax">ALTER ... REPLACE/MOVE PARTITION ...</code> queries might cause deadlock. It's fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/13626" rel="external nofollow noreferrer" target="_blank">#13626</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-19-4-lts-2020-09-18">ClickHouse release v20.3.19.4-lts, 2020-09-18<a class="headerlink" href="#clickhouse-release-v20-3-19-4-lts-2020-09-18" title="Permanent link"> </a></h3>
<h4 id="bug-fix_35">Bug Fix<a class="headerlink" href="#bug-fix_35" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare error in <code class="syntax">SELECT</code> queries when the queried column has <code class="syntax">DEFAULT</code> expression which depends on the other column which also has <code class="syntax">DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" rel="external nofollow noreferrer" target="_blank">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" rel="external nofollow noreferrer" target="_blank">#14845</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix bug when <code class="syntax">ALTER UPDATE</code> mutation with Nullable column in assignment expression and constant value (like <code class="syntax">UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" rel="external nofollow noreferrer" target="_blank">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" rel="external nofollow noreferrer" target="_blank">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" rel="external nofollow noreferrer" target="_blank">#14646</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" rel="external nofollow noreferrer" target="_blank">#14603</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
</ul>
<h4 id="improvement_17">Improvement<a class="headerlink" href="#improvement_17" title="Permanent link"> </a></h4>
<ul>
<li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" rel="external nofollow noreferrer" target="_blank">#12183</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-18-10-lts-2020-09-08">ClickHouse release v20.3.18.10-lts, 2020-09-08<a class="headerlink" href="#clickhouse-release-v20-3-18-10-lts-2020-09-08" title="Permanent link"> </a></h3>
<h4 id="bug-fix_36">Bug Fix<a class="headerlink" href="#bug-fix_36" title="Permanent link"> </a></h4>
<ul>
<li>Stop query execution if exception happened in <code class="syntax">PipelineExecutor</code> itself. This could prevent rare possible query hung. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/14334" rel="external nofollow noreferrer" target="_blank">#14334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14402" rel="external nofollow noreferrer" target="_blank">#14402</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed the behaviour when sometimes cache-dictionary returned default value instead of present value from source. <a href="https://github.com/ClickHouse/ClickHouse/pull/13624" rel="external nofollow noreferrer" target="_blank">#13624</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix parsing row policies from users.xml when names of databases or tables contain dots. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" rel="external nofollow noreferrer" target="_blank">#5779</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12527" rel="external nofollow noreferrer" target="_blank">#12527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13199" rel="external nofollow noreferrer" target="_blank">#13199</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix CAST(Nullable(String), Enum()). <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" rel="external nofollow noreferrer" target="_blank">#12745</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed data race in <code class="syntax">text_log</code>. It does not correspond to any real bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/9726" rel="external nofollow noreferrer" target="_blank">#9726</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="improvement_18">Improvement<a class="headerlink" href="#improvement_18" title="Permanent link"> </a></h4>
<ul>
<li>Fix wrong error for long queries. It was possible to get syntax error other than <code class="syntax">Max query size exceeded</code> for correct query. <a href="https://github.com/ClickHouse/ClickHouse/pull/13928" rel="external nofollow noreferrer" target="_blank">#13928</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Return NULL/zero when value is not parsed completely in parseDateTimeBestEffortOrNull/Zero functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7876" rel="external nofollow noreferrer" target="_blank">#7876</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11653" rel="external nofollow noreferrer" target="_blank">#11653</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="performance-improvement_12">Performance Improvement<a class="headerlink" href="#performance-improvement_12" title="Permanent link"> </a></h4>
<ul>
<li>Slightly optimize very short queries with LowCardinality. <a href="https://github.com/ClickHouse/ClickHouse/pull/14129" rel="external nofollow noreferrer" target="_blank">#14129</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_16">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_16" title="Permanent link"> </a></h4>
<ul>
<li>Fix UBSan report (adding zero to nullptr) in HashTable that appeared after migration to clang-10. <a href="https://github.com/ClickHouse/ClickHouse/pull/10638" rel="external nofollow noreferrer" target="_blank">#10638</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-17-173-lts-2020-08-15">ClickHouse release v20.3.17.173-lts, 2020-08-15<a class="headerlink" href="#clickhouse-release-v20-3-17-173-lts-2020-08-15" title="Permanent link"> </a></h3>
<h4 id="bug-fix_37">Bug Fix<a class="headerlink" href="#bug-fix_37" title="Permanent link"> </a></h4>
<ul>
<li>Fix crash in JOIN with StorageMerge and <code class="syntax">set enable_optimize_predicate_expression=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13679" rel="external nofollow noreferrer" target="_blank">#13679</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix invalid return type for comparison of tuples with <code class="syntax">NULL</code> elements. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12461" rel="external nofollow noreferrer" target="_blank">#12461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13420" rel="external nofollow noreferrer" target="_blank">#13420</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix queries with constant columns and <code class="syntax">ORDER BY</code> prefix of primary key. <a href="https://github.com/ClickHouse/ClickHouse/pull/13396" rel="external nofollow noreferrer" target="_blank">#13396</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Return passed number for numbers with MSB set in roundUpToPowerOfTwoOrZero(). <a href="https://github.com/ClickHouse/ClickHouse/pull/13234" rel="external nofollow noreferrer" target="_blank">#13234</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-16-165-lts-2020-08-10">ClickHouse release v20.3.16.165-lts 2020-08-10<a class="headerlink" href="#clickhouse-release-v20-3-16-165-lts-2020-08-10" title="Permanent link"> </a></h3>
<h4 id="bug-fix_38">Bug Fix<a class="headerlink" href="#bug-fix_38" title="Permanent link"> </a></h4>
<ul>
<li>Fixed error in <code class="syntax">parseDateTimeBestEffort</code> function when unix timestamp was passed as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13362" rel="external nofollow noreferrer" target="_blank">#13362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13441" rel="external nofollow noreferrer" target="_blank">#13441</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potentially low performance and slightly incorrect result for <code class="syntax">uniqExact</code>, <code class="syntax">topK</code>, <code class="syntax">sumDistinct</code> and similar aggregate functions called on Float types with <code class="syntax">NaN</code> values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" rel="external nofollow noreferrer" target="_blank">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" rel="external nofollow noreferrer" target="_blank">#13254</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" rel="external nofollow noreferrer" target="_blank">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" rel="external nofollow noreferrer" target="_blank">#13226</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed assert in <code class="syntax">arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" rel="external nofollow noreferrer" target="_blank">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" rel="external nofollow noreferrer" target="_blank">#13224</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" rel="external nofollow noreferrer" target="_blank">#12840</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed possible extra overflow row in data which could appear for queries <code class="syntax">WITH TOTALS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12747" rel="external nofollow noreferrer" target="_blank">#12747</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed performance with large tuples, which are interpreted as functions in <code class="syntax">IN</code> section. The case when user write <code class="syntax">WHERE x IN tuple(1, 2, ...)</code> instead of <code class="syntax">WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" rel="external nofollow noreferrer" target="_blank">#12700</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed memory tracking for input_format_parallel_parsing (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" rel="external nofollow noreferrer" target="_blank">#12672</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/12293" rel="external nofollow noreferrer" target="_blank">#12293</a> allow push predicate when subquery contains with clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/12663" rel="external nofollow noreferrer" target="_blank">#12663</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" rel="external nofollow noreferrer" target="_blank">#10572</a> fix bloom filter index with const expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" rel="external nofollow noreferrer" target="_blank">#12659</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed SIGSEGV in StorageKafka when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" rel="external nofollow noreferrer" target="_blank">#12658</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" rel="external nofollow noreferrer" target="_blank">#12566</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed bug which lead to broken old parts after <code class="syntax">ALTER DELETE</code> query when <code class="syntax">enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" rel="external nofollow noreferrer" target="_blank">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" rel="external nofollow noreferrer" target="_blank">#12543</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Better exception for function <code class="syntax">in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" rel="external nofollow noreferrer" target="_blank">#12529</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" rel="external nofollow noreferrer" target="_blank">#12492</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed the deadlock if <code class="syntax">text_log</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" rel="external nofollow noreferrer" target="_blank">#12452</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed possible segfault if StorageMerge. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" rel="external nofollow noreferrer" target="_blank">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" rel="external nofollow noreferrer" target="_blank">#12401</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed <code class="syntax">TOTALS/ROLLUP/CUBE</code> for aggregate functions with <code class="syntax">-State</code> and <code class="syntax">Nullable</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12163" rel="external nofollow noreferrer" target="_blank">#12163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12376" rel="external nofollow noreferrer" target="_blank">#12376</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed order of columns in <code class="syntax">WITH FILL</code> modifier. Previously order of columns of <code class="syntax">ORDER BY</code> statement wasn't respected. <a href="https://github.com/ClickHouse/ClickHouse/pull/12306" rel="external nofollow noreferrer" target="_blank">#12306</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Avoid "bad cast" exception when there is an expression that filters data by virtual columns (like <code class="syntax">_table</code> in <code class="syntax">Merge</code> tables) or by "index" columns in system tables such as filtering by database name when querying from <code class="syntax">system.tables</code>, and this expression returns <code class="syntax">Nullable</code> type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12166" rel="external nofollow noreferrer" target="_blank">#12166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12305" rel="external nofollow noreferrer" target="_blank">#12305</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Show error after <code class="syntax">TrieDictionary</code> failed to load. <a href="https://github.com/ClickHouse/ClickHouse/pull/12290" rel="external nofollow noreferrer" target="_blank">#12290</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>The function <code class="syntax">arrayFill</code> worked incorrectly for empty arrays that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12263" rel="external nofollow noreferrer" target="_blank">#12263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12279" rel="external nofollow noreferrer" target="_blank">#12279</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Implement conversions to the common type for <code class="syntax">LowCardinality</code> types. This allows to execute UNION ALL of tables with columns of LowCardinality and other columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8212" rel="external nofollow noreferrer" target="_blank">#8212</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4342" rel="external nofollow noreferrer" target="_blank">#4342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12275" rel="external nofollow noreferrer" target="_blank">#12275</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed the behaviour when during multiple sequential inserts in <code class="syntax">StorageFile</code> header for some special types was written more than once. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/6155" rel="external nofollow noreferrer" target="_blank">#6155</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12197" rel="external nofollow noreferrer" target="_blank">#12197</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed logical functions for UInt8 values when they are not equal to 0 or 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/12196" rel="external nofollow noreferrer" target="_blank">#12196</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fixed <code class="syntax">dictGet</code> arguments check during GROUP BY injective functions elimination. <a href="https://github.com/ClickHouse/ClickHouse/pull/12179" rel="external nofollow noreferrer" target="_blank">#12179</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong logic in <code class="syntax">ALTER DELETE</code> that leads to deleting of records when condition evaluates to NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9088" rel="external nofollow noreferrer" target="_blank">#9088</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12106" rel="external nofollow noreferrer" target="_blank">#12106</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12153" rel="external nofollow noreferrer" target="_blank">#12153</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" rel="external nofollow noreferrer" target="_blank">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" rel="external nofollow noreferrer" target="_blank">#12151</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential overflow in integer division. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12119" rel="external nofollow noreferrer" target="_blank">#12119</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12140" rel="external nofollow noreferrer" target="_blank">#12140</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential infinite loop in <code class="syntax">greatCircleDistance</code>, <code class="syntax">geoDistance</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12117" rel="external nofollow noreferrer" target="_blank">#12117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12137" rel="external nofollow noreferrer" target="_blank">#12137</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Avoid <code class="syntax">There is no query</code> exception for materialized views with joins or with subqueries attached to system logs (system.query_log, metric_log, etc) or to engine=Buffer underlying table. <a href="https://github.com/ClickHouse/ClickHouse/pull/12120" rel="external nofollow noreferrer" target="_blank">#12120</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fixed performance for selects with <code class="syntax">UNION</code> caused by wrong limit for the total number of threads. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12030" rel="external nofollow noreferrer" target="_blank">#12030</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12103" rel="external nofollow noreferrer" target="_blank">#12103</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed segfault with <code class="syntax">-StateResample</code> combinators. <a href="https://github.com/ClickHouse/ClickHouse/pull/12092" rel="external nofollow noreferrer" target="_blank">#12092</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed unnecessary limiting the number of threads for selects from <code class="syntax">VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" rel="external nofollow noreferrer" target="_blank">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" rel="external nofollow noreferrer" target="_blank">#12085</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed possible crash while using wrong type for <code class="syntax">PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12053" rel="external nofollow noreferrer" target="_blank">#12053</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12060" rel="external nofollow noreferrer" target="_blank">#12060</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12060" rel="external nofollow noreferrer" target="_blank">#12060</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed error <code class="syntax">Expected single dictionary argument for function</code> for function <code class="syntax">defaultValueOfArgumentType</code> with <code class="syntax">LowCardinality</code> type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11808" rel="external nofollow noreferrer" target="_blank">#11808</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12056" rel="external nofollow noreferrer" target="_blank">#12056</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Tuple(LowCardinality)</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9766" rel="external nofollow noreferrer" target="_blank">#9766</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12055" rel="external nofollow noreferrer" target="_blank">#12055</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Parse tables metadata in parallel when loading database. This fixes slow server startup when there are large number of tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12045" rel="external nofollow noreferrer" target="_blank">#12045</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Make <code class="syntax">topK</code> aggregate function return Enum for Enum types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3740" rel="external nofollow noreferrer" target="_blank">#3740</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12043" rel="external nofollow noreferrer" target="_blank">#12043</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed constraints check if constraint is a constant expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11360" rel="external nofollow noreferrer" target="_blank">#11360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12042" rel="external nofollow noreferrer" target="_blank">#12042</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed incorrect comparison of tuples with <code class="syntax">Nullable</code> columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11985" rel="external nofollow noreferrer" target="_blank">#11985</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12039" rel="external nofollow noreferrer" target="_blank">#12039</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed wrong result and potential crash when invoking function <code class="syntax">if</code> with arguments of type <code class="syntax">FixedString</code> with different sizes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11362" rel="external nofollow noreferrer" target="_blank">#11362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12021" rel="external nofollow noreferrer" target="_blank">#12021</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>A query with function <code class="syntax">neighbor</code> as the only returned expression may return empty result if the function is called with offset <code class="syntax">-9223372036854775808</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11367" rel="external nofollow noreferrer" target="_blank">#11367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12019" rel="external nofollow noreferrer" target="_blank">#12019</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential array size overflow in generateRandom that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11371" rel="external nofollow noreferrer" target="_blank">#11371</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12013" rel="external nofollow noreferrer" target="_blank">#12013</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential floating point exception. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11378" rel="external nofollow noreferrer" target="_blank">#11378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12005" rel="external nofollow noreferrer" target="_blank">#12005</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed wrong setting name in log message at server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/11997" rel="external nofollow noreferrer" target="_blank">#11997</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">Query parameter was not set</code> in <code class="syntax">Values</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11918" rel="external nofollow noreferrer" target="_blank">#11918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11936" rel="external nofollow noreferrer" target="_blank">#11936</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Keep aliases for substitutions in query (parametrized queries). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11914" rel="external nofollow noreferrer" target="_blank">#11914</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11916" rel="external nofollow noreferrer" target="_blank">#11916</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed potential floating point exception when parsing DateTime64. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11374" rel="external nofollow noreferrer" target="_blank">#11374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11875" rel="external nofollow noreferrer" target="_blank">#11875</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed memory accounting via <code class="syntax">HTTP</code> interface (can be significant with <code class="syntax">wait_end_of_query=1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11840" rel="external nofollow noreferrer" target="_blank">#11840</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong result for <code class="syntax">if()</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" rel="external nofollow noreferrer" target="_blank">#11807</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Parse metadata stored in zookeeper before checking for equality. <a href="https://github.com/ClickHouse/ClickHouse/pull/11739" rel="external nofollow noreferrer" target="_blank">#11739</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed <code class="syntax">LIMIT n WITH TIES</code> usage together with <code class="syntax">ORDER BY</code> statement, which contains aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11689" rel="external nofollow noreferrer" target="_blank">#11689</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix potential read of uninitialized memory in cache dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/10834" rel="external nofollow noreferrer" target="_blank">#10834</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="performance-improvement_13">Performance Improvement<a class="headerlink" href="#performance-improvement_13" title="Permanent link"> </a></h4>
<ul>
<li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" rel="external nofollow noreferrer" target="_blank">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" rel="external nofollow noreferrer" target="_blank">#12062</a> (<a href="https://github.com/nvartolomei" rel="external nofollow noreferrer" target="_blank">nvartolomei</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-12-112-lts-2020-06-25">ClickHouse release v20.3.12.112-lts 2020-06-25<a class="headerlink" href="#clickhouse-release-v20-3-12-112-lts-2020-06-25" title="Permanent link"> </a></h3>
<h4 id="bug-fix_39">Bug Fix<a class="headerlink" href="#bug-fix_39" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" rel="external nofollow noreferrer" target="_blank">#11608</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" rel="external nofollow noreferrer" target="_blank">#11869</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" rel="external nofollow noreferrer" target="_blank">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" rel="external nofollow noreferrer" target="_blank">#11846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix using too many threads for queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11788" rel="external nofollow noreferrer" target="_blank">#11788</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix unexpected behaviour of queries like <code class="syntax">SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" rel="external nofollow noreferrer" target="_blank">#11753</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Now replicated fetches will be cancelled during metadata alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11744" rel="external nofollow noreferrer" target="_blank">#11744</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" rel="external nofollow noreferrer" target="_blank">#11732</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix <code class="syntax">ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" rel="external nofollow noreferrer" target="_blank">#11697</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" rel="external nofollow noreferrer" target="_blank">#11690</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix error which leads to an incorrect state of <code class="syntax">system.mutations</code>. It may show that whole mutation is already done but the server still has <code class="syntax">MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11611" rel="external nofollow noreferrer" target="_blank">#11611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11681" rel="external nofollow noreferrer" target="_blank">#11681</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" rel="external nofollow noreferrer" target="_blank">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" rel="external nofollow noreferrer" target="_blank">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" rel="external nofollow noreferrer" target="_blank">#11649</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11352" rel="external nofollow noreferrer" target="_blank">#11352</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11644" rel="external nofollow noreferrer" target="_blank">#11644</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" rel="external nofollow noreferrer" target="_blank">#11638</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. (Probably it is connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" rel="external nofollow noreferrer" target="_blank">#11572</a> somehow). <a href="https://github.com/ClickHouse/ClickHouse/pull/11608" rel="external nofollow noreferrer" target="_blank">#11608</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix error <code class="syntax">Block structure mismatch</code> for queries with sampling reading from <code class="syntax">Buffer</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11602" rel="external nofollow noreferrer" target="_blank">#11602</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" rel="external nofollow noreferrer" target="_blank">#11601</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" rel="external nofollow noreferrer" target="_blank">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" rel="external nofollow noreferrer" target="_blank">#11589</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix error <code class="syntax">Size of offsets does not match size of column</code> for queries with <code class="syntax">PREWHERE column in (subquery)</code> and <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" rel="external nofollow noreferrer" target="_blank">#11580</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>All queries in HTTP session have had the same query_id. It is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/11578" rel="external nofollow noreferrer" target="_blank">#11578</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" rel="external nofollow noreferrer" target="_blank">#11550</a> (<a href="https://github.com/istarkov" rel="external nofollow noreferrer" target="_blank">Ivan Starkov</a>).</li>
<li>Fix shard_num/replica_num for <code class="syntax">&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href="https://github.com/ClickHouse/ClickHouse/pull/11528" rel="external nofollow noreferrer" target="_blank">#11528</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" rel="external nofollow noreferrer" target="_blank">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" rel="external nofollow noreferrer" target="_blank">#11496</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix wrong results of distributed queries when alias could override qualified column name. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9672" rel="external nofollow noreferrer" target="_blank">#9672</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/9714" rel="external nofollow noreferrer" target="_blank">#9714</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9972" rel="external nofollow noreferrer" target="_blank">#9972</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-11-97-lts-2020-06-10">ClickHouse release v20.3.11.97-lts 2020-06-10<a class="headerlink" href="#clickhouse-release-v20-3-11-97-lts-2020-06-10" title="Permanent link"> </a></h3>
<h4 id="new-feature_9">New Feature<a class="headerlink" href="#new-feature_9" title="Permanent link"> </a></h4>
<ul>
<li>Now ClickHouse controls timeouts of dictionary sources on its side. Two new settings added to cache dictionary configuration: <code class="syntax">strict_max_lifetime_seconds</code>, which is <code class="syntax">max_lifetime</code> by default and <code class="syntax">query_wait_timeout_milliseconds</code>, which is one minute by default. The first settings is also useful with <code class="syntax">allow_read_expired_keys</code> settings (to forbid reading very expired keys). <a href="https://github.com/ClickHouse/ClickHouse/pull/10337" rel="external nofollow noreferrer" target="_blank">#10337</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
</ul>
<h4 id="bug-fix_40">Bug Fix<a class="headerlink" href="#bug-fix_40" title="Permanent link"> </a></h4>
<ul>
<li>Fix the error <code class="syntax">Data compressed with different methods</code> that can happen if <code class="syntax">min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" rel="external nofollow noreferrer" target="_blank">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" rel="external nofollow noreferrer" target="_blank">#11540</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" rel="external nofollow noreferrer" target="_blank">#11448</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" rel="external nofollow noreferrer" target="_blank">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" rel="external nofollow noreferrer" target="_blank">#11431</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix pointInPolygon with nan as point. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11375" rel="external nofollow noreferrer" target="_blank">#11375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" rel="external nofollow noreferrer" target="_blank">#11421</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>).</li>
<li>Fix crash in JOIN over LowCarinality(T) and Nullable(T). <a href="https://github.com/ClickHouse/ClickHouse/issues/11380" rel="external nofollow noreferrer" target="_blank">#11380</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11414" rel="external nofollow noreferrer" target="_blank">#11414</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix error code for wrong <code class="syntax">USING</code> key. <a href="https://github.com/ClickHouse/ClickHouse/issues/11373" rel="external nofollow noreferrer" target="_blank">#11373</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11404" rel="external nofollow noreferrer" target="_blank">#11404</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" rel="external nofollow noreferrer" target="_blank">#11403</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Better errors for <code class="syntax">joinGet()</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/11389" rel="external nofollow noreferrer" target="_blank">#11389</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" rel="external nofollow noreferrer" target="_blank">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" rel="external nofollow noreferrer" target="_blank">#11366</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/11354" rel="external nofollow noreferrer" target="_blank">#11354</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix support for <code class="syntax">\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9933" rel="external nofollow noreferrer" target="_blank">#9933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11350" rel="external nofollow noreferrer" target="_blank">#11350</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash in direct selects from StorageJoin (without JOIN) and wrong nullability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11340" rel="external nofollow noreferrer" target="_blank">#11340</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix crash in <code class="syntax">quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" rel="external nofollow noreferrer" target="_blank">#11337</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Now merges stopped before change metadata in <code class="syntax">ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11335" rel="external nofollow noreferrer" target="_blank">#11335</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Make writing to <code class="syntax">MATERIALIZED VIEW</code> with setting <code class="syntax">parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" rel="external nofollow noreferrer" target="_blank">#11330</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" rel="external nofollow noreferrer" target="_blank">#11318</a> (<a href="https://github.com/devwout" rel="external nofollow noreferrer" target="_blank">Ewout</a>).</li>
<li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" rel="external nofollow noreferrer" target="_blank">#11314</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential uninitialized memory in conversion. Example: <code class="syntax">SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" rel="external nofollow noreferrer" target="_blank">#11311</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class="syntax">empty</code> or <code class="syntax">notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" rel="external nofollow noreferrer" target="_blank">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" rel="external nofollow noreferrer" target="_blank">#11303</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bug when query speed estimation can be incorrect and the limit of <code class="syntax">min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class="syntax">max_network_bandwidth</code>, <code class="syntax">max_execution_speed</code> or <code class="syntax">priority</code> settings. Change the default value of <code class="syntax">timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class="syntax">min_execution_speed</code> and <code class="syntax">max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" rel="external nofollow noreferrer" target="_blank">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" rel="external nofollow noreferrer" target="_blank">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" rel="external nofollow noreferrer" target="_blank">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class="syntax">clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" rel="external nofollow noreferrer" target="_blank">#11296</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash while reading malformed data in Protobuf format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" rel="external nofollow noreferrer" target="_blank">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" rel="external nofollow noreferrer" target="_blank">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" rel="external nofollow noreferrer" target="_blank">#11258</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fixed a bug when cache-dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/11233" rel="external nofollow noreferrer" target="_blank">#11233</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fix error <code class="syntax">Block structure mismatch in QueryPipeline</code> while reading from <code class="syntax">VIEW</code> with constants in inner query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11181" rel="external nofollow noreferrer" target="_blank">#11181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11205" rel="external nofollow noreferrer" target="_blank">#11205</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible exception <code class="syntax">Invalid status for associated output</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11200" rel="external nofollow noreferrer" target="_blank">#11200</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix possible error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" rel="external nofollow noreferrer" target="_blank">#11185</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed S3 globbing which could fail in case of more than 1000 keys and some backends. <a href="https://github.com/ClickHouse/ClickHouse/pull/11179" rel="external nofollow noreferrer" target="_blank">#11179</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
<li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" rel="external nofollow noreferrer" target="_blank">#11162</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href="https://github.com/ClickHouse/ClickHouse/pull/11114" rel="external nofollow noreferrer" target="_blank">#11114</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix predicates optimization for distributed queries (<code class="syntax">enable_optimize_predicate_expression=1</code>) for queries with <code class="syntax">HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" rel="external nofollow noreferrer" target="_blank">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" rel="external nofollow noreferrer" target="_blank">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" rel="external nofollow noreferrer" target="_blank">#10621</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Introduce commit retry logic to decrease the possibility of getting duplicates from Kafka in rare cases when offset commit was failed. <a href="https://github.com/ClickHouse/ClickHouse/pull/9884" rel="external nofollow noreferrer" target="_blank">#9884</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h4 id="performance-improvement_14">Performance Improvement<a class="headerlink" href="#performance-improvement_14" title="Permanent link"> </a></h4>
<ul>
<li>Get dictionary and check access rights only once per each call of any function reading external dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/10928" rel="external nofollow noreferrer" target="_blank">#10928</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_17">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_17" title="Permanent link"> </a></h4>
<ul>
<li>Fix several flaky integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11355" rel="external nofollow noreferrer" target="_blank">#11355</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-10-75-lts-2020-05-23">ClickHouse release v20.3.10.75-lts 2020-05-23<a class="headerlink" href="#clickhouse-release-v20-3-10-75-lts-2020-05-23" title="Permanent link"> </a></h3>
<h4 id="bug-fix_41">Bug Fix<a class="headerlink" href="#bug-fix_41" title="Permanent link"> </a></h4>
<ul>
<li>Removed logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" rel="external nofollow noreferrer" target="_blank">#11109</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">parseDateTime64BestEffort</code> argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" rel="external nofollow noreferrer" target="_blank">#11038</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fixed incorrect raw data size in method <code class="syntax">getRawData()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" rel="external nofollow noreferrer" target="_blank">#10964</a> (<a href="https://github.com/ObjatieGroba" rel="external nofollow noreferrer" target="_blank">Igr</a>).</li>
<li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of <code class="syntax">GROUP BY</code> result is large and aggregation is performed by a single <code class="syntax">String</code> field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" rel="external nofollow noreferrer" target="_blank">#10952</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed backward compatibility with tuples in <code class="syntax">Distributed</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" rel="external nofollow noreferrer" target="_blank">#10889</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed <code class="syntax">SIGSEGV</code> in <code class="syntax">StringHashTable</code> if such a key does not exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" rel="external nofollow noreferrer" target="_blank">#10870</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bug in <code class="syntax">ReplicatedMergeTree</code> which might cause some <code class="syntax">ALTER</code> on <code class="syntax">OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" rel="external nofollow noreferrer" target="_blank">#10849</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed columns order after <code class="syntax">Block::sortColumns()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" rel="external nofollow noreferrer" target="_blank">#10826</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed the issue with <code class="syntax">ODBC</code> bridge when no quoting of identifiers is requested. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" rel="external nofollow noreferrer" target="_blank">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" rel="external nofollow noreferrer" target="_blank">#10821</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed <code class="syntax">UBSan</code> and <code class="syntax">MSan</code> report in <code class="syntax">DateLUT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" rel="external nofollow noreferrer" target="_blank">#10798</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed incorrect type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" rel="external nofollow noreferrer" target="_blank">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" rel="external nofollow noreferrer" target="_blank">#10791</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
<li>Fixed <code class="syntax">parallel_view_processing</code> behavior. Now all insertions into <code class="syntax">MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" rel="external nofollow noreferrer" target="_blank">#10757</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed combinator -<code class="syntax">OrNull</code> and <code class="syntax">-OrDefault</code> when combined with <code class="syntax">-State</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" rel="external nofollow noreferrer" target="_blank">#10741</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fixed crash in <code class="syntax">generateRandom</code> with nested types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10583" rel="external nofollow noreferrer" target="_blank">#10583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10734" rel="external nofollow noreferrer" target="_blank">#10734</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed data corruption for <code class="syntax">LowCardinality(FixedString)</code> key column in <code class="syntax">SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" rel="external nofollow noreferrer" target="_blank">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" rel="external nofollow noreferrer" target="_blank">#10721</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed possible buffer overflow in function <code class="syntax">h3EdgeAngle</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10711" rel="external nofollow noreferrer" target="_blank">#10711</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" rel="external nofollow noreferrer" target="_blank">#10674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" rel="external nofollow noreferrer" target="_blank">#10698</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed multiple usages of <code class="syntax">IN</code> operator with the identical set in one query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" rel="external nofollow noreferrer" target="_blank">#10686</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed bug, which causes http requests stuck on client close when <code class="syntax">readonly=2</code> and <code class="syntax">cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7939" rel="external nofollow noreferrer" target="_blank">#7939</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7019" rel="external nofollow noreferrer" target="_blank">#7019</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7736" rel="external nofollow noreferrer" target="_blank">#7736</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7091" rel="external nofollow noreferrer" target="_blank">#7091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" rel="external nofollow noreferrer" target="_blank">#10684</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed order of parameters in <code class="syntax">AggregateTransform</code> constructor. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" rel="external nofollow noreferrer" target="_blank">#10667</a> (<a href="https://github.com/palasonic1" rel="external nofollow noreferrer" target="_blank">palasonic1</a>).</li>
<li>Fixed the lack of parallel execution of remote queries with <code class="syntax">distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" rel="external nofollow noreferrer" target="_blank">#10655</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" rel="external nofollow noreferrer" target="_blank">#10664</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed possible incorrect number of rows for queries with <code class="syntax">LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10566" rel="external nofollow noreferrer" target="_blank">#10566</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10709" rel="external nofollow noreferrer" target="_blank">#10709</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10660" rel="external nofollow noreferrer" target="_blank">#10660</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed a bug which locks concurrent alters when table has a lot of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10659" rel="external nofollow noreferrer" target="_blank">#10659</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed a bug when on <code class="syntax">SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" rel="external nofollow noreferrer" target="_blank">#10608</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed incorrect scalar results inside inner query of <code class="syntax">MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" rel="external nofollow noreferrer" target="_blank">#10603</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed <code class="syntax">SELECT</code> of column <code class="syntax">ALIAS</code> which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" rel="external nofollow noreferrer" target="_blank">#10563</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Implemented comparison between DateTime64 and String values. <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" rel="external nofollow noreferrer" target="_blank">#10560</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fixed index corruption, which may occur in some cases after merge compact parts into another compact part. <a href="https://github.com/ClickHouse/ClickHouse/pull/10531" rel="external nofollow noreferrer" target="_blank">#10531</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fixed the situation, when mutation finished all parts, but hung up in <code class="syntax">is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10526" rel="external nofollow noreferrer" target="_blank">#10526</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed overflow at beginning of unix epoch for timezones with fractional offset from <code class="syntax">UTC</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9335" rel="external nofollow noreferrer" target="_blank">#9335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10513" rel="external nofollow noreferrer" target="_blank">#10513</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed improper shutdown of <code class="syntax">Distributed</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/10491" rel="external nofollow noreferrer" target="_blank">#10491</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed numeric overflow in <code class="syntax">simpleLinearRegression</code> over large integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/10474" rel="external nofollow noreferrer" target="_blank">#10474</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_18">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_18" title="Permanent link"> </a></h4>
<ul>
<li>Fix UBSan report in LZ4 library. <a href="https://github.com/ClickHouse/ClickHouse/pull/10631" rel="external nofollow noreferrer" target="_blank">#10631</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix clang-10 build. <a href="https://github.com/ClickHouse/ClickHouse/issues/10238" rel="external nofollow noreferrer" target="_blank">#10238</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10370" rel="external nofollow noreferrer" target="_blank">#10370</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Added failing tests about <code class="syntax">max_rows_to_sort</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10268" rel="external nofollow noreferrer" target="_blank">#10268</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Added some improvements in printing diagnostic info in input formats. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10204" rel="external nofollow noreferrer" target="_blank">#10204</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10418" rel="external nofollow noreferrer" target="_blank">#10418</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Added CA certificates to clickhouse-server docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/10476" rel="external nofollow noreferrer" target="_blank">#10476</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h4 id="bug-fix_42">Bug fix<a class="headerlink" href="#bug-fix_42" title="Permanent link"> </a></h4>
<ul>
<li>Fix error <code class="syntax">the BloomFilter false positive must be a double number between 0 and 1</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" rel="external nofollow noreferrer" target="_blank">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" rel="external nofollow noreferrer" target="_blank">#10569</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-8-53-2020-04-23">ClickHouse release v20.3.8.53, 2020-04-23<a class="headerlink" href="#clickhouse-release-v20-3-8-53-2020-04-23" title="Permanent link"> </a></h3>
<h4 id="bug-fix_43">Bug Fix<a class="headerlink" href="#bug-fix_43" title="Permanent link"> </a></h4>
<ul>
<li>Fixed wrong behaviour of datetime functions for timezones that has altered between positive and negative offsets from UTC (e.g. Pacific/Kiritimati). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7202" rel="external nofollow noreferrer" target="_blank">#7202</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10369" rel="external nofollow noreferrer" target="_blank">#10369</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix possible segfault with <code class="syntax">distributed_group_by_no_merge</code> enabled (introduced in 20.3.7.46 by <a href="https://github.com/ClickHouse/ClickHouse/issues/10131" rel="external nofollow noreferrer" target="_blank">#10131</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10399" rel="external nofollow noreferrer" target="_blank">#10399</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix wrong flattening of <code class="syntax">Array(Tuple(...))</code> data types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10259" rel="external nofollow noreferrer" target="_blank">#10259</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10390" rel="external nofollow noreferrer" target="_blank">#10390</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Drop disks reservation in Aggregator. This fixes bug in disk space reservation, which may cause big external aggregation to fail even if it could be completed successfully <a href="https://github.com/ClickHouse/ClickHouse/pull/10375" rel="external nofollow noreferrer" target="_blank">#10375</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fixed <code class="syntax">DROP</code> vs <code class="syntax">OPTIMIZE</code> race in <code class="syntax">ReplicatedMergeTree</code>. <code class="syntax">DROP</code> could left some garbage in replica path in ZooKeeper if there was concurrent <code class="syntax">OPTIMIZE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10312" rel="external nofollow noreferrer" target="_blank">#10312</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix bug when server cannot attach table after column default was altered. <a href="https://github.com/ClickHouse/ClickHouse/pull/10441" rel="external nofollow noreferrer" target="_blank">#10441</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Do not remove metadata directory when attach database fails before loading tables.  <a href="https://github.com/ClickHouse/ClickHouse/pull/10442" rel="external nofollow noreferrer" target="_blank">#10442</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Fixed several bugs when some data was inserted with quorum, then deleted somehow (DROP PARTITION, TTL) and this leaded to the stuck of INSERTs or false-positive exceptions in SELECTs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9946" rel="external nofollow noreferrer" target="_blank">#9946</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10188" rel="external nofollow noreferrer" target="_blank">#10188</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error in <code class="syntax">ConcatProcessor</code> which could have happened in remote query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10381" rel="external nofollow noreferrer" target="_blank">#10381</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed wrong behavior in HashTable that caused compilation error when trying to read HashMap from buffer. <a href="https://github.com/ClickHouse/ClickHouse/pull/10386" rel="external nofollow noreferrer" target="_blank">#10386</a> (<a href="https://github.com/palasonic1" rel="external nofollow noreferrer" target="_blank">palasonic1</a>)</li>
<li>Allow to use <code class="syntax">count(*)</code> with multiple JOINs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9853" rel="external nofollow noreferrer" target="_blank">#9853</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10291" rel="external nofollow noreferrer" target="_blank">#10291</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Prefer <code class="syntax">fallback_to_stale_replicas</code> over <code class="syntax">skip_unavailable_shards</code>, otherwise when both settings specified and there are no up-to-date replicas the query will fail (patch from @alex-zaitsev). Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/2564" rel="external nofollow noreferrer" target="_blank">#2564</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10422" rel="external nofollow noreferrer" target="_blank">#10422</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix the issue when a query with ARRAY JOIN, ORDER BY and LIMIT may return incomplete result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10226" rel="external nofollow noreferrer" target="_blank">#10226</a>. Author: <a href="https://github.com/VadimPlh" rel="external nofollow noreferrer" target="_blank">Vadim Plakhtinskiy</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10427" rel="external nofollow noreferrer" target="_blank">#10427</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Check the number and type of arguments when creating BloomFilter index <a href="https://github.com/ClickHouse/ClickHouse/issues/9623" rel="external nofollow noreferrer" target="_blank">#9623</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10431" rel="external nofollow noreferrer" target="_blank">#10431</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
</ul>
<h4 id="performance-improvement_15">Performance Improvement<a class="headerlink" href="#performance-improvement_15" title="Permanent link"> </a></h4>
<ul>
<li>Improved performance of queries with explicitly defined sets at right side of <code class="syntax">IN</code> operator and tuples in the left side. This fixes performance regression in version 20.3. <a href="https://github.com/ClickHouse/ClickHouse/pull/9740" rel="external nofollow noreferrer" target="_blank">#9740</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/10385" rel="external nofollow noreferrer" target="_blank">#10385</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
</ul>
<h3 id="clickhouse-release-v20-3-7-46-2020-04-17">ClickHouse release v20.3.7.46, 2020-04-17<a class="headerlink" href="#clickhouse-release-v20-3-7-46-2020-04-17" title="Permanent link"> </a></h3>
<h4 id="bug-fix_44">Bug Fix<a class="headerlink" href="#bug-fix_44" title="Permanent link"> </a></h4>
<ul>
<li>Fix <code class="syntax">Logical error: CROSS JOIN has expressions</code> error for queries with comma and names joins mix. <a href="https://github.com/ClickHouse/ClickHouse/pull/10311" rel="external nofollow noreferrer" target="_blank">#10311</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix queries with <code class="syntax">max_bytes_before_external_group_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10302" rel="external nofollow noreferrer" target="_blank">#10302</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix move-to-prewhere optimization in presense of arrayJoin functions (in certain cases). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10092" rel="external nofollow noreferrer" target="_blank">#10092</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10195" rel="external nofollow noreferrer" target="_blank">#10195</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code class="syntax">allow_nondeterministic_mutations</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10186" rel="external nofollow noreferrer" target="_blank">#10186</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-6-40-2020-04-16">ClickHouse release v20.3.6.40, 2020-04-16<a class="headerlink" href="#clickhouse-release-v20-3-6-40-2020-04-16" title="Permanent link"> </a></h3>
<h4 id="new-feature_10">New Feature<a class="headerlink" href="#new-feature_10" title="Permanent link"> </a></h4>
<ul>
<li>Added function <code class="syntax">isConstant</code>. This function checks whether its argument is constant expression and returns 1 or 0. It is intended for development, debugging and demonstration purposes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10198" rel="external nofollow noreferrer" target="_blank">#10198</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="bug-fix_45">Bug Fix<a class="headerlink" href="#bug-fix_45" title="Permanent link"> </a></h4>
<ul>
<li>Fix error <code class="syntax">Pipeline stuck</code> with <code class="syntax">max_rows_to_group_by</code> and <code class="syntax">group_by_overflow_mode = 'break'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10279" rel="external nofollow noreferrer" target="_blank">#10279</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix rare possible exception <code class="syntax">Cannot drain connections: cancel first</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10239" rel="external nofollow noreferrer" target="_blank">#10239</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed bug where ClickHouse would throw "Unknown function lambda." error message when user tries to run ALTER UPDATE/DELETE on tables with ENGINE = Replicated*. Check for nondeterministic functions now handles lambda expressions correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10237" rel="external nofollow noreferrer" target="_blank">#10237</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fixed "generateRandom" function for Date type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9973" rel="external nofollow noreferrer" target="_blank">#9973</a>. Fix an edge case when dates with year 2106 are inserted to MergeTree tables with old-style partitioning but partitions are named with year 1970. <a href="https://github.com/ClickHouse/ClickHouse/pull/10218" rel="external nofollow noreferrer" target="_blank">#10218</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Convert types if the table definition of a View does not correspond to the SELECT query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10180" rel="external nofollow noreferrer" target="_blank">#10180</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/10022" rel="external nofollow noreferrer" target="_blank">#10022</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10217" rel="external nofollow noreferrer" target="_blank">#10217</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix <code class="syntax">parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10082" rel="external nofollow noreferrer" target="_blank">#10082</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10214" rel="external nofollow noreferrer" target="_blank">#10214</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/10207" rel="external nofollow noreferrer" target="_blank">#10207</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix possible inifinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code class="syntax">system.numbers</code> or <code class="syntax">system.zeros</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10206" rel="external nofollow noreferrer" target="_blank">#10206</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix using the current database for access checking when the database isn't specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/10192" rel="external nofollow noreferrer" target="_blank">#10192</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Convert blocks if structure does not match on INSERT into Distributed(). <a href="https://github.com/ClickHouse/ClickHouse/pull/10135" rel="external nofollow noreferrer" target="_blank">#10135</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix possible incorrect result for extremes in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/10131" rel="external nofollow noreferrer" target="_blank">#10131</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix some kinds of alters with compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10130" rel="external nofollow noreferrer" target="_blank">#10130</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix incorrect <code class="syntax">index_granularity_bytes</code> check while creating new replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10098" rel="external nofollow noreferrer" target="_blank">#10098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10121" rel="external nofollow noreferrer" target="_blank">#10121</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix SIGSEGV on INSERT into Distributed table when its structure differs from the underlying tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10105" rel="external nofollow noreferrer" target="_blank">#10105</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix possible rows loss for queries with <code class="syntax">JOIN</code> and <code class="syntax">UNION ALL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9826" rel="external nofollow noreferrer" target="_blank">#9826</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10113" rel="external nofollow noreferrer" target="_blank">#10113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10099" rel="external nofollow noreferrer" target="_blank">#10099</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed replicated tables startup when updating from an old ClickHouse version where <code class="syntax">/table/replicas/replica_name/metadata</code> node does not exist. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10037" rel="external nofollow noreferrer" target="_blank">#10037</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10095" rel="external nofollow noreferrer" target="_blank">#10095</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Add some arguments check and support identifier arguments for MySQL Database Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10077" rel="external nofollow noreferrer" target="_blank">#10077</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix bug in clickhouse dictionary source from localhost clickhouse server. The bug may lead to memory corruption if types in dictionary and source are not compatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/10071" rel="external nofollow noreferrer" target="_blank">#10071</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix bug in <code class="syntax">CHECK TABLE</code> query when table contain skip indices. <a href="https://github.com/ClickHouse/ClickHouse/pull/10068" rel="external nofollow noreferrer" target="_blank">#10068</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix error <code class="syntax">Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code class="syntax">distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with different level from different shards (mixed single and two level aggregation). <a href="https://github.com/ClickHouse/ClickHouse/pull/10063" rel="external nofollow noreferrer" target="_blank">#10063</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix a segmentation fault that could occur in GROUP BY over string keys containing trailing zero bytes (<a href="https://github.com/ClickHouse/ClickHouse/issues/8636" rel="external nofollow noreferrer" target="_blank">#8636</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8925" rel="external nofollow noreferrer" target="_blank">#8925</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10025" rel="external nofollow noreferrer" target="_blank">#10025</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fix the number of threads used for remote query execution (performance regression, since 20.3). This happened when query from <code class="syntax">Distributed</code> table was executed simultaneously on local and remote shards. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9965" rel="external nofollow noreferrer" target="_blank">#9965</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9971" rel="external nofollow noreferrer" target="_blank">#9971</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix bug in which the necessary tables weren't retrieved at one of the processing stages of queries to some databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9699" rel="external nofollow noreferrer" target="_blank">#9699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9949" rel="external nofollow noreferrer" target="_blank">#9949</a> (<a href="https://github.com/achulkov2" rel="external nofollow noreferrer" target="_blank">achulkov2</a>).</li>
<li>Fix 'Not found column in block' error when <code class="syntax">JOIN</code> appears with <code class="syntax">TOTALS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9839" rel="external nofollow noreferrer" target="_blank">#9839</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9939" rel="external nofollow noreferrer" target="_blank">#9939</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix a bug with <code class="syntax">ON CLUSTER</code> DDL queries freezing on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/9927" rel="external nofollow noreferrer" target="_blank">#9927</a> (<a href="https://github.com/garneja" rel="external nofollow noreferrer" target="_blank">Gagan Arneja</a>).</li>
<li>Fix parsing multiple hosts set in the CREATE USER command, e.g. <code class="syntax">CREATE USER user6 HOST NAME REGEXP 'lo.?*host', NAME REGEXP 'lo*host'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9924" rel="external nofollow noreferrer" target="_blank">#9924</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix <code class="syntax">TRUNCATE</code> for Join table engine (<a href="https://github.com/ClickHouse/ClickHouse/issues/9917" rel="external nofollow noreferrer" target="_blank">#9917</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9920" rel="external nofollow noreferrer" target="_blank">#9920</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix "scalar does not exist" error in ALTERs (<a href="https://github.com/ClickHouse/ClickHouse/issues/9878" rel="external nofollow noreferrer" target="_blank">#9878</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9904" rel="external nofollow noreferrer" target="_blank">#9904</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix race condition between drop and optimize in <code class="syntax">ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9901" rel="external nofollow noreferrer" target="_blank">#9901</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix error with qualified names in <code class="syntax">distributed_product_mode='local'</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4756" rel="external nofollow noreferrer" target="_blank">#4756</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9891" rel="external nofollow noreferrer" target="_blank">#9891</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix calculating grants for introspection functions from the setting 'allow_introspection_functions'. <a href="https://github.com/ClickHouse/ClickHouse/pull/9840" rel="external nofollow noreferrer" target="_blank">#9840</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_19">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_19" title="Permanent link"> </a></h4>
<ul>
<li>Fix integration test <code class="syntax">test_settings_constraints</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9962" rel="external nofollow noreferrer" target="_blank">#9962</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Removed dependency on <code class="syntax">clock_getres</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9833" rel="external nofollow noreferrer" target="_blank">#9833</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-5-21-2020-03-27">ClickHouse release v20.3.5.21, 2020-03-27<a class="headerlink" href="#clickhouse-release-v20-3-5-21-2020-03-27" title="Permanent link"> </a></h3>
<h4 id="bug-fix_46">Bug Fix<a class="headerlink" href="#bug-fix_46" title="Permanent link"> </a></h4>
<ul>
<li>Fix 'Different expressions with the same alias' error when query has PREWHERE and WHERE on distributed table and <code class="syntax">SET distributed_product_mode = 'local'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9871" rel="external nofollow noreferrer" target="_blank">#9871</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9850" rel="external nofollow noreferrer" target="_blank">#9850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9860" rel="external nofollow noreferrer" target="_blank">#9860</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>For INSERT queries shard now clamps the settings got from the initiator to the shard's constaints instead of throwing an exception. This fix allows to send INSERT queries to a shard with another constraints. This change improves fix <a href="https://github.com/ClickHouse/ClickHouse/issues/9447" rel="external nofollow noreferrer" target="_blank">#9447</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9852" rel="external nofollow noreferrer" target="_blank">#9852</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix 'COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query' error in case of subqueries with COMMA JOIN out of tables lists (i.e. in WHERE). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9782" rel="external nofollow noreferrer" target="_blank">#9782</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9830" rel="external nofollow noreferrer" target="_blank">#9830</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix possible exception <code class="syntax">Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code class="syntax">JOIN</code> in case if right joined table had zero rows. Example: <code class="syntax">select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9777" rel="external nofollow noreferrer" target="_blank">#9777</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9823" rel="external nofollow noreferrer" target="_blank">#9823</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix SIGSEGV with optimize_skip_unused_shards when type cannot be converted. <a href="https://github.com/ClickHouse/ClickHouse/pull/9804" rel="external nofollow noreferrer" target="_blank">#9804</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix broken <code class="syntax">ALTER TABLE DELETE COLUMN</code> query for compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/9779" rel="external nofollow noreferrer" target="_blank">#9779</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix max_distributed_connections (w/ and w/o Processors). <a href="https://github.com/ClickHouse/ClickHouse/pull/9673" rel="external nofollow noreferrer" target="_blank">#9673</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed a few cases when timezone of the function argument wasn't used properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/9574" rel="external nofollow noreferrer" target="_blank">#9574</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
</ul>
<h4 id="improvement_19">Improvement<a class="headerlink" href="#improvement_19" title="Permanent link"> </a></h4>
<ul>
<li>Remove order by stage from mutations because we read from a single ordered part in a single thread. Also add check that the order of rows in mutation is ordered in sorting key order and this order is not violated. <a href="https://github.com/ClickHouse/ClickHouse/pull/9886" rel="external nofollow noreferrer" target="_blank">#9886</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-3-4-10-2020-03-20">ClickHouse release v20.3.4.10, 2020-03-20<a class="headerlink" href="#clickhouse-release-v20-3-4-10-2020-03-20" title="Permanent link"> </a></h3>
<h4 id="bug-fix_47">Bug Fix<a class="headerlink" href="#bug-fix_47" title="Permanent link"> </a></h4>
<ul>
<li>This release also contains all bug fixes from 20.1.8.41</li>
<li>Fix missing <code class="syntax">rows_before_limit_at_least</code> for queries over http (with processors pipeline). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9730" rel="external nofollow noreferrer" target="_blank">#9730</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9757" rel="external nofollow noreferrer" target="_blank">#9757</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
</ul>
<h3 id="clickhouse-release-v20-3-3-6-2020-03-17">ClickHouse release v20.3.3.6, 2020-03-17<a class="headerlink" href="#clickhouse-release-v20-3-3-6-2020-03-17" title="Permanent link"> </a></h3>
<h4 id="bug-fix_48">Bug Fix<a class="headerlink" href="#bug-fix_48" title="Permanent link"> </a></h4>
<ul>
<li>This release also contains all bug fixes from 20.1.7.38</li>
<li>Fix bug in a replication that does not allow replication to work if the user has executed mutations on the previous version. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9645" rel="external nofollow noreferrer" target="_blank">#9645</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9652" rel="external nofollow noreferrer" target="_blank">#9652</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>). It makes version 20.3 backward compatible again.</li>
<li>Add setting <code class="syntax">use_compact_format_in_distributed_parts_names</code> which allows to write files for <code class="syntax">INSERT</code> queries into <code class="syntax">Distributed</code> table with more compact format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9647" rel="external nofollow noreferrer" target="_blank">#9647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9653" rel="external nofollow noreferrer" target="_blank">#9653</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>). It makes version 20.3 backward compatible again.</li>
</ul>
<h3 id="clickhouse-release-v20-3-2-1-2020-03-12">ClickHouse release v20.3.2.1, 2020-03-12<a class="headerlink" href="#clickhouse-release-v20-3-2-1-2020-03-12" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_9">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_9" title="Permanent link"> </a></h4>
<ul>
<li>Fixed the issue <code class="syntax">file name too long</code> when sending data for <code class="syntax">Distributed</code> tables for a large number of replicas. Fixed the issue that replica credentials were exposed in the server log. The format of directory name on disk was changed to <code class="syntax">[shard{shard_index}[_replica{replica_index}]]</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8911" rel="external nofollow noreferrer" target="_blank">#8911</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>) After you upgrade to the new version, you will not be able to downgrade without manual intervention, because old server version does not recognize the new directory format. If you want to downgrade, you have to manually rename the corresponding directories to the old format. This change is relevant only if you have used asynchronous <code class="syntax">INSERT</code>s to <code class="syntax">Distributed</code> tables. In the version 20.3.3 we will introduce a setting that will allow you to enable the new format gradually.</li>
<li>Changed the format of replication log entries for mutation commands. You have to wait for old mutations to process before installing the new version.</li>
<li>Implement simple memory profiler that dumps stacktraces to <code class="syntax">system.trace_log</code> every N bytes over soft allocation limit <a href="https://github.com/ClickHouse/ClickHouse/pull/8765" rel="external nofollow noreferrer" target="_blank">#8765</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/9472" rel="external nofollow noreferrer" target="_blank">#9472</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>) The column of <code class="syntax">system.trace_log</code> was renamed from <code class="syntax">timer_type</code> to <code class="syntax">trace_type</code>. This will require changes in third-party performance analysis and flamegraph processing tools.</li>
<li>Use OS thread id everywhere instead of internal thread number. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7477" rel="external nofollow noreferrer" target="_blank">#7477</a> Old <code class="syntax">clickhouse-client</code> cannot receive logs that are send from the server when the setting <code class="syntax">send_logs_level</code> is enabled, because the names and types of the structured log messages were changed. On the other hand, different server versions can send logs with different types to each other. When you don't use the <code class="syntax">send_logs_level</code> setting, you should not care. <a href="https://github.com/ClickHouse/ClickHouse/pull/8954" rel="external nofollow noreferrer" target="_blank">#8954</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove <code class="syntax">indexHint</code> function <a href="https://github.com/ClickHouse/ClickHouse/pull/9542" rel="external nofollow noreferrer" target="_blank">#9542</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove <code class="syntax">findClusterIndex</code>, <code class="syntax">findClusterValue</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8641" rel="external nofollow noreferrer" target="_blank">#8641</a>. If you were using these functions, send an email to <code class="syntax">clickhouse-feedback@yandex-team.com</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9543" rel="external nofollow noreferrer" target="_blank">#9543</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Now it's not allowed to create columns or add columns with <code class="syntax">SELECT</code> subquery as default expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/9481" rel="external nofollow noreferrer" target="_blank">#9481</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Require aliases for subqueries in JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/9274" rel="external nofollow noreferrer" target="_blank">#9274</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Improved <code class="syntax">ALTER MODIFY/ADD</code> queries logic. Now you cannot <code class="syntax">ADD</code> column without type, <code class="syntax">MODIFY</code> default expression does not change type of column and <code class="syntax">MODIFY</code> type does not loose default expression value. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8669" rel="external nofollow noreferrer" target="_blank">#8669</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9227" rel="external nofollow noreferrer" target="_blank">#9227</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Require server to be restarted to apply the changes in logging configuration. This is a temporary workaround to avoid the bug where the server logs to a deleted log file (see <a href="https://github.com/ClickHouse/ClickHouse/issues/8696" rel="external nofollow noreferrer" target="_blank">#8696</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8707" rel="external nofollow noreferrer" target="_blank">#8707</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>The setting <code class="syntax">experimental_use_processors</code> is enabled by default. This setting enables usage of the new query pipeline. This is internal refactoring and we expect no visible changes. If you will see any issues, set it to back zero. <a href="https://github.com/ClickHouse/ClickHouse/pull/8768" rel="external nofollow noreferrer" target="_blank">#8768</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h4 id="new-feature_11">New Feature<a class="headerlink" href="#new-feature_11" title="Permanent link"> </a></h4>
<ul>
<li>Add <code class="syntax">Avro</code> and <code class="syntax">AvroConfluent</code> input/output formats <a href="https://github.com/ClickHouse/ClickHouse/pull/8571" rel="external nofollow noreferrer" target="_blank">#8571</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8957" rel="external nofollow noreferrer" target="_blank">#8957</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8717" rel="external nofollow noreferrer" target="_blank">#8717</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Multi-threaded and non-blocking updates of expired keys in <code class="syntax">cache</code> dictionaries (with optional permission to read old ones). <a href="https://github.com/ClickHouse/ClickHouse/pull/8303" rel="external nofollow noreferrer" target="_blank">#8303</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Add query <code class="syntax">ALTER ... MATERIALIZE TTL</code>. It runs mutation that forces to remove expired data by TTL and recalculates meta-information about TTL in all parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/8775" rel="external nofollow noreferrer" target="_blank">#8775</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Switch from HashJoin to MergeJoin (on disk) if needed <a href="https://github.com/ClickHouse/ClickHouse/pull/9082" rel="external nofollow noreferrer" target="_blank">#9082</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Added <code class="syntax">MOVE PARTITION</code> command for <code class="syntax">ALTER TABLE</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/4729" rel="external nofollow noreferrer" target="_blank">#4729</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/6168" rel="external nofollow noreferrer" target="_blank">#6168</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>Reloading storage configuration from configuration file on the fly. <a href="https://github.com/ClickHouse/ClickHouse/pull/8594" rel="external nofollow noreferrer" target="_blank">#8594</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Allowed to change <code class="syntax">storage_policy</code> to not less rich one. <a href="https://github.com/ClickHouse/ClickHouse/pull/8107" rel="external nofollow noreferrer" target="_blank">#8107</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Added support for globs/wildcards for S3 storage and table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/8851" rel="external nofollow noreferrer" target="_blank">#8851</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Implement <code class="syntax">bitAnd</code>, <code class="syntax">bitOr</code>, <code class="syntax">bitXor</code>, <code class="syntax">bitNot</code> for <code class="syntax">FixedString(N)</code> datatype. <a href="https://github.com/ClickHouse/ClickHouse/pull/9091" rel="external nofollow noreferrer" target="_blank">#9091</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>Added function <code class="syntax">bitCount</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8702" rel="external nofollow noreferrer" target="_blank">#8702</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8708" rel="external nofollow noreferrer" target="_blank">#8708</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8749" rel="external nofollow noreferrer" target="_blank">#8749</a> (<a href="https://github.com/ikopylov" rel="external nofollow noreferrer" target="_blank">ikopylov</a>)</li>
<li>Add <code class="syntax">generateRandom</code> table function to generate random rows with given schema. Allows to populate arbitrary test table with data. <a href="https://github.com/ClickHouse/ClickHouse/pull/8994" rel="external nofollow noreferrer" target="_blank">#8994</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>)</li>
<li><code class="syntax">JSONEachRowFormat</code>: support special case when objects enclosed in top-level array. <a href="https://github.com/ClickHouse/ClickHouse/pull/8860" rel="external nofollow noreferrer" target="_blank">#8860</a> (<a href="https://github.com/Avogar" rel="external nofollow noreferrer" target="_blank">Kruglov Pavel</a>)</li>
<li>Now it's possible to create a column with <code class="syntax">DEFAULT</code> expression which depends on a column with default <code class="syntax">ALIAS</code> expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/9489" rel="external nofollow noreferrer" target="_blank">#9489</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Allow to specify <code class="syntax">--limit</code> more than the source data size in <code class="syntax">clickhouse-obfuscator</code>. The data will repeat itself with different random seed. <a href="https://github.com/ClickHouse/ClickHouse/pull/9155" rel="external nofollow noreferrer" target="_blank">#9155</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added <code class="syntax">groupArraySample</code> function (similar to <code class="syntax">groupArray</code>) with reservior sampling algorithm. <a href="https://github.com/ClickHouse/ClickHouse/pull/8286" rel="external nofollow noreferrer" target="_blank">#8286</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Now you can monitor the size of update queue in <code class="syntax">cache</code>/<code class="syntax">complex_key_cache</code> dictionaries via system metrics. <a href="https://github.com/ClickHouse/ClickHouse/pull/9413" rel="external nofollow noreferrer" target="_blank">#9413</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Allow to use CRLF as a line separator in CSV output format with setting <code class="syntax">output_format_csv_crlf_end_of_line</code> is set to 1 <a href="https://github.com/ClickHouse/ClickHouse/pull/8934" rel="external nofollow noreferrer" target="_blank">#8934</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8935" rel="external nofollow noreferrer" target="_blank">#8935</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8963" rel="external nofollow noreferrer" target="_blank">#8963</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Implement more functions of the <a href="https://github.com/uber/h3" rel="external nofollow noreferrer" target="_blank">H3</a> API: <code class="syntax">h3GetBaseCell</code>, <code class="syntax">h3HexAreaM2</code>, <code class="syntax">h3IndexesAreNeighbors</code>, <code class="syntax">h3ToChildren</code>, <code class="syntax">h3ToString</code> and <code class="syntax">stringToH3</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8938" rel="external nofollow noreferrer" target="_blank">#8938</a> (<a href="https://github.com/nmandery" rel="external nofollow noreferrer" target="_blank">Nico Mandery</a>)</li>
<li>New setting introduced: <code class="syntax">max_parser_depth</code> to control maximum stack size and allow large complex queries. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6681" rel="external nofollow noreferrer" target="_blank">#6681</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/7668" rel="external nofollow noreferrer" target="_blank">#7668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8647" rel="external nofollow noreferrer" target="_blank">#8647</a> (<a href="https://github.com/qMBQx8GH" rel="external nofollow noreferrer" target="_blank">Maxim Smirnov</a>)</li>
<li>Add a setting <code class="syntax">force_optimize_skip_unused_shards</code> setting to throw if skipping of unused shards is not possible <a href="https://github.com/ClickHouse/ClickHouse/pull/8805" rel="external nofollow noreferrer" target="_blank">#8805</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Allow to configure multiple disks/volumes for storing data for send in <code class="syntax">Distributed</code> engine <a href="https://github.com/ClickHouse/ClickHouse/pull/8756" rel="external nofollow noreferrer" target="_blank">#8756</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Support storage policy (<code class="syntax">&lt;tmp_policy&gt;</code>) for storing temporary data. <a href="https://github.com/ClickHouse/ClickHouse/pull/8750" rel="external nofollow noreferrer" target="_blank">#8750</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Added <code class="syntax">X-ClickHouse-Exception-Code</code> HTTP header that is set if exception was thrown before sending data. This implements <a href="https://github.com/ClickHouse/ClickHouse/issues/4971" rel="external nofollow noreferrer" target="_blank">#4971</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8786" rel="external nofollow noreferrer" target="_blank">#8786</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Added function <code class="syntax">ifNotFinite</code>. It is just a syntactic sugar: <code class="syntax">ifNotFinite(x, y) = isFinite(x) ? x : y</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8710" rel="external nofollow noreferrer" target="_blank">#8710</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added <code class="syntax">last_successful_update_time</code> column in <code class="syntax">system.dictionaries</code> table <a href="https://github.com/ClickHouse/ClickHouse/pull/9394" rel="external nofollow noreferrer" target="_blank">#9394</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Add <code class="syntax">blockSerializedSize</code> function (size on disk without compression) <a href="https://github.com/ClickHouse/ClickHouse/pull/8952" rel="external nofollow noreferrer" target="_blank">#8952</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Add function <code class="syntax">moduloOrZero</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9358" rel="external nofollow noreferrer" target="_blank">#9358</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Added system tables <code class="syntax">system.zeros</code> and <code class="syntax">system.zeros_mt</code> as well as tale functions <code class="syntax">zeros()</code> and <code class="syntax">zeros_mt()</code>. Tables (and table functions) contain single column with name <code class="syntax">zero</code> and type <code class="syntax">UInt8</code>. This column contains zeros. It is needed for test purposes as the fastest method to generate many rows. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6604" rel="external nofollow noreferrer" target="_blank">#6604</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9593" rel="external nofollow noreferrer" target="_blank">#9593</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
</ul>
<h4 id="experimental-feature_7">Experimental Feature<a class="headerlink" href="#experimental-feature_7" title="Permanent link"> </a></h4>
<ul>
<li>Add new compact format of parts in <code class="syntax">MergeTree</code>-family tables in which all columns are stored in one file. It helps to increase performance of small and frequent inserts. The old format (one file per column) is now called wide. Data storing format is controlled by settings <code class="syntax">min_bytes_for_wide_part</code> and <code class="syntax">min_rows_for_wide_part</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8290" rel="external nofollow noreferrer" target="_blank">#8290</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Support for S3 storage for <code class="syntax">Log</code>, <code class="syntax">TinyLog</code> and <code class="syntax">StripeLog</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8862" rel="external nofollow noreferrer" target="_blank">#8862</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
</ul>
<h4 id="bug-fix_49">Bug Fix<a class="headerlink" href="#bug-fix_49" title="Permanent link"> </a></h4>
<ul>
<li>Fixed inconsistent whitespaces in log messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/9322" rel="external nofollow noreferrer" target="_blank">#9322</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix bug in which arrays of unnamed tuples were flattened as Nested structures on table creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/8866" rel="external nofollow noreferrer" target="_blank">#8866</a> (<a href="https://github.com/achulkov2" rel="external nofollow noreferrer" target="_blank">achulkov2</a>)</li>
<li>Fixed the issue when "Too many open files" error may happen if there are too many files matching glob pattern in <code class="syntax">File</code> table or <code class="syntax">file</code> table function. Now files are opened lazily. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8857" rel="external nofollow noreferrer" target="_blank">#8857</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8861" rel="external nofollow noreferrer" target="_blank">#8861</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>DROP TEMPORARY TABLE now drops only temporary table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8907" rel="external nofollow noreferrer" target="_blank">#8907</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Remove outdated partition when we shutdown the server or DETACH/ATTACH a table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8602" rel="external nofollow noreferrer" target="_blank">#8602</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>For how the default disk calculates the free space from <code class="syntax">data</code> subdirectory. Fixed the issue when the amount of free space is not calculated correctly if the <code class="syntax">data</code> directory is mounted to a separate device (rare case). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7441" rel="external nofollow noreferrer" target="_blank">#7441</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9257" rel="external nofollow noreferrer" target="_blank">#9257</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Allow comma (cross) join with IN () inside. <a href="https://github.com/ClickHouse/ClickHouse/pull/9251" rel="external nofollow noreferrer" target="_blank">#9251</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Allow to rewrite CROSS to INNER JOIN if there's [NOT] LIKE operator in WHERE section. <a href="https://github.com/ClickHouse/ClickHouse/pull/9229" rel="external nofollow noreferrer" target="_blank">#9229</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix possible incorrect result after <code class="syntax">GROUP BY</code> with enabled setting <code class="syntax">distributed_aggregation_memory_efficient</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9134" rel="external nofollow noreferrer" target="_blank">#9134</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9289" rel="external nofollow noreferrer" target="_blank">#9289</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Found keys were counted as missed in metrics of cache dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9411" rel="external nofollow noreferrer" target="_blank">#9411</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Fix replication protocol incompatibility introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/8598" rel="external nofollow noreferrer" target="_blank">#8598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9412" rel="external nofollow noreferrer" target="_blank">#9412</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed race condition on <code class="syntax">queue_task_handle</code> at the startup of <code class="syntax">ReplicatedMergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/9552" rel="external nofollow noreferrer" target="_blank">#9552</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>The token <code class="syntax">NOT</code> did not work in <code class="syntax">SHOW TABLES NOT LIKE</code> query <a href="https://github.com/ClickHouse/ClickHouse/issues/8727" rel="external nofollow noreferrer" target="_blank">#8727</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8940" rel="external nofollow noreferrer" target="_blank">#8940</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added range check to function <code class="syntax">h3EdgeLengthM</code>. Without this check, buffer overflow is possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/8945" rel="external nofollow noreferrer" target="_blank">#8945</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed up a bug in batched calculations of ternary logical OPs on multiple arguments (more than 10). <a href="https://github.com/ClickHouse/ClickHouse/pull/8718" rel="external nofollow noreferrer" target="_blank">#8718</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Fix error of PREWHERE optimization, which could lead to segfaults or <code class="syntax">Inconsistent number of columns got from MergeTreeRangeReader</code> exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/9024" rel="external nofollow noreferrer" target="_blank">#9024</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix unexpected <code class="syntax">Timeout exceeded while reading from socket</code> exception, which randomly happens on secure connection before timeout actually exceeded and when query profiler is enabled. Also add <code class="syntax">connect_timeout_with_failover_secure_ms</code> settings (default 100ms), which is similar to <code class="syntax">connect_timeout_with_failover_ms</code>, but is used for secure connections (because SSL handshake is slower, than ordinary TCP connection) <a href="https://github.com/ClickHouse/ClickHouse/pull/9026" rel="external nofollow noreferrer" target="_blank">#9026</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix bug with mutations finalization, when mutation may hang in state with <code class="syntax">parts_to_do=0</code> and <code class="syntax">is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9022" rel="external nofollow noreferrer" target="_blank">#9022</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Use new ANY JOIN logic with <code class="syntax">partial_merge_join</code> setting. It's possible to make <code class="syntax">ANY|ALL|SEMI LEFT</code> and <code class="syntax">ALL INNER</code> joins with <code class="syntax">partial_merge_join=1</code> now. <a href="https://github.com/ClickHouse/ClickHouse/pull/8932" rel="external nofollow noreferrer" target="_blank">#8932</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Shard now clamps the settings got from the initiator to the shard's constaints instead of throwing an exception. This fix allows to send queries to a shard with another constraints. <a href="https://github.com/ClickHouse/ClickHouse/pull/9447" rel="external nofollow noreferrer" target="_blank">#9447</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fixed memory management problem in <code class="syntax">MergeTreeReadPool</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8791" rel="external nofollow noreferrer" target="_blank">#8791</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix <code class="syntax">toDecimal*OrNull()</code> functions family when called with string <code class="syntax">e</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8312" rel="external nofollow noreferrer" target="_blank">#8312</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8764" rel="external nofollow noreferrer" target="_blank">#8764</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Make sure that <code class="syntax">FORMAT Null</code> sends no data to the client. <a href="https://github.com/ClickHouse/ClickHouse/pull/8767" rel="external nofollow noreferrer" target="_blank">#8767</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Fix bug that timestamp in <code class="syntax">LiveViewBlockInputStream</code> will not updated. <code class="syntax">LIVE VIEW</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/8644" rel="external nofollow noreferrer" target="_blank">#8644</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8625" rel="external nofollow noreferrer" target="_blank">#8625</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>)</li>
<li>Fixed <code class="syntax">ALTER MODIFY TTL</code> wrong behavior which did not allow to delete old TTL expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/8422" rel="external nofollow noreferrer" target="_blank">#8422</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fixed UBSan report in MergeTreeIndexSet. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9250" rel="external nofollow noreferrer" target="_blank">#9250</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9365" rel="external nofollow noreferrer" target="_blank">#9365</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed the behaviour of <code class="syntax">match</code> and <code class="syntax">extract</code> functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9160" rel="external nofollow noreferrer" target="_blank">#9160</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9163" rel="external nofollow noreferrer" target="_blank">#9163</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/9345" rel="external nofollow noreferrer" target="_blank">#9345</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Avoid throwing from destructor in Apache Avro 3rd-party library. <a href="https://github.com/ClickHouse/ClickHouse/pull/9066" rel="external nofollow noreferrer" target="_blank">#9066</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
<li>Don't commit a batch polled from <code class="syntax">Kafka</code> partially as it can lead to holes in data. <a href="https://github.com/ClickHouse/ClickHouse/pull/8876" rel="external nofollow noreferrer" target="_blank">#8876</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fix <code class="syntax">joinGet</code> with nullable return types. <a href="https://github.com/ClickHouse/ClickHouse/issues/8919" rel="external nofollow noreferrer" target="_blank">#8919</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9014" rel="external nofollow noreferrer" target="_blank">#9014</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Fix data incompatibility when compressed with <code class="syntax">T64</code> codec. <a href="https://github.com/ClickHouse/ClickHouse/pull/9016" rel="external nofollow noreferrer" target="_blank">#9016</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>) Fix data type ids in <code class="syntax">T64</code> compression codec that leads to wrong (de)compression in affected versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9033" rel="external nofollow noreferrer" target="_blank">#9033</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Add setting <code class="syntax">enable_early_constant_folding</code> and disable it in some cases that leads to errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/9010" rel="external nofollow noreferrer" target="_blank">#9010</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix pushdown predicate optimizer with VIEW and enable the test <a href="https://github.com/ClickHouse/ClickHouse/pull/9011" rel="external nofollow noreferrer" target="_blank">#9011</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Fix segfault in <code class="syntax">Merge</code> tables, that can happen when reading from <code class="syntax">File</code> storages <a href="https://github.com/ClickHouse/ClickHouse/pull/9387" rel="external nofollow noreferrer" target="_blank">#9387</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Added a check for storage policy in <code class="syntax">ATTACH PARTITION FROM</code>, <code class="syntax">REPLACE PARTITION</code>, <code class="syntax">MOVE TO TABLE</code>. Otherwise it could make data of part inaccessible after restart and prevent ClickHouse to start. <a href="https://github.com/ClickHouse/ClickHouse/pull/9383" rel="external nofollow noreferrer" target="_blank">#9383</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix alters if there is TTL set for table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8800" rel="external nofollow noreferrer" target="_blank">#8800</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix race condition that can happen when <code class="syntax">SYSTEM RELOAD ALL DICTIONARIES</code> is executed while some dictionary is being modified/added/removed. <a href="https://github.com/ClickHouse/ClickHouse/pull/8801" rel="external nofollow noreferrer" target="_blank">#8801</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>In previous versions <code class="syntax">Memory</code> database engine use empty data path, so tables are created in <code class="syntax">path</code> directory (e.g. <code class="syntax">/var/lib/clickhouse/</code>), not in data directory of database (e.g. <code class="syntax">/var/lib/clickhouse/db_name</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8753" rel="external nofollow noreferrer" target="_blank">#8753</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fixed wrong log messages about missing default disk or policy. <a href="https://github.com/ClickHouse/ClickHouse/pull/9530" rel="external nofollow noreferrer" target="_blank">#9530</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix not(has()) for the bloom_filter index of array types. <a href="https://github.com/ClickHouse/ClickHouse/pull/9407" rel="external nofollow noreferrer" target="_blank">#9407</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>)</li>
<li>Allow first column(s) in a table with <code class="syntax">Log</code> engine be an alias <a href="https://github.com/ClickHouse/ClickHouse/pull/9231" rel="external nofollow noreferrer" target="_blank">#9231</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Fix order of ranges while reading from <code class="syntax">MergeTree</code> table in one thread. It could lead to exceptions from <code class="syntax">MergeTreeRangeReader</code> or wrong query results. <a href="https://github.com/ClickHouse/ClickHouse/pull/9050" rel="external nofollow noreferrer" target="_blank">#9050</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Make <code class="syntax">reinterpretAsFixedString</code> to return <code class="syntax">FixedString</code> instead of <code class="syntax">String</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9052" rel="external nofollow noreferrer" target="_blank">#9052</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
<li>Avoid extremely rare cases when the user can get wrong error message (<code class="syntax">Success</code> instead of detailed error description). <a href="https://github.com/ClickHouse/ClickHouse/pull/9457" rel="external nofollow noreferrer" target="_blank">#9457</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Do not crash when using <code class="syntax">Template</code> format with empty row template. <a href="https://github.com/ClickHouse/ClickHouse/pull/8785" rel="external nofollow noreferrer" target="_blank">#8785</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Metadata files for system tables could be created in wrong place <a href="https://github.com/ClickHouse/ClickHouse/pull/8653" rel="external nofollow noreferrer" target="_blank">#8653</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>) Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8581" rel="external nofollow noreferrer" target="_blank">#8581</a>.</li>
<li>Fix data race on exception_ptr in cache dictionary <a href="https://github.com/ClickHouse/ClickHouse/issues/8303" rel="external nofollow noreferrer" target="_blank">#8303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9379" rel="external nofollow noreferrer" target="_blank">#9379</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Do not throw an exception for query <code class="syntax">ATTACH TABLE IF NOT EXISTS</code>. Previously it was thrown if table already exists, despite the <code class="syntax">IF NOT EXISTS</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/8967" rel="external nofollow noreferrer" target="_blank">#8967</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fixed missing closing paren in exception message. <a href="https://github.com/ClickHouse/ClickHouse/pull/8811" rel="external nofollow noreferrer" target="_blank">#8811</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Avoid message <code class="syntax">Possible deadlock avoided</code> at the startup of clickhouse-client in interactive mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/9455" rel="external nofollow noreferrer" target="_blank">#9455</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed the issue when padding at the end of base64 encoded value can be malformed. Update base64 library. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9491" rel="external nofollow noreferrer" target="_blank">#9491</a>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9492" rel="external nofollow noreferrer" target="_blank">#9492</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9500" rel="external nofollow noreferrer" target="_blank">#9500</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Prevent losing data in <code class="syntax">Kafka</code> in rare cases when exception happens after reading suffix but before commit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9378" rel="external nofollow noreferrer" target="_blank">#9378</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9507" rel="external nofollow noreferrer" target="_blank">#9507</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fixed exception in <code class="syntax">DROP TABLE IF EXISTS</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8663" rel="external nofollow noreferrer" target="_blank">#8663</a> (<a href="https://github.com/nikvas0" rel="external nofollow noreferrer" target="_blank">Nikita Vasilev</a>)</li>
<li>Fix crash when a user tries to <code class="syntax">ALTER MODIFY SETTING</code> for old-formated <code class="syntax">MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/9435" rel="external nofollow noreferrer" target="_blank">#9435</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Support for UInt64 numbers that don't fit in Int64 in JSON-related functions. Update SIMDJSON to master. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9209" rel="external nofollow noreferrer" target="_blank">#9209</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9344" rel="external nofollow noreferrer" target="_blank">#9344</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed execution of inversed predicates when non-strictly monotinic functional index is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/9223" rel="external nofollow noreferrer" target="_blank">#9223</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Don't try to fold <code class="syntax">IN</code> constant in <code class="syntax">GROUP BY</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8868" rel="external nofollow noreferrer" target="_blank">#8868</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Fix bug in <code class="syntax">ALTER DELETE</code> mutations which leads to index corruption. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9019" rel="external nofollow noreferrer" target="_blank">#9019</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/8982" rel="external nofollow noreferrer" target="_blank">#8982</a>. Additionally fix extremely rare race conditions in <code class="syntax">ReplicatedMergeTree</code> <code class="syntax">ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9048" rel="external nofollow noreferrer" target="_blank">#9048</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>When the setting <code class="syntax">compile_expressions</code> is enabled, you can get <code class="syntax">unexpected column</code> in <code class="syntax">LLVMExecutableFunction</code> when we use <code class="syntax">Nullable</code> type <a href="https://github.com/ClickHouse/ClickHouse/pull/8910" rel="external nofollow noreferrer" target="_blank">#8910</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>Multiple fixes for <code class="syntax">Kafka</code> engine: 1) fix duplicates that were appearing during consumer group rebalance. 2) Fix rare 'holes' appeared when data were polled from several partitions with one poll and committed partially (now we always process / commit the whole polled block of messages). 3) Fix flushes by block size (before that only flushing by timeout was working properly). 4) better subscription procedure (with assignment feedback). 5) Make tests work faster (with default intervals and timeouts). Due to the fact that data was not flushed by block size before (as it should according to documentation), that PR may lead to some performance degradation with default settings (due to more often &amp; tinier flushes which are less optimal). If you encounter the performance issue after that change - please increase <code class="syntax">kafka_max_block_size</code> in the table to the bigger value ( for example <code class="syntax">CREATE TABLE ...Engine=Kafka ... SETTINGS ... kafka_max_block_size=524288</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7259" rel="external nofollow noreferrer" target="_blank">#7259</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8917" rel="external nofollow noreferrer" target="_blank">#8917</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fix <code class="syntax">Parameter out of bound</code> exception in some queries after PREWHERE optimizations. <a href="https://github.com/ClickHouse/ClickHouse/pull/8914" rel="external nofollow noreferrer" target="_blank">#8914</a> (<a href="https://github.com/bgiard" rel="external nofollow noreferrer" target="_blank">Baudouin Giard</a>)</li>
<li>Fixed the case of mixed-constness of arguments of function <code class="syntax">arrayZip</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8705" rel="external nofollow noreferrer" target="_blank">#8705</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>When executing <code class="syntax">CREATE</code> query, fold constant expressions in storage engine arguments. Replace empty database name with current database. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6508" rel="external nofollow noreferrer" target="_blank">#6508</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/3492" rel="external nofollow noreferrer" target="_blank">#3492</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9262" rel="external nofollow noreferrer" target="_blank">#9262</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Now it's not possible to create or add columns with simple cyclic aliases like <code class="syntax">a DEFAULT b, b DEFAULT a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9603" rel="external nofollow noreferrer" target="_blank">#9603</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed a bug with double move which may corrupt original part. This is relevant if you use <code class="syntax">ALTER TABLE MOVE</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8680" rel="external nofollow noreferrer" target="_blank">#8680</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Allow <code class="syntax">interval</code> identifier to correctly parse without backticks. Fixed issue when a query cannot be executed even if the <code class="syntax">interval</code> identifier is enclosed in backticks or double quotes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9124" rel="external nofollow noreferrer" target="_blank">#9124</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9142" rel="external nofollow noreferrer" target="_blank">#9142</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed fuzz test and incorrect behaviour of <code class="syntax">bitTestAll</code>/<code class="syntax">bitTestAny</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9143" rel="external nofollow noreferrer" target="_blank">#9143</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix possible crash/wrong number of rows in <code class="syntax">LIMIT n WITH TIES</code> when there are a lot of rows equal to n'th row. <a href="https://github.com/ClickHouse/ClickHouse/pull/9464" rel="external nofollow noreferrer" target="_blank">#9464</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix mutations with parts written with enabled <code class="syntax">insert_quorum</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9463" rel="external nofollow noreferrer" target="_blank">#9463</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix data race at destruction of <code class="syntax">Poco::HTTPServer</code>. It could happen when server is started and immediately shut down. <a href="https://github.com/ClickHouse/ClickHouse/pull/9468" rel="external nofollow noreferrer" target="_blank">#9468</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix bug in which a misleading error message was shown when running <code class="syntax">SHOW CREATE TABLE a_table_that_does_not_exist</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8899" rel="external nofollow noreferrer" target="_blank">#8899</a> (<a href="https://github.com/achulkov2" rel="external nofollow noreferrer" target="_blank">achulkov2</a>)</li>
<li>Fixed <code class="syntax">Parameters are out of bound</code> exception in some rare cases when we have a constant in the <code class="syntax">SELECT</code> clause when we have an <code class="syntax">ORDER BY</code> and a <code class="syntax">LIMIT</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/8892" rel="external nofollow noreferrer" target="_blank">#8892</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>Fix mutations finalization, when already done mutation can have status <code class="syntax">is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9217" rel="external nofollow noreferrer" target="_blank">#9217</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Prevent from executing <code class="syntax">ALTER ADD INDEX</code> for MergeTree tables with old syntax, because it does not work. <a href="https://github.com/ClickHouse/ClickHouse/pull/8822" rel="external nofollow noreferrer" target="_blank">#8822</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>During server startup do not access table, which <code class="syntax">LIVE VIEW</code> depends on, so server will be able to start. Also remove <code class="syntax">LIVE VIEW</code> dependencies when detaching <code class="syntax">LIVE VIEW</code>. <code class="syntax">LIVE VIEW</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/8824" rel="external nofollow noreferrer" target="_blank">#8824</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix possible segfault in <code class="syntax">MergeTreeRangeReader</code>, while executing <code class="syntax">PREWHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9106" rel="external nofollow noreferrer" target="_blank">#9106</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix possible mismatched checksums with column TTLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/9451" rel="external nofollow noreferrer" target="_blank">#9451</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fixed a bug when parts were not being moved in background by TTL rules in case when there is only one volume. <a href="https://github.com/ClickHouse/ClickHouse/pull/8672" rel="external nofollow noreferrer" target="_blank">#8672</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fixed the issue <code class="syntax">Method createColumn() is not implemented for data type Set</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7799" rel="external nofollow noreferrer" target="_blank">#7799</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8674" rel="external nofollow noreferrer" target="_blank">#8674</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Now we will try finalize mutations more frequently. <a href="https://github.com/ClickHouse/ClickHouse/pull/9427" rel="external nofollow noreferrer" target="_blank">#9427</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix <code class="syntax">intDiv</code> by minus one constant <a href="https://github.com/ClickHouse/ClickHouse/pull/9351" rel="external nofollow noreferrer" target="_blank">#9351</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Fix possible race condition in <code class="syntax">BlockIO</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9356" rel="external nofollow noreferrer" target="_blank">#9356</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix bug leading to server termination when trying to use / drop <code class="syntax">Kafka</code> table created with wrong parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/9513" rel="external nofollow noreferrer" target="_blank">#9513</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Added workaround if OS returns wrong result for <code class="syntax">timer_create</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/8837" rel="external nofollow noreferrer" target="_blank">#8837</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed error in usage of <code class="syntax">min_marks_for_seek</code> parameter. Fixed the error message when there is no sharding key in Distributed table and we try to skip unused shards. <a href="https://github.com/ClickHouse/ClickHouse/pull/8908" rel="external nofollow noreferrer" target="_blank">#8908</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
</ul>
<h4 id="improvement_20">Improvement<a class="headerlink" href="#improvement_20" title="Permanent link"> </a></h4>
<ul>
<li>Implement <code class="syntax">ALTER MODIFY/DROP</code> queries on top of mutations for <code class="syntax">ReplicatedMergeTree*</code> engines family. Now <code class="syntax">ALTERS</code> blocks only at the metadata update stage, and don't block after that. <a href="https://github.com/ClickHouse/ClickHouse/pull/8701" rel="external nofollow noreferrer" target="_blank">#8701</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Add ability to rewrite CROSS to INNER JOINs with <code class="syntax">WHERE</code> section containing unqialified names. <a href="https://github.com/ClickHouse/ClickHouse/pull/9512" rel="external nofollow noreferrer" target="_blank">#9512</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Make <code class="syntax">SHOW TABLES</code> and <code class="syntax">SHOW DATABASES</code> queries support the <code class="syntax">WHERE</code> expressions and <code class="syntax">FROM</code>/<code class="syntax">IN</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9076" rel="external nofollow noreferrer" target="_blank">#9076</a> (<a href="https://github.com/sundy-li" rel="external nofollow noreferrer" target="_blank">sundyli</a>)</li>
<li>Added a setting <code class="syntax">deduplicate_blocks_in_dependent_materialized_views</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9070" rel="external nofollow noreferrer" target="_blank">#9070</a> (<a href="https://github.com/urykhy" rel="external nofollow noreferrer" target="_blank">urykhy</a>)</li>
<li>After recent changes MySQL client started to print binary strings in hex thereby making them not readable (<a href="https://github.com/ClickHouse/ClickHouse/issues/9032" rel="external nofollow noreferrer" target="_blank">#9032</a>). The workaround in ClickHouse is to mark string columns as UTF-8, which is not always, but usually the case. <a href="https://github.com/ClickHouse/ClickHouse/pull/9079" rel="external nofollow noreferrer" target="_blank">#9079</a> (<a href="https://github.com/yurriy" rel="external nofollow noreferrer" target="_blank">Yuriy Baranov</a>)</li>
<li>Add support of String and FixedString keys for <code class="syntax">sumMap</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8903" rel="external nofollow noreferrer" target="_blank">#8903</a> (<a href="https://github.com/bgiard" rel="external nofollow noreferrer" target="_blank">Baudouin Giard</a>)</li>
<li>Support string keys in SummingMergeTree maps <a href="https://github.com/ClickHouse/ClickHouse/pull/8933" rel="external nofollow noreferrer" target="_blank">#8933</a> (<a href="https://github.com/bgiard" rel="external nofollow noreferrer" target="_blank">Baudouin Giard</a>)</li>
<li>Signal termination of thread to the thread pool even if the thread has thrown exception <a href="https://github.com/ClickHouse/ClickHouse/pull/8736" rel="external nofollow noreferrer" target="_blank">#8736</a> (<a href="https://github.com/dingxiangfei2009" rel="external nofollow noreferrer" target="_blank">Ding Xiang Fei</a>)</li>
<li>Allow to set <code class="syntax">query_id</code> in <code class="syntax">clickhouse-benchmark</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9416" rel="external nofollow noreferrer" target="_blank">#9416</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Don't allow strange expressions in <code class="syntax">ALTER TABLE ... PARTITION partition</code> query. This addresses <a href="https://github.com/ClickHouse/ClickHouse/issues/7192" rel="external nofollow noreferrer" target="_blank">#7192</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8835" rel="external nofollow noreferrer" target="_blank">#8835</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>The table <code class="syntax">system.table_engines</code> now provides information about feature support (like <code class="syntax">supports_ttl</code> or <code class="syntax">supports_sort_order</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8830" rel="external nofollow noreferrer" target="_blank">#8830</a> (<a href="https://github.com/zlobober" rel="external nofollow noreferrer" target="_blank">Max Akhmedov</a>)</li>
<li>Enable <code class="syntax">system.metric_log</code> by default. It will contain rows with values of ProfileEvents, CurrentMetrics collected with "collect_interval_milliseconds" interval (one second by default). The table is very small (usually in order of megabytes) and collecting this data by default is reasonable. <a href="https://github.com/ClickHouse/ClickHouse/pull/9225" rel="external nofollow noreferrer" target="_blank">#9225</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6964" rel="external nofollow noreferrer" target="_blank">#6964</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8874" rel="external nofollow noreferrer" target="_blank">#8874</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Now temporary <code class="syntax">LIVE VIEW</code> is created by <code class="syntax">CREATE LIVE VIEW name WITH TIMEOUT [42] ...</code> instead of <code class="syntax">CREATE TEMPORARY LIVE VIEW ...</code>, because the previous syntax was not consistent with <code class="syntax">CREATE TEMPORARY TABLE ...</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9131" rel="external nofollow noreferrer" target="_blank">#9131</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Add text_log.level configuration parameter to limit entries that goes to <code class="syntax">system.text_log</code> table <a href="https://github.com/ClickHouse/ClickHouse/pull/8809" rel="external nofollow noreferrer" target="_blank">#8809</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Allow to put downloaded part to a disks/volumes according to TTL rules <a href="https://github.com/ClickHouse/ClickHouse/pull/8598" rel="external nofollow noreferrer" target="_blank">#8598</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>For external MySQL dictionaries, allow to mutualize MySQL connection pool to "share" them among dictionaries. This option significantly reduces the number of connections to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/9409" rel="external nofollow noreferrer" target="_blank">#9409</a> (<a href="https://github.com/clemrodriguez" rel="external nofollow noreferrer" target="_blank">Clément Rodriguez</a>)</li>
<li>Show nearest query execution time for quantiles in <code class="syntax">clickhouse-benchmark</code> output instead of interpolated values. It's better to show values that correspond to the execution time of some queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8712" rel="external nofollow noreferrer" target="_blank">#8712</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Possibility to add key &amp; timestamp for the message when inserting data to Kafka. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7198" rel="external nofollow noreferrer" target="_blank">#7198</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8969" rel="external nofollow noreferrer" target="_blank">#8969</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>If server is run from terminal, highlight thread number, query id and log priority by colors. This is for improved readability of correlated log messages for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/8961" rel="external nofollow noreferrer" target="_blank">#8961</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Better exception message while loading tables for <code class="syntax">Ordinary</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/9527" rel="external nofollow noreferrer" target="_blank">#9527</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Implement <code class="syntax">arraySlice</code> for arrays with aggregate function states. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9388" rel="external nofollow noreferrer" target="_blank">#9388</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9391" rel="external nofollow noreferrer" target="_blank">#9391</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Allow constant functions and constant arrays to be used on the right side of IN operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/8813" rel="external nofollow noreferrer" target="_blank">#8813</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>If zookeeper exception has happened while fetching data for system.replicas, display it in a separate column. This implements <a href="https://github.com/ClickHouse/ClickHouse/issues/9137" rel="external nofollow noreferrer" target="_blank">#9137</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9138" rel="external nofollow noreferrer" target="_blank">#9138</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Atomically remove MergeTree data parts on destroy. <a href="https://github.com/ClickHouse/ClickHouse/pull/8402" rel="external nofollow noreferrer" target="_blank">#8402</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Support row-level security for Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8926" rel="external nofollow noreferrer" target="_blank">#8926</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Now we recognize suffix (like KB, KiB...) in settings values. <a href="https://github.com/ClickHouse/ClickHouse/pull/8072" rel="external nofollow noreferrer" target="_blank">#8072</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Prevent out of memory while constructing result of a large JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/8637" rel="external nofollow noreferrer" target="_blank">#8637</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Added names of clusters to suggestions in interactive mode in <code class="syntax">clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8709" rel="external nofollow noreferrer" target="_blank">#8709</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries <a href="https://github.com/ClickHouse/ClickHouse/pull/8820" rel="external nofollow noreferrer" target="_blank">#8820</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Added column <code class="syntax">exception_code</code> in <code class="syntax">system.query_log</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8770" rel="external nofollow noreferrer" target="_blank">#8770</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Enabled MySQL compatibility server on port <code class="syntax">9004</code> in the default server configuration file. Fixed password generation command in the example in configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/8771" rel="external nofollow noreferrer" target="_blank">#8771</a> (<a href="https://github.com/yurriy" rel="external nofollow noreferrer" target="_blank">Yuriy Baranov</a>)</li>
<li>Prevent abort on shutdown if the filesystem is readonly. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9094" rel="external nofollow noreferrer" target="_blank">#9094</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9100" rel="external nofollow noreferrer" target="_blank">#9100</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Better exception message when length is required in HTTP POST query. <a href="https://github.com/ClickHouse/ClickHouse/pull/9453" rel="external nofollow noreferrer" target="_blank">#9453</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add <code class="syntax">_path</code> and <code class="syntax">_file</code> virtual columns to <code class="syntax">HDFS</code> and <code class="syntax">File</code> engines and <code class="syntax">hdfs</code> and <code class="syntax">file</code> table functions <a href="https://github.com/ClickHouse/ClickHouse/pull/8489" rel="external nofollow noreferrer" target="_blank">#8489</a> (<a href="https://github.com/stavrolia" rel="external nofollow noreferrer" target="_blank">Olga Khvostikova</a>)</li>
<li>Fix error <code class="syntax">Cannot find column</code> while inserting into <code class="syntax">MATERIALIZED VIEW</code> in case if new column was added to view's internal table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8766" rel="external nofollow noreferrer" target="_blank">#8766</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8788" rel="external nofollow noreferrer" target="_blank">#8788</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>) <a href="https://github.com/ClickHouse/ClickHouse/issues/8788" rel="external nofollow noreferrer" target="_blank">#8788</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8806" rel="external nofollow noreferrer" target="_blank">#8806</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8803" rel="external nofollow noreferrer" target="_blank">#8803</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix progress over native client-server protocol, by send progress after final update (like logs). This may be relevant only to some third-party tools that are using native protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/9495" rel="external nofollow noreferrer" target="_blank">#9495</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Add a system metric tracking the number of client connections using MySQL protocol (<a href="https://github.com/ClickHouse/ClickHouse/issues/9013" rel="external nofollow noreferrer" target="_blank">#9013</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9015" rel="external nofollow noreferrer" target="_blank">#9015</a> (<a href="https://github.com/Slach" rel="external nofollow noreferrer" target="_blank">Eugene Klimov</a>)</li>
<li>From now on, HTTP responses will have <code class="syntax">X-ClickHouse-Timezone</code> header set to the same timezone value that <code class="syntax">SELECT timezone()</code> would report. <a href="https://github.com/ClickHouse/ClickHouse/pull/9493" rel="external nofollow noreferrer" target="_blank">#9493</a> (<a href="https://github.com/traceon" rel="external nofollow noreferrer" target="_blank">Denis Glazachev</a>)</li>
</ul>
<h4 id="performance-improvement_16">Performance Improvement<a class="headerlink" href="#performance-improvement_16" title="Permanent link"> </a></h4>
<ul>
<li>Improve performance of analysing index with IN <a href="https://github.com/ClickHouse/ClickHouse/pull/9261" rel="external nofollow noreferrer" target="_blank">#9261</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Simpler and more efficient code in Logical Functions + code cleanups. A followup to <a href="https://github.com/ClickHouse/ClickHouse/issues/8718" rel="external nofollow noreferrer" target="_blank">#8718</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8728" rel="external nofollow noreferrer" target="_blank">#8728</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Overall performance improvement (in range of 5%..200% for affected queries) by ensuring even more strict aliasing with C++20 features. <a href="https://github.com/ClickHouse/ClickHouse/pull/9304" rel="external nofollow noreferrer" target="_blank">#9304</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>More strict aliasing for inner loops of comparison functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9327" rel="external nofollow noreferrer" target="_blank">#9327</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>More strict aliasing for inner loops of arithmetic functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9325" rel="external nofollow noreferrer" target="_blank">#9325</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>A ~3 times faster implementation for ColumnVector::replicate(), via which ColumnConst::convertToFullColumn() is implemented. Also will be useful in tests when materializing constants. <a href="https://github.com/ClickHouse/ClickHouse/pull/9293" rel="external nofollow noreferrer" target="_blank">#9293</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Another minor performance improvement to <code class="syntax">ColumnVector::replicate()</code> (this speeds up the <code class="syntax">materialize</code> function and higher order functions) an even further improvement to <a href="https://github.com/ClickHouse/ClickHouse/issues/9293" rel="external nofollow noreferrer" target="_blank">#9293</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9442" rel="external nofollow noreferrer" target="_blank">#9442</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Improved performance of <code class="syntax">stochasticLinearRegression</code> aggregate function. This patch is contributed by Intel. <a href="https://github.com/ClickHouse/ClickHouse/pull/8652" rel="external nofollow noreferrer" target="_blank">#8652</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Improve performance of <code class="syntax">reinterpretAsFixedString</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/9342" rel="external nofollow noreferrer" target="_blank">#9342</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Do not send blocks to client for <code class="syntax">Null</code> format in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/8797" rel="external nofollow noreferrer" target="_blank">#8797</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8767" rel="external nofollow noreferrer" target="_blank">#8767</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
</ul>
<h4 id="build-testing-packaging-improvement_20">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_20" title="Permanent link"> </a></h4>
<ul>
<li>Exception handling now works correctly on Windows Subsystem for Linux. See <a href="https://github.com/ClickHouse-Extras/libunwind/pull/3" target="_blank">https://github.com/ClickHouse-Extras/libunwind/pull/3</a> This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6480" rel="external nofollow noreferrer" target="_blank">#6480</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9564" rel="external nofollow noreferrer" target="_blank">#9564</a> (<a href="https://github.com/sobolevsv" rel="external nofollow noreferrer" target="_blank">sobolevsv</a>)</li>
<li>Replace <code class="syntax">readline</code> with <code class="syntax">replxx</code> for interactive line editing in <code class="syntax">clickhouse-client</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8416" rel="external nofollow noreferrer" target="_blank">#8416</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Better build time and less template instantiations in FunctionsComparison. <a href="https://github.com/ClickHouse/ClickHouse/pull/9324" rel="external nofollow noreferrer" target="_blank">#9324</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added integration with <code class="syntax">clang-tidy</code> in CI. See also <a href="https://github.com/ClickHouse/ClickHouse/issues/6044" rel="external nofollow noreferrer" target="_blank">#6044</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9566" rel="external nofollow noreferrer" target="_blank">#9566</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Now we link ClickHouse in CI using <code class="syntax">lld</code> even for <code class="syntax">gcc</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9049" rel="external nofollow noreferrer" target="_blank">#9049</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Allow to randomize thread scheduling and insert glitches when <code class="syntax">THREAD_FUZZER_*</code> environment variables are set. This helps testing. <a href="https://github.com/ClickHouse/ClickHouse/pull/9459" rel="external nofollow noreferrer" target="_blank">#9459</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Enable secure sockets in stateless tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9288" rel="external nofollow noreferrer" target="_blank">#9288</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Make SPLIT_SHARED_LIBRARIES=OFF more robust <a href="https://github.com/ClickHouse/ClickHouse/pull/9156" rel="external nofollow noreferrer" target="_blank">#9156</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Make "performance_introspection_and_logging" test reliable to random server stuck. This may happen in CI environment. See also <a href="https://github.com/ClickHouse/ClickHouse/issues/9515" rel="external nofollow noreferrer" target="_blank">#9515</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9528" rel="external nofollow noreferrer" target="_blank">#9528</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Validate XML in style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/9550" rel="external nofollow noreferrer" target="_blank">#9550</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed race condition in test <code class="syntax">00738_lock_for_inner_table</code>. This test relied on sleep. <a href="https://github.com/ClickHouse/ClickHouse/pull/9555" rel="external nofollow noreferrer" target="_blank">#9555</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove performance tests of type <code class="syntax">once</code>. This is needed to run all performance tests in statistical comparison mode (more reliable). <a href="https://github.com/ClickHouse/ClickHouse/pull/9557" rel="external nofollow noreferrer" target="_blank">#9557</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added performance test for arithmetic functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9326" rel="external nofollow noreferrer" target="_blank">#9326</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added performance test for <code class="syntax">sumMap</code> and <code class="syntax">sumMapWithOverflow</code> aggregate functions. Follow-up for <a href="https://github.com/ClickHouse/ClickHouse/issues/8933" rel="external nofollow noreferrer" target="_blank">#8933</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8947" rel="external nofollow noreferrer" target="_blank">#8947</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Ensure style of ErrorCodes by style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/9370" rel="external nofollow noreferrer" target="_blank">#9370</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add script for tests history. <a href="https://github.com/ClickHouse/ClickHouse/pull/8796" rel="external nofollow noreferrer" target="_blank">#8796</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Add GCC warning <code class="syntax">-Wsuggest-override</code> to locate and fix all places where <code class="syntax">override</code> keyword must be used. <a href="https://github.com/ClickHouse/ClickHouse/pull/8760" rel="external nofollow noreferrer" target="_blank">#8760</a> (<a href="https://github.com/kreuzerkrieg" rel="external nofollow noreferrer" target="_blank">kreuzerkrieg</a>)</li>
<li>Ignore weak symbol under Mac OS X because it must be defined <a href="https://github.com/ClickHouse/ClickHouse/pull/9538" rel="external nofollow noreferrer" target="_blank">#9538</a> (<a href="https://github.com/ghost" rel="external nofollow noreferrer" target="_blank">Deleted user</a>)</li>
<li>Normalize running time of some queries in performance tests. This is done in preparation to run all the performance tests in comparison mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/9565" rel="external nofollow noreferrer" target="_blank">#9565</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix some tests to support pytest with query tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9062" rel="external nofollow noreferrer" target="_blank">#9062</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Enable SSL in build with MSan, so server will not fail at startup when running stateless tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9531" rel="external nofollow noreferrer" target="_blank">#9531</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix database substitution in test results <a href="https://github.com/ClickHouse/ClickHouse/pull/9384" rel="external nofollow noreferrer" target="_blank">#9384</a> (<a href="https://github.com/qoega" rel="external nofollow noreferrer" target="_blank">Ilya Yatsishin</a>)</li>
<li>Build fixes for miscellaneous platforms <a href="https://github.com/ClickHouse/ClickHouse/pull/9381" rel="external nofollow noreferrer" target="_blank">#9381</a> (<a href="https://github.com/proller" rel="external nofollow noreferrer" target="_blank">proller</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8755" rel="external nofollow noreferrer" target="_blank">#8755</a> (<a href="https://github.com/proller" rel="external nofollow noreferrer" target="_blank">proller</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8631" rel="external nofollow noreferrer" target="_blank">#8631</a> (<a href="https://github.com/proller" rel="external nofollow noreferrer" target="_blank">proller</a>)</li>
<li>Added disks section to stateless-with-coverage test docker image <a href="https://github.com/ClickHouse/ClickHouse/pull/9213" rel="external nofollow noreferrer" target="_blank">#9213</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Get rid of in-source-tree files when building with GRPC <a href="https://github.com/ClickHouse/ClickHouse/pull/9588" rel="external nofollow noreferrer" target="_blank">#9588</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Slightly faster build time by removing SessionCleaner from Context. Make the code of SessionCleaner more simple. <a href="https://github.com/ClickHouse/ClickHouse/pull/9232" rel="external nofollow noreferrer" target="_blank">#9232</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Updated checking for hung queries in clickhouse-test script <a href="https://github.com/ClickHouse/ClickHouse/pull/8858" rel="external nofollow noreferrer" target="_blank">#8858</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Removed some useless files from repository. <a href="https://github.com/ClickHouse/ClickHouse/pull/8843" rel="external nofollow noreferrer" target="_blank">#8843</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Changed type of math perftests from <code class="syntax">once</code> to <code class="syntax">loop</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8783" rel="external nofollow noreferrer" target="_blank">#8783</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Add docker image which allows to build interactive code browser HTML report for our codebase. <a href="https://github.com/ClickHouse/ClickHouse/pull/8781" rel="external nofollow noreferrer" target="_blank">#8781</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>) See <a href="https://clickhouse-test-reports.s3.yandex.net/codebrowser/html_report///ClickHouse/dbms/index.html" rel="external nofollow noreferrer" target="_blank">Woboq Code Browser</a></li>
<li>Suppress some test failures under MSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/8780" rel="external nofollow noreferrer" target="_blank">#8780</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Speedup "exception while insert" test. This test often time out in debug-with-coverage build. <a href="https://github.com/ClickHouse/ClickHouse/pull/8711" rel="external nofollow noreferrer" target="_blank">#8711</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Updated <code class="syntax">libcxx</code> and <code class="syntax">libcxxabi</code> to master. In preparation to <a href="https://github.com/ClickHouse/ClickHouse/issues/9304" rel="external nofollow noreferrer" target="_blank">#9304</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9308" rel="external nofollow noreferrer" target="_blank">#9308</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix flacky test <code class="syntax">00910_zookeeper_test_alter_compression_codecs</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9525" rel="external nofollow noreferrer" target="_blank">#9525</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Clean up duplicated linker flags. Make sure the linker won't look up an unexpected symbol. <a href="https://github.com/ClickHouse/ClickHouse/pull/9433" rel="external nofollow noreferrer" target="_blank">#9433</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Add <code class="syntax">clickhouse-odbc</code> driver into test images. This allows to test interaction of ClickHouse with ClickHouse via its own ODBC driver. <a href="https://github.com/ClickHouse/ClickHouse/pull/9348" rel="external nofollow noreferrer" target="_blank">#9348</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fix several bugs in unit tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/9047" rel="external nofollow noreferrer" target="_blank">#9047</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Enable <code class="syntax">-Wmissing-include-dirs</code> GCC warning to eliminate all non-existing includes - mostly as a result of CMake scripting errors <a href="https://github.com/ClickHouse/ClickHouse/pull/8704" rel="external nofollow noreferrer" target="_blank">#8704</a> (<a href="https://github.com/kreuzerkrieg" rel="external nofollow noreferrer" target="_blank">kreuzerkrieg</a>)</li>
<li>Describe reasons if query profiler cannot work. This is intended for <a href="https://github.com/ClickHouse/ClickHouse/issues/9049" rel="external nofollow noreferrer" target="_blank">#9049</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9144" rel="external nofollow noreferrer" target="_blank">#9144</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update OpenSSL to upstream master. Fixed the issue when TLS connections may fail with the message <code class="syntax">OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error</code> and <code class="syntax">SSL Exception: error:2400006E:random number generator::error retrieving entropy</code>. The issue was present in version 20.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/8956" rel="external nofollow noreferrer" target="_blank">#8956</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update Dockerfile for server <a href="https://github.com/ClickHouse/ClickHouse/pull/8893" rel="external nofollow noreferrer" target="_blank">#8893</a> (<a href="https://github.com/ne-ray" rel="external nofollow noreferrer" target="_blank">Ilya Mazaev</a>)</li>
<li>Minor fixes in build-gcc-from-sources script <a href="https://github.com/ClickHouse/ClickHouse/pull/8774" rel="external nofollow noreferrer" target="_blank">#8774</a> (<a href="https://github.com/mnach" rel="external nofollow noreferrer" target="_blank">Michael Nacharov</a>)</li>
<li>Replace <code class="syntax">numbers</code> to <code class="syntax">zeros</code> in perftests where <code class="syntax">number</code> column is not used. This will lead to more clean test results. <a href="https://github.com/ClickHouse/ClickHouse/pull/9600" rel="external nofollow noreferrer" target="_blank">#9600</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix stack overflow issue when using initializer_list in Column constructors. <a href="https://github.com/ClickHouse/ClickHouse/pull/9367" rel="external nofollow noreferrer" target="_blank">#9367</a> (<a href="https://github.com/ghost" rel="external nofollow noreferrer" target="_blank">Deleted user</a>)</li>
<li>Upgrade librdkafka to v1.3.0. Enable bundled <code class="syntax">rdkafka</code> and <code class="syntax">gsasl</code> libraries on Mac OS X. <a href="https://github.com/ClickHouse/ClickHouse/pull/9000" rel="external nofollow noreferrer" target="_blank">#9000</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>)</li>
<li>build fix on GCC 9.2.0 <a href="https://github.com/ClickHouse/ClickHouse/pull/9306" rel="external nofollow noreferrer" target="_blank">#9306</a> (<a href="https://github.com/Vxider" rel="external nofollow noreferrer" target="_blank">vxider</a>)</li>
</ul>
<h2 id="clickhouse-release-v20-1">ClickHouse release v20.1<a class="headerlink" href="#clickhouse-release-v20-1" title="Permanent link"> </a></h2>
<h3 id="clickhouse-release-v20-1-16-120-stable-2020-60-26">ClickHouse release v20.1.16.120-stable 2020-60-26<a class="headerlink" href="#clickhouse-release-v20-1-16-120-stable-2020-60-26" title="Permanent link"> </a></h3>
<h4 id="bug-fix_50">Bug Fix<a class="headerlink" href="#bug-fix_50" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" rel="external nofollow noreferrer" target="_blank">#11608</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" rel="external nofollow noreferrer" target="_blank">#11869</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Don't allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" rel="external nofollow noreferrer" target="_blank">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" rel="external nofollow noreferrer" target="_blank">#11846</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix unexpected behaviour of queries like <code class="syntax">SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" rel="external nofollow noreferrer" target="_blank">#11753</a> (<a href="https://github.com/hexiaoting" rel="external nofollow noreferrer" target="_blank">hexiaoting</a>).</li>
<li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" rel="external nofollow noreferrer" target="_blank">#11732</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix <code class="syntax">ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" rel="external nofollow noreferrer" target="_blank">#11697</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" rel="external nofollow noreferrer" target="_blank">#11690</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" rel="external nofollow noreferrer" target="_blank">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" rel="external nofollow noreferrer" target="_blank">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" rel="external nofollow noreferrer" target="_blank">#11649</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" rel="external nofollow noreferrer" target="_blank">#11638</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix rare crash caused by using <code class="syntax">Nullable</code> column in prewhere condition. (Probably it is connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" rel="external nofollow noreferrer" target="_blank">#11572</a> somehow). <a href="https://github.com/ClickHouse/ClickHouse/pull/11608" rel="external nofollow noreferrer" target="_blank">#11608</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" rel="external nofollow noreferrer" target="_blank">#11601</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Fix trivial error in log message about "Mark cache size was lowered" at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" rel="external nofollow noreferrer" target="_blank">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" rel="external nofollow noreferrer" target="_blank">#11589</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" rel="external nofollow noreferrer" target="_blank">#11550</a> (<a href="https://github.com/istarkov" rel="external nofollow noreferrer" target="_blank">Ivan Starkov</a>).</li>
<li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" rel="external nofollow noreferrer" target="_blank">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" rel="external nofollow noreferrer" target="_blank">#11496</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix usage of primary key wrapped into a function with 'FINAL' modifier and 'ORDER BY' optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10715" rel="external nofollow noreferrer" target="_blank">#10715</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-1-15-109-stable-2020-06-19">ClickHouse release v20.1.15.109-stable 2020-06-19<a class="headerlink" href="#clickhouse-release-v20-1-15-109-stable-2020-06-19" title="Permanent link"> </a></h3>
<h4 id="bug-fix_51">Bug Fix<a class="headerlink" href="#bug-fix_51" title="Permanent link"> </a></h4>
<ul>
<li>Fix excess lock for structure during alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11790" rel="external nofollow noreferrer" target="_blank">#11790</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-1-14-107-stable-2020-06-11">ClickHouse release v20.1.14.107-stable 2020-06-11<a class="headerlink" href="#clickhouse-release-v20-1-14-107-stable-2020-06-11" title="Permanent link"> </a></h3>
<h4 id="bug-fix_52">Bug Fix<a class="headerlink" href="#bug-fix_52" title="Permanent link"> </a></h4>
<ul>
<li>Fix error <code class="syntax">Size of offsets does not match size of column</code> for queries with <code class="syntax">PREWHERE column in (subquery)</code> and <code class="syntax">ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" rel="external nofollow noreferrer" target="_blank">#11580</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-1-13-105-stable-2020-06-10">ClickHouse release v20.1.13.105-stable 2020-06-10<a class="headerlink" href="#clickhouse-release-v20-1-13-105-stable-2020-06-10" title="Permanent link"> </a></h3>
<h4 id="bug-fix_53">Bug Fix<a class="headerlink" href="#bug-fix_53" title="Permanent link"> </a></h4>
<ul>
<li>Fix the error <code class="syntax">Data compressed with different methods</code> that can happen if <code class="syntax">min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" rel="external nofollow noreferrer" target="_blank">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" rel="external nofollow noreferrer" target="_blank">#11540</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" rel="external nofollow noreferrer" target="_blank">#11448</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" rel="external nofollow noreferrer" target="_blank">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" rel="external nofollow noreferrer" target="_blank">#11431</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix pointInPolygon with nan as point. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11375" rel="external nofollow noreferrer" target="_blank">#11375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" rel="external nofollow noreferrer" target="_blank">#11421</a> (<a href="https://github.com/livace" rel="external nofollow noreferrer" target="_blank">Alexey Ilyukhov</a>).</li>
<li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" rel="external nofollow noreferrer" target="_blank">#11403</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fix possible <code class="syntax">Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" rel="external nofollow noreferrer" target="_blank">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" rel="external nofollow noreferrer" target="_blank">#11366</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix crash in <code class="syntax">quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" rel="external nofollow noreferrer" target="_blank">#11337</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Make writing to <code class="syntax">MATERIALIZED VIEW</code> with setting <code class="syntax">parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" rel="external nofollow noreferrer" target="_blank">#11330</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" rel="external nofollow noreferrer" target="_blank">#11318</a> (<a href="https://github.com/devwout" rel="external nofollow noreferrer" target="_blank">Ewout</a>).</li>
<li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" rel="external nofollow noreferrer" target="_blank">#11314</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix potential uninitialized memory in conversion. Example: <code class="syntax">SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" rel="external nofollow noreferrer" target="_blank">#11311</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code class="syntax">empty</code> or <code class="syntax">notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" rel="external nofollow noreferrer" target="_blank">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" rel="external nofollow noreferrer" target="_blank">#11303</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix bug when query speed estimation can be incorrect and the limit of <code class="syntax">min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code class="syntax">max_network_bandwidth</code>, <code class="syntax">max_execution_speed</code> or <code class="syntax">priority</code> settings. Change the default value of <code class="syntax">timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code class="syntax">min_execution_speed</code> and <code class="syntax">max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" rel="external nofollow noreferrer" target="_blank">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" rel="external nofollow noreferrer" target="_blank">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" rel="external nofollow noreferrer" target="_blank">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code class="syntax">clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" rel="external nofollow noreferrer" target="_blank">#11296</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix crash while reading malformed data in Protobuf format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" rel="external nofollow noreferrer" target="_blank">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" rel="external nofollow noreferrer" target="_blank">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" rel="external nofollow noreferrer" target="_blank">#11258</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix possible error <code class="syntax">Cannot capture column</code> for higher-order functions with <code class="syntax">Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" rel="external nofollow noreferrer" target="_blank">#11185</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" rel="external nofollow noreferrer" target="_blank">#11162</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Remove logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" rel="external nofollow noreferrer" target="_blank">#11109</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed parseDateTime64BestEffort argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/issues/10925" rel="external nofollow noreferrer" target="_blank">#10925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" rel="external nofollow noreferrer" target="_blank">#11038</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
<li>Fix incorrect raw data size in method getRawData(). <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" rel="external nofollow noreferrer" target="_blank">#10964</a> (<a href="https://github.com/ObjatieGroba" rel="external nofollow noreferrer" target="_blank">Igr</a>).</li>
<li>Fix backward compatibility with tuples in Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" rel="external nofollow noreferrer" target="_blank">#10889</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix SIGSEGV in StringHashTable (if such key does not exist). <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" rel="external nofollow noreferrer" target="_blank">#10870</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed bug in <code class="syntax">ReplicatedMergeTree</code> which might cause some <code class="syntax">ALTER</code> on <code class="syntax">OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" rel="external nofollow noreferrer" target="_blank">#10849</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fix columns order after Block::sortColumns() (also add a test that shows that it affects some real use case - Buffer engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" rel="external nofollow noreferrer" target="_blank">#10826</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix the issue with ODBC bridge when no quoting of identifiers is requested. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" rel="external nofollow noreferrer" target="_blank">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" rel="external nofollow noreferrer" target="_blank">#10821</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix UBSan and MSan report in DateLUT. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" rel="external nofollow noreferrer" target="_blank">#10798</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>
<ul>
<li>Make use of <code class="syntax">src_type</code> for correct type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" rel="external nofollow noreferrer" target="_blank">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" rel="external nofollow noreferrer" target="_blank">#10791</a> (<a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">Andrew Onyshchuk</a>).</li>
</ul>
</li>
<li>Fix <code class="syntax">parallel_view_processing</code> behavior. Now all insertions into <code class="syntax">MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" rel="external nofollow noreferrer" target="_blank">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" rel="external nofollow noreferrer" target="_blank">#10757</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix combinator -OrNull and -OrDefault when combined with -State. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" rel="external nofollow noreferrer" target="_blank">#10741</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fix disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" rel="external nofollow noreferrer" target="_blank">#10674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" rel="external nofollow noreferrer" target="_blank">#10698</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix multiple usages of <code class="syntax">IN</code> operator with the identical set in one query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" rel="external nofollow noreferrer" target="_blank">#10686</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>).</li>
<li>Fix order of parameters in AggregateTransform constructor. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" rel="external nofollow noreferrer" target="_blank">#10667</a> (<a href="https://github.com/palasonic1" rel="external nofollow noreferrer" target="_blank">palasonic1</a>).</li>
<li>Fix the lack of parallel execution of remote queries with <code class="syntax">distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" rel="external nofollow noreferrer" target="_blank">#10655</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" rel="external nofollow noreferrer" target="_blank">#10664</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix predicates optimization for distributed queries (<code class="syntax">enable_optimize_predicate_expression=1</code>) for queries with <code class="syntax">HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" rel="external nofollow noreferrer" target="_blank">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" rel="external nofollow noreferrer" target="_blank">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" rel="external nofollow noreferrer" target="_blank">#10621</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix error <code class="syntax">the BloomFilter false positive must be a double number between 0 and 1</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" rel="external nofollow noreferrer" target="_blank">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" rel="external nofollow noreferrer" target="_blank">#10569</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix SELECT of column ALIAS which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" rel="external nofollow noreferrer" target="_blank">#10563</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>
<ul>
<li>Implemented comparison between DateTime64 and String values (just like for DateTime). <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" rel="external nofollow noreferrer" target="_blank">#10560</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
</ul>
</li>
</ul>
<h3 id="clickhouse-release-v20-1-12-86-2020-05-26">ClickHouse release v20.1.12.86, 2020-05-26<a class="headerlink" href="#clickhouse-release-v20-1-12-86-2020-05-26" title="Permanent link"> </a></h3>
<h4 id="bug-fix_54">Bug Fix<a class="headerlink" href="#bug-fix_54" title="Permanent link"> </a></h4>
<ul>
<li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" rel="external nofollow noreferrer" target="_blank">#10952</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed data corruption for <code class="syntax">LowCardinality(FixedString)</code> key column in <code class="syntax">SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" rel="external nofollow noreferrer" target="_blank">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" rel="external nofollow noreferrer" target="_blank">#10721</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed bug, which causes http requests stuck on client close when <code class="syntax">readonly=2</code> and <code class="syntax">cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7939" rel="external nofollow noreferrer" target="_blank">#7939</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7019" rel="external nofollow noreferrer" target="_blank">#7019</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7736" rel="external nofollow noreferrer" target="_blank">#7736</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7091" rel="external nofollow noreferrer" target="_blank">#7091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" rel="external nofollow noreferrer" target="_blank">#10684</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed a bug when on <code class="syntax">SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" rel="external nofollow noreferrer" target="_blank">#10608</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>).</li>
<li>Fixed incorrect scalar results inside inner query of <code class="syntax">MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" rel="external nofollow noreferrer" target="_blank">#10603</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed the situation when mutation finished all parts, but hung up in <code class="syntax">is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10526" rel="external nofollow noreferrer" target="_blank">#10526</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed overflow at beginning of unix epoch for timezones with fractional offset from UTC. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9335" rel="external nofollow noreferrer" target="_blank">#9335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10513" rel="external nofollow noreferrer" target="_blank">#10513</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed improper shutdown of Distributed storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/10491" rel="external nofollow noreferrer" target="_blank">#10491</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed numeric overflow in <code class="syntax">simpleLinearRegression</code> over large integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/10474" rel="external nofollow noreferrer" target="_blank">#10474</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>).</li>
<li>Fixed removing metadata directory when attach database fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/10442" rel="external nofollow noreferrer" target="_blank">#10442</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Added a check of number and type of arguments when creating <code class="syntax">BloomFilter</code> index <a href="https://github.com/ClickHouse/ClickHouse/issues/9623" rel="external nofollow noreferrer" target="_blank">#9623</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10431" rel="external nofollow noreferrer" target="_blank">#10431</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fixed the issue when a query with <code class="syntax">ARRAY JOIN</code>, <code class="syntax">ORDER BY</code> and <code class="syntax">LIMIT</code> may return incomplete result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10226" rel="external nofollow noreferrer" target="_blank">#10226</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10427" rel="external nofollow noreferrer" target="_blank">#10427</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Prefer <code class="syntax">fallback_to_stale_replicas</code> over <code class="syntax">skip_unavailable_shards</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10422" rel="external nofollow noreferrer" target="_blank">#10422</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed wrong flattening of <code class="syntax">Array(Tuple(...))</code> data types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10259" rel="external nofollow noreferrer" target="_blank">#10259</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10390" rel="external nofollow noreferrer" target="_blank">#10390</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fixed wrong behavior in <code class="syntax">HashTable</code> that caused compilation error when trying to read HashMap from buffer. <a href="https://github.com/ClickHouse/ClickHouse/pull/10386" rel="external nofollow noreferrer" target="_blank">#10386</a> (<a href="https://github.com/palasonic1" rel="external nofollow noreferrer" target="_blank">palasonic1</a>).</li>
<li>Fixed possible <code class="syntax">Pipeline stuck</code> error in <code class="syntax">ConcatProcessor</code> which could have happened in remote query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10381" rel="external nofollow noreferrer" target="_blank">#10381</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed error <code class="syntax">Pipeline stuck</code> with <code class="syntax">max_rows_to_group_by</code> and <code class="syntax">group_by_overflow_mode = 'break'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10279" rel="external nofollow noreferrer" target="_blank">#10279</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed several bugs when some data was inserted with quorum, then deleted somehow (DROP PARTITION, TTL) and this leaded to the stuck of INSERTs or false-positive exceptions in SELECTs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9946" rel="external nofollow noreferrer" target="_blank">#9946</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10188" rel="external nofollow noreferrer" target="_blank">#10188</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>).</li>
<li>Fixed incompatibility when versions prior to 18.12.17 are used on remote servers and newer is used on initiating server, and GROUP BY both fixed and non-fixed keys, and when two-level group by method is activated. <a href="https://github.com/ClickHouse/ClickHouse/pull/3254" rel="external nofollow noreferrer" target="_blank">#3254</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_21">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_21" title="Permanent link"> </a></h4>
<ul>
<li>Added CA certificates to clickhouse-server docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/10476" rel="external nofollow noreferrer" target="_blank">#10476</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-1-10-70-2020-04-17">ClickHouse release v20.1.10.70, 2020-04-17<a class="headerlink" href="#clickhouse-release-v20-1-10-70-2020-04-17" title="Permanent link"> </a></h3>
<h4 id="bug-fix_55">Bug Fix<a class="headerlink" href="#bug-fix_55" title="Permanent link"> </a></h4>
<ul>
<li>Fix rare possible exception <code class="syntax">Cannot drain connections: cancel first</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10239" rel="external nofollow noreferrer" target="_blank">#10239</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fixed bug where ClickHouse would throw <code class="syntax">'Unknown function lambda.'</code> error message when user tries to run <code class="syntax">ALTER UPDATE/DELETE</code> on tables with <code class="syntax">ENGINE = Replicated*</code>. Check for nondeterministic functions now handles lambda expressions correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10237" rel="external nofollow noreferrer" target="_blank">#10237</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>).</li>
<li>Fix <code class="syntax">parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10082" rel="external nofollow noreferrer" target="_blank">#10082</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10214" rel="external nofollow noreferrer" target="_blank">#10214</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix column names of constants inside <code class="syntax">JOIN</code> that may clash with names of constants outside of <code class="syntax">JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10207" rel="external nofollow noreferrer" target="_blank">#10207</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Fix possible inifinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code class="syntax">system.numbers</code> or <code class="syntax">system.zeros</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10206" rel="external nofollow noreferrer" target="_blank">#10206</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix move-to-prewhere optimization in presense of <code class="syntax">arrayJoin</code> functions (in certain cases). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10092" rel="external nofollow noreferrer" target="_blank">#10092</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10195" rel="external nofollow noreferrer" target="_blank">#10195</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>).</li>
<li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code class="syntax">allow_nondeterministic_mutations</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10186" rel="external nofollow noreferrer" target="_blank">#10186</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>).</li>
<li>Convert blocks if structure does not match on <code class="syntax">INSERT</code> into table with <code class="syntax">Distributed</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10135" rel="external nofollow noreferrer" target="_blank">#10135</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix <code class="syntax">SIGSEGV</code> on <code class="syntax">INSERT</code> into <code class="syntax">Distributed</code> table when its structure differs from the underlying tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10105" rel="external nofollow noreferrer" target="_blank">#10105</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fix possible rows loss for queries with <code class="syntax">JOIN</code> and <code class="syntax">UNION ALL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9826" rel="external nofollow noreferrer" target="_blank">#9826</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10113" rel="external nofollow noreferrer" target="_blank">#10113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10099" rel="external nofollow noreferrer" target="_blank">#10099</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Add arguments check and support identifier arguments for MySQL Database Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10077" rel="external nofollow noreferrer" target="_blank">#10077</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>).</li>
<li>Fix bug in clickhouse dictionary source from localhost clickhouse server. The bug may lead to memory corruption if types in dictionary and source are not compatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/10071" rel="external nofollow noreferrer" target="_blank">#10071</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fix error <code class="syntax">Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code class="syntax">distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with different level from different shards (mixed single and two level aggregation). <a href="https://github.com/ClickHouse/ClickHouse/pull/10063" rel="external nofollow noreferrer" target="_blank">#10063</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix a segmentation fault that could occur in <code class="syntax">GROUP BY</code> over string keys containing trailing zero bytes (<a href="https://github.com/ClickHouse/ClickHouse/issues/8636" rel="external nofollow noreferrer" target="_blank">#8636</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8925" rel="external nofollow noreferrer" target="_blank">#8925</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10025" rel="external nofollow noreferrer" target="_blank">#10025</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>).</li>
<li>Fix bug in which the necessary tables weren't retrieved at one of the processing stages of queries to some databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9699" rel="external nofollow noreferrer" target="_blank">#9699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9949" rel="external nofollow noreferrer" target="_blank">#9949</a> (<a href="https://github.com/achulkov2" rel="external nofollow noreferrer" target="_blank">achulkov2</a>).</li>
<li>Fix <code class="syntax">'Not found column in block'</code> error when <code class="syntax">JOIN</code> appears with <code class="syntax">TOTALS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9839" rel="external nofollow noreferrer" target="_blank">#9839</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9939" rel="external nofollow noreferrer" target="_blank">#9939</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix a bug with <code class="syntax">ON CLUSTER</code> DDL queries freezing on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/9927" rel="external nofollow noreferrer" target="_blank">#9927</a> (<a href="https://github.com/garneja" rel="external nofollow noreferrer" target="_blank">Gagan Arneja</a>).</li>
<li>Fix <code class="syntax">TRUNCATE</code> for Join table engine (<a href="https://github.com/ClickHouse/ClickHouse/issues/9917" rel="external nofollow noreferrer" target="_blank">#9917</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9920" rel="external nofollow noreferrer" target="_blank">#9920</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix <code class="syntax">'scalar does not exist'</code> error in ALTER queries (<a href="https://github.com/ClickHouse/ClickHouse/issues/9878" rel="external nofollow noreferrer" target="_blank">#9878</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9904" rel="external nofollow noreferrer" target="_blank">#9904</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
<li>Fix race condition between drop and optimize in <code class="syntax">ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9901" rel="external nofollow noreferrer" target="_blank">#9901</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>Fixed <code class="syntax">DeleteOnDestroy</code> logic in <code class="syntax">ATTACH PART</code> which could lead to automatic removal of attached part and added few tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/9410" rel="external nofollow noreferrer" target="_blank">#9410</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_22">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_22" title="Permanent link"> </a></h4>
<ul>
<li>Fix unit test <code class="syntax">collapsing_sorted_stream</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9367" rel="external nofollow noreferrer" target="_blank">#9367</a> (<a href="https://github.com/ghost" rel="external nofollow noreferrer" target="_blank">Deleted user</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-1-9-54-2020-03-28">ClickHouse release v20.1.9.54, 2020-03-28<a class="headerlink" href="#clickhouse-release-v20-1-9-54-2020-03-28" title="Permanent link"> </a></h3>
<h4 id="bug-fix_56">Bug Fix<a class="headerlink" href="#bug-fix_56" title="Permanent link"> </a></h4>
<ul>
<li>Fix <code class="syntax">'Different expressions with the same alias'</code> error when query has <code class="syntax">PREWHERE</code> and <code class="syntax">WHERE</code> on distributed table and <code class="syntax">SET distributed_product_mode = 'local'</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9871" rel="external nofollow noreferrer" target="_blank">#9871</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>).</li>
<li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9850" rel="external nofollow noreferrer" target="_blank">#9850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9860" rel="external nofollow noreferrer" target="_blank">#9860</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
<li>For INSERT queries shard now clamps the settings got from the initiator to the shard's constaints instead of throwing an exception. This fix allows to send <code class="syntax">INSERT</code> queries to a shard with another constraints. This change improves fix <a href="https://github.com/ClickHouse/ClickHouse/issues/9447" rel="external nofollow noreferrer" target="_blank">#9447</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9852" rel="external nofollow noreferrer" target="_blank">#9852</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>).</li>
<li>Fix possible exception <code class="syntax">Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code class="syntax">JOIN</code> in case if right joined table had zero rows. Example: <code class="syntax">select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9777" rel="external nofollow noreferrer" target="_blank">#9777</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9823" rel="external nofollow noreferrer" target="_blank">#9823</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>).</li>
<li>Fix <code class="syntax">SIGSEGV</code> with <code class="syntax">optimize_skip_unused_shards</code> when type cannot be converted. <a href="https://github.com/ClickHouse/ClickHouse/pull/9804" rel="external nofollow noreferrer" target="_blank">#9804</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>).</li>
<li>Fixed a few cases when timezone of the function argument wasn't used properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/9574" rel="external nofollow noreferrer" target="_blank">#9574</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>).</li>
</ul>
<h4 id="improvement_21">Improvement<a class="headerlink" href="#improvement_21" title="Permanent link"> </a></h4>
<ul>
<li>Remove <code class="syntax">ORDER BY</code> stage from mutations because we read from a single ordered part in a single thread. Also add check that the order of rows in mutation is ordered in sorting key order and this order is not violated. <a href="https://github.com/ClickHouse/ClickHouse/pull/9886" rel="external nofollow noreferrer" target="_blank">#9886</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>).</li>
</ul>
<h4 id="build-testing-packaging-improvement_23">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_23" title="Permanent link"> </a></h4>
<ul>
<li>Clean up duplicated linker flags. Make sure the linker won't look up an unexpected symbol. <a href="https://github.com/ClickHouse/ClickHouse/pull/9433" rel="external nofollow noreferrer" target="_blank">#9433</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>).</li>
</ul>
<h3 id="clickhouse-release-v20-1-8-41-2020-03-20">ClickHouse release v20.1.8.41, 2020-03-20<a class="headerlink" href="#clickhouse-release-v20-1-8-41-2020-03-20" title="Permanent link"> </a></h3>
<h4 id="bug-fix_57">Bug Fix<a class="headerlink" href="#bug-fix_57" title="Permanent link"> </a></h4>
<ul>
<li>Fix possible permanent <code class="syntax">Cannot schedule a task</code> error (due to unhandled exception in <code class="syntax">ParallelAggregatingBlockInputStream::Handler::onFinish/onFinishThread</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6833" rel="external nofollow noreferrer" target="_blank">#6833</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9154" rel="external nofollow noreferrer" target="_blank">#9154</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix excessive memory consumption in <code class="syntax">ALTER</code> queries (mutations). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9533" rel="external nofollow noreferrer" target="_blank">#9533</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/9670" rel="external nofollow noreferrer" target="_blank">#9670</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9754" rel="external nofollow noreferrer" target="_blank">#9754</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix bug in backquoting in external dictionaries DDL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9619" rel="external nofollow noreferrer" target="_blank">#9619</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9734" rel="external nofollow noreferrer" target="_blank">#9734</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
</ul>
<h3 id="clickhouse-release-v20-1-7-38-2020-03-18">ClickHouse release v20.1.7.38, 2020-03-18<a class="headerlink" href="#clickhouse-release-v20-1-7-38-2020-03-18" title="Permanent link"> </a></h3>
<h4 id="bug-fix_58">Bug Fix<a class="headerlink" href="#bug-fix_58" title="Permanent link"> </a></h4>
<ul>
<li>Fixed incorrect internal function names for <code class="syntax">sumKahan</code> and <code class="syntax">sumWithOverflow</code>. I lead to exception while using this functions in remote queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9636" rel="external nofollow noreferrer" target="_blank">#9636</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>). This issue was in all ClickHouse releases.</li>
<li>Allow <code class="syntax">ALTER ON CLUSTER</code> of <code class="syntax">Distributed</code> tables with internal replication. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3268" rel="external nofollow noreferrer" target="_blank">#3268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9617" rel="external nofollow noreferrer" target="_blank">#9617</a> (<a href="https://github.com/shinoi2" rel="external nofollow noreferrer" target="_blank">shinoi2</a>). This issue was in all ClickHouse releases.</li>
<li>Fix possible exceptions <code class="syntax">Size of filter does not match size of column</code> and <code class="syntax">Invalid number of rows in Chunk</code> in <code class="syntax">MergeTreeRangeReader</code>. They could appear while executing <code class="syntax">PREWHERE</code> in some cases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9132" rel="external nofollow noreferrer" target="_blank">#9132</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9612" rel="external nofollow noreferrer" target="_blank">#9612</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fixed the issue: timezone was not preserved if you write a simple arithmetic expression like <code class="syntax">time + 1</code> (in contrast to an expression like <code class="syntax">time + INTERVAL 1 SECOND</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5743" rel="external nofollow noreferrer" target="_blank">#5743</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9323" rel="external nofollow noreferrer" target="_blank">#9323</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>). This issue was in all ClickHouse releases.</li>
<li>Now it's not possible to create or add columns with simple cyclic aliases like <code class="syntax">a DEFAULT b, b DEFAULT a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9603" rel="external nofollow noreferrer" target="_blank">#9603</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed the issue when padding at the end of base64 encoded value can be malformed. Update base64 library. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9491" rel="external nofollow noreferrer" target="_blank">#9491</a>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9492" rel="external nofollow noreferrer" target="_blank">#9492</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9500" rel="external nofollow noreferrer" target="_blank">#9500</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix data race at destruction of <code class="syntax">Poco::HTTPServer</code>. It could happen when server is started and immediately shut down. <a href="https://github.com/ClickHouse/ClickHouse/pull/9468" rel="external nofollow noreferrer" target="_blank">#9468</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix possible crash/wrong number of rows in <code class="syntax">LIMIT n WITH TIES</code> when there are a lot of rows equal to n'th row. <a href="https://github.com/ClickHouse/ClickHouse/pull/9464" rel="external nofollow noreferrer" target="_blank">#9464</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix possible mismatched checksums with column TTLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/9451" rel="external nofollow noreferrer" target="_blank">#9451</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Fix crash when a user tries to <code class="syntax">ALTER MODIFY SETTING</code> for old-formated <code class="syntax">MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/9435" rel="external nofollow noreferrer" target="_blank">#9435</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Now we will try finalize mutations more frequently. <a href="https://github.com/ClickHouse/ClickHouse/pull/9427" rel="external nofollow noreferrer" target="_blank">#9427</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix replication protocol incompatibility introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/8598" rel="external nofollow noreferrer" target="_blank">#8598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9412" rel="external nofollow noreferrer" target="_blank">#9412</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix not(has()) for the bloom_filter index of array types. <a href="https://github.com/ClickHouse/ClickHouse/pull/9407" rel="external nofollow noreferrer" target="_blank">#9407</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>)</li>
<li>Fixed the behaviour of <code class="syntax">match</code> and <code class="syntax">extract</code> functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9160" rel="external nofollow noreferrer" target="_blank">#9160</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9163" rel="external nofollow noreferrer" target="_blank">#9163</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/9345" rel="external nofollow noreferrer" target="_blank">#9345</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h4 id="build-testing-packaging-improvement_24">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_24" title="Permanent link"> </a></h4>
<ul>
<li>Exception handling now works correctly on Windows Subsystem for Linux. See <a href="https://github.com/ClickHouse-Extras/libunwind/pull/3" target="_blank">https://github.com/ClickHouse-Extras/libunwind/pull/3</a> This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6480" rel="external nofollow noreferrer" target="_blank">#6480</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9564" rel="external nofollow noreferrer" target="_blank">#9564</a> (<a href="https://github.com/sobolevsv" rel="external nofollow noreferrer" target="_blank">sobolevsv</a>)</li>
</ul>
<h3 id="clickhouse-release-v20-1-6-30-2020-03-05">ClickHouse release v20.1.6.30, 2020-03-05<a class="headerlink" href="#clickhouse-release-v20-1-6-30-2020-03-05" title="Permanent link"> </a></h3>
<h4 id="bug-fix_59">Bug Fix<a class="headerlink" href="#bug-fix_59" title="Permanent link"> </a></h4>
<ul>
<li>Fix data incompatibility when compressed with <code class="syntax">T64</code> codec.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9039" rel="external nofollow noreferrer" target="_blank">#9039</a> <a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">(abyss7)</a></li>
<li>Fix order of ranges while reading from MergeTree table in one thread. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8964" rel="external nofollow noreferrer" target="_blank">#8964</a>.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9050" rel="external nofollow noreferrer" target="_blank">#9050</a> <a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">(CurtizJ)</a></li>
<li>Fix possible segfault in <code class="syntax">MergeTreeRangeReader</code>, while executing <code class="syntax">PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9064" rel="external nofollow noreferrer" target="_blank">#9064</a>.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9106" rel="external nofollow noreferrer" target="_blank">#9106</a> <a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">(CurtizJ)</a></li>
<li>Fix <code class="syntax">reinterpretAsFixedString</code> to return <code class="syntax">FixedString</code> instead of <code class="syntax">String</code>.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9052" rel="external nofollow noreferrer" target="_blank">#9052</a> <a href="https://github.com/oandrew" rel="external nofollow noreferrer" target="_blank">(oandrew)</a></li>
<li>Fix <code class="syntax">joinGet</code> with nullable return types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8919" rel="external nofollow noreferrer" target="_blank">#8919</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9014" rel="external nofollow noreferrer" target="_blank">#9014</a> <a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">(amosbird)</a></li>
<li>Fix fuzz test and incorrect behaviour of bitTestAll/bitTestAny functions.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9143" rel="external nofollow noreferrer" target="_blank">#9143</a> <a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">(alexey-milovidov)</a></li>
<li>Fix the behaviour of match and extract functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9160" rel="external nofollow noreferrer" target="_blank">#9160</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9163" rel="external nofollow noreferrer" target="_blank">#9163</a> <a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">(alexey-milovidov)</a></li>
<li>Fixed execution of inversed predicates when non-strictly monotinic functional index is used. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9034" rel="external nofollow noreferrer" target="_blank">#9034</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9223" rel="external nofollow noreferrer" target="_blank">#9223</a> <a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">(Akazz)</a></li>
<li>Allow to rewrite <code class="syntax">CROSS</code> to <code class="syntax">INNER JOIN</code> if there's <code class="syntax">[NOT] LIKE</code> operator in <code class="syntax">WHERE</code> section. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9191" rel="external nofollow noreferrer" target="_blank">#9191</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9229" rel="external nofollow noreferrer" target="_blank">#9229</a> <a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">(4ertus2)</a></li>
<li>Allow first column(s) in a table with Log engine be an alias.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9231" rel="external nofollow noreferrer" target="_blank">#9231</a> <a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">(abyss7)</a></li>
<li>Allow comma join with <code class="syntax">IN()</code> inside. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7314" rel="external nofollow noreferrer" target="_blank">#7314</a>.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9251" rel="external nofollow noreferrer" target="_blank">#9251</a> <a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">(4ertus2)</a></li>
<li>Improve <code class="syntax">ALTER MODIFY/ADD</code> queries logic. Now you cannot <code class="syntax">ADD</code> column without type, <code class="syntax">MODIFY</code> default expression does not change type of column and <code class="syntax">MODIFY</code> type does not loose default expression value. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8669" rel="external nofollow noreferrer" target="_blank">#8669</a>.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9227" rel="external nofollow noreferrer" target="_blank">#9227</a> <a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">(alesapin)</a></li>
<li>Fix mutations finalization, when already done mutation can have status is_done=0.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9217" rel="external nofollow noreferrer" target="_blank">#9217</a> <a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">(alesapin)</a></li>
<li>Support "Processors" pipeline for system.numbers and system.numbers_mt. This also fixes the bug when <code class="syntax">max_execution_time</code> is not respected.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/7796" rel="external nofollow noreferrer" target="_blank">#7796</a> <a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">(KochetovNicolai)</a></li>
<li>Fix wrong counting of <code class="syntax">DictCacheKeysRequestedFound</code> metric.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9411" rel="external nofollow noreferrer" target="_blank">#9411</a> <a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">(nikitamikhaylov)</a></li>
<li>Added a check for storage policy in <code class="syntax">ATTACH PARTITION FROM</code>, <code class="syntax">REPLACE PARTITION</code>, <code class="syntax">MOVE TO TABLE</code> which otherwise could make data of part inaccessible after restart and prevent ClickHouse to start.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9383" rel="external nofollow noreferrer" target="_blank">#9383</a> <a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">(excitoon)</a></li>
<li>Fixed UBSan report in <code class="syntax">MergeTreeIndexSet</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9250" rel="external nofollow noreferrer" target="_blank">#9250</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9365" rel="external nofollow noreferrer" target="_blank">#9365</a> <a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">(alexey-milovidov)</a></li>
<li>Fix possible datarace in BlockIO.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9356" rel="external nofollow noreferrer" target="_blank">#9356</a> <a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">(KochetovNicolai)</a></li>
<li>Support for <code class="syntax">UInt64</code> numbers that don't fit in Int64 in JSON-related functions. Update <code class="syntax">SIMDJSON</code> to master. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9209" rel="external nofollow noreferrer" target="_blank">#9209</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9344" rel="external nofollow noreferrer" target="_blank">#9344</a> <a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">(alexey-milovidov)</a></li>
<li>Fix the issue when the amount of free space is not calculated correctly if the data directory is mounted to a separate device. For default disk calculate the free space from data subdirectory. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7441" rel="external nofollow noreferrer" target="_blank">#7441</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9257" rel="external nofollow noreferrer" target="_blank">#9257</a> <a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">(millb)</a></li>
<li>Fix the issue when TLS connections may fail with the message <code class="syntax">OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error and SSL Exception: error:2400006E:random number generator::error retrieving entropy.</code> Update OpenSSL to upstream master.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/8956" rel="external nofollow noreferrer" target="_blank">#8956</a> <a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">(alexey-milovidov)</a></li>
<li>When executing <code class="syntax">CREATE</code> query, fold constant expressions in storage engine arguments. Replace empty database name with current database. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6508" rel="external nofollow noreferrer" target="_blank">#6508</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/3492" rel="external nofollow noreferrer" target="_blank">#3492</a>. Also fix check for local address in ClickHouseDictionarySource.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9262" rel="external nofollow noreferrer" target="_blank">#9262</a> <a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">(tabplubix)</a></li>
<li>Fix segfault in <code class="syntax">StorageMerge</code>, which can happen when reading from StorageFile.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9387" rel="external nofollow noreferrer" target="_blank">#9387</a> <a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">(tabplubix)</a></li>
<li>Prevent losing data in <code class="syntax">Kafka</code> in rare cases when exception happens after reading suffix but before commit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9378" rel="external nofollow noreferrer" target="_blank">#9378</a>. Related: <a href="https://github.com/ClickHouse/ClickHouse/issues/7175" rel="external nofollow noreferrer" target="_blank">#7175</a><br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9507" rel="external nofollow noreferrer" target="_blank">#9507</a> <a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">(filimonov)</a></li>
<li>Fix bug leading to server termination when trying to use / drop <code class="syntax">Kafka</code> table created with wrong parameters. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9494" rel="external nofollow noreferrer" target="_blank">#9494</a>. Incorporates <a href="https://github.com/ClickHouse/ClickHouse/issues/9507" rel="external nofollow noreferrer" target="_blank">#9507</a>.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9513" rel="external nofollow noreferrer" target="_blank">#9513</a> <a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">(filimonov)</a></li>
</ul>
<h4 id="new-feature_12">New Feature<a class="headerlink" href="#new-feature_12" title="Permanent link"> </a></h4>
<ul>
<li>Add <code class="syntax">deduplicate_blocks_in_dependent_materialized_views</code> option to control the behaviour of idempotent inserts into tables with materialized views. This new feature was added to the bugfix release by a special request from Altinity.<br/>
<a href="https://github.com/ClickHouse/ClickHouse/pull/9070" rel="external nofollow noreferrer" target="_blank">#9070</a> <a href="https://github.com/urykhy" rel="external nofollow noreferrer" target="_blank">(urykhy)</a></li>
</ul>
<h3 id="clickhouse-release-v20-1-2-4-2020-01-22">ClickHouse release v20.1.2.4, 2020-01-22<a class="headerlink" href="#clickhouse-release-v20-1-2-4-2020-01-22" title="Permanent link"> </a></h3>
<h4 id="backward-incompatible-change_10">Backward Incompatible Change<a class="headerlink" href="#backward-incompatible-change_10" title="Permanent link"> </a></h4>
<ul>
<li>Make the setting <code class="syntax">merge_tree_uniform_read_distribution</code> obsolete. The server still recognizes this setting but it has no effect. <a href="https://github.com/ClickHouse/ClickHouse/pull/8308" rel="external nofollow noreferrer" target="_blank">#8308</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Changed return type of the function <code class="syntax">greatCircleDistance</code> to <code class="syntax">Float32</code> because now the result of calculation is <code class="syntax">Float32</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7993" rel="external nofollow noreferrer" target="_blank">#7993</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Now it's expected that query parameters are represented in "escaped" format. For example, to pass string <code class="syntax">a&lt;tab&gt;b</code> you have to write <code class="syntax">a\tb</code> or <code class="syntax">a\&lt;tab&gt;b</code> and respectively, <code class="syntax">a%5Ctb</code> or <code class="syntax">a%5C%09b</code> in URL. This is needed to add the possibility to pass NULL as <code class="syntax">\N</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7488" rel="external nofollow noreferrer" target="_blank">#7488</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8517" rel="external nofollow noreferrer" target="_blank">#8517</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Enable <code class="syntax">use_minimalistic_part_header_in_zookeeper</code> setting for <code class="syntax">ReplicatedMergeTree</code> by default. This will significantly reduce amount of data stored in ZooKeeper. This setting is supported since version 19.1 and we already use it in production in multiple services without any issues for more than half a year. Disable this setting if you have a chance to downgrade to versions older than 19.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/6850" rel="external nofollow noreferrer" target="_blank">#6850</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Data skipping indices are production ready and enabled by default. The settings <code class="syntax">allow_experimental_data_skipping_indices</code>, <code class="syntax">allow_experimental_cross_to_join_conversion</code> and <code class="syntax">allow_experimental_multiple_joins_emulation</code> are now obsolete and do nothing. <a href="https://github.com/ClickHouse/ClickHouse/pull/7974" rel="external nofollow noreferrer" target="_blank">#7974</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add new <code class="syntax">ANY JOIN</code> logic for <code class="syntax">StorageJoin</code> consistent with <code class="syntax">JOIN</code> operation. To upgrade without changes in behaviour you need add <code class="syntax">SETTINGS any_join_distinct_right_table_keys = 1</code> to Engine Join tables metadata or recreate these tables after upgrade. <a href="https://github.com/ClickHouse/ClickHouse/pull/8400" rel="external nofollow noreferrer" target="_blank">#8400</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Require server to be restarted to apply the changes in logging configuration. This is a temporary workaround to avoid the bug where the server logs to a deleted log file (see <a href="https://github.com/ClickHouse/ClickHouse/issues/8696" rel="external nofollow noreferrer" target="_blank">#8696</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8707" rel="external nofollow noreferrer" target="_blank">#8707</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
</ul>
<h4 id="new-feature_13">New Feature<a class="headerlink" href="#new-feature_13" title="Permanent link"> </a></h4>
<ul>
<li>Added information about part paths to <code class="syntax">system.merges</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8043" rel="external nofollow noreferrer" target="_blank">#8043</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Add ability to execute <code class="syntax">SYSTEM RELOAD DICTIONARY</code> query in <code class="syntax">ON CLUSTER</code> mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/8288" rel="external nofollow noreferrer" target="_blank">#8288</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
<li>Add ability to execute <code class="syntax">CREATE DICTIONARY</code> queries in <code class="syntax">ON CLUSTER</code> mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/8163" rel="external nofollow noreferrer" target="_blank">#8163</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Now user's profile in <code class="syntax">users.xml</code> can inherit multiple profiles. <a href="https://github.com/ClickHouse/ClickHouse/pull/8343" rel="external nofollow noreferrer" target="_blank">#8343</a> (<a href="https://github.com/Felixoid" rel="external nofollow noreferrer" target="_blank">Mikhail f. Shiryaev</a>)</li>
<li>Added <code class="syntax">system.stack_trace</code> table that allows to look at stack traces of all server threads. This is useful for developers to introspect server state. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7576" rel="external nofollow noreferrer" target="_blank">#7576</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8344" rel="external nofollow noreferrer" target="_blank">#8344</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add <code class="syntax">DateTime64</code> datatype with configurable sub-second precision. <a href="https://github.com/ClickHouse/ClickHouse/pull/7170" rel="external nofollow noreferrer" target="_blank">#7170</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Add table function <code class="syntax">clusterAllReplicas</code> which allows to query all the nodes in the cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/8493" rel="external nofollow noreferrer" target="_blank">#8493</a> (<a href="https://github.com/kiransunkari" rel="external nofollow noreferrer" target="_blank">kiran sunkari</a>)</li>
<li>Add aggregate function <code class="syntax">categoricalInformationValue</code> which calculates the information value of a discrete feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/8117" rel="external nofollow noreferrer" target="_blank">#8117</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Speed up parsing of data files in <code class="syntax">CSV</code>, <code class="syntax">TSV</code> and <code class="syntax">JSONEachRow</code> format by doing it in parallel. <a href="https://github.com/ClickHouse/ClickHouse/pull/7780" rel="external nofollow noreferrer" target="_blank">#7780</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Add function <code class="syntax">bankerRound</code> which performs banker's rounding. <a href="https://github.com/ClickHouse/ClickHouse/pull/8112" rel="external nofollow noreferrer" target="_blank">#8112</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Support more languages in embedded dictionary for region names: 'ru', 'en', 'ua', 'uk', 'by', 'kz', 'tr', 'de', 'uz', 'lv', 'lt', 'et', 'pt', 'he', 'vi'. <a href="https://github.com/ClickHouse/ClickHouse/pull/8189" rel="external nofollow noreferrer" target="_blank">#8189</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Improvements in consistency of <code class="syntax">ANY JOIN</code> logic. Now <code class="syntax">t1 ANY LEFT JOIN t2</code> equals <code class="syntax">t2 ANY RIGHT JOIN t1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7665" rel="external nofollow noreferrer" target="_blank">#7665</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Add setting <code class="syntax">any_join_distinct_right_table_keys</code> which enables old behaviour for <code class="syntax">ANY INNER JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7665" rel="external nofollow noreferrer" target="_blank">#7665</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Add new <code class="syntax">SEMI</code> and <code class="syntax">ANTI JOIN</code>. Old <code class="syntax">ANY INNER JOIN</code> behaviour now available as <code class="syntax">SEMI LEFT JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7665" rel="external nofollow noreferrer" target="_blank">#7665</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Added <code class="syntax">Distributed</code> format for <code class="syntax">File</code> engine and <code class="syntax">file</code> table function which allows to read from <code class="syntax">.bin</code> files generated by asynchronous  inserts into <code class="syntax">Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8535" rel="external nofollow noreferrer" target="_blank">#8535</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Add optional reset column argument for <code class="syntax">runningAccumulate</code> which allows to reset aggregation results for each new key value. <a href="https://github.com/ClickHouse/ClickHouse/pull/8326" rel="external nofollow noreferrer" target="_blank">#8326</a> (<a href="https://github.com/kononencheg" rel="external nofollow noreferrer" target="_blank">Sergey Kononenko</a>)</li>
<li>Add ability to use ClickHouse as Prometheus endpoint. <a href="https://github.com/ClickHouse/ClickHouse/pull/7900" rel="external nofollow noreferrer" target="_blank">#7900</a> (<a href="https://github.com/Vdimir" rel="external nofollow noreferrer" target="_blank">vdimir</a>)</li>
<li>Add section <code class="syntax">&lt;remote_url_allow_hosts&gt;</code> in <code class="syntax">config.xml</code> which restricts allowed hosts for remote table engines and table functions <code class="syntax">URL</code>, <code class="syntax">S3</code>, <code class="syntax">HDFS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7154" rel="external nofollow noreferrer" target="_blank">#7154</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Added function <code class="syntax">greatCircleAngle</code> which calculates the distance on a sphere in degrees. <a href="https://github.com/ClickHouse/ClickHouse/pull/8105" rel="external nofollow noreferrer" target="_blank">#8105</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Changed Earth radius to be consistent with H3 library. <a href="https://github.com/ClickHouse/ClickHouse/pull/8105" rel="external nofollow noreferrer" target="_blank">#8105</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added <code class="syntax">JSONCompactEachRow</code> and <code class="syntax">JSONCompactEachRowWithNamesAndTypes</code> formats for input and output. <a href="https://github.com/ClickHouse/ClickHouse/pull/7841" rel="external nofollow noreferrer" target="_blank">#7841</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Added feature for file-related table engines and table functions (<code class="syntax">File</code>, <code class="syntax">S3</code>, <code class="syntax">URL</code>, <code class="syntax">HDFS</code>) which allows to read and write <code class="syntax">gzip</code> files based on additional engine parameter or file extension. <a href="https://github.com/ClickHouse/ClickHouse/pull/7840" rel="external nofollow noreferrer" target="_blank">#7840</a> (<a href="https://github.com/apbodrov" rel="external nofollow noreferrer" target="_blank">Andrey Bodrov</a>)</li>
<li>Added the <code class="syntax">randomASCII(length)</code> function, generating a string with a random set of <a href="https://en.wikipedia.org/wiki/ASCII#Printable_characters" rel="external nofollow noreferrer" target="_blank">ASCII</a> printable characters. <a href="https://github.com/ClickHouse/ClickHouse/pull/8401" rel="external nofollow noreferrer" target="_blank">#8401</a> (<a href="https://github.com/BayoNet" rel="external nofollow noreferrer" target="_blank">BayoNet</a>)</li>
<li>Added function <code class="syntax">JSONExtractArrayRaw</code> which returns an array on unparsed json array elements from <code class="syntax">JSON</code> string. <a href="https://github.com/ClickHouse/ClickHouse/pull/8081" rel="external nofollow noreferrer" target="_blank">#8081</a> (<a href="https://github.com/errx" rel="external nofollow noreferrer" target="_blank">Oleg Matrokhin</a>)</li>
<li>Add <code class="syntax">arrayZip</code> function which allows to combine multiple arrays of equal lengths into one array of tuples. <a href="https://github.com/ClickHouse/ClickHouse/pull/8149" rel="external nofollow noreferrer" target="_blank">#8149</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Add ability to move data between disks according to configured <code class="syntax">TTL</code>-expressions for <code class="syntax">*MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/8140" rel="external nofollow noreferrer" target="_blank">#8140</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Added new aggregate function <code class="syntax">avgWeighted</code> which allows to calculate weighted average. <a href="https://github.com/ClickHouse/ClickHouse/pull/7898" rel="external nofollow noreferrer" target="_blank">#7898</a> (<a href="https://github.com/apbodrov" rel="external nofollow noreferrer" target="_blank">Andrey Bodrov</a>)</li>
<li>Now parallel parsing is enabled by default for <code class="syntax">TSV</code>, <code class="syntax">TSKV</code>, <code class="syntax">CSV</code> and <code class="syntax">JSONEachRow</code> formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/7894" rel="external nofollow noreferrer" target="_blank">#7894</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Add several geo functions from <code class="syntax">H3</code> library: <code class="syntax">h3GetResolution</code>, <code class="syntax">h3EdgeAngle</code>, <code class="syntax">h3EdgeLength</code>, <code class="syntax">h3IsValid</code> and <code class="syntax">h3kRing</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8034" rel="external nofollow noreferrer" target="_blank">#8034</a> (<a href="https://github.com/hombit" rel="external nofollow noreferrer" target="_blank">Konstantin Malanchev</a>)</li>
<li>Added support for brotli (<code class="syntax">br</code>) compression in file-related storages and table functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8156" rel="external nofollow noreferrer" target="_blank">#8156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8526" rel="external nofollow noreferrer" target="_blank">#8526</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add <code class="syntax">groupBit*</code> functions for the <code class="syntax">SimpleAggregationFunction</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8485" rel="external nofollow noreferrer" target="_blank">#8485</a> (<a href="https://github.com/YiuRULE" rel="external nofollow noreferrer" target="_blank">Guillaume Tassery</a>)</li>
</ul>
<h4 id="bug-fix_60">Bug Fix<a class="headerlink" href="#bug-fix_60" title="Permanent link"> </a></h4>
<ul>
<li>Fix rename of tables with <code class="syntax">Distributed</code> engine. Fixes issue <a href="https://github.com/ClickHouse/ClickHouse/issues/7868" rel="external nofollow noreferrer" target="_blank">#7868</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8306" rel="external nofollow noreferrer" target="_blank">#8306</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Now dictionaries support <code class="syntax">EXPRESSION</code> for attributes in arbitrary string in non-ClickHouse SQL dialect. <a href="https://github.com/ClickHouse/ClickHouse/pull/8098" rel="external nofollow noreferrer" target="_blank">#8098</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix broken <code class="syntax">INSERT SELECT FROM mysql(...)</code> query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8070" rel="external nofollow noreferrer" target="_blank">#8070</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/7960" rel="external nofollow noreferrer" target="_blank">#7960</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8234" rel="external nofollow noreferrer" target="_blank">#8234</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix error "Mismatch column sizes" when inserting default <code class="syntax">Tuple</code> from <code class="syntax">JSONEachRow</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5653" rel="external nofollow noreferrer" target="_blank">#5653</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8606" rel="external nofollow noreferrer" target="_blank">#8606</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Now an exception will be thrown in case of using <code class="syntax">WITH TIES</code> alongside <code class="syntax">LIMIT BY</code>. Also add ability to use <code class="syntax">TOP</code> with <code class="syntax">LIMIT BY</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7472" rel="external nofollow noreferrer" target="_blank">#7472</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7637" rel="external nofollow noreferrer" target="_blank">#7637</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Fix unintendent dependency from fresh glibc version in <code class="syntax">clickhouse-odbc-bridge</code> binary. <a href="https://github.com/ClickHouse/ClickHouse/pull/8046" rel="external nofollow noreferrer" target="_blank">#8046</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Fix bug in check function of <code class="syntax">*MergeTree</code> engines family. Now it does not fail in case when we have equal amount of rows in last granule and last mark (non-final). <a href="https://github.com/ClickHouse/ClickHouse/pull/8047" rel="external nofollow noreferrer" target="_blank">#8047</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix insert into <code class="syntax">Enum*</code> columns after <code class="syntax">ALTER</code> query, when underlying numeric type is equal to table specified type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7836" rel="external nofollow noreferrer" target="_blank">#7836</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7908" rel="external nofollow noreferrer" target="_blank">#7908</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Allowed non-constant negative "size" argument for function <code class="syntax">substring</code>. It was not allowed by mistake. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4832" rel="external nofollow noreferrer" target="_blank">#4832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7703" rel="external nofollow noreferrer" target="_blank">#7703</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix parsing bug when wrong number of arguments passed to <code class="syntax">(O|J)DBC</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/7709" rel="external nofollow noreferrer" target="_blank">#7709</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Using command name of the running clickhouse process when sending logs to syslog. In previous versions, empty string was used instead of command name. <a href="https://github.com/ClickHouse/ClickHouse/pull/8460" rel="external nofollow noreferrer" target="_blank">#8460</a> (<a href="https://github.com/mnach" rel="external nofollow noreferrer" target="_blank">Michael Nacharov</a>)</li>
<li>Fix check of allowed hosts for <code class="syntax">localhost</code>. This PR fixes the solution provided in <a href="https://github.com/ClickHouse/ClickHouse/pull/8241" rel="external nofollow noreferrer" target="_blank">#8241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8342" rel="external nofollow noreferrer" target="_blank">#8342</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fix rare crash in <code class="syntax">argMin</code> and <code class="syntax">argMax</code> functions for long string arguments, when result is used in <code class="syntax">runningAccumulate</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8325" rel="external nofollow noreferrer" target="_blank">#8325</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8341" rel="external nofollow noreferrer" target="_blank">#8341</a> (<a href="https://github.com/769344359" rel="external nofollow noreferrer" target="_blank">dinosaur</a>)</li>
<li>Fix memory overcommit for tables with <code class="syntax">Buffer</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/8345" rel="external nofollow noreferrer" target="_blank">#8345</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fixed potential bug in functions that can take <code class="syntax">NULL</code> as one of the arguments and return non-NULL. <a href="https://github.com/ClickHouse/ClickHouse/pull/8196" rel="external nofollow noreferrer" target="_blank">#8196</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Better metrics calculations in thread pool for background processes for <code class="syntax">MergeTree</code> table engines. <a href="https://github.com/ClickHouse/ClickHouse/pull/8194" rel="external nofollow noreferrer" target="_blank">#8194</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix function <code class="syntax">IN</code> inside <code class="syntax">WHERE</code> statement when row-level table filter is present. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6687" rel="external nofollow noreferrer" target="_blank">#6687</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8357" rel="external nofollow noreferrer" target="_blank">#8357</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Now an exception is thrown if the integral value is not parsed completely for settings values. <a href="https://github.com/ClickHouse/ClickHouse/pull/7678" rel="external nofollow noreferrer" target="_blank">#7678</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Fix exception when aggregate function is used in query to distributed table with more than two local shards. <a href="https://github.com/ClickHouse/ClickHouse/pull/8164" rel="external nofollow noreferrer" target="_blank">#8164</a> (<a href="https://github.com/nicelulu" rel="external nofollow noreferrer" target="_blank">小路</a>)</li>
<li>Now bloom filter can handle zero length arrays and does not perform redundant calculations. <a href="https://github.com/ClickHouse/ClickHouse/pull/8242" rel="external nofollow noreferrer" target="_blank">#8242</a> (<a href="https://github.com/achimbab" rel="external nofollow noreferrer" target="_blank">achimbab</a>)</li>
<li>Fixed checking if a client host is allowed by matching the client host to <code class="syntax">host_regexp</code> specified in <code class="syntax">users.xml</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8241" rel="external nofollow noreferrer" target="_blank">#8241</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Relax ambiguous column check that leads to false positives in multiple <code class="syntax">JOIN ON</code> section. <a href="https://github.com/ClickHouse/ClickHouse/pull/8385" rel="external nofollow noreferrer" target="_blank">#8385</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fixed possible server crash (<code class="syntax">std::terminate</code>) when the server cannot send or write data in <code class="syntax">JSON</code> or <code class="syntax">XML</code> format with values of <code class="syntax">String</code> data type (that require <code class="syntax">UTF-8</code> validation) or when compressing result data with Brotli algorithm or in some other rare cases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7603" rel="external nofollow noreferrer" target="_blank">#7603</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8384" rel="external nofollow noreferrer" target="_blank">#8384</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix race condition in <code class="syntax">StorageDistributedDirectoryMonitor</code> found by CI. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8364" rel="external nofollow noreferrer" target="_blank">#8364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8383" rel="external nofollow noreferrer" target="_blank">#8383</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Now background merges in <code class="syntax">*MergeTree</code> table engines family preserve storage policy volume order more accurately. <a href="https://github.com/ClickHouse/ClickHouse/pull/8549" rel="external nofollow noreferrer" target="_blank">#8549</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Now table engine <code class="syntax">Kafka</code> works properly with <code class="syntax">Native</code> format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6731" rel="external nofollow noreferrer" target="_blank">#6731</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/7337" rel="external nofollow noreferrer" target="_blank">#7337</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/8003" rel="external nofollow noreferrer" target="_blank">#8003</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8016" rel="external nofollow noreferrer" target="_blank">#8016</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fixed formats with headers (like <code class="syntax">CSVWithNames</code>) which were throwing exception about EOF for table engine <code class="syntax">Kafka</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8016" rel="external nofollow noreferrer" target="_blank">#8016</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Fixed a bug with making set from subquery in right part of <code class="syntax">IN</code> section. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5767" rel="external nofollow noreferrer" target="_blank">#5767</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/2542" rel="external nofollow noreferrer" target="_blank">#2542</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7755" rel="external nofollow noreferrer" target="_blank">#7755</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Fix possible crash while reading from storage <code class="syntax">File</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7756" rel="external nofollow noreferrer" target="_blank">#7756</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed reading of the files in <code class="syntax">Parquet</code> format containing columns of type <code class="syntax">list</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8334" rel="external nofollow noreferrer" target="_blank">#8334</a> (<a href="https://github.com/maxulan" rel="external nofollow noreferrer" target="_blank">maxulan</a>)</li>
<li>Fix error <code class="syntax">Not found column</code> for distributed queries with <code class="syntax">PREWHERE</code> condition dependent on sampling key if <code class="syntax">max_parallel_replicas &gt; 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7913" rel="external nofollow noreferrer" target="_blank">#7913</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix error <code class="syntax">Not found column</code> if query used <code class="syntax">PREWHERE</code> dependent on table's alias and the result set was empty because of primary key condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/7911" rel="external nofollow noreferrer" target="_blank">#7911</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed return type for functions <code class="syntax">rand</code> and <code class="syntax">randConstant</code> in case of <code class="syntax">Nullable</code> argument. Now functions always return <code class="syntax">UInt32</code> and never <code class="syntax">Nullable(UInt32)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8204" rel="external nofollow noreferrer" target="_blank">#8204</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Disabled predicate push-down for <code class="syntax">WITH FILL</code> expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7784" rel="external nofollow noreferrer" target="_blank">#7784</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7789" rel="external nofollow noreferrer" target="_blank">#7789</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Fixed incorrect <code class="syntax">count()</code> result for <code class="syntax">SummingMergeTree</code> when <code class="syntax">FINAL</code> section is used. <a href="https://github.com/ClickHouse/ClickHouse/issues/3280" rel="external nofollow noreferrer" target="_blank">#3280</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/7786" rel="external nofollow noreferrer" target="_blank">#7786</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Fix possible incorrect result for constant functions from remote servers. It happened for queries with functions like <code class="syntax">version()</code>, <code class="syntax">uptime()</code>, etc. which returns different constant values for different servers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7666" rel="external nofollow noreferrer" target="_blank">#7666</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7689" rel="external nofollow noreferrer" target="_blank">#7689</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix complicated bug in push-down predicate optimization which leads to wrong results. This fixes a lot of issues on push-down predicate optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/8503" rel="external nofollow noreferrer" target="_blank">#8503</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Fix crash in <code class="syntax">CREATE TABLE .. AS dictionary</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8508" rel="external nofollow noreferrer" target="_blank">#8508</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Several improvements ClickHouse grammar in <code class="syntax">.g4</code> file. <a href="https://github.com/ClickHouse/ClickHouse/pull/8294" rel="external nofollow noreferrer" target="_blank">#8294</a> (<a href="https://github.com/taiyang-li" rel="external nofollow noreferrer" target="_blank">taiyang-li</a>)</li>
<li>Fix bug that leads to crashes in <code class="syntax">JOIN</code>s with tables with engine <code class="syntax">Join</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7556" rel="external nofollow noreferrer" target="_blank">#7556</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/8254" rel="external nofollow noreferrer" target="_blank">#8254</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/7915" rel="external nofollow noreferrer" target="_blank">#7915</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/8100" rel="external nofollow noreferrer" target="_blank">#8100</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8298" rel="external nofollow noreferrer" target="_blank">#8298</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fix redundant dictionaries reload on <code class="syntax">CREATE DATABASE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7916" rel="external nofollow noreferrer" target="_blank">#7916</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Limit maximum number of streams for read from <code class="syntax">StorageFile</code> and <code class="syntax">StorageHDFS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7650" rel="external nofollow noreferrer" target="_blank">#7650</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7981" rel="external nofollow noreferrer" target="_blank">#7981</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix bug in <code class="syntax">ALTER ... MODIFY ... CODEC</code> query, when user specify both default expression and codec. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8593" rel="external nofollow noreferrer" target="_blank">8593</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8614" rel="external nofollow noreferrer" target="_blank">#8614</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix error in background merge of columns with <code class="syntax">SimpleAggregateFunction(LowCardinality)</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8613" rel="external nofollow noreferrer" target="_blank">#8613</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fixed type check in function <code class="syntax">toDateTime64</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8375" rel="external nofollow noreferrer" target="_blank">#8375</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Now server do not crash on <code class="syntax">LEFT</code> or <code class="syntax">FULL JOIN</code> with and Join engine and unsupported <code class="syntax">join_use_nulls</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/8479" rel="external nofollow noreferrer" target="_blank">#8479</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Now <code class="syntax">DROP DICTIONARY IF EXISTS db.dict</code> query does not throw exception if <code class="syntax">db</code> does not exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/8185" rel="external nofollow noreferrer" target="_blank">#8185</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Fix possible crashes in table functions (<code class="syntax">file</code>, <code class="syntax">mysql</code>, <code class="syntax">remote</code>) caused by usage of reference to removed <code class="syntax">IStorage</code> object. Fix incorrect parsing of columns specified at insertion into table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/7762" rel="external nofollow noreferrer" target="_blank">#7762</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Ensure network be up before starting <code class="syntax">clickhouse-server</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7507" rel="external nofollow noreferrer" target="_blank">#7507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8570" rel="external nofollow noreferrer" target="_blank">#8570</a> (<a href="https://github.com/yuzhichang" rel="external nofollow noreferrer" target="_blank">Zhichang Yu</a>)</li>
<li>Fix timeouts handling for secure connections, so queries does not hang indefenitely. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8126" rel="external nofollow noreferrer" target="_blank">#8126</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8128" rel="external nofollow noreferrer" target="_blank">#8128</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix <code class="syntax">clickhouse-copier</code>'s redundant contention between concurrent workers. <a href="https://github.com/ClickHouse/ClickHouse/pull/7816" rel="external nofollow noreferrer" target="_blank">#7816</a> (<a href="https://github.com/dingxiangfei2009" rel="external nofollow noreferrer" target="_blank">Ding Xiang Fei</a>)</li>
<li>Now mutations does not skip attached parts, even if their mutation version were larger than current mutation version. <a href="https://github.com/ClickHouse/ClickHouse/pull/7812" rel="external nofollow noreferrer" target="_blank">#7812</a> (<a href="https://github.com/yuzhichang" rel="external nofollow noreferrer" target="_blank">Zhichang Yu</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8250" rel="external nofollow noreferrer" target="_blank">#8250</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Ignore redundant copies of <code class="syntax">*MergeTree</code> data parts after move to another disk and server restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/7810" rel="external nofollow noreferrer" target="_blank">#7810</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix crash in <code class="syntax">FULL JOIN</code> with <code class="syntax">LowCardinality</code> in <code class="syntax">JOIN</code> key. <a href="https://github.com/ClickHouse/ClickHouse/pull/8252" rel="external nofollow noreferrer" target="_blank">#8252</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Forbidden to use column name more than once in insert query like <code class="syntax">INSERT INTO tbl (x, y, x)</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5465" rel="external nofollow noreferrer" target="_blank">#5465</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7681" rel="external nofollow noreferrer" target="_blank">#7681</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7685" rel="external nofollow noreferrer" target="_blank">#7685</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Added fallback for detection the number of physical CPU cores for unknown CPUs (using the number of logical CPU cores). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5239" rel="external nofollow noreferrer" target="_blank">#5239</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7726" rel="external nofollow noreferrer" target="_blank">#7726</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix <code class="syntax">There's no column</code> error for materialized and alias columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/8210" rel="external nofollow noreferrer" target="_blank">#8210</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fixed sever crash when <code class="syntax">EXISTS</code> query was used without <code class="syntax">TABLE</code> or <code class="syntax">DICTIONARY</code> qualifier. Just like <code class="syntax">EXISTS t</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8172" rel="external nofollow noreferrer" target="_blank">#8172</a>. This bug was introduced in version 19.17. <a href="https://github.com/ClickHouse/ClickHouse/pull/8213" rel="external nofollow noreferrer" target="_blank">#8213</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix rare bug with error <code class="syntax">"Sizes of columns does not match"</code> that might appear when using <code class="syntax">SimpleAggregateFunction</code> column. <a href="https://github.com/ClickHouse/ClickHouse/pull/7790" rel="external nofollow noreferrer" target="_blank">#7790</a> (<a href="https://github.com/bgranvea" rel="external nofollow noreferrer" target="_blank">Boris Granveaud</a>)</li>
<li>Fix bug where user with empty <code class="syntax">allow_databases</code> got access to all databases (and same for <code class="syntax">allow_dictionaries</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/7793" rel="external nofollow noreferrer" target="_blank">#7793</a> (<a href="https://github.com/DeifyTheGod" rel="external nofollow noreferrer" target="_blank">DeifyTheGod</a>)</li>
<li>Fix client crash when server already disconnected from client. <a href="https://github.com/ClickHouse/ClickHouse/pull/8071" rel="external nofollow noreferrer" target="_blank">#8071</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix <code class="syntax">ORDER BY</code> behaviour in case of sorting by primary key prefix and non primary key suffix. <a href="https://github.com/ClickHouse/ClickHouse/pull/7759" rel="external nofollow noreferrer" target="_blank">#7759</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Check if qualified column present in the table. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6836" rel="external nofollow noreferrer" target="_blank">#6836</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7758" rel="external nofollow noreferrer" target="_blank">#7758</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Fixed behavior with <code class="syntax">ALTER MOVE</code> ran immediately after merge finish moves superpart of specified. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8103" rel="external nofollow noreferrer" target="_blank">#8103</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8104" rel="external nofollow noreferrer" target="_blank">#8104</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix possible server crash while using <code class="syntax">UNION</code> with different number of columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7279" rel="external nofollow noreferrer" target="_blank">#7279</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7929" rel="external nofollow noreferrer" target="_blank">#7929</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix size of result substring for function <code class="syntax">substr</code> with negative size. <a href="https://github.com/ClickHouse/ClickHouse/pull/8589" rel="external nofollow noreferrer" target="_blank">#8589</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Now server does not execute part mutation in <code class="syntax">MergeTree</code> if there are not enough free threads in background pool.  <a href="https://github.com/ClickHouse/ClickHouse/pull/8588" rel="external nofollow noreferrer" target="_blank">#8588</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix a minor typo on formatting <code class="syntax">UNION ALL</code> AST. <a href="https://github.com/ClickHouse/ClickHouse/pull/7999" rel="external nofollow noreferrer" target="_blank">#7999</a> (<a href="https://github.com/litao91" rel="external nofollow noreferrer" target="_blank">litao91</a>)</li>
<li>Fixed incorrect bloom filter results for negative numbers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8317" rel="external nofollow noreferrer" target="_blank">#8317</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8566" rel="external nofollow noreferrer" target="_blank">#8566</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Fixed potential buffer overflow in decompress. Malicious user can pass fabricated compressed data that will cause read after buffer. This issue was found by Eldar Zaitov from Yandex information security team. <a href="https://github.com/ClickHouse/ClickHouse/pull/8404" rel="external nofollow noreferrer" target="_blank">#8404</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix incorrect result because of integers overflow in <code class="syntax">arrayIntersect</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7777" rel="external nofollow noreferrer" target="_blank">#7777</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Now <code class="syntax">OPTIMIZE TABLE</code> query will not wait for offline replicas to perform the operation. <a href="https://github.com/ClickHouse/ClickHouse/pull/8314" rel="external nofollow noreferrer" target="_blank">#8314</a> (<a href="https://github.com/javisantana" rel="external nofollow noreferrer" target="_blank">javi santana</a>)</li>
<li>Fixed <code class="syntax">ALTER TTL</code> parser for <code class="syntax">Replicated*MergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8318" rel="external nofollow noreferrer" target="_blank">#8318</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix communication between server and client, so server read temporary tables info after query failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/8084" rel="external nofollow noreferrer" target="_blank">#8084</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fix <code class="syntax">bitmapAnd</code> function error when intersecting an aggregated bitmap and a scalar bitmap. <a href="https://github.com/ClickHouse/ClickHouse/pull/8082" rel="external nofollow noreferrer" target="_blank">#8082</a> (<a href="https://github.com/moon03432" rel="external nofollow noreferrer" target="_blank">Yue Huang</a>)</li>
<li>Refine the definition of <code class="syntax">ZXid</code> according to the ZooKeeper Programmer's Guide which fixes bug in <code class="syntax">clickhouse-cluster-copier</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8088" rel="external nofollow noreferrer" target="_blank">#8088</a> (<a href="https://github.com/dingxiangfei2009" rel="external nofollow noreferrer" target="_blank">Ding Xiang Fei</a>)</li>
<li><code class="syntax">odbc</code> table function now respects <code class="syntax">external_table_functions_use_nulls</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/7506" rel="external nofollow noreferrer" target="_blank">#7506</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Fixed bug that lead to a rare data race. <a href="https://github.com/ClickHouse/ClickHouse/pull/8143" rel="external nofollow noreferrer" target="_blank">#8143</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Now <code class="syntax">SYSTEM RELOAD DICTIONARY</code> reloads a dictionary completely, ignoring <code class="syntax">update_field</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7440" rel="external nofollow noreferrer" target="_blank">#7440</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8037" rel="external nofollow noreferrer" target="_blank">#8037</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Add ability to check if dictionary exists in create query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8032" rel="external nofollow noreferrer" target="_blank">#8032</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix <code class="syntax">Float*</code> parsing in <code class="syntax">Values</code> format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7817" rel="external nofollow noreferrer" target="_blank">#7817</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7870" rel="external nofollow noreferrer" target="_blank">#7870</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fix crash when we cannot reserve space in some background operations of <code class="syntax">*MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/7873" rel="external nofollow noreferrer" target="_blank">#7873</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix crash of merge operation when table contains <code class="syntax">SimpleAggregateFunction(LowCardinality)</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8515" rel="external nofollow noreferrer" target="_blank">#8515</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8522" rel="external nofollow noreferrer" target="_blank">#8522</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Restore support of all ICU locales and add the ability to apply collations for constant expressions. Also add language name to <code class="syntax">system.collations</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8051" rel="external nofollow noreferrer" target="_blank">#8051</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix bug when external dictionaries with zero minimal lifetime (<code class="syntax">LIFETIME(MIN 0 MAX N)</code>, <code class="syntax">LIFETIME(N)</code>) don't update in background. <a href="https://github.com/ClickHouse/ClickHouse/pull/7983" rel="external nofollow noreferrer" target="_blank">#7983</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix crash when external dictionary with ClickHouse source has subquery in query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8351" rel="external nofollow noreferrer" target="_blank">#8351</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Fix incorrect parsing of file extension in table with engine <code class="syntax">URL</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8157" rel="external nofollow noreferrer" target="_blank">#8157</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8419" rel="external nofollow noreferrer" target="_blank">#8419</a> (<a href="https://github.com/apbodrov" rel="external nofollow noreferrer" target="_blank">Andrey Bodrov</a>)</li>
<li>Fix <code class="syntax">CHECK TABLE</code> query for <code class="syntax">*MergeTree</code> tables without key. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7543" rel="external nofollow noreferrer" target="_blank">#7543</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7979" rel="external nofollow noreferrer" target="_blank">#7979</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed conversion of <code class="syntax">Float64</code> to MySQL type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8079" rel="external nofollow noreferrer" target="_blank">#8079</a> (<a href="https://github.com/yurriy" rel="external nofollow noreferrer" target="_blank">Yuriy Baranov</a>)</li>
<li>Now if table was not completely dropped because of server crash, server will try to restore and load it. <a href="https://github.com/ClickHouse/ClickHouse/pull/8176" rel="external nofollow noreferrer" target="_blank">#8176</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
<li>Fixed crash in table function <code class="syntax">file</code> while inserting into file that does not exist. Now in this case file would be created and then insert would be processed. <a href="https://github.com/ClickHouse/ClickHouse/pull/8177" rel="external nofollow noreferrer" target="_blank">#8177</a> (<a href="https://github.com/stavrolia" rel="external nofollow noreferrer" target="_blank">Olga Khvostikova</a>)</li>
<li>Fix rare deadlock which can happen when <code class="syntax">trace_log</code> is in enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/7838" rel="external nofollow noreferrer" target="_blank">#7838</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Add ability to work with different types besides <code class="syntax">Date</code> in <code class="syntax">RangeHashed</code> external dictionary created from DDL query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7899" rel="external nofollow noreferrer" target="_blank">7899</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8275" rel="external nofollow noreferrer" target="_blank">#8275</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixes crash when <code class="syntax">now64()</code> is called with result of another function. <a href="https://github.com/ClickHouse/ClickHouse/pull/8270" rel="external nofollow noreferrer" target="_blank">#8270</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Fixed bug with detecting client IP for connections through mysql wire protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/7743" rel="external nofollow noreferrer" target="_blank">#7743</a> (<a href="https://github.com/dmitriy-myz" rel="external nofollow noreferrer" target="_blank">Dmitry Muzyka</a>)</li>
<li>Fix empty array handling in <code class="syntax">arraySplit</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7708" rel="external nofollow noreferrer" target="_blank">#7708</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7747" rel="external nofollow noreferrer" target="_blank">#7747</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Fixed the issue when <code class="syntax">pid-file</code> of another running <code class="syntax">clickhouse-server</code> may be deleted. <a href="https://github.com/ClickHouse/ClickHouse/pull/8487" rel="external nofollow noreferrer" target="_blank">#8487</a> (<a href="https://github.com/weiqxu" rel="external nofollow noreferrer" target="_blank">Weiqing Xu</a>)</li>
<li>Fix dictionary reload if it has <code class="syntax">invalidate_query</code>, which stopped updates and some exception on previous update tries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8029" rel="external nofollow noreferrer" target="_blank">#8029</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fixed error in function <code class="syntax">arrayReduce</code> that may lead to "double free" and error in aggregate function combinator <code class="syntax">Resample</code> that may lead to memory leak. Added aggregate function <code class="syntax">aggThrow</code>. This function can be used for testing purposes. <a href="https://github.com/ClickHouse/ClickHouse/pull/8446" rel="external nofollow noreferrer" target="_blank">#8446</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h4 id="improvement_22">Improvement<a class="headerlink" href="#improvement_22" title="Permanent link"> </a></h4>
<ul>
<li>Improved logging when working with <code class="syntax">S3</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/8251" rel="external nofollow noreferrer" target="_blank">#8251</a> (<a href="https://github.com/GrigoryPervakov" rel="external nofollow noreferrer" target="_blank">Grigory Pervakov</a>)</li>
<li>Printed help message when no arguments are passed when calling <code class="syntax">clickhouse-local</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5335" rel="external nofollow noreferrer" target="_blank">#5335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8230" rel="external nofollow noreferrer" target="_blank">#8230</a> (<a href="https://github.com/Melancholic" rel="external nofollow noreferrer" target="_blank">Andrey Nagorny</a>)</li>
<li>Add setting <code class="syntax">mutations_sync</code> which allows to wait <code class="syntax">ALTER UPDATE/DELETE</code> queries synchronously. <a href="https://github.com/ClickHouse/ClickHouse/pull/8237" rel="external nofollow noreferrer" target="_blank">#8237</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Allow to set up relative <code class="syntax">user_files_path</code> in <code class="syntax">config.xml</code> (in the way similar to <code class="syntax">format_schema_path</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/7632" rel="external nofollow noreferrer" target="_blank">#7632</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Add exception for illegal types for conversion functions with <code class="syntax">-OrZero</code> postfix. <a href="https://github.com/ClickHouse/ClickHouse/pull/7880" rel="external nofollow noreferrer" target="_blank">#7880</a> (<a href="https://github.com/akonyaev90" rel="external nofollow noreferrer" target="_blank">Andrey Konyaev</a>)</li>
<li>Simplify format of the header of data sending to a shard in a distributed query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8044" rel="external nofollow noreferrer" target="_blank">#8044</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li><code class="syntax">Live View</code> table engine refactoring. <a href="https://github.com/ClickHouse/ClickHouse/pull/8519" rel="external nofollow noreferrer" target="_blank">#8519</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>)</li>
<li>Add additional checks for external dictionaries created from DDL-queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8127" rel="external nofollow noreferrer" target="_blank">#8127</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Fix error <code class="syntax">Column ... already exists</code> while using <code class="syntax">FINAL</code> and <code class="syntax">SAMPLE</code> together, e.g. <code class="syntax">select count() from table final sample 1/2</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5186" rel="external nofollow noreferrer" target="_blank">#5186</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7907" rel="external nofollow noreferrer" target="_blank">#7907</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Now table the first argument of <code class="syntax">joinGet</code> function can be table identifier. <a href="https://github.com/ClickHouse/ClickHouse/pull/7707" rel="external nofollow noreferrer" target="_blank">#7707</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Allow using <code class="syntax">MaterializedView</code> with subqueries above <code class="syntax">Kafka</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8197" rel="external nofollow noreferrer" target="_blank">#8197</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Now background moves between disks run it the seprate thread pool. <a href="https://github.com/ClickHouse/ClickHouse/pull/7670" rel="external nofollow noreferrer" target="_blank">#7670</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li><code class="syntax">SYSTEM RELOAD DICTIONARY</code> now executes synchronously. <a href="https://github.com/ClickHouse/ClickHouse/pull/8240" rel="external nofollow noreferrer" target="_blank">#8240</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Stack traces now display physical addresses (offsets in object file) instead of virtual memory addresses (where the object file was loaded). That allows the use of <code class="syntax">addr2line</code> when binary is position independent and ASLR is active. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8360" rel="external nofollow noreferrer" target="_blank">#8360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8387" rel="external nofollow noreferrer" target="_blank">#8387</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Support new syntax for row-level security filters: <code class="syntax">&lt;table name='table_name'&gt;…&lt;/table&gt;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" rel="external nofollow noreferrer" target="_blank">#5779</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8381" rel="external nofollow noreferrer" target="_blank">#8381</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Now <code class="syntax">cityHash</code> function can work with <code class="syntax">Decimal</code> and <code class="syntax">UUID</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5184" rel="external nofollow noreferrer" target="_blank">#5184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7693" rel="external nofollow noreferrer" target="_blank">#7693</a> (<a href="https://github.com/millb" rel="external nofollow noreferrer" target="_blank">Mikhail Korotov</a>)</li>
<li>Removed fixed index granularity (it was 1024) from system logs because it's obsolete after implementation of adaptive granularity. <a href="https://github.com/ClickHouse/ClickHouse/pull/7698" rel="external nofollow noreferrer" target="_blank">#7698</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Enabled MySQL compatibility server when ClickHouse is compiled without SSL. <a href="https://github.com/ClickHouse/ClickHouse/pull/7852" rel="external nofollow noreferrer" target="_blank">#7852</a> (<a href="https://github.com/yurriy" rel="external nofollow noreferrer" target="_blank">Yuriy Baranov</a>)</li>
<li>Now server checksums distributed batches, which gives more verbose errors in case of corrupted data in batch. <a href="https://github.com/ClickHouse/ClickHouse/pull/7914" rel="external nofollow noreferrer" target="_blank">#7914</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Support <code class="syntax">DROP DATABASE</code>, <code class="syntax">DETACH TABLE</code>, <code class="syntax">DROP TABLE</code> and <code class="syntax">ATTACH TABLE</code> for <code class="syntax">MySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/8202" rel="external nofollow noreferrer" target="_blank">#8202</a> (<a href="https://github.com/zhang2014" rel="external nofollow noreferrer" target="_blank">Winter Zhang</a>)</li>
<li>Add authentication in S3 table function and table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/7623" rel="external nofollow noreferrer" target="_blank">#7623</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Added check for extra parts of <code class="syntax">MergeTree</code> at different disks, in order to not allow to miss data parts at undefined disks. <a href="https://github.com/ClickHouse/ClickHouse/pull/8118" rel="external nofollow noreferrer" target="_blank">#8118</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Enable SSL support for Mac client and server. <a href="https://github.com/ClickHouse/ClickHouse/pull/8297" rel="external nofollow noreferrer" target="_blank">#8297</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Now ClickHouse can work as MySQL federated server (see <a href="https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html" target="_blank">https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/7717" rel="external nofollow noreferrer" target="_blank">#7717</a> (<a href="https://github.com/MaxFedotov" rel="external nofollow noreferrer" target="_blank">Maxim Fedotov</a>)</li>
<li><code class="syntax">clickhouse-client</code> now only enable <code class="syntax">bracketed-paste</code> when multiquery is on and multiline is off. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7757" rel="external nofollow noreferrer" target="_blank">#7757</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7761" rel="external nofollow noreferrer" target="_blank">#7761</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Support <code class="syntax">Array(Decimal)</code> in <code class="syntax">if</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/7721" rel="external nofollow noreferrer" target="_blank">#7721</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Support Decimals in <code class="syntax">arrayDifference</code>, <code class="syntax">arrayCumSum</code> and <code class="syntax">arrayCumSumNegative</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/7724" rel="external nofollow noreferrer" target="_blank">#7724</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Added <code class="syntax">lifetime</code> column to <code class="syntax">system.dictionaries</code> table. <a href="https://github.com/ClickHouse/ClickHouse/issues/6820" rel="external nofollow noreferrer" target="_blank">#6820</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/7727" rel="external nofollow noreferrer" target="_blank">#7727</a> (<a href="https://github.com/kekekekule" rel="external nofollow noreferrer" target="_blank">kekekekule</a>)</li>
<li>Improved check for existing parts on different disks for <code class="syntax">*MergeTree</code> table engines. Addresses <a href="https://github.com/ClickHouse/ClickHouse/issues/7660" rel="external nofollow noreferrer" target="_blank">#7660</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8440" rel="external nofollow noreferrer" target="_blank">#8440</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Integration with <code class="syntax">AWS SDK</code> for <code class="syntax">S3</code> interactions which allows to use all S3 features out of the box. <a href="https://github.com/ClickHouse/ClickHouse/pull/8011" rel="external nofollow noreferrer" target="_blank">#8011</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Added support for subqueries in <code class="syntax">Live View</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/7792" rel="external nofollow noreferrer" target="_blank">#7792</a> (<a href="https://github.com/vzakaznikov" rel="external nofollow noreferrer" target="_blank">vzakaznikov</a>)</li>
<li>Check for using <code class="syntax">Date</code> or <code class="syntax">DateTime</code> column from <code class="syntax">TTL</code> expressions was removed. <a href="https://github.com/ClickHouse/ClickHouse/pull/7920" rel="external nofollow noreferrer" target="_blank">#7920</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Information about disk was added to <code class="syntax">system.detached_parts</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/7833" rel="external nofollow noreferrer" target="_blank">#7833</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Now settings <code class="syntax">max_(table|partition)_size_to_drop</code> can be changed without a restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/7779" rel="external nofollow noreferrer" target="_blank">#7779</a> (<a href="https://github.com/GrigoryPervakov" rel="external nofollow noreferrer" target="_blank">Grigory Pervakov</a>)</li>
<li>Slightly better usability of error messages. Ask user not to remove the lines below <code class="syntax">Stack trace:</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7897" rel="external nofollow noreferrer" target="_blank">#7897</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Better reading messages from <code class="syntax">Kafka</code> engine in various formats after <a href="https://github.com/ClickHouse/ClickHouse/issues/7935" rel="external nofollow noreferrer" target="_blank">#7935</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8035" rel="external nofollow noreferrer" target="_blank">#8035</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Better compatibility with MySQL clients which don't support <code class="syntax">sha2_password</code> auth plugin. <a href="https://github.com/ClickHouse/ClickHouse/pull/8036" rel="external nofollow noreferrer" target="_blank">#8036</a> (<a href="https://github.com/yurriy" rel="external nofollow noreferrer" target="_blank">Yuriy Baranov</a>)</li>
<li>Support more column types in MySQL compatibility server. <a href="https://github.com/ClickHouse/ClickHouse/pull/7975" rel="external nofollow noreferrer" target="_blank">#7975</a> (<a href="https://github.com/yurriy" rel="external nofollow noreferrer" target="_blank">Yuriy Baranov</a>)</li>
<li>Implement <code class="syntax">ORDER BY</code> optimization for <code class="syntax">Merge</code>, <code class="syntax">Buffer</code> and <code class="syntax">Materilized View</code> storages with underlying <code class="syntax">MergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8130" rel="external nofollow noreferrer" target="_blank">#8130</a> (<a href="https://github.com/CurtizJ" rel="external nofollow noreferrer" target="_blank">Anton Popov</a>)</li>
<li>Now we always use POSIX implementation of <code class="syntax">getrandom</code> to have better compatibility with old kernels (&lt; 3.17). <a href="https://github.com/ClickHouse/ClickHouse/pull/7940" rel="external nofollow noreferrer" target="_blank">#7940</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Better check for valid destination in a move TTL rule. <a href="https://github.com/ClickHouse/ClickHouse/pull/8410" rel="external nofollow noreferrer" target="_blank">#8410</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Better checks for broken insert batches for <code class="syntax">Distributed</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/7933" rel="external nofollow noreferrer" target="_blank">#7933</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Add column with array of parts name which mutations must process in future to <code class="syntax">system.mutations</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8179" rel="external nofollow noreferrer" target="_blank">#8179</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Parallel merge sort optimization for processors. <a href="https://github.com/ClickHouse/ClickHouse/pull/8552" rel="external nofollow noreferrer" target="_blank">#8552</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>The settings <code class="syntax">mark_cache_min_lifetime</code> is now obsolete and does nothing. In previous versions, mark cache can grow in memory larger than <code class="syntax">mark_cache_size</code> to accomodate data within <code class="syntax">mark_cache_min_lifetime</code> seconds. That was leading to confusion and higher memory usage than expected, that is especially bad on memory constrained systems. If you will see performance degradation after installing this release, you should increase the <code class="syntax">mark_cache_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8484" rel="external nofollow noreferrer" target="_blank">#8484</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Preparation to use <code class="syntax">tid</code> everywhere. This is needed for <a href="https://github.com/ClickHouse/ClickHouse/issues/7477" rel="external nofollow noreferrer" target="_blank">#7477</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8276" rel="external nofollow noreferrer" target="_blank">#8276</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h4 id="performance-improvement_17">Performance Improvement<a class="headerlink" href="#performance-improvement_17" title="Permanent link"> </a></h4>
<ul>
<li>Performance optimizations in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/7988" rel="external nofollow noreferrer" target="_blank">#7988</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Non-blocking updates of expired keys in cache dictionaries (with permission to read old ones). <a href="https://github.com/ClickHouse/ClickHouse/pull/8303" rel="external nofollow noreferrer" target="_blank">#8303</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Compile ClickHouse without <code class="syntax">-fno-omit-frame-pointer</code> globally to spare one more register. <a href="https://github.com/ClickHouse/ClickHouse/pull/8097" rel="external nofollow noreferrer" target="_blank">#8097</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Speedup <code class="syntax">greatCircleDistance</code> function and add performance tests for it. <a href="https://github.com/ClickHouse/ClickHouse/pull/7307" rel="external nofollow noreferrer" target="_blank">#7307</a> (<a href="https://github.com/stavrolia" rel="external nofollow noreferrer" target="_blank">Olga Khvostikova</a>)</li>
<li>Improved performance of function <code class="syntax">roundDown</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8465" rel="external nofollow noreferrer" target="_blank">#8465</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Improved performance of <code class="syntax">max</code>, <code class="syntax">min</code>, <code class="syntax">argMin</code>, <code class="syntax">argMax</code> for <code class="syntax">DateTime64</code> data type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8199" rel="external nofollow noreferrer" target="_blank">#8199</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Improved performance of sorting without a limit or with big limit and external sorting. <a href="https://github.com/ClickHouse/ClickHouse/pull/8545" rel="external nofollow noreferrer" target="_blank">#8545</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Improved performance of formatting floating point numbers up to 6 times. <a href="https://github.com/ClickHouse/ClickHouse/pull/8542" rel="external nofollow noreferrer" target="_blank">#8542</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Improved performance of <code class="syntax">modulo</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/7750" rel="external nofollow noreferrer" target="_blank">#7750</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Optimized <code class="syntax">ORDER BY</code> and merging with single column key. <a href="https://github.com/ClickHouse/ClickHouse/pull/8335" rel="external nofollow noreferrer" target="_blank">#8335</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Better implementation for <code class="syntax">arrayReduce</code>, <code class="syntax">-Array</code> and <code class="syntax">-State</code> combinators.  <a href="https://github.com/ClickHouse/ClickHouse/pull/7710" rel="external nofollow noreferrer" target="_blank">#7710</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Now <code class="syntax">PREWHERE</code> should be optimized to be at least as efficient as <code class="syntax">WHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7769" rel="external nofollow noreferrer" target="_blank">#7769</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Improve the way <code class="syntax">round</code> and <code class="syntax">roundBankers</code> handling negative numbers. <a href="https://github.com/ClickHouse/ClickHouse/pull/8229" rel="external nofollow noreferrer" target="_blank">#8229</a> (<a href="https://github.com/hczhcz" rel="external nofollow noreferrer" target="_blank">hcz</a>)</li>
<li>Improved decoding performance of <code class="syntax">DoubleDelta</code> and <code class="syntax">Gorilla</code> codecs by roughly 30-40%. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7082" rel="external nofollow noreferrer" target="_blank">#7082</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8019" rel="external nofollow noreferrer" target="_blank">#8019</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Improved performance of <code class="syntax">base64</code> related functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/8444" rel="external nofollow noreferrer" target="_blank">#8444</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Added a function <code class="syntax">geoDistance</code>. It is similar to <code class="syntax">greatCircleDistance</code> but uses approximation to WGS-84 ellipsoid model. The performance of both functions are near the same. <a href="https://github.com/ClickHouse/ClickHouse/pull/8086" rel="external nofollow noreferrer" target="_blank">#8086</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Faster <code class="syntax">min</code> and <code class="syntax">max</code> aggregation functions for <code class="syntax">Decimal</code> data type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8144" rel="external nofollow noreferrer" target="_blank">#8144</a> (<a href="https://github.com/4ertus2" rel="external nofollow noreferrer" target="_blank">Artem Zuikov</a>)</li>
<li>Vectorize processing <code class="syntax">arrayReduce</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7608" rel="external nofollow noreferrer" target="_blank">#7608</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li><code class="syntax">if</code> chains are now optimized as <code class="syntax">multiIf</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8355" rel="external nofollow noreferrer" target="_blank">#8355</a> (<a href="https://github.com/kamalov-ruslan" rel="external nofollow noreferrer" target="_blank">kamalov-ruslan</a>)</li>
<li>Fix performance regression of <code class="syntax">Kafka</code> table engine introduced in 19.15. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7261" rel="external nofollow noreferrer" target="_blank">#7261</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7935" rel="external nofollow noreferrer" target="_blank">#7935</a> (<a href="https://github.com/filimonov" rel="external nofollow noreferrer" target="_blank">filimonov</a>)</li>
<li>Removed "pie" code generation that <code class="syntax">gcc</code> from Debian packages occasionally brings by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/8483" rel="external nofollow noreferrer" target="_blank">#8483</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Parallel parsing data formats <a href="https://github.com/ClickHouse/ClickHouse/pull/6553" rel="external nofollow noreferrer" target="_blank">#6553</a> (<a href="https://github.com/nikitamikhaylov" rel="external nofollow noreferrer" target="_blank">Nikita Mikhaylov</a>)</li>
<li>Enable optimized parser of <code class="syntax">Values</code> with expressions by default (<code class="syntax">input_format_values_deduce_templates_of_expressions=1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8231" rel="external nofollow noreferrer" target="_blank">#8231</a> (<a href="https://github.com/tavplubix" rel="external nofollow noreferrer" target="_blank">tavplubix</a>)</li>
</ul>
<h4 id="build-testing-packaging-improvement_25">Build/Testing/Packaging Improvement<a class="headerlink" href="#build-testing-packaging-improvement_25" title="Permanent link"> </a></h4>
<ul>
<li>Build fixes for <code class="syntax">ARM</code> and in minimal mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/8304" rel="external nofollow noreferrer" target="_blank">#8304</a> (<a href="https://github.com/proller" rel="external nofollow noreferrer" target="_blank">proller</a>)</li>
<li>Add coverage file flush for <code class="syntax">clickhouse-server</code> when std::atexit is not called. Also slightly improved logging in stateless tests with coverage. <a href="https://github.com/ClickHouse/ClickHouse/pull/8267" rel="external nofollow noreferrer" target="_blank">#8267</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Update LLVM library in contrib. Avoid using LLVM from OS packages. <a href="https://github.com/ClickHouse/ClickHouse/pull/8258" rel="external nofollow noreferrer" target="_blank">#8258</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Make bundled <code class="syntax">curl</code> build fully quiet. <a href="https://github.com/ClickHouse/ClickHouse/pull/8232" rel="external nofollow noreferrer" target="_blank">#8232</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8203" rel="external nofollow noreferrer" target="_blank">#8203</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Fix some <code class="syntax">MemorySanitizer</code> warnings. <a href="https://github.com/ClickHouse/ClickHouse/pull/8235" rel="external nofollow noreferrer" target="_blank">#8235</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Use <code class="syntax">add_warning</code> and <code class="syntax">no_warning</code> macros in <code class="syntax">CMakeLists.txt</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8604" rel="external nofollow noreferrer" target="_blank">#8604</a> (<a href="https://github.com/abyss7" rel="external nofollow noreferrer" target="_blank">Ivan</a>)</li>
<li>Add support of Minio S3 Compatible object (<a href="https://min.io/" target="_blank">https://min.io/</a>) for better integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/7863" rel="external nofollow noreferrer" target="_blank">#7863</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/7875" rel="external nofollow noreferrer" target="_blank">#7875</a> (<a href="https://github.com/Jokser" rel="external nofollow noreferrer" target="_blank">Pavel Kovalenko</a>)</li>
<li>Imported <code class="syntax">libc</code> headers to contrib. It allows to make builds more consistent across various systems (only for <code class="syntax">x86_64-linux-gnu</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/5773" rel="external nofollow noreferrer" target="_blank">#5773</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Remove <code class="syntax">-fPIC</code> from some libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8464" rel="external nofollow noreferrer" target="_blank">#8464</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Clean <code class="syntax">CMakeLists.txt</code> for curl. See <a href="https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910" target="_blank">https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8459" rel="external nofollow noreferrer" target="_blank">#8459</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Silent warnings in <code class="syntax">CapNProto</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/8220" rel="external nofollow noreferrer" target="_blank">#8220</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Add performance tests for short string optimized hash tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/7679" rel="external nofollow noreferrer" target="_blank">#7679</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Now ClickHouse will build on <code class="syntax">AArch64</code> even if <code class="syntax">MADV_FREE</code> is not available. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8027" rel="external nofollow noreferrer" target="_blank">#8027</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8243" rel="external nofollow noreferrer" target="_blank">#8243</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Update <code class="syntax">zlib-ng</code> to fix memory sanitizer problems. <a href="https://github.com/ClickHouse/ClickHouse/pull/7182" rel="external nofollow noreferrer" target="_blank">#7182</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8206" rel="external nofollow noreferrer" target="_blank">#8206</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Enable internal MySQL library on non-Linux system, because usage of OS packages is very fragile and usually does not work at all. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5765" rel="external nofollow noreferrer" target="_blank">#5765</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8426" rel="external nofollow noreferrer" target="_blank">#8426</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed build on some systems after enabling <code class="syntax">libc++</code>. This supersedes <a href="https://github.com/ClickHouse/ClickHouse/issues/8374" rel="external nofollow noreferrer" target="_blank">#8374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8380" rel="external nofollow noreferrer" target="_blank">#8380</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Make <code class="syntax">Field</code> methods more type-safe to find more errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/7386" rel="external nofollow noreferrer" target="_blank">#7386</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8209" rel="external nofollow noreferrer" target="_blank">#8209</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Added missing files to the <code class="syntax">libc-headers</code> submodule. <a href="https://github.com/ClickHouse/ClickHouse/pull/8507" rel="external nofollow noreferrer" target="_blank">#8507</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix wrong <code class="syntax">JSON</code> quoting in performance test output. <a href="https://github.com/ClickHouse/ClickHouse/pull/8497" rel="external nofollow noreferrer" target="_blank">#8497</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Now stack trace is displayed for <code class="syntax">std::exception</code> and <code class="syntax">Poco::Exception</code>. In previous versions it was available only for <code class="syntax">DB::Exception</code>. This improves diagnostics. <a href="https://github.com/ClickHouse/ClickHouse/pull/8501" rel="external nofollow noreferrer" target="_blank">#8501</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Porting <code class="syntax">clock_gettime</code> and <code class="syntax">clock_nanosleep</code> for fresh glibc versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/8054" rel="external nofollow noreferrer" target="_blank">#8054</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Enable <code class="syntax">part_log</code> in example config for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/8609" rel="external nofollow noreferrer" target="_blank">#8609</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix async nature of reload in <code class="syntax">01036_no_superfluous_dict_reload_on_create_database*</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8111" rel="external nofollow noreferrer" target="_blank">#8111</a> (<a href="https://github.com/azat" rel="external nofollow noreferrer" target="_blank">Azat Khuzhin</a>)</li>
<li>Fixed codec performance tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/8615" rel="external nofollow noreferrer" target="_blank">#8615</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>Add install scripts for <code class="syntax">.tgz</code> build and documentation for them. <a href="https://github.com/ClickHouse/ClickHouse/pull/8612" rel="external nofollow noreferrer" target="_blank">#8612</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8591" rel="external nofollow noreferrer" target="_blank">#8591</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Removed old <code class="syntax">ZSTD</code> test (it was created in year 2016 to reproduce the bug that pre 1.0 version of ZSTD has had). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8618" rel="external nofollow noreferrer" target="_blank">#8618</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8619" rel="external nofollow noreferrer" target="_blank">#8619</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed build on Mac OS Catalina. <a href="https://github.com/ClickHouse/ClickHouse/pull/8600" rel="external nofollow noreferrer" target="_blank">#8600</a> (<a href="https://github.com/meob" rel="external nofollow noreferrer" target="_blank">meo</a>)</li>
<li>Increased number of rows in codec performance tests to make results noticeable. <a href="https://github.com/ClickHouse/ClickHouse/pull/8574" rel="external nofollow noreferrer" target="_blank">#8574</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li>In debug builds, treat <code class="syntax">LOGICAL_ERROR</code> exceptions as assertion failures, so that they are easier to notice. <a href="https://github.com/ClickHouse/ClickHouse/pull/8475" rel="external nofollow noreferrer" target="_blank">#8475</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Make formats-related performance test more deterministic. <a href="https://github.com/ClickHouse/ClickHouse/pull/8477" rel="external nofollow noreferrer" target="_blank">#8477</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Update <code class="syntax">lz4</code> to fix a MemorySanitizer failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/8181" rel="external nofollow noreferrer" target="_blank">#8181</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Suppress a known MemorySanitizer false positive in exception handling. <a href="https://github.com/ClickHouse/ClickHouse/pull/8182" rel="external nofollow noreferrer" target="_blank">#8182</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Update <code class="syntax">gcc</code> and <code class="syntax">g++</code> to version 9 in <code class="syntax">build/docker/build.sh</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/7766" rel="external nofollow noreferrer" target="_blank">#7766</a> (<a href="https://github.com/tlightsky" rel="external nofollow noreferrer" target="_blank">TLightSky</a>)</li>
<li>Add performance test case to test that <code class="syntax">PREWHERE</code> is worse than <code class="syntax">WHERE</code>.  <a href="https://github.com/ClickHouse/ClickHouse/pull/7768" rel="external nofollow noreferrer" target="_blank">#7768</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Progress towards fixing one flacky test. <a href="https://github.com/ClickHouse/ClickHouse/pull/8621" rel="external nofollow noreferrer" target="_blank">#8621</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Avoid MemorySanitizer report for data from <code class="syntax">libunwind</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8539" rel="external nofollow noreferrer" target="_blank">#8539</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Updated <code class="syntax">libc++</code> to the latest version. <a href="https://github.com/ClickHouse/ClickHouse/pull/8324" rel="external nofollow noreferrer" target="_blank">#8324</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Build ICU library from sources. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6460" rel="external nofollow noreferrer" target="_blank">#6460</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8219" rel="external nofollow noreferrer" target="_blank">#8219</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Switched from <code class="syntax">libressl</code> to <code class="syntax">openssl</code>. ClickHouse should support TLS 1.3 and SNI after this change. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8171" rel="external nofollow noreferrer" target="_blank">#8171</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8218" rel="external nofollow noreferrer" target="_blank">#8218</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fixed UBSan report when using <code class="syntax">chacha20_poly1305</code> from SSL (happens on connect to <a href="https://yandex.ru/" target="_blank">https://yandex.ru/</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8214" rel="external nofollow noreferrer" target="_blank">#8214</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix mode of default password file for <code class="syntax">.deb</code> linux distros. <a href="https://github.com/ClickHouse/ClickHouse/pull/8075" rel="external nofollow noreferrer" target="_blank">#8075</a> (<a href="https://github.com/proller" rel="external nofollow noreferrer" target="_blank">proller</a>)</li>
<li>Improved expression for getting <code class="syntax">clickhouse-server</code> PID in <code class="syntax">clickhouse-test</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8063" rel="external nofollow noreferrer" target="_blank">#8063</a> (<a href="https://github.com/Akazz" rel="external nofollow noreferrer" target="_blank">Alexander Kazakov</a>)</li>
<li>Updated contrib/googletest to v1.10.0. <a href="https://github.com/ClickHouse/ClickHouse/pull/8587" rel="external nofollow noreferrer" target="_blank">#8587</a> (<a href="https://github.com/Alex-Burmak" rel="external nofollow noreferrer" target="_blank">Alexander Burmak</a>)</li>
<li>Fixed ThreadSaninitizer report in <code class="syntax">base64</code> library. Also updated this library to the latest version, but it does not matter. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8397" rel="external nofollow noreferrer" target="_blank">#8397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8403" rel="external nofollow noreferrer" target="_blank">#8403</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Fix <code class="syntax">00600_replace_running_query</code> for processors. <a href="https://github.com/ClickHouse/ClickHouse/pull/8272" rel="external nofollow noreferrer" target="_blank">#8272</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Remove support for <code class="syntax">tcmalloc</code> to make <code class="syntax">CMakeLists.txt</code> simpler. <a href="https://github.com/ClickHouse/ClickHouse/pull/8310" rel="external nofollow noreferrer" target="_blank">#8310</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Release gcc builds now use <code class="syntax">libc++</code> instead of <code class="syntax">libstdc++</code>. Recently <code class="syntax">libc++</code> was used only with clang. This will improve consistency of build configurations and portability. <a href="https://github.com/ClickHouse/ClickHouse/pull/8311" rel="external nofollow noreferrer" target="_blank">#8311</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Enable ICU library for build with MemorySanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/8222" rel="external nofollow noreferrer" target="_blank">#8222</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Suppress warnings from <code class="syntax">CapNProto</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/8224" rel="external nofollow noreferrer" target="_blank">#8224</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Removed special cases of code for <code class="syntax">tcmalloc</code>, because it's no longer supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/8225" rel="external nofollow noreferrer" target="_blank">#8225</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>In CI coverage task, kill the server gracefully to allow it to save the coverage report. This fixes incomplete coverage reports we've been seeing lately. <a href="https://github.com/ClickHouse/ClickHouse/pull/8142" rel="external nofollow noreferrer" target="_blank">#8142</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Performance tests for all codecs against <code class="syntax">Float64</code> and <code class="syntax">UInt64</code> values. <a href="https://github.com/ClickHouse/ClickHouse/pull/8349" rel="external nofollow noreferrer" target="_blank">#8349</a> (<a href="https://github.com/Enmk" rel="external nofollow noreferrer" target="_blank">Vasily Nemkov</a>)</li>
<li><code class="syntax">termcap</code> is very much deprecated and lead to various problems (f.g. missing "up" cap and echoing <code class="syntax">^J</code> instead of multi line) . Favor <code class="syntax">terminfo</code> or bundled <code class="syntax">ncurses</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7737" rel="external nofollow noreferrer" target="_blank">#7737</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Fix <code class="syntax">test_storage_s3</code> integration test. <a href="https://github.com/ClickHouse/ClickHouse/pull/7734" rel="external nofollow noreferrer" target="_blank">#7734</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Support <code class="syntax">StorageFile(&lt;format&gt;, null)</code> to insert block into given format file without actually write to disk. This is required for performance tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/8455" rel="external nofollow noreferrer" target="_blank">#8455</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
<li>Added argument <code class="syntax">--print-time</code> to functional tests which prints execution time per test. <a href="https://github.com/ClickHouse/ClickHouse/pull/8001" rel="external nofollow noreferrer" target="_blank">#8001</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Added asserts to <code class="syntax">KeyCondition</code> while evaluating RPN. This will fix warning from gcc-9. <a href="https://github.com/ClickHouse/ClickHouse/pull/8279" rel="external nofollow noreferrer" target="_blank">#8279</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Dump cmake options in CI builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/8273" rel="external nofollow noreferrer" target="_blank">#8273</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Don't generate debug info for some fat libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8271" rel="external nofollow noreferrer" target="_blank">#8271</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Make <code class="syntax">log_to_console.xml</code> always log to stderr, regardless of is it interactive or not. <a href="https://github.com/ClickHouse/ClickHouse/pull/8395" rel="external nofollow noreferrer" target="_blank">#8395</a> (<a href="https://github.com/akuzm" rel="external nofollow noreferrer" target="_blank">Alexander Kuzmenkov</a>)</li>
<li>Removed some unused features from <code class="syntax">clickhouse-performance-test</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/8555" rel="external nofollow noreferrer" target="_blank">#8555</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Now we will also search for <code class="syntax">lld-X</code> with corresponding <code class="syntax">clang-X</code> version. <a href="https://github.com/ClickHouse/ClickHouse/pull/8092" rel="external nofollow noreferrer" target="_blank">#8092</a> (<a href="https://github.com/alesapin" rel="external nofollow noreferrer" target="_blank">alesapin</a>)</li>
<li>Parquet build improvement. <a href="https://github.com/ClickHouse/ClickHouse/pull/8421" rel="external nofollow noreferrer" target="_blank">#8421</a> (<a href="https://github.com/maxulan" rel="external nofollow noreferrer" target="_blank">maxulan</a>)</li>
<li>More GCC warnings <a href="https://github.com/ClickHouse/ClickHouse/pull/8221" rel="external nofollow noreferrer" target="_blank">#8221</a> (<a href="https://github.com/kreuzerkrieg" rel="external nofollow noreferrer" target="_blank">kreuzerkrieg</a>)</li>
<li>Package for Arch Linux now allows to run ClickHouse server, and not only client. <a href="https://github.com/ClickHouse/ClickHouse/pull/8534" rel="external nofollow noreferrer" target="_blank">#8534</a> (<a href="https://github.com/excitoon" rel="external nofollow noreferrer" target="_blank">Vladimir Chebotarev</a>)</li>
<li>Fix test with processors. Tiny performance fixes. <a href="https://github.com/ClickHouse/ClickHouse/pull/7672" rel="external nofollow noreferrer" target="_blank">#7672</a> (<a href="https://github.com/KochetovNicolai" rel="external nofollow noreferrer" target="_blank">Nikolai Kochetov</a>)</li>
<li>Update contrib/protobuf. <a href="https://github.com/ClickHouse/ClickHouse/pull/8256" rel="external nofollow noreferrer" target="_blank">#8256</a> (<a href="https://github.com/matwey" rel="external nofollow noreferrer" target="_blank">Matwey V. Kornilov</a>)</li>
<li>In preparation of switching to c++20 as a new year celebration. "May the C++ force be with ClickHouse." <a href="https://github.com/ClickHouse/ClickHouse/pull/8447" rel="external nofollow noreferrer" target="_blank">#8447</a> (<a href="https://github.com/amosbird" rel="external nofollow noreferrer" target="_blank">Amos Bird</a>)</li>
</ul>
<h4 id="experimental-feature_8">Experimental Feature<a class="headerlink" href="#experimental-feature_8" title="Permanent link"> </a></h4>
<ul>
<li>Added experimental setting <code class="syntax">min_bytes_to_use_mmap_io</code>. It allows to read big files without copying data from kernel to userspace. The setting is disabled by default. Recommended threshold is about 64 MB, because mmap/munmap is slow. <a href="https://github.com/ClickHouse/ClickHouse/pull/8520" rel="external nofollow noreferrer" target="_blank">#8520</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
<li>Reworked quotas as a part of access control system. Added new table <code class="syntax">system.quotas</code>, new functions <code class="syntax">currentQuota</code>, <code class="syntax">currentQuotaKey</code>, new SQL syntax <code class="syntax">CREATE QUOTA</code>, <code class="syntax">ALTER QUOTA</code>, <code class="syntax">DROP QUOTA</code>, <code class="syntax">SHOW QUOTA</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7257" rel="external nofollow noreferrer" target="_blank">#7257</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Allow skipping unknown settings with warnings instead of throwing exceptions. <a href="https://github.com/ClickHouse/ClickHouse/pull/7653" rel="external nofollow noreferrer" target="_blank">#7653</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
<li>Reworked row policies as a part of access control system. Added new table <code class="syntax">system.row_policies</code>, new function <code class="syntax">currentRowPolicies()</code>, new SQL syntax <code class="syntax">CREATE POLICY</code>, <code class="syntax">ALTER POLICY</code>, <code class="syntax">DROP POLICY</code>, <code class="syntax">SHOW CREATE POLICY</code>, <code class="syntax">SHOW POLICIES</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7808" rel="external nofollow noreferrer" target="_blank">#7808</a> (<a href="https://github.com/vitlibar" rel="external nofollow noreferrer" target="_blank">Vitaly Baranov</a>)</li>
</ul>
<h4 id="security-fix">Security Fix<a class="headerlink" href="#security-fix" title="Permanent link"> </a></h4>
<ul>
<li>Fixed the possibility of reading directories structure in tables with <code class="syntax">File</code> table engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8536" rel="external nofollow noreferrer" target="_blank">#8536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8537" rel="external nofollow noreferrer" target="_blank">#8537</a> (<a href="https://github.com/alexey-milovidov" rel="external nofollow noreferrer" target="_blank">alexey-milovidov</a>)</li>
</ul>
<h2 id="changelog-for-2019"><a href="https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2019.md" rel="external nofollow noreferrer" target="_blank">Changelog for 2019</a><a class="headerlink" href="#changelog-for-2019" title="Permanent link"> </a></h2>
        

        
    </div>

    
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Was this content helpful?</span>
  <div id="rating-stars" class="display-6 mb-0"
     
     data-titles="['Unusable', 'Poor', 'OK', 'Good', 'Excellent']"
     data-documentation="documentation"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2021 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/0456f20bf4dfe43e56279f2734c4dda7e89f437b" rel="external nofollow noreferrer" target="_blank" class="text-reset">0456f20bf4</a>
    
    </div>
</div>

</div>

                
                    <div id="toc" class="col-xl-2 d-none d-xl-block d-print-none p-3 overflow-auto toc-right mb-5">
    
    
    <nav class="nav flex-column text-wrap">
    
        <label for="toc">Table of Contents</label>
    
    
        
        
        <a href="#clickhouse-release-20-12" title="ClickHouse release 20.12" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.12
</a>

    
        
        
        <a href="#clickhouse-release-v20-12-5-14-stable-2020-12-28" title="ClickHouse release v20.12.5.14-stable, 2020-12-28" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.12.5.14-stable, 2020-12-28
</a>

<nav id="toc-toc-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-12-4-5-stable-2020-12-24" title="ClickHouse release v20.12.4.5-stable, 2020-12-24" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.12.4.5-stable, 2020-12-24
</a>

<nav id="toc-toc-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_1" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-12-3-3-stable-2020-12-13" title="ClickHouse release v20.12.3.3-stable, 2020-12-13" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.12.3.3-stable, 2020-12-13
</a>

<nav id="toc-toc-4" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_2" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#experimental-feature" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_1" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-11" title="ClickHouse release 20.11" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.11
</a>

<nav id="toc-toc-5" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-11-7-16-stable-2021-03-02" title="ClickHouse release v20.11.7.16-stable, 2021-03-02" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.11.7.16-stable, 2021-03-02
</a>

<nav id="toc-toc-5-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#improvement_1" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#bug-fix_3" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_2" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-11-6-6-stable-2020-12-24" title="ClickHouse release v20.11.6.6-stable, 2020-12-24" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.11.6.6-stable, 2020-12-24
</a>

<nav id="toc-toc-5-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_4" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-11-3-3-stable-2020-11-13" title="ClickHouse release v20.11.3.3-stable, 2020-11-13" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.11.3.3-stable, 2020-11-13
</a>

<nav id="toc-toc-5-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_5" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-11-2-1-2020-11-11" title="ClickHouse release v20.11.2.1, 2020-11-11" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.11.2.1, 2020-11-11
</a>

<nav id="toc-toc-5-4" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_1" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_1" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#experimental-feature_1" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#bug-fix_6" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_2" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_1" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_3" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-10" title="ClickHouse release 20.10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.10
</a>

<nav id="toc-toc-6" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-10-7-4-stable-2020-12-24" title="ClickHouse release v20.10.7.4-stable, 2020-12-24" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.10.7.4-stable, 2020-12-24
</a>

<nav id="toc-toc-6-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_7" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-10-4-1-stable-2020-11-13" title="ClickHouse release v20.10.4.1-stable, 2020-11-13" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.10.4.1-stable, 2020-11-13
</a>

<nav id="toc-toc-6-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_8" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_3" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-10-3-30-2020-10-28" title="ClickHouse release v20.10.3.30, 2020-10-28" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.10.3.30, 2020-10-28
</a>

<nav id="toc-toc-6-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_2" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_2" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_9" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_4" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_2" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_4" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-9" title="ClickHouse release 20.9" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.9
</a>

<nav id="toc-toc-7" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-9-7-11-stable-2020-12-07" title="ClickHouse release v20.9.7.11-stable, 2020-12-07" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.9.7.11-stable, 2020-12-07
</a>

<nav id="toc-toc-7-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#performance-improvement_3" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#bug-fix_10" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_5" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-9-6-14-stable-2020-11-20" title="ClickHouse release v20.9.6.14-stable, 2020-11-20" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.9.6.14-stable, 2020-11-20
</a>

<nav id="toc-toc-7-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#improvement_5" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#bug-fix_11" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-9-5-5-stable-2020-11-13" title="ClickHouse release v20.9.5.5-stable, 2020-11-13" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.9.5.5-stable, 2020-11-13
</a>

<nav id="toc-toc-7-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_12" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-9-4-76-stable-2020-10-29" title="ClickHouse release v20.9.4.76-stable (2020-10-29)" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.9.4.76-stable (2020-10-29)
</a>

<nav id="toc-toc-7-4" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_13" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_6" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-9-3-45-stable-2020-10-09" title="ClickHouse release v20.9.3.45-stable (2020-10-09)" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.9.3.45-stable (2020-10-09)
</a>

<nav id="toc-toc-7-5" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_14" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_7" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-9-2-20-2020-09-22" title="ClickHouse release v20.9.2.20, 2020-09-22" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.9.2.20, 2020-09-22
</a>

<nav id="toc-toc-7-6" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_3" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_3" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_15" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#experimental-feature_2" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#improvement_8" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_4" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_6" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-8" title="ClickHouse release 20.8" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.8
</a>

<nav id="toc-toc-8" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-8-12-2-lts-2021-01-16" title="ClickHouse release v20.8.12.2-lts, 2021-01-16" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.12.2-lts, 2021-01-16
</a>

<nav id="toc-toc-8-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_16" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-11-17-lts-2020-12-25" title="ClickHouse release v20.8.11.17-lts, 2020-12-25" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.11.17-lts, 2020-12-25
</a>

<nav id="toc-toc-8-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_17" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-10-13-lts-2020-12-24" title="ClickHouse release v20.8.10.13-lts, 2020-12-24" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.10.13-lts, 2020-12-24
</a>

<nav id="toc-toc-8-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_18" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-6-6-lts-2020-11-13" title="ClickHouse release v20.8.6.6-lts, 2020-11-13" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.6.6-lts, 2020-11-13
</a>

<nav id="toc-toc-8-4" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_19" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-5-45-lts-2020-10-29" title="ClickHouse release v20.8.5.45-lts, 2020-10-29" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.5.45-lts, 2020-10-29
</a>

<nav id="toc-toc-8-5" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_20" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_9" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-4-11-lts-2020-10-09" title="ClickHouse release v20.8.4.11-lts, 2020-10-09" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.4.11-lts, 2020-10-09
</a>

<nav id="toc-toc-8-6" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_21" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_10" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-3-18-stable-2020-09-18" title="ClickHouse release v20.8.3.18-stable, 2020-09-18" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.3.18-stable, 2020-09-18
</a>

<nav id="toc-toc-8-7" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_22" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_11" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-8-2-3-stable-2020-09-08" title="ClickHouse release v20.8.2.3-stable, 2020-09-08" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.8.2.3-stable, 2020-09-08
</a>

<nav id="toc-toc-8-8" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_4" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_4" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_23" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_12" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_5" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#experimental-feature_3" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_7" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-7" title="ClickHouse release 20.7" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.7
</a>

<nav id="toc-toc-9" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-7-2-30-stable-2020-08-31" title="ClickHouse release v20.7.2.30-stable, 2020-08-31" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.7.2.30-stable, 2020-08-31
</a>

<nav id="toc-toc-9-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_5" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_5" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_24" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_13" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_6" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_8" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-6" title="ClickHouse release 20.6" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.6
</a>

<nav id="toc-toc-10" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-6-3-28-stable" title="ClickHouse release v20.6.3.28-stable" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.6.3.28-stable
</a>

<nav id="toc-toc-10-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_6" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_6" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_25" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_14" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_7" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#experimental-feature_4" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_9" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-20-5" title="ClickHouse release 20.5" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release 20.5
</a>

<nav id="toc-toc-11" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-5-4-40-stable-2020-08-10" title="ClickHouse release v20.5.4.40-stable 2020-08-10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.5.4.40-stable 2020-08-10
</a>

<nav id="toc-toc-11-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_26" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#performance-improvement_8" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_10" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-5-2-7-stable-2020-07-02" title="ClickHouse release v20.5.2.7-stable 2020-07-02" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.5.2.7-stable 2020-07-02
</a>

<nav id="toc-toc-11-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_7" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_7" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_27" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_15" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_9" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#experimental-feature_5" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_11" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-4" title="ClickHouse release v20.4" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4
</a>

<nav id="toc-toc-12" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-4-8-99-stable-2020-08-10" title="ClickHouse release v20.4.8.99-stable 2020-08-10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4.8.99-stable 2020-08-10
</a>

<nav id="toc-toc-12-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_28" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#performance-improvement_10" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_12" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-4-6-53-stable-2020-06-25" title="ClickHouse release v20.4.6.53-stable 2020-06-25" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4.6.53-stable 2020-06-25
</a>

<nav id="toc-toc-12-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_29" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_13" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-4-5-36-stable-2020-06-10" title="ClickHouse release v20.4.5.36-stable 2020-06-10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4.5.36-stable 2020-06-10
</a>

<nav id="toc-toc-12-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_30" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_14" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-4-4-18-stable-2020-05-26" title="ClickHouse release v20.4.4.18-stable 2020-05-26" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4.4.18-stable 2020-05-26
</a>

    
        
        
        <a href="#clickhouse-release-v20-4-3-16-stable-2020-05-23" title="ClickHouse release v20.4.3.16-stable 2020-05-23" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4.3.16-stable 2020-05-23
</a>

<nav id="toc-toc-12-5" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_31" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-4-2-9-2020-05-12" title="ClickHouse release v20.4.2.9, 2020-05-12" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.4.2.9, 2020-05-12
</a>

<nav id="toc-toc-12-6" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_8" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_8" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#experimental-feature_6" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#bug-fix_32" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_16" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_11" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_15" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3" title="ClickHouse release v20.3" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3
</a>

<nav id="toc-toc-13" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-3-21-2-lts-2020-11-02" title="ClickHouse release v20.3.21.2-lts, 2020-11-02" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.21.2-lts, 2020-11-02
</a>

<nav id="toc-toc-13-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_33" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-20-6-lts-2020-10-09" title="ClickHouse release v20.3.20.6-lts, 2020-10-09" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.20.6-lts, 2020-10-09
</a>

<nav id="toc-toc-13-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_34" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-19-4-lts-2020-09-18" title="ClickHouse release v20.3.19.4-lts, 2020-09-18" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.19.4-lts, 2020-09-18
</a>

<nav id="toc-toc-13-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_35" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_17" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-18-10-lts-2020-09-08" title="ClickHouse release v20.3.18.10-lts, 2020-09-08" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.18.10-lts, 2020-09-08
</a>

<nav id="toc-toc-13-4" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_36" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_18" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_12" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_16" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-17-173-lts-2020-08-15" title="ClickHouse release v20.3.17.173-lts, 2020-08-15" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.17.173-lts, 2020-08-15
</a>

<nav id="toc-toc-13-5" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_37" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-16-165-lts-2020-08-10" title="ClickHouse release v20.3.16.165-lts 2020-08-10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.16.165-lts 2020-08-10
</a>

<nav id="toc-toc-13-6" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_38" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#performance-improvement_13" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-12-112-lts-2020-06-25" title="ClickHouse release v20.3.12.112-lts 2020-06-25" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.12.112-lts 2020-06-25
</a>

<nav id="toc-toc-13-7" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_39" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-11-97-lts-2020-06-10" title="ClickHouse release v20.3.11.97-lts 2020-06-10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.11.97-lts 2020-06-10
</a>

<nav id="toc-toc-13-8" class="nav flex-column pl-2">
    
    
        
        
        <a href="#new-feature_9" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_40" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#performance-improvement_14" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_17" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-10-75-lts-2020-05-23" title="ClickHouse release v20.3.10.75-lts 2020-05-23" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.10.75-lts 2020-05-23
</a>

<nav id="toc-toc-13-9" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_41" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_18" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
        
        
        <a href="#bug-fix_42" title="Bug fix" class="nav-link text-wrap d-inline-block w-100">
    Bug fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-8-53-2020-04-23" title="ClickHouse release v20.3.8.53, 2020-04-23" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.8.53, 2020-04-23
</a>

<nav id="toc-toc-13-10" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_43" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#performance-improvement_15" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-7-46-2020-04-17" title="ClickHouse release v20.3.7.46, 2020-04-17" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.7.46, 2020-04-17
</a>

<nav id="toc-toc-13-11" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_44" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-6-40-2020-04-16" title="ClickHouse release v20.3.6.40, 2020-04-16" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.6.40, 2020-04-16
</a>

<nav id="toc-toc-13-12" class="nav flex-column pl-2">
    
    
        
        
        <a href="#new-feature_10" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_45" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_19" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-5-21-2020-03-27" title="ClickHouse release v20.3.5.21, 2020-03-27" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.5.21, 2020-03-27
</a>

<nav id="toc-toc-13-13" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_46" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_19" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-4-10-2020-03-20" title="ClickHouse release v20.3.4.10, 2020-03-20" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.4.10, 2020-03-20
</a>

<nav id="toc-toc-13-14" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_47" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-3-6-2020-03-17" title="ClickHouse release v20.3.3.6, 2020-03-17" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.3.6, 2020-03-17
</a>

<nav id="toc-toc-13-15" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_48" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-3-2-1-2020-03-12" title="ClickHouse release v20.3.2.1, 2020-03-12" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.3.2.1, 2020-03-12
</a>

<nav id="toc-toc-13-16" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_9" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_11" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#experimental-feature_7" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#bug-fix_49" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_20" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_16" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_20" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1" title="ClickHouse release v20.1" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1
</a>

<nav id="toc-toc-14" class="nav flex-column pl-2">
    
    
        
        
        <a href="#clickhouse-release-v20-1-16-120-stable-2020-60-26" title="ClickHouse release v20.1.16.120-stable 2020-60-26" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.16.120-stable 2020-60-26
</a>

<nav id="toc-toc-14-1" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_50" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-15-109-stable-2020-06-19" title="ClickHouse release v20.1.15.109-stable 2020-06-19" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.15.109-stable 2020-06-19
</a>

<nav id="toc-toc-14-2" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_51" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-14-107-stable-2020-06-11" title="ClickHouse release v20.1.14.107-stable 2020-06-11" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.14.107-stable 2020-06-11
</a>

<nav id="toc-toc-14-3" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_52" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-13-105-stable-2020-06-10" title="ClickHouse release v20.1.13.105-stable 2020-06-10" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.13.105-stable 2020-06-10
</a>

<nav id="toc-toc-14-4" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_53" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-12-86-2020-05-26" title="ClickHouse release v20.1.12.86, 2020-05-26" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.12.86, 2020-05-26
</a>

<nav id="toc-toc-14-5" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_54" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_21" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-10-70-2020-04-17" title="ClickHouse release v20.1.10.70, 2020-04-17" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.10.70, 2020-04-17
</a>

<nav id="toc-toc-14-6" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_55" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_22" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-9-54-2020-03-28" title="ClickHouse release v20.1.9.54, 2020-03-28" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.9.54, 2020-03-28
</a>

<nav id="toc-toc-14-7" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_56" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_21" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_23" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-8-41-2020-03-20" title="ClickHouse release v20.1.8.41, 2020-03-20" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.8.41, 2020-03-20
</a>

<nav id="toc-toc-14-8" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_57" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-7-38-2020-03-18" title="ClickHouse release v20.1.7.38, 2020-03-18" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.7.38, 2020-03-18
</a>

<nav id="toc-toc-14-9" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_58" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_24" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-6-30-2020-03-05" title="ClickHouse release v20.1.6.30, 2020-03-05" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.6.30, 2020-03-05
</a>

<nav id="toc-toc-14-10" class="nav flex-column pl-2">
    
    
        
        
        <a href="#bug-fix_59" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#new-feature_12" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
</nav>

    
        
        
        <a href="#clickhouse-release-v20-1-2-4-2020-01-22" title="ClickHouse release v20.1.2.4, 2020-01-22" class="nav-link text-wrap d-inline-block w-100">
    ClickHouse release v20.1.2.4, 2020-01-22
</a>

<nav id="toc-toc-14-11" class="nav flex-column pl-2">
    
    
        
        
        <a href="#backward-incompatible-change_10" title="Backward Incompatible Change" class="nav-link text-wrap d-inline-block w-100">
    Backward Incompatible Change
</a>

    
        
        
        <a href="#new-feature_13" title="New Feature" class="nav-link text-wrap d-inline-block w-100">
    New Feature
</a>

    
        
        
        <a href="#bug-fix_60" title="Bug Fix" class="nav-link text-wrap d-inline-block w-100">
    Bug Fix
</a>

    
        
        
        <a href="#improvement_22" title="Improvement" class="nav-link text-wrap d-inline-block w-100">
    Improvement
</a>

    
        
        
        <a href="#performance-improvement_17" title="Performance Improvement" class="nav-link text-wrap d-inline-block w-100">
    Performance Improvement
</a>

    
        
        
        <a href="#build-testing-packaging-improvement_25" title="Build/Testing/Packaging Improvement" class="nav-link text-wrap d-inline-block w-100">
    Build/Testing/Packaging Improvement
</a>

    
        
        
        <a href="#experimental-feature_8" title="Experimental Feature" class="nav-link text-wrap d-inline-block w-100">
    Experimental Feature
</a>

    
        
        
        <a href="#security-fix" title="Security Fix" class="nav-link text-wrap d-inline-block w-100">
    Security Fix
</a>

    
</nav>

    
</nav>

    
        
        
        <a href="#changelog-for-2019" title="Changelog for 2019" class="nav-link text-wrap d-inline-block w-100">
    Changelog for 2019
</a>

    
    </nav>
</div>
                
            </div>
        </div>
    

    
        
        <script async type="text/javascript" src="/js/base.js?js_digest"></script>



<noscript>
    <div><img src="https://mc.yandex.ru/watch/18343495" alt="Yandex"/></div>
</noscript>
    </div>
</body>
</html>