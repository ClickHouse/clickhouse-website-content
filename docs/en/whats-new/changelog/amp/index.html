<!doctype html><html ⚡ lang=en> <head><meta charset=utf-8><script async src=https://cdn.ampproject.org/v0.js></script><title>2021 | ClickHouse Documentation</title><link href=https://clickhouse.tech/docs/en/whats-new/changelog/ rel=canonical><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><script type=application/ld+json>[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "2021 | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.tech/docs/en/whats-new/changelog/",




"image": "https://clickhouse.tech/images/logo-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "Yandex LLC",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.tech/images/yandex.png",
    "width": 163,
    "height": 60
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "2021 | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,::after,::before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}article,footer,header,main,section{display:block}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ul{margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}b{font-weight:bolder}small{font-size:80%}a{color:#007bff;text-decoration:none;background-color:transparent}a:hover{color:#0056b3;text-decoration:underline}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}table{border-collapse:collapse}input,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}textarea{overflow:auto;resize:vertical}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}template{display:none}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:2rem}.h2,h2{font-size:1.5rem}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1rem}.h5,h5{font-size:1rem}.h6,h6{font-size:1rem}.lead{font-size:1.25rem;font-weight:300}.display-1{font-size:6rem;font-weight:300;line-height:1.2}.display-2{font-size:5.5rem;font-weight:300;line-height:1.2}.display-3{font-size:4.5rem;font-weight:300;line-height:1.2}.display-4{font-size:3.5rem;font-weight:300;line-height:1.2}.small,small{font-size:80%;font-weight:400}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container{max-width:720px}}@media(min-width:992px){.container{max-width:960px}}@media(min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media(min-width:576px){.container{max-width:540px}}@media(min-width:768px){.container,.container-md{max-width:720px}}@media(min-width:992px){.container,.container-lg,.container-md{max-width:960px}}@media(min-width:1200px){.container,.container-lg,.container-md{max-width:1140px}}.row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-auto,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-auto,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-auto{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-first{-ms-flex-order:-1;order:-1}.order-last{-ms-flex-order:13;order:13}.order-0{-ms-flex-order:0;order:0}.order-1{-ms-flex-order:1;order:1}.order-2{-ms-flex-order:2;order:2}.order-3{-ms-flex-order:3;order:3}.order-4{-ms-flex-order:4;order:4}.order-5{-ms-flex-order:5;order:5}.order-6{-ms-flex-order:6;order:6}.order-7{-ms-flex-order:7;order:7}.order-8{-ms-flex-order:8;order:8}.order-9{-ms-flex-order:9;order:9}.order-10{-ms-flex-order:10;order:10}.order-11{-ms-flex-order:11;order:11}.order-12{-ms-flex-order:12;order:12}.offset-1{margin-left:8.333333%}.offset-2{margin-left:16.666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.333333%}.offset-5{margin-left:41.666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.333333%}.offset-8{margin-left:66.666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.333333%}.offset-11{margin-left:91.666667%}@media(min-width:768px){.col-md{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-md-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-md-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-md-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-md-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-md-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-md-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-md-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-md-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-md-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-md-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-md-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-md-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-md-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-md-first{-ms-flex-order:-1;order:-1}.order-md-last{-ms-flex-order:13;order:13}.order-md-0{-ms-flex-order:0;order:0}.order-md-1{-ms-flex-order:1;order:1}.order-md-2{-ms-flex-order:2;order:2}.order-md-3{-ms-flex-order:3;order:3}.order-md-4{-ms-flex-order:4;order:4}.order-md-5{-ms-flex-order:5;order:5}.order-md-6{-ms-flex-order:6;order:6}.order-md-7{-ms-flex-order:7;order:7}.order-md-8{-ms-flex-order:8;order:8}.order-md-9{-ms-flex-order:9;order:9}.order-md-10{-ms-flex-order:10;order:10}.order-md-11{-ms-flex-order:11;order:11}.order-md-12{-ms-flex-order:12;order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.333333%}.offset-md-2{margin-left:16.666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.333333%}.offset-md-5{margin-left:41.666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.333333%}.offset-md-8{margin-left:66.666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.333333%}.offset-md-11{margin-left:91.666667%}}@media(min-width:992px){.col-lg{-ms-flex-preferred-size:0;flex-basis:0;-ms-flex-positive:1;flex-grow:1;max-width:100%}.col-lg-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-lg-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-lg-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-lg-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-lg-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-lg-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-lg-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-lg-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-lg-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-lg-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-lg-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-lg-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-lg-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.order-lg-first{-ms-flex-order:-1;order:-1}.order-lg-last{-ms-flex-order:13;order:13}.order-lg-0{-ms-flex-order:0;order:0}.order-lg-1{-ms-flex-order:1;order:1}.order-lg-2{-ms-flex-order:2;order:2}.order-lg-3{-ms-flex-order:3;order:3}.order-lg-4{-ms-flex-order:4;order:4}.order-lg-5{-ms-flex-order:5;order:5}.order-lg-6{-ms-flex-order:6;order:6}.order-lg-7{-ms-flex-order:7;order:7}.order-lg-8{-ms-flex-order:8;order:8}.order-lg-9{-ms-flex-order:9;order:9}.order-lg-10{-ms-flex-order:10;order:10}.order-lg-11{-ms-flex-order:11;order:11}.order-lg-12{-ms-flex-order:12;order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.333333%}.offset-lg-2{margin-left:16.666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.333333%}.offset-lg-5{margin-left:41.666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.333333%}.offset-lg-8{margin-left:66.666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.333333%}.offset-lg-11{margin-left:91.666667%}}.table{width:100%;margin-bottom:1rem;color:#212529}.table-primary{background-color:#b8daff}.table-secondary{background-color:#d6d8db}.table-info{background-color:#bee5eb}.table-warning{background-color:#ffeeba}.table-light{background-color:#fdfdfe}.table-dark{background-color:#c6c8ca}.table-active{background-color:rgba(0,0,0,.075)}.table-dark{color:#fff;background-color:#343a40}.form-control{display:block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.form-control{transition:none}}.form-control::-ms-expand{background-color:transparent;border:0}.form-control:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.form-control:focus{color:#495057;background-color:#fff;border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.form-control::-webkit-input-placeholder{color:#6c757d;opacity:1}.form-control::-moz-placeholder{color:#6c757d;opacity:1}.form-control:-ms-input-placeholder{color:#6c757d;opacity:1}.form-control::-ms-input-placeholder{color:#6c757d;opacity:1}.form-control::placeholder{color:#6c757d;opacity:1}.form-control:disabled,.form-control[readonly]{background-color:#e9ecef;opacity:1}select.form-control:focus::-ms-value{color:#495057;background-color:#fff}.form-control-file,.form-control-range{display:block;width:100%}.form-control-lg{height:calc(1.5em+1rem+2px);padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}select.form-control[multiple],select.form-control[size]{height:auto}textarea.form-control{height:auto}.form-group{margin-bottom:1rem}.form-text{display:block;margin-top:.25rem}.form-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-5px;margin-left:-5px}.form-row>.col,.form-row>[class*=col-]{padding-right:5px;padding-left:5px}.form-check{position:relative;display:block;padding-left:1.25rem}.form-check-input{position:absolute;margin-top:.3rem;margin-left:-1.25rem}.form-check-inline{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;padding-left:0;margin-right:.75rem}.form-check-inline .form-check-input{position:static;margin-top:0;margin-right:.3125rem;margin-left:0}.was-validated .form-control:valid{border-color:#28a745;padding-right:calc(1.5em+.75rem);background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right calc(.375em+.1875rem) center;background-size:calc(.75em+.375rem) calc(.75em+.375rem)}.was-validated .form-control:valid:focus{border-color:#28a745;box-shadow:0 0 0 .2rem rgba(40,167,69,.25)}.was-validated textarea.form-control:valid{padding-right:calc(1.5em+.75rem);background-position:top calc(.375em+.1875rem) right calc(.375em+.1875rem)}.was-validated .custom-select:valid{border-color:#28a745;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.was-validated .custom-select:valid:focus{border-color:#28a745;box-shadow:0 0 0 .2rem rgba(40,167,69,.25)}.invalid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.is-invalid~.invalid-feedback,.was-validated :invalid~.invalid-feedback{display:block}.form-control.is-invalid,.was-validated .form-control:invalid{border-color:#dc3545;padding-right:calc(1.5em+.75rem);background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right calc(.375em+.1875rem) center;background-size:calc(.75em+.375rem) calc(.75em+.375rem)}.form-control.is-invalid:focus,.was-validated .form-control:invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.was-validated textarea.form-control:invalid,textarea.form-control.is-invalid{padding-right:calc(1.5em+.75rem);background-position:top calc(.375em+.1875rem) right calc(.375em+.1875rem)}.custom-select.is-invalid,.was-validated .custom-select:invalid{border-color:#dc3545;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-invalid:focus,.was-validated .custom-select:invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.form-check-input.is-invalid~.invalid-feedback,.was-validated .form-check-input:invalid~.invalid-feedback{display:block}.form-inline{display:-ms-flexbox;display:flex;-ms-flex-flow:row wrap;flex-flow:row wrap;-ms-flex-align:center;align-items:center}.form-inline .form-check{width:100%}@media(min-width:576px){.form-inline .form-group{display:-ms-flexbox;display:flex;-ms-flex:0 0 auto;flex:0 0 auto;-ms-flex-flow:row wrap;flex-flow:row wrap;-ms-flex-align:center;align-items:center;margin-bottom:0}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .custom-select,.form-inline .input-group{width:auto}.form-inline .form-check{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:auto;padding-left:0}.form-inline .form-check-input{position:relative;-ms-flex-negative:0;flex-shrink:0;margin-top:0;margin-right:.25rem;margin-left:0}.form-inline .custom-control{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn.focus,.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.btn.disabled,.btn:disabled{opacity:.65}a.btn.disabled{pointer-events:none}.btn-primary{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:hover{color:#fff;background-color:#0069d9;border-color:#0062cc}.btn-primary.focus,.btn-primary:focus{color:#fff;background-color:#0069d9;border-color:#0062cc;box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-primary.disabled,.btn-primary:disabled{color:#fff;background-color:#007bff;border-color:#007bff}.btn-primary:not(:disabled):not(.disabled).active,.btn-primary:not(:disabled):not(.disabled):active{color:#fff;background-color:#0062cc;border-color:#005cbf}.btn-primary:not(:disabled):not(.disabled).active:focus,.btn-primary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(38,143,255,.5)}.btn-secondary{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-secondary:hover{color:#fff;background-color:#5a6268;border-color:#545b62}.btn-secondary.focus,.btn-secondary:focus{color:#fff;background-color:#5a6268;border-color:#545b62;box-shadow:0 0 0 .2rem rgba(130,138,145,.5)}.btn-secondary.disabled,.btn-secondary:disabled{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-secondary:not(:disabled):not(.disabled).active,.btn-secondary:not(:disabled):not(.disabled):active{color:#fff;background-color:#545b62;border-color:#4e555b}.btn-secondary:not(:disabled):not(.disabled).active:focus,.btn-secondary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(130,138,145,.5)}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info.focus,.btn-info:focus{color:#fff;background-color:#138496;border-color:#117a8b;box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-info.disabled,.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:not(:disabled):not(.disabled).active,.btn-info:not(:disabled):not(.disabled):active{color:#fff;background-color:#117a8b;border-color:#10707f}.btn-info:not(:disabled):not(.disabled).active:focus,.btn-info:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-warning{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#212529;background-color:#e0a800;border-color:#d39e00}.btn-warning.focus,.btn-warning:focus{color:#212529;background-color:#e0a800;border-color:#d39e00;box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-warning.disabled,.btn-warning:disabled{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-warning:not(:disabled):not(.disabled).active,.btn-warning:not(:disabled):not(.disabled):active{color:#212529;background-color:#d39e00;border-color:#c69500}.btn-warning:not(:disabled):not(.disabled).active:focus,.btn-warning:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(222,170,12,.5)}.btn-light{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#212529;background-color:#e2e6ea;border-color:#dae0e5}.btn-light.focus,.btn-light:focus{color:#212529;background-color:#e2e6ea;border-color:#dae0e5;box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-light.disabled,.btn-light:disabled{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:not(:disabled):not(.disabled).active,.btn-light:not(:disabled):not(.disabled):active{color:#212529;background-color:#dae0e5;border-color:#d3d9df}.btn-light:not(:disabled):not(.disabled).active:focus,.btn-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(216,217,219,.5)}.btn-dark{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:hover{color:#fff;background-color:#23272b;border-color:#1d2124}.btn-dark.focus,.btn-dark:focus{color:#fff;background-color:#23272b;border-color:#1d2124;box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-dark.disabled,.btn-dark:disabled{color:#fff;background-color:#343a40;border-color:#343a40}.btn-dark:not(:disabled):not(.disabled).active,.btn-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#1d2124;border-color:#171a1d}.btn-dark:not(:disabled):not(.disabled).active:focus,.btn-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(82,88,93,.5)}.btn-outline-primary{color:#007bff;border-color:#007bff}.btn-outline-primary:hover{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary.focus,.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-primary.disabled,.btn-outline-primary:disabled{color:#007bff;background-color:transparent}.btn-outline-primary:not(:disabled):not(.disabled).active,.btn-outline-primary:not(:disabled):not(.disabled):active{color:#fff;background-color:#007bff;border-color:#007bff}.btn-outline-primary:not(:disabled):not(.disabled).active:focus,.btn-outline-primary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(0,123,255,.5)}.btn-outline-secondary{color:#6c757d;border-color:#6c757d}.btn-outline-secondary:hover{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-outline-secondary.focus,.btn-outline-secondary:focus{box-shadow:0 0 0 .2rem rgba(108,117,125,.5)}.btn-outline-secondary.disabled,.btn-outline-secondary:disabled{color:#6c757d;background-color:transparent}.btn-outline-secondary:not(:disabled):not(.disabled).active,.btn-outline-secondary:not(:disabled):not(.disabled):active{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-outline-secondary:not(:disabled):not(.disabled).active:focus,.btn-outline-secondary:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(108,117,125,.5)}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info.focus,.btn-outline-info:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-info.disabled,.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-info:not(:disabled):not(.disabled).active,.btn-outline-info:not(:disabled):not(.disabled):active{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:not(:disabled):not(.disabled).active:focus,.btn-outline-info:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning.focus,.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-warning.disabled,.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-warning:not(:disabled):not(.disabled).active,.btn-outline-warning:not(:disabled):not(.disabled):active{color:#212529;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:not(:disabled):not(.disabled).active:focus,.btn-outline-warning:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(255,193,7,.5)}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light.focus,.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-light.disabled,.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-light:not(:disabled):not(.disabled).active,.btn-outline-light:not(:disabled):not(.disabled):active{color:#212529;background-color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:not(:disabled):not(.disabled).active:focus,.btn-outline-light:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(248,249,250,.5)}.btn-outline-dark{color:#343a40;border-color:#343a40}.btn-outline-dark:hover{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark.focus,.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#343a40;background-color:transparent}.btn-outline-dark:not(:disabled):not(.disabled).active,.btn-outline-dark:not(:disabled):not(.disabled):active{color:#fff;background-color:#343a40;border-color:#343a40}.btn-outline-dark:not(:disabled):not(.disabled).active:focus,.btn-outline-dark:not(:disabled):not(.disabled):active:focus{box-shadow:0 0 0 .2rem rgba(52,58,64,.5)}.btn-link{font-weight:400;color:#007bff;text-decoration:none}.btn-link:hover{color:#0056b3;text-decoration:underline}.btn-link.focus,.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link.disabled,.btn-link:disabled{color:#6c757d;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:.5rem}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.collapsing{position:relative;height:0;overflow:hidden}@media(prefers-reduced-motion:reduce){.collapsing{transition:none}}.btn-group,.btn-group-vertical{position:relative;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.btn-group-vertical>.btn:hover,.btn-group>.btn:hover{z-index:1}.btn-group-vertical>.btn.active,.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.btn-group-vertical{-ms-flex-direction:column;flex-direction:column;-ms-flex-align:start;align-items:flex-start;-ms-flex-pack:center;justify-content:center}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group{width:100%}.btn-group-vertical>.btn-group:not(:first-child),.btn-group-vertical>.btn:not(:first-child){margin-top:-1px}.btn-group-vertical>.btn-group:not(:last-child)>.btn{border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:not(:first-child)>.btn,.btn-group-vertical>.btn:not(:first-child){border-top-left-radius:0;border-top-right-radius:0}.input-group{position:relative;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-align:stretch;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select,.input-group>.form-control{position:relative;-ms-flex:1 1 0;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-file+.form-control,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select,.input-group>.custom-select+.form-control,.input-group>.form-control+.custom-file,.input-group>.form-control+.custom-select,.input-group>.form-control+.form-control{margin-left:-1px}.input-group>.custom-select:focus,.input-group>.form-control:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child),.input-group>.form-control:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child),.input-group>.form-control:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.input-group-text{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:.25rem}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select,.input-group-lg>.form-control:not(textarea){height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select,.input-group-lg>.form-control{padding:.5rem 1rem;font-size:1.25rem;line-height:1.5;border-radius:.3rem}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:-ms-inline-flexbox;display:inline-flex;margin-right:1rem}.custom-control-input{position:absolute;left:0;z-index:-1;width:1rem;height:1.25rem;opacity:0}.custom-switch{padding-left:2.25rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;vertical-align:middle;background:#fff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.custom-select:focus::-ms-value{color:#495057;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.25rem}.custom-file{position:relative;display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);margin-bottom:0}.custom-file-input{position:relative;z-index:2;width:100%;height:calc(1.5em+.75rem+2px);margin:0;opacity:0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(0,123,255,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#007bff;border:0;border-radius:1rem;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#b3d7ff}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#007bff;border:0;border-radius:1rem;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#b3d7ff}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#007bff;border:0;border-radius:1rem;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#b3d7ff}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px;background-color:#dee2e6;border-radius:1rem}.custom-range:disabled::-webkit-slider-thumb{background-color:#adb5bd}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#adb5bd}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#adb5bd}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}.pagination{display:-ms-flexbox;display:flex;padding-left:0;list-style:none;border-radius:.25rem}.alert{position:relative;padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-heading{color:inherit}.alert-link{font-weight:700}.alert-primary{color:#004085;background-color:#cce5ff;border-color:#b8daff}.alert-primary .alert-link{color:#002752}.alert-secondary{color:#383d41;background-color:#e2e3e5;border-color:#d6d8db}.alert-secondary .alert-link{color:#202326}.alert-info{color:#0c5460;background-color:#d1ecf1;border-color:#bee5eb}.alert-info .alert-link{color:#062c33}.alert-warning{color:#856404;background-color:#fff3cd;border-color:#ffeeba}.alert-warning .alert-link{color:#533f03}.alert-light{color:#818182;background-color:#fefefe;border-color:#fdfdfe}.alert-light .alert-link{color:#686868}.alert-dark{color:#1b1e21;background-color:#d6d8d9;border-color:#c6c8ca}.alert-dark .alert-link{color:#040505}@-webkit-keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:1rem 0}to{background-position:0 0}}.progress{display:-ms-flexbox;display:flex;height:1rem;overflow:hidden;font-size:.75rem;background-color:#e9ecef;border-radius:.25rem}.progress-bar{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;overflow:hidden;color:#fff;text-align:center;white-space:nowrap;background-color:#007bff}@media(prefers-reduced-motion:reduce){.progress-bar{transition:none}}.media{display:-ms-flexbox;display:flex;-ms-flex-align:start;align-items:flex-start}.media-body{-ms-flex:1;flex:1}.list-group{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;padding-left:0;margin-bottom:0}.close{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.5}.close:hover{color:#000;text-decoration:none}.close:not(:disabled):not(.disabled):focus,.close:not(:disabled):not(.disabled):hover{opacity:.75}a.close.disabled{pointer-events:none}@-webkit-keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spinner-border{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}@keyframes spinner-grow{0%{-webkit-transform:scale(0);transform:scale(0)}50%{opacity:1}}.bg-primary{background-color:#007bff}a.bg-primary:focus,a.bg-primary:hover{background-color:#0062cc}.bg-secondary{background-color:#6c757d}a.bg-secondary:focus,a.bg-secondary:hover{background-color:#545b62}.bg-info{background-color:#17a2b8}a.bg-info:focus,a.bg-info:hover{background-color:#117a8b}.bg-warning{background-color:#ffc107}a.bg-warning:focus,a.bg-warning:hover{background-color:#d39e00}.bg-light{background-color:#f8f9fa}a.bg-light:focus,a.bg-light:hover{background-color:#dae0e5}.bg-dark{background-color:#343a40}a.bg-dark:focus,a.bg-dark:hover{background-color:#1d2124}.bg-white{background-color:#fff}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-table{display:table}.d-table-row{display:table-row}@media(min-width:768px){.d-md-none{display:none}.d-md-inline{display:inline}.d-md-inline-block{display:inline-block}.d-md-block{display:block}.d-md-table{display:table}.d-md-table-row{display:table-row}}@media(min-width:992px){.d-lg-none{display:none}.d-lg-inline{display:inline}.d-lg-inline-block{display:inline-block}.d-lg-block{display:block}.d-lg-table{display:table}.d-lg-table-row{display:table-row}}@media print{.d-print-none{display:none}.d-print-inline{display:inline}.d-print-inline-block{display:inline-block}.d-print-block{display:block}.d-print-table{display:table}.d-print-table-row{display:table-row}}.float-left{float:left}.float-right{float:right}.float-none{float:none}@media(min-width:768px){.float-md-left{float:left}.float-md-right{float:right}.float-md-none{float:none}}@media(min-width:992px){.float-lg-left{float:left}.float-lg-right{float:right}.float-lg-none{float:none}}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.position-static{position:static}.position-fixed{position:fixed}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.h-25{height:25%}.h-50{height:50%}.h-75{height:75%}.h-100{height:100%}.h-auto{height:auto}.m-0{margin:0}.my-0{margin-top:0}.mr-0{margin-right:0}.mb-0,.my-0{margin-bottom:0}.m-1{margin:.25rem}.my-1{margin-top:.25rem}.mr-1{margin-right:.25rem}.mb-1,.my-1{margin-bottom:.25rem}.m-2{margin:.5rem}.my-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.m-3{margin:1rem}.my-3{margin-top:1rem}.mr-3{margin-right:1rem}.mb-3,.my-3{margin-bottom:1rem}.m-4{margin:1.5rem}.my-4{margin-top:1.5rem}.mr-4{margin-right:1.5rem}.mb-4,.my-4{margin-bottom:1.5rem}.m-5{margin:3rem}.my-5{margin-top:3rem}.mr-5{margin-right:3rem}.mb-5,.my-5{margin-bottom:3rem}.p-0{padding:0}.pt-0,.py-0{padding-top:0}.pr-0{padding-right:0}.pb-0,.py-0{padding-bottom:0}.p-1{padding:.25rem}.pt-1,.py-1{padding-top:.25rem}.pr-1{padding-right:.25rem}.pb-1,.py-1{padding-bottom:.25rem}.p-2{padding:.5rem}.pt-2,.py-2{padding-top:.5rem}.pr-2{padding-right:.5rem}.pb-2,.py-2{padding-bottom:.5rem}.p-3{padding:1rem}.pt-3,.py-3{padding-top:1rem}.pr-3{padding-right:1rem}.pb-3,.py-3{padding-bottom:1rem}.p-4{padding:1.5rem}.pt-4,.py-4{padding-top:1.5rem}.pr-4{padding-right:1.5rem}.pb-4,.py-4{padding-bottom:1.5rem}.p-5{padding:3rem}.pt-5,.py-5{padding-top:3rem}.pr-5{padding-right:3rem}.pb-5,.py-5{padding-bottom:3rem}.m-n1{margin:-.25rem}.my-n1{margin-top:-.25rem}.mr-n1{margin-right:-.25rem}.mb-n1,.my-n1{margin-bottom:-.25rem}.m-n2{margin:-.5rem}.my-n2{margin-top:-.5rem}.mr-n2{margin-right:-.5rem}.mb-n2,.my-n2{margin-bottom:-.5rem}.m-n3{margin:-1rem}.my-n3{margin-top:-1rem}.mr-n3{margin-right:-1rem}.mb-n3,.my-n3{margin-bottom:-1rem}.m-n4{margin:-1.5rem}.my-n4{margin-top:-1.5rem}.mr-n4{margin-right:-1.5rem}.mb-n4,.my-n4{margin-bottom:-1.5rem}.m-n5{margin:-3rem}.my-n5{margin-top:-3rem}.mr-n5{margin-right:-3rem}.mb-n5,.my-n5{margin-bottom:-3rem}.m-auto{margin:auto}.my-auto{margin-top:auto}.mr-auto{margin-right:auto}.mb-auto,.my-auto{margin-bottom:auto}@media(min-width:768px){.m-md-0{margin:0}.my-md-0{margin-top:0}.mr-md-0{margin-right:0}.mb-md-0,.my-md-0{margin-bottom:0}.m-md-1{margin:.25rem}.my-md-1{margin-top:.25rem}.mr-md-1{margin-right:.25rem}.mb-md-1,.my-md-1{margin-bottom:.25rem}.m-md-2{margin:.5rem}.my-md-2{margin-top:.5rem}.mr-md-2{margin-right:.5rem}.mb-md-2,.my-md-2{margin-bottom:.5rem}.m-md-3{margin:1rem}.my-md-3{margin-top:1rem}.mr-md-3{margin-right:1rem}.mb-md-3,.my-md-3{margin-bottom:1rem}.m-md-4{margin:1.5rem}.my-md-4{margin-top:1.5rem}.mr-md-4{margin-right:1.5rem}.mb-md-4,.my-md-4{margin-bottom:1.5rem}.m-md-5{margin:3rem}.my-md-5{margin-top:3rem}.mr-md-5{margin-right:3rem}.mb-md-5,.my-md-5{margin-bottom:3rem}.p-md-0{padding:0}.pt-md-0,.py-md-0{padding-top:0}.pr-md-0{padding-right:0}.pb-md-0,.py-md-0{padding-bottom:0}.p-md-1{padding:.25rem}.pt-md-1,.py-md-1{padding-top:.25rem}.pr-md-1{padding-right:.25rem}.pb-md-1,.py-md-1{padding-bottom:.25rem}.p-md-2{padding:.5rem}.pt-md-2,.py-md-2{padding-top:.5rem}.pr-md-2{padding-right:.5rem}.pb-md-2,.py-md-2{padding-bottom:.5rem}.p-md-3{padding:1rem}.pt-md-3,.py-md-3{padding-top:1rem}.pr-md-3{padding-right:1rem}.pb-md-3,.py-md-3{padding-bottom:1rem}.p-md-4{padding:1.5rem}.pt-md-4,.py-md-4{padding-top:1.5rem}.pr-md-4{padding-right:1.5rem}.pb-md-4,.py-md-4{padding-bottom:1.5rem}.p-md-5{padding:3rem}.pt-md-5,.py-md-5{padding-top:3rem}.pr-md-5{padding-right:3rem}.pb-md-5,.py-md-5{padding-bottom:3rem}.m-md-n1{margin:-.25rem}.my-md-n1{margin-top:-.25rem}.mr-md-n1{margin-right:-.25rem}.mb-md-n1,.my-md-n1{margin-bottom:-.25rem}.m-md-n2{margin:-.5rem}.my-md-n2{margin-top:-.5rem}.mr-md-n2{margin-right:-.5rem}.mb-md-n2,.my-md-n2{margin-bottom:-.5rem}.m-md-n3{margin:-1rem}.my-md-n3{margin-top:-1rem}.mr-md-n3{margin-right:-1rem}.mb-md-n3,.my-md-n3{margin-bottom:-1rem}.m-md-n4{margin:-1.5rem}.my-md-n4{margin-top:-1.5rem}.mr-md-n4{margin-right:-1.5rem}.mb-md-n4,.my-md-n4{margin-bottom:-1.5rem}.m-md-n5{margin:-3rem}.my-md-n5{margin-top:-3rem}.mr-md-n5{margin-right:-3rem}.mb-md-n5,.my-md-n5{margin-bottom:-3rem}.m-md-auto{margin:auto}.my-md-auto{margin-top:auto}.mr-md-auto{margin-right:auto}.mb-md-auto,.my-md-auto{margin-bottom:auto}}@media(min-width:992px){.m-lg-0{margin:0}.my-lg-0{margin-top:0}.mr-lg-0{margin-right:0}.mb-lg-0,.my-lg-0{margin-bottom:0}.m-lg-1{margin:.25rem}.my-lg-1{margin-top:.25rem}.mr-lg-1{margin-right:.25rem}.mb-lg-1,.my-lg-1{margin-bottom:.25rem}.m-lg-2{margin:.5rem}.my-lg-2{margin-top:.5rem}.mr-lg-2{margin-right:.5rem}.mb-lg-2,.my-lg-2{margin-bottom:.5rem}.m-lg-3{margin:1rem}.my-lg-3{margin-top:1rem}.mr-lg-3{margin-right:1rem}.mb-lg-3,.my-lg-3{margin-bottom:1rem}.m-lg-4{margin:1.5rem}.my-lg-4{margin-top:1.5rem}.mr-lg-4{margin-right:1.5rem}.mb-lg-4,.my-lg-4{margin-bottom:1.5rem}.m-lg-5{margin:3rem}.my-lg-5{margin-top:3rem}.mr-lg-5{margin-right:3rem}.mb-lg-5,.my-lg-5{margin-bottom:3rem}.p-lg-0{padding:0}.pt-lg-0,.py-lg-0{padding-top:0}.pr-lg-0{padding-right:0}.pb-lg-0,.py-lg-0{padding-bottom:0}.p-lg-1{padding:.25rem}.pt-lg-1,.py-lg-1{padding-top:.25rem}.pr-lg-1{padding-right:.25rem}.pb-lg-1,.py-lg-1{padding-bottom:.25rem}.p-lg-2{padding:.5rem}.pt-lg-2,.py-lg-2{padding-top:.5rem}.pr-lg-2{padding-right:.5rem}.pb-lg-2,.py-lg-2{padding-bottom:.5rem}.p-lg-3{padding:1rem}.pt-lg-3,.py-lg-3{padding-top:1rem}.pr-lg-3{padding-right:1rem}.pb-lg-3,.py-lg-3{padding-bottom:1rem}.p-lg-4{padding:1.5rem}.pt-lg-4,.py-lg-4{padding-top:1.5rem}.pr-lg-4{padding-right:1.5rem}.pb-lg-4,.py-lg-4{padding-bottom:1.5rem}.p-lg-5{padding:3rem}.pt-lg-5,.py-lg-5{padding-top:3rem}.pr-lg-5{padding-right:3rem}.pb-lg-5,.py-lg-5{padding-bottom:3rem}.m-lg-n1{margin:-.25rem}.my-lg-n1{margin-top:-.25rem}.mr-lg-n1{margin-right:-.25rem}.mb-lg-n1,.my-lg-n1{margin-bottom:-.25rem}.m-lg-n2{margin:-.5rem}.my-lg-n2{margin-top:-.5rem}.mr-lg-n2{margin-right:-.5rem}.mb-lg-n2,.my-lg-n2{margin-bottom:-.5rem}.m-lg-n3{margin:-1rem}.my-lg-n3{margin-top:-1rem}.mr-lg-n3{margin-right:-1rem}.mb-lg-n3,.my-lg-n3{margin-bottom:-1rem}.m-lg-n4{margin:-1.5rem}.my-lg-n4{margin-top:-1.5rem}.mr-lg-n4{margin-right:-1.5rem}.mb-lg-n4,.my-lg-n4{margin-bottom:-1.5rem}.m-lg-n5{margin:-3rem}.my-lg-n5{margin-top:-3rem}.mr-lg-n5{margin-right:-3rem}.mb-lg-n5,.my-lg-n5{margin-bottom:-3rem}.m-lg-auto{margin:auto}.my-lg-auto{margin-top:auto}.mr-lg-auto{margin-right:auto}.mb-lg-auto,.my-lg-auto{margin-bottom:auto}}.text-wrap{white-space:normal}.text-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}@media(min-width:768px){.text-md-left{text-align:left}.text-md-right{text-align:right}.text-md-center{text-align:center}}@media(min-width:992px){.text-lg-left{text-align:left}.text-lg-right{text-align:right}.text-lg-center{text-align:center}}.text-white{color:#fff}.text-primary{color:#007bff}a.text-primary:focus,a.text-primary:hover{color:#0056b3}.text-secondary{color:#6c757d}a.text-secondary:focus,a.text-secondary:hover{color:#494f54}.text-info{color:#17a2b8}a.text-info:focus,a.text-info:hover{color:#0f6674}.text-warning{color:#ffc107}a.text-warning:focus,a.text-warning:hover{color:#ba8b00}.text-light{color:#f8f9fa}a.text-light:focus,a.text-light:hover{color:#cbd3da}.text-dark{color:#343a40}a.text-dark:focus,a.text-dark:hover{color:#121416}.text-body{color:#212529}.text-muted{color:#6c757d}.text-black-50{color:rgba(0,0,0,.5)}.text-white-50{color:rgba(255,255,255,.5)}.text-decoration-none{text-decoration:none}.text-reset{color:inherit}.visible{visibility:visible}@media print{*,::after,::before{text-shadow:none;box-shadow:none}a:not(.btn){text-decoration:underline}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}body{min-width:992px}.container{min-width:992px}.table{border-collapse:collapse}.table-dark{color:inherit}}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}100%{-webkit-transform:none;transform:none;opacity:1}}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}a:link,a:visited{color:#f14600;text-decoration:none}a:active,a:hover{text-decoration:underline}.btn.disabled,.btn:disabled{cursor:default;opacity:.4}.fake-btn{display:inline-block;padding:.375rem .75rem;text-align:center;font-size:1rem;line-height:1.5}#logo-text{width:180px;margin-left:12px}.display-5{font-size:2rem;font-weight:300;line-height:1.2}.display-6{font-size:1.75rem;font-weight:300;line-height:1.2}.bg-dark-alt,.bg-dark-alt:focus{background:#36363f}.bg-secondary-alt,.bg-secondary-alt:focus{background:#444451}.bg-orange,.bg-orange:focus{background:#f14600}.text-dark-alt{color:#36363f}.btn-dark-alt{background:#36363f}.btn-dark-alt:focus{background:#36363f}.btn-outline-orange{border-color:#f14600;color:#f14600}.btn-orange,.btn-outline-orange:hover{background:#f14600;color:#fff}.btn:active,.btn:hover{text-decoration:none}.text-orange{color:#f14600}.bg-number{position:absolute;font-size:900%;font-weight:700;color:rgba(241,70,0,.1);line-height:1;margin-top:-1rem}#feedback_email{white-space:nowrap}.comments-bg{background:#f8f9fa}@media(prefers-color-scheme:dark){.comments-bg{background:#333}}details{background:#444451;color:#eee;padding:1rem;margin-bottom:1rem;margin-top:1rem}.headerlink{text-decoration:none;margin-left:.5rem}#content table{border:1px solid #dee2e6;width:100%;margin-bottom:1rem;overflow-x:auto}#content code{color:#000;background:#eee;padding:.125rem .25rem}#content code.syntax{padding:0}@media(max-width:768px){#search-form{width:50%}#search-form .input-group{width:100%}}@media print{body{min-width:0}code,h1,h2,h3,h4,h5,h6,img,li,p{page-break-inside:avoid}}@media(prefers-color-scheme:dark){#to-full-website,body.amp,body[data-spy]{background:#1c1c1c;color:#efefef}.invert-dark{filter:invert(100%)}#content table{border:1px solid #2a2b2c}#content code{background:#444;color:#eee;padding:.125rem .25rem}}.syntax{background:#f8f9fa;color:#2f1e2e}.syntax .c{color:#8d8687}.syntax .n{color:#2f1e2e}.syntax .o{color:#800}.syntax .p{color:#2f1e2e}.syntax .c1{color:#8d8687}.syntax .ld{color:#48b685}.syntax .m{color:#08f}.syntax .s{color:#48b685}.syntax .no{color:#ef6155}.syntax .py{color:#2f1e2e}.syntax .s2{color:#48b685}.syntax .s1{color:#080}@media(prefers-color-scheme:dark){.syntax .ld{color:#64ffbb}.syntax .s{color:#64ffbb}.syntax .s2{color:#64ffbb}.syntax .s1{color:#64ffbb}.syntax .c{color:#64ffbb}.syntax .n{color:#f8f9fa}.syntax .p{color:#f8f9fa}.syntax .py{color:#f8f9fa}}</style><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script></head> <body class=amp dir=ltr> <div class="container-fluid container-lg pb-5"> <div class="row pt-3 mb-3"> <div class=col> <a href=/ class=text-decoration-none> <amp-img class="d-inline-block mr-3" layout=fixed width=40 height=36 src=/images/logo.svg alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout=fixed width=238 height=36 src=/images/clickhouse-black.svg alt=ClickHouse title=ClickHouse></amp-img> </a> </div> </div> <div class=row> <div id=content class=col> <h2 id=clickhouse-release-21-3>ClickHouse release 21.3<a class=headerlink href=../amp/#clickhouse-release-21-3 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v21-3-2021-03-12>ClickHouse release v21.3, 2021-03-12<a class=headerlink href=../amp/#clickhouse-release-v21-3-2021-03-12 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change title="Permanent link"> </a></h4> <ul> <li>Now it's not allowed to create MergeTree tables in old syntax with table TTL because it's just ignored. Attach of old tables is still possible. <a href=https://github.com/ClickHouse/ClickHouse/pull/20282 rel="external nofollow noreferrer" target=_blank>#20282</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Now all case-insensitive function names will be rewritten to their canonical representations. This is needed for projection query routing (the upcoming feature). <a href=https://github.com/ClickHouse/ClickHouse/pull/20174 rel="external nofollow noreferrer" target=_blank>#20174</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix creation of <code class=syntax>TTL</code> in cases, when its expression is a function and it is the same as <code class=syntax>ORDER BY</code> key. Now it's allowed to set custom aggregation to primary key columns in <code class=syntax>TTL</code> with <code class=syntax>GROUP BY</code>. Backward incompatible: For primary key columns, which are not in <code class=syntax>GROUP BY</code> and aren't set explicitly now is applied function <code class=syntax>any</code> instead of <code class=syntax>max</code>, when TTL is expired. Also if you use TTL with <code class=syntax>WHERE</code> or <code class=syntax>GROUP BY</code> you can see exceptions at merges, while making rolling update. <a href=https://github.com/ClickHouse/ClickHouse/pull/15450 rel="external nofollow noreferrer" target=_blank>#15450</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=new-feature>New Feature<a class=headerlink href=../amp/#new-feature title="Permanent link"> </a></h4> <ul> <li>Add file engine settings: <code class=syntax>engine_file_empty_if_not_exists</code> and <code class=syntax>engine_file_truncate_on_insert</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20620 rel="external nofollow noreferrer" target=_blank>#20620</a> (<a href=https://github.com/M0r64n rel="external nofollow noreferrer" target=_blank>M0r64n</a>).</li> <li>Add aggregate function <code class=syntax>deltaSum</code> for summing the differences between consecutive rows. <a href=https://github.com/ClickHouse/ClickHouse/pull/20057 rel="external nofollow noreferrer" target=_blank>#20057</a> (<a href=https://github.com/rf rel="external nofollow noreferrer" target=_blank>Russ Frank</a>).</li> <li>New <code class=syntax>event_time_microseconds</code> column in <code class=syntax>system.part_log</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/20027 rel="external nofollow noreferrer" target=_blank>#20027</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Added <code class=syntax>timezoneOffset(datetime)</code> function which will give the offset from UTC in seconds. This close <a href=https://github.com/ClickHouse/ClickHouse/issues/19850 rel="external nofollow noreferrer" target=_blank>#issue:19850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19962 rel="external nofollow noreferrer" target=_blank>#19962</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> <li>Add setting <code class=syntax>insert_shard_id</code> to support insert data into specific shard from distributed table. <a href=https://github.com/ClickHouse/ClickHouse/pull/19961 rel="external nofollow noreferrer" target=_blank>#19961</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Function <code class=syntax>reinterpretAs</code> updated to support big integers. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19691 rel="external nofollow noreferrer" target=_blank>#19691</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19858 rel="external nofollow noreferrer" target=_blank>#19858</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added Server Side Encryption Customer Keys (the <code class=syntax>x-amz-server-side-encryption-customer-(key/md5)</code> header) support in S3 client. See <a href=https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html rel="external nofollow noreferrer" target=_blank>the link</a>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19428 rel="external nofollow noreferrer" target=_blank>#19428</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19748 rel="external nofollow noreferrer" target=_blank>#19748</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Added <code class=syntax>implicit_key</code> option for <code class=syntax>executable</code> dictionary source. It allows to avoid printing key for every record if records comes in the same order as the input keys. Implements <a href=https://github.com/ClickHouse/ClickHouse/issues/14527 rel="external nofollow noreferrer" target=_blank>#14527</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19677 rel="external nofollow noreferrer" target=_blank>#19677</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add quota type <code class=syntax>query_selects</code> and <code class=syntax>query_inserts</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19603 rel="external nofollow noreferrer" target=_blank>#19603</a> (<a href=https://github.com/JackyWoo rel="external nofollow noreferrer" target=_blank>JackyWoo</a>).</li> <li>Add function <code class=syntax>extractTextFromHTML</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/19600 rel="external nofollow noreferrer" target=_blank>#19600</a> (<a href=https://github.com/zlx19950903 rel="external nofollow noreferrer" target=_blank>zlx19950903</a>), (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Tables with <code class=syntax>MergeTree*</code> engine now have two new table-level settings for query concurrency control. Setting <code class=syntax>max_concurrent_queries</code> limits the number of concurrently executed queries which are related to this table. Setting <code class=syntax>min_marks_to_honor_max_concurrent_queries</code> tells to apply previous setting only if query reads at least this number of marks. <a href=https://github.com/ClickHouse/ClickHouse/pull/19544 rel="external nofollow noreferrer" target=_blank>#19544</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added <code class=syntax>file</code> function to read file from user_files directory as a String. This is different from the <code class=syntax>file</code> table function. This implements <a href=https://github.com/ClickHouse/ClickHouse/issues/18851 rel="external nofollow noreferrer" target=_blank>#issue:18851</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19204 rel="external nofollow noreferrer" target=_blank>#19204</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> </ul> <h4 id=experimental-feature>Experimental feature<a class=headerlink href=../amp/#experimental-feature title="Permanent link"> </a></h4> <ul> <li>Add experimental <code class=syntax>Replicated</code> database engine. It replicates DDL queries across multiple hosts. <a href=https://github.com/ClickHouse/ClickHouse/pull/16193 rel="external nofollow noreferrer" target=_blank>#16193</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Introduce experimental support for window functions, enabled with <code class=syntax>allow_experimental_functions = 1</code>. This is a preliminary, alpha-quality implementation that is not suitable for production use and will change in backward-incompatible ways in future releases. Please see <a href=https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/sql-reference/window-functions/index.md#experimental-window-functions rel="external nofollow noreferrer" target=_blank>the documentation</a> for the list of supported features. <a href=https://github.com/ClickHouse/ClickHouse/pull/20337 rel="external nofollow noreferrer" target=_blank>#20337</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Add the ability to backup/restore metadata files for DiskS3. <a href=https://github.com/ClickHouse/ClickHouse/pull/18377 rel="external nofollow noreferrer" target=_blank>#18377</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> </ul> <h4 id=performance-improvement>Performance Improvement<a class=headerlink href=../amp/#performance-improvement title="Permanent link"> </a></h4> <ul> <li>Hedged requests for remote queries. When setting <code class=syntax>use_hedged_requests</code> enabled (off by default), allow to establish many connections with different replicas for query. New connection is enabled in case existent connection(s) with replica(s) were not established within <code class=syntax>hedged_connection_timeout</code> or no data was received within <code class=syntax>receive_data_timeout</code>. Query uses the first connection which send non empty progress packet (or data packet, if <code class=syntax>allow_changing_replica_until_first_data_packet</code>); other connections are cancelled. Queries with <code class=syntax>max_parallel_replicas &gt; 1</code> are supported. <a href=https://github.com/ClickHouse/ClickHouse/pull/19291 rel="external nofollow noreferrer" target=_blank>#19291</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>). This allows to significantly reduce tail latencies on very large clusters.</li> <li>Added support for <code class=syntax>PREWHERE</code> (and enable the corresponding optimization) when tables have row-level security expressions specified. <a href=https://github.com/ClickHouse/ClickHouse/pull/19576 rel="external nofollow noreferrer" target=_blank>#19576</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>The setting <code class=syntax>distributed_aggregation_memory_efficient</code> is enabled by default. It will lower memory usage and improve performance of distributed queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/20599 rel="external nofollow noreferrer" target=_blank>#20599</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve performance of GROUP BY multiple fixed size keys. <a href=https://github.com/ClickHouse/ClickHouse/pull/20472 rel="external nofollow noreferrer" target=_blank>#20472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve performance of aggregate functions by more strict aliasing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19946 rel="external nofollow noreferrer" target=_blank>#19946</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Speed up reading from <code class=syntax>Memory</code> tables in extreme cases (when reading speed is in order of 50 GB/sec) by simplification of pipeline and (consequently) less lock contention in pipeline scheduling. <a href=https://github.com/ClickHouse/ClickHouse/pull/20468 rel="external nofollow noreferrer" target=_blank>#20468</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Partially reimplement HTTP server to make it making less copies of incoming and outgoing data. It gives up to 1.5 performance improvement on inserting long records over HTTP. <a href=https://github.com/ClickHouse/ClickHouse/pull/19516 rel="external nofollow noreferrer" target=_blank>#19516</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Add <code class=syntax>compress</code> setting for <code class=syntax>Memory</code> tables. If it's enabled the table will use less RAM. On some machines and datasets it can also work faster on SELECT, but it is not always the case. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20093 rel="external nofollow noreferrer" target=_blank>#20093</a>. Note: there are reasons why Memory tables can work slower than MergeTree: (1) lack of compression (2) static size of blocks (3) lack of indices and prewhere... <a href=https://github.com/ClickHouse/ClickHouse/pull/20168 rel="external nofollow noreferrer" target=_blank>#20168</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Slightly better code in aggregation. <a href=https://github.com/ClickHouse/ClickHouse/pull/20978 rel="external nofollow noreferrer" target=_blank>#20978</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add back <code class=syntax>intDiv</code>/<code class=syntax>modulo</code> specializations for better performance. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21293 rel="external nofollow noreferrer" target=_blank>#21293</a> . The regression was introduced in <a href=https://github.com/ClickHouse/ClickHouse/pull/18145 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/18145</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/21307 rel="external nofollow noreferrer" target=_blank>#21307</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Do not squash blocks too much on INSERT SELECT if inserting into Memory table. In previous versions inefficient data representation was created in Memory table after INSERT SELECT. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13052 rel="external nofollow noreferrer" target=_blank>#13052</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20169 rel="external nofollow noreferrer" target=_blank>#20169</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix at least one case when DataType parser may have exponential complexity (found by fuzzer). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20096 rel="external nofollow noreferrer" target=_blank>#20096</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20132 rel="external nofollow noreferrer" target=_blank>#20132</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improved performance of bitmap columns during joins. <a href=https://github.com/ClickHouse/ClickHouse/pull/19407 rel="external nofollow noreferrer" target=_blank>#19407</a> (<a href=https://github.com/templarzq rel="external nofollow noreferrer" target=_blank>templarzq</a>).</li> <li>Parallelize SELECT with FINAL for single part with level &gt; 0 when <code class=syntax>do_not_merge_across_partitions_select_final</code> setting is 1. <a href=https://github.com/ClickHouse/ClickHouse/pull/19375 rel="external nofollow noreferrer" target=_blank>#19375</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Fill only requested columns when querying <code class=syntax>system.parts</code> and <code class=syntax>system.parts_columns</code>. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19570 rel="external nofollow noreferrer" target=_blank>#19570</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21035 rel="external nofollow noreferrer" target=_blank>#21035</a> (<a href=https://github.com/anmolarora rel="external nofollow noreferrer" target=_blank>Anmol Arora</a>).</li> <li>Perform algebraic optimizations of arithmetic expressions inside <code class=syntax>avg</code> aggregate function. close <a href=https://github.com/ClickHouse/ClickHouse/issues/20092 rel="external nofollow noreferrer" target=_blank>#20092</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20183 rel="external nofollow noreferrer" target=_blank>#20183</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> </ul> <h4 id=improvement>Improvement<a class=headerlink href=../amp/#improvement title="Permanent link"> </a></h4> <ul> <li>Add two settings to delay or throw error during insertion when there are too many inactive parts. This is useful when server fails to clean up parts quickly enough. <a href=https://github.com/ClickHouse/ClickHouse/pull/20178 rel="external nofollow noreferrer" target=_blank>#20178</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Provide better compatibility for mysql clients. 1. mysql jdbc 2. mycli. <a href=https://github.com/ClickHouse/ClickHouse/pull/21367 rel="external nofollow noreferrer" target=_blank>#21367</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Forbid to drop a column if it's referenced by materialized view. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21164 rel="external nofollow noreferrer" target=_blank>#21164</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21303 rel="external nofollow noreferrer" target=_blank>#21303</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>MySQL dictionary source will now retry unexpected connection failures (Lost connection to MySQL server during query) which sometimes happen on SSL/TLS connections. <a href=https://github.com/ClickHouse/ClickHouse/pull/21237 rel="external nofollow noreferrer" target=_blank>#21237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>Usability improvement: more consistent <code class=syntax>DateTime64</code> parsing: recognize the case when unix timestamp with subsecond resolution is specified as scaled integer (like <code class=syntax>1111111111222</code> instead of <code class=syntax>1111111111.222</code>). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13194 rel="external nofollow noreferrer" target=_blank>#13194</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21053 rel="external nofollow noreferrer" target=_blank>#21053</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Do only merging of sorted blocks on initiator with distributed_group_by_no_merge. <a href=https://github.com/ClickHouse/ClickHouse/pull/20882 rel="external nofollow noreferrer" target=_blank>#20882</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>When loading config for mysql source ClickHouse will now randomize the list of replicas with the same priority to ensure the round-robin logics of picking mysql endpoint. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20629 rel="external nofollow noreferrer" target=_blank>#20629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20632 rel="external nofollow noreferrer" target=_blank>#20632</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>Function 'reinterpretAs(x, Type)' renamed into 'reinterpret(x, Type)'. <a href=https://github.com/ClickHouse/ClickHouse/pull/20611 rel="external nofollow noreferrer" target=_blank>#20611</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Support vhost for RabbitMQ engine <a href=https://github.com/ClickHouse/ClickHouse/issues/20576 rel="external nofollow noreferrer" target=_blank>#20576</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20596 rel="external nofollow noreferrer" target=_blank>#20596</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Improved serialization for data types combined of Arrays and Tuples. Improved matching enum data types to protobuf enum type. Fixed serialization of the <code class=syntax>Map</code> data type. Omitted values are now set by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/20506 rel="external nofollow noreferrer" target=_blank>#20506</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fixed race between execution of distributed DDL tasks and cleanup of DDL queue. Now DDL task cannot be removed from ZooKeeper if there are active workers. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20016 rel="external nofollow noreferrer" target=_blank>#20016</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20448 rel="external nofollow noreferrer" target=_blank>#20448</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Make FQDN and other DNS related functions work correctly in alpine images. <a href=https://github.com/ClickHouse/ClickHouse/pull/20336 rel="external nofollow noreferrer" target=_blank>#20336</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Do not allow early constant folding of explicitly forbidden functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/20303 rel="external nofollow noreferrer" target=_blank>#20303</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Implicit conversion from integer to Decimal type might succeeded if integer value doe not fit into Decimal type. Now it throws <code class=syntax>ARGUMENT_OUT_OF_BOUND</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20232 rel="external nofollow noreferrer" target=_blank>#20232</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Lockless <code class=syntax>SYSTEM FLUSH DISTRIBUTED</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20215 rel="external nofollow noreferrer" target=_blank>#20215</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Normalize count(constant), sum(1) to count(). This is needed for projection query routing. <a href=https://github.com/ClickHouse/ClickHouse/pull/20175 rel="external nofollow noreferrer" target=_blank>#20175</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Support all native integer types in bitmap functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/20171 rel="external nofollow noreferrer" target=_blank>#20171</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Updated <code class=syntax>CacheDictionary</code>, <code class=syntax>ComplexCacheDictionary</code>, <code class=syntax>SSDCacheDictionary</code>, <code class=syntax>SSDComplexKeyDictionary</code> to use LRUHashMap as underlying index. <a href=https://github.com/ClickHouse/ClickHouse/pull/20164 rel="external nofollow noreferrer" target=_blank>#20164</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>The setting <code class=syntax>access_management</code> is now configurable on startup by providing <code class=syntax>CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT</code>, defaults to disabled (<code class=syntax>0</code>) which was the prior value. <a href=https://github.com/ClickHouse/ClickHouse/pull/20139 rel="external nofollow noreferrer" target=_blank>#20139</a> (<a href=https://github.com/sonirico rel="external nofollow noreferrer" target=_blank>Marquitos</a>).</li> <li>Fix toDateTime64(toDate()/toDateTime()) for DateTime64 - Implement DateTime64 clamping to match DateTime behaviour. <a href=https://github.com/ClickHouse/ClickHouse/pull/20131 rel="external nofollow noreferrer" target=_blank>#20131</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Quota improvements: SHOW TABLES is now considered as one query in the quota calculations, not two queries. SYSTEM queries now consume quota. Fix calculation of interval's end in quota consumption. <a href=https://github.com/ClickHouse/ClickHouse/pull/20106 rel="external nofollow noreferrer" target=_blank>#20106</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Supports <code class=syntax>path IN (set)</code> expressions for <code class=syntax>system.zookeeper</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/20105 rel="external nofollow noreferrer" target=_blank>#20105</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>).</li> <li>Show full details of <code class=syntax>MaterializeMySQL</code> tables in <code class=syntax>system.tables</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20051 rel="external nofollow noreferrer" target=_blank>#20051</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Fix data race in executable dictionary that was possible only on misuse (when the script returns data ignoring its input). <a href=https://github.com/ClickHouse/ClickHouse/pull/20045 rel="external nofollow noreferrer" target=_blank>#20045</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>The value of MYSQL_OPT_RECONNECT option can now be controlled by "opt_reconnect" parameter in the config section of mysql replica. <a href=https://github.com/ClickHouse/ClickHouse/pull/19998 rel="external nofollow noreferrer" target=_blank>#19998</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>If user calls <code class=syntax>JSONExtract</code> function with <code class=syntax>Float32</code> type requested, allow inaccurate conversion to the result type. For example the number <code class=syntax>0.1</code> in JSON is double precision and is not representable in Float32, but the user still wants to get it. Previous versions return 0 for non-Nullable type and NULL for Nullable type to indicate that conversion is imprecise. The logic was 100% correct but it was surprising to users and leading to questions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/13962 rel="external nofollow noreferrer" target=_blank>#13962</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19960 rel="external nofollow noreferrer" target=_blank>#19960</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add conversion of block structure for INSERT into Distributed tables if it does not match. <a href=https://github.com/ClickHouse/ClickHouse/pull/19947 rel="external nofollow noreferrer" target=_blank>#19947</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Improvement for the <code class=syntax>system.distributed_ddl_queue</code> table. Initialize MaxDDLEntryID to the last value after restarting. Before this PR, MaxDDLEntryID will remain zero until a new DDLTask is processed. <a href=https://github.com/ClickHouse/ClickHouse/pull/19924 rel="external nofollow noreferrer" target=_blank>#19924</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Show <code class=syntax>MaterializeMySQL</code> tables in <code class=syntax>system.parts</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19770 rel="external nofollow noreferrer" target=_blank>#19770</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Add separate config directive for <code class=syntax>Buffer</code> profile. <a href=https://github.com/ClickHouse/ClickHouse/pull/19721 rel="external nofollow noreferrer" target=_blank>#19721</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Move conditions that are not related to JOIN to WHERE clause. <a href=https://github.com/ClickHouse/ClickHouse/issues/18720 rel="external nofollow noreferrer" target=_blank>#18720</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19685 rel="external nofollow noreferrer" target=_blank>#19685</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Add ability to throttle INSERT into Distributed based on amount of pending bytes for async send (<code class=syntax>bytes_to_delay_insert</code>/<code class=syntax>max_delay_to_insert</code> and <code class=syntax>bytes_to_throw_insert</code> settings for <code class=syntax>Distributed</code> engine has been added). <a href=https://github.com/ClickHouse/ClickHouse/pull/19673 rel="external nofollow noreferrer" target=_blank>#19673</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix some rare cases when write errors can be ignored in destructors. <a href=https://github.com/ClickHouse/ClickHouse/pull/19451 rel="external nofollow noreferrer" target=_blank>#19451</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Print inline frames in stack traces for fatal errors. <a href=https://github.com/ClickHouse/ClickHouse/pull/19317 rel="external nofollow noreferrer" target=_blank>#19317</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> </ul> <h4 id=bug-fix>Bug Fix<a class=headerlink href=../amp/#bug-fix title="Permanent link"> </a></h4> <ul> <li>Fix a deadlock in <code class=syntax>ALTER DELETE</code> mutations for non replicated MergeTree table engines when the predicate contains the table itself. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20558 rel="external nofollow noreferrer" target=_blank>#20558</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21477 rel="external nofollow noreferrer" target=_blank>#21477</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix SIGSEGV for distributed queries on failures. <a href=https://github.com/ClickHouse/ClickHouse/pull/21434 rel="external nofollow noreferrer" target=_blank>#21434</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Now <code class=syntax>ALTER MODIFY COLUMN</code> queries will correctly affect changes in partition key, skip indices, TTLs, and so on. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13675 rel="external nofollow noreferrer" target=_blank>#13675</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21334 rel="external nofollow noreferrer" target=_blank>#21334</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix bug with <code class=syntax>join_use_nulls</code> and joining <code class=syntax>TOTALS</code> from subqueries. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19362 rel="external nofollow noreferrer" target=_blank>#19362</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/21137 rel="external nofollow noreferrer" target=_blank>#21137</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21248 rel="external nofollow noreferrer" target=_blank>#21248</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fix crash in <code class=syntax>EXPLAIN</code> for query with <code class=syntax>UNION</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20876 rel="external nofollow noreferrer" target=_blank>#20876</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/21170 rel="external nofollow noreferrer" target=_blank>#21170</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21246 rel="external nofollow noreferrer" target=_blank>#21246</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Now mutations allowed only for table engines that support them (MergeTree family, Memory, MaterializedView). Other engines will report a more clear error. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21168 rel="external nofollow noreferrer" target=_blank>#21168</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21183 rel="external nofollow noreferrer" target=_blank>#21183</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21112 rel="external nofollow noreferrer" target=_blank>#21112</a>. Fixed bug that could cause duplicates with insert query (if one of the callbacks came a little too late). <a href=https://github.com/ClickHouse/ClickHouse/pull/21138 rel="external nofollow noreferrer" target=_blank>#21138</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Fix <code class=syntax>input_format_null_as_default</code> take effective when types are nullable. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21116 rel="external nofollow noreferrer" target=_blank>#21116</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/21121 rel="external nofollow noreferrer" target=_blank>#21121</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>fix bug related to cast Tuple to Map. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/21029 rel="external nofollow noreferrer" target=_blank>#21029</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21120 rel="external nofollow noreferrer" target=_blank>#21120</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix the metadata leak when the Replicated*MergeTree with custom (non default) ZooKeeper cluster is dropped. <a href=https://github.com/ClickHouse/ClickHouse/pull/21119 rel="external nofollow noreferrer" target=_blank>#21119</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix type mismatch issue when using LowCardinality keys in joinGet. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/21114 rel="external nofollow noreferrer" target=_blank>#21114</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21117 rel="external nofollow noreferrer" target=_blank>#21117</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>fix default_replica_path and default_replica_name values are useless on Replicated(*)MergeTree engine when the engine needs specify other parameters. <a href=https://github.com/ClickHouse/ClickHouse/pull/21060 rel="external nofollow noreferrer" target=_blank>#21060</a> (<a href=https://github.com/mxzlxy rel="external nofollow noreferrer" target=_blank>mxzlxy</a>).</li> <li>Out of bound memory access was possible when formatting specifically crafted out of range value of type <code class=syntax>DateTime64</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20494 rel="external nofollow noreferrer" target=_blank>#20494</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20543 rel="external nofollow noreferrer" target=_blank>#20543</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/21023 rel="external nofollow noreferrer" target=_blank>#21023</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Block parallel insertions into storage join. <a href=https://github.com/ClickHouse/ClickHouse/pull/21009 rel="external nofollow noreferrer" target=_blank>#21009</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fixed behaviour, when <code class=syntax>ALTER MODIFY COLUMN</code> created mutation, that will knowingly fail. <a href=https://github.com/ClickHouse/ClickHouse/pull/21007 rel="external nofollow noreferrer" target=_blank>#21007</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9969 rel="external nofollow noreferrer" target=_blank>#9969</a>. Fixed Brotli http compression error, which reproduced for large data sizes, slightly complicated structure and with json output format. Update Brotli to the latest version to include the "fix rare access to uninitialized data in ring-buffer". <a href=https://github.com/ClickHouse/ClickHouse/pull/20991 rel="external nofollow noreferrer" target=_blank>#20991</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Fix 'Empty task was returned from async task queue' on query cancellation. <a href=https://github.com/ClickHouse/ClickHouse/pull/20881 rel="external nofollow noreferrer" target=_blank>#20881</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>USE database;</code> query did not work when using MySQL 5.7 client to connect to ClickHouse server, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18926 rel="external nofollow noreferrer" target=_blank>#18926</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20878 rel="external nofollow noreferrer" target=_blank>#20878</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix usage of <code class=syntax>-Distinct</code> combinator with <code class=syntax>-State</code> combinator in aggregate functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/20866 rel="external nofollow noreferrer" target=_blank>#20866</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix subquery with union distinct and limit clause. close <a href=https://github.com/ClickHouse/ClickHouse/issues/20597 rel="external nofollow noreferrer" target=_blank>#20597</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20610 rel="external nofollow noreferrer" target=_blank>#20610</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fixed inconsistent behavior of dictionary in case of queries where we look for absent keys in dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/20578 rel="external nofollow noreferrer" target=_blank>#20578</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix the number of threads for scalar subqueries and subqueries for index (after <a href=https://github.com/ClickHouse/ClickHouse/issues/19007 rel="external nofollow noreferrer" target=_blank>#19007</a> single thread was always used). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20457 rel="external nofollow noreferrer" target=_blank>#20457</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/20512 rel="external nofollow noreferrer" target=_blank>#20512</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20550 rel="external nofollow noreferrer" target=_blank>#20550</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix crash which could happen if unknown packet was received from remove query (was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/17868 rel="external nofollow noreferrer" target=_blank>#17868</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/20547 rel="external nofollow noreferrer" target=_blank>#20547</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add proper checks while parsing directory names for async INSERT (fixes SIGSEGV). <a href=https://github.com/ClickHouse/ClickHouse/pull/20498 rel="external nofollow noreferrer" target=_blank>#20498</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix function <code class=syntax>transform</code> does not work properly for floating point keys. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20460 rel="external nofollow noreferrer" target=_blank>#20460</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20479 rel="external nofollow noreferrer" target=_blank>#20479</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Fix infinite loop when propagating WITH aliases to subqueries. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20388 rel="external nofollow noreferrer" target=_blank>#20388</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20476 rel="external nofollow noreferrer" target=_blank>#20476</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix abnormal server termination when http client goes away. <a href=https://github.com/ClickHouse/ClickHouse/pull/20464 rel="external nofollow noreferrer" target=_blank>#20464</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix <code class=syntax>LOGICAL_ERROR</code> for <code class=syntax>join_use_nulls=1</code> when JOIN contains const from SELECT. <a href=https://github.com/ClickHouse/ClickHouse/pull/20461 rel="external nofollow noreferrer" target=_blank>#20461</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Check if table function <code class=syntax>view</code> is used in expression list and throw an error. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20342 rel="external nofollow noreferrer" target=_blank>#20342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20350 rel="external nofollow noreferrer" target=_blank>#20350</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Avoid invalid dereference in RANGE_HASHED() dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/20345 rel="external nofollow noreferrer" target=_blank>#20345</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix null dereference with <code class=syntax>join_use_nulls=1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20344 rel="external nofollow noreferrer" target=_blank>#20344</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix incorrect result of binary operations between two constant decimals of different scale. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20283 rel="external nofollow noreferrer" target=_blank>#20283</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20339 rel="external nofollow noreferrer" target=_blank>#20339</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fix too often retries of failed background tasks for <code class=syntax>ReplicatedMergeTree</code> table engines family. This could lead to too verbose logging and increased CPU load. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20203 rel="external nofollow noreferrer" target=_blank>#20203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20335 rel="external nofollow noreferrer" target=_blank>#20335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Restrict to <code class=syntax>DROP</code> or <code class=syntax>RENAME</code> version column of <code class=syntax>*CollapsingMergeTree</code> and <code class=syntax>ReplacingMergeTree</code> table engines. <a href=https://github.com/ClickHouse/ClickHouse/pull/20300 rel="external nofollow noreferrer" target=_blank>#20300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed the behavior when in case of broken JSON we tried to read the whole file into memory which leads to exception from the allocator. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19719 rel="external nofollow noreferrer" target=_blank>#19719</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20286 rel="external nofollow noreferrer" target=_blank>#20286</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix exception during vertical merge for <code class=syntax>MergeTree</code> table engines family which don't allow to perform vertical merges. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20259 rel="external nofollow noreferrer" target=_blank>#20259</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20279 rel="external nofollow noreferrer" target=_blank>#20279</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix rare server crash on config reload during the shutdown. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19689 rel="external nofollow noreferrer" target=_blank>#19689</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20224 rel="external nofollow noreferrer" target=_blank>#20224</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix CTE when using in INSERT SELECT. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20187 rel="external nofollow noreferrer" target=_blank>#20187</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/20195 rel="external nofollow noreferrer" target=_blank>#20195</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20211 rel="external nofollow noreferrer" target=_blank>#20211</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19314 rel="external nofollow noreferrer" target=_blank>#19314</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20156 rel="external nofollow noreferrer" target=_blank>#20156</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>fix toMinute function to handle special timezone correctly. <a href=https://github.com/ClickHouse/ClickHouse/pull/20149 rel="external nofollow noreferrer" target=_blank>#20149</a> (<a href=https://github.com/keen-wolf rel="external nofollow noreferrer" target=_blank>keenwolf</a>).</li> <li>Fix server crash after query with <code class=syntax>if</code> function with <code class=syntax>Tuple</code> type of then/else branches result. <code class=syntax>Tuple</code> type must contain <code class=syntax>Array</code> or another complex type. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18356 rel="external nofollow noreferrer" target=_blank>#18356</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20133 rel="external nofollow noreferrer" target=_blank>#20133</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>The <code class=syntax>MongoDB</code> table engine now establishes connection only when it's going to read data. <code class=syntax>ATTACH TABLE</code> won't try to connect anymore. <a href=https://github.com/ClickHouse/ClickHouse/pull/20110 rel="external nofollow noreferrer" target=_blank>#20110</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Bugfix in StorageJoin. <a href=https://github.com/ClickHouse/ClickHouse/pull/20079 rel="external nofollow noreferrer" target=_blank>#20079</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Fix the case when calculating modulo of division of negative number by small divisor, the resulting data type was not large enough to accomodate the negative result. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/20052 rel="external nofollow noreferrer" target=_blank>#20052</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20067 rel="external nofollow noreferrer" target=_blank>#20067</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>MaterializeMySQL: Fix replication for statements that update several tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/20066 rel="external nofollow noreferrer" target=_blank>#20066</a> (<a href=https://github.com/havardk rel="external nofollow noreferrer" target=_blank>Håvard Kvålen</a>).</li> <li>Prevent "Connection refused" in docker during initialization script execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/20012 rel="external nofollow noreferrer" target=_blank>#20012</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li><code class=syntax>EmbeddedRocksDB</code> is an experimental storage. Fix the issue with lack of proper type checking. Simplified code. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19967 rel="external nofollow noreferrer" target=_blank>#19967</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19972 rel="external nofollow noreferrer" target=_blank>#19972</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix a segfault in function <code class=syntax>fromModifiedJulianDay</code> when the argument type is <code class=syntax>Nullable(T)</code> for any integral types other than Int32. <a href=https://github.com/ClickHouse/ClickHouse/pull/19959 rel="external nofollow noreferrer" target=_blank>#19959</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>BloomFilter index crash fix. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19757 rel="external nofollow noreferrer" target=_blank>#19757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19884 rel="external nofollow noreferrer" target=_blank>#19884</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Deadlock was possible if system.text_log is enabled. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19874 rel="external nofollow noreferrer" target=_blank>#19874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19875 rel="external nofollow noreferrer" target=_blank>#19875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix starting the server with tables having default expressions containing dictGet(). Allow getting return type of dictGet() without loading dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/19805 rel="external nofollow noreferrer" target=_blank>#19805</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix clickhouse-client abort exception while executing only <code class=syntax>select</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19790 rel="external nofollow noreferrer" target=_blank>#19790</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> <li>Fix a bug that moving pieces to destination table may failed in case of launching multiple clickhouse-copiers. <a href=https://github.com/ClickHouse/ClickHouse/pull/19743 rel="external nofollow noreferrer" target=_blank>#19743</a> (<a href=https://github.com/mdianjun rel="external nofollow noreferrer" target=_blank>madianjun</a>).</li> <li>Background thread which executes <code class=syntax>ON CLUSTER</code> queries might hang waiting for dropped replicated table to do something. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/19684 rel="external nofollow noreferrer" target=_blank>#19684</a> (<a href=https://github.com/yiguolei rel="external nofollow noreferrer" target=_blank>yiguolei</a>).</li> </ul> <h4 id=build-testing-packaging-improvement>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement title="Permanent link"> </a></h4> <ul> <li>Allow to build ClickHouse with AVX-2 enabled globally. It gives slight performance benefits on modern CPUs. Not recommended for production and will not be supported as official build for now. <a href=https://github.com/ClickHouse/ClickHouse/pull/20180 rel="external nofollow noreferrer" target=_blank>#20180</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix some of the issues found by Coverity. See <a href=https://github.com/ClickHouse/ClickHouse/issues/19964 rel="external nofollow noreferrer" target=_blank>#19964</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20010 rel="external nofollow noreferrer" target=_blank>#20010</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow to start up with modified binary under gdb. In previous version if you set up breakpoint in gdb before start, server will refuse to start up due to failed integrity check. <a href=https://github.com/ClickHouse/ClickHouse/pull/21258 rel="external nofollow noreferrer" target=_blank>#21258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add a test for different compression methods in Kafka. <a href=https://github.com/ClickHouse/ClickHouse/pull/21111 rel="external nofollow noreferrer" target=_blank>#21111</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fixed port clash from test_storage_kerberized_hdfs test. <a href=https://github.com/ClickHouse/ClickHouse/pull/19974 rel="external nofollow noreferrer" target=_blank>#19974</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Print <code class=syntax>stdout</code> and <code class=syntax>stderr</code> to log when failed to start docker in integration tests. Before this PR there was a very short error message in this case which didn't help to investigate the problems. <a href=https://github.com/ClickHouse/ClickHouse/pull/20631 rel="external nofollow noreferrer" target=_blank>#20631</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> </ul> <h2 id=clickhouse-release-21-2>ClickHouse release 21.2<a class=headerlink href=../amp/#clickhouse-release-21-2 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v21-2-2-8-stable-2021-02-07>ClickHouse release v21.2.2.8-stable, 2021-02-07<a class=headerlink href=../amp/#clickhouse-release-v21-2-2-8-stable-2021-02-07 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change_1>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change_1 title="Permanent link"> </a></h4> <ul> <li>Bitwise functions (<code class=syntax>bitAnd</code>, <code class=syntax>bitOr</code>, etc) are forbidden for floating point arguments. Now you have to do explicit cast to integer. <a href=https://github.com/ClickHouse/ClickHouse/pull/19853 rel="external nofollow noreferrer" target=_blank>#19853</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Forbid <code class=syntax>lcm</code>/<code class=syntax>gcd</code> for floats. <a href=https://github.com/ClickHouse/ClickHouse/pull/19532 rel="external nofollow noreferrer" target=_blank>#19532</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix memory tracking for <code class=syntax>OPTIMIZE TABLE</code>/merges; account query memory limits and sampling for <code class=syntax>OPTIMIZE TABLE</code>/merges. <a href=https://github.com/ClickHouse/ClickHouse/pull/18772 rel="external nofollow noreferrer" target=_blank>#18772</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Disallow floating point column as partition key, see <a href=https://github.com/ClickHouse/ClickHouse/issues/18421#event-4147046255 rel="external nofollow noreferrer" target=_blank>#18421</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18464 rel="external nofollow noreferrer" target=_blank>#18464</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Excessive parenthesis in type definitions no longer supported, example: <code class=syntax>Array((UInt8))</code>.</li> </ul> <h4 id=new-feature_1>New Feature<a class=headerlink href=../amp/#new-feature_1 title="Permanent link"> </a></h4> <ul> <li>Added <code class=syntax>PostgreSQL</code> table engine (both select/insert, with support for multidimensional arrays), also as table function. Added <code class=syntax>PostgreSQL</code> dictionary source. Added <code class=syntax>PostgreSQL</code> database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/18554 rel="external nofollow noreferrer" target=_blank>#18554</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Data type <code class=syntax>Nested</code> now supports arbitrary levels of nesting. Introduced subcolumns of complex types, such as <code class=syntax>size0</code> in <code class=syntax>Array</code>, <code class=syntax>null</code> in <code class=syntax>Nullable</code>, names of <code class=syntax>Tuple</code> elements, which can be read without reading of whole column. <a href=https://github.com/ClickHouse/ClickHouse/pull/17310 rel="external nofollow noreferrer" target=_blank>#17310</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Added <code class=syntax>Nullable</code> support for <code class=syntax>FlatDictionary</code>, <code class=syntax>HashedDictionary</code>, <code class=syntax>ComplexKeyHashedDictionary</code>, <code class=syntax>DirectDictionary</code>, <code class=syntax>ComplexKeyDirectDictionary</code>, <code class=syntax>RangeHashedDictionary</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18236 rel="external nofollow noreferrer" target=_blank>#18236</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Adds a new table called <code class=syntax>system.distributed_ddl_queue</code> that displays the queries in the DDL worker queue. <a href=https://github.com/ClickHouse/ClickHouse/pull/17656 rel="external nofollow noreferrer" target=_blank>#17656</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Added support of mapping LDAP group names, and attribute values in general, to local roles for users from ldap user directories. <a href=https://github.com/ClickHouse/ClickHouse/pull/17211 rel="external nofollow noreferrer" target=_blank>#17211</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Support insert into table function <code class=syntax>cluster</code>, and for both table functions <code class=syntax>remote</code> and <code class=syntax>cluster</code>, support distributing data across nodes by specify sharding key. Close <a href=https://github.com/ClickHouse/ClickHouse/issues/16752 rel="external nofollow noreferrer" target=_blank>#16752</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18264 rel="external nofollow noreferrer" target=_blank>#18264</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add function <code class=syntax>decodeXMLComponent</code> to decode characters for XML. Example: <code class=syntax>SELECT decodeXMLComponent('Hello,&amp;quot;world&amp;quot;!')</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/17659 rel="external nofollow noreferrer" target=_blank>#17659</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18542 rel="external nofollow noreferrer" target=_blank>#18542</a> (<a href=https://github.com/nautaa rel="external nofollow noreferrer" target=_blank>nauta</a>).</li> <li>Added functions <code class=syntax>parseDateTimeBestEffortUSOrZero</code>, <code class=syntax>parseDateTimeBestEffortUSOrNull</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19712 rel="external nofollow noreferrer" target=_blank>#19712</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add <code class=syntax>sign</code> math function. <a href=https://github.com/ClickHouse/ClickHouse/pull/19527 rel="external nofollow noreferrer" target=_blank>#19527</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add information about used features (functions, table engines, etc) into system.query_log. <a href=https://github.com/ClickHouse/ClickHouse/issues/18495 rel="external nofollow noreferrer" target=_blank>#18495</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19371 rel="external nofollow noreferrer" target=_blank>#19371</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Function <code class=syntax>formatDateTime</code> support the <code class=syntax>%Q</code> modification to format date to quarter. <a href=https://github.com/ClickHouse/ClickHouse/pull/19224 rel="external nofollow noreferrer" target=_blank>#19224</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Support MetaKey+Enter hotkey binding in play UI. <a href=https://github.com/ClickHouse/ClickHouse/pull/19012 rel="external nofollow noreferrer" target=_blank>#19012</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Add three functions for map data type: 1. <code class=syntax>mapContains(map, key)</code> to check weather map.keys include the second parameter key. 2. <code class=syntax>mapKeys(map)</code> return all the keys in Array format 3. <code class=syntax>mapValues(map)</code> return all the values in Array format. <a href=https://github.com/ClickHouse/ClickHouse/pull/18788 rel="external nofollow noreferrer" target=_blank>#18788</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Add <code class=syntax>log_comment</code> setting related to <a href=https://github.com/ClickHouse/ClickHouse/issues/18494 rel="external nofollow noreferrer" target=_blank>#18494</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18549 rel="external nofollow noreferrer" target=_blank>#18549</a> (<a href=https://github.com/TszKitLo40 rel="external nofollow noreferrer" target=_blank>Zijie Lu</a>).</li> <li>Add support of tuple argument to <code class=syntax>argMin</code> and <code class=syntax>argMax</code> functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/17359 rel="external nofollow noreferrer" target=_blank>#17359</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>Support <code class=syntax>EXISTS VIEW</code> syntax. <a href=https://github.com/ClickHouse/ClickHouse/pull/18552 rel="external nofollow noreferrer" target=_blank>#18552</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Add <code class=syntax>SELECT ALL</code> syntax. closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18706 rel="external nofollow noreferrer" target=_blank>#18706</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18723 rel="external nofollow noreferrer" target=_blank>#18723</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> </ul> <h4 id=performance-improvement_1>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_1 title="Permanent link"> </a></h4> <ul> <li>Faster parts removal by lowering the number of <code class=syntax>stat</code> syscalls. This returns the optimization that existed while ago. More safe interface of <code class=syntax>IDisk</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19065 rel="external nofollow noreferrer" target=_blank>#19065</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19086 rel="external nofollow noreferrer" target=_blank>#19086</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Aliases declared in <code class=syntax>WITH</code> statement are properly used in index analysis. Queries like <code class=syntax>WITH column AS alias SELECT ... WHERE alias = ...</code> may use index now. <a href=https://github.com/ClickHouse/ClickHouse/pull/18896 rel="external nofollow noreferrer" target=_blank>#18896</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add <code class=syntax>optimize_alias_column_prediction</code> (on by default), that will: - Respect aliased columns in WHERE during partition pruning and skipping data using secondary indexes; - Respect aliased columns in WHERE for trivial count queries for optimize_trivial_count; - Respect aliased columns in GROUP BY/ORDER BY for optimize_aggregation_in_order/optimize_read_in_order. <a href=https://github.com/ClickHouse/ClickHouse/pull/16995 rel="external nofollow noreferrer" target=_blank>#16995</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Speed up aggregate function <code class=syntax>sum</code>. Improvement only visible on synthetic benchmarks and not very practical. <a href=https://github.com/ClickHouse/ClickHouse/pull/19216 rel="external nofollow noreferrer" target=_blank>#19216</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Update libc++ and use another ABI to provide better performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/18914 rel="external nofollow noreferrer" target=_blank>#18914</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>).</li> <li>Rewrite <code class=syntax>sumIf()</code> and <code class=syntax>sum(if())</code> function to <code class=syntax>countIf()</code> function when logically equivalent. <a href=https://github.com/ClickHouse/ClickHouse/pull/17041 rel="external nofollow noreferrer" target=_blank>#17041</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Use a connection pool for S3 connections, controlled by the <code class=syntax>s3_max_connections</code> settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/13405 rel="external nofollow noreferrer" target=_blank>#13405</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add support for zstd long option for better compression of string columns to save space. <a href=https://github.com/ClickHouse/ClickHouse/pull/17184 rel="external nofollow noreferrer" target=_blank>#17184</a> (<a href=https://github.com/ygrek rel="external nofollow noreferrer" target=_blank>ygrek</a>).</li> <li>Slightly improve server latency by removing access to configuration on every connection. <a href=https://github.com/ClickHouse/ClickHouse/pull/19863 rel="external nofollow noreferrer" target=_blank>#19863</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Reduce lock contention for multiple layers of the <code class=syntax>Buffer</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/19379 rel="external nofollow noreferrer" target=_blank>#19379</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Support splitting <code class=syntax>Filter</code> step of query plan into <code class=syntax>Expression + Filter</code> pair. Together with <code class=syntax>Expression + Expression</code> merging optimization (<a href=https://github.com/ClickHouse/ClickHouse/issues/17458 rel="external nofollow noreferrer" target=_blank>#17458</a>) it may delay execution for some expressions after <code class=syntax>Filter</code> step. <a href=https://github.com/ClickHouse/ClickHouse/pull/19253 rel="external nofollow noreferrer" target=_blank>#19253</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> </ul> <h4 id=improvement_1>Improvement<a class=headerlink href=../amp/#improvement_1 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>SELECT count() FROM table</code> now can be executed if only one any column can be selected from the <code class=syntax>table</code>. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10639 rel="external nofollow noreferrer" target=_blank>#10639</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18233 rel="external nofollow noreferrer" target=_blank>#18233</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Set charset to <code class=syntax>utf8mb4</code> when interacting with remote MySQL servers. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19795 rel="external nofollow noreferrer" target=_blank>#19795</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19800 rel="external nofollow noreferrer" target=_blank>#19800</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>S3</code> table function now supports <code class=syntax>auto</code> compression mode (autodetect). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18754 rel="external nofollow noreferrer" target=_blank>#18754</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19793 rel="external nofollow noreferrer" target=_blank>#19793</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Correctly output infinite arguments for <code class=syntax>formatReadableTimeDelta</code> function. In previous versions, there was implicit conversion to implementation specific integer value. <a href=https://github.com/ClickHouse/ClickHouse/pull/19791 rel="external nofollow noreferrer" target=_blank>#19791</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Table function <code class=syntax>S3</code> will use global region if the region can't be determined exactly. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10998 rel="external nofollow noreferrer" target=_blank>#10998</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19750 rel="external nofollow noreferrer" target=_blank>#19750</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>In distributed queries if the setting <code class=syntax>async_socket_for_remote</code> is enabled, it was possible to get stack overflow at least in debug build configuration if very deeply nested data type is used in table (e.g. <code class=syntax>Array(Array(Array(...more...)))</code>). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19108 rel="external nofollow noreferrer" target=_blank>#19108</a>. This change introduces minor backward incompatibility: excessive parenthesis in type definitions no longer supported, example: <code class=syntax>Array((UInt8))</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19736 rel="external nofollow noreferrer" target=_blank>#19736</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add separate pool for message brokers (RabbitMQ and Kafka). <a href=https://github.com/ClickHouse/ClickHouse/pull/19722 rel="external nofollow noreferrer" target=_blank>#19722</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix rare <code class=syntax>max_number_of_merges_with_ttl_in_pool</code> limit overrun (more merges with TTL can be assigned) for non-replicated MergeTree. <a href=https://github.com/ClickHouse/ClickHouse/pull/19708 rel="external nofollow noreferrer" target=_blank>#19708</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Dictionary: better error message during attribute parsing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19678 rel="external nofollow noreferrer" target=_blank>#19678</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add an option to disable validation of checksums on reading. Should never be used in production. Please do not expect any benefits in disabling it. It may only be used for experiments and benchmarks. The setting only applicable for tables of MergeTree family. Checksums are always validated for other table engines and when receiving data over network. In my observations there is no performance difference or it is less than 0.5%. <a href=https://github.com/ClickHouse/ClickHouse/pull/19588 rel="external nofollow noreferrer" target=_blank>#19588</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support constant result in function <code class=syntax>multiIf</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19533 rel="external nofollow noreferrer" target=_blank>#19533</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Enable function length/empty/notEmpty for datatype Map, which returns keys number in Map. <a href=https://github.com/ClickHouse/ClickHouse/pull/19530 rel="external nofollow noreferrer" target=_blank>#19530</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> <li>Add <code class=syntax>--reconnect</code> option to <code class=syntax>clickhouse-benchmark</code>. When this option is specified, it will reconnect before every request. This is needed for testing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19872 rel="external nofollow noreferrer" target=_blank>#19872</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support using the new location of <code class=syntax>.debug</code> file. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19348 rel="external nofollow noreferrer" target=_blank>#19348</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19520 rel="external nofollow noreferrer" target=_blank>#19520</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>toIPv6</code> function parses <code class=syntax>IPv4</code> addresses. <a href=https://github.com/ClickHouse/ClickHouse/pull/19518 rel="external nofollow noreferrer" target=_blank>#19518</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Add <code class=syntax>http_referer</code> field to <code class=syntax>system.query_log</code>, <code class=syntax>system.processes</code>, etc. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19389 rel="external nofollow noreferrer" target=_blank>#19389</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19390 rel="external nofollow noreferrer" target=_blank>#19390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Improve MySQL compatibility by making more functions case insensitive and adding aliases. <a href=https://github.com/ClickHouse/ClickHouse/pull/19387 rel="external nofollow noreferrer" target=_blank>#19387</a> (<a href=https://github.com/dankondr rel="external nofollow noreferrer" target=_blank>Daniil Kondratyev</a>).</li> <li>Add metrics for MergeTree parts (Wide/Compact/InMemory) types. <a href=https://github.com/ClickHouse/ClickHouse/pull/19381 rel="external nofollow noreferrer" target=_blank>#19381</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow docker to be executed with arbitrary uid. <a href=https://github.com/ClickHouse/ClickHouse/pull/19374 rel="external nofollow noreferrer" target=_blank>#19374</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fix wrong alignment of values of <code class=syntax>IPv4</code> data type in Pretty formats. They were aligned to the right, not to the left. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19184 rel="external nofollow noreferrer" target=_blank>#19184</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19339 rel="external nofollow noreferrer" target=_blank>#19339</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow change <code class=syntax>max_server_memory_usage</code> without restart. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18154 rel="external nofollow noreferrer" target=_blank>#18154</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19186 rel="external nofollow noreferrer" target=_blank>#19186</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>The exception when function <code class=syntax>bar</code> is called with certain NaN argument may be slightly misleading in previous versions. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19088 rel="external nofollow noreferrer" target=_blank>#19088</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19107 rel="external nofollow noreferrer" target=_blank>#19107</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server images. <a href=https://github.com/ClickHouse/ClickHouse/pull/19096 rel="external nofollow noreferrer" target=_blank>#19096</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Fixed <code class=syntax>PeekableReadBuffer: Memory limit exceed</code> error when inserting data with huge strings. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18690 rel="external nofollow noreferrer" target=_blank>#18690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18979 rel="external nofollow noreferrer" target=_blank>#18979</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Docker image: several improvements for clickhouse-server entrypoint. <a href=https://github.com/ClickHouse/ClickHouse/pull/18954 rel="external nofollow noreferrer" target=_blank>#18954</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Add <code class=syntax>normalizeQueryKeepNames</code> and <code class=syntax>normalizedQueryHashKeepNames</code> to normalize queries without masking long names with <code class=syntax>?</code>. This helps better analyze complex query logs. <a href=https://github.com/ClickHouse/ClickHouse/pull/18910 rel="external nofollow noreferrer" target=_blank>#18910</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Check per-block checksum of the distributed batch on the sender before sending (without reading the file twice, the checksums will be verified while reading), this will avoid stuck of the INSERT on the receiver (on truncated .bin file on the sender). Avoid reading .bin files twice for batched INSERT (it was required to calculate rows/bytes to take squashing into account, now this information included into the header, backward compatible is preserved). <a href=https://github.com/ClickHouse/ClickHouse/pull/18853 rel="external nofollow noreferrer" target=_blank>#18853</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix issues with RIGHT and FULL JOIN of tables with aggregate function states. In previous versions exception about <code class=syntax>cloneResized</code> method was thrown. <a href=https://github.com/ClickHouse/ClickHouse/pull/18818 rel="external nofollow noreferrer" target=_blank>#18818</a> (<a href=https://github.com/templarzq rel="external nofollow noreferrer" target=_blank>templarzq</a>).</li> <li>Added prefix-based S3 endpoint settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/18812 rel="external nofollow noreferrer" target=_blank>#18812</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add [UInt8, UInt16, UInt32, UInt64] arguments types support for bitmapTransform, bitmapSubsetInRange, bitmapSubsetLimit, bitmapContains functions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18713 rel="external nofollow noreferrer" target=_blank>#18713</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18791 rel="external nofollow noreferrer" target=_blank>#18791</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Allow CTE (Common Table Expressions) to be further aliased. Propagate CSE (Common Subexpressions Elimination) to subqueries in the same level when <code class=syntax>enable_global_with_statement = 1</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17378 rel="external nofollow noreferrer" target=_blank>#17378</a> . This fixes <a href=https://github.com/ClickHouse/ClickHouse/pull/16575#issuecomment-753416235 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/16575#issuecomment-753416235</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/18684 rel="external nofollow noreferrer" target=_blank>#18684</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Update librdkafka to v1.6.0-RC2. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18668 rel="external nofollow noreferrer" target=_blank>#18668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18671 rel="external nofollow noreferrer" target=_blank>#18671</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>In case of unexpected exceptions automatically restart background thread which is responsible for execution of distributed DDL queries. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17991 rel="external nofollow noreferrer" target=_blank>#17991</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18285 rel="external nofollow noreferrer" target=_blank>#18285</a> (<a href=https://github.com/weeds085490 rel="external nofollow noreferrer" target=_blank>徐炘</a>).</li> <li>Updated AWS C++ SDK in order to utilize global regions in S3. <a href=https://github.com/ClickHouse/ClickHouse/pull/17870 rel="external nofollow noreferrer" target=_blank>#17870</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Added support for <code class=syntax>WITH ... [AND] [PERIODIC] REFRESH [interval_in_sec]</code> clause when creating <code class=syntax>LIVE VIEW</code> tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/14822 rel="external nofollow noreferrer" target=_blank>#14822</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>Restrict <code class=syntax>MODIFY TTL</code> queries for <code class=syntax>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href=https://github.com/ClickHouse/ClickHouse/pull/19064 rel="external nofollow noreferrer" target=_blank>#19064</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=bug-fix_1>Bug Fix<a class=headerlink href=../amp/#bug-fix_1 title="Permanent link"> </a></h4> <ul> <li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18364 rel="external nofollow noreferrer" target=_blank>#18364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18373 rel="external nofollow noreferrer" target=_blank>#18373</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix starting the server with tables having default expressions containing dictGet(). Allow getting return type of dictGet() without loading dictionary. <a href=https://github.com/ClickHouse/ClickHouse/pull/19805 rel="external nofollow noreferrer" target=_blank>#19805</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix server crash after query with <code class=syntax>if</code> function with <code class=syntax>Tuple</code> type of then/else branches result. <code class=syntax>Tuple</code> type must contain <code class=syntax>Array</code> or another complex type. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18356 rel="external nofollow noreferrer" target=_blank>#18356</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/20133 rel="external nofollow noreferrer" target=_blank>#20133</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (experimental feature): Fix replication for statements that update several tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/20066 rel="external nofollow noreferrer" target=_blank>#20066</a> (<a href=https://github.com/havardk rel="external nofollow noreferrer" target=_blank>Håvard Kvålen</a>).</li> <li>Prevent "Connection refused" in docker during initialization script execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/20012 rel="external nofollow noreferrer" target=_blank>#20012</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li><code class=syntax>EmbeddedRocksDB</code> is an experimental storage. Fix the issue with lack of proper type checking. Simplified code. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19967 rel="external nofollow noreferrer" target=_blank>#19967</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19972 rel="external nofollow noreferrer" target=_blank>#19972</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix a segfault in function <code class=syntax>fromModifiedJulianDay</code> when the argument type is <code class=syntax>Nullable(T)</code> for any integral types other than Int32. <a href=https://github.com/ClickHouse/ClickHouse/pull/19959 rel="external nofollow noreferrer" target=_blank>#19959</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>The function <code class=syntax>greatCircleAngle</code> returned inaccurate results in previous versions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19769 rel="external nofollow noreferrer" target=_blank>#19769</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19789 rel="external nofollow noreferrer" target=_blank>#19789</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix rare bug when some replicated operations (like mutation) cannot process some parts after data corruption. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19593 rel="external nofollow noreferrer" target=_blank>#19593</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19702 rel="external nofollow noreferrer" target=_blank>#19702</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Background thread which executes <code class=syntax>ON CLUSTER</code> queries might hang waiting for dropped replicated table to do something. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/19684 rel="external nofollow noreferrer" target=_blank>#19684</a> (<a href=https://github.com/yiguolei rel="external nofollow noreferrer" target=_blank>yiguolei</a>).</li> <li>Fix wrong deserialization of columns description. It makes INSERT into a table with a column named <code class=syntax>\</code> impossible. <a href=https://github.com/ClickHouse/ClickHouse/pull/19479 rel="external nofollow noreferrer" target=_blank>#19479</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Mark distributed batch as broken in case of empty data block in one of files. <a href=https://github.com/ClickHouse/ClickHouse/pull/19449 rel="external nofollow noreferrer" target=_blank>#19449</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed very rare bug that might cause mutation to hang after <code class=syntax>DROP/DETACH/REPLACE/MOVE PARTITION</code>. It was partially fixed by <a href=https://github.com/ClickHouse/ClickHouse/issues/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> for the most cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/19443 rel="external nofollow noreferrer" target=_blank>#19443</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix possible error <code class=syntax>Extremes transform was already added to pipeline</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14100 rel="external nofollow noreferrer" target=_blank>#14100</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19430 rel="external nofollow noreferrer" target=_blank>#19430</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix default value in join types with non-zero default (e.g. some Enums). Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18197 rel="external nofollow noreferrer" target=_blank>#18197</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19360 rel="external nofollow noreferrer" target=_blank>#19360</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Do not mark file for distributed send as broken on EOF. <a href=https://github.com/ClickHouse/ClickHouse/pull/19290 rel="external nofollow noreferrer" target=_blank>#19290</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix leaking of pipe fd for <code class=syntax>async_socket_for_remote</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19153 rel="external nofollow noreferrer" target=_blank>#19153</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix infinite reading from file in <code class=syntax>ORC</code> format (was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/10580 rel="external nofollow noreferrer" target=_blank>#10580</a>). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19095 rel="external nofollow noreferrer" target=_blank>#19095</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19134 rel="external nofollow noreferrer" target=_blank>#19134</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix issue in merge tree data writer which can lead to marks with bigger size than fixed granularity size. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18913 rel="external nofollow noreferrer" target=_blank>#18913</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19123 rel="external nofollow noreferrer" target=_blank>#19123</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix startup bug when clickhouse was not able to read compression codec from <code class=syntax>LowCardinality(Nullable(...))</code> and throws exception <code class=syntax>Attempt to read after EOF</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18340 rel="external nofollow noreferrer" target=_blank>#18340</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19101 rel="external nofollow noreferrer" target=_blank>#19101</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Simplify the implementation of <code class=syntax>tupleHammingDistance</code>. Support for tuples of any equal length. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19029 rel="external nofollow noreferrer" target=_blank>#19029</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19084 rel="external nofollow noreferrer" target=_blank>#19084</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Make sure <code class=syntax>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17875 rel="external nofollow noreferrer" target=_blank>#17875</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19019 rel="external nofollow noreferrer" target=_blank>#19019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible error <code class=syntax>Expected single dictionary argument for function</code> if use function <code class=syntax>ignore</code> with <code class=syntax>LowCardinality</code> argument. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14275 rel="external nofollow noreferrer" target=_blank>#14275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19016 rel="external nofollow noreferrer" target=_blank>#19016</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix inserting of <code class=syntax>LowCardinality</code> column to table with <code class=syntax>TinyLog</code> engine. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18629 rel="external nofollow noreferrer" target=_blank>#18629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19010 rel="external nofollow noreferrer" target=_blank>#19010</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix minor issue in JOIN: Join tries to materialize const columns, but our code waits for them in other places. <a href=https://github.com/ClickHouse/ClickHouse/pull/18982 rel="external nofollow noreferrer" target=_blank>#18982</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Disable <code class=syntax>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18051 rel="external nofollow noreferrer" target=_blank>#18051</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18973 rel="external nofollow noreferrer" target=_blank>#18973</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18981 rel="external nofollow noreferrer" target=_blank>#18981</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible exception <code class=syntax>QueryPipeline stream: different number of columns</code> caused by merging of query plan's <code class=syntax>Expression</code> steps. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18190 rel="external nofollow noreferrer" target=_blank>#18190</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18980 rel="external nofollow noreferrer" target=_blank>#18980</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed very rare deadlock at shutdown. <a href=https://github.com/ClickHouse/ClickHouse/pull/18977 rel="external nofollow noreferrer" target=_blank>#18977</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed rare crashes when server run out of memory. <a href=https://github.com/ClickHouse/ClickHouse/pull/18976 rel="external nofollow noreferrer" target=_blank>#18976</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix incorrect behavior when <code class=syntax>ALTER TABLE ... DROP PART 'part_name'</code> query removes all deduplication blocks for the whole partition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18874 rel="external nofollow noreferrer" target=_blank>#18874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18969 rel="external nofollow noreferrer" target=_blank>#18969</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed issue <a href=https://github.com/ClickHouse/ClickHouse/issues/18894 rel="external nofollow noreferrer" target=_blank>#18894</a> Add a check to avoid exception when long column alias('table.column' style, usually auto-generated by BI tools like Looker) equals to long table name. <a href=https://github.com/ClickHouse/ClickHouse/pull/18968 rel="external nofollow noreferrer" target=_blank>#18968</a> (<a href=https://github.com/mathfool rel="external nofollow noreferrer" target=_blank>Daniel Qin</a>).</li> <li>Fix error <code class=syntax>Task was not found in task queue</code> (possible only for remote queries, with <code class=syntax>async_socket_for_remote = 1</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/18964 rel="external nofollow noreferrer" target=_blank>#18964</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug when mutation with some escaped text (like <code class=syntax>ALTER ... UPDATE e = CAST('foo', 'Enum8(\'foo\' = 1')</code> serialized incorrectly. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18878 rel="external nofollow noreferrer" target=_blank>#18878</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18944 rel="external nofollow noreferrer" target=_blank>#18944</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>ATTACH PARTITION will reset mutations. <a href=https://github.com/ClickHouse/ClickHouse/issues/18804 rel="external nofollow noreferrer" target=_blank>#18804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18935 rel="external nofollow noreferrer" target=_blank>#18935</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix issue with <code class=syntax>bitmapOrCardinality</code> that may lead to nullptr dereference. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18911 rel="external nofollow noreferrer" target=_blank>#18911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18912 rel="external nofollow noreferrer" target=_blank>#18912</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fixed <code class=syntax>Attempt to read after eof</code> error when trying to <code class=syntax>CAST</code> <code class=syntax>NULL</code> from <code class=syntax>Nullable(String)</code> to <code class=syntax>Nullable(Decimal(P, S))</code>. Now function <code class=syntax>CAST</code> returns <code class=syntax>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7690 rel="external nofollow noreferrer" target=_blank>#7690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18718 rel="external nofollow noreferrer" target=_blank>#18718</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix data type convert issue for MySQL engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/18124 rel="external nofollow noreferrer" target=_blank>#18124</a> (<a href=https://github.com/mis98zb rel="external nofollow noreferrer" target=_blank>bo zeng</a>).</li> <li>Fix clickhouse-client abort exception while executing only <code class=syntax>select</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19790 rel="external nofollow noreferrer" target=_blank>#19790</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> </ul> <h4 id=build-testing-packaging-improvement_1>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_1 title="Permanent link"> </a></h4> <ul> <li>Run <a href=https://twitter.com/RiggerManuel/status/1352345625480884228 rel="external nofollow noreferrer" target=_blank>SQLancer</a> (logical SQL fuzzer) in CI. <a href=https://github.com/ClickHouse/ClickHouse/pull/19006 rel="external nofollow noreferrer" target=_blank>#19006</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Query Fuzzer will fuzz newly added tests more extensively. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18916 rel="external nofollow noreferrer" target=_blank>#18916</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19185 rel="external nofollow noreferrer" target=_blank>#19185</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Integrate with <a href=https://github.com/minimaxir/big-list-of-naughty-strings/ rel="external nofollow noreferrer" target=_blank>Big List of Naughty Strings</a> for better fuzzing. <a href=https://github.com/ClickHouse/ClickHouse/pull/19480 rel="external nofollow noreferrer" target=_blank>#19480</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add integration tests run with MSan. <a href=https://github.com/ClickHouse/ClickHouse/pull/18974 rel="external nofollow noreferrer" target=_blank>#18974</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed MemorySanitizer errors in cyrus-sasl and musl. <a href=https://github.com/ClickHouse/ClickHouse/pull/19821 rel="external nofollow noreferrer" target=_blank>#19821</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Insuffiient arguments check in <code class=syntax>positionCaseInsensitiveUTF8</code> function triggered address sanitizer. <a href=https://github.com/ClickHouse/ClickHouse/pull/19720 rel="external nofollow noreferrer" target=_blank>#19720</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove --project-directory for docker-compose in integration test. Fix logs formatting from docker container. <a href=https://github.com/ClickHouse/ClickHouse/pull/19706 rel="external nofollow noreferrer" target=_blank>#19706</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Made generation of macros.xml easier for integration tests. No more excessive logging from dicttoxml. dicttoxml project is not active for 5+ years. <a href=https://github.com/ClickHouse/ClickHouse/pull/19697 rel="external nofollow noreferrer" target=_blank>#19697</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Allow to explicitly enable or disable watchdog via environment variable <code class=syntax>CLICKHOUSE_WATCHDOG_ENABLE</code>. By default it is enabled if server is not attached to terminal. <a href=https://github.com/ClickHouse/ClickHouse/pull/19522 rel="external nofollow noreferrer" target=_blank>#19522</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow building ClickHouse with Kafka support on arm64. <a href=https://github.com/ClickHouse/ClickHouse/pull/19369 rel="external nofollow noreferrer" target=_blank>#19369</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Allow building librdkafka without ssl. <a href=https://github.com/ClickHouse/ClickHouse/pull/19337 rel="external nofollow noreferrer" target=_blank>#19337</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Restore Kafka input in FreeBSD builds. <a href=https://github.com/ClickHouse/ClickHouse/pull/18924 rel="external nofollow noreferrer" target=_blank>#18924</a> (<a href=https://github.com/snar rel="external nofollow noreferrer" target=_blank>Alexandre Snarskii</a>).</li> <li>Fix potential nullptr dereference in table function <code class=syntax>VALUES</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19357 rel="external nofollow noreferrer" target=_blank>#19357</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Avoid UBSan reports in <code class=syntax>arrayElement</code> function, <code class=syntax>substring</code> and <code class=syntax>arraySum</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19305 rel="external nofollow noreferrer" target=_blank>#19305</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19287 rel="external nofollow noreferrer" target=_blank>#19287</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19336 rel="external nofollow noreferrer" target=_blank>#19336</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19347 rel="external nofollow noreferrer" target=_blank>#19347</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h2 id=clickhouse-release-21-1>ClickHouse release 21.1<a class=headerlink href=../amp/#clickhouse-release-21-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v21-1-3-32-stable-2021-02-03>ClickHouse release v21.1.3.32-stable, 2021-02-03<a class=headerlink href=../amp/#clickhouse-release-v21-1-3-32-stable-2021-02-03 title="Permanent link"> </a></h3> <h4 id=bug-fix_2>Bug Fix<a class=headerlink href=../amp/#bug-fix_2 title="Permanent link"> </a></h4> <ul> <li>BloomFilter index crash fix. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19757 rel="external nofollow noreferrer" target=_blank>#19757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19884 rel="external nofollow noreferrer" target=_blank>#19884</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fix crash when pushing down predicates to union distinct subquery. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19855 rel="external nofollow noreferrer" target=_blank>#19855</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19861 rel="external nofollow noreferrer" target=_blank>#19861</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix filtering by UInt8 greater than 127. <a href=https://github.com/ClickHouse/ClickHouse/pull/19799 rel="external nofollow noreferrer" target=_blank>#19799</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>In previous versions, unusual arguments for function arrayEnumerateUniq may cause crash or infinite loop. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19787 rel="external nofollow noreferrer" target=_blank>#19787</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19788 rel="external nofollow noreferrer" target=_blank>#19788</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed stack overflow when using accurate comparison of arithmetic type with string type. <a href=https://github.com/ClickHouse/ClickHouse/pull/19773 rel="external nofollow noreferrer" target=_blank>#19773</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix crash when nested column name was used in <code class=syntax>WHERE</code> or <code class=syntax>PREWHERE</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19755 rel="external nofollow noreferrer" target=_blank>#19755</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19763 rel="external nofollow noreferrer" target=_blank>#19763</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix a segmentation fault in <code class=syntax>bitmapAndnot</code> function. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19668 rel="external nofollow noreferrer" target=_blank>#19668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19713 rel="external nofollow noreferrer" target=_blank>#19713</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Some functions with big integers may cause segfault. Big integers is experimental feature. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19667 rel="external nofollow noreferrer" target=_blank>#19667</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19672 rel="external nofollow noreferrer" target=_blank>#19672</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix wrong result of function <code class=syntax>neighbor</code> for <code class=syntax>LowCardinality</code> argument. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10333 rel="external nofollow noreferrer" target=_blank>#10333</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19617 rel="external nofollow noreferrer" target=_blank>#19617</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix use-after-free of the CompressedWriteBuffer in Connection after disconnect. <a href=https://github.com/ClickHouse/ClickHouse/pull/19599 rel="external nofollow noreferrer" target=_blank>#19599</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>DROP/DETACH TABLE table ON CLUSTER cluster SYNC</code> query might hang, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19568 rel="external nofollow noreferrer" target=_blank>#19568</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19572 rel="external nofollow noreferrer" target=_blank>#19572</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Query CREATE DICTIONARY id expression fix. <a href=https://github.com/ClickHouse/ClickHouse/pull/19571 rel="external nofollow noreferrer" target=_blank>#19571</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Fix SIGSEGV with merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read=0/UINT64_MAX. <a href=https://github.com/ClickHouse/ClickHouse/pull/19528 rel="external nofollow noreferrer" target=_blank>#19528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Buffer overflow (on memory read) was possible if <code class=syntax>addMonth</code> function was called with specifically crafted arguments. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19441 rel="external nofollow noreferrer" target=_blank>#19441</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19413 rel="external nofollow noreferrer" target=_blank>#19413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19472 rel="external nofollow noreferrer" target=_blank>#19472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Uninitialized memory read was possible in encrypt/decrypt functions if empty string was passed as IV. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19391 rel="external nofollow noreferrer" target=_blank>#19391</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19397 rel="external nofollow noreferrer" target=_blank>#19397</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible buffer overflow in Uber H3 library. See <a href=https://github.com/uber/h3/issues/392 target=_blank>https://github.com/uber/h3/issues/392</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/19219 rel="external nofollow noreferrer" target=_blank>#19219</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19383 rel="external nofollow noreferrer" target=_blank>#19383</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix system.parts _state column (LOGICAL_ERROR when querying this column, due to incorrect order). <a href=https://github.com/ClickHouse/ClickHouse/pull/19346 rel="external nofollow noreferrer" target=_blank>#19346</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fixed possible wrong result or segfault on aggregation when Materialized View and its target table have different structure. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18063 rel="external nofollow noreferrer" target=_blank>#18063</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19322 rel="external nofollow noreferrer" target=_blank>#19322</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix error <code class=syntax>Cannot convert column now64() because it is constant but values of constants are different in source and result</code>. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/7156 rel="external nofollow noreferrer" target=_blank>#7156</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19316 rel="external nofollow noreferrer" target=_blank>#19316</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug when concurrent <code class=syntax>ALTER</code> and <code class=syntax>DROP</code> queries may hang while processing ReplicatedMergeTree table. <a href=https://github.com/ClickHouse/ClickHouse/pull/19237 rel="external nofollow noreferrer" target=_blank>#19237</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed <code class=syntax>There is no checkpoint</code> error when inserting data through http interface using <code class=syntax>Template</code> or <code class=syntax>CustomSeparated</code> format. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19021 rel="external nofollow noreferrer" target=_blank>#19021</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19072 rel="external nofollow noreferrer" target=_blank>#19072</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Disable constant folding for subqueries on the analysis stage, when the result cannot be calculated. <a href=https://github.com/ClickHouse/ClickHouse/pull/18446 rel="external nofollow noreferrer" target=_blank>#18446</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Mutation might hang waiting for some non-existent part after <code class=syntax>MOVE</code> or <code class=syntax>REPLACE PARTITION</code> or, in rare cases, after <code class=syntax>DETACH</code> or <code class=syntax>DROP PARTITION</code>. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h3 id=clickhouse-release-v21-1-2-15-stable-2021-01-18>ClickHouse release v21.1.2.15-stable 2021-01-18<a class=headerlink href=../amp/#clickhouse-release-v21-1-2-15-stable-2021-01-18 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change_2>Backward Incompatible Change<a class=headerlink href=../amp/#backward-incompatible-change_2 title="Permanent link"> </a></h4> <ul> <li>The setting <code class=syntax>input_format_null_as_default</code> is enabled by default. <a href=https://github.com/ClickHouse/ClickHouse/pull/17525 rel="external nofollow noreferrer" target=_blank>#17525</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Check settings constraints for profile settings from config. Server will fail to start if users.xml contain settings that do not meet corresponding constraints. <a href=https://github.com/ClickHouse/ClickHouse/pull/18486 rel="external nofollow noreferrer" target=_blank>#18486</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Restrict <code class=syntax>ALTER MODIFY SETTING</code> from changing storage settings that affects data parts (<code class=syntax>write_final_mark</code> and <code class=syntax>enable_mixed_granularity_parts</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/18306 rel="external nofollow noreferrer" target=_blank>#18306</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Set <code class=syntax>insert_quorum_parallel</code> to 1 by default. It is significantly more convenient to use than "sequential" quorum inserts. But if you rely to sequential consistency, you should set the setting back to zero. <a href=https://github.com/ClickHouse/ClickHouse/pull/17567 rel="external nofollow noreferrer" target=_blank>#17567</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Remove <code class=syntax>sumburConsistentHash</code> function. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18120 rel="external nofollow noreferrer" target=_blank>#18120</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18656 rel="external nofollow noreferrer" target=_blank>#18656</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Removed aggregate functions <code class=syntax>timeSeriesGroupSum</code>, <code class=syntax>timeSeriesGroupRateSum</code> because a friend of mine said they never worked. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16869 rel="external nofollow noreferrer" target=_blank>#16869</a>. If you have luck using these functions, write a email to <a href=../mailto:clickhouse-feedback@yandex-team.comamp/ >clickhouse-feedback@yandex-team.com</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17423 rel="external nofollow noreferrer" target=_blank>#17423</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Prohibit toUnixTimestamp(Date()) (before it just returns UInt16 representation of Date). <a href=https://github.com/ClickHouse/ClickHouse/pull/17376 rel="external nofollow noreferrer" target=_blank>#17376</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow using extended integer types (<code class=syntax>Int128</code>, <code class=syntax>Int256</code>, <code class=syntax>UInt256</code>) in <code class=syntax>avg</code> and <code class=syntax>avgWeighted</code> functions. Also allow using different types (integer, decimal, floating point) for value and for weight in <code class=syntax>avgWeighted</code> function. This is a backward-incompatible change: now the <code class=syntax>avg</code> and <code class=syntax>avgWeighted</code> functions always return <code class=syntax>Float64</code> (as documented). Before this change the return type for <code class=syntax>Decimal</code> arguments was also <code class=syntax>Decimal</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15419 rel="external nofollow noreferrer" target=_blank>#15419</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>Expression <code class=syntax>toUUID(N)</code> no longer works. Replace with <code class=syntax>toUUID('00000000-0000-0000-0000-000000000000')</code>. This change is motivated by non-obvious results of <code class=syntax>toUUID(N)</code> where N is non zero.</li> <li>SSL Certificates with incorrect "key usage" are rejected. In previous versions they are used to work. See <a href=https://github.com/ClickHouse/ClickHouse/issues/19262 rel="external nofollow noreferrer" target=_blank>#19262</a>.</li> </ul> <h4 id=new-feature_2>New Feature<a class=headerlink href=../amp/#new-feature_2 title="Permanent link"> </a></h4> <ul> <li>Implement gRPC protocol in ClickHouse. <a href=https://github.com/ClickHouse/ClickHouse/pull/15111 rel="external nofollow noreferrer" target=_blank>#15111</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Allow to use multiple zookeeper clusters. <a href=https://github.com/ClickHouse/ClickHouse/pull/17070 rel="external nofollow noreferrer" target=_blank>#17070</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Implemented <code class=syntax>REPLACE TABLE</code> and <code class=syntax>CREATE OR REPLACE TABLE</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/18521 rel="external nofollow noreferrer" target=_blank>#18521</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Implement <code class=syntax>UNION DISTINCT</code> and treat the plain <code class=syntax>UNION</code> clause as <code class=syntax>UNION DISTINCT</code> by default. Add a setting <code class=syntax>union_default_mode</code> that allows to treat it as <code class=syntax>UNION ALL</code> or require explicit mode specification. <a href=https://github.com/ClickHouse/ClickHouse/pull/16338 rel="external nofollow noreferrer" target=_blank>#16338</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Added function <code class=syntax>accurateCastOrNull</code>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10290 rel="external nofollow noreferrer" target=_blank>#10290</a>. Add type conversions in <code class=syntax>x IN (subquery)</code> expressions. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10266 rel="external nofollow noreferrer" target=_blank>#10266</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16724 rel="external nofollow noreferrer" target=_blank>#16724</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>IP Dictionary supports <code class=syntax>IPv4</code> / <code class=syntax>IPv6</code> types directly. <a href=https://github.com/ClickHouse/ClickHouse/pull/17571 rel="external nofollow noreferrer" target=_blank>#17571</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>IP Dictionary supports key fetching. Resolves <a href=https://github.com/ClickHouse/ClickHouse/issues/18241 rel="external nofollow noreferrer" target=_blank>#18241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18480 rel="external nofollow noreferrer" target=_blank>#18480</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Add <code class=syntax>*.zst</code> compression/decompression support for data import and export. It enables using <code class=syntax>*.zst</code> in <code class=syntax>file()</code> function and <code class=syntax>Content-encoding: zstd</code> in HTTP client. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/16791 rel="external nofollow noreferrer" target=_blank>#16791 </a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17144 rel="external nofollow noreferrer" target=_blank>#17144</a> (<a href=https://github.com/fibersel rel="external nofollow noreferrer" target=_blank>Abi Palagashvili</a>).</li> <li>Added <code class=syntax>mannWitneyUTest</code>, <code class=syntax>studentTTest</code> and <code class=syntax>welchTTest</code> aggregate functions. Refactored <code class=syntax>rankCorr</code> a bit. <a href=https://github.com/ClickHouse/ClickHouse/pull/16883 rel="external nofollow noreferrer" target=_blank>#16883</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Add functions <code class=syntax>countMatches</code>/<code class=syntax>countMatchesCaseInsensitive</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17459 rel="external nofollow noreferrer" target=_blank>#17459</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Implement <code class=syntax>countSubstrings()</code>/<code class=syntax>countSubstringsCaseInsensitive()</code>/<code class=syntax>countSubstringsCaseInsensitiveUTF8()</code> (Count the number of substring occurrences). <a href=https://github.com/ClickHouse/ClickHouse/pull/17347 rel="external nofollow noreferrer" target=_blank>#17347</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add information about used databases, tables and columns in system.query_log. Add <code class=syntax>query_kind</code> and <code class=syntax>normalized_query_hash</code> fields. <a href=https://github.com/ClickHouse/ClickHouse/pull/17726 rel="external nofollow noreferrer" target=_blank>#17726</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add a setting <code class=syntax>optimize_on_insert</code>. When enabled, do the same transformation for INSERTed block of data as if merge was done on this block (e.g. Replacing, Collapsing, Aggregating...). This setting is enabled by default. This can influence Materialized View and MaterializeMySQL behaviour (see detailed description). This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10683 rel="external nofollow noreferrer" target=_blank>#10683</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16954 rel="external nofollow noreferrer" target=_blank>#16954</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Kerberos Authenticaiton for HDFS. <a href=https://github.com/ClickHouse/ClickHouse/pull/16621 rel="external nofollow noreferrer" target=_blank>#16621</a> (<a href=https://github.com/ilejn rel="external nofollow noreferrer" target=_blank>Ilya Golshtein</a>).</li> <li>Support <code class=syntax>SHOW SETTINGS</code> statement to show parameters in system.settings. <code class=syntax>SHOW CHANGED SETTINGS</code> and <code class=syntax>LIKE/ILIKE</code> clause are also supported. <a href=https://github.com/ClickHouse/ClickHouse/pull/18056 rel="external nofollow noreferrer" target=_blank>#18056</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Function <code class=syntax>position</code> now supports <code class=syntax>POSITION(needle IN haystack)</code> synax for SQL compatibility. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18701 rel="external nofollow noreferrer" target=_blank>#18701</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/18779 rel="external nofollow noreferrer" target=_blank>#18779</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Now we have a new storage setting <code class=syntax>max_partitions_to_read</code> for tables in the MergeTree family. It limits the max number of partitions that can be accessed in one query. A user setting <code class=syntax>force_max_partition_limit</code> is also added to enforce this constraint. <a href=https://github.com/ClickHouse/ClickHouse/pull/18712 rel="external nofollow noreferrer" target=_blank>#18712</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add <code class=syntax>query_id</code> column to <code class=syntax>system.part_log</code> for inserted parts. Closes <a href=https://github.com/ClickHouse/ClickHouse/issues/10097 rel="external nofollow noreferrer" target=_blank>#10097</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18644 rel="external nofollow noreferrer" target=_blank>#18644</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Allow create table as select with columns specification. Example <code class=syntax>CREATE TABLE t1 (x String) ENGINE = Memory AS SELECT 1;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18060 rel="external nofollow noreferrer" target=_blank>#18060</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added <code class=syntax>arrayMin</code>, <code class=syntax>arrayMax</code>, <code class=syntax>arrayAvg</code> aggregation functions. <a href=https://github.com/ClickHouse/ClickHouse/pull/18032 rel="external nofollow noreferrer" target=_blank>#18032</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Implemented <code class=syntax>ATTACH TABLE name FROM 'path/to/data/' (col1 Type1, ...</code> query. It creates new table with provided structure and attaches table data from provided directory in <code class=syntax>user_files</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17903 rel="external nofollow noreferrer" target=_blank>#17903</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Add mutation support for StorageMemory. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9117 rel="external nofollow noreferrer" target=_blank>#9117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15127 rel="external nofollow noreferrer" target=_blank>#15127</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Support syntax <code class=syntax>EXISTS DATABASE name</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18458 rel="external nofollow noreferrer" target=_blank>#18458</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Support builtin function <code class=syntax>isIPv4String</code> &amp;&amp; <code class=syntax>isIPv6String</code> like <a href="https://github.com/ClickHouse/ClickHouse/compare/master...spongedu:support_is_ipv4?expand=1" rel="external nofollow noreferrer" target=_blank>MySQL</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18349 rel="external nofollow noreferrer" target=_blank>#18349</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Add a new setting <code class=syntax>insert_distributed_one_random_shard = 1</code> to allow insertion into multi-sharded distributed table without any distributed key. <a href=https://github.com/ClickHouse/ClickHouse/pull/18294 rel="external nofollow noreferrer" target=_blank>#18294</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add settings <code class=syntax>min_compress_block_size</code> and <code class=syntax>max_compress_block_size</code> to MergeTreeSettings, which have higher priority than the global settings and take effect when they are set. close <a href=https://github.com/ClickHouse/ClickHouse/issues/13890 rel="external nofollow noreferrer" target=_blank>13890</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17867 rel="external nofollow noreferrer" target=_blank>#17867</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add support for 64bit roaring bitmaps. <a href=https://github.com/ClickHouse/ClickHouse/pull/17858 rel="external nofollow noreferrer" target=_blank>#17858</a> (<a href=https://github.com/andyyzh rel="external nofollow noreferrer" target=_blank>Andy Yang</a>).</li> <li>Extended <code class=syntax>OPTIMIZE ... DEDUPLICATE</code> syntax to allow explicit (or implicit with asterisk/column transformers) list of columns to check for duplicates on. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/17846 rel="external nofollow noreferrer" target=_blank>#17846</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Added functions <code class=syntax>toModifiedJulianDay</code>, <code class=syntax>fromModifiedJulianDay</code>, <code class=syntax>toModifiedJulianDayOrNull</code>, and <code class=syntax>fromModifiedJulianDayOrNull</code>. These functions convert between Proleptic Gregorian calendar date and Modified Julian Day number. <a href=https://github.com/ClickHouse/ClickHouse/pull/17750 rel="external nofollow noreferrer" target=_blank>#17750</a> (<a href=https://github.com/depressed-pho rel="external nofollow noreferrer" target=_blank>PHO</a>).</li> <li>Add ability to use custom TLD list: added functions <code class=syntax>firstSignificantSubdomainCustom</code>, <code class=syntax>cutToFirstSignificantSubdomainCustom</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17748 rel="external nofollow noreferrer" target=_blank>#17748</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Add support for <code class=syntax>PROXYv1</code> protocol to wrap native TCP interface. Allow quotas to be keyed by proxy-forwarded IP address (applied for <code class=syntax>PROXYv1</code> address and for <code class=syntax>X-Forwarded-For</code> from HTTP interface). This is useful when you provide access to ClickHouse only via trusted proxy (e.g. CloudFlare) but want to account user resources by their original IP addresses. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17268 rel="external nofollow noreferrer" target=_blank>#17268</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17707 rel="external nofollow noreferrer" target=_blank>#17707</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Now clickhouse-client supports opening <code class=syntax>EDITOR</code> to edit commands. <code class=syntax>Alt-Shift-E</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17665 rel="external nofollow noreferrer" target=_blank>#17665</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add function <code class=syntax>encodeXMLComponent</code> to escape characters to place string into XML text node or attribute. <a href=https://github.com/ClickHouse/ClickHouse/pull/17659 rel="external nofollow noreferrer" target=_blank>#17659</a> (<a href=https://github.com/nautaa rel="external nofollow noreferrer" target=_blank>nauta</a>).</li> <li>Introduce <code class=syntax>DETACH TABLE/VIEW ... PERMANENTLY</code> syntax, so that after restarting the table does not reappear back automatically on restart (only by explicit request). The table can still be attached back using the short syntax ATTACH TABLE. Implements <a href=https://github.com/ClickHouse/ClickHouse/issues/5555 rel="external nofollow noreferrer" target=_blank>#5555</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13850 rel="external nofollow noreferrer" target=_blank>#13850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17642 rel="external nofollow noreferrer" target=_blank>#17642</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Add asynchronous metrics on total amount of rows, bytes and parts in MergeTree tables. This fix <a href=https://github.com/ClickHouse/ClickHouse/issues/11714 rel="external nofollow noreferrer" target=_blank>#11714</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17639 rel="external nofollow noreferrer" target=_blank>#17639</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add settings <code class=syntax>limit</code> and <code class=syntax>offset</code> for out-of-SQL pagination: <a href=https://github.com/ClickHouse/ClickHouse/issues/16176 rel="external nofollow noreferrer" target=_blank>#16176</a> They are useful for building APIs. These two settings will affect SELECT query as if it is added like <code class=syntax>select * from (your_original_select_query) t limit xxx offset xxx;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17633 rel="external nofollow noreferrer" target=_blank>#17633</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Provide a new aggregator combinator : <code class=syntax>-SimpleState</code> to build <code class=syntax>SimpleAggregateFunction</code> types via query. It's useful for defining MaterializedView of AggregatingMergeTree engine, and will benefit projections too. <a href=https://github.com/ClickHouse/ClickHouse/pull/16853 rel="external nofollow noreferrer" target=_blank>#16853</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Added <code class=syntax>queries-file</code> parameter for <code class=syntax>clickhouse-client</code> and <code class=syntax>clickhouse-local</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15930 rel="external nofollow noreferrer" target=_blank>#15930</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Added <code class=syntax>query</code> parameter for <code class=syntax>clickhouse-benchmark</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17832 rel="external nofollow noreferrer" target=_blank>#17832</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li><code class=syntax>EXPLAIN AST</code> now support queries other then <code class=syntax>SELECT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18136 rel="external nofollow noreferrer" target=_blank>#18136</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>).</li> </ul> <h4 id=experimental-feature_1>Experimental Feature<a class=headerlink href=../amp/#experimental-feature_1 title="Permanent link"> </a></h4> <ul> <li>Added functions for calculation of minHash and simHash of text n-grams and shingles. They are intended for semi-duplicate search. Also functions <code class=syntax>bitHammingDistance</code> and <code class=syntax>tupleHammingDistance</code> are added. <a href=https://github.com/ClickHouse/ClickHouse/pull/7649 rel="external nofollow noreferrer" target=_blank>#7649</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Add new data type <code class=syntax>Map</code>. See <a href=https://github.com/ClickHouse/ClickHouse/issues/1841 rel="external nofollow noreferrer" target=_blank>#1841</a>. First version for Map only supports <code class=syntax>String</code> type of key and value. <a href=https://github.com/ClickHouse/ClickHouse/pull/15806 rel="external nofollow noreferrer" target=_blank>#15806</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Implement alternative SQL parser based on ANTLR4 runtime and generated from EBNF grammar. <a href=https://github.com/ClickHouse/ClickHouse/pull/11298 rel="external nofollow noreferrer" target=_blank>#11298</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> </ul> <h4 id=performance-improvement_2>Performance Improvement<a class=headerlink href=../amp/#performance-improvement_2 title="Permanent link"> </a></h4> <ul> <li>New IP Dictionary implementation with lower memory consumption, improved performance for some cases, and fixed bugs. <a href=https://github.com/ClickHouse/ClickHouse/pull/16804 rel="external nofollow noreferrer" target=_blank>#16804</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Parallel formatting for data export. <a href=https://github.com/ClickHouse/ClickHouse/pull/11617 rel="external nofollow noreferrer" target=_blank>#11617</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>LDAP integration: Added <code class=syntax>verification_cooldown</code> parameter in LDAP server connection configuration to allow caching of successful "bind" attempts for configurable period of time. <a href=https://github.com/ClickHouse/ClickHouse/pull/15988 rel="external nofollow noreferrer" target=_blank>#15988</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Add <code class=syntax>--no-system-table</code> option for <code class=syntax>clickhouse-local</code> to run without system tables. This avoids initialization of <code class=syntax>DateLUT</code> that may take noticeable amount of time (tens of milliseconds) at startup. <a href=https://github.com/ClickHouse/ClickHouse/pull/18899 rel="external nofollow noreferrer" target=_blank>#18899</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Replace <code class=syntax>PODArray</code> with <code class=syntax>PODArrayWithStackMemory</code> in <code class=syntax>AggregateFunctionWindowFunnelData</code> to improve <code class=syntax>windowFunnel</code> function performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/18817 rel="external nofollow noreferrer" target=_blank>#18817</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Don't send empty blocks to shards on synchronous INSERT into Distributed table. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14571 rel="external nofollow noreferrer" target=_blank>#14571</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18775 rel="external nofollow noreferrer" target=_blank>#18775</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Optimized read for StorageMemory. <a href=https://github.com/ClickHouse/ClickHouse/pull/18052 rel="external nofollow noreferrer" target=_blank>#18052</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Using Dragonbox algorithm for float to string conversion instead of ryu. This improves performance of float to string conversion significantly. <a href=https://github.com/ClickHouse/ClickHouse/pull/17831 rel="external nofollow noreferrer" target=_blank>#17831</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Speedup <code class=syntax>IPv6CIDRToRange</code> implementation. <a href=https://github.com/ClickHouse/ClickHouse/pull/17569 rel="external nofollow noreferrer" target=_blank>#17569</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>Add <code class=syntax>remerge_sort_lowered_memory_bytes_ratio</code> setting (If memory usage after remerge does not reduced by this ratio, remerge will be disabled). <a href=https://github.com/ClickHouse/ClickHouse/pull/17539 rel="external nofollow noreferrer" target=_blank>#17539</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Improve performance of AggregatingMergeTree with SimpleAggregateFunction(String) in PK. <a href=https://github.com/ClickHouse/ClickHouse/pull/17109 rel="external nofollow noreferrer" target=_blank>#17109</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Now the <code class=syntax>-If</code> combinator is devirtualized, and <code class=syntax>count</code> is properly vectorized. It is for <a href=https://github.com/ClickHouse/ClickHouse/pull/17041 rel="external nofollow noreferrer" target=_blank>this PR</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17043 rel="external nofollow noreferrer" target=_blank>#17043</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix performance of reading from <code class=syntax>Merge</code> tables over huge number of <code class=syntax>MergeTree</code> tables. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7748 rel="external nofollow noreferrer" target=_blank>#7748</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16988 rel="external nofollow noreferrer" target=_blank>#16988</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Improved performance of function <code class=syntax>repeat</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16937 rel="external nofollow noreferrer" target=_blank>#16937</a> (<a href=https://github.com/satanson rel="external nofollow noreferrer" target=_blank>satanson</a>).</li> <li>Slightly improved performance of float parsing. <a href=https://github.com/ClickHouse/ClickHouse/pull/16809 rel="external nofollow noreferrer" target=_blank>#16809</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add possibility to skip merged partitions for <code class=syntax>OPTIMIZE TABLE ... FINAL</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15939 rel="external nofollow noreferrer" target=_blank>#15939</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Integrate with <a href=https://github.com/lemire/fast_float rel="external nofollow noreferrer" target=_blank>fast_float from Daniel Lemire</a> to parse floating point numbers. <a href=https://github.com/ClickHouse/ClickHouse/pull/16787 rel="external nofollow noreferrer" target=_blank>#16787</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>). It is not enabled, because performance its performance is still lower than rough float parser in ClickHouse.</li> <li>Fix max_distributed_connections (affects <code class=syntax>prefer_localhost_replica = 1</code> and <code class=syntax>max_threads != max_distributed_connections</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17848 rel="external nofollow noreferrer" target=_blank>#17848</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Adaptive choice of single/multi part upload when sending data to S3. Single part upload is controlled by a new setting <code class=syntax>max_single_part_upload_size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17934 rel="external nofollow noreferrer" target=_blank>#17934</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Support for async tasks in <code class=syntax>PipelineExecutor</code>. Initial support of async sockets for remote queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/17868 rel="external nofollow noreferrer" target=_blank>#17868</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Allow to use <code class=syntax>optimize_move_to_prewhere</code> optimization with compact parts, when sizes of columns are unknown. <a href=https://github.com/ClickHouse/ClickHouse/pull/17330 rel="external nofollow noreferrer" target=_blank>#17330</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=improvement_2>Improvement<a class=headerlink href=../amp/#improvement_2 title="Permanent link"> </a></h4> <ul> <li>Avoid deadlock when executing INSERT SELECT into itself from a table with <code class=syntax>TinyLog</code> or <code class=syntax>Log</code> table engines. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/6802 rel="external nofollow noreferrer" target=_blank>#6802</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18691 rel="external nofollow noreferrer" target=_blank>#18691</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/16812 rel="external nofollow noreferrer" target=_blank>#16812</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14570 rel="external nofollow noreferrer" target=_blank>#14570</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15260 rel="external nofollow noreferrer" target=_blank>#15260</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Support <code class=syntax>SHOW CREATE VIEW name</code> syntax like <a href=https://dev.mysql.com/doc/refman/5.7/en/show-create-view.html rel="external nofollow noreferrer" target=_blank>MySQL</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18095 rel="external nofollow noreferrer" target=_blank>#18095</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>All queries of type <code class=syntax>Decimal * Float</code> or vice versa are allowed, including aggregate ones (e.g. <code class=syntax>SELECT sum(decimal_field * 1.1)</code> or <code class=syntax>SELECT dec_col * float_col</code>), the result type is Float32 or Float64. <a href=https://github.com/ClickHouse/ClickHouse/pull/18145 rel="external nofollow noreferrer" target=_blank>#18145</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>Improved minimal Web UI: add history; add sharing support; avoid race condition of different requests; add request in-flight and ready indicators; add favicon; detect Ctrl+Enter if textarea is not in focus. <a href=https://github.com/ClickHouse/ClickHouse/pull/17293 rel="external nofollow noreferrer" target=_blank>#17293</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17770 rel="external nofollow noreferrer" target=_blank>#17770</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>clickhouse-server didn't send <code class=syntax>close</code> request to ZooKeeper server. <a href=https://github.com/ClickHouse/ClickHouse/pull/16837 rel="external nofollow noreferrer" target=_blank>#16837</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Avoid server abnormal termination in case of too low memory limits (<code class=syntax>max_memory_usage = 1</code> / <code class=syntax>max_untracked_memory = 1</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17453 rel="external nofollow noreferrer" target=_blank>#17453</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix non-deterministic result of <code class=syntax>windowFunnel</code> function in case of same timestamp for different events. <a href=https://github.com/ClickHouse/ClickHouse/pull/18884 rel="external nofollow noreferrer" target=_blank>#18884</a> (<a href=https://github.com/fuwhu rel="external nofollow noreferrer" target=_blank>Fuwang Hu</a>).</li> <li>Docker: Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server Docker images. <a href=https://github.com/ClickHouse/ClickHouse/pull/19096 rel="external nofollow noreferrer" target=_blank>#19096</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Asynchronous INSERTs to <code class=syntax>Distributed</code> tables: Two new settings (by analogy with MergeTree family) has been added: - <code class=syntax>fsync_after_insert</code> - Do fsync for every inserted. Will decreases performance of inserts. - <code class=syntax>fsync_directories</code> - Do fsync for temporary directory (that is used for async INSERT only) after all operations (writes, renames, etc.). <a href=https://github.com/ClickHouse/ClickHouse/pull/18864 rel="external nofollow noreferrer" target=_blank>#18864</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>SYSTEM KILL</code> command started to work in Docker. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18847 rel="external nofollow noreferrer" target=_blank>#18847</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18848 rel="external nofollow noreferrer" target=_blank>#18848</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Expand macros in the zk path when executing <code class=syntax>FETCH PARTITION</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18839 rel="external nofollow noreferrer" target=_blank>#18839</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Apply <code class=syntax>ALTER TABLE &lt;replicated_table&gt; ON CLUSTER MODIFY SETTING ...</code> to all replicas. Because we don't replicate such alter commands. <a href=https://github.com/ClickHouse/ClickHouse/pull/18789 rel="external nofollow noreferrer" target=_blank>#18789</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Allow column transformer <code class=syntax>EXCEPT</code> to accept a string as regular expression matcher. This resolves <a href=https://github.com/ClickHouse/ClickHouse/issues/18685 rel="external nofollow noreferrer" target=_blank>#18685</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/18699 rel="external nofollow noreferrer" target=_blank>#18699</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix SimpleAggregateFunction in SummingMergeTree. Now it works like AggregateFunction. In previous versions values were summed together regardless to the aggregate function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18564 rel="external nofollow noreferrer" target=_blank>#18564</a> . <a href=https://github.com/ClickHouse/ClickHouse/issues/8052 rel="external nofollow noreferrer" target=_blank>#8052</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18637 rel="external nofollow noreferrer" target=_blank>#18637</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>). Another fix of using <code class=syntax>SimpleAggregateFunction</code> in <code class=syntax>SummingMergeTree</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18676 rel="external nofollow noreferrer" target=_blank>#18676</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/18677 rel="external nofollow noreferrer" target=_blank>#18677</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fixed assertion error inside allocator in case when last argument of function bar is NaN. Now simple ClickHouse's exception is being thrown. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17876 rel="external nofollow noreferrer" target=_blank>#17876</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18520 rel="external nofollow noreferrer" target=_blank>#18520</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix usability issue: no newline after exception message in some tools. <a href=https://github.com/ClickHouse/ClickHouse/pull/18444 rel="external nofollow noreferrer" target=_blank>#18444</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Add ability to modify primary and partition key column type from <code class=syntax>LowCardinality(Type)</code> to <code class=syntax>Type</code> and vice versa. Also add an ability to modify primary key column type from <code class=syntax>EnumX</code> to <code class=syntax>IntX</code> type. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/5604 rel="external nofollow noreferrer" target=_blank>#5604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18362 rel="external nofollow noreferrer" target=_blank>#18362</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Implement <code class=syntax>untuple</code> field access. <a href=https://github.com/ClickHouse/ClickHouse/issues/18133 rel="external nofollow noreferrer" target=_blank>#18133</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18309 rel="external nofollow noreferrer" target=_blank>#18309</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Allow to parse Array fields from CSV if it is represented as a string containing array that was serialized as nested CSV. Example: <code class=syntax>"[""Hello"", ""world"", ""42"""" TV""]"</code> will parse as <code class=syntax>['Hello', 'world', '42" TV']</code>. Allow to parse array in CSV in a string without enclosing braces. Example: <code class=syntax>"'Hello', 'world', '42"" TV'"</code> will parse as <code class=syntax>['Hello', 'world', '42" TV']</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18271 rel="external nofollow noreferrer" target=_blank>#18271</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Make better adaptive granularity calculation for merge tree wide parts. <a href=https://github.com/ClickHouse/ClickHouse/pull/18223 rel="external nofollow noreferrer" target=_blank>#18223</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Now <code class=syntax>clickhouse install</code> could work on Mac. The problem was that there is no procfs on this platform. <a href=https://github.com/ClickHouse/ClickHouse/pull/18201 rel="external nofollow noreferrer" target=_blank>#18201</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Better hints for <code class=syntax>SHOW ...</code> query syntax. <a href=https://github.com/ClickHouse/ClickHouse/pull/18183 rel="external nofollow noreferrer" target=_blank>#18183</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Array aggregation <code class=syntax>arrayMin</code>, <code class=syntax>arrayMax</code>, <code class=syntax>arraySum</code>, <code class=syntax>arrayAvg</code> support for <code class=syntax>Int128</code>, <code class=syntax>Int256</code>, <code class=syntax>UInt256</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18147 rel="external nofollow noreferrer" target=_blank>#18147</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>Add <code class=syntax>disk</code> to Set and Join storage settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/18112 rel="external nofollow noreferrer" target=_blank>#18112</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>).</li> <li>Access control: Now table function <code class=syntax>merge()</code> requires current user to have <code class=syntax>SELECT</code> privilege on each table it receives data from. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16964 rel="external nofollow noreferrer" target=_blank>#16964</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18104 rel="external nofollow noreferrer" target=_blank>#18104</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17983 rel="external nofollow noreferrer" target=_blank>#17983</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Temporary tables are visible in the system tables <code class=syntax>system.tables</code> and <code class=syntax>system.columns</code> now only in those session where they have been created. The internal database <code class=syntax>_temporary_and_external_tables</code> is now hidden in those system tables; temporary tables are shown as tables with empty database with the <code class=syntax>is_temporary</code> flag set instead. <a href=https://github.com/ClickHouse/ClickHouse/pull/18014 rel="external nofollow noreferrer" target=_blank>#18014</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix clickhouse-client rendering issue when the size of terminal window changes. <a href=https://github.com/ClickHouse/ClickHouse/pull/18009 rel="external nofollow noreferrer" target=_blank>#18009</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Decrease log verbosity of the events when the client drops the connection from Warning to Information. <a href=https://github.com/ClickHouse/ClickHouse/pull/18005 rel="external nofollow noreferrer" target=_blank>#18005</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>Forcibly removing empty or bad metadata files from filesystem for DiskS3. S3 is an experimental feature. <a href=https://github.com/ClickHouse/ClickHouse/pull/17935 rel="external nofollow noreferrer" target=_blank>#17935</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Access control: <code class=syntax>allow_introspection_functions=0</code> prohibits usage of introspection functions but doesn't prohibit giving grants for them anymore (the grantee will need to set <code class=syntax>allow_introspection_functions=1</code> for himself to be able to use that grant). Similarly <code class=syntax>allow_ddl=0</code> prohibits usage of DDL commands but doesn't prohibit giving grants for them anymore. <a href=https://github.com/ClickHouse/ClickHouse/pull/17908 rel="external nofollow noreferrer" target=_blank>#17908</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Usability improvement: hints for column names. <a href=https://github.com/ClickHouse/ClickHouse/issues/17112 rel="external nofollow noreferrer" target=_blank>#17112</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17857 rel="external nofollow noreferrer" target=_blank>#17857</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Add diagnostic information when two merge tables try to read each other's data. <a href=https://github.com/ClickHouse/ClickHouse/pull/17854 rel="external nofollow noreferrer" target=_blank>#17854</a> (<a href=https://github.com/weeds085490 rel="external nofollow noreferrer" target=_blank>徐炘</a>).</li> <li>Let the possibility to override timeout value for running script using the ClickHouse docker image. <a href=https://github.com/ClickHouse/ClickHouse/pull/17818 rel="external nofollow noreferrer" target=_blank>#17818</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li> <li>Check system log tables' engine definition grammar to prevent some configuration errors. Notes that this grammar check is not semantical, that means such mistakes as non-existent columns / expression functions would be not found out util the table is created. <a href=https://github.com/ClickHouse/ClickHouse/pull/17739 rel="external nofollow noreferrer" target=_blank>#17739</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Removed exception throwing at <code class=syntax>RabbitMQ</code> table initialization if there was no connection (it will be reconnecting in the background). <a href=https://github.com/ClickHouse/ClickHouse/pull/17709 rel="external nofollow noreferrer" target=_blank>#17709</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>Do not ignore server memory limits during Buffer flush. <a href=https://github.com/ClickHouse/ClickHouse/pull/17646 rel="external nofollow noreferrer" target=_blank>#17646</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Switch to patched version of RocksDB (from ClickHouse-Extras) to fix use-after-free error. <a href=https://github.com/ClickHouse/ClickHouse/pull/17643 rel="external nofollow noreferrer" target=_blank>#17643</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Added an offset to exception message for parallel parsing. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17457 rel="external nofollow noreferrer" target=_blank>#17457</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17641 rel="external nofollow noreferrer" target=_blank>#17641</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Don't throw "Too many parts" error in the middle of INSERT query. <a href=https://github.com/ClickHouse/ClickHouse/pull/17566 rel="external nofollow noreferrer" target=_blank>#17566</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Allow query parameters in UPDATE statement of ALTER query. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10976 rel="external nofollow noreferrer" target=_blank>#10976</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17563 rel="external nofollow noreferrer" target=_blank>#17563</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Query obfuscator: avoid usage of some SQL keywords for identifier names. <a href=https://github.com/ClickHouse/ClickHouse/pull/17526 rel="external nofollow noreferrer" target=_blank>#17526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Export current max ddl entry executed by DDLWorker via server metric. It's useful to check if DDLWorker hangs somewhere. <a href=https://github.com/ClickHouse/ClickHouse/pull/17464 rel="external nofollow noreferrer" target=_blank>#17464</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Export asynchronous metrics of all servers current threads. It's useful to track down issues like <a href=https://github.com/ClickHouse-Extras/poco/pull/28 rel="external nofollow noreferrer" target=_blank>this</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17463 rel="external nofollow noreferrer" target=_blank>#17463</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Include dynamic columns like MATERIALIZED / ALIAS for wildcard query when settings <code class=syntax>asterisk_include_materialized_columns</code> and <code class=syntax>asterisk_include_alias_columns</code> are turned on. <a href=https://github.com/ClickHouse/ClickHouse/pull/17462 rel="external nofollow noreferrer" target=_blank>#17462</a> (<a href=https://github.com/chenziliang rel="external nofollow noreferrer" target=_blank>Ken Chen</a>).</li> <li>Allow specifying <a href=https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl target=_blank>TTL</a> to remove old entries from <a href=https://clickhouse.tech/docs/en/operations/system-tables/ target=_blank>system log tables</a>, using the <code class=syntax>&lt;ttl&gt;</code> attribute in <code class=syntax>config.xml</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17438 rel="external nofollow noreferrer" target=_blank>#17438</a> (<a href=https://github.com/spongedu rel="external nofollow noreferrer" target=_blank>Du Chuan</a>).</li> <li>Now queries coming to the server via MySQL and PostgreSQL protocols have distinctive interface types (which can be seen in the <code class=syntax>interface</code> column of the table<code class=syntax>system.query_log</code>): <code class=syntax>4</code> for MySQL, and <code class=syntax>5</code> for PostgreSQL, instead of formerly used <code class=syntax>1</code> which is now used for the native protocol only. <a href=https://github.com/ClickHouse/ClickHouse/pull/17437 rel="external nofollow noreferrer" target=_blank>#17437</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix parsing of SETTINGS clause of the <code class=syntax>INSERT ... SELECT ... SETTINGS</code> query. <a href=https://github.com/ClickHouse/ClickHouse/pull/17414 rel="external nofollow noreferrer" target=_blank>#17414</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Correctly account memory in RadixSort. <a href=https://github.com/ClickHouse/ClickHouse/pull/17412 rel="external nofollow noreferrer" target=_blank>#17412</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Add eof check in <code class=syntax>receiveHello</code> in server to prevent getting <code class=syntax>Attempt to read after eof</code> exception. <a href=https://github.com/ClickHouse/ClickHouse/pull/17365 rel="external nofollow noreferrer" target=_blank>#17365</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>Avoid possible stack overflow in bigint conversion. Big integers are experimental. <a href=https://github.com/ClickHouse/ClickHouse/pull/17269 rel="external nofollow noreferrer" target=_blank>#17269</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Now <code class=syntax>set</code> indices will work with <code class=syntax>GLOBAL IN</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17232 rel="external nofollow noreferrer" target=_blank>#17232</a> , <a href=https://github.com/ClickHouse/ClickHouse/issues/5576 rel="external nofollow noreferrer" target=_blank>#5576</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/17253 rel="external nofollow noreferrer" target=_blank>#17253</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Add limit for http redirects in request to S3 storage (<code class=syntax>s3_max_redirects</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17220 rel="external nofollow noreferrer" target=_blank>#17220</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>When <code class=syntax>-OrNull</code> combinator combined <code class=syntax>-If</code>, <code class=syntax>-Merge</code>, <code class=syntax>-MergeState</code>, <code class=syntax>-State</code> combinators, we should put <code class=syntax>-OrNull</code> in front. <a href=https://github.com/ClickHouse/ClickHouse/pull/16935 rel="external nofollow noreferrer" target=_blank>#16935</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>Support HTTP proxy and HTTPS S3 endpoint configuration. <a href=https://github.com/ClickHouse/ClickHouse/pull/16861 rel="external nofollow noreferrer" target=_blank>#16861</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Added proper authentication using environment, <code class=syntax>~/.aws</code> and <code class=syntax>AssumeRole</code> for S3 client. <a href=https://github.com/ClickHouse/ClickHouse/pull/16856 rel="external nofollow noreferrer" target=_blank>#16856</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Add more OpenTelemetry spans. Add an example of how to export the span data to Zipkin. <a href=https://github.com/ClickHouse/ClickHouse/pull/16535 rel="external nofollow noreferrer" target=_blank>#16535</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Cache dictionaries: Completely eliminate callbacks and locks for acquiring them. Keys are not divided into "not found" and "expired", but stored in the same map during query. <a href=https://github.com/ClickHouse/ClickHouse/pull/14958 rel="external nofollow noreferrer" target=_blank>#14958</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix never worked <code class=syntax>fsync_part_directory</code>/<code class=syntax>fsync_after_insert</code>/<code class=syntax>in_memory_parts_insert_sync</code> (experimental feature). <a href=https://github.com/ClickHouse/ClickHouse/pull/18845 rel="external nofollow noreferrer" target=_blank>#18845</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Allow using <code class=syntax>Atomic</code> engine for nested database of <code class=syntax>MaterializeMySQL</code> engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/14849 rel="external nofollow noreferrer" target=_blank>#14849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h4 id=bug-fix_3>Bug Fix<a class=headerlink href=../amp/#bug-fix_3 title="Permanent link"> </a></h4> <ul> <li>Fix the issue when server can stop accepting connections in very rare cases. <a href=https://github.com/ClickHouse/ClickHouse/pull/17542 rel="external nofollow noreferrer" target=_blank>#17542</a> (Amos Bird, <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18364 rel="external nofollow noreferrer" target=_blank>#18364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18373 rel="external nofollow noreferrer" target=_blank>#18373</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix possible wrong index analysis when the types of the index comparison are different. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17122 rel="external nofollow noreferrer" target=_blank>#17122</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17145 rel="external nofollow noreferrer" target=_blank>#17145</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href=https://github.com/ClickHouse/ClickHouse/pull/18481 rel="external nofollow noreferrer" target=_blank>#18481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href=https://github.com/ClickHouse/ClickHouse/pull/18381 rel="external nofollow noreferrer" target=_blank>#18381</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix possible incomplete query result while reading from <code class=syntax>MergeTree*</code> in case of read backoff (message <code class=syntax>&lt;Debug&gt; MergeTreeReadPool: Will lower number of threads</code> in logs). Was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/16423 rel="external nofollow noreferrer" target=_blank>#16423</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18137 rel="external nofollow noreferrer" target=_blank>#18137</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18216 rel="external nofollow noreferrer" target=_blank>#18216</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix use after free bug in <code class=syntax>rocksdb</code> library. <a href=https://github.com/ClickHouse/ClickHouse/pull/18862 rel="external nofollow noreferrer" target=_blank>#18862</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix infinite reading from file in <code class=syntax>ORC</code> format (was introduced in <a href=https://github.com/ClickHouse/ClickHouse/issues/10580 rel="external nofollow noreferrer" target=_blank>#10580</a>). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19095 rel="external nofollow noreferrer" target=_blank>#19095</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19134 rel="external nofollow noreferrer" target=_blank>#19134</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug in merge tree data writer which can lead to marks with bigger size than fixed granularity size. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18913 rel="external nofollow noreferrer" target=_blank>#18913</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19123 rel="external nofollow noreferrer" target=_blank>#19123</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix startup bug when clickhouse was not able to read compression codec from <code class=syntax>LowCardinality(Nullable(...))</code> and throws exception <code class=syntax>Attempt to read after EOF</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18340 rel="external nofollow noreferrer" target=_blank>#18340</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19101 rel="external nofollow noreferrer" target=_blank>#19101</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Restrict <code class=syntax>MODIFY TTL</code> queries for <code class=syntax>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href=https://github.com/ClickHouse/ClickHouse/pull/19064 rel="external nofollow noreferrer" target=_blank>#19064</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Make sure <code class=syntax>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17875 rel="external nofollow noreferrer" target=_blank>#17875</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19019 rel="external nofollow noreferrer" target=_blank>#19019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible error <code class=syntax>Expected single dictionary argument for function</code> if use function <code class=syntax>ignore</code> with <code class=syntax>LowCardinality</code> argument. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14275 rel="external nofollow noreferrer" target=_blank>#14275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19016 rel="external nofollow noreferrer" target=_blank>#19016</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix inserting of <code class=syntax>LowCardinality</code> column to table with <code class=syntax>TinyLog</code> engine. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18629 rel="external nofollow noreferrer" target=_blank>#18629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19010 rel="external nofollow noreferrer" target=_blank>#19010</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Join tries to materialize const columns, but our code wants them in other places. <a href=https://github.com/ClickHouse/ClickHouse/pull/18982 rel="external nofollow noreferrer" target=_blank>#18982</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Disable <code class=syntax>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18051 rel="external nofollow noreferrer" target=_blank>#18051</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18973 rel="external nofollow noreferrer" target=_blank>#18973</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18981 rel="external nofollow noreferrer" target=_blank>#18981</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix possible exception <code class=syntax>QueryPipeline stream: different number of columns</code> caused by merging of query plan's <code class=syntax>Expression</code> steps. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18190 rel="external nofollow noreferrer" target=_blank>#18190</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18980 rel="external nofollow noreferrer" target=_blank>#18980</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed very rare deadlock at shutdown. <a href=https://github.com/ClickHouse/ClickHouse/pull/18977 rel="external nofollow noreferrer" target=_blank>#18977</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix incorrect behavior when <code class=syntax>ALTER TABLE ... DROP PART 'part_name'</code> query removes all deduplication blocks for the whole partition. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18874 rel="external nofollow noreferrer" target=_blank>#18874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18969 rel="external nofollow noreferrer" target=_blank>#18969</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Attach partition should reset the mutation. <a href=https://github.com/ClickHouse/ClickHouse/issues/18804 rel="external nofollow noreferrer" target=_blank>#18804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18935 rel="external nofollow noreferrer" target=_blank>#18935</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix issue with <code class=syntax>bitmapOrCardinality</code> that may lead to nullptr dereference. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/18911 rel="external nofollow noreferrer" target=_blank>#18911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18912 rel="external nofollow noreferrer" target=_blank>#18912</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix possible hang at shutdown in <code class=syntax>clickhouse-local</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18891 rel="external nofollow noreferrer" target=_blank>#18891</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18893 rel="external nofollow noreferrer" target=_blank>#18893</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Queries for external databases (MySQL, ODBC, JDBC) were incorrectly rewritten if there was an expression in form of <code class=syntax>x IN table</code>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/9756 rel="external nofollow noreferrer" target=_blank>#9756</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18876 rel="external nofollow noreferrer" target=_blank>#18876</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix *If combinator with unary function and Nullable types. <a href=https://github.com/ClickHouse/ClickHouse/pull/18806 rel="external nofollow noreferrer" target=_blank>#18806</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix the issue that asynchronous distributed INSERTs can be rejected by the server if the setting <code class=syntax>network_compression_method</code> is globally set to non-default value. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18741 rel="external nofollow noreferrer" target=_blank>#18741</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18776 rel="external nofollow noreferrer" target=_blank>#18776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed <code class=syntax>Attempt to read after eof</code> error when trying to <code class=syntax>CAST</code> <code class=syntax>NULL</code> from <code class=syntax>Nullable(String)</code> to <code class=syntax>Nullable(Decimal(P, S))</code>. Now function <code class=syntax>CAST</code> returns <code class=syntax>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7690 rel="external nofollow noreferrer" target=_blank>#7690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18718 rel="external nofollow noreferrer" target=_blank>#18718</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix minor issue with logging. <a href=https://github.com/ClickHouse/ClickHouse/pull/18717 rel="external nofollow noreferrer" target=_blank>#18717</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix removing of empty parts in <code class=syntax>ReplicatedMergeTree</code> tables, created with old syntax. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18582 rel="external nofollow noreferrer" target=_blank>#18582</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18614 rel="external nofollow noreferrer" target=_blank>#18614</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix previous bug when date overflow with different values. Strict Date value limit to "2106-02-07", cast date &gt; "2106-02-07" to value 0. <a href=https://github.com/ClickHouse/ClickHouse/pull/18565 rel="external nofollow noreferrer" target=_blank>#18565</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Add FixedString data type support for replication from MySQL. Replication from MySQL is an experimental feature. This patch fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18450 rel="external nofollow noreferrer" target=_blank>#18450</a> Also fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6556 rel="external nofollow noreferrer" target=_blank>#6556</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18553 rel="external nofollow noreferrer" target=_blank>#18553</a> (<a href=https://github.com/awesomeleo rel="external nofollow noreferrer" target=_blank>awesomeleo</a>).</li> <li>Fix possible <code class=syntax>Pipeline stuck</code> error while using <code class=syntax>ORDER BY</code> after subquery with <code class=syntax>RIGHT</code> or <code class=syntax>FULL</code> join. <a href=https://github.com/ClickHouse/ClickHouse/pull/18550 rel="external nofollow noreferrer" target=_blank>#18550</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fix bug which may lead to <code class=syntax>ALTER</code> queries hung after corresponding mutation kill. Found by thread fuzzer. <a href=https://github.com/ClickHouse/ClickHouse/pull/18518 rel="external nofollow noreferrer" target=_blank>#18518</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Proper support for 12AM in <code class=syntax>parseDateTimeBestEffort</code> function. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18402 rel="external nofollow noreferrer" target=_blank>#18402</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18449 rel="external nofollow noreferrer" target=_blank>#18449</a> (<a href=https://github.com/vladimir-golovchenko rel="external nofollow noreferrer" target=_blank>vladimir-golovchenko</a>).</li> <li>Fixed <code class=syntax>value is too short</code> error when executing <code class=syntax>toType(...)</code> functions (<code class=syntax>toDate</code>, <code class=syntax>toUInt32</code>, etc) with argument of type <code class=syntax>Nullable(String)</code>. Now such functions return <code class=syntax>NULL</code> on parsing errors instead of throwing exception. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/7673 rel="external nofollow noreferrer" target=_blank>#7673</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18445 rel="external nofollow noreferrer" target=_blank>#18445</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix the unexpected behaviour of <code class=syntax>SHOW TABLES</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18431 rel="external nofollow noreferrer" target=_blank>#18431</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>Fix -SimpleState combinator generates incompatible arugment type and return type. <a href=https://github.com/ClickHouse/ClickHouse/pull/18404 rel="external nofollow noreferrer" target=_blank>#18404</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Fix possible race condition in concurrent usage of <code class=syntax>Set</code> or <code class=syntax>Join</code> tables and selects from <code class=syntax>system.tables</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18385 rel="external nofollow noreferrer" target=_blank>#18385</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix filling table <code class=syntax>system.settings_profile_elements</code>. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18231 rel="external nofollow noreferrer" target=_blank>#18231</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18379 rel="external nofollow noreferrer" target=_blank>#18379</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix possible crashes in aggregate functions with combinator <code class=syntax>Distinct</code>, while using two-level aggregation. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17682 rel="external nofollow noreferrer" target=_blank>#17682</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18365 rel="external nofollow noreferrer" target=_blank>#18365</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fixed issue when <code class=syntax>clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual IPv4/IPv6 stack; Fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes of the odbc-bridge process; Possibly closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14489 rel="external nofollow noreferrer" target=_blank>#14489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18278 rel="external nofollow noreferrer" target=_blank>#18278</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>Access control: <code class=syntax>SELECT count() FROM table</code> now can be executed if the user has access to at least single column from a table. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10639 rel="external nofollow noreferrer" target=_blank>#10639</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18233 rel="external nofollow noreferrer" target=_blank>#18233</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Access control: <code class=syntax>SELECT JOIN</code> now requires the <code class=syntax>SELECT</code> privilege on each of the joined tables. This PR fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17654 rel="external nofollow noreferrer" target=_blank>#17654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18232 rel="external nofollow noreferrer" target=_blank>#18232</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>Fix key comparison between Enum and Int types. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17989 rel="external nofollow noreferrer" target=_blank>#17989</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18214 rel="external nofollow noreferrer" target=_blank>#18214</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Replication from MySQL (experimental feature). Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18186 rel="external nofollow noreferrer" target=_blank>#18186</a> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16372 rel="external nofollow noreferrer" target=_blank>#16372</a> Fix unique key convert issue in MaterializeMySQL database engine. <a href=https://github.com/ClickHouse/ClickHouse/pull/18211 rel="external nofollow noreferrer" target=_blank>#18211</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix inconsistency for queries with both <code class=syntax>WITH FILL</code> and <code class=syntax>WITH TIES</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/17466 rel="external nofollow noreferrer" target=_blank>#17466</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18188 rel="external nofollow noreferrer" target=_blank>#18188</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix inserting a row with default value in case of parsing error in the last column. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17712 rel="external nofollow noreferrer" target=_blank>#17712</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18182 rel="external nofollow noreferrer" target=_blank>#18182</a> (<a href=https://github.com/zhangjmruc rel="external nofollow noreferrer" target=_blank>Jianmei Zhang</a>).</li> <li>Fix <code class=syntax>Unknown setting profile</code> error on attempt to set settings profile. <a href=https://github.com/ClickHouse/ClickHouse/pull/18167 rel="external nofollow noreferrer" target=_blank>#18167</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix error when query <code class=syntax>MODIFY COLUMN ... REMOVE TTL</code> doesn't actually remove column TTL. <a href=https://github.com/ClickHouse/ClickHouse/pull/18130 rel="external nofollow noreferrer" target=_blank>#18130</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fixed <code class=syntax>std::out_of_range: basic_string</code> in S3 URL parsing. <a href=https://github.com/ClickHouse/ClickHouse/pull/18059 rel="external nofollow noreferrer" target=_blank>#18059</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>Fix comparison of <code class=syntax>DateTime64</code> and <code class=syntax>Date</code>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13804 rel="external nofollow noreferrer" target=_blank>#13804</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/11222 rel="external nofollow noreferrer" target=_blank>#11222</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/18050 rel="external nofollow noreferrer" target=_blank>#18050</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Replication from MySQL (experimental feature): Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/15187 rel="external nofollow noreferrer" target=_blank>#15187</a> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17912 rel="external nofollow noreferrer" target=_blank>#17912</a> support convert MySQL prefix index for MaterializeMySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/17944 rel="external nofollow noreferrer" target=_blank>#17944</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>When server log rotation was configured using <code class=syntax>logger.size</code> parameter with numeric value larger than 2^32, the logs were not rotated properly. This is fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/17905 rel="external nofollow noreferrer" target=_blank>#17905</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>Trivial query optimization was producing wrong result if query contains ARRAY JOIN (so query is actually non trivial). <a href=https://github.com/ClickHouse/ClickHouse/pull/17887 rel="external nofollow noreferrer" target=_blank>#17887</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>Fix possible segfault in <code class=syntax>topK</code> aggregate function. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17404 rel="external nofollow noreferrer" target=_blank>#17404</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17845 rel="external nofollow noreferrer" target=_blank>#17845</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>WAL (experimental feature): Do not restore parts from WAL if <code class=syntax>in_memory_parts_enable_wal</code> is disabled. <a href=https://github.com/ClickHouse/ClickHouse/pull/17802 rel="external nofollow noreferrer" target=_blank>#17802</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>Exception message about max table size to drop was displayed incorrectly. <a href=https://github.com/ClickHouse/ClickHouse/pull/17764 rel="external nofollow noreferrer" target=_blank>#17764</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fixed possible segfault when there is not enough space when inserting into <code class=syntax>Distributed</code> table. <a href=https://github.com/ClickHouse/ClickHouse/pull/17737 rel="external nofollow noreferrer" target=_blank>#17737</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>Windows: Fixed <code class=syntax>Function not implemented</code> error when executing <code class=syntax>RENAME</code> query in <code class=syntax>Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17661 rel="external nofollow noreferrer" target=_blank>#17661</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17664 rel="external nofollow noreferrer" target=_blank>#17664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>In might be determined incorrectly if cluster is circular- (cross-) replicated or not when executing <code class=syntax>ON CLUSTER</code> query due to race condition when <code class=syntax>pool_size</code> &gt; 1. It's fixed. <a href=https://github.com/ClickHouse/ClickHouse/pull/17640 rel="external nofollow noreferrer" target=_blank>#17640</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix empty <code class=syntax>system.stack_trace</code> table when server is running in daemon mode. <a href=https://github.com/ClickHouse/ClickHouse/pull/17630 rel="external nofollow noreferrer" target=_blank>#17630</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>Exception <code class=syntax>fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17613 rel="external nofollow noreferrer" target=_blank>#17613</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17615 rel="external nofollow noreferrer" target=_blank>#17615</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13654 rel="external nofollow noreferrer" target=_blank>#13654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17565 rel="external nofollow noreferrer" target=_blank>#17565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix issue with memory accounting when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix <code class=syntax>ORDER BY</code> with enabled setting <code class=syntax>optimize_redundant_functions_in_order_by</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix duplicates after <code class=syntax>DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17294 rel="external nofollow noreferrer" target=_blank>#17294</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17296 rel="external nofollow noreferrer" target=_blank>#17296</a> (<a href=https://github.com/chengxianglibra rel="external nofollow noreferrer" target=_blank>li chengxiang</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17439 rel="external nofollow noreferrer" target=_blank>#17439</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Fixed high CPU usage in background tasks of *MergeTree tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/17416 rel="external nofollow noreferrer" target=_blank>#17416</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix possible crash while reading from <code class=syntax>JOIN</code> table with <code class=syntax>LowCardinality</code> types. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17228 rel="external nofollow noreferrer" target=_blank>#17228</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17397 rel="external nofollow noreferrer" target=_blank>#17397</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>Replication from MySQL (experimental feature): Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16835 rel="external nofollow noreferrer" target=_blank>#16835</a> try fix miss match header with MySQL SHOW statement. <a href=https://github.com/ClickHouse/ClickHouse/pull/17366 rel="external nofollow noreferrer" target=_blank>#17366</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix nondeterministic functions with predicate optimizer. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17244 rel="external nofollow noreferrer" target=_blank>#17244</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17273 rel="external nofollow noreferrer" target=_blank>#17273</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix possible <code class=syntax>Unexpected packet Data received from client</code> error for Distributed queries with <code class=syntax>LIMIT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17254 rel="external nofollow noreferrer" target=_blank>#17254</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17246 rel="external nofollow noreferrer" target=_blank>#17246</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17249 rel="external nofollow noreferrer" target=_blank>#17249</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>clickhouse-copier: Fix for non-partitioned tables <a href=https://github.com/ClickHouse/ClickHouse/issues/15235 rel="external nofollow noreferrer" target=_blank>#15235</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17248 rel="external nofollow noreferrer" target=_blank>#17248</a> (<a href=https://github.com/kaka11chen rel="external nofollow noreferrer" target=_blank>Qi Chen</a>).</li> <li>Fixed possible not-working mutations for parts stored on S3 disk (experimental feature). <a href=https://github.com/ClickHouse/ClickHouse/pull/17227 rel="external nofollow noreferrer" target=_blank>#17227</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>Bug fix for funciton <code class=syntax>fuzzBits</code>, related issue: <a href=https://github.com/ClickHouse/ClickHouse/issues/16980 rel="external nofollow noreferrer" target=_blank>#16980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17051 rel="external nofollow noreferrer" target=_blank>#17051</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Fix <code class=syntax>optimize_distributed_group_by_sharding_key</code> for query with OFFSET only. <a href=https://github.com/ClickHouse/ClickHouse/pull/16996 rel="external nofollow noreferrer" target=_blank>#16996</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix queries from <code class=syntax>Merge</code> tables over <code class=syntax>Distributed</code> tables with JOINs. <a href=https://github.com/ClickHouse/ClickHouse/pull/16993 rel="external nofollow noreferrer" target=_blank>#16993</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Fix order by optimization with monotonic functions. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16107 rel="external nofollow noreferrer" target=_blank>#16107</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16956 rel="external nofollow noreferrer" target=_blank>#16956</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fix incorrect comparison of types <code class=syntax>DateTime64</code> with different scales. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16655 rel="external nofollow noreferrer" target=_blank>#16655</a> ... <a href=https://github.com/ClickHouse/ClickHouse/pull/16952 rel="external nofollow noreferrer" target=_blank>#16952</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>Fix optimization of group by with enabled setting <code class=syntax>optimize_aggregators_of_group_by_keys</code> and joins. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12604 rel="external nofollow noreferrer" target=_blank>#12604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16951 rel="external nofollow noreferrer" target=_blank>#16951</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Minor fix in SHOW ACCESS query. <a href=https://github.com/ClickHouse/ClickHouse/pull/16866 rel="external nofollow noreferrer" target=_blank>#16866</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>Fix the behaviour with enabled <code class=syntax>optimize_trivial_count_query</code> setting with partition predicate. <a href=https://github.com/ClickHouse/ClickHouse/pull/16767 rel="external nofollow noreferrer" target=_blank>#16767</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Return number of affected rows for INSERT queries via MySQL wire protocol. Previously ClickHouse used to always return 0, it's fixed. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16605 rel="external nofollow noreferrer" target=_blank>#16605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16715 rel="external nofollow noreferrer" target=_blank>#16715</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix inconsistent behavior caused by <code class=syntax>select_sequential_consistency</code> for optimized trivial count query and system tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/16309 rel="external nofollow noreferrer" target=_blank>#16309</a> (<a href=https://github.com/haoch rel="external nofollow noreferrer" target=_blank>Hao Chen</a>).</li> <li>Throw error when <code class=syntax>REPLACE</code> column transformer operates on non existing column. <a href=https://github.com/ClickHouse/ClickHouse/pull/16183 rel="external nofollow noreferrer" target=_blank>#16183</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>Throw exception in case of not equi-join ON expression in RIGH|FULL JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/15162 rel="external nofollow noreferrer" target=_blank>#15162</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h4 id=build-testing-packaging-improvement_2>Build/Testing/Packaging Improvement<a class=headerlink href=../amp/#build-testing-packaging-improvement_2 title="Permanent link"> </a></h4> <ul> <li>Add simple integrity check for ClickHouse binary. It allows to detect corruption due to faulty hardware (bit rot on storage media or bit flips in RAM). <a href=https://github.com/ClickHouse/ClickHouse/pull/18811 rel="external nofollow noreferrer" target=_blank>#18811</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Change <code class=syntax>OpenSSL</code> to <code class=syntax>BoringSSL</code>. It allows to avoid issues with sanitizers. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12490 rel="external nofollow noreferrer" target=_blank>#12490</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/17502 rel="external nofollow noreferrer" target=_blank>#17502</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12952 rel="external nofollow noreferrer" target=_blank>#12952</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18129 rel="external nofollow noreferrer" target=_blank>#18129</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Simplify <code class=syntax>Sys/V</code> init script. It was not working on Ubuntu 12.04 or older. <a href=https://github.com/ClickHouse/ClickHouse/pull/17428 rel="external nofollow noreferrer" target=_blank>#17428</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Multiple improvements in <code class=syntax>./clickhouse install</code> script. <a href=https://github.com/ClickHouse/ClickHouse/pull/17421 rel="external nofollow noreferrer" target=_blank>#17421</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Now ClickHouse can pretend to be a fake ZooKeeper. Currently, storage implementation is just stored in-memory hash-table, and server partially support ZooKeeper protocol. <a href=https://github.com/ClickHouse/ClickHouse/pull/16877 rel="external nofollow noreferrer" target=_blank>#16877</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix dead list watches removal for TestKeeperStorage (a mock for ZooKeeper). <a href=https://github.com/ClickHouse/ClickHouse/pull/18065 rel="external nofollow noreferrer" target=_blank>#18065</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Add <code class=syntax>SYSTEM SUSPEND</code> command for fault injection. It can be used to faciliate failover tests. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/15979 rel="external nofollow noreferrer" target=_blank>#15979</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18850 rel="external nofollow noreferrer" target=_blank>#18850</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Generate build id when ClickHouse is linked with <code class=syntax>lld</code>. It's appeared that <code class=syntax>lld</code> does not generate it by default on my machine. Build id is used for crash reports and introspection. <a href=https://github.com/ClickHouse/ClickHouse/pull/18808 rel="external nofollow noreferrer" target=_blank>#18808</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Fix shellcheck errors in style check. <a href=https://github.com/ClickHouse/ClickHouse/pull/18566 rel="external nofollow noreferrer" target=_blank>#18566</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Update timezones info to 2020e. <a href=https://github.com/ClickHouse/ClickHouse/pull/18531 rel="external nofollow noreferrer" target=_blank>#18531</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix codespell warnings. Split style checks into separate parts. Update style checks docker image. <a href=https://github.com/ClickHouse/ClickHouse/pull/18463 rel="external nofollow noreferrer" target=_blank>#18463</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>Automated check for leftovers of conflict markers in docs. <a href=https://github.com/ClickHouse/ClickHouse/pull/18332 rel="external nofollow noreferrer" target=_blank>#18332</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Enable Thread Fuzzer for stateless tests flaky check. <a href=https://github.com/ClickHouse/ClickHouse/pull/18299 rel="external nofollow noreferrer" target=_blank>#18299</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Do not use non thread-safe function <code class=syntax>strerror</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18204 rel="external nofollow noreferrer" target=_blank>#18204</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Update <code class=syntax>anchore/scan-action@main</code> workflow action (was moved from <code class=syntax>master</code> to <code class=syntax>main</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/18192 rel="external nofollow noreferrer" target=_blank>#18192</a> (<a href=https://github.com/stigsb rel="external nofollow noreferrer" target=_blank>Stig Bakken</a>).</li> <li>Now <code class=syntax>clickhouse-test</code> does DROP/CREATE databases with a timeout. <a href=https://github.com/ClickHouse/ClickHouse/pull/18098 rel="external nofollow noreferrer" target=_blank>#18098</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Enable experimental support for Pytest framework for stateless tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/17902 rel="external nofollow noreferrer" target=_blank>#17902</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>Now we use the fresh docker daemon version in integration tests. <a href=https://github.com/ClickHouse/ClickHouse/pull/17671 rel="external nofollow noreferrer" target=_blank>#17671</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Send info about official build, memory, cpu and free disk space to Sentry if it is enabled. Sentry is opt-in feature to help ClickHouse developers. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/17279 rel="external nofollow noreferrer" target=_blank>#17279</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17543 rel="external nofollow noreferrer" target=_blank>#17543</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>There was an uninitialized variable in the code of clickhouse-copier. <a href=https://github.com/ClickHouse/ClickHouse/pull/17363 rel="external nofollow noreferrer" target=_blank>#17363</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix <a href=https://clickhouse-test-reports.s3.yandex.net/17309/065cd002578f2e8228f12a2744bd40c970065e0c/stress_test_(memory)/stderr.log rel="external nofollow noreferrer" target=_blank>one MSan report</a> from <a href=https://github.com/ClickHouse/ClickHouse/issues/17309 rel="external nofollow noreferrer" target=_blank>#17309</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17344 rel="external nofollow noreferrer" target=_blank>#17344</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Fix for the issue with IPv6 in Arrow Flight library. See <a href=https://github.com/ClickHouse/ClickHouse/pull/16243#issuecomment-720830294 rel="external nofollow noreferrer" target=_blank>the comments</a> for details. <a href=https://github.com/ClickHouse/ClickHouse/pull/16664 rel="external nofollow noreferrer" target=_blank>#16664</a> (<a href=https://github.com/FawnD2 rel="external nofollow noreferrer" target=_blank>Zhanna</a>).</li> <li>Add a library that replaces some <code class=syntax>libc</code> functions to traps that will terminate the process. <a href=https://github.com/ClickHouse/ClickHouse/pull/16366 rel="external nofollow noreferrer" target=_blank>#16366</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Provide diagnostics in server logs in case of stack overflow, send error message to clickhouse-client. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/14840 rel="external nofollow noreferrer" target=_blank>#14840</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16346 rel="external nofollow noreferrer" target=_blank>#16346</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Now we can run almost all stateless functional tests in parallel. <a href=https://github.com/ClickHouse/ClickHouse/pull/15236 rel="external nofollow noreferrer" target=_blank>#15236</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Fix corruption in <code class=syntax>librdkafka</code> snappy decompression (was a problem only for gcc10 builds, but official builds uses clang already, so at least recent official releases are not affected). <a href=https://github.com/ClickHouse/ClickHouse/pull/18053 rel="external nofollow noreferrer" target=_blank>#18053</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>If server was terminated by OOM killer, print message in log. <a href=https://github.com/ClickHouse/ClickHouse/pull/13516 rel="external nofollow noreferrer" target=_blank>#13516</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>PODArray: Avoid call to memcpy with (nullptr, 0) arguments (Fix UBSan report). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/18525 rel="external nofollow noreferrer" target=_blank>#18525</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18526 rel="external nofollow noreferrer" target=_blank>#18526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Minor improvement for path concatenation of zookeeper paths inside DDLWorker. <a href=https://github.com/ClickHouse/ClickHouse/pull/17767 rel="external nofollow noreferrer" target=_blank>#17767</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>Allow to reload symbols from debug file. This PR also fixes a build-id issue. <a href=https://github.com/ClickHouse/ClickHouse/pull/17637 rel="external nofollow noreferrer" target=_blank>#17637</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>TestFlows: fixes to LDAP tests that fail due to slow test execution. <a href=https://github.com/ClickHouse/ClickHouse/pull/18790 rel="external nofollow noreferrer" target=_blank>#18790</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: Merging requirements for AES encryption functions. Updating aes_encryption tests to use new requirements. Updating TestFlows version to 1.6.72. <a href=https://github.com/ClickHouse/ClickHouse/pull/18221 rel="external nofollow noreferrer" target=_blank>#18221</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: Updating TestFlows version to the latest 1.6.72. Re-generating requirements.py. <a href=https://github.com/ClickHouse/ClickHouse/pull/18208 rel="external nofollow noreferrer" target=_blank>#18208</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: Updating TestFlows README.md to include "How To Debug Why Test Failed" section. <a href=https://github.com/ClickHouse/ClickHouse/pull/17808 rel="external nofollow noreferrer" target=_blank>#17808</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>TestFlows: tests for RBAC <a href=https://clickhouse.tech/docs/en/sql-reference/statements/grant/#grant-access-management target=_blank>ACCESS MANAGEMENT</a> privileges. <a href=https://github.com/ClickHouse/ClickHouse/pull/17804 rel="external nofollow noreferrer" target=_blank>#17804</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> <li>TestFlows: RBAC tests for SHOW, TRUNCATE, KILL, and OPTIMIZE. - Updates to old tests. - Resolved comments from #<a href=https://github.com/ClickHouse/ClickHouse/pull/16977 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/16977</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17657 rel="external nofollow noreferrer" target=_blank>#17657</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> <li>TestFlows: Added RBAC tests for <code class=syntax>ATTACH</code>, <code class=syntax>CREATE</code>, <code class=syntax>DROP</code>, and <code class=syntax>DETACH</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16977 rel="external nofollow noreferrer" target=_blank>#16977</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> </ul> <h2 id=changelog-for-2020><a href=https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2020.md rel="external nofollow noreferrer" target=_blank>Changelog for 2020</a><a class=headerlink href=../amp/#changelog-for-2020 title="Permanent link"> </a></h2> </div> </div> <div class=row> <div class=col> <div class="alert alert-light my-3"> <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p> <span class="alert-heading display-6">Article Rating</span> <div id=rating-stars class="display-6 mb-0">RATING_STARS</div> </div> <div id=content-footer class="text-muted pt-3 mb-5"> <div class=float-md-right>©2016–2020 Yandex LLC</div> <div>Built from <a href=https://github.com/ClickHouse/ClickHouse/commit/b030bfedd7db4603034643fd183cf7784a820193 rel="external nofollow noreferrer" target=_blank class=text-reset>b030bfedd7</a> </div> </div> </div> </div> <div id=to-full-website class="row fixed-bottom text-center bg-white py-3"> <div class=col> <a href=https://clickhouse.tech/docs/en/whats-new/changelog/ class="btn btn-lg btn-outline-orange">To full website</a> </div> </div> </div> <amp-analytics type=metrika> <script type=application/json>{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script> </amp-analytics> </body> </html> 